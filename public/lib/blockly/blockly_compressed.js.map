{"version":3,"sources":["core/registry.ts","core/common.ts","core/utils/idgenerator.ts","core/events/utils.ts","core/touch.ts","core/browser_events.ts","core/utils/array.ts","core/css.ts","core/utils/deprecation.ts","core/utils/dom.ts","core/utils/style.ts","core/utils/svg_math.ts","core/utils/xml.ts","core/utils/toolbox.ts","core/positionable_helpers.ts","core/dialog.ts","core/interfaces/i_variable_backed_parameter_model.ts","core/interfaces/i_legacy_procedure_blocks.ts","core/variables.ts","core/clipboard/registry.ts","core/render_management.ts","core/xml.ts","core/interfaces/i_serializable.ts","core/serialization/registry.ts","core/serialization/blocks.ts","core/clipboard/block_paster.ts","core/clipboard.ts","core/utils/aria.ts","core/widgetdiv.ts","core/contextmenu.ts","core/utils/math.ts","core/dropdowndiv.ts","core/block_animations.ts","core/utils/string.ts","core/tooltip.ts","core/utils/object.ts","core/interfaces/i_has_bubble.ts","core/utils/colour.ts","core/utils/parsing.ts","core/interfaces/i_procedure_block.ts","core/interfaces/i_observable.ts","core/field_registry.ts","core/field_dropdown.ts","core/extensions.ts","core/utils/svg_paths.ts","core/icons/registry.ts","core/procedures.ts","core/renderers/common/constants.ts","core/keyboard_nav/ast_node.ts","core/connection.ts","core/renderers/common/block_rendering.ts","core/variables_dynamic.ts","core/workspace_svg.ts","core/interfaces/i_copyable.ts","core/shortcut_items.ts","core/serialization/procedures.ts","core/serialization/workspaces.ts","core/bump_objects.ts","core/block_dragger.ts","core/contextmenu_items.ts","core/inject.ts","core/interfaces/i_icon.ts","core/interfaces/i_paster.ts","core/interfaces/i_selectable_toolbox_item.ts","core/blockly.ts","core/interfaces/i_rendered_element.ts","src/com/google/javascript/jscomp/js/base.js","src/com/google/javascript/jscomp/js/util/defines.js","src/com/google/javascript/jscomp/js/util/defineproperty.js","src/com/google/javascript/jscomp/js/util/global.js","src/com/google/javascript/jscomp/js/util/shouldpolyfill.js","src/com/google/javascript/jscomp/js/util/polyfill.js","src/com/google/javascript/jscomp/js/es6/globalthis.js","src/com/google/javascript/jscomp/js/es6/util/arrayiterator.js","src/com/google/javascript/jscomp/js/es6/symbol.js","src/com/google/javascript/jscomp/js/es6/util/iteratorfromarray.js","src/com/google/javascript/jscomp/js/es6/array/values.js","src/com/google/javascript/jscomp/js/es6/array/flat.js","src/com/google/javascript/jscomp/js/util/owns.js","src/com/google/javascript/jscomp/js/es6/object/entries.js","src/com/google/javascript/jscomp/js/es6/object/values.js","core/blocks.ts","core/events/events_abstract.ts","core/events/events_ui_base.ts","core/events/events_click.ts","core/utils/useragent.ts","core/component_manager.ts","core/utils/coordinate.ts","core/utils/svg.ts","core/utils/rect.ts","core/utils/size.ts","core/scrollbar.ts","core/sprites.ts","core/zoom_controls.ts","core/icons/icon_types.ts","core/inputs/input_types.ts","core/msg.ts","core/events/events_var_base.ts","core/events/events_var_create.ts","core/variable_model.ts","core/workspace_comment.ts","core/events/events_selected.ts","core/clipboard/workspace_comment_paster.ts","core/workspace_comment_svg.ts","core/serialization/exceptions.ts","core/serialization/priorities.ts","core/events/events_block_base.ts","core/events/events_block_create.ts","core/events/events_theme_change.ts","core/events/events_viewport.ts","core/config.ts","core/connection_type.ts","core/connection_db.ts","core/menu.ts","core/menuitem.ts","core/contextmenu_registry.ts","core/layers.ts","core/bubble_dragger.ts","core/internal_constants.ts","core/workspace_dragger.ts","core/gesture.ts","core/grid.ts","core/marker_manager.ts","core/theme.ts","core/theme/classic.ts","core/options.ts","core/events/events_block_change.ts","core/field.ts","core/names.ts","core/observable_procedure_map.ts","core/icons/icon.ts","core/bubbles/bubble.ts","core/bubbles/mini_workspace_bubble.ts","core/icons/mutator_icon.ts","core/utils/keycodes.ts","core/utils.ts","core/bubbles/text_bubble.ts","core/bubbles/textinput_bubble.ts","core/icons/comment_icon.ts","core/icons/warning_icon.ts","core/icons/exceptions.ts","core/icons.ts","core/renderers/measurables/types.ts","core/renderers/measurables/base.ts","core/renderers/measurables/row.ts","core/renderers/measurables/bottom_row.ts","core/renderers/measurables/connection.ts","core/renderers/measurables/input_connection.ts","core/renderers/measurables/external_value_input.ts","core/renderers/measurables/field.ts","core/renderers/measurables/hat.ts","core/renderers/measurables/icon.ts","core/renderers/measurables/in_row_spacer.ts","core/renderers/measurables/inline_input.ts","core/renderers/measurables/statement_input.ts","core/renderers/measurables/input_row.ts","core/renderers/measurables/jagged_edge.ts","core/renderers/measurables/next_connection.ts","core/renderers/measurables/output_connection.ts","core/renderers/measurables/previous_connection.ts","core/renderers/measurables/round_corner.ts","core/renderers/measurables/spacer_row.ts","core/renderers/measurables/square_corner.ts","core/renderers/measurables/top_row.ts","core/renderers/common/drawer.ts","core/inputs/align.ts","core/field_label.ts","core/inputs/input.ts","core/inputs/dummy_input.ts","core/inputs/end_row_input.ts","core/inputs/statement_input.ts","core/inputs/value_input.ts","core/renderers/common/info.ts","core/events/events_marker_move.ts","core/renderers/common/marker_svg.ts","core/renderers/common/path_object.ts","core/constants.ts","core/insertion_marker_manager.ts","core/renderers/common/renderer.ts","core/theme_manager.ts","core/connection_checker.ts","core/events/events_var_delete.ts","core/events/events_var_rename.ts","core/variable_map.ts","core/workspace.ts","core/workspace_audio.ts","core/layer_manager.ts","core/events/events_trashcan_open.ts","core/events/events_block_delete.ts","core/block.ts","core/keyboard_nav/marker.ts","core/keyboard_nav/cursor.ts","core/keyboard_nav/basic_cursor.ts","core/keyboard_nav/tab_navigate_cursor.ts","core/rendered_connection.ts","core/block_svg.ts","core/drag_target.ts","core/delete_area.ts","core/trashcan.ts","core/shortcut_registry.ts","core/serialization/variables.ts","core/serialization.ts","core/scrollbar_pair.ts","core/metrics_manager.ts","core/events/workspace_events.ts","core/events/events_block_drag.ts","core/bubbles.ts","core/events/events_block_field_intermediate_change.ts","core/events/events_block_move.ts","core/events/events_bubble_open.ts","core/events/events_comment_base.ts","core/events/events_comment_change.ts","core/events/events_comment_create.ts","core/events/events_comment_delete.ts","core/events/events_comment_move.ts","core/events/events_toolbox_item_select.ts","core/events/events.ts","core/renderers/zelos/constants.ts","core/renderers/zelos/drawer.ts","core/field_image.ts","core/field_input.ts","core/field_textinput.ts","core/renderers/zelos/measurables/bottom_row.ts","core/renderers/zelos/measurables/inputs.ts","core/renderers/zelos/measurables/row_elements.ts","core/renderers/zelos/measurables/top_row.ts","core/renderers/zelos/info.ts","core/renderers/zelos/marker_svg.ts","core/renderers/zelos/path_object.ts","core/renderers/zelos/renderer.ts","core/renderers/zelos/zelos.ts","core/field_angle.ts","core/field_checkbox.ts","core/field_colour.ts","core/field_label_serializable.ts","core/field_multilineinput.ts","core/field_number.ts","core/field_variable.ts","core/flyout_button.ts","core/flyout_metrics_manager.ts","core/flyout_base.ts","core/flyout_horizontal.ts","core/flyout_vertical.ts","core/generator.ts","core/inputs.ts","core/connection_previewers/insertion_marker_previewer.ts","core/renderers/geras/constants.ts","core/renderers/geras/highlighter.ts","core/renderers/geras/drawer.ts","core/renderers/geras/highlight_constants.ts","core/renderers/geras/measurables/inline_input.ts","core/renderers/geras/measurables/statement_input.ts","core/renderers/geras/info.ts","core/renderers/geras/path_object.ts","core/renderers/geras/renderer.ts","core/renderers/geras/geras.ts","core/renderers/minimalist/constants.ts","core/renderers/minimalist/drawer.ts","core/renderers/minimalist/info.ts","core/renderers/minimalist/renderer.ts","core/renderers/minimalist/minimalist.ts","core/renderers/thrasos/info.ts","core/renderers/thrasos/renderer.ts","core/renderers/thrasos/thrasos.ts","core/theme/zelos.ts","core/theme/themes.ts","core/toolbox/toolbox_item.ts","core/toolbox/category.ts","core/toolbox/separator.ts","core/toolbox/collapsible_category.ts","core/toolbox/toolbox.ts","core/main.ts","core/blockly_options.ts","core/utils/metrics.ts","core/renderers/common/i_path_object.ts","core/interfaces/i_toolbox_item.ts","core/interfaces/i_toolbox.ts","core/interfaces/i_styleable.ts","core/interfaces/i_serializer.ts","core/interfaces/i_selectable.ts","core/interfaces/i_registrable.ts","core/interfaces/i_procedure_model.ts","core/interfaces/i_procedure_map.ts","core/interfaces/i_positionable.ts","core/interfaces/i_parameter_model.ts","core/interfaces/i_movable.ts","core/interfaces/i_metrics_manager.ts","core/interfaces/i_keyboard_accessible.ts","core/interfaces/i_flyout.ts","core/interfaces/i_drag_target.ts","core/interfaces/i_draggable.ts","core/interfaces/i_delete_area.ts","core/interfaces/i_deletable.ts","core/interfaces/i_contextmenu.ts","core/interfaces/i_connection_previewer.ts","core/interfaces/i_connection_checker.ts","core/interfaces/i_component.ts","core/interfaces/i_collapsible_toolbox_item.ts","core/interfaces/i_bubble.ts","core/interfaces/i_bounded_element.ts","core/interfaces/i_block_dragger.ts","core/interfaces/i_autohideable.ts","core/interfaces/i_ast_node_location_with_block.ts","core/interfaces/i_ast_node_location_svg.ts","core/interfaces/i_ast_node_location.ts"],"names":["register","validate","unregister","getItem","hasItem","getClass","getObject","getAllItems","getClassFromOptions","getWorkspaceById","getAllWorkspaces","registerWorkspace","unregisterWorkpace","getMainWorkspace","setMainWorkspace","getSelected","setSelected","getParentContainer","setParentContainer","svgResize","getBlockTypeCounts","jsonInitFactory","defineBlocksWithJsonArray","defineBlocksWithJsonArrayInternal","getNextUniqueId","genUid","setRecordUndo","getRecordUndo","fire","fireInternal","fireNow","filter","clearPendingUndo","isEnabled","setGroupInternal","getDescendantIds","fromJson","get","disableOrphans","longStart","longStop","clearTouchIdentifier","shouldHandleEvent","getTouchIdentifierFromEvent","checkTouchIdentifier","conditionalBind","bind","unbind","isTargetInput","isRightButton","mouseToSvg","getScrollDeltaPixels","removeElem","inject","warn","createSvgElement","addClass","removeClasses","removeClass","hasClass","removeNode","insertAfter","containsNode","setCssTransform","startTextWidthCache","stopTextWidthCache","getTextWidth","getFastTextWidth","getFastTextWidthWithSizeString","measureFontMetrics","getSize","getSizeInternal","getSizeWithDisplay","getComputedStyle","getPageOffset","getViewportPageOffset","getBorderBox","scrollIntoContainerView","getContainerOffsetToScrollInto","getRelativeXY","getInjectionDivXY","getViewportBBox","getDocumentScroll","screenToWsCoordinates","wsToScreenCoordinates","injectDependencies","domToText","sanitizeText","convertToolboxDefToJson","validateToolbox","convertFlyoutDefToJsonArray","hasCategories","hasCategoriesInternal","isCategoryCollapsible","convertToToolboxJson","xmlToJsonArray","addAttributes","parseToolboxTree","getStartPositionRect","getCornerOppositeToolbox","bumpPositionRect","alert","setAlert","confirm","confirmInternal","setConfirm","prompt","setPrompt","isVariableBackedParameterModel","isLegacyProcedureDefBlock","isLegacyProcedureCallBlock","flyoutCategory","flyoutCategoryBlocks","generateUniqueName","generateUniqueNameInternal","generateUniqueNameFromOptions","createVariableButtonHandler","promptName","nameUsedWithOtherType","nameUsedWithAnyType","nameUsedWithConflictingParam","checkForConflictingParamWithProcedureModels","checkForConflictingParamWithLegacyProcedures","generateVariableFieldDom","createVariable","getAddedVariables","queueRender","finishQueuedRenders","triggerQueuedRenders","alwaysImmediatelyRender","queueBlock","doRenders","dequeueBlock","shouldRenderRootBlock","renderBlock","workspaceToDom","variablesToDom","blockToDomWithXY","fieldToDom","allFieldsToDom","blockToDom","cloneShadow","domToPrettyText","clearWorkspaceAndLoadFromXml","appendDomToWorkspace","domToBlockInternal","domToVariables","mapSupportedXmlTags","applyMutationTagNodes","applyCommentTagNodes","applyDataTagNodes","applyFieldTagNodes","findChildBlocks","applyInputTagNodes","applyNextTagNodes","domToBlockHeadless","domToField","deleteNext","isElement","isSerializable","save","saveAttributes","saveCoords","saveExtraState","saveIcons","saveFields","saveInputBlocks","saveNextBlocks","saveConnection","append","appendInternal","appendPrivate","loadCoords","loadAttributes","loadExtraState","tryToConnectParent","loadIcons","loadFields","loadInputBlocks","loadNextBlocks","loadConnection","initBlock","moveBlockToNotConflict","blockOverlapsOtherExactly","blockIsInSnapRadius","copy","copyInternal","paste","pasteFromData","duplicate","duplicateInternal","setRole","setState","getDiv","testOnly_setDiv","createDom","show","hide","isVisible","hideIfOwner","positionInternal","positionWithAnchor","calculateX","calculateY","isRepositionable","repositionForWindowResize","getCurrentBlock","setCurrentBlock","populate_","position_","createWidget_","haltPropagation","dispose","commentDeleteOption","commentDuplicateOption","workspaceCommentOption","toRadians","toDegrees","clamp","setBoundsElement","getOwner","getContentDiv","clearContent","setColour","showPositionedByBlock","showPositionedByField","getScaledBboxOfBlock","getScaledBboxOfField","showPositionedByRect","getPositionBelowMetrics","getPositionAboveMetrics","getPositionTopOfPageMetrics","getPositionX","hideWithoutAnimation","disposeUiEffect","disposeUiStep","connectionUiEffect","disconnectUiEffect","disconnectUiStep","disconnectUiStop","startsWith","shortestStringLength","commonWordPrefix","commonWordSuffix","wrapLine","wrapScore","wrapMutate","wrapToText","setCustomTooltip","getCustomTooltip","getTooltipOfObject","getTargetObject","bindMouseEvents","unbindMouseEvents","onMouseOver","onMouseOut","onMouseMove","block","unblock","renderContent","renderDefaultContent","getPosition","deepMerge","hasBubble","getHsvSaturation","setHsvSaturation","getHsvValue","setHsvValue","parse","rgbToHex","hexToRgb","hsvToHex","blend","hueToHex","tokenizeInterpolationInternal","tokenizeInterpolation","replaceMessageReferences","checkMessageReferences","parseBlockColour","isProcedureBlock","isObservable","fromJsonInternal","trimOptions","applyTrim","validateOptions","isRegistered","apply","checkNoMutatorProperties","checkXmlHooks","checkJsonHooks","checkMutatorDialog","checkHasFunctionPair","checkHasMutatorProperties","getMutatorProperties","mutatorPropertiesMatch","runAfterPageLoad","checkDropdownOptionsInTable","extensionParentTooltip","point","curve","moveTo","moveBy","lineTo","line","lineOnAxis","arc","allProcedures","procTupleComparator","isLegalName","isNameUsed","updateMutatorFlyout","mutatorOpenListener","mutatorChangeListener","getCallers","blockIsModernCallerFor","isDynamicShape","isPuzzleTab","isNotch","getParentConnection","connectReciprocally","getSingleConnection","getConnectionForOrphanedOutput","init","stringButtonClickHandler","numberButtonClickHandler","colourButtonClickHandler","resizeSvgContents","isCopyable","registerEscape","registerDelete","registerCopy","registerCut","registerPaste","registerUndo","registerRedo","registerDefaultShortcuts","saveProcedure","saveParameter","loadProcedure","loadParameter","load","bumpObjectIntoBounds","bumpIntoBoundsHandler","extractObjectFromEvent","bumpTopObjectsIntoBounds","initIconData","registerCleanup","toggleOption_","registerCollapse","registerExpand","addDeletableBlocks_","getDeletableBlocks_","deleteNext_","registerDeleteAll","registerWorkspaceOptions_","registerDuplicate","registerComment","registerInline","registerCollapseExpandBlock","registerDisable","registerHelp","registerBlockOptions_","registerDefaultOptions","createMainWorkspace","onKeyDown","bindDocumentEvents","loadSounds","isIcon","isPaster","isSelectableToolboxItem","hideChaff","isRenderedElement","type","name","registryItem","opt_allowOverrides","Type","trim","Error","toLowerCase","caselessName","typeRegistry","typeMap","nameRegistry","nameMap","Object","create","String","FIELD","console","opt_throwIfMissing","msg","opt_cased","casedRegistry","key","keys","options","plugin","plugins","DEFAULT","id","WorkspaceDB_","workspaces","workspaceId","push","workspace","mainWorkspace","selected","newSelection","parentContainer","newParent","parentWorkspace","svg","getParentSvg","cachedSize","getCachedParentSvgSize","div","parentElement","HTMLElement","width","offsetWidth","height","offsetHeight","setAttribute","setCachedParentSvgSize","resize","opt_stripFollowing","typeCountsMap","descendants","getDescendants","nextBlock","getNextBlock","index","indexOf","splice","length","i","checkBlock","jsonDef","jsonInit","jsonArray","TEST_ONLY","defineBlocks","createBlockDefinitionsFromJsonArray","blocks","elem","definition","Blocks","toString","nextId","internal","newValue","recordUndo","event","FIRE_QUEUE","requestAnimationFrame","setTimeout","e","queue","eventWorkspace","fireChangeListener","workspaceIds","Set","map","undoStack","getUndoStack","group","undefined","events","queueIn","forward","slice","reverse","mergedQueue","hash","isNull","isUiEvent","eventType","UI","blockId","join","lastEntry","lastEvent","MOVE","moveEvent","newParentId","newInputName","newCoordinate","reason","reasonSet","concat","Array","from","CHANGE","element","VIEWPORT_CHANGE","viewportEvent","viewTop","viewLeft","scale","oldScale","CLICK","BUBBLE_OPEN","unshift","disable","disabled","enable","getGroup","setGroup","state","ids","descendant","json","eventClass","EVENT","CREATE","getBlockById","initialUndoFlag","parent","getParent","children","child","setEnabled","outputConnection","previousConnection","isDragging","gesture","longPid_","handleRightClick","LONGPRESS","clearTimeout","touchIdentifier_","PointerEvent","pointerId","identifier","node","thisObject","func","opt_noCaptureIdentifier","wrapFunc","call","bindData","TOUCH_MAP","addEventListener","callback","pop","removeEventListener","target","isContentEditable","getAttribute","HTMLInputElement","HTMLTextAreaElement","ctrlKey","MAC","button","matrix","svgPoint","createSVGPoint","x","clientX","y","clientY","getScreenCTM","inverse","matrixTransform","deltaMode","deltaX","deltaY","LINE_MODE_MULTIPLIER","PAGE_MODE_MULTIPLIER","arr","value","cssContent","injected","content","hasCss","pathToMedia","mediaPath","replace","cssNode","document","createElement","cssTextNode","createTextNode","appendChild","head","insertBefore","firstChild","deprecationDate","deletionDate","opt_use","previousWarnings","has","add","attrs","opt_parent","createElementNS","SVG_NS","className","classNames","split","every","classList","contains","remove","parentNode","removeChild","newNode","refNode","siblingNode","nextSibling","transform","style","cacheReference","cacheWidths","textElement","textContent","baseVal","getComputedTextLength","fontSize","fontWeight","fontFamily","text","canvasContext","computeCanvas","body","getContext","font","measureText","span","display","position","top","left","result","baseline","alignItems","offsetTop","originalDisplay","originalVisibility","visibility","originalPosition","Size","property","styles","window","getPropertyValue","el","pos","Coordinate","box","getBoundingClientRect","documentElement","scrollCoord","pageXOffset","scrollLeft","pageYOffset","scrollTop","parseFloat","right","bottom","Rect","container","opt_center","offset","elementPos","containerPos","containerBorder","relX","relY","elementSize","spaceX","clientWidth","spaceY","clientHeight","Math","min","max","xy","parseInt","r","match","XY_REGEX","Number","styleComponents","XY_STYLE_REGEX","scrollOffset","win","ws","screenCoordinates","screenX","screenY","boundingRect","getInjectionDiv","injectionDiv","clientOffsetPixels","mainOffsetPixels","getOriginOffsetInPixels","difference","finalOffsetPixels","finalOffsetMainWs","workspaceCoordinates","mainOffset","dependencies","DOMParser","XMLSerializer","domParser","xmlSerializer","tagName","NAME_SPACE","textToDom","doc","parseFromString","getElementsByTagName","nodeName","dom","serializeToString","INVALID_CONTROL_CHARS","charCodeAt","toolboxDef","Element","toolboxJson","toolboxKind","toolboxContents","FLYOUT_TOOLBOX_KIND","CATEGORY_TOOLBOX_KIND","flyoutDef","isArray","nodeType","categories","item","toUpperCase","categoryInfo","contents","Node","childNodes","obj","j","attributes","attr","parsedToolboxDef","TypeError","size","horizontalPadding","verticalPadding","metrics","hasVerticalScrollbar","scrollbar","canScrollVertically","horizontal","horizontalPosition","LEFT","absoluteMetrics","RTL","Scrollbar","scrollbarThickness","viewMetrics","vertical","verticalPosition","TOP","canScrollHorizontally","toolboxMetrics","hPosition","Position","horizontalLayout","RIGHT","vPosition","BOTTOM","startRect","margin","bumpDir","savedPositions","otherEl","intersects","bumpDirection","UP","message","opt_callback","alertImplementation","alertFunction","confirmImplementation","confirmFunction","defaultValue","promptImplementation","promptFunction","param","getVariableModel","getProcedureDef","getProcedureCall","renameProcedure","allUsedVarModels","getAllBlocks","variables","blockVariables","getVarModels","variable","getId","values","allDeveloperVariables","getDeveloperVariables","devVars","xmlList","registerButtonCallback","getTargetWorkspace","blockList","variableModelList","getVariablesOfType","mostRecentVariable","sort","VariableModel","compareByName","VAR_LETTER_OPTIONS","charAt","getAllVariableNames","startChar","usedNames","letters","suffix","letterIndex","inUse","potName","opt_type","promptAndCheckWithAlert","defaultName","Msg","existing","renameVariable","promptText","newName","procedure","renameVariableById","defaultText","newVar","allVariables","getVariableMap","getAllVariables","oldName","getProcedureMap","getProcedures","procedures","params","getParameters","procHasOld","some","procHasNew","getName","def","blockHasOld","blockHasNew","variableModel","field","getOrCreateVariablePackage","opt_name","getVariable","potentialVariableMap","getPotentialVariableMap","getVariableById","isFlyout","targetWorkspace","originalVariables","allCurrentVariables","addedVariables","paster","PASTER","Promise","resolve","afterRendersPromise","afterRendersResolver","animationRequestId","cancelAnimationFrame","JavaFx","dirtyBlocks","rootBlocks","b","resizeContents","blockOrigin","getRelativeToSurfaceXY","updateComponentLocations","delete","getChildren","isDisposed","renderEfficiently","opt_noId","treeXml","variablesElement","hasChildNodes","comments","getTopComments","comment","toXmlWithXY","getTopBlocks","variableList","isInsertionMarker","DocumentFragment","getWidth","round","toXml","inputList","input","fieldRow","fieldDom","isShadow","mutationToDom","mutation","hasAttributes","commentText","getCommentText","getIcon","IconType","COMMENT","getBubbleSize","pinned","bubbleIsVisible","commentElement","data","dataElement","empty","inputTypes","DUMMY","END_ROW","childBlock","connection","targetBlock","VALUE","STATEMENT","childShadow","getShadowDom","childElem","NodeType","ELEMENT_NODE","inputsInline","inputsInlineDefault","isCollapsed","isDeletable","isMovable","isEditable","nextElem","nextShadow","nextConnection","shadow","cloneNode","textNode","removeAttribute","TEXT_NODE","lines","blob","indent","substring","xml","setResizesEnabled","clear","blockIds","domToWorkspace","newBlockIds","existingGroup","variablesFirst","xmlChild","xmlChildElement","blockX","blockY","isNaN","rendered","WorkspaceCommentSvg","fromXmlRendered","WorkspaceComment","fromXml","FINISHED_LOADING","getBlocksBoundingBox","bbox","farY","topX","newLeftX","Infinity","newRightX","newY","blockXY","offsetY","ySeparation","offsetX","domToBlock","xmlBlock","variablesBeforeCreation","topBlock","topBlockSvg","setConnectionTracking","initSvg","disposed","initModel","newVariables","thisVariable","VAR_CREATE","xmlVariables","childNodeMap","next","xmlChildren","shouldCallInitSvg","domToMutation","setCommentText","setBubbleSize","setBubbleVisible","xmlNode","childBlockElement","childShadowElement","prototypeName","getInput","childBlockInfo","setShadowDom","isConnected","parentConnection","connectedToParentNext","outerHTML","newBlock","xmlChildNameMap","connect","inline","setInputsInline","deletable","setDeletable","movable","setMovable","editable","setEditable","collapsed","setCollapsed","setShadow","fieldName","getField","saveState","loadState","serializer","SERIALIZER","addCoordinates","addInputBlocks","addNextBlocks","doFullSerialization","saveIds","isOwnDeletable","isOwnMovable","isOwnEditable","extraState","icons","icon","getIcons","getType","fields","inputs","connectionState","getShadowState","prevRecordUndo","BLOCK_CREATE","blockSvg","MissingBlockType","getSourceBlock","RealChildOfShadow","childConnection","MissingConnection","connected","checker","connectionChecker","BadConnectionCheck","getErrorMessage","canConnectWithReason","iconTypes","iconType","iconState","constructor","ICON","UnregisteredIcon","addIcon","fieldState","inputName","setShadowState","onLocationChange","snapRadius","config","coord","otherCoords","otherBlock","sum","translate","otherCoord","abs","getConnections_","closest","toCopy","toCopyData","stashedCopyData","stashedWorkspace","copyData","coordinate","getRootWorkspace","toDuplicate","roleName","ROLE_ATTRIBUTE","stateName","ARIA_PREFIX","containerDiv","newDiv","querySelector","containerClassName","newOwner","rtl","newDispose","owner","direction","rendererClassName","getRenderer","getClassName","themeClassName","getTheme","markFocused","oldOwner","viewportBBox","anchorBBox","widgetSize","currentBlock","dummyOwner","menu","menu_","focus","Menu","Role","MENU","option","menuItem","MenuItem","setRightToLeft","MENUITEM","addChild","enabled","onAction","actionHandler","scope","menuSize","menuDom","render","preventDefault","stopPropagation","callbackFactory","select","deleteOption","duplicateOption","wsCommentOption","wsCommentOption.callback","DEFAULT_SIZE","finalOffset","angleDegrees","PI","angleRadians","lowerBound","number","upperBound","temp","arrow","opacity","transition","ANIMATION_TIME","boundsElem","boundsElement","backgroundColour","borderColour","backgroundColor","borderColor","opt_onHide","opt_secondaryYOffset","positionToField","getSvgRoot","scaledHeight","scaledWidth","bBox","getScaledBBox","primaryX","primaryY","secondaryY","sourceBlock","secondaryX","onHide","renderedClassName","boundsInfo","divSize","xCoords","initialX","divX","initialY","finalX","finalY","PADDING_Y","arrowX","arrowY","ARROW_SIZE","BORDER_SIZE","arrowAtTop","arrowVisible","sourceX","boundsLeft","boundsRight","divWidth","relativeArrowX","horizPadding","ARROW_HORIZONTAL_PADDING","divOwner","opt_withoutAnimation","animateOutTimer","getPositionMetrics","floor","svgGroup","getAudioManager","play","getSvgXY","clone","cloneRect","Date","rect","start","workspaceScale","percent","getTime","ripple","Svg","CIRCLE","scaleAnimation","ANIMATE","opacityAnimation","beginElement","getHeightWidth","magnitude","atan","DISPLACEMENT","wobblingBlock","DURATION","skew","val","sin","WIGGLES","disconnectPid","getTranslation","str","prefix","array","reduce","a","opt_shortest","wordPrefix","len","letter","substr","wrap","limit","words","score","lastText","lineCount","lastScore","wordBreaks","steps","insertedBreaks","lineLengths","linePunctuation","maxLength","pow","bestScore","bestBreaks","mutatedWordBreaks","mutatedScore","isNumber","test","customFn","customTooltip","visible","object","tooltip","mouseOverWrapper_","mouseOutWrapper_","blocked","newElement","currentTarget","poisonedElement","mouseOutPid","_e","showPid","dx","lastX","pageX","dy","lastY","pageY","sqrt","RADIUS_OK","HOVER_MS","tip","LIMIT","windowWidth","windowHeight","anchorX","OFFSET_X","anchorY","OFFSET_Y","scrollY","MARGINS","scrollX","source","hsvSaturation","newSaturation","hsvValue","hex","names","rgb","g","colour","h","s","v","red","green","blue","sextant","remainder","val1","val2","val3","colour1","colour2","factor","hex1","hex2","rgb1","rgb2","hue","parseInterpolationTokens","tokenizeNewlines","tokens","chars","buffer","c","rawKey","keyUpper","bklyKey","rawValue","prototype","mergedTokens","interpolatedResult","validSoFar","msgTable","m","msgKey","dereferenced","errorMsg","getProcedureModel","doProcedureUpdate","isProcedureDef","startPublishing","stopPublishing","fieldClass","fieldObject","hasImages","trimmedOptions","label","imageLabel","alt","stringLabels","shortest","prefixLength","suffixLength","foundError","tuple","error","src","initFn","allExtensions","registerMixin","mixinObj","mixin","registerMutator","opt_helperFn","opt_blockList","errorPrefix","hasMutatorDialog","setMutator","MutatorIcon","isMutator","extensionFn","mutatorProperties","mutationName","properties","compose","decompose","func1","func2","hasXmlHooks","hasJsonHooks","oldProperties","newProperties","fn","readyState","readyStateCheckInterval","setInterval","clearInterval","buildTooltipForDropdown","dropdownName","lookupTable","blockTypesChecked","setTooltip","getFieldValue","dropdown","FieldDropdown","isOptionListDynamic","getOptions","buildTooltipWithFieldText","msgTemplate","getText","tooltipWhenNotConnected","getInputsInline","command","points","flags","radius","iconConstructor","root","proceduresNoReturn","p","getReturnTypes","pa","getBlocksByType","forEach","proceduresReturn","ta","tb","localeCompare","sensitivity","findLegalName","isInFlyout","opt_exclude","Names","equals","excludeModel","model","rename","UnattachedFieldError","legalName","setName","getValue","procedureBlock","populateProcedures","procedureList","templateName","args","arg","nameField","xmlElement","argBlock","argValue","DEFAULT_ARG","fieldContent","updateToolbox","bubbleType","isOpen","TYPE","getWorkspace","addChangeListener","BLOCK_DELETE","BLOCK_CHANGE","BLOCK_FIELD_INTERMEDIATE_CHANGE","procName","mutateCallers","defBlock","oldRecordUndo","callers","caller","oldMutation","oldMutationDom","newMutationDom","newMutation","getDefinition","shape","isDynamic","pathDown","pathUp","pathLeft","pathRight","topConnection","first","second","targetConnection","orphanBlock","foundConnection","output","typeChecker","getConnectionChecker","canConnect","startBlock","rendererClass","RENDERER","theme","opt_rendererOverrides","renderer","firstVariable","ShortcutRegistry","registry","escapeAction","ESCAPE","preconditionFn","readOnly","keyCodes","KeyCodes","ESC","deleteShortcut","DELETE","Gesture","inProgress","checkAndDelete","BACKSPACE","ctrlC","createSerializedKey","C","CTRL","altC","ALT","metaC","META","copyShortcut","COPY","copyWorkspace","ctrlX","X","altX","metaX","cutShortcut","CUT","BlockSvg","ctrlV","V","altV","metaV","pasteShortcut","PASTE","ctrlZ","Z","altZ","metaZ","undoShortcut","UNDO","undo","ctrlShiftZ","SHIFT","altShiftZ","metaShiftZ","ctrlY","Y","redoShortcut","REDO","proc","returnTypes","parameters","getTypes","types","procedureModelClass","parameterModelClass","setReturnTypes","entries","insertParameter","setTypes","serializerMap","deserializers","priority","WorkspaceSvg","deserializer","pluginState","bounds","objectMetrics","getBoundingRectangle","newYPosition","leftClamp","rightClamp","newXPosition","metricsManager","getMetricsManager","hasFixedEdges","BUMP_EVENTS","scrollMetricsInWsCoords","getScrollMetrics","wasBumped","BLOCK_MOVE","getRootBlock","COMMENT_CREATE","COMMENT_MOVE","getCommentById","commentId","topBlocks","getTopBoundedElements","dragIconData","location","relativeCoords","ContextMenuRegistry","undoOption","displayText","scopeType","ScopeType","WORKSPACE","weight","redoOption","getRedoStack","cleanOption","cleanUp","shouldCollapse","timeoutFn","timeoutCounter","ms","DELAY","collapseOption","collapse","expandOption","deleteList","eventGroup","shift","isDeadOrDying","deletableBlocksLength","cancelCurrentGesture","deletableBlocks","ok","isDuplicatable","BLOCK","commentOption","hasIcon","CommentIcon","inlineOption","StatementInput","collapseExpandOption","disableOption","getInheritedDisabled","descendantCount","helpOption","url","helpUrl","showHelp","opt_options","containerElement","getElementById","ownerDocument","Options","subContainer","tabIndex","State","LABEL","SVG","HTML_NS","XLINK_NS","defs","DEFS","rnd","random","gridPattern","Grid","gridOptions","wsOptions","zoomOptions","startScale","languageTree","flyout","addFlyout","hasTrashcan","addTrashcan","controls","addZoomControls","getThemeManager","subscribe","workspaceResizeHandler","hideComponents","setResizeHandlerWrapper","toolbox","getToolbox","getFlyout","scrollToStart","trashcan","zoomControls_","moveOptions","scrollbars","ScrollbarPair","setMetrics","hasSounds","documentEventsBound","updateInverseScreenCTM","IPAD","unbindSounds","soundBinds","oldSoundBinding","audioMgr","preload","initView","getWeight","applyColour","hideForInsertionMarker","updateEditable","updateCollapsed","isShownWhenCollapsed","setOffsetInBlock","onClick","toolboxItem","isSelectable","opt_onlyClosePopups","CONNECTION_CHECKER","CONNECTION_PREVIEWER","CURSOR","INPUT","TOOLBOX","THEME","TOOLBOX_ITEM","FLYOUTS_VERTICAL_TOOLBOX","FLYOUTS_HORIZONTAL_TOOLBOX","METRICS_MANAGER","BLOCK_DRAGGER","$jscomp$tmp$exports$module$name","draggingConnections","soup","soupLength","VAR_DELETE","VAR_RENAME","BLOCK_DRAG","SELECTED","MARKER_MOVE","TRASHCAN_OPEN","TOOLBOX_ITEM_SELECT","THEME_CHANGE","COMMENT_DELETE","COMMENT_CHANGE","Abstract","toJson","isBlank","run","_forward","getEventWorkspace_","UiBase","AbstractEvent","opt_workspaceId","Click","opt_block","opt_targetType","targetType","newEvent","ClickTarget","ZOOM_CONTROLS","TOUCH_ENABLED","globalThis","rawUserAgent","isJavaFx","isWebKit","isGecko","isAndroid","isIPad","isIPhone","isMac","isTablet","isMobile","raw","rawUpper","maxTouchPoints","GECKO","ANDROID","IPHONE","MOBILE","Capability","name_","POSITIONABLE","DRAG_TARGET","DELETE_AREA","AUTOHIDEABLE","ComponentManager","componentData","Map","capabilityToComponentIds","addComponent","componentInfo","component","capabilities","set","stringCapabilities","capability","removeComponent","addCapability","getComponent","hasCapability","removeCapability","getComponents","sorted","componentIds","components","componentDataList","componentDatum","tx","ty","distance","COMMENT_NODE","CLIPPATH","FECOMPOSITE","FECOMPONENTTRANSFER","FEFLOOD","FEFUNCA","FEGAUSSIANBLUR","FEPOINTLIGHT","FESPECULARLIGHTING","FILTER","FOREIGNOBJECT","G","IMAGE","LINE","PATH","PATTERN","POLYGON","RECT","TEXT","TSPAN","getHeight","other","opt_pair","opt_class","opt_margin","oldHostMetrics","ratio","origin","startDragHandle","handlePosition","handleLength","scrollbarLength","startDragMouse","containerVisible","isHandleVisible","onMouseMoveWrapper_","onMouseUpWrapper_","pair","DEFAULT_SCROLLBAR_MARGIN","outerSvg","svgBackground","svgHandle","setInitialThickness","lengthAttribute_","positionAttribute_","onMouseDownBarWrapper_","onMouseDownBar","onMouseDownHandleWrapper_","onMouseDownHandle","unsubscribe","constrainHandleLength","setHandleLength","newLength","constrainHandlePosition","setHandlePosition","newPosition","setScrollbarLength","newSize","setPosition","opt_metrics","hostMetrics","getMetrics","metricsAreEquivalent","resizeHorizontal","resizeVertical","updateMetrics","requiresViewResize","viewWidth","viewHeight","absoluteLeft","absoluteTop","resizeViewHorizontal","resizeContentHorizontal","viewSize","xCoordinate","scrollWidth","setVisible","maxScrollDistance","maxHandleOffset","handleOffset","resizeViewVertical","resizeContentVertical","scrollHeight","setContainerVisible","visibilityChanged","updateDisplay_","setVisibleInternal","mouseXY","getInverseScreenCTM","mouseLocation","handleXY","handleStart","pageLength","onMouseUpHandle","onMouseMoveHandle","currentMouse","getRatio_","setOrigin","DOWN","SPRITE","ZoomControls","boundEvents","zoomResetGroup","zoomOutGroup","zoomInGroup","HEIGHT","WIDTH","SMALL_SPACING","LARGE_SPACING","MARGIN_HORIZONTAL","MARGIN_VERTICAL","initialized","createZoomOutSvg","createZoomInSvg","createZoomResetSvg","getComponentManager","cornerPosition","positionRect","zoomInTranslateY","zoomOutTranslateY","clip","zoomoutSvg","setAttributeNS","zoom","zoominSvg","amount","zoomCenter","fireZoomEvent","zoomresetSvg","resetZoom","log","scaleSpeed","beginCanvasTransition","scrollCenter","endCanvasTransition","uiEvent","MUTATOR","WARNING","CUSTOM","setLocale","locale","k","VarBase","opt_variable","varId","VarCreate","varType","varName","deleteVariableById","opt_id","id_","var1","var2","CATEGORY_NAME","disposed_","isComment","addTopComment","xy_","height_","width_","content_","fireCreateEvent","removeTopComment","setHeight","setWidth","recordNew","getContent","setContent","xmlComment","info","parseAttributes","w","xmlX","xmlY","commentX","NaN","commentY","xmlH","xmlW","xmlId","Selected","opt_oldElementId","opt_newElementId","oldElementId","newElementId","WorkspaceCommentPaster","commentState","RESIZE_SIZE","BORDER_RADIUS","TEXTAREA_OFFSET","onMouseMoveWrapper","onMouseUpWrapper","eventsInit","deleteIconBorder","deleteGroup","resizeGroup","foreignObject","svgHandleTarget","svgRectTarget","textarea","autoLayout","focused","svgRect_","unselect","opt_noSelect","pathMouseDown","updateMovable","getBubbleCanvas","getGesture","handleBubbleStart","showContextMenu","oldId","addSelect","removeSelect","blurFocus","setFocus","addFocus","removeFocus","layerManger","getLayerManager","hasLayer","moveDuringDrag","newLoc","translation","clearTransformAttributes","commentBounds","setDragging","adding","setDeleteStyle","setAutoLayout","_enable","createEditor","addResizeDom","addDeleteDom","setSize","resizeMouseDown","deleteMouseDown","deleteMouseOut","deleteMouseUp","TOP_OFFSET","unbindDragEvents","startDrag","resizeMouseUp","resizeMouseMove","newXY","moveDrag","resizeComment","topOffset","textOffset","blur","opt_wsWidth","wsWidth","WeakSet","DeserializationError","toDevString","childState","VARIABLES","PROCEDURES","BLOCKS","saveBlock","BlockSerializer","blockStates","BlockBase","BlockCreate","allShadowBlocks","shadows","ThemeChange","opt_themeName","themeName","ViewportChange","opt_top","opt_left","opt_scale","opt_oldScale","DEFAULT_SNAP_RADIUS","dragRadius","flyoutDragRadius","connectingSnapRadius","currentConnectionPreference","bumpDelay","ConnectionType","INPUT_VALUE","OUTPUT_VALUE","NEXT_STATEMENT","PREVIOUS_STATEMENT","ConnectionDB","connections","addConnection","yPos","calculateIndexForYPos","findIndexOfConnection","conn","bestGuess","pointer","pointerMin","pointerMax","pointerMid","removeConnection","getNeighbours","maxRadius","checkConnection","yIndex","currentX","db","currentY","neighbours","isInYRange","baseY","searchForClosest","dxy","baseX","closestIndex","bestConnection","bestRadius","distanceFrom","dbList","BlockPaster","isCapacityAvailable","typeCounts","blockState","GRID","GRIDCELL","GROUP","LISTBOX","MENUITEMCHECKBOX","OPTION","PRESENTATION","ROW","TREE","TREEITEM","menuItems","onKeyDownHandler","mouseLeaveHandler","mouseEnterHandler","clickHandler","mouseOverHandler","highlightedItem","openingCoords","handleMouseOver","handleClick","handleMouseEnter","handleMouseLeave","handleKeyEvent","getElement","preventScroll","getMenuItem","menuElem","currentElement","setHighlighted","currentHighlighted","ACTIVEDESCENDANT","highlightNext","highlightHelper","highlightPrevious","highlightFirst","highlightLast","startIndex","delta","oldCoords","newCoords","performAction","shiftKey","metaKey","altKey","highlighted","opt_value","rightToLeft","highlight","checked","checkable","checkbox","contentDom","DISABLED","setCheckable","setChecked","nameDep","registry_","reset","getContextMenuOptions","menuOptions","precondition","menuOption","getBoundsInfo","boundPosition","boundSize","clientTop","BUBBLE","BubbleDragger","bubble","dragTarget_","wouldDeleteBubble_","startXY_","startBubbleDrag","moveToDragLayer","dragBubble","currentDragDeltaXY","pixelsToWorkspaceUnits_","oldDragTarget","getDragTarget","oldWouldDeleteBubble","shouldDelete_","updateCursorDuringBubbleDrag_","onDragExit","onDragEnter","onDragOver","dragTarget","componentManager","isDeleteArea","wouldDelete","endBubbleDrag","shouldPreventMove","onDrop","fireMoveEvent_","moveOffDragLayer","setOldCoordinate","pixelCoord","COLLAPSE_CHARS","DRAG_STACK","OPPOSITE_TYPE","RENAME_VARIABLE_ID","DELETE_VARIABLE_ID","WorkspaceDragger","horizontalScrollEnabled_","isMovableHorizontally","verticalScrollEnabled_","isMovableVertically","startScrollXY_","endDrag","drag","scroll","ZOOM_IN_MULTIPLIER","ZOOM_OUT_MULTIPLIER","creatorWorkspace","mouseDownXY","startWorkspace_","startIcon","startField","startBubble","hasExceededDragRadius","workspaceDragger","blockDragger","bubbleDragger","isMultiTouch_","isEnding_","gestureHasStarted","calledUpdateIsDragging","cachedPoints","startDistance","previousScale","currentDropdownOwner","isPinchZoomEnabled","mostRecentEvent","healStack","clearGesture","updateFromEvent","currentXY","updateDragDelta","changed","updateIsDragging","currentDragDelta","limitRadius","updateIsDraggingFromFlyout","isBlockCreatable","isScrollable","isDragTowardWorkspace","updateScreenCalculationsIfScrolled","createBlock","updateIsDraggingBubble","startDraggingBubble","updateIsDraggingBlock","startDraggingBlock","updateIsDraggingWorkspace","wsMovable","isDraggable","BlockDraggerClass","doStart","pinch","cancel","pointerType","handleTouchStart","handleMove","handleUp","isMultiTouch","handleTouchMove","handleTouchEnd","isBubbleClick","doBubbleClick","isFieldClick","doFieldClick","isIconClick","doIconClick","isBlockClick","doBlockClick","isWorkspaceClick","doWorkspaceClick","getTouchPoint","pointers","point0","point1","handlePinch","moveDistance","gestureScale","bringBlockToFront","handleWsStart","setStartWorkspace","fireWorkspaceClick","handleFlyoutStart","setStartFlyout","handleBlockStart","setStartBlock","setStartBubble","showEditor","autoClose","scheduleSnapAndBump","bringToFront","setStartField","setStartIcon","setTargetBlock","hasStartBubble","hasStartBlock","isClickable","isClickableInFlyout","handleInFlyout","hasStarted","getInsertionMarkers","getCurrentDragger","currentGesture_","pattern","spacing","line2","line1","snapToGrid","setSpacing","update","setLength","setSnapToGrid","snap","shouldSnap","getSpacing","getPatternId","safeSpacing","half","end","setLineAttributes","x1","x2","y1","y2","MarkerManager","cursorSvg_","cursor_","markers","markerSvg_","registerMarker","marker","unregisterMarker","setDrawer","makeMarkerDrawer","setMarkerSvg","getDrawer","getCursor","getMarker","setCursor","cursor","drawer","setCursorSvg","cursorSvg","getBlockCanvas","markerSvg","updateMarkers","keyboardAccessibilityMode","draw","markerIds","markerId","LOCAL_MARKER","Theme","opt_blockStyles","opt_categoryStyles","opt_componentStyles","startHats","blockStyles","categoryStyles","componentStyles","fontStyle","setBlockStyle","blockStyleName","blockStyle","setCategoryStyle","categoryStyleName","categoryStyle","getComponentStyle","componentName","recursiveStyle","setComponentStyle","styleValue","setFontStyle","setStartHats","defineTheme","themeObj","base","defaultBlockStyles","Classic","toolboxJsonDef","hasCollapse","hasComments","hasDisable","rawHasTrashcan","rawHasCollapse","rawHasComments","rawHasDisable","rawHasSounds","maxTrashcanContents","toolboxAtStart","toolboxPosition","endsWith","rawOneBasedIndex","modalInputs","oneBasedIndex","maxBlocks","maxInstances","parseMoveOptions_","hasScrollbars","parseGridOptions_","parseZoomOptions_","parseThemeOptions_","rendererOverrides","move","wheel","maxScale","minScale","grid","BlockChange","opt_element","opt_oldValue","opt_newValue","oldValue","setValue","oldState","getExtraBlockState_","JSON","stringify","Field","validator","DEFAULT_VALUE","constants_","mouseDownWrapper_","textContent_","textElement_","borderRect_","fieldGroup_","tooltip_","validator_","maxDisplayLength","sourceBlock_","enabled_","visible_","isDirty_","suffixField","prefixField","clickTarget_","EDITABLE","SERIALIZABLE","value_","size_","SKIP_SETUP","configure_","setValidator","setSourceBlock","getConstants","bindEvents_","createBorderRect_","createTextElement_","isFullBlockField","FIELD_BORDER_RECT_RADIUS","FIELD_TEXT_BASELINE_CENTER","clickTarget","getClickTarget_","onMouseDown_","fieldElement","_doFullSerialization","legacyState","saveLegacyState","loadLegacyState","callingClass","showEditor_","autoClosingFlyout","isCurrentlyEditable","handler","getValidator","getBorderRect","getTextElement","getTextContent","render_","nodeValue","getDisplayText_","updateSize_","constants","xOffset","FIELD_BORDER_RECT_X_PADDING","totalWidth","totalHeight","FIELD_TEXT_HEIGHT","contentWidth","FIELD_TEXT_FONTSIZE","FIELD_TEXT_FONTWEIGHT","FIELD_TEXT_FONTFAMILY","FIELD_BORDER_RECT_HEIGHT","positionTextElement_","positionBorderRect_","halfHeight","FIELD_TEXT_BASELINE","getAbsoluteXY_","_","NBSP","getText_","markDirty","forceRerender","bumpNeighbours","fireChangeEvent","classValidation","doClassValidation_","classValue","processValidation_","localValidation","localValue","doValueUpdate_","validatedValue","doValueInvalid_","_invalidValue","newTip","getTooltip","referencesVariables","refreshVariableName","getParentInput","parentInput","idx","fieldRows","getFlipRtl","isTabNavigable","onShortcut","_shortcut","updateMarkers_","Symbol","reservedWordsList","opt_variablePrefix","dbReverse","variableMap","variablePrefix","reservedWords","setVariableMap","getNameForUserVariable","populateVariables","NameType","VARIABLE","nameOrId","normalizedName","DEVELOPER_VARIABLE","typeDb","safeName","getDistinctName","getUserNames","userNames","encodeURI","name1","name2","PROCEDURE","DEVELOPER_VARIABLE_TYPE","ObservableProcedureMap","existed","Icon","offsetInBlock","workspaceLocation","svgRoot","pointerdownListener","svgBlock","updateSvgRootOffset","menuGenerator","svgArrow","imageElement","selectedMenuItem","generatedOptions","trimmed","menuGenerator_","selectedOption","shouldAddBorderRect_","FIELD_DROPDOWN_SVG_ARROW","createSVGArrow_","createTextArrow_","FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW","ARROW_CHAR","FIELD_DROPDOWN_SVG_ARROW_SIZE","FIELD_DROPDOWN_SVG_ARROW_DATAURI","dropdownCreate","menuElement","FIELD_DROPDOWN_COLOURED_DIV","primaryColour","getColour","colourTertiary","dropdownDispose_","image","Image","handleMenuActionEvent","onItemSelected_","useCache","isValueValid","fill","colourSecondary","colourPrimary","renderSelectedImage","renderSelectedText","imageJson","imageHeight","imageWidth","hasBorder","FIELD_DROPDOWN_BORDER_RECT_HEIGHT","IMAGE_Y_PADDING","xPadding","arrowWidth","positionSVGArrow","textWidth","textPadding","FIELD_DROPDOWN_SVG_ARROW_PADDING","svgArrowSize","CHECKMARK_OVERHANG","MAX_MENU_HEIGHT_VH","IMAGE_Y_OFFSET","_a","Bubble","anchor","ownerRect","relativeLeft","relativeTop","embossGroup","embossFilterId","tail","background","BORDER_WIDTH","contentContainer","onMouseDown","setAnchorLocation","relayout","positionByRect","positionRelativeToAnchor","renderTail","setPositionRelativeToAnchor","MIN_SIZE","getViewMetrics","optimalLeft","getOptimalRelativeLeft","optimalTop","getOptimalRelativeTop","topPosition","MIN_BLOCK_HEIGHT","startPosition","endPosition","bottomPosition","closerPosition","fartherPosition","topPositionOverlap","getOverlap","startPositionOverlap","closerPositionOverlap","fartherPositionOverlap","mostOverlap","relativeMin","workspaceRect","getWorkspaceViewRect","bubbleRight","bubbleLeft","getScrollbarThickness","relBubbleX","relBubbleY","relAnchorX","relAnchorY","rise","hypotenuse","angle","acos","rightAngle","rightRise","rightRun","cos","thickness","TAIL_THICKNESS","backoffRatio","ANCHOR_RADIUS","baseX1","baseY1","baseX2","baseY2","radians","TAIL_ANGLE","swirlAngle","swirlRise","TAIL_BEND","swirlRun","lastChild","_start","DOUBLE_BORDER","MiniWorkspaceBubble","workspaceOptions","validateWorkspaceOptions","svgDialog","miniWorkspace","newWorkspaceSvg","internalIsMutator","getCanvas","onWorkspaceChange","updateBubbleSize","addWorkspaceChangeListener","listener","bumpBlocksIntoBounds","MARGIN","currSize","calculateWorkspaceSize","MINIMUM_VIEW_CHANGE","recordDragTargets","workspaceSize","getBBox","flyoutScrollMetrics","updateBlockStyles","setStyle","getStyleName","flyoutWs","SIZE","WORKSPACE_MARGIN","flyoutBlockTypes","saveConnectionsListener","updateWorkspacePid","rootBlock","miniWorkspaceBubble","WEIGHT","getAnchorLocation","getMiniWorkspaceConfig","getBubbleOwnerRect","createRootBlock","addSaveConnectionsListener","createMiniWorkspaceChangeListener","removeChangeListener","midIcon","flyoutWidth","saveConnections","this.saveConnectionsListener","isIgnorableMutatorEvent","recomposeSourceBlock","oldExtraState","newExtraState","reconnect","connectionChild","findParentWs","WIN_KEY_FF_LINUX","MAC_ENTER","TAB","NUM_CENTER","ENTER","PAUSE","CAPS_LOCK","SPACE","PAGE_UP","PAGE_DOWN","END","HOME","PLUS_SIGN","PRINT_SCREEN","INSERT","ZERO","ONE","TWO","THREE","FOUR","FIVE","SIX","SEVEN","EIGHT","NINE","FF_SEMICOLON","FF_EQUALS","FF_DASH","FF_HASH","QUESTION_MARK","AT_SIGN","A","B","D","E","F","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","W","WIN_KEY_RIGHT","CONTEXT_MENU","NUM_ZERO","NUM_ONE","NUM_TWO","NUM_THREE","NUM_FOUR","NUM_FIVE","NUM_SIX","NUM_SEVEN","NUM_EIGHT","NUM_NINE","NUM_MULTIPLY","NUM_PLUS","NUM_MINUS","NUM_PERIOD","NUM_DIVISION","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","NUMLOCK","SCROLL_LOCK","FIRST_MEDIA_KEY","LAST_MEDIA_KEY","SEMICOLON","DASH","EQUALS","COMMA","PERIOD","SLASH","APOSTROPHE","TILDE","SINGLE_QUOTE","OPEN_SQUARE_BRACKET","BACKSLASH","CLOSE_SQUARE_BRACKET","WIN_KEY","MAC_FF_META","MAC_WK_CMD_LEFT","MAC_WK_CMD_RIGHT","WIN_IME","VK_NONAME","PHANTOM","aria","arrayUtils","browserEvents","deprecation","extensions","idGenerator","math","parsing","stringUtils","svgMath","svgPaths","userAgent","TextBubble","paragraph","stringToSvg","setText","createParagraph","spans","createSpans","rightAlignSpans","tspan","maxWidth","TextInputBubble","resizePointerMoveListener","resizePointerUpListener","textChangeListeners","sizeChangeListeners","inputRoot","textArea","createResizeHandle","onTextChange","addTextChangeListener","addSizeChangeListener","bindTextAreaEvents","onStartEdit","onResizePointerDown","widthMinusBorder","heightMinusBorder","onSizeChange","onResizePointerUp","onResizePointerMove","DEFAULT_BUBBLE_WIDTH","DEFAULT_BUBBLE_HEIGHT","textBubble","textInputBubble","bubbleSize","bubbleVisiblity","anchorLocation","oldText","newText","showEditableBubble","showNonEditableBubble","hideBubble","WarningIcon","textMap","addMessage","DuplicateIconType","exceptions","TypesContainer","NONE","HAT","SPACER","BETWEEN_ROW_SPACER","IN_ROW_SPACER","EXTERNAL_VALUE_INPUT","INLINE_INPUT","STATEMENT_INPUT","CONNECTION","PREVIOUS_CONNECTION","NEXT_CONNECTION","OUTPUT_CONNECTION","CORNER","LEFT_SQUARE_CORNER","LEFT_ROUND_CORNER","RIGHT_SQUARE_CORNER","RIGHT_ROUND_CORNER","JAGGED_EDGE","TOP_ROW","BOTTOM_ROW","INPUT_ROW","LEFT_CORNER","RIGHT_CORNER","nextTypeValue_","hasOwnProperty","isField","isHat","isSpacer","isInRowSpacer","isInput","isExternalInput","isInlineInput","isStatementInput","isPreviousConnection","isNextConnection","isPreviousOrNextConnection","isLeftRoundedCorner","isRightRoundedCorner","isLeftSquareCorner","isRightSquareCorner","isCorner","isJaggedEdge","isRow","row","isBetweenRowSpacer","isTopRow","isBottomRow","isTopOrBottomRow","isInputRow","Types","Measurable","centerline","xPos","notchOffset","NOTCH_OFFSET_LEFT","Row","elements","widthWithConnectedBlocks","minWidth","minHeight","hasStatement","hasExternalInput","statementEdge","hasJaggedEdge","hasDummyInput","hasInlineInput","align","getLastInput","measure","startsWithElemSpacer","endsWithElemSpacer","getFirstSpacer","getLastSpacer","BottomRow","hasNextConnection","descenderHeight","hasLeftSquareCorner","hasRightSquareCorner","_block","Connection","connectionModel","shapeFor","isHighlighted","InputConnection","connectionOffsetY","connectionOffsetX","connectedBlock","connectedBlockWidth","connectedBlockHeight","ExternalValueInput","TAB_OFFSET_FROM_TOP","MEDIUM_PADDING","EXTERNAL_VALUE_INPUT_PADDING","connectionHeight","connectionWidth","flipRtl","Hat","START_HAT","ascenderHeight","InRowSpacer","SPACER_DEFAULT_HEIGHT","InlineInput","EMPTY_INLINE_INPUT_HEIGHT","EMPTY_INLINE_INPUT_PADDING","STATEMENT_BOTTOM_SPACER","EMPTY_STATEMENT_INPUT_HEIGHT","STATEMENT_INPUT_NOTCH_OFFSET","InputRow","connectedBlockWidths","JaggedEdge","JAGGED_TEETH","NextConnection","OutputConnection","startX","PreviousConnection","RoundCorner","opt_position","CORNER_RADIUS","SpacerRow","precedesStatement","followsStatement","SquareCorner","NO_PADDING","TopRow","capline","hasPreviousConnection","hasHat","hat","ADD_START_HATS","prevBlock","getPreviousBlock","ConstantProvider","SMALL_PADDING","MEDIUM_LARGE_PADDING","LARGE_PADDING","TAB_HEIGHT","TAB_VERTICAL_OVERLAP","TAB_WIDTH","NOTCH_WIDTH","NOTCH_HEIGHT","MIN_BLOCK_WIDTH","EMPTY_BLOCK_SPACER_HEIGHT","STATEMENT_INPUT_PADDING_LEFT","BETWEEN_STATEMENT_PADDING_Y","START_HAT_HEIGHT","START_HAT_WIDTH","JAGGED_TEETH_HEIGHT","JAGGED_TEETH_WIDTH","FIELD_BORDER_RECT_Y_PADDING","FIELD_BORDER_RECT_COLOUR","FIELD_COLOUR_FULL_BLOCK","FIELD_TEXTINPUT_BOX_SHADOW","FIELD_COLOUR_DEFAULT_WIDTH","embossFilter","disabledPatternId","disabledPattern","debugFilterId","debugFilter","CURSOR_COLOUR","MARKER_COLOUR","CURSOR_WS_WIDTH","WS_CURSOR_HEIGHT","CURSOR_STACK_PADDING","CURSOR_BLOCK_PADDING","CURSOR_STROKE_WIDTH","FULL_BLOCK_FIELDS","INSERTION_MARKER_COLOUR","INSERTION_MARKER_OPACITY","SHAPES","PUZZLE","NOTCH","TALL_INPUT_FIELD_OFFSET_Y","DUMMY_INPUT_SHADOW_MIN_HEIGHT","DUMMY_INPUT_MIN_HEIGHT","TOP_ROW_MIN_HEIGHT","TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT","BOTTOM_ROW_MIN_HEIGHT","BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT","START_POINT","FIELD_COLOUR_DEFAULT_HEIGHT","FIELD_CHECKBOX_X_OFFSET","randomIdentifier","makeJaggedTeeth","makeNotch","makeStartHat","PUZZLE_TAB","makePuzzleTab","INSIDE_CORNERS","makeInsideCorners","OUTSIDE_CORNERS","makeOutsideCorners","setTheme","validatedBlockStyle_","setDynamicProperties_","setFontConstants_","setComponentConstants_","fontMetrics","getBlockStyleForColour","createBlockStyle_","getBlockStyle","valid","assign","parsedColour","generateSecondaryColour_","generateTertiaryColour_","inputColour","mainPath","path","makeMainPath","up","back","control1Y","overlap","control2Y","endPoint1","endPoint2","dir","outerWidth","innerWidth","innerTopLeftCorner","innerBottomLeftCorner","pathTop","pathBottom","topLeft","topRight","bottomLeft","bottomRight","rightHeight","selector","injectCSS_","feSpecularLighting","createDebugFilter","debugComponentTransfer","cssArray","getCSS_","cssNodeId","Drawer","inlinePath_","outlinePath_","block_","info_","topLeft_","drawOutline_","drawInternals_","updateConnectionHighlights","pathObject","setPath","flipRTL","recordSizeOnBlock_","hideHiddenIcons_","widthWithChildren","drawTop_","rows","drawJaggedEdge_","drawStatementInput_","drawValueInput_","drawRightSideRow_","drawBottom_","drawLeft_","topRow","positionPreviousConnection_","startY","positionExternalValueConnection_","innerHeight","positionStatementInputConnection_","bottomRow","elems","positionNextConnection_","rightCornerYOffset","outlinePath","positionOutputConnection_","tabBottom","drawInlineInput_","layoutField_","fieldInfo","connectionTop","connectionBottom","positionInlineInputConnection_","connX","connInfo","drawConnectionHighlightPath","removeConnectionHighlight","measurable","getExpressionConnectionHighlightPath","getStatementConnectionHighlightPath","addConnectionHighlight","getOffsetInBlock","connPath","yLen","xLen","Align","CENTRE","FieldLabel","textClass","class","setClass","cssClass","Input","appendField","insertFieldAt","removeField","opt_quiet","renderList","renderedConnection","startTrackingAll","stopTrackingAll","setCheck","check","setAlign","makeConnection","makeConnection_","DummyInput","EndRowInput","ValueInput","RenderInfo","inputRows","renderer_","isInline","createRows_","addElemSpacing_","addRowSpacing_","computeBounds_","alignRowElements_","finalize_","populateTopRow_","activeRow","iconInfo","lastInput","shouldStartNewRow_","addInput_","populateBottomRow_","hasPrevious","cornerClass","leftSquareCorner","rightSquareCorner","StatementInputMeasurable","currInput","prevInput","oldElems","getInRowSpacing_","prev","widestStatementRowFields","blockWidth","widestRowWithConnectedBlocks","statementInput","alignStatementRow_","currentWidth","missingSpace","getDesiredRowWidth_","desiredWidth","addAlignmentPadding_","_row","firstSpacer","lastSpacer","oldRows","makeSpacerRow_","getSpacerRowHeight_","getSpacerRowWidth_","spacer","_prev","_next","getElemCenterline_","recordElemPositions_","xCursor","yCursor","getMeasureableForConnection","ASTNode","opt_params","wsCoordinate","isConnectionLocation","isConnectionType","processParams","getLocation","getWsCoordinate","isConnection","findNextForInput","curIdx","NAVIGATE_ALL_FIELDS","createFieldNode","createInputNode","findNextForField","fieldIdx","newInput","findPrevForInput","findPrevForField","navigateBetweenStacks","curLocation","curLocationAsBlock","curRoot","resultIndex","createStackNode","findTopASTNodeForBlock","createConnectionNode","createBlockNode","getOutAstNodeForBlock","getTopStackBlock","findFirstFieldOrInput","STACK","OUTPUT","PREVIOUS","NEXT","in","out","blockPos","DEFAULT_OFFSET_Y","createWorkspaceNode","createTopNode","astNode","MarkerMove","isCursor","opt_oldNode","opt_newNode","oldNode","CURSOR_CLASS","MARKER_CLASS","HEIGHT_MULTIPLIER","MarkerSvg","markerSvgRect_","markerSvgLine_","markerInput_","markerBlock_","svgGroup_","currentMarkerSvg","defaultColour","colour_","createDomInternal_","setParent_","curNode","applyColour_","showAtLocation_","fireMarkerEvent","animate","connectionType","curNodeAsConnection","showWithBlock_","showWithOutput_","showWithInput_","showWithNext_","showWithPrevious_","showWithField_","showWithCoordinates_","showWithStack_","showWithBlockPrevOutput","markerHeight","markerOffset","connectionShape","positionPrevious_","positionOutput_","positionBlock_","showCurrent_","positionLine_","positionRect_","positionInput_","heightWidth","yPadding","markerPath","curBlock","getBlinkProperties_","blinkProperties","attributeName","_curNode","firstElementChild","PathObject","connectionHighlights","WeakMap","highlightOffsets","svgPath","pathString","updateShadow_","updateDisabled_","setClass_","updateHighlighted","updateSelected","updateDraggingDelete","updateInsertionMarker","updateReplacementFade","updateShapeForInputHighlight","_conn","connectionPath","currentHighlightMatchesNew","newPath","newOffset","currPath","currOffset","shadowDom","shadowState","connect_","parentBlock","disconnectInternal","orphan","stashShadowState","applyShadowState","setReason","setParent","orphanConnection","getConnectionForOrphanedConnection","onFailedConnect","setShadowStateInternal","unplug","isSuperior","_otherConnection","otherConnection","disconnect","getParentAndChildConnections","respawnShadow_","createShadowBlock","connectionParent","currentParent","onCheckChanged_","getCheck","returnCurrent","_maxLimit","serializeShadow","attemptToConnect","blockShadow","lastConnectionInStack","CAN_CONNECT","REASON_SELF_CONNECTION","REASON_WRONG_TYPE","REASON_TARGET_NULL","REASON_CHECKS_FAILED","REASON_DIFFERENT_WORKSPACES","REASON_SHADOW_PARENT","REASON_DRAG_CHECKS_FAILED","REASON_PREVIOUS_AND_OUTPUT","COLLAPSED_INPUT_NAME","COLLAPSED_FIELD_NAME","DUPLICATE_BLOCK_ERROR","InsertionMarkerManager","activeCandidate","lastMarker","lastOnStack","wouldDeleteBlock","fadedBlock","highlightedBlock","markerConnection","firstMarker","createMarkerBlock","availableConnections","initAvailableConnections","disposeInsertionMarker","updateAvailableConnections","wouldConnectBlock","applyConnections","hidePreview","local","inferiorConnection","then","newCandidate","getCandidate","shouldDelete","shouldUpdatePreviews","maybeHidePreview","maybeShowPreview","imType","setInsertionMarker","sourceInput","resultInput","sourceField","resultField","available","activeLocal","activeClosest","xDiff","yDiff","curDistance","getStartRadius","candidate","myConnection","neighbour","showPreview","getConnectionPreviewMethod","method","PREVIEW_TYPE","INPUT_OUTLINE","showInsertionInputOutline","INSERTION_MARKER","showInsertionMarker","REPLACEMENT_FADE","showReplacementFade","shouldHighlightConnection","localChanged","unhighlight","hideReplacementFade","hideInsertionInputOutline","hideInsertionMarker","insertionMarker","isLastInStack","imConn","getMatchingConnection","originalOffsetToTarget","originalOffsetInBlock","imConnConst","positionNearConnection","markerConn","imBlock","markerOutput","markerPrev","highlightShapeForInput","fadeForReplacement","PreviewType","Renderer","overrides","makeConstants_","refreshDom","previousConstants","makeRenderInfo_","makeDrawer_","makePathObject","orphanCanConnectAtEnd","localType","ThemeManager","subscribedWorkspaces_","componentDB","prevTheme","oldClassName","newClassName","refreshTheme","componentList","propertyName","setProperty","subscribeWorkspace","unsubscribeWorkspace","onCreateVariableButtonClick_String","onCreateVariableButtonClick_Number","onCreateVariableButtonClick_Colour","ConnectionChecker","opt_distance","safety","doSafetyChecks","doTypeChecks","doDragChecks","errorCode","superiorBlock","inferiorBlock","superiorConnection","checkArrayOne","checkArrayTwo","canConnectToPrevious_","VarDelete","VarRename","VariableMap","deleteVariable","conflictVar","renameVariableWithConflict_","renameVariableAndUses_","updateVarName","renameVarById","variableId","tempVar","variableName","uses","getVariableUsesById","procedureName","deleteText","confirmText","deleteVariableInternal","list","getVariableTypes","variableTypes","flat","Workspace","internalIsFlyout","isClearing","MAX_UNDO","connectionDBList","topComments","commentDB","listeners","undoStack_","redoStack_","blockDB","typedBlocksDB","procedureMap","connectionCheckerClass","sortObjects_","SCAN_ANGLE","aXY","bXY","addTopBlock","removeTopBlock","ordered","addTypedBlock","removeTypedBlock","filtered","remainingCapacity","remainingCapacityOfType","maxInstanceOfType","hasBlockLimits","copyableBlocksCount","redo","inputStack","outputStack","inputEvent","clearUndo","setBlockById","removeBlockById","allInputsFilled","opt_shadowBlocksAreFilled","createPotentialVariableMap","outerWs","getById","getAll","SOUND_LIMIT","WorkspaceAudio","sounds","lastSound_","muted","filenames","audioTest","filename","ext","canPlayType","sound","volume","playPromise","pause","catch","opt_volume","now","mySound","setMuted","getMuted","LayerManager","layers","dragLayer","createDragLayer","blockLayer","createLayer","bubbleLayer","translateLayers","newCoord","newScale","layer","layerNum","getSvgGroup","inserted","sortedLayers","num","sib","getBlockLayer","getBubbleLayer","ZOOM_TO_FIT_MARGIN","resizeHandlerWrapper","resizesEnabled","isVisible_","startScrollY","startScrollX","dragDeltaXY","oldLeft","oldTop","inverseScreenCTM","dummyWheelListener","configureContextMenu","lastRecordedPageScroll","toolbox_","inverseScreenCTMDirty","highlightedBlocks","toolboxCategoryCallbacks","flyoutButtonCallbacks","cachedParentSvg","topBoundedElements","dragTargetAreas","layerManager","MetricsManagerClass","setTopLevelWorkspaceMetrics_","audioManager","markerManager","Variables","registerToolboxCategoryCallback","VariablesDynamic","Procedures","themeManager_","cachedParentSvgSize","getMarkerManager","setMetricsManager","updateBlockStyles_","refreshToolboxSelection","ctm","opt_backgroundClass","svgBackground_","svgBlockCanvas_","svgBubbleCanvas_","this.dummyWheelListener","onMouseWheel_","ToolboxClass","CursorClass","parentSvg","newTrashcan","svgTrashcan","_workspace","svgZoomControls","HorizontalFlyout","VerticalFlyout","opt_own","updateScreenCalculations_","positionables","getUiMetrics","positionable","currScroll","maybeFireViewportChangeEvent","imList","highlightBlock","opt_state","pastedThing","pasteBlock_","pasteWorkspaceComment_","jsonBlock","collide","allBlocks","otherXY","refreshSelection","dragTargets","targetArea","getClientRect","clientRect","canWheelZoom","canWheelMove","scrollDelta","commandKey","PIXELS_PER_ZOOM_STEP","topElements","boundary","topElement","blockBoundary","cursorY","scaleChange","getCTM","center","f","setScale","svgWidth","svgHeight","zoomToFit","workspaceWidth","workspaceHeight","blocksBox","doubleMargin","blocksWidth","blocksHeight","ratioX","ratioY","centerOnBlock","blockOnly","pixelX","multiplier","pixelY","reflow","resizeView","resizeContent","getScale","maxYScroll","maxYDisplacement","maxXDisplacement","addTopBoundedElement","removeTopBoundedElement","reenabled","getButtonCallback","removeButtonCallback","getToolboxCategoryCallback","removeToolboxCategoryCallback","isStart","getGrid","onlyClosePopups","autoHideables","autoHideable","autoHide","xyRatio","TrashcanOpen","opt_isOpen","BlockDelete","oldXml","wasShadow","oldJson","Block","hue_","styleName_","suppressPrefixSuffix","contextMenu","parentBlock_","childBlocks_","editable_","movable_","deletable_","collapsed_","isShadow_","outputShape_","isInsertionMarker_","disposing","onchangeWrapper_","statementInputCount","isInMutator","doInit_","onchange","setOnChange","disposeInternal","destroy","opt_healStack","unplugFromRow_","unplugFromStack_","thisConnection","getOnlyValueConnection_","previousTarget","nextTarget","_all","myConnections","ignoreShadows","getInputWithBlock","getSurroundParent","previous","childBlocks","isSimpleReporter","otherConnections","setHelpUrl","getHue","parsed","onchangeFn","getVars","vars","newId","setFieldValue","setPreviousStatement","newBoolean","opt_check","setNextStatement","setOutput","setOutputShape","outputShape","getOutputShape","ancestor","opt_maxLength","opt_emptyToken","toTokens","acc","curr","emptyToken","checks","shouldAddParens","appendValueInput","appendInput","appendStatementInput","appendDummyInput","appendEndRowInput","appendInputFromRegistry","inputConstructor","warningPrefix","n","jsonInitStyle_","jsonInitColour_","interpolate_","localizedText","localizedValue","extensionNames","styleError","opt_disableCheck","overwrites","implicitAlign","validateTokens_","interpolateArguments_","fieldStack","isInputKeyword_","inputFromJson_","fieldFromJson_","argsCount","visitedArgsHash","visitedArgsCount","token","newlineInput","stringToFieldJson_","dummyInput","alignmentLookup","alignment","moveInputBefore","refName","inputIndex","refIndex","moveNumberedInputBefore","RangeError","removeInput","getInputTargetBlock","removeIcon","setWarningText","_text","_opt_id","_mutator","find","Marker","getCurNode","setCurNode","Cursor","BasicCursor","getNextNode_","validNode_","getPreviousNode_","isValid","siblingOrParent","findSiblingOrParent","getRightMostChild","nextNode","registrationName","TabNavigateCursor","BUMP_RANDOMNESS","RenderedConnection","dbOpposite","trackedState","TrackedState","WILL_TRACK","TRACKED","bumpAwayFrom","staticConnection","updated","moveToOffset","blockTL","tightenEfficiently","maxLimit","setTracking","doTracking","UNTRACKED","updateDisabled","parentRendered","childRendered","warningTextDb","warning","mutator","eventsInit_","renderIsInProgress_","visuallyDisabled","bumpNeighboursPid","dragging","createIconPointerDownListener","getColourSecondary","getColourTertiary","oldParent","oldXY","draggingBlock","eventsEnabled","currLoc","curXY","blockBounds","updateCollapsed_","collapsedInputName","collapsedFieldName","tab","tabCursor","currentNode","nextField","open","generateContextMenu","customContextMenu","updateConnectionLocations","updateIconLocations","updateFieldLocations","getCommentIcon","timeout","collapsedParent","COLLAPSED_WARNING_ID","removed","styleObj","track","all","oldGroup","bumpNeighboursInternal","sourceConnection","tightenChildrenEfficiently","nextHeightWidth","tabHeight","INLINE","DragTarget","_dragElement","DeleteArea","wouldDelete_","couldConnect","couldDeleteBlock","updateWouldDelete_","Trashcan","isLidOpen","minOpenness","lidTask","svgLid","lidOpen","flyoutWorkspaceOptions","onDelete","BODY_HEIGHT","LID_HEIGHT","SPRITE_LEFT","SPRITE_TOP","blockMouseDownWhenOpenable","click","mouseOver","mouseOut","animateLid","setLidOpen","hasContents","contentsIsOpen","openFlyout","string","blocklyStyle","fireUiEvent","closeFlyout","emptyContents","setMinOpenness","trashRect","MARGIN_HOTSPOT","frames","ANIMATION_FRAMES","setLidAngle","MAX_LID_ANGLE","OPACITY_MIN","OPACITY_MAX","ANIMATION_LENGTH","lidAngle","openAtRight","newMin","closeLid","trashcanOpen","cleanedJson","cleanBlockJson","HAS_BLOCKS_LID_ANGLE","cleanRec","blockInfo","shortcuts","keyMap","shortcut","registeredShortcut","addKeyMapping","allowCollision","shortcutName","removeAllKeyMappings","keyCode","opt_allowCollision","shortcutNames","removeKeyMapping","shortcutIdx","setKeyMap","newKeyMap","getKeyMap","legacyKeyMap","getRegistry","legacyRegistry","serializeKeyEvent_","getShortcutNamesByKeyCode","getKeyCodesByShortcutName","serializedKey","modifier","modifierKeys","getModifierState","checkModifiers_","modifiers","modifierKeyCode","Shift","Control","Alt","Meta","ProcedureSerializer","procState","VariableSerializer","variableStates","varState","priorities","addHorizontal","addVertical","oldHostMetrics_","corner_","vScroll","hScroll","isPair","resizeH","resizeV","setX","setY","MetricsManager","workspace_","getDimensionsPx_","getFlyoutMetrics","flyoutDimensions","getToolboxMetrics","toolboxDimensions","getSvgMetrics","getAbsoluteMetrics","flyoutMetrics","respectToolbox","respectFlyout","atTop","opt_getWorkspaceCoordinates","svgMetrics","vertToolbox","getContentMetrics","blockBox","getComputedFixedEdges_","opt_viewMetrics","hScrollEnabled","vScrollEnabled","edges","getPaddedContent_","contentMetrics","contentBottom","contentRight","halfWidth","opt_contentMetrics","fixedEdges","paddedContent","scrollMetrics","contentHeight","contentTop","contentLeft","toolboxWidth","toolboxHeight","flyoutHeight","FinishedLoading","opt_workspace","BlockDrag","opt_isStart","opt_blocks","bumpIntoBounds","BlockDragger","connectionCandidate","wouldDeleteBlock_","dragIconData_","draggingBlock_","connectionPreviewer","previewerConstructor","fireDragStartEvent_","shouldDisconnect_","disconnectBlock_","moveBlock","updateDragTargets","updateCursorDuringBlockDrag_","updateConnectionPreview","dragDelta","newDragTarget","getConnectionCandidate","currCandidate","currCandidateIsBetter","previewConnection","previewReplacement","currCandiate","currLocal","currNeighbour","localPos","neighbourPos","localConns","getLocalConnections","rad","fireDragEndEvent_","getNewLocationAfterDrag_","newValues","maybeDeleteBlock_","deleted","updateBlockAfterMove_","newLocation","updateToolboxStyle_","isEnd","removeStyle","addStyle","oldCoordinate","dragIcons_","BlockFieldIntermediateChange","BlockMove","currentLocation_","oldParentId","parentId","oldInputName","blockConnection","BubbleOpen","opt_bubbleType","BubbleType","CommentBase","opt_comment","CommentCreateDeleteHelper","CommentChange","opt_oldContents","opt_newContents","oldContents_","newContents_","CommentCreate","CommentDelete","CommentMove","comment_","oldCoordinate_","newCoordinate_","current","ToolboxItemSelect","opt_oldItem","opt_newItem","oldItem","newItem","BaseConstantProvider","GRID_UNIT","CURSOR_RADIUS","HEXAGONAL","ROUND","SQUARE","SHAPE_IN_SHAPE_PADDING","SELECTED_GLOW_COLOUR","SELECTED_GLOW_SIZE","REPLACEMENT_GLOW_COLOUR","REPLACEMENT_GLOW_SIZE","selectedGlowFilterId","selectedGlowFilter","replacementGlowFilterId","SQUARED","ROUNDED","replacementGlowFilter","STATEMENT_INPUT_SPACER_MIN_WIDTH","MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH","makeHexagonal","makeRounded","makeSquared","rightWidth","selectedGlowSize","replacementGlowSize","pathRightDown","pathRightUp","blockHeight","remainingHeight","maxHeight","sweep","_height","curveWidth","quarterHeight","innerTopRightCorner","innerBottomRightCorner","pathTopRight","pathBottomRight","selectedComponentTransfer","replacementComponentTransfer","BaseDrawer","beginDrawing","outputShapeType","endDrawing","hasStatementInput","drawFlatTop_","drawRightDynamicConnection_","drawFlatBottom_","drawLeftDynamicConnection_","insideCorners","cornerHeight","bottomRightPath","verticalPath","topRightPath","getInlineInputPath","setOutlinePath","connectedBottomNextConnection","FieldImage","altText","Y_PADDING","setAlt","setOnClickHandler","FieldInput","spellcheck_","htmlInput_","isTextValid_","isBeingEdited_","onKeyInputWrapper_","onKeyDownWrapper_","valueWhenEditorWasOpened_","fullBlockClickTarget_","spellcheck","resizeEditor_","htmlInput","INVALID","setSpellcheck","quietInput","showPromptEditor_","showInlineEditor_","getValueFromEditorText_","onFinishEditing_","widgetDispose_","widgetCreate_","borderRadius","BORDERRADIUS","strokeColour","border","boxShadow","getEditorText_","bindInputEvents_","unbindInputEvents_","_value","onHtmlInputKeyDown_","onHtmlInputChange_","setEditorValue_","bumped","FieldTextInput","BaseBottomRow","BaseStatementInput","RightConnectionShape","BaseTopRow","BaseRenderInfo","isMultiRow","rightSide","rightAlignedDummyInputs","adjustXPosition_","alignmentDivider","notchTotalWidth","minXPos","prevSpacer","nextSpacer","hasPrevNotch","hasNextNotch","prevInRowSpacer","finalizeOutputConnection_","outputConnectionShape","rightConnectionWidth","finalizeHorizontalAlignment_","totalNegativeSpacing","lastElem","leftNegPadding","getNegativeSpacing_","firstElem","rightNegPadding","minBlockWidth","outerShape","innerShape","finalizeVerticalAlignment_","firstRow","hasSingleTextOrImageField","hasNonShadowConnectedBlocks","minVerticalTightNestingHeight","BaseMarkerSvg","markerCircle","showWithInputOutput","positionCircle","BasePathObject","svgPathSelected","outlines","remainingOutlines","outline","getOutlinePath","removeOutlinePath","BaseRenderer","FieldAngle","clockwise","CLOCKWISE","OFFSET","WRAP","symbol_","gauge","mode","Mode","COMPASS","PROTRACTOR","updateGraph","editor","dropdownDispose","HALF","touchAction","circle","RADIUS","onMouseMove_","ownerSVGElement","displayMouseOrKeyboardValue","wrapValue","clockwiseFlag","angle1","largeFlag","isFinite","FieldCheckbox","checkChar","CHECK_CHAR","checkCharacter","getValueBoolean","setCheckCharacter","character","convertValueToBool_","FieldColour","highlightedIndex","picker","titles","colours","columns","colourOptions","colourTitles","borderRect","setColours","setColumns","cell","handled","moveHighlightBy","getHighlighted","COLOURS","COLUMNS","setHighlightedCell","onMouseEnter","onMouseLeave","cellId","TITLES","selectedColour","table","EXPANDED","ROWCOUNT","COLCOUNT","title","FieldLabelSerializable","FieldMultilineInput","textGroup","maxLines_","isOverflowedY_","maxLines","setMaxLines","textLines","displayLinesNumber","currentChild","lineHeight","nodes","actualEditorLines","dummyTextElement","lineWidth","paddingX","paddingY","padding","getMaxLines","FieldNumber","precision","min_","max_","precision_","decimalPlaces","setConstraints","setMinInternal","setMaxInternal","setPrecisionInternal","setMin","getMin","setMax","getMax","setPrecision","precisionString","toLocaleString","maximumFractionDigits","decimalIndex","getPrecision","toFixed","VALUEMIN","VALUEMAX","FieldVariable","defaultType","defaultVariableName","variableType","typeIsAllowed","typeList","isInArray","FlyoutButton","isLabel_","svgText","callbackKey","TEXT_MARGIN_X","TEXT_MARGIN_Y","updateTransform","onMouseUp","isLabel","getButtonText","FlyoutMetricsManager","flyout_","getBoundingBox_","blockBoundingBox","FlyoutItemType","BUTTON","Flyout","filterWrapper","reflowWrapper","mats","buttons_","permanentlyDisabled","recycledBlocks","SCROLLBAR_MARGIN","dragAngleRange_","setMetrics_","toolboxPosition_","tabWidth_","rectMap_","GAP_X","GAP_Y","wheel_","filterForCapacity","getFlyoutScale","setAutoClose","updateDisplay","positionAt_","listen","clearOldBlocks","getDynamicCategoryContents","parsedContent","flyoutInfo","createFlyoutInfo","layout_","gaps","emptyRecycledBlocks","defaultGap","categoryName","parsedDynamicContent","dynamicContents","dynamicGaps","createFlyoutBlock","addBlockGap","addSeparatorGap","createButton","fnToApply","btnInfo","curButton","getRecycledBlock","blockType","gap","sepInfo","newGap","oldBlocks","blockIsRecyclable_","recycleBlock","addBlockListeners_","blockMouseDown","originalBlock","placeNewBlock","initFlyoutButton_","buttonSvg","createRect_","blockHW","moveRectToBlock_","reflowInternal_","oldBlock","svgRootOld","positionNewBlock","flyoutOffsetPixels","oldBlockPos","oldBlockOffsetPixels","getX","getY","targetWorkspaceViewMetrics","setBackgroundPath","cursorX","moveX","dragDirection","atan2","range","flyoutRect","BIG_NUM","buttons","atRight","oldX","newX","registryName","CodeGenerator","forBlock","FUNCTION_NAME_PLACEHOLDER_","STATEMENT_SUFFIX","STATEMENT_PREFIX","INFINITE_LOOP_TRAP","INDENT","COMMENT_WRAP","ORDER_OVERRIDES","isInitialized","RESERVED_WORDS_","definitions_","functionNames_","nameDB_","FUNCTION_NAME_PLACEHOLDER_REGEXP_","RegExp","workspaceToCode","code","blockToCode","scrubNakedValue","injectId","codeString","finish","prefixLines","allNestedComments","opt_thisOnly","scrub_","SyntaxError","valueToCode","outerOrder","innerOrder","parensNeeded","outerOrderClass","innerOrderClass","statementToCode","addLoopTrap","branch","addReservedWords","provideFunction_","desiredName","functionName","codeText","oldCodeText","getVariableName","getProcedureName","_opt_thisOnly","InsertionMarkerPreviewer","draggedBlock","staticConn","draggedConn","replacedBlock","dragged","createInsertionMarker","origBlock","orig","origConn","origConns","markerConns","DARK_PATH_OFFSET","MAX_BOTTOM_WIDTH","Highlighter","inlineSteps_","steps_","RTL_","highlightConstants_","getHighlightConstants","highlightOffset","outsideCornerPaths_","OUTSIDE_CORNER","insideCornerPaths_","INSIDE_CORNER","puzzleTabPaths_","notchPaths_","startPaths_","jaggedTeethPaths_","getPath","drawTopCorner","drawValueInput","belowTabHeight","drawStatementInput","drawRightSideRow","rightEdge","drawBottomRow","cornerElem","drawLeft","drawInlineInput","connectionRight","bottomHighlightWidth","aboveTabHeight","highlighter_","setHighlightPath","HighlightConstantProvider","constantProvider","makeInsideCorner","makeOutsideCorner","distance45outside","SQRT1_2","pathTopRtl","pathBottomRtl","pathBottomLtr","distance45inside","topLeftCornerHighlightRtl","topLeftCornerHighlightLtr","bottomLeftStartY","bottomLeftPath","highlightRtlUp","highlightRtlDown","verticalOverlap","highlightLtrUp","highlightLtrDown","hatHeight","pathRtl","pathLtr","BaseInlineInput","hasExternalInputs","nextRightEdge","rowNextRightEdges","prevRightEdge","heightWithoutHat","diff","colourDark","svgPathDark","svgPathLight","highlightPath","highlightConstants","makeHighlightConstants_","Zelos","ToolboxItem","toolboxItemDef","parentToolbox","level_","parent_","getLevel","toolboxItemDef_","parentToolbox_","getClickTarget","isCollapsible","setVisible_","_isVisible","ToolboxCategory","categoryDef","labelDom_","iconDom_","rowContents_","rowDiv_","htmlDiv_","isDisabled_","isHidden_","flyoutItems_","cssConfig_","makeDefaultCssConfig_","parseCategoryDef_","parseContents_","createDom_","flyoutItem","itemDef","getColour_","createContainer_","LEVEL","createRowContainer_","pointerEvents","createRowContentsContainer_","createIconDom_","createLabelDom_","LABELLEDBY","addColourBorder_","rowDiv","nestedPadding","paddingRight","paddingLeft","contentsContainer","toolboxIcon","isHorizontal","toolboxLabel","borderWidth","borderRight","borderLeft","styleName","getColourfromStyle_","parseColour_","colourValue","openIcon_","iconDiv","closedIconClass","closeIcon_","openIconClass","getSelectedItem","clearSelection","allAncestorsExpanded_","category","isExpanded","isSelected","defaultBackgroundColour","setDisabled","isDisabled","getContents","updateFlyoutContents","newDefinition","kind","custom","categorystyle","cssconfig","hidden","ToolboxSeparator","separatorDef","CollapsibleToolboxCategory","subcategoriesDiv_","expanded_","toolboxItems_","cssConfig","prevIsFlyoutItem","createToolboxItem_","ToolboxItemClass","setExpanded","subCategories","getChildToolboxItems","createSubCategoriesDom_","subcategories","newCategory","newCategoryDiv","handleToolboxItemResize","childToolboxItems","toggleExpanded","Toolbox","contentsDiv_","HtmlDiv","contents_","previouslySelectedItem_","selectedItem_","boundEvents_","toolboxDef_","horizontalLayout_","contentMap_","createFlyout_","themeManager","createContentsContainer_","attachEvents_","toolboxContainer","flexDirection","clickEvent","onClick_","keyDownEvent","onKeyDown_","itemId","getToolboxItemById","setSelectedItem","selectNext_","selectPrevious_","selectParent_","selectChild_","FlyoutClass","renderContents_","fragment","createDocumentFragment","addToolboxItem_","toolboxItemDom","getToolboxItems","toolboxRect","_couldConnect","updateCursorDeleteStyle_","getPreviouslySelectedItem","workspaceMetrics","toolboxDiv","childAsCategory","shouldDeselectItem_","deselectItem_","shouldSelectItem_","selectItem_","updateFlyout_","fireSelectEvent_","selectItemByPosition","oldElement","collapsibleItem","nextItemIdx","nextItem","prevItemIdx","prevItem","VERSION","ALIGN_LEFT","ALIGN_CENTRE","ALIGN_RIGHT","DUMMY_INPUT","TOOLBOX_AT_TOP","TOOLBOX_AT_BOTTOM","TOOLBOX_AT_LEFT","TOOLBOX_AT_RIGHT","VARIABLE_CATEGORY_NAME","VARIABLE_DYNAMIC_CATEGORY_NAME","PROCEDURE_CATEGORY_NAME","Workspace.prototype.newBlock","WorkspaceSvg.prototype.newBlock","WorkspaceSvg.newTrashcan","WorkspaceCommentSvg.prototype.showContextMenu","MiniWorkspaceBubble.prototype.newWorkspaceSvg","Names.prototype.populateProcedures","flattenedProcedures","DropDownDiv","dropDownDiv","connectionTypes","ContextMenu","ContextMenuItems","Css","Events","Extensions","ShortcutItems","Themes","Tooltip","Touch","WidgetDiv","Xml","blockAnimations","blockRendering","bubbles","bumpObjects","clipboard","common","dialog","fieldRegistry","geras","minimalist","renderManagement","serialization","thrasos","uiPosition","utils","zelos","defineProperties","Blockly","HSV_SATURATION","HSV_VALUE"],"mappings":"A;;;;;;;;;;;;;AA0HMA,IAAAA,wCAAAA,CAgENC,wCAhEMD,CAiFAE,0CAjFAF,CAgHNG,uCAhHMH,CAgJAI,uCAhJAJ,CAoKAK,wCApKAL,CAwLAM,yCAxLAN,CA0MAO,2CA1MAP,CA+OAQ,mDA/OAR,CCjGAS,8CDiGAT,CCxFAU,8CDwFAV,CC3EAW,+CD2EAX;AClEAY,gDDkEAZ,CCjDAa,8CDiDAb,CCxCAc,8CDwCAd,CC5BAe,yCD4BAf,CChBAgB,yCDgBAhB,CCDAiB,gDDCAjB,CCWAkB,gDDXAlB,CCwBAmB,uCDxBAnB,CCiEAoB,gDDjEApB,CCgGNqB,6CDhGMrB,CC4GAsB,uDD5GAtB;ACmHNuB,+DDnHMvB,CEjEAwB,wDFiEAxB,CEvDAyB,+CFuDAzB,CGxFA0B,iDHwFA1B,CG/EA2B,iDH+EA3B,CGgGA4B,wCHhGA5B,CGuGN6B,gDHvGM7B,CG6HN8B,2CH7HM9B,CG0LA+B,0CH1LA/B,CG0RAgC,oDH1RAhC,CGoTAiC,6CHpTAjC;AG8UNkC,oDH9UMlC,CG6VAmC,oDH7VAnC,CG8WAoC,4CH9WApC,CG8XAqC,uCH9XArC,CGgZAsC,kDHhZAtC,CI1DAuC,sCJ0DAvC,CI1CAwC,qCJ0CAxC,CI9BAyC,iDJ8BAzC,CIjBA0C,8CJiBA1C,CIAA2C,wDJAA3C,CIcA4C,iDJdA5C;AK5EA6C,qDL4EA7C,CK3BA8C,0CL2BA9C,CKYA+C,4CLZA/C,CK8BAgD,mDL9BAhD,CKkEAiD,mDLlEAjD,CKoFAkD,gDLpFAlD,CKyGAmD,0DLzGAnD,CM1GAoD,6CN0GApD,COzGAA,mCPyGAA,COvFAqD,iCPuFArD,CQpGAsD,6CRoGAtD;ASrEAuD,iDTqEAvD,CS7CAwD,yCT6CAxD,CS9BAyD,8CT8BAzD,CSjBA0D,4CTiBA1D,CSDA2D,yCTCA3D,CSUA4D,2CTVA5D,CSqBA6D,4CTrBA7D,CS0CA8D,6CT1CA9D,CS4DA+D,gDT5DA/D,CSwEAgE,oDTxEAhE,CSmFAiE,mDTnFAjE;ASgGAkE,6CThGAlE,CSwIAmE,iDTxIAnE,CSmKAoE,+DTnKApE,CS0NAqE,mDT1NArE,CUvGAsE,0CVuGAtE,CUhGNuE,kDVgGMvE,CU/DNwE,qDV+DMxE,CU9CAyE,mDV8CAzE,CU7BA0E,gDV6BA1E,CUNA2E,wDVMA3E;AUSA4E,+CVTA5E,CU+BA6E,0DV/BA7E,CUuDA8E,iEVvDA9E,CWpFA+E,mDXoFA/E,CWtCAgF,uDXsCAhF,CWdAiF,qDXcAjF,CWGAkF,uDXHAlF,CWoBAmF,2DXpBAnF,CW8DAoF,2DX9DApF;AYjEAqF,mDZiEArF,CYiCAsF,0CZjCAtF,CYqCNuF,6CZrCMvF,CauDAwF,4DbvDAxF,CagFNyF,oDbhFMzF,CagHA0F,gEbhHA1F,CamJA2F,kDbnJA3F,Ca0JN4F,0Db1JM5F,CaiLA6F,0DbjLA7F,CaoMN8F,yDbpMM9F;AamNN+F,mDbnNM/F,Ca8PNgG,kDb9PMhG,CaoRAiG,qDbpRAjG,CcpDAkG,gEdoDAlG,CcMAmG,oEdNAnG,CcmCAoG,4DdnCApG,CelFAqG,mCfkFArG,CexEAsG,sCfwEAtG,Ce7DAuG,qCf6DAvG,CetDNwG,6CfsDMxG;Ae5CAyG,wCf4CAzG,Ce5BA0G,oCf4BA1G,CedA2G,uCfcA3G,CgBxGA4G,kGhBwGA5G,CiB7FA6G,qFjB6FA7G,CiBhFA8G,sFjBgFA9G,CkBhCA+G,+ClBgCA/G,CkBTAgH,qDlBSAhH,CkB8CAiH,mDlB9CAjH;AkBqDNkH,2DlBrDMlH,CkBqEAmH,8DlBrEAnH,CkB0HAoH,4DlB1HApH,CkBoOAqH,2ClBpOArH,CkBgQNsH,sDlBhQMtH,CkBuRAuH,oDlBvRAvH,CkBkTAwH,6DlBlTAxH,CkBgUNyH,4ElBhUMzH,CkB0VN0H,6ElB1VM1H;AkBoXA2H,yDlBpXA3H,CkBwdN4H,+ClBxdM5H,CkB+fA6H,kDlB/fA7H,CmB1GAA,kDnB0GAA,CmB9FAE,oDnB8FAF,CoB/EA8H,oDpB+EA9H,CoBvDA+H,4DpBuDA/H,CoBxCAgI,6DpBwCAhI,CoB7BNiI,gEpB6BMjI;AoBnBNkI,mDpBmBMlI,CoBJNmI,kDpBIMnI,CoBqBNoI,qDpBrBMpI,CoBsCNqI,8DpBtCMrI,CoBgDNsI,oDpBhDMtI,CqBzFAuI,yCrByFAvI,CqB3DAwI,yCrB2DAxI,CqBpCAyI,2CrBoCAzI,CqBAN0I,qCrBAM1I,CqBgBN2I,yCrBhBM3I,CqBqCA4I,qCrBrCA5I;AqBsKN6I,sCrBtKM7I,CqBwNAsF,oCrBxNAtF,CqBqOA8I,0CrBrOA9I,CqBuQA+I,uDrBvQA/I,CqB8WAgJ,+CrB9WAhJ,CqB2bAiJ,6CrB3bAjJ,CqB6fAkJ,yCrB7fAlJ,CqB0hBNmJ,8CrB1hBMnJ,CqBglBNoJ,gDrBhlBMpJ,CqBsmBNqJ,+CrBtmBMrJ,CqBgoBNsJ,4CrBhoBMtJ,CqB6oBNuJ,6CrB7oBMvJ;AqB+pBNwJ,0CrB/pBMxJ,CqByrBNyJ,6CrBzrBMzJ,CqBsuBN0J,4CrBtuBM1J,CqBixBN2J,6CrBjxBM3J,CqBw3BN4J,qCrBx3BM5J,CqBy4BA6J,qCrBz4BA7J,CqBm5BN8J,oCrBn5BM9J,CsBjGA+J,+DtBiGA/J,CuBxGAA,sDvBwGAA,CuB/FAE,wDvB+FAF,CwBzCAgK,gDxByCAhK;AwBiCNiK,0DxBjCMjK,CwBmENkK,sDxBnEMlK,CwBkFNmK,0DxBlFMnK,CwB+GNoK,qDxB/GMpK,CwBqINqK,sDxBrIMrK,CwB6JNsK,2DxB7JMtK,CwB8LNuK,0DxB9LMvK,CwB0NNwK,0DxB1NMxK,CwBuPAyK,kDxBvPAzK;AwBkRA0K,0DxBlRA1K,CwBgVN2K,yDxBhVM3K,CwBkXN4K,sDxBlXM5K,CwBkYN6K,0DxBlYM7K,CwBiaN8K,0DxBjaM9K,CwBmbN+K,8DxBnbM/K,CwByeNgL,qDxBzeMhL,CwBogBNiL,sDxBpgBMjL,CwB8hBNkL,2DxB9hBMlL;AwBojBNmL,0DxBpjBMnL,CwBqkBNoL,0DxBrkBMpL,CwB4lBNqL,qDxB5lBMrL,CyB/DAsL,oEzB+DAtL,CyBlCNuL,uEzBkCMvL,CyBlBNwL,iEzBkBMxL,C0B9FAyL,qC1B8FAzL,C0BjFN0L,6C1BiFM1L,C0B5CA2L,sC1B4CA3L;A0BxBN4L,8C1BwBM5L,C0BHA6L,0C1BGA7L,C0BaN8L,kD1BbM9L,C2BHA+L,yC3BGA/L,C2BWAgM,0C3BXAhM,C4BpFAiM,uC5BoFAjM,C4B1EAkM,gD5B0EAlM,C4BhEAmM,0C5BgEAnM,C4B7CAoM,qC5B6CApM,C4BvBAqM,qC5BuBArM,C4BQAsM,0C5BRAtM,C4BkBAuM,4C5BlBAvM;A4B+BNwM,iD5B/BMxM,C4BqDAyM,mD5BrDAzM,C4BkFN0M,2C5BlFM1M,C4BoHN2M,2C5BpHM3M,C4B0IN4M,iD5B1IM5M,C4BkJA6M,0D5BlJA7M,C6B9EA8M,kD7B8EA9M,C6BrEA+M,kD7BqEA/M,C6BrDAoM,uC7BqDApM,C6BxBNgN,4C7BwBMhN,C6BqBNiN,4C7BrBMjN;A6BwDNkN,gD7BxDMlN,C6B8ENmN,kD7B9EMnN,C6BuFAqM,uC7BvFArM,C6B+FAoN,0C7B/FApN,C6B6JAqN,sD7B7JArN,C6BqLAsN,yD7BrLAtN,C6B8MAuN,yD7B9MAvN,C8B3GAwN,2C9B2GAxN,C8BhGAyN,2C9BgGAzN,C8BpFA0N,uC9BoFA1N,C+BTHmM,4C/BSGnM;A+B6BH2N,mD/B7BG3N,C+BoCH4N,2C/BpCG5N,C+B6CH6N,gD/B7CG7N,C+BkDN8N,+C/BlDM9N,C+B6DH+N,4C/B7DG/N,C+B8EHgO,wD/B9EGhO,C+BuGHiO,wD/BvGGjO,C+BqHNkO,uD/BrHMlO,C+BoINmO,uD/BpIMnO,C+B+INoO,uD/B/IMpO;A+B8MHoM,uC/B9MGpM,C+B6TNqO,0D/B7TMrO,C+BqWNsO,0D/BrWMtO,C+B8YNuO,8D/B9YMvO,C+B6bHwO,+C/B7bGxO,C+B8dHsM,4C/B9dGtM,C+B0eHuM,8C/B1eGvM,C+B0fNqM,uC/B1fMrM,C+B0gBNyO,uD/B1gBMzO,C+B+iBNwM,mD/B/iBMxM;A+BmnBH6M,4D/BnnBG7M,CgC1FA0O,uDhC0FA1O,CgC1DN2O,qDhC0DM3O,CgC5BA4O,0DhC4BA5O,CgCuCA6O,0DhCvCA7O,CgCiEN8O,wDhCjEM9O,CgC2FA+O,wDhC3FA/O,CiCvGAgP,8CjCuGAhP,CiCvFAiP,wDjCuFAjP;AiCtEAkP,oDjCsEAlP,CiC9BAmP,oDjC8BAnP,CiCwBNoP,4CjCxBMpP,CiC2ENqP,6CjC3EMrP,CiCoINsP,8CjCpIMtP,CiCwKNuP,8CjCxKMvP,CkC9EAwP,+ClC8EAxP,CkCrEAyP,+ClCqEAzP,CkCzDAsM,wClCyDAtM,CkCaAiM,qClCbAjM,CkCuBA0P,iDlCvBA1P;AkC6CN2P,8ClC7CM3P,CkC+DAmM,wClC/DAnM,CkC+EA4P,8ClC/EA5P,CkCyGA6P,gDlCzGA7P,CkCyHN8P,0ClCzHM9P,CkC+IN+P,yClC/IM/P,CkCuKNgQ,0ClCvKMhQ,CkC+MAoN,sClC/MApN,CkCwNAqM,mClCxNArM,CkC2OAiQ,oClC3OAjQ,CkCsPAkQ,sClCtPAlQ,CkC2PNmQ,4ClC3PMnQ;AkCwQNoQ,mDlCxQMpQ,CkC2RNqQ,0ClC3RMrQ,CkC+TNoM,mClC/TMpM,CmC3GAsQ,6CnC2GAtQ,CoC3GAuQ,wDpC2GAvQ,CqCtGAwQ,oDrCsGAxQ,CqC3FAyQ,oDrC2FAzQ,CqC3EA0Q,+CrC2EA1Q,CqChEA2Q,+CrCgEA3Q,CqChDA4Q,yCrCgDA5Q,CqCVA6Q,4CrCUA7Q;AqCKA8Q,4CrCLA9Q,CqC2BA+Q,4CrC3BA/Q,CqCwFAgR,yCrCxFAhR,CqC4IAiR,4CrC5IAjR,CsClGNkR,kEtCkGMlR,CsCqEAmR,0DtCrEAnR,CsCkFAoR,6DtClFApR,CsCwGAqR,2DtCxGArR,CsCsIAsR,qDtCtIAtR,CuCxGAuR,oEvCwGAvR;AwCrGAwR,2DxCqGAxR,CyC/FAA,8CzC+FAA,CyCtFAE,gDzCsFAF,CyC9DNyR,sDzC8DMzR,C0C2lBN0R,iD1C3lBM1R,C0CwpBN2R,+C1CxpBM3R,C0CyqBN4R,qD1CzqBM5R,C2ChBAE,4C3CgBAF,C2CAA6R,8C3CAA7R,C2CaA8R,uC3CbA9R,C2CuDN+R,0D3CvDM/R;A2C+ENgS,+C3C/EMhS,C2CoGNiS,gD3CpGMjS,C2CyHNkS,oD3CzHMlS,C2CgJNmS,sD3ChJMnS,C2CsKNoS,2D3CtKMpS,C2C8LNqS,sD3C9LMrS,C2CgONsS,wD3ChOMtS,C2CuPAuS,kD3CvPAvS,C2C+SNwS,6D3C/SMxS,C2CoWNyS,wD3CpWMzS;A4CxGA0S,4C5CwGA1S,C4CvFA2S,4C5CuFA3S,C4CzEA4S,6C5CyEA5S,C4C3DA6S,6C5C2DA7S,C4C7CA8S,6C5C6CA9S,C4C/BA+S,2C5C+BA/S,C4CdAgT,iD5CcAhT,C4CGAiT,0C5CHAjT,C6CxGAA,8C7CwGAA,C6C5FAE,gD7C4FAF,C8C3DAkT,+C9C2DAlT;A8CdNmT,qD9CcMnT,C8C0BNoT,6C9C1BMpT,C8C2CAqT,4C9C3CArT,C8C8GA+G,gD9C9GA/G,C8CyMNsT,qD9CzMMtT,C8CyOAuT,qD9CzOAvT,C8CwQNwT,uD9CxQMxT,C8C6RAyT,4C9C7RAzT,C8C2SN0T,wD9C3SM1T,C+CxBA2T,gE/CwBA3T;A+CnBA4T,6D/CmBA5T,C+CXA6T,yD/CWA7T,CgD6nBN8T,gEhD7nBM9T,CiD8lBN+T,qDjD9lBM/T,CiD+mBNgU,qDjD/mBMhU,CiD8oBNiU,gEjD9oBMjU,CkD3EAA,gElD2EAA,CkDlEAE,kElDkEAF,CkDpDAkU,4DlDoDAlU;AmD3FNmU,iEnD2FMnU,CmD5ENoU,iEnD4EMpU,CmD7DNqU,iEnD6DMrU,CmD5CA+G,uDnD4CA/G,CmDLAgH,6DnDKAhH,CoD27EAsU,sDpD37EAtU,CqD9FAuU,uDrD8FAvU,CsDzFAwU,oDtDyFAxU,CsDrEAyU,oDtDqEAzU;AsDlCA0U,kDtDkCA1U,CsDSA2U,iDtDTA3U,CsDmDA4U,mDtDnDA5U,CsDgFA6U,kDtDhFA7U,CsD+GA8U,kDtD/GA9U,CsDuJA+U,8DtDvJA/U,CuD3DAgV,6DvD2DAhV,CuD3CAiV,6DvD2CAjV,CuD5BAkV,6DvD4BAlV;AuDCAmV,6DvDDAnV,CwDpGAgK,oDxDoGAhK,CwD9EAoV,oDxD8EApV,CyDzFNqV,wDzDyFMrV,CyD9BAsV,yDzD8BAtV,CyD6BNuV,0DzD7BMvV,CyDyDAwV,4DzDzDAxV,C0D4gBNyV,iD1D5gBMzV,C2DhGA6U,qD3DgGA7U;A2DxEA8U,qD3DwEA9U,C2DhDA0V,wD3DgDA1V,C2DnBN2V,sD3DmBM3V,C2DOA4V,yD3DPA5V,C2DyCA6V,uD3DzCA7V,C2D8EN8V,4D3D9EM9V,C2D+FN+V,4D3D/FM/V,C2D+GNgW,oD3D/GMhW,C2DsIAiW,0D3DtIAjW;A2DsLNkW,kE3DtLMlW,C2DkMAmW,0D3DlMAnW,C2DiOAoW,wD3DjOApW,C2DyQAqW,uD3DzQArW,C2D6SAsW,oE3D7SAtW,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","file":"blockly_compressed.js","sourcesContent":["/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.registry\r\n\r\nimport type {Abstract} from './events/events_abstract.js';\r\nimport type {Field} from './field.js';\r\nimport type {IBlockDragger} from './interfaces/i_block_dragger.js';\r\nimport type {IConnectionChecker} from './interfaces/i_connection_checker.js';\r\nimport type {IFlyout} from './interfaces/i_flyout.js';\r\nimport type {IMetricsManager} from './interfaces/i_metrics_manager.js';\r\nimport type {IIcon} from './interfaces/i_icon.js';\r\nimport type {Input} from './inputs/input.js';\r\nimport type {ISerializer} from './interfaces/i_serializer.js';\r\nimport type {IToolbox} from './interfaces/i_toolbox.js';\r\nimport type {Cursor} from './keyboard_nav/cursor.js';\r\nimport type {Options} from './options.js';\r\nimport type {Renderer} from './renderers/common/renderer.js';\r\nimport type {Theme} from './theme.js';\r\nimport type {ToolboxItem} from './toolbox/toolbox_item.js';\r\nimport type {IPaster} from './interfaces/i_paster.js';\r\nimport type {ICopyData, ICopyable} from './interfaces/i_copyable.js';\r\nimport type {IConnectionPreviewer} from './interfaces/i_connection_previewer.js';\r\n\r\n/**\r\n * A map of maps. With the keys being the type and name of the class we are\r\n * registering and the value being the constructor function.\r\n * e.g. {'field': {'field_angle': Blockly.FieldAngle}}\r\n */\r\nconst typeMap: {\r\n  [key: string]: {\r\n    [key: string]: (new () => AnyDuringMigration) | AnyDuringMigration;\r\n  };\r\n} = Object.create(null);\r\nexport const TEST_ONLY = {typeMap};\r\n\r\n/**\r\n * A map of maps. With the keys being the type and caseless name of the class we\r\n * are registring, and the value being the most recent cased name for that\r\n * registration.\r\n */\r\nconst nameMap: {[key: string]: {[key: string]: string}} = Object.create(null);\r\n\r\n/**\r\n * The string used to register the default class for a type of plugin.\r\n */\r\nexport const DEFAULT = 'default';\r\n\r\n/**\r\n * A name with the type of the element stored in the generic.\r\n */\r\nexport class Type<_T> {\r\n  /** @param name The name of the registry type. */\r\n  constructor(private readonly name: string) {}\r\n\r\n  /**\r\n   * Returns the name of the type.\r\n   *\r\n   * @returns The name.\r\n   */\r\n  toString(): string {\r\n    return this.name;\r\n  }\r\n\r\n  static CONNECTION_CHECKER = new Type<IConnectionChecker>('connectionChecker');\r\n\r\n  static CONNECTION_PREVIEWER = new Type<IConnectionPreviewer>(\r\n    'connectionPreviewer',\r\n  );\r\n\r\n  static CURSOR = new Type<Cursor>('cursor');\r\n\r\n  static EVENT = new Type<Abstract>('event');\r\n\r\n  static FIELD = new Type<Field>('field');\r\n\r\n  static INPUT = new Type<Input>('input');\r\n\r\n  static RENDERER = new Type<Renderer>('renderer');\r\n\r\n  static TOOLBOX = new Type<IToolbox>('toolbox');\r\n\r\n  static THEME = new Type<Theme>('theme');\r\n\r\n  static TOOLBOX_ITEM = new Type<ToolboxItem>('toolboxItem');\r\n\r\n  static FLYOUTS_VERTICAL_TOOLBOX = new Type<IFlyout>('flyoutsVerticalToolbox');\r\n\r\n  static FLYOUTS_HORIZONTAL_TOOLBOX = new Type<IFlyout>(\r\n    'flyoutsHorizontalToolbox',\r\n  );\r\n\r\n  static METRICS_MANAGER = new Type<IMetricsManager>('metricsManager');\r\n\r\n  static BLOCK_DRAGGER = new Type<IBlockDragger>('blockDragger');\r\n\r\n  /** @internal */\r\n  static SERIALIZER = new Type<ISerializer>('serializer');\r\n\r\n  /** @internal */\r\n  static ICON = new Type<IIcon>('icon');\r\n\r\n  /** @internal */\r\n  static PASTER = new Type<IPaster<ICopyData, ICopyable<ICopyData>>>('paster');\r\n}\r\n\r\n/**\r\n * Registers a class based on a type and name.\r\n *\r\n * @param type The type of the plugin.\r\n *     (e.g. Field, Renderer)\r\n * @param name The plugin's name. (Ex. field_angle, geras)\r\n * @param registryItem The class or object to register.\r\n * @param opt_allowOverrides True to prevent an error when overriding an already\r\n *     registered item.\r\n * @throws {Error} if the type or name is empty, a name with the given type has\r\n *     already been registered, or if the given class or object is not valid for\r\n *     its type.\r\n */\r\nexport function register<T>(\r\n  type: string | Type<T>,\r\n  name: string,\r\n  registryItem:\r\n    | (new (...p1: AnyDuringMigration[]) => T)\r\n    | null\r\n    | AnyDuringMigration,\r\n  opt_allowOverrides?: boolean,\r\n): void {\r\n  if (\r\n    (!(type instanceof Type) && typeof type !== 'string') ||\r\n    `${type}`.trim() === ''\r\n  ) {\r\n    throw Error(\r\n      'Invalid type \"' +\r\n        type +\r\n        '\". The type must be a' +\r\n        ' non-empty string or a Blockly.registry.Type.',\r\n    );\r\n  }\r\n  type = `${type}`.toLowerCase();\r\n\r\n  if (typeof name !== 'string' || name.trim() === '') {\r\n    throw Error(\r\n      'Invalid name \"' + name + '\". The name must be a' + ' non-empty string.',\r\n    );\r\n  }\r\n  const caselessName = name.toLowerCase();\r\n  if (!registryItem) {\r\n    throw Error('Can not register a null value');\r\n  }\r\n  let typeRegistry = typeMap[type];\r\n  let nameRegistry = nameMap[type];\r\n  // If the type registry has not been created, create it.\r\n  if (!typeRegistry) {\r\n    typeRegistry = typeMap[type] = Object.create(null);\r\n    nameRegistry = nameMap[type] = Object.create(null);\r\n  }\r\n\r\n  // Validate that the given class has all the required properties.\r\n  validate(type, registryItem);\r\n\r\n  // Don't throw an error if opt_allowOverrides is true.\r\n  if (!opt_allowOverrides && typeRegistry[caselessName]) {\r\n    throw Error(\r\n      'Name \"' +\r\n        caselessName +\r\n        '\" with type \"' +\r\n        type +\r\n        '\" already registered.',\r\n    );\r\n  }\r\n  typeRegistry[caselessName] = registryItem;\r\n  nameRegistry[caselessName] = name;\r\n}\r\n\r\n/**\r\n * Checks the given registry item for properties that are required based on the\r\n * type.\r\n *\r\n * @param type The type of the plugin. (e.g. Field, Renderer)\r\n * @param registryItem A class or object that we are checking for the required\r\n *     properties.\r\n */\r\nfunction validate(type: string, registryItem: Function | AnyDuringMigration) {\r\n  switch (type) {\r\n    case String(Type.FIELD):\r\n      if (typeof registryItem.fromJson !== 'function') {\r\n        throw Error('Type \"' + type + '\" must have a fromJson function');\r\n      }\r\n      break;\r\n  }\r\n}\r\n\r\n/**\r\n * Unregisters the registry item with the given type and name.\r\n *\r\n * @param type The type of the plugin.\r\n *     (e.g. Field, Renderer)\r\n * @param name The plugin's name. (Ex. field_angle, geras)\r\n */\r\nexport function unregister<T>(type: string | Type<T>, name: string) {\r\n  type = `${type}`.toLowerCase();\r\n  name = name.toLowerCase();\r\n  const typeRegistry = typeMap[type];\r\n  if (!typeRegistry || !typeRegistry[name]) {\r\n    console.warn(\r\n      'Unable to unregister [' +\r\n        name +\r\n        '][' +\r\n        type +\r\n        '] from the ' +\r\n        'registry.',\r\n    );\r\n    return;\r\n  }\r\n  delete typeMap[type][name];\r\n  delete nameMap[type][name];\r\n}\r\n\r\n/**\r\n * Gets the registry item for the given name and type. This can be either a\r\n * class or an object.\r\n *\r\n * @param type The type of the plugin.\r\n *     (e.g. Field, Renderer)\r\n * @param name The plugin's name. (Ex. field_angle, geras)\r\n * @param opt_throwIfMissing Whether or not to throw an error if we are unable\r\n *     to find the plugin.\r\n * @returns The class or object with the given name and type or null if none\r\n *     exists.\r\n */\r\nfunction getItem<T>(\r\n  type: string | Type<T>,\r\n  name: string,\r\n  opt_throwIfMissing?: boolean,\r\n): (new (...p1: AnyDuringMigration[]) => T) | null | AnyDuringMigration {\r\n  type = `${type}`.toLowerCase();\r\n  name = name.toLowerCase();\r\n  const typeRegistry = typeMap[type];\r\n  if (!typeRegistry || !typeRegistry[name]) {\r\n    const msg = 'Unable to find [' + name + '][' + type + '] in the registry.';\r\n    if (opt_throwIfMissing) {\r\n      throw new Error(\r\n        msg + ' You must require or register a ' + type + ' plugin.',\r\n      );\r\n    } else {\r\n      console.warn(msg);\r\n    }\r\n    return null;\r\n  }\r\n  return typeRegistry[name];\r\n}\r\n\r\n/**\r\n * Returns whether or not the registry contains an item with the given type and\r\n * name.\r\n *\r\n * @param type The type of the plugin.\r\n *     (e.g. Field, Renderer)\r\n * @param name The plugin's name. (Ex. field_angle, geras)\r\n * @returns True if the registry has an item with the given type and name, false\r\n *     otherwise.\r\n */\r\nexport function hasItem<T>(type: string | Type<T>, name: string): boolean {\r\n  type = `${type}`.toLowerCase();\r\n  name = name.toLowerCase();\r\n  const typeRegistry = typeMap[type];\r\n  if (!typeRegistry) {\r\n    return false;\r\n  }\r\n  return !!typeRegistry[name];\r\n}\r\n\r\n/**\r\n * Gets the class for the given name and type.\r\n *\r\n * @param type The type of the plugin.\r\n *     (e.g. Field, Renderer)\r\n * @param name The plugin's name. (Ex. field_angle, geras)\r\n * @param opt_throwIfMissing Whether or not to throw an error if we are unable\r\n *     to find the plugin.\r\n * @returns The class with the given name and type or null if none exists.\r\n */\r\nexport function getClass<T>(\r\n  type: string | Type<T>,\r\n  name: string,\r\n  opt_throwIfMissing?: boolean,\r\n): (new (...p1: AnyDuringMigration[]) => T) | null {\r\n  return getItem(type, name, opt_throwIfMissing) as\r\n    | (new (...p1: AnyDuringMigration[]) => T)\r\n    | null;\r\n}\r\n\r\n/**\r\n * Gets the object for the given name and type.\r\n *\r\n * @param type The type of the plugin.\r\n *     (e.g. Category)\r\n * @param name The plugin's name. (Ex. logic_category)\r\n * @param opt_throwIfMissing Whether or not to throw an error if we are unable\r\n *     to find the object.\r\n * @returns The object with the given name and type or null if none exists.\r\n */\r\nexport function getObject<T>(\r\n  type: string | Type<T>,\r\n  name: string,\r\n  opt_throwIfMissing?: boolean,\r\n): T | null {\r\n  return getItem(type, name, opt_throwIfMissing) as T;\r\n}\r\n\r\n/**\r\n * Returns a map of items registered with the given type.\r\n *\r\n * @param type The type of the plugin. (e.g. Category)\r\n * @param opt_cased Whether or not to return a map with cased keys (rather than\r\n *     caseless keys). False by default.\r\n * @param opt_throwIfMissing Whether or not to throw an error if we are unable\r\n *     to find the object. False by default.\r\n * @returns A map of objects with the given type, or null if none exists.\r\n */\r\nexport function getAllItems<T>(\r\n  type: string | Type<T>,\r\n  opt_cased?: boolean,\r\n  opt_throwIfMissing?: boolean,\r\n): {[key: string]: T | null | (new (...p1: AnyDuringMigration[]) => T)} | null {\r\n  type = `${type}`.toLowerCase();\r\n  const typeRegistry = typeMap[type];\r\n  if (!typeRegistry) {\r\n    const msg = `Unable to find [${type}] in the registry.`;\r\n    if (opt_throwIfMissing) {\r\n      throw new Error(`${msg} You must require or register a ${type} plugin.`);\r\n    } else {\r\n      console.warn(msg);\r\n    }\r\n    return null;\r\n  }\r\n  if (!opt_cased) {\r\n    return typeRegistry;\r\n  }\r\n  const nameRegistry = nameMap[type];\r\n  const casedRegistry = Object.create(null);\r\n  for (const key of Object.keys(typeRegistry)) {\r\n    casedRegistry[nameRegistry[key]] = typeRegistry[key];\r\n  }\r\n  return casedRegistry;\r\n}\r\n\r\n/**\r\n * Gets the class from Blockly options for the given type.\r\n * This is used for plugins that override a built in feature. (e.g. Toolbox)\r\n *\r\n * @param type The type of the plugin.\r\n * @param options The option object to check for the given plugin.\r\n * @param opt_throwIfMissing Whether or not to throw an error if we are unable\r\n *     to find the plugin.\r\n * @returns The class for the plugin.\r\n */\r\nexport function getClassFromOptions<T>(\r\n  type: Type<T>,\r\n  options: Options,\r\n  opt_throwIfMissing?: boolean,\r\n): (new (...p1: AnyDuringMigration[]) => T) | null {\r\n  const plugin = options.plugins[String(type)] || DEFAULT;\r\n\r\n  // If the user passed in a plugin class instead of a registered plugin name.\r\n  if (typeof plugin === 'function') {\r\n    return plugin;\r\n  }\r\n  return getClass(type, plugin, opt_throwIfMissing);\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.common\r\n\r\n/* eslint-disable-next-line no-unused-vars */\r\nimport type {Block} from './block.js';\r\nimport {ISelectable} from './blockly.js';\r\nimport {BlockDefinition, Blocks} from './blocks.js';\r\nimport type {Connection} from './connection.js';\r\nimport type {Workspace} from './workspace.js';\r\nimport type {WorkspaceSvg} from './workspace_svg.js';\r\n\r\n/** Database of all workspaces. */\r\nconst WorkspaceDB_ = Object.create(null);\r\n\r\n/**\r\n * Find the workspace with the specified ID.\r\n *\r\n * @param id ID of workspace to find.\r\n * @returns The sought after workspace or null if not found.\r\n */\r\nexport function getWorkspaceById(id: string): Workspace | null {\r\n  return WorkspaceDB_[id] || null;\r\n}\r\n\r\n/**\r\n * Find all workspaces.\r\n *\r\n * @returns Array of workspaces.\r\n */\r\nexport function getAllWorkspaces(): Workspace[] {\r\n  const workspaces = [];\r\n  for (const workspaceId in WorkspaceDB_) {\r\n    workspaces.push(WorkspaceDB_[workspaceId]);\r\n  }\r\n  return workspaces;\r\n}\r\n\r\n/**\r\n * Register a workspace in the workspace db.\r\n *\r\n * @param workspace\r\n */\r\nexport function registerWorkspace(workspace: Workspace) {\r\n  WorkspaceDB_[workspace.id] = workspace;\r\n}\r\n\r\n/**\r\n * Unregister a workspace from the workspace db.\r\n *\r\n * @param workspace\r\n */\r\nexport function unregisterWorkpace(workspace: Workspace) {\r\n  delete WorkspaceDB_[workspace.id];\r\n}\r\n\r\n/**\r\n * The main workspace most recently used.\r\n * Set by Blockly.WorkspaceSvg.prototype.markFocused\r\n */\r\nlet mainWorkspace: Workspace;\r\n\r\n/**\r\n * Returns the last used top level workspace (based on focus).  Try not to use\r\n * this function, particularly if there are multiple Blockly instances on a\r\n * page.\r\n *\r\n * @returns The main workspace.\r\n */\r\nexport function getMainWorkspace(): Workspace {\r\n  return mainWorkspace;\r\n}\r\n\r\n/**\r\n * Sets last used main workspace.\r\n *\r\n * @param workspace The most recently used top level workspace.\r\n */\r\nexport function setMainWorkspace(workspace: Workspace) {\r\n  mainWorkspace = workspace;\r\n}\r\n\r\n/**\r\n * Currently selected copyable object.\r\n */\r\nlet selected: ISelectable | null = null;\r\n\r\n/**\r\n * Returns the currently selected copyable object.\r\n */\r\nexport function getSelected(): ISelectable | null {\r\n  return selected;\r\n}\r\n\r\n/**\r\n * Sets the currently selected block. This function does not visually mark the\r\n * block as selected or fire the required events. If you wish to\r\n * programmatically select a block, use `BlockSvg#select`.\r\n *\r\n * @param newSelection The newly selected block.\r\n * @internal\r\n */\r\nexport function setSelected(newSelection: ISelectable | null) {\r\n  selected = newSelection;\r\n}\r\n\r\n/**\r\n * Container element in which to render the WidgetDiv, DropDownDiv and Tooltip.\r\n */\r\nlet parentContainer: Element | null;\r\n\r\n/**\r\n * Get the container element in which to render the WidgetDiv, DropDownDiv and\r\n * Tooltip.\r\n *\r\n * @returns The parent container.\r\n */\r\nexport function getParentContainer(): Element | null {\r\n  return parentContainer;\r\n}\r\n\r\n/**\r\n * Set the parent container.  This is the container element that the WidgetDiv,\r\n * DropDownDiv, and Tooltip are rendered into the first time `Blockly.inject`\r\n * is called.\r\n * This method is a NOP if called after the first `Blockly.inject`.\r\n *\r\n * @param newParent The container element.\r\n */\r\nexport function setParentContainer(newParent: Element) {\r\n  parentContainer = newParent;\r\n}\r\n\r\n/**\r\n * Size the SVG image to completely fill its container. Call this when the view\r\n * actually changes sizes (e.g. on a window resize/device orientation change).\r\n * See workspace.resizeContents to resize the workspace when the contents\r\n * change (e.g. when a block is added or removed).\r\n * Record the height/width of the SVG image.\r\n *\r\n * @param workspace Any workspace in the SVG.\r\n */\r\nexport function svgResize(workspace: WorkspaceSvg) {\r\n  let mainWorkspace = workspace;\r\n  while (mainWorkspace.options.parentWorkspace) {\r\n    mainWorkspace = mainWorkspace.options.parentWorkspace;\r\n  }\r\n  const svg = mainWorkspace.getParentSvg();\r\n  const cachedSize = mainWorkspace.getCachedParentSvgSize();\r\n  const div = svg.parentElement;\r\n  if (!(div instanceof HTMLElement)) {\r\n    // Workspace deleted, or something.\r\n    return;\r\n  }\r\n\r\n  const width = div.offsetWidth;\r\n  const height = div.offsetHeight;\r\n  if (cachedSize.width !== width) {\r\n    svg.setAttribute('width', width + 'px');\r\n    mainWorkspace.setCachedParentSvgSize(width, null);\r\n  }\r\n  if (cachedSize.height !== height) {\r\n    svg.setAttribute('height', height + 'px');\r\n    mainWorkspace.setCachedParentSvgSize(null, height);\r\n  }\r\n  mainWorkspace.resize();\r\n}\r\n\r\n/**\r\n * All of the connections on blocks that are currently being dragged.\r\n */\r\nexport const draggingConnections: Connection[] = [];\r\n\r\n/**\r\n * Get a map of all the block's descendants mapping their type to the number of\r\n *    children with that type.\r\n *\r\n * @param block The block to map.\r\n * @param opt_stripFollowing Optionally ignore all following\r\n *    statements (blocks that are not inside a value or statement input\r\n *    of the block).\r\n * @returns Map of types to type counts for descendants of the bock.\r\n */\r\nexport function getBlockTypeCounts(\r\n  block: Block,\r\n  opt_stripFollowing?: boolean,\r\n): {[key: string]: number} {\r\n  const typeCountsMap = Object.create(null);\r\n  const descendants = block.getDescendants(true);\r\n  if (opt_stripFollowing) {\r\n    const nextBlock = block.getNextBlock();\r\n    if (nextBlock) {\r\n      const index = descendants.indexOf(nextBlock);\r\n      descendants.splice(index, descendants.length - index);\r\n    }\r\n  }\r\n  for (let i = 0, checkBlock; (checkBlock = descendants[i]); i++) {\r\n    if (typeCountsMap[checkBlock.type]) {\r\n      typeCountsMap[checkBlock.type]++;\r\n    } else {\r\n      typeCountsMap[checkBlock.type] = 1;\r\n    }\r\n  }\r\n  return typeCountsMap;\r\n}\r\n\r\n/**\r\n * Helper function for defining a block from JSON.  The resulting function has\r\n * the correct value of jsonDef at the point in code where jsonInit is called.\r\n *\r\n * @param jsonDef The JSON definition of a block.\r\n * @returns A function that calls jsonInit with the correct value\r\n *     of jsonDef.\r\n */\r\nfunction jsonInitFactory(jsonDef: AnyDuringMigration): () => void {\r\n  return function (this: Block) {\r\n    this.jsonInit(jsonDef);\r\n  };\r\n}\r\n\r\n/**\r\n * Define blocks from an array of JSON block definitions, as might be generated\r\n * by the Blockly Developer Tools.\r\n *\r\n * @param jsonArray An array of JSON block definitions.\r\n */\r\nexport function defineBlocksWithJsonArray(jsonArray: AnyDuringMigration[]) {\r\n  TEST_ONLY.defineBlocksWithJsonArrayInternal(jsonArray);\r\n}\r\n\r\n/**\r\n * Private version of defineBlocksWithJsonArray for stubbing in tests.\r\n */\r\nfunction defineBlocksWithJsonArrayInternal(jsonArray: AnyDuringMigration[]) {\r\n  defineBlocks(createBlockDefinitionsFromJsonArray(jsonArray));\r\n}\r\n\r\n/**\r\n * Define blocks from an array of JSON block definitions, as might be generated\r\n * by the Blockly Developer Tools.\r\n *\r\n * @param jsonArray An array of JSON block definitions.\r\n * @returns A map of the block\r\n *     definitions created.\r\n */\r\nexport function createBlockDefinitionsFromJsonArray(\r\n  jsonArray: AnyDuringMigration[],\r\n): {[key: string]: BlockDefinition} {\r\n  const blocks: {[key: string]: BlockDefinition} = {};\r\n  for (let i = 0; i < jsonArray.length; i++) {\r\n    const elem = jsonArray[i];\r\n    if (!elem) {\r\n      console.warn(`Block definition #${i} in JSON array is ${elem}. Skipping`);\r\n      continue;\r\n    }\r\n    const type = elem['type'];\r\n    if (!type) {\r\n      console.warn(\r\n        `Block definition #${i} in JSON array is missing a type attribute. ` +\r\n          'Skipping.',\r\n      );\r\n      continue;\r\n    }\r\n    blocks[type] = {init: jsonInitFactory(elem)};\r\n  }\r\n  return blocks;\r\n}\r\n\r\n/**\r\n * Add the specified block definitions to the block definitions\r\n * dictionary (Blockly.Blocks).\r\n *\r\n * @param blocks A map of block\r\n *     type names to block definitions.\r\n */\r\nexport function defineBlocks(blocks: {[key: string]: BlockDefinition}) {\r\n  // Iterate over own enumerable properties.\r\n  for (const type of Object.keys(blocks)) {\r\n    const definition = blocks[type];\r\n    if (type in Blocks) {\r\n      console.warn(`Block definiton \"${type}\" overwrites previous definition.`);\r\n    }\r\n    Blocks[type] = definition;\r\n  }\r\n}\r\n\r\nexport const TEST_ONLY = {defineBlocksWithJsonArrayInternal};\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.utils.idGenerator\r\n\r\n/**\r\n * Legal characters for the universally unique IDs.  Should be all on\r\n * a US keyboard.  No characters that conflict with XML or JSON.\r\n * Requests to remove additional 'problematic' characters from this\r\n * soup will be denied.  That's your failure to properly escape in\r\n * your own environment.  Issues #251, #625, #682, #1304.\r\n */\r\nconst soup =\r\n  '!#$%()*+,-./:;=?@[]^_`{|}~' +\r\n  'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\r\n\r\n/**\r\n * Namespace object for internal implementations we want to be able to\r\n * stub in tests. Do not use externally.\r\n *\r\n * @internal\r\n */\r\nconst internal = {\r\n  /**\r\n   * Generate a random unique ID.  This should be globally unique.\r\n   * 87 characters ^ 20 length is greater than 128 bits (better than a UUID).\r\n   *\r\n   * @returns A globally unique ID string.\r\n   */\r\n  genUid: () => {\r\n    const length = 20;\r\n    const soupLength = soup.length;\r\n    const id = [];\r\n    for (let i = 0; i < length; i++) {\r\n      id[i] = soup.charAt(Math.random() * soupLength);\r\n    }\r\n    return id.join('');\r\n  },\r\n};\r\nexport const TEST_ONLY = internal;\r\n\r\n/** Next unique ID to use. */\r\nlet nextId = 0;\r\n\r\n/**\r\n * Generate the next unique element IDs.\r\n * IDs are compatible with the HTML4 'id' attribute restrictions:\r\n * Use only ASCII letters, digits, '_', '-' and '.'\r\n *\r\n * For UUIDs use genUid (below) instead; this ID generator should\r\n * primarily be used for IDs that end up in the DOM.\r\n *\r\n * @returns The next unique identifier.\r\n */\r\nexport function getNextUniqueId(): string {\r\n  return 'blockly-' + (nextId++).toString(36);\r\n}\r\n\r\n/**\r\n * Generate a random unique ID.\r\n *\r\n * @see internal.genUid\r\n * @returns A globally unique ID string.\r\n */\r\nexport function genUid(): string {\r\n  return internal.genUid();\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.Events.utils\r\n\r\nimport type {Block} from '../block.js';\r\nimport * as common from '../common.js';\r\nimport * as registry from '../registry.js';\r\nimport * as idGenerator from '../utils/idgenerator.js';\r\nimport type {Workspace} from '../workspace.js';\r\nimport type {WorkspaceSvg} from '../workspace_svg.js';\r\n\r\nimport type {Abstract} from './events_abstract.js';\r\nimport type {BlockChange} from './events_block_change.js';\r\nimport type {BlockCreate} from './events_block_create.js';\r\nimport type {BlockMove} from './events_block_move.js';\r\nimport type {CommentCreate} from './events_comment_create.js';\r\nimport type {CommentMove} from './events_comment_move.js';\r\nimport type {ViewportChange} from './events_viewport.js';\r\n\r\n/** Group ID for new events.  Grouped events are indivisible. */\r\nlet group = '';\r\n\r\n/** Sets whether the next event should be added to the undo stack. */\r\nlet recordUndo = true;\r\n\r\n/**\r\n * Sets whether events should be added to the undo stack.\r\n *\r\n * @param newValue True if events should be added to the undo stack.\r\n */\r\nexport function setRecordUndo(newValue: boolean) {\r\n  recordUndo = newValue;\r\n}\r\n\r\n/**\r\n * Returns whether or not events will be added to the undo stack.\r\n *\r\n * @returns True if events will be added to the undo stack.\r\n */\r\nexport function getRecordUndo(): boolean {\r\n  return recordUndo;\r\n}\r\n\r\n/** Allow change events to be created and fired. */\r\nlet disabled = 0;\r\n\r\n/**\r\n * Name of event that creates a block. Will be deprecated for BLOCK_CREATE.\r\n */\r\nexport const CREATE = 'create';\r\n\r\n/**\r\n * Name of event that creates a block.\r\n */\r\nexport const BLOCK_CREATE = CREATE;\r\n\r\n/**\r\n * Name of event that deletes a block. Will be deprecated for BLOCK_DELETE.\r\n */\r\nexport const DELETE = 'delete';\r\n\r\n/**\r\n * Name of event that deletes a block.\r\n */\r\nexport const BLOCK_DELETE = DELETE;\r\n\r\n/**\r\n * Name of event that changes a block. Will be deprecated for BLOCK_CHANGE.\r\n */\r\nexport const CHANGE = 'change';\r\n\r\n/**\r\n * Name of event that changes a block.\r\n */\r\nexport const BLOCK_CHANGE = CHANGE;\r\n\r\n/**\r\n * Name of event representing an in-progress change to a field of a block, which\r\n * is expected to be followed by a block change event.\r\n */\r\nexport const BLOCK_FIELD_INTERMEDIATE_CHANGE =\r\n  'block_field_intermediate_change';\r\n\r\n/**\r\n * Name of event that moves a block. Will be deprecated for BLOCK_MOVE.\r\n */\r\nexport const MOVE = 'move';\r\n\r\n/**\r\n * Name of event that moves a block.\r\n */\r\nexport const BLOCK_MOVE = MOVE;\r\n\r\n/**\r\n * Name of event that creates a variable.\r\n */\r\nexport const VAR_CREATE = 'var_create';\r\n\r\n/**\r\n * Name of event that deletes a variable.\r\n */\r\nexport const VAR_DELETE = 'var_delete';\r\n\r\n/**\r\n * Name of event that renames a variable.\r\n */\r\nexport const VAR_RENAME = 'var_rename';\r\n\r\n/**\r\n * Name of generic event that records a UI change.\r\n */\r\nexport const UI = 'ui';\r\n\r\n/**\r\n * Name of event that record a block drags a block.\r\n */\r\nexport const BLOCK_DRAG = 'drag';\r\n\r\n/**\r\n * Name of event that records a change in selected element.\r\n */\r\nexport const SELECTED = 'selected';\r\n\r\n/**\r\n * Name of event that records a click.\r\n */\r\nexport const CLICK = 'click';\r\n\r\n/**\r\n * Name of event that records a marker move.\r\n */\r\nexport const MARKER_MOVE = 'marker_move';\r\n\r\n/**\r\n * Name of event that records a bubble open.\r\n */\r\nexport const BUBBLE_OPEN = 'bubble_open';\r\n\r\n/**\r\n * Name of event that records a trashcan open.\r\n */\r\nexport const TRASHCAN_OPEN = 'trashcan_open';\r\n\r\n/**\r\n * Name of event that records a toolbox item select.\r\n */\r\nexport const TOOLBOX_ITEM_SELECT = 'toolbox_item_select';\r\n\r\n/**\r\n * Name of event that records a theme change.\r\n */\r\nexport const THEME_CHANGE = 'theme_change';\r\n\r\n/**\r\n * Name of event that records a viewport change.\r\n */\r\nexport const VIEWPORT_CHANGE = 'viewport_change';\r\n\r\n/**\r\n * Name of event that creates a comment.\r\n */\r\nexport const COMMENT_CREATE = 'comment_create';\r\n\r\n/**\r\n * Name of event that deletes a comment.\r\n */\r\nexport const COMMENT_DELETE = 'comment_delete';\r\n\r\n/**\r\n * Name of event that changes a comment.\r\n */\r\nexport const COMMENT_CHANGE = 'comment_change';\r\n\r\n/**\r\n * Name of event that moves a comment.\r\n */\r\nexport const COMMENT_MOVE = 'comment_move';\r\n\r\n/**\r\n * Name of event that records a workspace load.\r\n */\r\nexport const FINISHED_LOADING = 'finished_loading';\r\n\r\n/**\r\n * Type of events that cause objects to be bumped back into the visible\r\n * portion of the workspace.\r\n *\r\n * Not to be confused with bumping so that disconnected connections do not\r\n * appear connected.\r\n */\r\nexport type BumpEvent = BlockCreate | BlockMove | CommentCreate | CommentMove;\r\n\r\n/**\r\n * List of events that cause objects to be bumped back into the visible\r\n * portion of the workspace.\r\n *\r\n * Not to be confused with bumping so that disconnected connections do not\r\n * appear connected.\r\n */\r\nexport const BUMP_EVENTS: string[] = [\r\n  BLOCK_CREATE,\r\n  BLOCK_MOVE,\r\n  COMMENT_CREATE,\r\n  COMMENT_MOVE,\r\n];\r\n\r\n/** List of events queued for firing. */\r\nconst FIRE_QUEUE: Abstract[] = [];\r\n\r\n/**\r\n * Create a custom event and fire it.\r\n *\r\n * @param event Custom data for event.\r\n */\r\nexport function fire(event: Abstract) {\r\n  TEST_ONLY.fireInternal(event);\r\n}\r\n\r\n/**\r\n * Private version of fireInternal for stubbing in tests.\r\n */\r\nfunction fireInternal(event: Abstract) {\r\n  if (!isEnabled()) {\r\n    return;\r\n  }\r\n  if (!FIRE_QUEUE.length) {\r\n    // First event added; schedule a firing of the event queue.\r\n    try {\r\n      // If we are in a browser context, we want to make sure that the event\r\n      // fires after blocks have been rerendered this frame.\r\n      requestAnimationFrame(() => {\r\n        setTimeout(fireNow, 0);\r\n      });\r\n    } catch (e) {\r\n      // Otherwise we just want to delay so events can be coallesced.\r\n      // requestAnimationFrame will error triggering this.\r\n      setTimeout(fireNow, 0);\r\n    }\r\n  }\r\n  FIRE_QUEUE.push(event);\r\n}\r\n\r\n/** Fire all queued events. */\r\nfunction fireNow() {\r\n  const queue = filter(FIRE_QUEUE, true);\r\n  FIRE_QUEUE.length = 0;\r\n  for (let i = 0, event; (event = queue[i]); i++) {\r\n    if (!event.workspaceId) {\r\n      continue;\r\n    }\r\n    const eventWorkspace = common.getWorkspaceById(event.workspaceId);\r\n    if (eventWorkspace) {\r\n      eventWorkspace.fireChangeListener(event);\r\n    }\r\n  }\r\n\r\n  // Post-filter the undo stack to squash and remove any events that result in\r\n  // a null event\r\n\r\n  // 1. Determine which workspaces will need to have their undo stacks validated\r\n  const workspaceIds = new Set(queue.map((e) => e.workspaceId));\r\n  for (const workspaceId of workspaceIds) {\r\n    // Only process valid workspaces\r\n    if (!workspaceId) {\r\n      continue;\r\n    }\r\n    const eventWorkspace = common.getWorkspaceById(workspaceId);\r\n    if (!eventWorkspace) {\r\n      continue;\r\n    }\r\n\r\n    // Find the last contiguous group of events on the stack\r\n    const undoStack = eventWorkspace.getUndoStack();\r\n    let i;\r\n    let group: string | undefined = undefined;\r\n    for (i = undoStack.length; i > 0; i--) {\r\n      const event = undoStack[i - 1];\r\n      if (event.group === '') {\r\n        break;\r\n      } else if (group === undefined) {\r\n        group = event.group;\r\n      } else if (event.group !== group) {\r\n        break;\r\n      }\r\n    }\r\n    if (!group || i == undoStack.length - 1) {\r\n      // Need a group of two or more events on the stack. Nothing to do here.\r\n      continue;\r\n    }\r\n\r\n    // Extract the event group, filter, and add back to the undo stack\r\n    let events = undoStack.splice(i, undoStack.length - i);\r\n    events = filter(events, true);\r\n    undoStack.push(...events);\r\n  }\r\n}\r\n\r\n/**\r\n * Filter the queued events and merge duplicates.\r\n *\r\n * @param queueIn Array of events.\r\n * @param forward True if forward (redo), false if backward (undo).\r\n * @returns Array of filtered events.\r\n */\r\nexport function filter(queueIn: Abstract[], forward: boolean): Abstract[] {\r\n  let queue = queueIn.slice();\r\n  // Shallow copy of queue.\r\n  if (!forward) {\r\n    // Undo is merged in reverse order.\r\n    queue.reverse();\r\n  }\r\n  const mergedQueue = [];\r\n  const hash = Object.create(null);\r\n  // Merge duplicates.\r\n  for (let i = 0, event; (event = queue[i]); i++) {\r\n    if (!event.isNull()) {\r\n      // Treat all UI events as the same type in hash table.\r\n      const eventType = event.isUiEvent ? UI : event.type;\r\n      // TODO(#5927): Check whether `blockId` exists before accessing it.\r\n      const blockId = (event as AnyDuringMigration).blockId;\r\n      const key = [eventType, blockId, event.workspaceId].join(' ');\r\n\r\n      const lastEntry = hash[key];\r\n      const lastEvent = lastEntry ? lastEntry.event : null;\r\n      if (!lastEntry) {\r\n        // Each item in the hash table has the event and the index of that event\r\n        // in the input array.  This lets us make sure we only merge adjacent\r\n        // move events.\r\n        hash[key] = {event, index: i};\r\n        mergedQueue.push(event);\r\n      } else if (event.type === MOVE && lastEntry.index === i - 1) {\r\n        const moveEvent = event as BlockMove;\r\n        // Merge move events.\r\n        lastEvent.newParentId = moveEvent.newParentId;\r\n        lastEvent.newInputName = moveEvent.newInputName;\r\n        lastEvent.newCoordinate = moveEvent.newCoordinate;\r\n        if (moveEvent.reason) {\r\n          if (lastEvent.reason) {\r\n            // Concatenate reasons without duplicates.\r\n            const reasonSet = new Set(\r\n              moveEvent.reason.concat(lastEvent.reason),\r\n            );\r\n            lastEvent.reason = Array.from(reasonSet);\r\n          } else {\r\n            lastEvent.reason = moveEvent.reason;\r\n          }\r\n        }\r\n        lastEntry.index = i;\r\n      } else if (\r\n        event.type === CHANGE &&\r\n        (event as BlockChange).element === lastEvent.element &&\r\n        (event as BlockChange).name === lastEvent.name\r\n      ) {\r\n        const changeEvent = event as BlockChange;\r\n        // Merge change events.\r\n        lastEvent.newValue = changeEvent.newValue;\r\n      } else if (event.type === VIEWPORT_CHANGE) {\r\n        const viewportEvent = event as ViewportChange;\r\n        // Merge viewport change events.\r\n        lastEvent.viewTop = viewportEvent.viewTop;\r\n        lastEvent.viewLeft = viewportEvent.viewLeft;\r\n        lastEvent.scale = viewportEvent.scale;\r\n        lastEvent.oldScale = viewportEvent.oldScale;\r\n      } else if (event.type === CLICK && lastEvent.type === BUBBLE_OPEN) {\r\n        // Drop click events caused by opening/closing bubbles.\r\n      } else {\r\n        // Collision: newer events should merge into this event to maintain\r\n        // order.\r\n        hash[key] = {event, index: i};\r\n        mergedQueue.push(event);\r\n      }\r\n    }\r\n  }\r\n  // Filter out any events that have become null due to merging.\r\n  queue = mergedQueue.filter(function (e) {\r\n    return !e.isNull();\r\n  });\r\n  if (!forward) {\r\n    // Restore undo order.\r\n    queue.reverse();\r\n  }\r\n  // Move mutation events to the top of the queue.\r\n  // Intentionally skip first event.\r\n  for (let i = 1, event; (event = queue[i]); i++) {\r\n    // AnyDuringMigration because:  Property 'element' does not exist on type\r\n    // 'Abstract'.\r\n    if (\r\n      event.type === CHANGE &&\r\n      (event as AnyDuringMigration).element === 'mutation'\r\n    ) {\r\n      queue.unshift(queue.splice(i, 1)[0]);\r\n    }\r\n  }\r\n  return queue;\r\n}\r\n\r\n/**\r\n * Modify pending undo events so that when they are fired they don't land\r\n * in the undo stack.  Called by Workspace.clearUndo.\r\n */\r\nexport function clearPendingUndo() {\r\n  for (let i = 0, event; (event = FIRE_QUEUE[i]); i++) {\r\n    event.recordUndo = false;\r\n  }\r\n}\r\n\r\n/**\r\n * Stop sending events.  Every call to this function MUST also call enable.\r\n */\r\nexport function disable() {\r\n  disabled++;\r\n}\r\n\r\n/**\r\n * Start sending events.  Unless events were already disabled when the\r\n * corresponding call to disable was made.\r\n */\r\nexport function enable() {\r\n  disabled--;\r\n}\r\n\r\n/**\r\n * Returns whether events may be fired or not.\r\n *\r\n * @returns True if enabled.\r\n */\r\nexport function isEnabled(): boolean {\r\n  return disabled === 0;\r\n}\r\n\r\n/**\r\n * Current group.\r\n *\r\n * @returns ID string.\r\n */\r\nexport function getGroup(): string {\r\n  return group;\r\n}\r\n\r\n/**\r\n * Start or stop a group.\r\n *\r\n * @param state True to start new group, false to end group.\r\n *   String to set group explicitly.\r\n */\r\nexport function setGroup(state: boolean | string) {\r\n  TEST_ONLY.setGroupInternal(state);\r\n}\r\n\r\n/**\r\n * Private version of setGroup for stubbing in tests.\r\n */\r\nfunction setGroupInternal(state: boolean | string) {\r\n  if (typeof state === 'boolean') {\r\n    group = state ? idGenerator.genUid() : '';\r\n  } else {\r\n    group = state;\r\n  }\r\n}\r\n\r\n/**\r\n * Compute a list of the IDs of the specified block and all its descendants.\r\n *\r\n * @param block The root block.\r\n * @returns List of block IDs.\r\n * @internal\r\n */\r\nexport function getDescendantIds(block: Block): string[] {\r\n  const ids = [];\r\n  const descendants = block.getDescendants(false);\r\n  for (let i = 0, descendant; (descendant = descendants[i]); i++) {\r\n    ids[i] = descendant.id;\r\n  }\r\n  return ids;\r\n}\r\n\r\n/**\r\n * Decode the JSON into an event.\r\n *\r\n * @param json JSON representation.\r\n * @param workspace Target workspace for event.\r\n * @returns The event represented by the JSON.\r\n * @throws {Error} if an event type is not found in the registry.\r\n */\r\nexport function fromJson(\r\n  json: AnyDuringMigration,\r\n  workspace: Workspace,\r\n): Abstract {\r\n  const eventClass = get(json['type']);\r\n  if (!eventClass) throw Error('Unknown event type.');\r\n\r\n  return (eventClass as any).fromJson(json, workspace);\r\n}\r\n\r\n/**\r\n * Gets the class for a specific event type from the registry.\r\n *\r\n * @param eventType The type of the event to get.\r\n * @returns The event class with the given type.\r\n */\r\nexport function get(\r\n  eventType: string,\r\n): new (...p1: AnyDuringMigration[]) => Abstract {\r\n  const event = registry.getClass(registry.Type.EVENT, eventType);\r\n  if (!event) {\r\n    throw new Error(`Event type ${eventType} not found in registry.`);\r\n  }\r\n  return event;\r\n}\r\n\r\n/**\r\n * Enable/disable a block depending on whether it is properly connected.\r\n * Use this on applications where all blocks should be connected to a top block.\r\n * Recommend setting the 'disable' option to 'false' in the config so that\r\n * users don't try to re-enable disabled orphan blocks.\r\n *\r\n * @param event Custom data for event.\r\n */\r\nexport function disableOrphans(event: Abstract) {\r\n  if (event.type === MOVE || event.type === CREATE) {\r\n    const blockEvent = event as BlockMove | BlockCreate;\r\n    if (!blockEvent.workspaceId) {\r\n      return;\r\n    }\r\n    const eventWorkspace = common.getWorkspaceById(\r\n      blockEvent.workspaceId,\r\n    ) as WorkspaceSvg;\r\n    if (!blockEvent.blockId) {\r\n      throw new Error('Encountered a blockEvent without a proper blockId');\r\n    }\r\n    let block = eventWorkspace.getBlockById(blockEvent.blockId);\r\n    if (block) {\r\n      // Changing blocks as part of this event shouldn't be undoable.\r\n      const initialUndoFlag = recordUndo;\r\n      try {\r\n        recordUndo = false;\r\n        const parent = block.getParent();\r\n        if (parent && parent.isEnabled()) {\r\n          const children = block.getDescendants(false);\r\n          for (let i = 0, child; (child = children[i]); i++) {\r\n            child.setEnabled(true);\r\n          }\r\n        } else if (\r\n          (block.outputConnection || block.previousConnection) &&\r\n          !eventWorkspace.isDragging()\r\n        ) {\r\n          do {\r\n            block.setEnabled(false);\r\n            block = block.getNextBlock();\r\n          } while (block);\r\n        }\r\n      } finally {\r\n        recordUndo = initialUndoFlag;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport const TEST_ONLY = {\r\n  FIRE_QUEUE,\r\n  fireNow,\r\n  fireInternal,\r\n  setGroupInternal,\r\n};\r\n","/**\r\n * @license\r\n * Copyright 2016 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.Touch\r\n\r\nimport type {Gesture} from './gesture.js';\r\n\r\n/** Length in ms for a touch to become a long press. */\r\nconst LONGPRESS = 750;\r\n\r\n/**\r\n * Whether touch is enabled in the browser.\r\n * Copied from Closure's goog.events.BrowserFeature.TOUCH_ENABLED\r\n */\r\nexport const TOUCH_ENABLED =\r\n  'ontouchstart' in globalThis ||\r\n  !!(\r\n    globalThis['document'] &&\r\n    document.documentElement &&\r\n    'ontouchstart' in document.documentElement\r\n  ) || // IE10 uses non-standard touch events,\r\n  // so it has a different check.\r\n  !!(\r\n    globalThis['navigator'] &&\r\n    (globalThis['navigator']['maxTouchPoints'] ||\r\n      (globalThis['navigator'] as any)['msMaxTouchPoints'])\r\n  );\r\n\r\n/** Which touch events are we currently paying attention to? */\r\nlet touchIdentifier_: string | null = null;\r\n\r\n/**\r\n * The TOUCH_MAP lookup dictionary specifies additional touch events to fire,\r\n * in conjunction with mouse events.\r\n */\r\nexport const TOUCH_MAP: {[key: string]: string[]} = {\r\n  'mousedown': ['pointerdown'],\r\n  'mouseenter': ['pointerenter'],\r\n  'mouseleave': ['pointerleave'],\r\n  'mousemove': ['pointermove'],\r\n  'mouseout': ['pointerout'],\r\n  'mouseover': ['pointerover'],\r\n  'mouseup': ['pointerup', 'pointercancel'],\r\n  'touchend': ['pointerup'],\r\n  'touchcancel': ['pointercancel'],\r\n};\r\n\r\n/** PID of queued long-press task. */\r\nlet longPid_: AnyDuringMigration = 0;\r\n\r\n/**\r\n * Context menus on touch devices are activated using a long-press.\r\n * Unfortunately the contextmenu touch event is currently (2015) only supported\r\n * by Chrome.  This function is fired on any touchstart event, queues a task,\r\n * which after about a second opens the context menu.  The tasks is killed\r\n * if the touch event terminates early.\r\n *\r\n * @param e Touch start event.\r\n * @param gesture The gesture that triggered this longStart.\r\n * @internal\r\n */\r\nexport function longStart(e: PointerEvent, gesture: Gesture) {\r\n  longStop();\r\n  longPid_ = setTimeout(function () {\r\n    // Let the gesture route the right-click correctly.\r\n    if (gesture) {\r\n      gesture.handleRightClick(e);\r\n    }\r\n  }, LONGPRESS);\r\n}\r\n\r\n/**\r\n * Nope, that's not a long-press.  Either touchend or touchcancel was fired,\r\n * or a drag hath begun.  Kill the queued long-press task.\r\n *\r\n * @internal\r\n */\r\nexport function longStop() {\r\n  if (longPid_) {\r\n    clearTimeout(longPid_);\r\n    longPid_ = 0;\r\n  }\r\n}\r\n\r\n/**\r\n * Clear the touch identifier that tracks which touch stream to pay attention\r\n * to.  This ends the current drag/gesture and allows other pointers to be\r\n * captured.\r\n */\r\nexport function clearTouchIdentifier() {\r\n  touchIdentifier_ = null;\r\n}\r\n\r\n/**\r\n * Decide whether Blockly should handle or ignore this event.\r\n * Mouse and touch events require special checks because we only want to deal\r\n * with one touch stream at a time.  All other events should always be handled.\r\n *\r\n * @param e The event to check.\r\n * @returns True if this event should be passed through to the registered\r\n *     handler; false if it should be blocked.\r\n */\r\nexport function shouldHandleEvent(e: Event): boolean {\r\n  // Do not replace the startsWith with a check for `instanceof PointerEvent`.\r\n  // `click` and `contextmenu` are PointerEvents in some browsers,\r\n  // despite not starting with `pointer`, but we want to always handle them\r\n  // without worrying about touch identifiers.\r\n  return (\r\n    !e.type.startsWith('pointer') ||\r\n    (e instanceof PointerEvent && checkTouchIdentifier(e))\r\n  );\r\n}\r\n\r\n/**\r\n * Get the pointer identifier from the given event.\r\n *\r\n * @param e Pointer event.\r\n * @returns The pointerId of the event.\r\n */\r\nexport function getTouchIdentifierFromEvent(e: PointerEvent): string {\r\n  return `${e.pointerId}`;\r\n}\r\n\r\n/**\r\n * Check whether the pointer identifier on the event matches the current saved\r\n * identifier. If the current identifier was unset, save the identifier from\r\n * the event. This starts a drag/gesture, during which pointer events with\r\n * other identifiers will be silently ignored.\r\n *\r\n * @param e Pointer event.\r\n * @returns Whether the identifier on the event matches the current saved\r\n *     identifier.\r\n */\r\nexport function checkTouchIdentifier(e: PointerEvent): boolean {\r\n  const identifier = getTouchIdentifierFromEvent(e);\r\n\r\n  if (touchIdentifier_) {\r\n    // We're already tracking some touch/mouse event.  Is this from the same\r\n    // source?\r\n    return touchIdentifier_ === identifier;\r\n  }\r\n  if (e.type === 'pointerdown') {\r\n    // No identifier set yet, and this is the start of a drag.  Set it and\r\n    // return.\r\n    touchIdentifier_ = identifier;\r\n    return true;\r\n  }\r\n  // There was no identifier yet, but this wasn't a start event so we're going\r\n  // to ignore it.  This probably means that another drag finished while this\r\n  // pointer was down.\r\n  return false;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.browserEvents\r\n\r\nimport * as Touch from './touch.js';\r\nimport * as userAgent from './utils/useragent.js';\r\n\r\n/**\r\n * Blockly opaque event data used to unbind events when using\r\n * `bind` and `conditionalBind`.\r\n */\r\nexport type Data = [EventTarget, string, (e: Event) => void][];\r\n\r\n/**\r\n * The multiplier for scroll wheel deltas using the line delta mode.\r\n * See https://developer.mozilla.org/en-US/docs/Web/API/WheelEvent/deltaMode\r\n * for more information on deltaMode.\r\n */\r\nconst LINE_MODE_MULTIPLIER = 40;\r\n\r\n/**\r\n * The multiplier for scroll wheel deltas using the page delta mode.\r\n * See https://developer.mozilla.org/en-US/docs/Web/API/WheelEvent/deltaMode\r\n * for more information on deltaMode.\r\n */\r\nconst PAGE_MODE_MULTIPLIER = 125;\r\n\r\n/**\r\n * Bind an event handler that can be ignored if it is not part of the active\r\n * touch stream.\r\n * Use this for events that either start or continue a multi-part gesture (e.g.\r\n * mousedown or mousemove, which may be part of a drag or click).\r\n *\r\n * @param node Node upon which to listen.\r\n * @param name Event name to listen to (e.g. 'mousedown').\r\n * @param thisObject The value of 'this' in the function.\r\n * @param func Function to call when event is triggered.\r\n * @param opt_noCaptureIdentifier True if triggering on this event should not\r\n *     block execution of other event handlers on this touch or other\r\n *     simultaneous touches.  False by default.\r\n * @returns Opaque data that can be passed to unbindEvent_.\r\n */\r\nexport function conditionalBind(\r\n  node: EventTarget,\r\n  name: string,\r\n  thisObject: Object | null,\r\n  func: Function,\r\n  opt_noCaptureIdentifier?: boolean,\r\n): Data {\r\n  /**\r\n   *\r\n   * @param e\r\n   */\r\n  function wrapFunc(e: Event) {\r\n    const captureIdentifier = !opt_noCaptureIdentifier;\r\n\r\n    if (!(captureIdentifier && !Touch.shouldHandleEvent(e))) {\r\n      if (thisObject) {\r\n        func.call(thisObject, e);\r\n      } else {\r\n        func(e);\r\n      }\r\n    }\r\n  }\r\n\r\n  const bindData: Data = [];\r\n  if (name in Touch.TOUCH_MAP) {\r\n    for (let i = 0; i < Touch.TOUCH_MAP[name].length; i++) {\r\n      const type = Touch.TOUCH_MAP[name][i];\r\n      node.addEventListener(type, wrapFunc, false);\r\n      bindData.push([node, type, wrapFunc]);\r\n    }\r\n  } else {\r\n    node.addEventListener(name, wrapFunc, false);\r\n    bindData.push([node, name, wrapFunc]);\r\n  }\r\n  return bindData;\r\n}\r\n\r\n/**\r\n * Bind an event handler that should be called regardless of whether it is part\r\n * of the active touch stream.\r\n * Use this for events that are not part of a multi-part gesture (e.g.\r\n * mouseover for tooltips).\r\n *\r\n * @param node Node upon which to listen.\r\n * @param name Event name to listen to (e.g. 'mousedown').\r\n * @param thisObject The value of 'this' in the function.\r\n * @param func Function to call when event is triggered.\r\n * @returns Opaque data that can be passed to unbindEvent_.\r\n */\r\nexport function bind(\r\n  node: EventTarget,\r\n  name: string,\r\n  thisObject: Object | null,\r\n  func: Function,\r\n): Data {\r\n  /**\r\n   *\r\n   * @param e\r\n   */\r\n  function wrapFunc(e: Event) {\r\n    if (thisObject) {\r\n      func.call(thisObject, e);\r\n    } else {\r\n      func(e);\r\n    }\r\n  }\r\n\r\n  const bindData: Data = [];\r\n  if (name in Touch.TOUCH_MAP) {\r\n    for (let i = 0; i < Touch.TOUCH_MAP[name].length; i++) {\r\n      const type = Touch.TOUCH_MAP[name][i];\r\n      node.addEventListener(type, wrapFunc, false);\r\n      bindData.push([node, type, wrapFunc]);\r\n    }\r\n  } else {\r\n    node.addEventListener(name, wrapFunc, false);\r\n    bindData.push([node, name, wrapFunc]);\r\n  }\r\n  return bindData;\r\n}\r\n\r\n/**\r\n * Unbind one or more events event from a function call.\r\n *\r\n * @param bindData Opaque data from bindEvent_.\r\n *     This list is emptied during the course of calling this function.\r\n * @returns The function call.\r\n */\r\nexport function unbind(bindData: Data): (e: Event) => void {\r\n  // Accessing an element of the last property of the array is unsafe if the\r\n  // bindData is an empty array. But that should never happen because developers\r\n  // should only pass Data from bind or conditionalBind.\r\n  const callback = bindData[bindData.length - 1][2];\r\n  while (bindData.length) {\r\n    const [node, name, func] = bindData.pop()!;\r\n    node.removeEventListener(name, func, false);\r\n  }\r\n  return callback;\r\n}\r\n\r\n/**\r\n * Returns true if this event is targeting a text input widget?\r\n *\r\n * @param e An event.\r\n * @returns True if text input.\r\n */\r\nexport function isTargetInput(e: Event): boolean {\r\n  if (e.target instanceof HTMLElement) {\r\n    if (\r\n      e.target.isContentEditable ||\r\n      e.target.getAttribute('data-is-text-input') === 'true'\r\n    ) {\r\n      return true;\r\n    }\r\n\r\n    if (e.target instanceof HTMLInputElement) {\r\n      const target = e.target;\r\n      return (\r\n        target.type === 'text' ||\r\n        target.type === 'number' ||\r\n        target.type === 'email' ||\r\n        target.type === 'password' ||\r\n        target.type === 'search' ||\r\n        target.type === 'tel' ||\r\n        target.type === 'url'\r\n      );\r\n    }\r\n\r\n    if (e.target instanceof HTMLTextAreaElement) {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\n/**\r\n * Returns true this event is a right-click.\r\n *\r\n * @param e Mouse event.\r\n * @returns True if right-click.\r\n */\r\nexport function isRightButton(e: MouseEvent): boolean {\r\n  if (e.ctrlKey && userAgent.MAC) {\r\n    // Control-clicking on Mac OS X is treated as a right-click.\r\n    // WebKit on Mac OS X fails to change button to 2 (but Gecko does).\r\n    return true;\r\n  }\r\n  return e.button === 2;\r\n}\r\n\r\n/**\r\n * Returns the converted coordinates of the given mouse event.\r\n * The origin (0,0) is the top-left corner of the Blockly SVG.\r\n *\r\n * @param e Mouse event.\r\n * @param svg SVG element.\r\n * @param matrix Inverted screen CTM to use.\r\n * @returns Object with .x and .y properties.\r\n */\r\nexport function mouseToSvg(\r\n  e: MouseEvent,\r\n  svg: SVGSVGElement,\r\n  matrix: SVGMatrix | null,\r\n): SVGPoint {\r\n  const svgPoint = svg.createSVGPoint();\r\n  svgPoint.x = e.clientX;\r\n  svgPoint.y = e.clientY;\r\n\r\n  if (!matrix) {\r\n    matrix = svg.getScreenCTM()!.inverse();\r\n  }\r\n  return svgPoint.matrixTransform(matrix);\r\n}\r\n\r\n/**\r\n * Returns the scroll delta of a mouse event in pixel units.\r\n *\r\n * @param e Mouse event.\r\n * @returns Scroll delta object with .x and .y properties.\r\n */\r\nexport function getScrollDeltaPixels(e: WheelEvent): {x: number; y: number} {\r\n  switch (e.deltaMode) {\r\n    case 0x00: // Pixel mode.\r\n    default:\r\n      return {x: e.deltaX, y: e.deltaY};\r\n    case 0x01: // Line mode.\r\n      return {\r\n        x: e.deltaX * LINE_MODE_MULTIPLIER,\r\n        y: e.deltaY * LINE_MODE_MULTIPLIER,\r\n      };\r\n    case 0x02: // Page mode.\r\n      return {\r\n        x: e.deltaX * PAGE_MODE_MULTIPLIER,\r\n        y: e.deltaY * PAGE_MODE_MULTIPLIER,\r\n      };\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.utils.array\r\n\r\n/**\r\n * Removes the first occurrence of a particular value from an array.\r\n *\r\n * @param arr Array from which to remove value.\r\n * @param value Value to remove.\r\n * @returns True if an element was removed.\r\n * @internal\r\n */\r\nexport function removeElem<T>(arr: Array<T>, value: T): boolean {\r\n  const i = arr.indexOf(value);\r\n  if (i === -1) {\r\n    return false;\r\n  }\r\n  arr.splice(i, 1);\r\n  return true;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2013 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.Css\r\n\r\n/** Has CSS already been injected? */\r\nlet injected = false;\r\n\r\n/**\r\n * Add some CSS to the blob that will be injected later.  Allows optional\r\n * components such as fields and the toolbox to store separate CSS.\r\n *\r\n * @param cssContent Multiline CSS string or an array of single lines of CSS.\r\n */\r\nexport function register(cssContent: string) {\r\n  if (injected) {\r\n    throw Error('CSS already injected');\r\n  }\r\n  content += '\\n' + cssContent;\r\n}\r\n\r\n/**\r\n * Inject the CSS into the DOM.  This is preferable over using a regular CSS\r\n * file since:\r\n * a) It loads synchronously and doesn't force a redraw later.\r\n * b) It speeds up loading by not blocking on a separate HTTP transfer.\r\n * c) The CSS content may be made dynamic depending on init options.\r\n *\r\n * @param hasCss If false, don't inject CSS (providing CSS becomes the\r\n *     document's responsibility).\r\n * @param pathToMedia Path from page to the Blockly media directory.\r\n */\r\nexport function inject(hasCss: boolean, pathToMedia: string) {\r\n  // Only inject the CSS once.\r\n  if (injected) {\r\n    return;\r\n  }\r\n  injected = true;\r\n  if (!hasCss) {\r\n    return;\r\n  }\r\n  // Strip off any trailing slash (either Unix or Windows).\r\n  const mediaPath = pathToMedia.replace(/[\\\\/]$/, '');\r\n  const cssContent = content.replace(/<<<PATH>>>/g, mediaPath);\r\n  // Cleanup the collected css content after injecting it to the DOM.\r\n  content = '';\r\n\r\n  // Inject CSS tag at start of head.\r\n  const cssNode = document.createElement('style');\r\n  cssNode.id = 'blockly-common-style';\r\n  const cssTextNode = document.createTextNode(cssContent);\r\n  cssNode.appendChild(cssTextNode);\r\n  document.head.insertBefore(cssNode, document.head.firstChild);\r\n}\r\n\r\n/**\r\n * The CSS content for Blockly.\r\n */\r\nlet content = `\r\n.blocklySvg {\r\n  background-color: #fff;\r\n  outline: none;\r\n  overflow: hidden;  /* IE overflows by default. */\r\n  position: absolute;\r\n  display: block;\r\n}\r\n\r\n.blocklyWidgetDiv {\r\n  display: none;\r\n  position: absolute;\r\n  z-index: 99999;  /* big value for bootstrap3 compatibility */\r\n}\r\n\r\n.injectionDiv {\r\n  height: 100%;\r\n  position: relative;\r\n  overflow: hidden;  /* So blocks in drag surface disappear at edges */\r\n  touch-action: none;\r\n}\r\n\r\n.blocklyNonSelectable {\r\n  user-select: none;\r\n  -ms-user-select: none;\r\n  -webkit-user-select: none;\r\n}\r\n\r\n.blocklyBlockCanvas.blocklyCanvasTransitioning,\r\n.blocklyBubbleCanvas.blocklyCanvasTransitioning {\r\n  transition: transform .5s;\r\n}\r\n\r\n.blocklyTooltipDiv {\r\n  background-color: #ffffc7;\r\n  border: 1px solid #ddc;\r\n  box-shadow: 4px 4px 20px 1px rgba(0,0,0,.15);\r\n  color: #000;\r\n  display: none;\r\n  font: 9pt sans-serif;\r\n  opacity: .9;\r\n  padding: 2px;\r\n  position: absolute;\r\n  z-index: 100000;  /* big value for bootstrap3 compatibility */\r\n}\r\n\r\n.blocklyDropDownDiv {\r\n  position: absolute;\r\n  left: 0;\r\n  top: 0;\r\n  z-index: 1000;\r\n  display: none;\r\n  border: 1px solid;\r\n  border-color: #dadce0;\r\n  background-color: #fff;\r\n  border-radius: 2px;\r\n  padding: 4px;\r\n  box-shadow: 0 0 3px 1px rgba(0,0,0,.3);\r\n}\r\n\r\n.blocklyDropDownDiv.blocklyFocused {\r\n  box-shadow: 0 0 6px 1px rgba(0,0,0,.3);\r\n}\r\n\r\n.blocklyDropDownContent {\r\n  max-height: 300px;  /* @todo: spec for maximum height. */\r\n  overflow: auto;\r\n  overflow-x: hidden;\r\n  position: relative;\r\n}\r\n\r\n.blocklyDropDownArrow {\r\n  position: absolute;\r\n  left: 0;\r\n  top: 0;\r\n  width: 16px;\r\n  height: 16px;\r\n  z-index: -1;\r\n  background-color: inherit;\r\n  border-color: inherit;\r\n}\r\n\r\n.blocklyDropDownButton {\r\n  display: inline-block;\r\n  float: left;\r\n  padding: 0;\r\n  margin: 4px;\r\n  border-radius: 4px;\r\n  outline: none;\r\n  border: 1px solid;\r\n  transition: box-shadow .1s;\r\n  cursor: pointer;\r\n}\r\n\r\n.blocklyArrowTop {\r\n  border-top: 1px solid;\r\n  border-left: 1px solid;\r\n  border-top-left-radius: 4px;\r\n  border-color: inherit;\r\n}\r\n\r\n.blocklyArrowBottom {\r\n  border-bottom: 1px solid;\r\n  border-right: 1px solid;\r\n  border-bottom-right-radius: 4px;\r\n  border-color: inherit;\r\n}\r\n\r\n.blocklyResizeSE {\r\n  cursor: se-resize;\r\n  fill: #aaa;\r\n}\r\n\r\n.blocklyResizeSW {\r\n  cursor: sw-resize;\r\n  fill: #aaa;\r\n}\r\n\r\n.blocklyResizeLine {\r\n  stroke: #515A5A;\r\n  stroke-width: 1;\r\n}\r\n\r\n.blocklyHighlightedConnectionPath {\r\n  fill: none;\r\n  stroke: #fc3;\r\n  stroke-width: 4px;\r\n}\r\n\r\n.blocklyPathLight {\r\n  fill: none;\r\n  stroke-linecap: round;\r\n  stroke-width: 1;\r\n}\r\n\r\n.blocklySelected>.blocklyPathLight {\r\n  display: none;\r\n}\r\n\r\n.blocklyDraggable {\r\n  cursor: grab;\r\n  cursor: -webkit-grab;\r\n}\r\n\r\n.blocklyDragging {\r\n  cursor: grabbing;\r\n  cursor: -webkit-grabbing;\r\n}\r\n\r\n  /* Changes cursor on mouse down. Not effective in Firefox because of\r\n     https://bugzilla.mozilla.org/show_bug.cgi?id=771241 */\r\n.blocklyDraggable:active {\r\n  cursor: grabbing;\r\n  cursor: -webkit-grabbing;\r\n}\r\n\r\n.blocklyDragging.blocklyDraggingDelete {\r\n  cursor: url(\"<<<PATH>>>/handdelete.cur\"), auto;\r\n}\r\n\r\n.blocklyDragging>.blocklyPath,\r\n.blocklyDragging>.blocklyPathLight {\r\n  fill-opacity: .8;\r\n  stroke-opacity: .8;\r\n}\r\n\r\n.blocklyDragging>.blocklyPathDark {\r\n  display: none;\r\n}\r\n\r\n.blocklyDisabled>.blocklyPath {\r\n  fill-opacity: .5;\r\n  stroke-opacity: .5;\r\n}\r\n\r\n.blocklyDisabled>.blocklyPathLight,\r\n.blocklyDisabled>.blocklyPathDark {\r\n  display: none;\r\n}\r\n\r\n.blocklyInsertionMarker>.blocklyPath,\r\n.blocklyInsertionMarker>.blocklyPathLight,\r\n.blocklyInsertionMarker>.blocklyPathDark {\r\n  fill-opacity: .2;\r\n  stroke: none;\r\n}\r\n\r\n.blocklyMultilineText {\r\n  font-family: monospace;\r\n}\r\n\r\n.blocklyNonEditableText>text {\r\n  pointer-events: none;\r\n}\r\n\r\n.blocklyFlyout {\r\n  position: absolute;\r\n  z-index: 20;\r\n}\r\n\r\n.blocklyText text {\r\n  cursor: default;\r\n}\r\n\r\n/*\r\n  Don't allow users to select text.  It gets annoying when trying to\r\n  drag a block and selected text moves instead.\r\n*/\r\n.blocklySvg text {\r\n  user-select: none;\r\n  -ms-user-select: none;\r\n  -webkit-user-select: none;\r\n  cursor: inherit;\r\n}\r\n\r\n.blocklyHidden {\r\n  display: none;\r\n}\r\n\r\n.blocklyFieldDropdown:not(.blocklyHidden) {\r\n  display: block;\r\n}\r\n\r\n.blocklyIconGroup {\r\n  cursor: default;\r\n}\r\n\r\n.blocklyIconGroup:not(:hover),\r\n.blocklyIconGroupReadonly {\r\n  opacity: .6;\r\n}\r\n\r\n.blocklyIconShape {\r\n  fill: #00f;\r\n  stroke: #fff;\r\n  stroke-width: 1px;\r\n}\r\n\r\n.blocklyIconSymbol {\r\n  fill: #fff;\r\n}\r\n\r\n.blocklyMinimalBody {\r\n  margin: 0;\r\n  padding: 0;\r\n}\r\n\r\n.blocklyHtmlInput {\r\n  border: none;\r\n  border-radius: 4px;\r\n  height: 100%;\r\n  margin: 0;\r\n  outline: none;\r\n  padding: 0;\r\n  width: 100%;\r\n  text-align: center;\r\n  display: block;\r\n  box-sizing: border-box;\r\n}\r\n\r\n/* Remove the increase and decrease arrows on the field number editor */\r\ninput.blocklyHtmlInput[type=number]::-webkit-inner-spin-button,\r\ninput.blocklyHtmlInput[type=number]::-webkit-outer-spin-button {\r\n  -webkit-appearance: none;\r\n  margin: 0;\r\n}\r\n\r\ninput[type=number] {\r\n  -moz-appearance: textfield;\r\n}\r\n\r\n.blocklyMainBackground {\r\n  stroke-width: 1;\r\n  stroke: #c6c6c6;  /* Equates to #ddd due to border being off-pixel. */\r\n}\r\n\r\n.blocklyMutatorBackground {\r\n  fill: #fff;\r\n  stroke: #ddd;\r\n  stroke-width: 1;\r\n}\r\n\r\n.blocklyFlyoutBackground {\r\n  fill: #ddd;\r\n  fill-opacity: .8;\r\n}\r\n\r\n.blocklyMainWorkspaceScrollbar {\r\n  z-index: 20;\r\n}\r\n\r\n.blocklyFlyoutScrollbar {\r\n  z-index: 30;\r\n}\r\n\r\n.blocklyScrollbarHorizontal,\r\n.blocklyScrollbarVertical {\r\n  position: absolute;\r\n  outline: none;\r\n}\r\n\r\n.blocklyScrollbarBackground {\r\n  opacity: 0;\r\n}\r\n\r\n.blocklyScrollbarHandle {\r\n  fill: #ccc;\r\n}\r\n\r\n.blocklyScrollbarBackground:hover+.blocklyScrollbarHandle,\r\n.blocklyScrollbarHandle:hover {\r\n  fill: #bbb;\r\n}\r\n\r\n/* Darken flyout scrollbars due to being on a grey background. */\r\n/* By contrast, workspace scrollbars are on a white background. */\r\n.blocklyFlyout .blocklyScrollbarHandle {\r\n  fill: #bbb;\r\n}\r\n\r\n.blocklyFlyout .blocklyScrollbarBackground:hover+.blocklyScrollbarHandle,\r\n.blocklyFlyout .blocklyScrollbarHandle:hover {\r\n  fill: #aaa;\r\n}\r\n\r\n.blocklyInvalidInput {\r\n  background: #faa;\r\n}\r\n\r\n.blocklyVerticalMarker {\r\n  stroke-width: 3px;\r\n  fill: rgba(255,255,255,.5);\r\n  pointer-events: none;\r\n}\r\n\r\n.blocklyComputeCanvas {\r\n  position: absolute;\r\n  width: 0;\r\n  height: 0;\r\n}\r\n\r\n.blocklyNoPointerEvents {\r\n  pointer-events: none;\r\n}\r\n\r\n.blocklyContextMenu {\r\n  border-radius: 4px;\r\n  max-height: 100%;\r\n}\r\n\r\n.blocklyDropdownMenu {\r\n  border-radius: 2px;\r\n  padding: 0 !important;\r\n}\r\n\r\n.blocklyDropdownMenu .blocklyMenuItem {\r\n  /* 28px on the left for icon or checkbox. */\r\n  padding-left: 28px;\r\n}\r\n\r\n/* BiDi override for the resting state. */\r\n.blocklyDropdownMenu .blocklyMenuItemRtl {\r\n  /* Flip left/right padding for BiDi. */\r\n  padding-left: 5px;\r\n  padding-right: 28px;\r\n}\r\n\r\n.blocklyWidgetDiv .blocklyMenu {\r\n  background: #fff;\r\n  border: 1px solid transparent;\r\n  box-shadow: 0 0 3px 1px rgba(0,0,0,.3);\r\n  font: normal 13px Arial, sans-serif;\r\n  margin: 0;\r\n  outline: none;\r\n  padding: 4px 0;\r\n  position: absolute;\r\n  overflow-y: auto;\r\n  overflow-x: hidden;\r\n  max-height: 100%;\r\n  z-index: 20000;  /* Arbitrary, but some apps depend on it... */\r\n}\r\n\r\n.blocklyWidgetDiv .blocklyMenu.blocklyFocused {\r\n  box-shadow: 0 0 6px 1px rgba(0,0,0,.3);\r\n}\r\n\r\n.blocklyDropDownDiv .blocklyMenu {\r\n  background: inherit;  /* Compatibility with gapi, reset from goog-menu */\r\n  border: inherit;  /* Compatibility with gapi, reset from goog-menu */\r\n  font: normal 13px \"Helvetica Neue\", Helvetica, sans-serif;\r\n  outline: none;\r\n  position: relative;  /* Compatibility with gapi, reset from goog-menu */\r\n  z-index: 20000;  /* Arbitrary, but some apps depend on it... */\r\n}\r\n\r\n/* State: resting. */\r\n.blocklyMenuItem {\r\n  border: none;\r\n  color: #000;\r\n  cursor: pointer;\r\n  list-style: none;\r\n  margin: 0;\r\n  /* 7em on the right for shortcut. */\r\n  min-width: 7em;\r\n  padding: 6px 15px;\r\n  white-space: nowrap;\r\n}\r\n\r\n/* State: disabled. */\r\n.blocklyMenuItemDisabled {\r\n  color: #ccc;\r\n  cursor: inherit;\r\n}\r\n\r\n/* State: hover. */\r\n.blocklyMenuItemHighlight {\r\n  background-color: rgba(0,0,0,.1);\r\n}\r\n\r\n/* State: selected/checked. */\r\n.blocklyMenuItemCheckbox {\r\n  height: 16px;\r\n  position: absolute;\r\n  width: 16px;\r\n}\r\n\r\n.blocklyMenuItemSelected .blocklyMenuItemCheckbox {\r\n  background: url(<<<PATH>>>/sprites.png) no-repeat -48px -16px;\r\n  float: left;\r\n  margin-left: -24px;\r\n  position: static;  /* Scroll with the menu. */\r\n}\r\n\r\n.blocklyMenuItemRtl .blocklyMenuItemCheckbox {\r\n  float: right;\r\n  margin-right: -24px;\r\n}\r\n\r\n.blocklyBlockDragSurface {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  overflow: visible !important;\r\n  z-index: 80;\r\n  pointer-events: none;\r\n}\r\n`;\r\n","/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.utils.deprecation\r\n\r\n// Set of previously-emitted warnings.\r\nconst previousWarnings = new Set();\r\n\r\n/**\r\n * Warn developers that a function or property is deprecated.\r\n *\r\n * @param name The name of the function or property.\r\n * @param deprecationDate The date of deprecation. Prefer 'version n.0.0'\r\n *     format, and fall back to 'month yyyy' or 'quarter yyyy' format.\r\n * @param deletionDate The date of deletion. Prefer 'version n.0.0'\r\n *     format, and fall back to 'month yyyy' or 'quarter yyyy' format.\r\n * @param opt_use The name of a function or property to use instead, if any.\r\n * @internal\r\n */\r\nexport function warn(\r\n  name: string,\r\n  deprecationDate: string,\r\n  deletionDate: string,\r\n  opt_use?: string,\r\n) {\r\n  let msg =\r\n    name +\r\n    ' was deprecated in ' +\r\n    deprecationDate +\r\n    ' and will be deleted in ' +\r\n    deletionDate +\r\n    '.';\r\n  if (opt_use) {\r\n    msg += '\\nUse ' + opt_use + ' instead.';\r\n  }\r\n\r\n  // Don't log deprecation warnings multiple times.\r\n  if (previousWarnings.has(msg)) {\r\n    return;\r\n  }\r\n\r\n  previousWarnings.add(msg);\r\n  console.warn(msg);\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.utils.dom\r\n\r\nimport * as deprecation from './deprecation.js';\r\nimport type {Svg} from './svg.js';\r\n\r\n/**\r\n * Required name space for SVG elements.\r\n */\r\nexport const SVG_NS = 'http://www.w3.org/2000/svg';\r\n\r\n/**\r\n * Required name space for HTML elements.\r\n */\r\nexport const HTML_NS = 'http://www.w3.org/1999/xhtml';\r\n\r\n/**\r\n * Required name space for XLINK elements.\r\n */\r\nexport const XLINK_NS = 'http://www.w3.org/1999/xlink';\r\n\r\n/**\r\n * Node type constants.\r\n * https://developer.mozilla.org/en-US/docs/Web/API/Node/nodeType\r\n */\r\nexport enum NodeType {\r\n  ELEMENT_NODE = 1,\r\n  TEXT_NODE = 3,\r\n  COMMENT_NODE = 8,\r\n}\r\n\r\n/** Temporary cache of text widths. */\r\nlet cacheWidths: {[key: string]: number} | null = null;\r\n\r\n/** Number of current references to cache. */\r\nlet cacheReference = 0;\r\n\r\n/** A HTML canvas context used for computing text width. */\r\nlet canvasContext: CanvasRenderingContext2D | null = null;\r\n\r\n/**\r\n * Helper method for creating SVG elements.\r\n *\r\n * @param name Element's tag name.\r\n * @param attrs Dictionary of attribute names and values.\r\n * @param opt_parent Optional parent on which to append the element.\r\n * @returns if name is a string or a more specific type if it a member of Svg.\r\n */\r\nexport function createSvgElement<T extends SVGElement>(\r\n  name: string | Svg<T>,\r\n  attrs: {[key: string]: string | number},\r\n  opt_parent?: Element | null,\r\n): T {\r\n  const e = document.createElementNS(SVG_NS, `${name}`) as T;\r\n  for (const key in attrs) {\r\n    e.setAttribute(key, `${attrs[key]}`);\r\n  }\r\n  if (opt_parent) {\r\n    opt_parent.appendChild(e);\r\n  }\r\n  return e;\r\n}\r\n\r\n/**\r\n * Add a CSS class to a element.\r\n *\r\n * Handles multiple space-separated classes for legacy reasons.\r\n *\r\n * @param element DOM element to add class to.\r\n * @param className Name of class to add.\r\n * @returns True if class was added, false if already present.\r\n */\r\nexport function addClass(element: Element, className: string): boolean {\r\n  const classNames = className.split(' ');\r\n  if (classNames.every((name) => element.classList.contains(name))) {\r\n    return false;\r\n  }\r\n  element.classList.add(...classNames);\r\n  return true;\r\n}\r\n\r\n/**\r\n * Removes multiple classes from an element.\r\n *\r\n * @param element DOM element to remove classes from.\r\n * @param classNames A string of one or multiple class names for an element.\r\n */\r\nexport function removeClasses(element: Element, classNames: string) {\r\n  element.classList.remove(...classNames.split(' '));\r\n}\r\n\r\n/**\r\n * Remove a CSS class from a element.\r\n *\r\n * Handles multiple space-separated classes for legacy reasons.\r\n *\r\n * @param element DOM element to remove class from.\r\n * @param className Name of class to remove.\r\n * @returns True if class was removed, false if never present.\r\n */\r\nexport function removeClass(element: Element, className: string): boolean {\r\n  const classNames = className.split(' ');\r\n  if (classNames.every((name) => !element.classList.contains(name))) {\r\n    return false;\r\n  }\r\n  element.classList.remove(...classNames);\r\n  return true;\r\n}\r\n\r\n/**\r\n * Checks if an element has the specified CSS class.\r\n *\r\n * @param element DOM element to check.\r\n * @param className Name of class to check.\r\n * @returns True if class exists, false otherwise.\r\n */\r\nexport function hasClass(element: Element, className: string): boolean {\r\n  return element.classList.contains(className);\r\n}\r\n\r\n/**\r\n * Removes a node from its parent. No-op if not attached to a parent.\r\n *\r\n * @param node The node to remove.\r\n * @returns The node removed if removed; else, null.\r\n */\r\n// Copied from Closure goog.dom.removeNode\r\nexport function removeNode(node: Node | null): Node | null {\r\n  return node && node.parentNode ? node.parentNode.removeChild(node) : null;\r\n}\r\n\r\n/**\r\n * Insert a node after a reference node.\r\n * Contrast with node.insertBefore function.\r\n *\r\n * @param newNode New element to insert.\r\n * @param refNode Existing element to precede new node.\r\n */\r\nexport function insertAfter(newNode: Element, refNode: Element) {\r\n  const siblingNode = refNode.nextSibling;\r\n  const parentNode = refNode.parentNode;\r\n  if (!parentNode) {\r\n    throw Error('Reference node has no parent.');\r\n  }\r\n  if (siblingNode) {\r\n    parentNode.insertBefore(newNode, siblingNode);\r\n  } else {\r\n    parentNode.appendChild(newNode);\r\n  }\r\n}\r\n\r\n/**\r\n * Whether a node contains another node.\r\n *\r\n * @param parent The node that should contain the other node.\r\n * @param descendant The node to test presence of.\r\n * @returns Whether the parent node contains the descendant node.\r\n * @deprecated Use native 'contains' DOM method.\r\n */\r\nexport function containsNode(parent: Node, descendant: Node): boolean {\r\n  deprecation.warn(\r\n    'Blockly.utils.dom.containsNode',\r\n    'version 10',\r\n    'version 11',\r\n    'Use native \"contains\" DOM method',\r\n  );\r\n  return parent.contains(descendant);\r\n}\r\n\r\n/**\r\n * Sets the CSS transform property on an element. This function sets the\r\n * non-vendor-prefixed and vendor-prefixed versions for backwards compatibility\r\n * with older browsers. See https://caniuse.com/#feat=transforms2d\r\n *\r\n * @param element Element to which the CSS transform will be applied.\r\n * @param transform The value of the CSS `transform` property.\r\n */\r\nexport function setCssTransform(\r\n  element: HTMLElement | SVGElement,\r\n  transform: string,\r\n) {\r\n  element.style['transform'] = transform;\r\n  element.style['-webkit-transform' as any] = transform;\r\n}\r\n\r\n/**\r\n * Start caching text widths. Every call to this function MUST also call\r\n * stopTextWidthCache. Caches must not survive between execution threads.\r\n */\r\nexport function startTextWidthCache() {\r\n  cacheReference++;\r\n  if (!cacheWidths) {\r\n    cacheWidths = Object.create(null);\r\n  }\r\n}\r\n\r\n/**\r\n * Stop caching field widths. Unless caching was already on when the\r\n * corresponding call to startTextWidthCache was made.\r\n */\r\nexport function stopTextWidthCache() {\r\n  cacheReference--;\r\n  if (!cacheReference) {\r\n    cacheWidths = null;\r\n  }\r\n}\r\n\r\n/**\r\n * Gets the width of a text element, caching it in the process.\r\n *\r\n * @param textElement An SVG 'text' element.\r\n * @returns Width of element.\r\n */\r\nexport function getTextWidth(textElement: SVGTextElement): number {\r\n  const key = textElement.textContent + '\\n' + textElement.className.baseVal;\r\n  let width;\r\n  // Return the cached width if it exists.\r\n  if (cacheWidths) {\r\n    width = cacheWidths[key];\r\n    if (width) {\r\n      return width;\r\n    }\r\n  }\r\n\r\n  // Attempt to compute fetch the width of the SVG text element.\r\n  try {\r\n    width = textElement.getComputedTextLength();\r\n  } catch (e) {\r\n    // In other cases where we fail to get the computed text. Instead, use an\r\n    // approximation and do not cache the result. At some later point in time\r\n    // when the block is inserted into the visible DOM, this method will be\r\n    // called again and, at that point in time, will not throw an exception.\r\n    return textElement.textContent!.length * 8;\r\n  }\r\n\r\n  // Cache the computed width and return.\r\n  if (cacheWidths) {\r\n    cacheWidths[key] = width;\r\n  }\r\n  return width;\r\n}\r\n\r\n/**\r\n * Gets the width of a text element using a faster method than `getTextWidth`.\r\n * This method requires that we know the text element's font family and size in\r\n * advance. Similar to `getTextWidth`, we cache the width we compute.\r\n *\r\n * @param textElement An SVG 'text' element.\r\n * @param fontSize The font size to use.\r\n * @param fontWeight The font weight to use.\r\n * @param fontFamily The font family to use.\r\n * @returns Width of element.\r\n */\r\nexport function getFastTextWidth(\r\n  textElement: SVGTextElement,\r\n  fontSize: number,\r\n  fontWeight: string,\r\n  fontFamily: string,\r\n): number {\r\n  return getFastTextWidthWithSizeString(\r\n    textElement,\r\n    fontSize + 'pt',\r\n    fontWeight,\r\n    fontFamily,\r\n  );\r\n}\r\n\r\n/**\r\n * Gets the width of a text element using a faster method than `getTextWidth`.\r\n * This method requires that we know the text element's font family and size in\r\n * advance. Similar to `getTextWidth`, we cache the width we compute.\r\n * This method is similar to `getFastTextWidth` but expects the font size\r\n * parameter to be a string.\r\n *\r\n * @param textElement An SVG 'text' element.\r\n * @param fontSize The font size to use.\r\n * @param fontWeight The font weight to use.\r\n * @param fontFamily The font family to use.\r\n * @returns Width of element.\r\n */\r\nexport function getFastTextWidthWithSizeString(\r\n  textElement: SVGTextElement,\r\n  fontSize: string,\r\n  fontWeight: string,\r\n  fontFamily: string,\r\n): number {\r\n  const text = textElement.textContent;\r\n  const key = text + '\\n' + textElement.className.baseVal;\r\n  let width;\r\n\r\n  // Return the cached width if it exists.\r\n  if (cacheWidths) {\r\n    width = cacheWidths[key];\r\n    if (width) {\r\n      return width;\r\n    }\r\n  }\r\n\r\n  if (!canvasContext) {\r\n    // Inject the canvas element used for computing text widths.\r\n    const computeCanvas = document.createElement('canvas');\r\n    computeCanvas.className = 'blocklyComputeCanvas';\r\n    document.body.appendChild(computeCanvas);\r\n\r\n    // Initialize the HTML canvas context and set the font.\r\n    // The context font must match blocklyText's fontsize and font-family\r\n    // set in CSS.\r\n    canvasContext = computeCanvas.getContext('2d') as CanvasRenderingContext2D;\r\n  }\r\n  // Set the desired font size and family.\r\n  canvasContext.font = fontWeight + ' ' + fontSize + ' ' + fontFamily;\r\n\r\n  // Measure the text width using the helper canvas context.\r\n  if (text) {\r\n    width = canvasContext.measureText(text).width;\r\n  } else {\r\n    width = 0;\r\n  }\r\n\r\n  // Cache the computed width and return.\r\n  if (cacheWidths) {\r\n    cacheWidths[key] = width;\r\n  }\r\n  return width;\r\n}\r\n\r\n/**\r\n * Measure a font's metrics. The height and baseline values.\r\n *\r\n * @param text Text to measure the font dimensions of.\r\n * @param fontSize The font size to use.\r\n * @param fontWeight The font weight to use.\r\n * @param fontFamily The font family to use.\r\n * @returns Font measurements.\r\n */\r\nexport function measureFontMetrics(\r\n  text: string,\r\n  fontSize: string,\r\n  fontWeight: string,\r\n  fontFamily: string,\r\n): {height: number; baseline: number} {\r\n  const span = document.createElement('span');\r\n  span.style.font = fontWeight + ' ' + fontSize + ' ' + fontFamily;\r\n  span.textContent = text;\r\n\r\n  const block = document.createElement('div');\r\n  block.style.width = '1px';\r\n  block.style.height = '0';\r\n\r\n  const div = document.createElement('div');\r\n  div.style.display = 'flex';\r\n  div.style.position = 'fixed';\r\n  div.style.top = '0';\r\n  div.style.left = '0';\r\n  div.appendChild(span);\r\n  div.appendChild(block);\r\n\r\n  document.body.appendChild(div);\r\n  const result = {\r\n    height: 0,\r\n    baseline: 0,\r\n  };\r\n  try {\r\n    div.style.alignItems = 'baseline';\r\n    result.baseline = block.offsetTop - span.offsetTop;\r\n    div.style.alignItems = 'flex-end';\r\n    result.height = block.offsetTop - span.offsetTop;\r\n  } finally {\r\n    document.body.removeChild(div);\r\n  }\r\n  return result;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.utils.style\r\n\r\nimport {Coordinate} from './coordinate.js';\r\nimport {Rect} from './rect.js';\r\nimport {Size} from './size.js';\r\n\r\n/**\r\n * Gets the height and width of an element.\r\n * Similar to Closure's goog.style.getSize\r\n *\r\n * @param element Element to get size of.\r\n * @returns Object with width/height properties.\r\n */\r\nexport function getSize(element: Element): Size {\r\n  return TEST_ONLY.getSizeInternal(element);\r\n}\r\n\r\n/**\r\n * Private version of getSize for stubbing in tests.\r\n */\r\nfunction getSizeInternal(element: Element): Size {\r\n  if (getComputedStyle(element, 'display') !== 'none') {\r\n    return getSizeWithDisplay(element);\r\n  }\r\n\r\n  // Evaluate size with a temporary element.\r\n  // AnyDuringMigration because:  Property 'style' does not exist on type\r\n  // 'Element'.\r\n  const style = (element as AnyDuringMigration).style;\r\n  const originalDisplay = style.display;\r\n  const originalVisibility = style.visibility;\r\n  const originalPosition = style.position;\r\n\r\n  style.visibility = 'hidden';\r\n  style.position = 'absolute';\r\n  style.display = 'inline';\r\n\r\n  const offsetWidth = (element as HTMLElement).offsetWidth;\r\n  const offsetHeight = (element as HTMLElement).offsetHeight;\r\n\r\n  style.display = originalDisplay;\r\n  style.position = originalPosition;\r\n  style.visibility = originalVisibility;\r\n\r\n  return new Size(offsetWidth, offsetHeight);\r\n}\r\n\r\n/**\r\n * Gets the height and width of an element when the display is not none.\r\n *\r\n * @param element Element to get size of.\r\n * @returns Object with width/height properties.\r\n */\r\nfunction getSizeWithDisplay(element: Element): Size {\r\n  const offsetWidth = (element as HTMLElement).offsetWidth;\r\n  const offsetHeight = (element as HTMLElement).offsetHeight;\r\n  return new Size(offsetWidth, offsetHeight);\r\n}\r\n\r\n/**\r\n * Retrieves a computed style value of a node. It returns empty string\r\n * if the property requested is an SVG one and it has not been\r\n * explicitly set (firefox and webkit).\r\n *\r\n * Copied from Closure's goog.style.getComputedStyle\r\n *\r\n * @param element Element to get style of.\r\n * @param property Property to get (camel-case).\r\n * @returns Style value.\r\n */\r\nexport function getComputedStyle(element: Element, property: string): string {\r\n  const styles = window.getComputedStyle(element);\r\n  // element.style[..] is undefined for browser specific styles\r\n  // as 'filter'.\r\n  return (\r\n    (styles as AnyDuringMigration)[property] ||\r\n    styles.getPropertyValue(property)\r\n  );\r\n}\r\n\r\n/**\r\n * Returns a Coordinate object relative to the top-left of the HTML document.\r\n * Similar to Closure's goog.style.getPageOffset\r\n *\r\n * @param el Element to get the page offset for.\r\n * @returns The page offset.\r\n */\r\nexport function getPageOffset(el: Element): Coordinate {\r\n  const pos = new Coordinate(0, 0);\r\n  const box = el.getBoundingClientRect();\r\n  const documentElement = document.documentElement;\r\n  // Must add the scroll coordinates in to get the absolute page offset\r\n  // of element since getBoundingClientRect returns relative coordinates to\r\n  // the viewport.\r\n  const scrollCoord = new Coordinate(\r\n    window.pageXOffset || documentElement.scrollLeft,\r\n    window.pageYOffset || documentElement.scrollTop,\r\n  );\r\n  pos.x = box.left + scrollCoord.x;\r\n  pos.y = box.top + scrollCoord.y;\r\n\r\n  return pos;\r\n}\r\n\r\n/**\r\n * Calculates the viewport coordinates relative to the document.\r\n * Similar to Closure's goog.style.getViewportPageOffset\r\n *\r\n * @returns The page offset of the viewport.\r\n */\r\nexport function getViewportPageOffset(): Coordinate {\r\n  const body = document.body;\r\n  const documentElement = document.documentElement;\r\n  const scrollLeft = body.scrollLeft || documentElement.scrollLeft;\r\n  const scrollTop = body.scrollTop || documentElement.scrollTop;\r\n  return new Coordinate(scrollLeft, scrollTop);\r\n}\r\n\r\n/**\r\n * Gets the computed border widths (on all sides) in pixels\r\n * Copied from Closure's goog.style.getBorderBox\r\n *\r\n * @param element  The element to get the border widths for.\r\n * @returns The computed border widths.\r\n */\r\nexport function getBorderBox(element: Element): Rect {\r\n  const left = parseFloat(getComputedStyle(element, 'borderLeftWidth'));\r\n  const right = parseFloat(getComputedStyle(element, 'borderRightWidth'));\r\n  const top = parseFloat(getComputedStyle(element, 'borderTopWidth'));\r\n  const bottom = parseFloat(getComputedStyle(element, 'borderBottomWidth'));\r\n\r\n  return new Rect(top, bottom, left, right);\r\n}\r\n\r\n/**\r\n * Changes the scroll position of `container` with the minimum amount so\r\n * that the content and the borders of the given `element` become visible.\r\n * If the element is bigger than the container, its top left corner will be\r\n * aligned as close to the container's top left corner as possible.\r\n * Copied from Closure's goog.style.scrollIntoContainerView\r\n *\r\n * @param element The element to make visible.\r\n * @param container The container to scroll. If not set, then the document\r\n *     scroll element will be used.\r\n * @param opt_center Whether to center the element in the container.\r\n *     Defaults to false.\r\n */\r\nexport function scrollIntoContainerView(\r\n  element: Element,\r\n  container: Element,\r\n  opt_center?: boolean,\r\n) {\r\n  const offset = getContainerOffsetToScrollInto(element, container, opt_center);\r\n  container.scrollLeft = offset.x;\r\n  container.scrollTop = offset.y;\r\n}\r\n\r\n/**\r\n * Calculate the scroll position of `container` with the minimum amount so\r\n * that the content and the borders of the given `element` become visible.\r\n * If the element is bigger than the container, its top left corner will be\r\n * aligned as close to the container's top left corner as possible.\r\n * Copied from Closure's goog.style.getContainerOffsetToScrollInto\r\n *\r\n * @param element The element to make visible.\r\n * @param container The container to scroll. If not set, then the document\r\n *     scroll element will be used.\r\n * @param opt_center Whether to center the element in the container.\r\n *     Defaults to false.\r\n * @returns The new scroll position of the container.\r\n */\r\nexport function getContainerOffsetToScrollInto(\r\n  element: Element,\r\n  container: Element,\r\n  opt_center?: boolean,\r\n): Coordinate {\r\n  // Absolute position of the element's border's top left corner.\r\n  const elementPos = getPageOffset(element);\r\n  // Absolute position of the container's border's top left corner.\r\n  const containerPos = getPageOffset(container);\r\n  const containerBorder = getBorderBox(container);\r\n  // Relative pos. of the element's border box to the container's content box.\r\n  const relX = elementPos.x - containerPos.x - containerBorder.left;\r\n  const relY = elementPos.y - containerPos.y - containerBorder.top;\r\n  // How much the element can move in the container, i.e. the difference between\r\n  // the element's bottom-right-most and top-left-most position where it's\r\n  // fully visible.\r\n  const elementSize = getSizeWithDisplay(element);\r\n  const spaceX = container.clientWidth - elementSize.width;\r\n  const spaceY = container.clientHeight - elementSize.height;\r\n  let scrollLeft = container.scrollLeft;\r\n  let scrollTop = container.scrollTop;\r\n  if (opt_center) {\r\n    // All browsers round non-integer scroll positions down.\r\n    scrollLeft += relX - spaceX / 2;\r\n    scrollTop += relY - spaceY / 2;\r\n  } else {\r\n    // This formula was designed to give the correct scroll values in the\r\n    // following cases:\r\n    // - element is higher than container (spaceY < 0) => scroll down by relY\r\n    // - element is not higher that container (spaceY >= 0):\r\n    //   - it is above container (relY < 0) => scroll up by abs(relY)\r\n    //   - it is below container (relY > spaceY) => scroll down by relY - spaceY\r\n    //   - it is in the container => don't scroll\r\n    scrollLeft += Math.min(relX, Math.max(relX - spaceX, 0));\r\n    scrollTop += Math.min(relY, Math.max(relY - spaceY, 0));\r\n  }\r\n  return new Coordinate(scrollLeft, scrollTop);\r\n}\r\n\r\nexport const TEST_ONLY = {\r\n  getSizeInternal,\r\n};\r\n","/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.utils.svgMath\r\n\r\nimport type {WorkspaceSvg} from '../workspace_svg.js';\r\n\r\nimport {Coordinate} from './coordinate.js';\r\nimport {Rect} from './rect.js';\r\nimport * as style from './style.js';\r\n\r\n/**\r\n * Static regex to pull the x,y values out of an SVG translate() directive.\r\n * Note that Firefox and IE (9,10) return 'translate(12)' instead of\r\n * 'translate(12, 0)'.\r\n * Note that IE (9,10) returns 'translate(16 8)' instead of 'translate(16, 8)'.\r\n * Note that IE has been reported to return scientific notation (0.123456e-42).\r\n */\r\nconst XY_REGEX = /translate\\(\\s*([-+\\d.e]+)([ ,]\\s*([-+\\d.e]+)\\s*)?/;\r\n\r\n/**\r\n * Static regex to pull the x,y values out of a translate() or translate3d()\r\n * style property.\r\n * Accounts for same exceptions as XY_REGEX.\r\n */\r\nconst XY_STYLE_REGEX =\r\n  /transform:\\s*translate(?:3d)?\\(\\s*([-+\\d.e]+)\\s*px([ ,]\\s*([-+\\d.e]+)\\s*px)?/;\r\n\r\n/**\r\n * Return the coordinates of the top-left corner of this element relative to\r\n * its parent.  Only for SVG elements and children (e.g. rect, g, path).\r\n *\r\n * @param element SVG element to find the coordinates of.\r\n * @returns Object with .x and .y properties.\r\n */\r\nexport function getRelativeXY(element: Element): Coordinate {\r\n  const xy = new Coordinate(0, 0);\r\n  // First, check for x and y attributes.\r\n  // Checking for the existence of x/y properties is faster than getAttribute.\r\n  // However, x/y contains an SVGAnimatedLength object, so rely on getAttribute\r\n  // to get the number.\r\n  const x = (element as any).x && element.getAttribute('x');\r\n  const y = (element as any).y && element.getAttribute('y');\r\n  if (x) {\r\n    xy.x = parseInt(x);\r\n  }\r\n  if (y) {\r\n    xy.y = parseInt(y);\r\n  }\r\n  // Second, check for transform=\"translate(...)\" attribute.\r\n  const transform = element.getAttribute('transform');\r\n  const r = transform && transform.match(XY_REGEX);\r\n  if (r) {\r\n    xy.x += Number(r[1]);\r\n    if (r[3]) {\r\n      xy.y += Number(r[3]);\r\n    }\r\n  }\r\n\r\n  // Then check for style = transform: translate(...) or translate3d(...)\r\n  const style = element.getAttribute('style');\r\n  if (style && style.indexOf('translate') > -1) {\r\n    const styleComponents = style.match(XY_STYLE_REGEX);\r\n    if (styleComponents) {\r\n      xy.x += Number(styleComponents[1]);\r\n      if (styleComponents[3]) {\r\n        xy.y += Number(styleComponents[3]);\r\n      }\r\n    }\r\n  }\r\n  return xy;\r\n}\r\n\r\n/**\r\n * Return the coordinates of the top-left corner of this element relative to\r\n * the div Blockly was injected into.\r\n *\r\n * @param element SVG element to find the coordinates of. If this is not a child\r\n *     of the div Blockly was injected into, the behaviour is undefined.\r\n * @returns Object with .x and .y properties.\r\n */\r\nexport function getInjectionDivXY(element: Element): Coordinate {\r\n  let x = 0;\r\n  let y = 0;\r\n  while (element) {\r\n    const xy = getRelativeXY(element);\r\n    x = x + xy.x;\r\n    y = y + xy.y;\r\n    const classes = element.getAttribute('class') || '';\r\n    if ((' ' + classes + ' ').indexOf(' injectionDiv ') !== -1) {\r\n      break;\r\n    }\r\n    element = element.parentNode as Element;\r\n  }\r\n  return new Coordinate(x, y);\r\n}\r\n\r\n/**\r\n * Get the position of the current viewport in window coordinates.  This takes\r\n * scroll into account.\r\n *\r\n * @returns An object containing window width, height, and scroll position in\r\n *     window coordinates.\r\n * @internal\r\n */\r\nexport function getViewportBBox(): Rect {\r\n  // Pixels, in window coordinates.\r\n  const scrollOffset = style.getViewportPageOffset();\r\n  return new Rect(\r\n    scrollOffset.y,\r\n    document.documentElement.clientHeight + scrollOffset.y,\r\n    scrollOffset.x,\r\n    document.documentElement.clientWidth + scrollOffset.x,\r\n  );\r\n}\r\n\r\n/**\r\n * Gets the document scroll distance as a coordinate object.\r\n * Copied from Closure's goog.dom.getDocumentScroll.\r\n *\r\n * @returns Object with values 'x' and 'y'.\r\n */\r\nexport function getDocumentScroll(): Coordinate {\r\n  const el = document.documentElement;\r\n  const win = window;\r\n  return new Coordinate(\r\n    win.pageXOffset || el.scrollLeft,\r\n    win.pageYOffset || el.scrollTop,\r\n  );\r\n}\r\n\r\n/**\r\n * Converts screen coordinates to workspace coordinates.\r\n *\r\n * @param ws The workspace to find the coordinates on.\r\n * @param screenCoordinates The screen coordinates to be converted to workspace\r\n *     coordinates\r\n * @returns The workspace coordinates.\r\n */\r\nexport function screenToWsCoordinates(\r\n  ws: WorkspaceSvg,\r\n  screenCoordinates: Coordinate,\r\n): Coordinate {\r\n  const screenX = screenCoordinates.x;\r\n  const screenY = screenCoordinates.y;\r\n\r\n  const injectionDiv = ws.getInjectionDiv();\r\n  // Bounding rect coordinates are in client coordinates, meaning that they\r\n  // are in pixels relative to the upper left corner of the visible browser\r\n  // window.  These coordinates change when you scroll the browser window.\r\n  const boundingRect = injectionDiv.getBoundingClientRect();\r\n\r\n  // The client coordinates offset by the injection div's upper left corner.\r\n  const clientOffsetPixels = new Coordinate(\r\n    screenX - boundingRect.left,\r\n    screenY - boundingRect.top,\r\n  );\r\n\r\n  // The offset in pixels between the main workspace's origin and the upper\r\n  // left corner of the injection div.\r\n  const mainOffsetPixels = ws.getOriginOffsetInPixels();\r\n\r\n  // The position of the new comment in pixels relative to the origin of the\r\n  // main workspace.\r\n  const finalOffsetPixels = Coordinate.difference(\r\n    clientOffsetPixels,\r\n    mainOffsetPixels,\r\n  );\r\n  // The position in main workspace coordinates.\r\n  const finalOffsetMainWs = finalOffsetPixels.scale(1 / ws.scale);\r\n  return finalOffsetMainWs;\r\n}\r\n\r\n/**\r\n * Converts workspace coordinates to screen coordinates.\r\n *\r\n * @param ws The workspace to get the coordinates out of.\r\n * @param workspaceCoordinates  The workspace coordinates to be converted\r\n *     to screen coordinates.\r\n * @returns The screen coordinates.\r\n */\r\nexport function wsToScreenCoordinates(\r\n  ws: WorkspaceSvg,\r\n  workspaceCoordinates: Coordinate,\r\n): Coordinate {\r\n  // Fix workspace scale vs browser scale.\r\n  const screenCoordinates = workspaceCoordinates.scale(ws.scale);\r\n  const screenX = screenCoordinates.x;\r\n  const screenY = screenCoordinates.y;\r\n\r\n  const injectionDiv = ws.getInjectionDiv();\r\n  const boundingRect = injectionDiv.getBoundingClientRect();\r\n  const mainOffset = ws.getOriginOffsetInPixels();\r\n\r\n  // Fix workspace origin vs browser origin.\r\n  return new Coordinate(\r\n    screenX + boundingRect.left + mainOffset.x,\r\n    screenY + boundingRect.top + mainOffset.y,\r\n  );\r\n}\r\n\r\nexport const TEST_ONLY = {\r\n  XY_REGEX,\r\n  XY_STYLE_REGEX,\r\n};\r\n","/**\r\n * @license\r\n * Copyright 2018 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.utils.xml\r\n\r\nlet domParser: DOMParser = {\r\n  parseFromString: function () {\r\n    throw new Error(\r\n      'DOMParser was not found in the global scope and was not properly ' +\r\n        'injected using injectDependencies',\r\n    );\r\n  },\r\n};\r\n\r\nlet xmlSerializer: XMLSerializer = {\r\n  serializeToString: function () {\r\n    throw new Error(\r\n      'XMLSerializer was not foundin the global scope and was not properly ' +\r\n        'injected using injectDependencies',\r\n    );\r\n  },\r\n};\r\n\r\n/**\r\n * Injected dependencies.  By default these are just (and have the\r\n * same types as) the corresponding DOM Window properties, but the\r\n * Node.js wrapper for Blockly (see scripts/package/node/core.js)\r\n * calls injectDependencies to supply implementations from the jsdom\r\n * package instead.\r\n */\r\nlet {document, DOMParser, XMLSerializer} = globalThis;\r\nif (DOMParser) domParser = new DOMParser();\r\nif (XMLSerializer) xmlSerializer = new XMLSerializer();\r\n\r\n/**\r\n * Inject implementations of document, DOMParser and/or XMLSerializer\r\n * to use instead of the default ones.\r\n *\r\n * Used by the Node.js wrapper for Blockly (see\r\n * scripts/package/node/core.js) to supply implementations from the\r\n * jsdom package instead.\r\n *\r\n * While they may be set individually, it is normally the case that\r\n * all three will be sourced from the same JSDOM instance.  They MUST\r\n * at least come from the same copy of the jsdom package.  (Typically\r\n * this is hard to avoid satsifying this requirement, but it can be\r\n * inadvertently violated by using webpack to build multiple bundles\r\n * containing Blockly and jsdom, and then loading more than one into\r\n * the same JavaScript runtime.  See\r\n * https://github.com/google/blockly-samples/pull/1452#issuecomment-1364442135\r\n * for an example of how this happened.)\r\n *\r\n * @param dependencies Options object containing dependencies to set.\r\n */\r\nexport function injectDependencies(dependencies: {\r\n  document?: Document;\r\n  DOMParser?: typeof DOMParser;\r\n  XMLSerializer?: typeof XMLSerializer;\r\n}) {\r\n  ({\r\n    // Default to existing value if option not supplied.\r\n    document = document,\r\n    DOMParser = DOMParser,\r\n    XMLSerializer = XMLSerializer,\r\n  } = dependencies);\r\n\r\n  domParser = new DOMParser();\r\n  xmlSerializer = new XMLSerializer();\r\n}\r\n\r\n/**\r\n * Namespace for Blockly's XML.\r\n */\r\nexport const NAME_SPACE = 'https://developers.google.com/blockly/xml';\r\n\r\n// eslint-disable-next-line no-control-regex\r\nconst INVALID_CONTROL_CHARS = /[\\x00-\\x09\\x0B\\x0C\\x0E-\\x1F]/g;\r\n\r\n/**\r\n * Create DOM element for XML.\r\n *\r\n * @param tagName Name of DOM element.\r\n * @returns New DOM element.\r\n */\r\nexport function createElement(tagName: string): Element {\r\n  return document.createElementNS(NAME_SPACE, tagName);\r\n}\r\n\r\n/**\r\n * Create text element for XML.\r\n *\r\n * @param text Text content.\r\n * @returns New DOM text node.\r\n */\r\nexport function createTextNode(text: string): Text {\r\n  return document.createTextNode(text);\r\n}\r\n\r\n/**\r\n * Converts an XML string into a DOM structure.\r\n *\r\n * Control characters should be escaped. (But we will try to best-effort parse\r\n * unescaped characters.)\r\n *\r\n * Note that even when escaped, U+0000 will be parsed as U+FFFD (the\r\n * \"replacement character\") because U+0000 is never a valid XML character\r\n * (even in XML 1.1).\r\n * https://www.w3.org/TR/xml11/#charsets\r\n *\r\n * @param text An XML string.\r\n * @returns A DOM object representing the singular child of the document\r\n *     element.\r\n * @throws if the text doesn't parse.\r\n */\r\nexport function textToDom(text: string): Element {\r\n  let doc = domParser.parseFromString(text, 'text/xml');\r\n  if (\r\n    doc &&\r\n    doc.documentElement &&\r\n    !doc.getElementsByTagName('parsererror').length\r\n  ) {\r\n    return doc.documentElement;\r\n  }\r\n\r\n  // Attempt to parse as HTML to deserialize control characters that were\r\n  // serialized before the serializer did proper escaping.\r\n  doc = domParser.parseFromString(text, 'text/html');\r\n  if (\r\n    doc &&\r\n    doc.body.firstChild &&\r\n    doc.body.firstChild.nodeName.toLowerCase() === 'xml'\r\n  ) {\r\n    return doc.body.firstChild as Element;\r\n  }\r\n\r\n  throw new Error(`DOMParser was unable to parse: ${text}`);\r\n}\r\n\r\n/**\r\n * Converts a DOM structure into plain text.\r\n * Currently the text format is fairly ugly: all one line with no whitespace.\r\n *\r\n * Control characters are escaped using their decimal encodings. This includes\r\n * U+0000 even though it is technically never a valid XML character (even in\r\n * XML 1.1).\r\n * https://www.w3.org/TR/xml11/#charsets\r\n *\r\n * When decoded U+0000 will be parsed as U+FFFD (the \"replacement character\").\r\n *\r\n * @param dom A tree of XML nodes.\r\n * @returns Text representation.\r\n */\r\nexport function domToText(dom: Node): string {\r\n  return sanitizeText(xmlSerializer.serializeToString(dom));\r\n}\r\n\r\nfunction sanitizeText(text: string) {\r\n  return text.replace(\r\n    INVALID_CONTROL_CHARS,\r\n    (match) => `&#${match.charCodeAt(0)};`,\r\n  );\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.utils.toolbox\r\n\r\nimport type {ConnectionState} from '../serialization/blocks.js';\r\nimport type {CssConfig as CategoryCssConfig} from '../toolbox/category.js';\r\nimport type {CssConfig as SeparatorCssConfig} from '../toolbox/separator.js';\r\nimport * as utilsXml from './xml.js';\r\n\r\n/**\r\n * The information needed to create a block in the toolbox.\r\n * Note that disabled has a different type for backwards compatibility.\r\n */\r\nexport interface BlockInfo {\r\n  kind: string;\r\n  blockxml?: string | Node;\r\n  type?: string;\r\n  gap?: string | number;\r\n  disabled?: string | boolean;\r\n  enabled?: boolean;\r\n  id?: string;\r\n  x?: number;\r\n  y?: number;\r\n  collapsed?: boolean;\r\n  inline?: boolean;\r\n  data?: string;\r\n  extraState?: AnyDuringMigration;\r\n  icons?: {[key: string]: AnyDuringMigration};\r\n  fields?: {[key: string]: AnyDuringMigration};\r\n  inputs?: {[key: string]: ConnectionState};\r\n  next?: ConnectionState;\r\n}\r\n\r\n/**\r\n * The information needed to create a separator in the toolbox.\r\n */\r\nexport interface SeparatorInfo {\r\n  kind: string;\r\n  id: string | undefined;\r\n  gap: number | undefined;\r\n  cssconfig: SeparatorCssConfig | undefined;\r\n}\r\n\r\n/**\r\n * The information needed to create a button in the toolbox.\r\n */\r\nexport interface ButtonInfo {\r\n  kind: string;\r\n  text: string;\r\n  callbackkey: string;\r\n}\r\n\r\n/**\r\n * The information needed to create a label in the toolbox.\r\n */\r\nexport interface LabelInfo {\r\n  kind: string;\r\n  text: string;\r\n  id: string | undefined;\r\n}\r\n\r\n/**\r\n * The information needed to create either a button or a label in the flyout.\r\n */\r\nexport type ButtonOrLabelInfo = ButtonInfo | LabelInfo;\r\n\r\n/**\r\n * The information needed to create a category in the toolbox.\r\n */\r\nexport interface StaticCategoryInfo {\r\n  kind: string;\r\n  name: string;\r\n  contents: ToolboxItemInfo[];\r\n  id: string | undefined;\r\n  categorystyle: string | undefined;\r\n  colour: string | undefined;\r\n  cssconfig: CategoryCssConfig | undefined;\r\n  hidden: string | undefined;\r\n  expanded?: string | boolean;\r\n}\r\n\r\n/**\r\n * The information needed to create a custom category.\r\n */\r\nexport interface DynamicCategoryInfo {\r\n  kind: string;\r\n  custom: string;\r\n  id: string | undefined;\r\n  categorystyle: string | undefined;\r\n  colour: string | undefined;\r\n  cssconfig: CategoryCssConfig | undefined;\r\n  hidden: string | undefined;\r\n  expanded?: string | boolean;\r\n}\r\n\r\n/**\r\n * The information needed to create either a dynamic or static category.\r\n */\r\nexport type CategoryInfo = StaticCategoryInfo | DynamicCategoryInfo;\r\n\r\n/**\r\n * Any information that can be used to create an item in the toolbox.\r\n */\r\nexport type ToolboxItemInfo = FlyoutItemInfo | StaticCategoryInfo;\r\n\r\n/**\r\n * All the different types that can be displayed in a flyout.\r\n */\r\nexport type FlyoutItemInfo =\r\n  | BlockInfo\r\n  | SeparatorInfo\r\n  | ButtonInfo\r\n  | LabelInfo\r\n  | DynamicCategoryInfo;\r\n\r\n/**\r\n * The JSON definition of a toolbox.\r\n */\r\nexport interface ToolboxInfo {\r\n  kind?: string;\r\n  contents: ToolboxItemInfo[];\r\n}\r\n\r\n/**\r\n * An array holding flyout items.\r\n */\r\nexport type FlyoutItemInfoArray = FlyoutItemInfo[];\r\n\r\n/**\r\n * All of the different types that can create a toolbox.\r\n */\r\nexport type ToolboxDefinition = Node | ToolboxInfo | string;\r\n\r\n/**\r\n * All of the different types that can be used to show items in a flyout.\r\n */\r\nexport type FlyoutDefinition =\r\n  | FlyoutItemInfoArray\r\n  | NodeList\r\n  | ToolboxInfo\r\n  | Node[];\r\n\r\n/**\r\n * The name used to identify a toolbox that has category like items.\r\n * This only needs to be used if a toolbox wants to be treated like a category\r\n * toolbox but does not actually contain any toolbox items with the kind\r\n * 'category'.\r\n */\r\nconst CATEGORY_TOOLBOX_KIND = 'categoryToolbox';\r\n\r\n/**\r\n * The name used to identify a toolbox that has no categories and is displayed\r\n * as a simple flyout displaying blocks, buttons, or labels.\r\n */\r\nconst FLYOUT_TOOLBOX_KIND = 'flyoutToolbox';\r\n\r\n/**\r\n * Position of the toolbox and/or flyout relative to the workspace.\r\n */\r\nexport enum Position {\r\n  TOP,\r\n  BOTTOM,\r\n  LEFT,\r\n  RIGHT,\r\n}\r\n\r\n/**\r\n * Converts the toolbox definition into toolbox JSON.\r\n *\r\n * @param toolboxDef The definition of the toolbox in one of its many forms.\r\n * @returns Object holding information for creating a toolbox.\r\n * @internal\r\n */\r\nexport function convertToolboxDefToJson(\r\n  toolboxDef: ToolboxDefinition | null,\r\n): ToolboxInfo | null {\r\n  if (!toolboxDef) {\r\n    return null;\r\n  }\r\n\r\n  if (toolboxDef instanceof Element || typeof toolboxDef === 'string') {\r\n    toolboxDef = parseToolboxTree(toolboxDef);\r\n    // AnyDuringMigration because:  Argument of type 'Node | null' is not\r\n    // assignable to parameter of type 'Node'.\r\n    toolboxDef = convertToToolboxJson(toolboxDef as AnyDuringMigration);\r\n  }\r\n\r\n  const toolboxJson = toolboxDef as ToolboxInfo;\r\n  validateToolbox(toolboxJson);\r\n  return toolboxJson;\r\n}\r\n\r\n/**\r\n * Validates the toolbox JSON fields have been set correctly.\r\n *\r\n * @param toolboxJson Object holding information for creating a toolbox.\r\n * @throws {Error} if the toolbox is not the correct format.\r\n */\r\nfunction validateToolbox(toolboxJson: ToolboxInfo) {\r\n  const toolboxKind = toolboxJson['kind'];\r\n  const toolboxContents = toolboxJson['contents'];\r\n\r\n  if (toolboxKind) {\r\n    if (\r\n      toolboxKind !== FLYOUT_TOOLBOX_KIND &&\r\n      toolboxKind !== CATEGORY_TOOLBOX_KIND\r\n    ) {\r\n      throw Error(\r\n        'Invalid toolbox kind ' +\r\n          toolboxKind +\r\n          '.' +\r\n          ' Please supply either ' +\r\n          FLYOUT_TOOLBOX_KIND +\r\n          ' or ' +\r\n          CATEGORY_TOOLBOX_KIND,\r\n      );\r\n    }\r\n  }\r\n  if (!toolboxContents) {\r\n    throw Error('Toolbox must have a contents attribute.');\r\n  }\r\n}\r\n\r\n/**\r\n * Converts the flyout definition into a list of flyout items.\r\n *\r\n * @param flyoutDef The definition of the flyout in one of its many forms.\r\n * @returns A list of flyout items.\r\n * @internal\r\n */\r\nexport function convertFlyoutDefToJsonArray(\r\n  flyoutDef: FlyoutDefinition | null,\r\n): FlyoutItemInfoArray {\r\n  if (!flyoutDef) {\r\n    return [];\r\n  }\r\n\r\n  if ((flyoutDef as AnyDuringMigration)['contents']) {\r\n    return (flyoutDef as AnyDuringMigration)['contents'];\r\n  }\r\n  // If it is already in the correct format return the flyoutDef.\r\n  // AnyDuringMigration because:  Property 'nodeType' does not exist on type\r\n  // 'Node | FlyoutItemInfo'.\r\n  if (\r\n    Array.isArray(flyoutDef) &&\r\n    flyoutDef.length > 0 &&\r\n    !(flyoutDef[0] as AnyDuringMigration).nodeType\r\n  ) {\r\n    // AnyDuringMigration because:  Type 'FlyoutItemInfoArray | Node[]' is not\r\n    // assignable to type 'FlyoutItemInfoArray'.\r\n    return flyoutDef as AnyDuringMigration;\r\n  }\r\n\r\n  // AnyDuringMigration because:  Type 'ToolboxItemInfo[] | FlyoutItemInfoArray'\r\n  // is not assignable to type 'FlyoutItemInfoArray'.\r\n  return xmlToJsonArray(flyoutDef as Node[] | NodeList) as AnyDuringMigration;\r\n}\r\n\r\n/**\r\n * Whether or not the toolbox definition has categories.\r\n *\r\n * @param toolboxJson Object holding information for creating a toolbox.\r\n * @returns True if the toolbox has categories.\r\n * @internal\r\n */\r\nexport function hasCategories(toolboxJson: ToolboxInfo | null): boolean {\r\n  return TEST_ONLY.hasCategoriesInternal(toolboxJson);\r\n}\r\n\r\n/**\r\n * Private version of hasCategories for stubbing in tests.\r\n */\r\nfunction hasCategoriesInternal(toolboxJson: ToolboxInfo | null): boolean {\r\n  if (!toolboxJson) {\r\n    return false;\r\n  }\r\n\r\n  const toolboxKind = toolboxJson['kind'];\r\n  if (toolboxKind) {\r\n    return toolboxKind === CATEGORY_TOOLBOX_KIND;\r\n  }\r\n\r\n  const categories = toolboxJson['contents'].filter(function (item) {\r\n    return item['kind'].toUpperCase() === 'CATEGORY';\r\n  });\r\n  return !!categories.length;\r\n}\r\n\r\n/**\r\n * Whether or not the category is collapsible.\r\n *\r\n * @param categoryInfo Object holing information for creating a category.\r\n * @returns True if the category has subcategories.\r\n * @internal\r\n */\r\nexport function isCategoryCollapsible(categoryInfo: CategoryInfo): boolean {\r\n  if (!categoryInfo || !(categoryInfo as AnyDuringMigration)['contents']) {\r\n    return false;\r\n  }\r\n\r\n  const categories = (categoryInfo as AnyDuringMigration)['contents'].filter(\r\n    function (item: AnyDuringMigration) {\r\n      return item['kind'].toUpperCase() === 'CATEGORY';\r\n    },\r\n  );\r\n  return !!categories.length;\r\n}\r\n\r\n/**\r\n * Parses the provided toolbox definition into a consistent format.\r\n *\r\n * @param toolboxDef The definition of the toolbox in one of its many forms.\r\n * @returns Object holding information for creating a toolbox.\r\n */\r\nfunction convertToToolboxJson(toolboxDef: Node): ToolboxInfo {\r\n  const contents = xmlToJsonArray(toolboxDef as Node | Node[]);\r\n  const toolboxJson = {'contents': contents};\r\n  if (toolboxDef instanceof Node) {\r\n    addAttributes(toolboxDef, toolboxJson);\r\n  }\r\n  return toolboxJson;\r\n}\r\n\r\n/**\r\n * Converts the xml for a toolbox to JSON.\r\n *\r\n * @param toolboxDef The definition of the toolbox in one of its many forms.\r\n * @returns A list of objects in the toolbox.\r\n */\r\nfunction xmlToJsonArray(\r\n  toolboxDef: Node | Node[] | NodeList,\r\n): FlyoutItemInfoArray | ToolboxItemInfo[] {\r\n  const arr = [];\r\n  // If it is a node it will have children.\r\n  // AnyDuringMigration because:  Property 'childNodes' does not exist on type\r\n  // 'Node | NodeList | Node[]'.\r\n  let childNodes = (toolboxDef as AnyDuringMigration).childNodes;\r\n  if (!childNodes) {\r\n    // Otherwise the toolboxDef is an array or collection.\r\n    childNodes = toolboxDef;\r\n  }\r\n  for (let i = 0, child; (child = childNodes[i]); i++) {\r\n    if (!child.tagName) {\r\n      continue;\r\n    }\r\n    const obj = {};\r\n    const tagName = child.tagName.toUpperCase();\r\n    (obj as AnyDuringMigration)['kind'] = tagName;\r\n\r\n    // Store the XML for a block.\r\n    if (tagName === 'BLOCK') {\r\n      (obj as AnyDuringMigration)['blockxml'] = child;\r\n    } else if (child.childNodes && child.childNodes.length > 0) {\r\n      // Get the contents of a category\r\n      (obj as AnyDuringMigration)['contents'] = xmlToJsonArray(child);\r\n    }\r\n\r\n    // Add XML attributes to object\r\n    addAttributes(child, obj);\r\n    arr.push(obj);\r\n  }\r\n  // AnyDuringMigration because:  Type '{}[]' is not assignable to type\r\n  // 'ToolboxItemInfo[] | FlyoutItemInfoArray'.\r\n  return arr as AnyDuringMigration;\r\n}\r\n\r\n/**\r\n * Adds the attributes on the node to the given object.\r\n *\r\n * @param node The node to copy the attributes from.\r\n * @param obj The object to copy the attributes to.\r\n */\r\nfunction addAttributes(node: Node, obj: AnyDuringMigration) {\r\n  // AnyDuringMigration because:  Property 'attributes' does not exist on type\r\n  // 'Node'.\r\n  for (let j = 0; j < (node as AnyDuringMigration).attributes.length; j++) {\r\n    // AnyDuringMigration because:  Property 'attributes' does not exist on type\r\n    // 'Node'.\r\n    const attr = (node as AnyDuringMigration).attributes[j];\r\n    if (attr.nodeName.indexOf('css-') > -1) {\r\n      obj['cssconfig'] = obj['cssconfig'] || {};\r\n      obj['cssconfig'][attr.nodeName.replace('css-', '')] = attr.value;\r\n    } else {\r\n      obj[attr.nodeName] = attr.value;\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Parse the provided toolbox tree into a consistent DOM format.\r\n *\r\n * @param toolboxDef DOM tree of blocks, or text representation of same.\r\n * @returns DOM tree of blocks, or null.\r\n */\r\nexport function parseToolboxTree(\r\n  toolboxDef: Element | null | string,\r\n): Element | null {\r\n  let parsedToolboxDef: Element | null = null;\r\n  if (toolboxDef) {\r\n    if (typeof toolboxDef === 'string') {\r\n      parsedToolboxDef = utilsXml.textToDom(toolboxDef);\r\n      if (parsedToolboxDef.nodeName.toLowerCase() !== 'xml') {\r\n        throw TypeError('Toolbox should be an <xml> document.');\r\n      }\r\n    } else if (toolboxDef instanceof Element) {\r\n      parsedToolboxDef = toolboxDef;\r\n    }\r\n  }\r\n  return parsedToolboxDef;\r\n}\r\n\r\nexport const TEST_ONLY = {\r\n  hasCategoriesInternal,\r\n};\r\n","/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.uiPosition\r\n\r\nimport type {UiMetrics} from './metrics_manager.js';\r\nimport {Scrollbar} from './scrollbar.js';\r\nimport {Rect} from './utils/rect.js';\r\nimport type {Size} from './utils/size.js';\r\nimport * as toolbox from './utils/toolbox.js';\r\nimport type {WorkspaceSvg} from './workspace_svg.js';\r\n\r\n/**\r\n * Enum for vertical positioning.\r\n *\r\n * @internal\r\n */\r\nexport enum verticalPosition {\r\n  TOP,\r\n  BOTTOM,\r\n}\r\n\r\n/**\r\n * Enum for horizontal positioning.\r\n *\r\n * @internal\r\n */\r\nexport enum horizontalPosition {\r\n  LEFT,\r\n  RIGHT,\r\n}\r\n\r\n/**\r\n * An object defining a horizontal and vertical positioning.\r\n *\r\n * @internal\r\n */\r\nexport interface Position {\r\n  horizontal: horizontalPosition;\r\n  vertical: verticalPosition;\r\n}\r\n\r\n/**\r\n * Enum for bump rules to use for dealing with collisions.\r\n *\r\n * @internal\r\n */\r\nexport enum bumpDirection {\r\n  UP,\r\n  DOWN,\r\n}\r\n\r\n/**\r\n * Returns a rectangle representing reasonable position for where to place a UI\r\n * element of the specified size given the restraints and locations of the\r\n * scrollbars. This method does not take into account any already placed UI\r\n * elements.\r\n *\r\n * @param position The starting horizontal and vertical position.\r\n * @param size the size of the UI element to get a start position for.\r\n * @param horizontalPadding The horizontal padding to use.\r\n * @param verticalPadding The vertical padding to use.\r\n * @param metrics The workspace UI metrics.\r\n * @param workspace The workspace.\r\n * @returns The suggested start position.\r\n * @internal\r\n */\r\nexport function getStartPositionRect(\r\n  position: Position,\r\n  size: Size,\r\n  horizontalPadding: number,\r\n  verticalPadding: number,\r\n  metrics: UiMetrics,\r\n  workspace: WorkspaceSvg,\r\n): Rect {\r\n  // Horizontal positioning.\r\n  let left = 0;\r\n  const hasVerticalScrollbar =\r\n    workspace.scrollbar && workspace.scrollbar.canScrollVertically();\r\n  if (position.horizontal === horizontalPosition.LEFT) {\r\n    left = metrics.absoluteMetrics.left + horizontalPadding;\r\n    if (hasVerticalScrollbar && workspace.RTL) {\r\n      left += Scrollbar.scrollbarThickness;\r\n    }\r\n  } else {\r\n    // position.horizontal === horizontalPosition.RIGHT\r\n    left =\r\n      metrics.absoluteMetrics.left +\r\n      metrics.viewMetrics.width -\r\n      size.width -\r\n      horizontalPadding;\r\n    if (hasVerticalScrollbar && !workspace.RTL) {\r\n      left -= Scrollbar.scrollbarThickness;\r\n    }\r\n  }\r\n  // Vertical positioning.\r\n  let top = 0;\r\n  if (position.vertical === verticalPosition.TOP) {\r\n    top = metrics.absoluteMetrics.top + verticalPadding;\r\n  } else {\r\n    // position.vertical === verticalPosition.BOTTOM\r\n    top =\r\n      metrics.absoluteMetrics.top +\r\n      metrics.viewMetrics.height -\r\n      size.height -\r\n      verticalPadding;\r\n    if (workspace.scrollbar && workspace.scrollbar.canScrollHorizontally()) {\r\n      // The scrollbars are always positioned on the bottom if they exist.\r\n      top -= Scrollbar.scrollbarThickness;\r\n    }\r\n  }\r\n  return new Rect(top, top + size.height, left, left + size.width);\r\n}\r\n\r\n/**\r\n * Returns a corner position that is on the opposite side of the workspace from\r\n * the toolbox.\r\n * If in horizontal orientation, defaults to the bottom corner. If in vertical\r\n * orientation, defaults to the right corner.\r\n *\r\n * @param workspace The workspace.\r\n * @param metrics The workspace metrics.\r\n * @returns The suggested corner position.\r\n * @internal\r\n */\r\nexport function getCornerOppositeToolbox(\r\n  workspace: WorkspaceSvg,\r\n  metrics: UiMetrics,\r\n): Position {\r\n  const leftCorner =\r\n    metrics.toolboxMetrics.position !== toolbox.Position.LEFT &&\r\n    (!workspace.horizontalLayout || workspace.RTL);\r\n  const topCorner = metrics.toolboxMetrics.position === toolbox.Position.BOTTOM;\r\n  const hPosition = leftCorner\r\n    ? horizontalPosition.LEFT\r\n    : horizontalPosition.RIGHT;\r\n  const vPosition = topCorner ? verticalPosition.TOP : verticalPosition.BOTTOM;\r\n  return {horizontal: hPosition, vertical: vPosition};\r\n}\r\n\r\n/**\r\n * Returns a position Rect based on a starting position that is bumped\r\n * so that it doesn't intersect with any of the provided savedPositions. This\r\n * method does not check that the bumped position is still within bounds.\r\n *\r\n * @param startRect The starting position to use.\r\n * @param margin The margin to use between elements when bumping.\r\n * @param bumpDir The direction to bump if there is a collision with an existing\r\n *     UI element.\r\n * @param savedPositions List of rectangles that represent the positions of UI\r\n *     elements already placed.\r\n * @returns The suggested position rectangle.\r\n * @internal\r\n */\r\nexport function bumpPositionRect(\r\n  startRect: Rect,\r\n  margin: number,\r\n  bumpDir: bumpDirection,\r\n  savedPositions: Rect[],\r\n): Rect {\r\n  let top = startRect.top;\r\n  const left = startRect.left;\r\n  const width = startRect.right - startRect.left;\r\n  const height = startRect.bottom - startRect.top;\r\n\r\n  // Check for collision and bump if needed.\r\n  let boundingRect = startRect;\r\n  for (let i = 0; i < savedPositions.length; i++) {\r\n    const otherEl = savedPositions[i];\r\n    if (boundingRect.intersects(otherEl)) {\r\n      if (bumpDir === bumpDirection.UP) {\r\n        top = otherEl.top - height - margin;\r\n      } else {\r\n        // bumpDir === bumpDirection.DOWN\r\n        top = otherEl.bottom + margin;\r\n      }\r\n      // Recheck other savedPositions\r\n      boundingRect = new Rect(top, top + height, left, left + width);\r\n      i = -1;\r\n    }\r\n  }\r\n  return boundingRect;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.dialog\r\n\r\nlet alertImplementation = function (\r\n  message: string,\r\n  opt_callback?: () => void,\r\n) {\r\n  window.alert(message);\r\n  if (opt_callback) {\r\n    opt_callback();\r\n  }\r\n};\r\n\r\nlet confirmImplementation = function (\r\n  message: string,\r\n  callback: (result: boolean) => void,\r\n) {\r\n  callback(window.confirm(message));\r\n};\r\n\r\nlet promptImplementation = function (\r\n  message: string,\r\n  defaultValue: string,\r\n  callback: (result: string | null) => void,\r\n) {\r\n  callback(window.prompt(message, defaultValue));\r\n};\r\n\r\n/**\r\n * Wrapper to window.alert() that app developers may override via setAlert to\r\n * provide alternatives to the modal browser window.\r\n *\r\n * @param message The message to display to the user.\r\n * @param opt_callback The callback when the alert is dismissed.\r\n */\r\nexport function alert(message: string, opt_callback?: () => void) {\r\n  alertImplementation(message, opt_callback);\r\n}\r\n\r\n/**\r\n * Sets the function to be run when Blockly.dialog.alert() is called.\r\n *\r\n * @param alertFunction The function to be run.\r\n * @see Blockly.dialog.alert\r\n */\r\nexport function setAlert(alertFunction: (p1: string, p2?: () => void) => void) {\r\n  alertImplementation = alertFunction;\r\n}\r\n\r\n/**\r\n * Wrapper to window.confirm() that app developers may override via setConfirm\r\n * to provide alternatives to the modal browser window.\r\n *\r\n * @param message The message to display to the user.\r\n * @param callback The callback for handling user response.\r\n */\r\nexport function confirm(message: string, callback: (p1: boolean) => void) {\r\n  TEST_ONLY.confirmInternal(message, callback);\r\n}\r\n\r\n/**\r\n * Private version of confirm for stubbing in tests.\r\n */\r\nfunction confirmInternal(message: string, callback: (p1: boolean) => void) {\r\n  confirmImplementation(message, callback);\r\n}\r\n\r\n/**\r\n * Sets the function to be run when Blockly.dialog.confirm() is called.\r\n *\r\n * @param confirmFunction The function to be run.\r\n * @see Blockly.dialog.confirm\r\n */\r\nexport function setConfirm(\r\n  confirmFunction: (p1: string, p2: (p1: boolean) => void) => void,\r\n) {\r\n  confirmImplementation = confirmFunction;\r\n}\r\n\r\n/**\r\n * Wrapper to window.prompt() that app developers may override via setPrompt to\r\n * provide alternatives to the modal browser window. Built-in browser prompts\r\n * are often used for better text input experience on mobile device. We strongly\r\n * recommend testing mobile when overriding this.\r\n *\r\n * @param message The message to display to the user.\r\n * @param defaultValue The value to initialize the prompt with.\r\n * @param callback The callback for handling user response.\r\n */\r\nexport function prompt(\r\n  message: string,\r\n  defaultValue: string,\r\n  callback: (p1: string | null) => void,\r\n) {\r\n  promptImplementation(message, defaultValue, callback);\r\n}\r\n\r\n/**\r\n * Sets the function to be run when Blockly.dialog.prompt() is called.\r\n *\r\n * @param promptFunction The function to be run.\r\n * @see Blockly.dialog.prompt\r\n */\r\nexport function setPrompt(\r\n  promptFunction: (\r\n    p1: string,\r\n    p2: string,\r\n    p3: (p1: string | null) => void,\r\n  ) => void,\r\n) {\r\n  promptImplementation = promptFunction;\r\n}\r\n\r\nexport const TEST_ONLY = {\r\n  confirmInternal,\r\n};\r\n","/**\r\n * @license\r\n * Copyright 2023 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport type {VariableModel} from '../variable_model.js';\r\nimport {IParameterModel} from './i_parameter_model.js';\r\n\r\n/** Interface for a parameter model that holds a variable model. */\r\nexport interface IVariableBackedParameterModel extends IParameterModel {\r\n  /** Returns the variable model held by this type. */\r\n  getVariableModel(): VariableModel;\r\n}\r\n\r\n/**\r\n * Returns whether the given object is a variable holder or not.\r\n */\r\nexport function isVariableBackedParameterModel(\r\n  param: IParameterModel,\r\n): param is IVariableBackedParameterModel {\r\n  return (param as any).getVariableModel !== undefined;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2023 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Legacy means of representing a procedure signature. The elements are\r\n * respectively: name, parameter names, and whether it has a return value.\r\n */\r\nexport type ProcedureTuple = [string, string[], boolean];\r\n\r\n/**\r\n * Procedure block type.\r\n *\r\n * @internal\r\n */\r\nexport interface ProcedureBlock {\r\n  getProcedureCall: () => string;\r\n  renameProcedure: (p1: string, p2: string) => void;\r\n  getProcedureDef: () => ProcedureTuple;\r\n}\r\n\r\n/** @internal */\r\nexport interface LegacyProcedureDefBlock {\r\n  getProcedureDef: () => ProcedureTuple;\r\n}\r\n\r\n/** @internal */\r\nexport function isLegacyProcedureDefBlock(\r\n  block: Object,\r\n): block is LegacyProcedureDefBlock {\r\n  return (block as any).getProcedureDef !== undefined;\r\n}\r\n\r\n/** @internal */\r\nexport interface LegacyProcedureCallBlock {\r\n  getProcedureCall: () => string;\r\n  renameProcedure: (p1: string, p2: string) => void;\r\n}\r\n\r\n/** @internal */\r\nexport function isLegacyProcedureCallBlock(\r\n  block: Object,\r\n): block is LegacyProcedureCallBlock {\r\n  return (\r\n    (block as any).getProcedureCall !== undefined &&\r\n    (block as any).renameProcedure !== undefined\r\n  );\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2012 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.Variables\r\n\r\nimport {Blocks} from './blocks.js';\r\nimport * as dialog from './dialog.js';\r\nimport {isVariableBackedParameterModel} from './interfaces/i_variable_backed_parameter_model.js';\r\nimport {Msg} from './msg.js';\r\nimport {isLegacyProcedureDefBlock} from './interfaces/i_legacy_procedure_blocks.js';\r\nimport * as utilsXml from './utils/xml.js';\r\nimport {VariableModel} from './variable_model.js';\r\nimport type {Workspace} from './workspace.js';\r\nimport type {WorkspaceSvg} from './workspace_svg.js';\r\n\r\n/**\r\n * String for use in the \"custom\" attribute of a category in toolbox XML.\r\n * This string indicates that the category should be dynamically populated with\r\n * variable blocks.\r\n * See also Blockly.Procedures.CATEGORY_NAME and\r\n * Blockly.VariablesDynamic.CATEGORY_NAME.\r\n */\r\nexport const CATEGORY_NAME = 'VARIABLE';\r\n\r\n/**\r\n * Find all user-created variables that are in use in the workspace.\r\n * For use by generators.\r\n * To get a list of all variables on a workspace, including unused variables,\r\n * call Workspace.getAllVariables.\r\n *\r\n * @param ws The workspace to search for variables.\r\n * @returns Array of variable models.\r\n */\r\nexport function allUsedVarModels(ws: Workspace): VariableModel[] {\r\n  const blocks = ws.getAllBlocks(false);\r\n  const variables = new Set<VariableModel>();\r\n  // Iterate through every block and add each variable to the set.\r\n  for (let i = 0; i < blocks.length; i++) {\r\n    const blockVariables = blocks[i].getVarModels();\r\n    if (blockVariables) {\r\n      for (let j = 0; j < blockVariables.length; j++) {\r\n        const variable = blockVariables[j];\r\n        const id = variable.getId();\r\n        if (id) {\r\n          variables.add(variable);\r\n        }\r\n      }\r\n    }\r\n  }\r\n  // Convert the set into a list.\r\n  return Array.from(variables.values());\r\n}\r\n\r\n/**\r\n * Find all developer variables used by blocks in the workspace.\r\n * Developer variables are never shown to the user, but are declared as global\r\n * variables in the generated code.\r\n * To declare developer variables, define the getDeveloperVariables function on\r\n * your block and return a list of variable names.\r\n * For use by generators.\r\n *\r\n * @param workspace The workspace to search.\r\n * @returns A list of non-duplicated variable names.\r\n */\r\nexport function allDeveloperVariables(workspace: Workspace): string[] {\r\n  const blocks = workspace.getAllBlocks(false);\r\n  const variables = new Set<string>();\r\n  for (let i = 0, block; (block = blocks[i]); i++) {\r\n    const getDeveloperVariables = block.getDeveloperVariables;\r\n    if (getDeveloperVariables) {\r\n      const devVars = getDeveloperVariables();\r\n      for (let j = 0; j < devVars.length; j++) {\r\n        variables.add(devVars[j]);\r\n      }\r\n    }\r\n  }\r\n  // Convert the set into a list.\r\n  return Array.from(variables.values());\r\n}\r\n\r\n/**\r\n * Construct the elements (blocks and button) required by the flyout for the\r\n * variable category.\r\n *\r\n * @param workspace The workspace containing variables.\r\n * @returns Array of XML elements.\r\n */\r\nexport function flyoutCategory(workspace: WorkspaceSvg): Element[] {\r\n  let xmlList = new Array<Element>();\r\n  const button = document.createElement('button');\r\n  button.setAttribute('text', '%{BKY_NEW_VARIABLE}');\r\n  button.setAttribute('callbackKey', 'CREATE_VARIABLE');\r\n\r\n  workspace.registerButtonCallback('CREATE_VARIABLE', function (button) {\r\n    createVariableButtonHandler(button.getTargetWorkspace());\r\n  });\r\n\r\n  xmlList.push(button);\r\n\r\n  const blockList = flyoutCategoryBlocks(workspace);\r\n  xmlList = xmlList.concat(blockList);\r\n  return xmlList;\r\n}\r\n\r\n/**\r\n * Construct the blocks required by the flyout for the variable category.\r\n *\r\n * @param workspace The workspace containing variables.\r\n * @returns Array of XML block elements.\r\n */\r\nexport function flyoutCategoryBlocks(workspace: Workspace): Element[] {\r\n  const variableModelList = workspace.getVariablesOfType('');\r\n\r\n  const xmlList = [];\r\n  if (variableModelList.length > 0) {\r\n    // New variables are added to the end of the variableModelList.\r\n    const mostRecentVariable = variableModelList[variableModelList.length - 1];\r\n    if (Blocks['variables_set']) {\r\n      const block = utilsXml.createElement('block');\r\n      block.setAttribute('type', 'variables_set');\r\n      block.setAttribute('gap', Blocks['math_change'] ? '8' : '24');\r\n      block.appendChild(generateVariableFieldDom(mostRecentVariable));\r\n      xmlList.push(block);\r\n    }\r\n    if (Blocks['math_change']) {\r\n      const block = utilsXml.createElement('block');\r\n      block.setAttribute('type', 'math_change');\r\n      block.setAttribute('gap', Blocks['variables_get'] ? '20' : '8');\r\n      block.appendChild(generateVariableFieldDom(mostRecentVariable));\r\n      const value = utilsXml.textToDom(\r\n        '<value name=\"DELTA\">' +\r\n          '<shadow type=\"math_number\">' +\r\n          '<field name=\"NUM\">1</field>' +\r\n          '</shadow>' +\r\n          '</value>',\r\n      );\r\n      block.appendChild(value);\r\n      xmlList.push(block);\r\n    }\r\n\r\n    if (Blocks['variables_get']) {\r\n      variableModelList.sort(VariableModel.compareByName);\r\n      for (let i = 0, variable; (variable = variableModelList[i]); i++) {\r\n        const block = utilsXml.createElement('block');\r\n        block.setAttribute('type', 'variables_get');\r\n        block.setAttribute('gap', '8');\r\n        block.appendChild(generateVariableFieldDom(variable));\r\n        xmlList.push(block);\r\n      }\r\n    }\r\n  }\r\n  return xmlList;\r\n}\r\n\r\nexport const VAR_LETTER_OPTIONS = 'ijkmnopqrstuvwxyzabcdefgh';\r\n\r\n/**\r\n * Return a new variable name that is not yet being used. This will try to\r\n * generate single letter variable names in the range 'i' to 'z' to start with.\r\n * If no unique name is located it will try 'i' to 'z', 'a' to 'h',\r\n * then 'i2' to 'z2' etc.  Skip 'l'.\r\n *\r\n * @param workspace The workspace to be unique in.\r\n * @returns New variable name.\r\n */\r\nexport function generateUniqueName(workspace: Workspace): string {\r\n  return TEST_ONLY.generateUniqueNameInternal(workspace);\r\n}\r\n\r\n/**\r\n * Private version of generateUniqueName for stubbing in tests.\r\n */\r\nfunction generateUniqueNameInternal(workspace: Workspace): string {\r\n  return generateUniqueNameFromOptions(\r\n    VAR_LETTER_OPTIONS.charAt(0),\r\n    workspace.getAllVariableNames(),\r\n  );\r\n}\r\n\r\n/**\r\n * Returns a unique name that is not present in the usedNames array. This\r\n * will try to generate single letter names in the range a - z (skip l). It\r\n * will start with the character passed to startChar.\r\n *\r\n * @param startChar The character to start the search at.\r\n * @param usedNames A list of all of the used names.\r\n * @returns A unique name that is not present in the usedNames array.\r\n */\r\nexport function generateUniqueNameFromOptions(\r\n  startChar: string,\r\n  usedNames: string[],\r\n): string {\r\n  if (!usedNames.length) {\r\n    return startChar;\r\n  }\r\n\r\n  const letters = VAR_LETTER_OPTIONS;\r\n  let suffix = '';\r\n  let letterIndex = letters.indexOf(startChar);\r\n  let potName = startChar;\r\n\r\n  // eslint-disable-next-line no-constant-condition\r\n  while (true) {\r\n    let inUse = false;\r\n    for (let i = 0; i < usedNames.length; i++) {\r\n      if (usedNames[i].toLowerCase() === potName) {\r\n        inUse = true;\r\n        break;\r\n      }\r\n    }\r\n    if (!inUse) {\r\n      break;\r\n    }\r\n\r\n    letterIndex++;\r\n    if (letterIndex === letters.length) {\r\n      // Reached the end of the character sequence so back to 'i'.\r\n      letterIndex = 0;\r\n      suffix = `${Number(suffix) + 1}`;\r\n    }\r\n    potName = letters.charAt(letterIndex) + suffix;\r\n  }\r\n  return potName;\r\n}\r\n\r\n/**\r\n * Handles \"Create Variable\" button in the default variables toolbox category.\r\n * It will prompt the user for a variable name, including re-prompts if a name\r\n * is already in use among the workspace's variables.\r\n *\r\n * Custom button handlers can delegate to this function, allowing variables\r\n * types and after-creation processing. More complex customization (e.g.,\r\n * prompting for variable type) is beyond the scope of this function.\r\n *\r\n * @param workspace The workspace on which to create the variable.\r\n * @param opt_callback A callback. It will be passed an acceptable new variable\r\n *     name, or null if change is to be aborted (cancel button), or undefined if\r\n *     an existing variable was chosen.\r\n * @param opt_type The type of the variable like 'int', 'string', or ''. This\r\n *     will default to '', which is a specific type.\r\n */\r\nexport function createVariableButtonHandler(\r\n  workspace: Workspace,\r\n  opt_callback?: (p1?: string | null) => void,\r\n  opt_type?: string,\r\n) {\r\n  const type = opt_type || '';\r\n  // This function needs to be named so it can be called recursively.\r\n  function promptAndCheckWithAlert(defaultName: string) {\r\n    promptName(Msg['NEW_VARIABLE_TITLE'], defaultName, function (text) {\r\n      if (!text) {\r\n        // User canceled prompt.\r\n        if (opt_callback) opt_callback(null);\r\n        return;\r\n      }\r\n\r\n      const existing = nameUsedWithAnyType(text, workspace);\r\n      if (!existing) {\r\n        // No conflict\r\n        workspace.createVariable(text, type);\r\n        if (opt_callback) opt_callback(text);\r\n        return;\r\n      }\r\n\r\n      let msg;\r\n      if (existing.type === type) {\r\n        msg = Msg['VARIABLE_ALREADY_EXISTS'].replace('%1', existing.name);\r\n      } else {\r\n        msg = Msg['VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE'];\r\n        msg = msg.replace('%1', existing.name).replace('%2', existing.type);\r\n      }\r\n      dialog.alert(msg, function () {\r\n        promptAndCheckWithAlert(text);\r\n      });\r\n    });\r\n  }\r\n  promptAndCheckWithAlert('');\r\n}\r\n\r\n/**\r\n * Opens a prompt that allows the user to enter a new name for a variable.\r\n * Triggers a rename if the new name is valid. Or re-prompts if there is a\r\n * collision.\r\n *\r\n * @param workspace The workspace on which to rename the variable.\r\n * @param variable Variable to rename.\r\n * @param opt_callback A callback. It will be passed an acceptable new variable\r\n *     name, or null if change is to be aborted (cancel button), or undefined if\r\n *     an existing variable was chosen.\r\n */\r\nexport function renameVariable(\r\n  workspace: Workspace,\r\n  variable: VariableModel,\r\n  opt_callback?: (p1?: string | null) => void,\r\n) {\r\n  // This function needs to be named so it can be called recursively.\r\n  function promptAndCheckWithAlert(defaultName: string) {\r\n    const promptText = Msg['RENAME_VARIABLE_TITLE'].replace(\r\n      '%1',\r\n      variable.name,\r\n    );\r\n    promptName(promptText, defaultName, function (newName) {\r\n      if (!newName) {\r\n        // User canceled prompt.\r\n        if (opt_callback) opt_callback(null);\r\n        return;\r\n      }\r\n\r\n      const existing = nameUsedWithOtherType(newName, variable.type, workspace);\r\n      const procedure = nameUsedWithConflictingParam(\r\n        variable.name,\r\n        newName,\r\n        workspace,\r\n      );\r\n      if (!existing && !procedure) {\r\n        // No conflict.\r\n        workspace.renameVariableById(variable.getId(), newName);\r\n        if (opt_callback) opt_callback(newName);\r\n        return;\r\n      }\r\n\r\n      let msg = '';\r\n      if (existing) {\r\n        msg = Msg['VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE']\r\n          .replace('%1', existing.name)\r\n          .replace('%2', existing.type);\r\n      } else if (procedure) {\r\n        msg = Msg['VARIABLE_ALREADY_EXISTS_FOR_A_PARAMETER']\r\n          .replace('%1', newName)\r\n          .replace('%2', procedure);\r\n      }\r\n      dialog.alert(msg, function () {\r\n        promptAndCheckWithAlert(newName);\r\n      });\r\n    });\r\n  }\r\n  promptAndCheckWithAlert('');\r\n}\r\n\r\n/**\r\n * Prompt the user for a new variable name.\r\n *\r\n * @param promptText The string of the prompt.\r\n * @param defaultText The default value to show in the prompt's field.\r\n * @param callback A callback. It will be passed the new variable name, or null\r\n *     if the user picked something illegal.\r\n */\r\nexport function promptName(\r\n  promptText: string,\r\n  defaultText: string,\r\n  callback: (p1: string | null) => void,\r\n) {\r\n  dialog.prompt(promptText, defaultText, function (newVar) {\r\n    // Merge runs of whitespace.  Strip leading and trailing whitespace.\r\n    // Beyond this, all names are legal.\r\n    if (newVar) {\r\n      newVar = newVar.replace(/[\\s\\xa0]+/g, ' ').trim();\r\n      if (newVar === Msg['RENAME_VARIABLE'] || newVar === Msg['NEW_VARIABLE']) {\r\n        // Ok, not ALL names are legal...\r\n        newVar = null;\r\n      }\r\n    }\r\n    callback(newVar);\r\n  });\r\n}\r\n/**\r\n * Check whether there exists a variable with the given name but a different\r\n * type.\r\n *\r\n * @param name The name to search for.\r\n * @param type The type to exclude from the search.\r\n * @param workspace The workspace to search for the variable.\r\n * @returns The variable with the given name and a different type, or null if\r\n *     none was found.\r\n */\r\nfunction nameUsedWithOtherType(\r\n  name: string,\r\n  type: string,\r\n  workspace: Workspace,\r\n): VariableModel | null {\r\n  const allVariables = workspace.getVariableMap().getAllVariables();\r\n\r\n  name = name.toLowerCase();\r\n  for (let i = 0, variable; (variable = allVariables[i]); i++) {\r\n    if (variable.name.toLowerCase() === name && variable.type !== type) {\r\n      return variable;\r\n    }\r\n  }\r\n  return null;\r\n}\r\n\r\n/**\r\n * Check whether there exists a variable with the given name of any type.\r\n *\r\n * @param name The name to search for.\r\n * @param workspace The workspace to search for the variable.\r\n * @returns The variable with the given name, or null if none was found.\r\n */\r\nexport function nameUsedWithAnyType(\r\n  name: string,\r\n  workspace: Workspace,\r\n): VariableModel | null {\r\n  const allVariables = workspace.getVariableMap().getAllVariables();\r\n\r\n  name = name.toLowerCase();\r\n  for (let i = 0, variable; (variable = allVariables[i]); i++) {\r\n    if (variable.name.toLowerCase() === name) {\r\n      return variable;\r\n    }\r\n  }\r\n  return null;\r\n}\r\n\r\n/**\r\n * Returns the name of the procedure with a conflicting parameter name, or null\r\n * if one does not exist.\r\n *\r\n * This checks the procedure map if it contains models, and the legacy procedure\r\n * blocks otherwise.\r\n *\r\n * @param oldName The old name of the variable.\r\n * @param newName The proposed name of the variable.\r\n * @param workspace The workspace to search for conflicting parameters.\r\n * @internal\r\n */\r\nexport function nameUsedWithConflictingParam(\r\n  oldName: string,\r\n  newName: string,\r\n  workspace: Workspace,\r\n): string | null {\r\n  return workspace.getProcedureMap().getProcedures().length\r\n    ? checkForConflictingParamWithProcedureModels(oldName, newName, workspace)\r\n    : checkForConflictingParamWithLegacyProcedures(oldName, newName, workspace);\r\n}\r\n\r\n/**\r\n * Returns the name of the procedure model with a conflicting param name, or\r\n * null if one does not exist.\r\n */\r\nfunction checkForConflictingParamWithProcedureModels(\r\n  oldName: string,\r\n  newName: string,\r\n  workspace: Workspace,\r\n): string | null {\r\n  oldName = oldName.toLowerCase();\r\n  newName = newName.toLowerCase();\r\n\r\n  const procedures = workspace.getProcedureMap().getProcedures();\r\n  for (const procedure of procedures) {\r\n    const params = procedure\r\n      .getParameters()\r\n      .filter(isVariableBackedParameterModel)\r\n      .map((param) => param.getVariableModel().name);\r\n    if (!params) continue;\r\n    const procHasOld = params.some((param) => param.toLowerCase() === oldName);\r\n    const procHasNew = params.some((param) => param.toLowerCase() === newName);\r\n    if (procHasOld && procHasNew) return procedure.getName();\r\n  }\r\n  return null;\r\n}\r\n\r\n/**\r\n * Returns the name of the procedure block with a conflicting param name, or\r\n * null if one does not exist.\r\n */\r\nfunction checkForConflictingParamWithLegacyProcedures(\r\n  oldName: string,\r\n  newName: string,\r\n  workspace: Workspace,\r\n): string | null {\r\n  oldName = oldName.toLowerCase();\r\n  newName = newName.toLowerCase();\r\n\r\n  const blocks = workspace.getAllBlocks(false);\r\n  for (const block of blocks) {\r\n    if (!isLegacyProcedureDefBlock(block)) continue;\r\n    const def = block.getProcedureDef();\r\n    const params = def[1];\r\n    const blockHasOld = params.some((param) => param.toLowerCase() === oldName);\r\n    const blockHasNew = params.some((param) => param.toLowerCase() === newName);\r\n    if (blockHasOld && blockHasNew) return def[0];\r\n  }\r\n  return null;\r\n}\r\n\r\n/**\r\n * Generate DOM objects representing a variable field.\r\n *\r\n * @param variableModel The variable model to represent.\r\n * @returns The generated DOM.\r\n */\r\nexport function generateVariableFieldDom(\r\n  variableModel: VariableModel,\r\n): Element {\r\n  /* Generates the following XML:\r\n   * <field name=\"VAR\" id=\"goKTKmYJ8DhVHpruv\" variabletype=\"int\">foo</field>\r\n   */\r\n  const field = utilsXml.createElement('field');\r\n  field.setAttribute('name', 'VAR');\r\n  field.setAttribute('id', variableModel.getId());\r\n  field.setAttribute('variabletype', variableModel.type);\r\n  const name = utilsXml.createTextNode(variableModel.name);\r\n  field.appendChild(name);\r\n  return field;\r\n}\r\n\r\n/**\r\n * Helper function to look up or create a variable on the given workspace.\r\n * If no variable exists, creates and returns it.\r\n *\r\n * @param workspace The workspace to search for the variable.  It may be a\r\n *     flyout workspace or main workspace.\r\n * @param id The ID to use to look up or create the variable, or null.\r\n * @param opt_name The string to use to look up or create the variable.\r\n * @param opt_type The type to use to look up or create the variable.\r\n * @returns The variable corresponding to the given ID or name + type\r\n *     combination.\r\n */\r\nexport function getOrCreateVariablePackage(\r\n  workspace: Workspace,\r\n  id: string | null,\r\n  opt_name?: string,\r\n  opt_type?: string,\r\n): VariableModel {\r\n  let variable = getVariable(workspace, id, opt_name, opt_type);\r\n  if (!variable) {\r\n    variable = createVariable(workspace, id, opt_name, opt_type);\r\n  }\r\n  return variable;\r\n}\r\n\r\n/**\r\n * Look up  a variable on the given workspace.\r\n * Always looks in the main workspace before looking in the flyout workspace.\r\n * Always prefers lookup by ID to lookup by name + type.\r\n *\r\n * @param workspace The workspace to search for the variable.  It may be a\r\n *     flyout workspace or main workspace.\r\n * @param id The ID to use to look up the variable, or null.\r\n * @param opt_name The string to use to look up the variable.\r\n *     Only used if lookup by ID fails.\r\n * @param opt_type The type to use to look up the variable.\r\n *     Only used if lookup by ID fails.\r\n * @returns The variable corresponding to the given ID or name + type\r\n *     combination, or null if not found.\r\n */\r\nexport function getVariable(\r\n  workspace: Workspace,\r\n  id: string | null,\r\n  opt_name?: string,\r\n  opt_type?: string,\r\n): VariableModel | null {\r\n  const potentialVariableMap = workspace.getPotentialVariableMap();\r\n  let variable = null;\r\n  // Try to just get the variable, by ID if possible.\r\n  if (id) {\r\n    // Look in the real variable map before checking the potential variable map.\r\n    variable = workspace.getVariableById(id);\r\n    if (!variable && potentialVariableMap) {\r\n      variable = potentialVariableMap.getVariableById(id);\r\n    }\r\n    if (variable) {\r\n      return variable;\r\n    }\r\n  }\r\n  // If there was no ID, or there was an ID but it didn't match any variables,\r\n  // look up by name and type.\r\n  if (opt_name) {\r\n    if (opt_type === undefined) {\r\n      throw Error('Tried to look up a variable by name without a type');\r\n    }\r\n    // Otherwise look up by name and type.\r\n    variable = workspace.getVariable(opt_name, opt_type);\r\n    if (!variable && potentialVariableMap) {\r\n      variable = potentialVariableMap.getVariable(opt_name, opt_type);\r\n    }\r\n  }\r\n  return variable;\r\n}\r\n\r\n/**\r\n * Helper function to create a variable on the given workspace.\r\n *\r\n * @param workspace The workspace in which to create the variable.  It may be a\r\n *     flyout workspace or main workspace.\r\n * @param id The ID to use to create the variable, or null.\r\n * @param opt_name The string to use to create the variable.\r\n * @param opt_type The type to use to create the variable.\r\n * @returns The variable corresponding to the given ID or name + type\r\n *     combination.\r\n */\r\nfunction createVariable(\r\n  workspace: Workspace,\r\n  id: string | null,\r\n  opt_name?: string,\r\n  opt_type?: string,\r\n): VariableModel {\r\n  const potentialVariableMap = workspace.getPotentialVariableMap();\r\n  // Variables without names get uniquely named for this workspace.\r\n  if (!opt_name) {\r\n    const ws = workspace.isFlyout\r\n      ? (workspace as WorkspaceSvg).targetWorkspace\r\n      : workspace;\r\n    opt_name = generateUniqueName(ws!);\r\n  }\r\n\r\n  // Create a potential variable if in the flyout.\r\n  let variable = null;\r\n  if (potentialVariableMap) {\r\n    variable = potentialVariableMap.createVariable(opt_name, opt_type, id);\r\n  } else {\r\n    // In the main workspace, create a real variable.\r\n    variable = workspace.createVariable(opt_name, opt_type, id);\r\n  }\r\n  return variable;\r\n}\r\n\r\n/**\r\n * Helper function to get the list of variables that have been added to the\r\n * workspace after adding a new block, using the given list of variables that\r\n * were in the workspace before the new block was added.\r\n *\r\n * @param workspace The workspace to inspect.\r\n * @param originalVariables The array of variables that existed in the workspace\r\n *     before adding the new block.\r\n * @returns The new array of variables that were freshly added to the workspace\r\n *     after creating the new block, or [] if no new variables were added to the\r\n *     workspace.\r\n * @internal\r\n */\r\nexport function getAddedVariables(\r\n  workspace: Workspace,\r\n  originalVariables: VariableModel[],\r\n): VariableModel[] {\r\n  const allCurrentVariables = workspace.getAllVariables();\r\n  const addedVariables = [];\r\n  if (originalVariables.length !== allCurrentVariables.length) {\r\n    for (let i = 0; i < allCurrentVariables.length; i++) {\r\n      const variable = allCurrentVariables[i];\r\n      // For any variable that is present in allCurrentVariables but not\r\n      // present in originalVariables, add the variable to addedVariables.\r\n      if (originalVariables.indexOf(variable) === -1) {\r\n        addedVariables.push(variable);\r\n      }\r\n    }\r\n  }\r\n  return addedVariables;\r\n}\r\n\r\nexport const TEST_ONLY = {\r\n  generateUniqueNameInternal,\r\n};\r\n","/**\r\n * @license\r\n * Copyright 2023 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport {ICopyable, ICopyData} from '../interfaces/i_copyable.js';\r\nimport type {IPaster} from '../interfaces/i_paster.js';\r\nimport * as registry from '../registry.js';\r\n\r\n/**\r\n * Registers the given paster so that it cna be used for pasting.\r\n *\r\n * @param type The type of the paster to register, e.g. 'block', 'comment', etc.\r\n * @param paster The paster to register.\r\n */\r\nexport function register<U extends ICopyData, T extends ICopyable<U>>(\r\n  type: string,\r\n  paster: IPaster<U, T>,\r\n) {\r\n  registry.register(registry.Type.PASTER, type, paster);\r\n}\r\n\r\n/**\r\n * Unregisters the paster associated with the given type.\r\n *\r\n * @param type The type of the paster to unregister.\r\n */\r\nexport function unregister(type: string) {\r\n  registry.unregister(registry.Type.PASTER, type);\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2023 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport {BlockSvg} from './block_svg.js';\r\nimport * as userAgent from './utils/useragent.js';\r\nimport type {WorkspaceSvg} from './workspace_svg.js';\r\n\r\n/** The set of all blocks in need of rendering which don't have parents. */\r\nconst rootBlocks = new Set<BlockSvg>();\r\n\r\n/** The set of all blocks in need of rendering. */\r\nconst dirtyBlocks = new WeakSet<BlockSvg>();\r\n\r\n/**\r\n * The promise which resolves after the current set of renders is completed. Or\r\n * null if there are no queued renders.\r\n *\r\n * Stored so that we can return it from afterQueuedRenders.\r\n */\r\nlet afterRendersPromise: Promise<void> | null = null;\r\n\r\n/** The function to call to resolve the `afterRendersPromise`. */\r\nlet afterRendersResolver: (() => void) | null = null;\r\n\r\n/**\r\n * The ID of the current animation frame request. Used to cancel the request\r\n * if necessary.\r\n */\r\nlet animationRequestId = 0;\r\n\r\n/**\r\n * Registers that the given block and all of its parents need to be rerendered,\r\n * and registers a callback to do so after a delay, to allowf or batching.\r\n *\r\n * @param block The block to rerender.\r\n * @returns A promise that resolves after the currently queued renders have been\r\n *     completed. Used for triggering other behavior that relies on updated\r\n *     size/position location for the block.\r\n * @internal\r\n */\r\nexport function queueRender(block: BlockSvg): Promise<void> {\r\n  queueBlock(block);\r\n\r\n  if (alwaysImmediatelyRender()) {\r\n    doRenders();\r\n    return Promise.resolve();\r\n  }\r\n\r\n  if (!afterRendersPromise) {\r\n    afterRendersPromise = new Promise((resolve) => {\r\n      afterRendersResolver = resolve;\r\n      animationRequestId = window.requestAnimationFrame(() => {\r\n        doRenders();\r\n        resolve();\r\n      });\r\n    });\r\n  }\r\n  return afterRendersPromise;\r\n}\r\n\r\n/**\r\n * @returns A promise that resolves after the currently queued renders have\r\n *     been completed.\r\n */\r\nexport function finishQueuedRenders(): Promise<void> {\r\n  // If there are no queued renders, return a resolved promise so `then`\r\n  // callbacks trigger immediately.\r\n  return afterRendersPromise ? afterRendersPromise : Promise.resolve();\r\n}\r\n\r\n/**\r\n * Triggers an immediate render of all queued renders. Should only be used in\r\n * cases where queueing renders breaks functionality + backwards compatibility\r\n * (such as rendering icons).\r\n *\r\n * @param workspace If provided, only rerender blocks in this workspace.\r\n *\r\n * @internal\r\n */\r\nexport function triggerQueuedRenders(workspace?: WorkspaceSvg) {\r\n  if (!workspace) window.cancelAnimationFrame(animationRequestId);\r\n  doRenders(workspace);\r\n  if (!workspace && afterRendersResolver) afterRendersResolver();\r\n}\r\n\r\n/**\r\n * @returns True if we should always trigger an immediate render.\r\n *     Some platforms don't properly support `requestAnimationFrame`, so to\r\n *     avoid glitchiness, we give up the performance improvements.\r\n */\r\nfunction alwaysImmediatelyRender() {\r\n  return userAgent.JavaFx;\r\n}\r\n\r\n/**\r\n * Adds the given block and its parents to the render queue. Adds the root block\r\n * to the list of root blocks.\r\n *\r\n * @param block The block to queue.\r\n */\r\nfunction queueBlock(block: BlockSvg) {\r\n  dirtyBlocks.add(block);\r\n  const parent = block.getParent();\r\n  if (parent) {\r\n    queueBlock(parent);\r\n  } else {\r\n    rootBlocks.add(block);\r\n  }\r\n}\r\n\r\n/**\r\n * Rerenders all of the blocks in the queue.\r\n *\r\n * @param workspace If provided, only rerender blocks in this workspace.\r\n */\r\nfunction doRenders(workspace?: WorkspaceSvg) {\r\n  const workspaces = workspace\r\n    ? new Set([workspace])\r\n    : new Set([...rootBlocks].map((block) => block.workspace));\r\n  const blocks = [...rootBlocks]\r\n    .filter(shouldRenderRootBlock)\r\n    .filter((b) => workspaces.has(b.workspace));\r\n  for (const block of blocks) {\r\n    renderBlock(block);\r\n  }\r\n  for (const workspace of workspaces) {\r\n    workspace.resizeContents();\r\n  }\r\n  for (const block of blocks) {\r\n    const blockOrigin = block.getRelativeToSurfaceXY();\r\n    block.updateComponentLocations(blockOrigin);\r\n  }\r\n\r\n  for (const block of blocks) {\r\n    dequeueBlock(block);\r\n  }\r\n  if (!workspace) afterRendersPromise = null;\r\n}\r\n\r\n/** Removes the given block and children from the render queue. */\r\nfunction dequeueBlock(block: BlockSvg) {\r\n  rootBlocks.delete(block);\r\n  dirtyBlocks.delete(block);\r\n  for (const child of block.getChildren(false)) {\r\n    dequeueBlock(child);\r\n  }\r\n}\r\n\r\n/**\r\n * Returns true if the block should be rendered.\r\n *\r\n * No need to render dead blocks.\r\n *\r\n * No need to render blocks with parents. A render for the block may have been\r\n * queued, and the the block was connected to a parent, so it is no longer a\r\n * root block. Rendering will be triggered through the real root block.\r\n */\r\nfunction shouldRenderRootBlock(block: BlockSvg): boolean {\r\n  return !block.isDisposed() && !block.getParent();\r\n}\r\n\r\n/**\r\n * Recursively renders all of the dirty children of the given block, and\r\n * then renders the block.\r\n *\r\n * @param block The block to rerender.\r\n */\r\nfunction renderBlock(block: BlockSvg) {\r\n  if (!dirtyBlocks.has(block)) return;\r\n  for (const child of block.getChildren(false)) {\r\n    renderBlock(child);\r\n  }\r\n  block.renderEfficiently();\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2012 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.Xml\r\n\r\nimport type {Block} from './block.js';\r\nimport type {BlockSvg} from './block_svg.js';\r\nimport type {Connection} from './connection.js';\r\nimport * as eventUtils from './events/utils.js';\r\nimport type {Field} from './field.js';\r\nimport {IconType} from './icons/icon_types.js';\r\nimport {inputTypes} from './inputs/input_types.js';\r\nimport * as dom from './utils/dom.js';\r\nimport {Size} from './utils/size.js';\r\nimport * as utilsXml from './utils/xml.js';\r\nimport type {VariableModel} from './variable_model.js';\r\nimport * as Variables from './variables.js';\r\nimport type {Workspace} from './workspace.js';\r\nimport {WorkspaceComment} from './workspace_comment.js';\r\nimport {WorkspaceCommentSvg} from './workspace_comment_svg.js';\r\nimport type {WorkspaceSvg} from './workspace_svg.js';\r\nimport * as renderManagement from './render_management.js';\r\n\r\n/**\r\n * Encode a block tree as XML.\r\n *\r\n * @param workspace The workspace containing blocks.\r\n * @param opt_noId True if the encoder should skip the block IDs.\r\n * @returns XML DOM element.\r\n */\r\nexport function workspaceToDom(\r\n  workspace: Workspace,\r\n  opt_noId?: boolean,\r\n): Element {\r\n  const treeXml = utilsXml.createElement('xml');\r\n  const variablesElement = variablesToDom(\r\n    Variables.allUsedVarModels(workspace),\r\n  );\r\n  if (variablesElement.hasChildNodes()) {\r\n    treeXml.appendChild(variablesElement);\r\n  }\r\n  const comments = workspace.getTopComments(true);\r\n  for (let i = 0; i < comments.length; i++) {\r\n    const comment = comments[i];\r\n    treeXml.appendChild(comment.toXmlWithXY(opt_noId));\r\n  }\r\n  const blocks = workspace.getTopBlocks(true);\r\n  for (let i = 0; i < blocks.length; i++) {\r\n    const block = blocks[i];\r\n    treeXml.appendChild(blockToDomWithXY(block, opt_noId));\r\n  }\r\n  return treeXml;\r\n}\r\n\r\n/**\r\n * Encode a list of variables as XML.\r\n *\r\n * @param variableList List of all variable models.\r\n * @returns Tree of XML elements.\r\n */\r\nexport function variablesToDom(variableList: VariableModel[]): Element {\r\n  const variables = utilsXml.createElement('variables');\r\n  for (let i = 0; i < variableList.length; i++) {\r\n    const variable = variableList[i];\r\n    const element = utilsXml.createElement('variable');\r\n    element.appendChild(utilsXml.createTextNode(variable.name));\r\n    if (variable.type) {\r\n      element.setAttribute('type', variable.type);\r\n    }\r\n    element.id = variable.getId();\r\n    variables.appendChild(element);\r\n  }\r\n  return variables;\r\n}\r\n\r\n/**\r\n * Encode a block subtree as XML with XY coordinates.\r\n *\r\n * @param block The root block to encode.\r\n * @param opt_noId True if the encoder should skip the block ID.\r\n * @returns Tree of XML elements or an empty document fragment if the block was\r\n *     an insertion marker.\r\n */\r\nexport function blockToDomWithXY(\r\n  block: Block,\r\n  opt_noId?: boolean,\r\n): Element | DocumentFragment {\r\n  if (block.isInsertionMarker()) {\r\n    // Skip over insertion markers.\r\n    block = block.getChildren(false)[0];\r\n    if (!block) {\r\n      // Disappears when appended.\r\n      return new DocumentFragment();\r\n    }\r\n  }\r\n\r\n  let width = 0; // Not used in LTR.\r\n  if (block.workspace.RTL) {\r\n    width = block.workspace.getWidth();\r\n  }\r\n\r\n  const element = blockToDom(block, opt_noId);\r\n  if (isElement(element)) {\r\n    const xy = block.getRelativeToSurfaceXY();\r\n    element.setAttribute(\r\n      'x',\r\n      String(Math.round(block.workspace.RTL ? width - xy.x : xy.x)),\r\n    );\r\n    element.setAttribute('y', String(Math.round(xy.y)));\r\n  }\r\n  return element;\r\n}\r\n\r\n/**\r\n * Encode a field as XML.\r\n *\r\n * @param field The field to encode.\r\n * @returns XML element, or null if the field did not need to be serialized.\r\n */\r\nfunction fieldToDom(field: Field): Element | null {\r\n  if (field.isSerializable()) {\r\n    const container = utilsXml.createElement('field');\r\n    container.setAttribute('name', field.name || '');\r\n    return field.toXml(container);\r\n  }\r\n  return null;\r\n}\r\n\r\n/**\r\n * Encode all of a block's fields as XML and attach them to the given tree of\r\n * XML elements.\r\n *\r\n * @param block A block with fields to be encoded.\r\n * @param element The XML element to which the field DOM should be attached.\r\n */\r\nfunction allFieldsToDom(block: Block, element: Element) {\r\n  for (let i = 0; i < block.inputList.length; i++) {\r\n    const input = block.inputList[i];\r\n    for (let j = 0; j < input.fieldRow.length; j++) {\r\n      const field = input.fieldRow[j];\r\n      const fieldDom = fieldToDom(field);\r\n      if (fieldDom) {\r\n        element.appendChild(fieldDom);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Encode a block subtree as XML.\r\n *\r\n * @param block The root block to encode.\r\n * @param opt_noId True if the encoder should skip the block ID.\r\n * @returns Tree of XML elements or an empty document fragment if the block was\r\n *     an insertion marker.\r\n */\r\nexport function blockToDom(\r\n  block: Block,\r\n  opt_noId?: boolean,\r\n): Element | DocumentFragment {\r\n  // Skip over insertion markers.\r\n  if (block.isInsertionMarker()) {\r\n    const child = block.getChildren(false)[0];\r\n    if (child) {\r\n      return blockToDom(child);\r\n    } else {\r\n      // Disappears when appended.\r\n      return new DocumentFragment();\r\n    }\r\n  }\r\n\r\n  const element = utilsXml.createElement(block.isShadow() ? 'shadow' : 'block');\r\n  element.setAttribute('type', block.type);\r\n  if (!opt_noId) {\r\n    element.id = block.id;\r\n  }\r\n  if (block.mutationToDom) {\r\n    // Custom data for an advanced block.\r\n    const mutation = block.mutationToDom();\r\n    if (mutation && (mutation.hasChildNodes() || mutation.hasAttributes())) {\r\n      element.appendChild(mutation);\r\n    }\r\n  }\r\n\r\n  allFieldsToDom(block, element);\r\n\r\n  const commentText = block.getCommentText();\r\n  if (commentText) {\r\n    const comment = block.getIcon(IconType.COMMENT)!;\r\n    const size = comment.getBubbleSize();\r\n    const pinned = comment.bubbleIsVisible();\r\n\r\n    const commentElement = utilsXml.createElement('comment');\r\n    commentElement.appendChild(utilsXml.createTextNode(commentText));\r\n    commentElement.setAttribute('pinned', `${pinned}`);\r\n    commentElement.setAttribute('h', String(size.height));\r\n    commentElement.setAttribute('w', String(size.width));\r\n\r\n    element.appendChild(commentElement);\r\n  }\r\n\r\n  if (block.data) {\r\n    const dataElement = utilsXml.createElement('data');\r\n    dataElement.appendChild(utilsXml.createTextNode(block.data));\r\n    element.appendChild(dataElement);\r\n  }\r\n\r\n  for (let i = 0; i < block.inputList.length; i++) {\r\n    const input = block.inputList[i];\r\n    let container: Element;\r\n    let empty = true;\r\n    if (input.type === inputTypes.DUMMY || input.type === inputTypes.END_ROW) {\r\n      continue;\r\n    } else {\r\n      const childBlock = input.connection!.targetBlock();\r\n      if (input.type === inputTypes.VALUE) {\r\n        container = utilsXml.createElement('value');\r\n      } else if (input.type === inputTypes.STATEMENT) {\r\n        container = utilsXml.createElement('statement');\r\n      }\r\n      const childShadow = input.connection!.getShadowDom();\r\n      if (childShadow && (!childBlock || !childBlock.isShadow())) {\r\n        container!.appendChild(cloneShadow(childShadow, opt_noId));\r\n      }\r\n      if (childBlock) {\r\n        const childElem = blockToDom(childBlock, opt_noId);\r\n        if (childElem.nodeType === dom.NodeType.ELEMENT_NODE) {\r\n          container!.appendChild(childElem);\r\n          empty = false;\r\n        }\r\n      }\r\n    }\r\n    container!.setAttribute('name', input.name);\r\n    if (!empty) {\r\n      element.appendChild(container!);\r\n    }\r\n  }\r\n  if (\r\n    block.inputsInline !== undefined &&\r\n    block.inputsInline !== block.inputsInlineDefault\r\n  ) {\r\n    element.setAttribute('inline', String(block.inputsInline));\r\n  }\r\n  if (block.isCollapsed()) {\r\n    element.setAttribute('collapsed', 'true');\r\n  }\r\n  if (!block.isEnabled()) {\r\n    element.setAttribute('disabled', 'true');\r\n  }\r\n  if (!block.isDeletable() && !block.isShadow()) {\r\n    element.setAttribute('deletable', 'false');\r\n  }\r\n  if (!block.isMovable() && !block.isShadow()) {\r\n    element.setAttribute('movable', 'false');\r\n  }\r\n  if (!block.isEditable()) {\r\n    element.setAttribute('editable', 'false');\r\n  }\r\n\r\n  const nextBlock = block.getNextBlock();\r\n  let container: Element;\r\n  if (nextBlock) {\r\n    const nextElem = blockToDom(nextBlock, opt_noId);\r\n    if (nextElem.nodeType === dom.NodeType.ELEMENT_NODE) {\r\n      container = utilsXml.createElement('next');\r\n      container.appendChild(nextElem);\r\n      element.appendChild(container);\r\n    }\r\n  }\r\n  const nextShadow =\r\n    block.nextConnection && block.nextConnection.getShadowDom();\r\n  if (nextShadow && (!nextBlock || !nextBlock.isShadow())) {\r\n    container!.appendChild(cloneShadow(nextShadow, opt_noId));\r\n  }\r\n\r\n  return element;\r\n}\r\n\r\n/**\r\n * Deeply clone the shadow's DOM so that changes don't back-wash to the block.\r\n *\r\n * @param shadow A tree of XML elements.\r\n * @param opt_noId True if the encoder should skip the block ID.\r\n * @returns A tree of XML elements.\r\n */\r\nfunction cloneShadow(shadow: Element, opt_noId?: boolean): Element {\r\n  shadow = shadow.cloneNode(true) as Element;\r\n  // Walk the tree looking for whitespace.  Don't prune whitespace in a tag.\r\n  let node: Node | null = shadow;\r\n  let textNode;\r\n  while (node) {\r\n    if (opt_noId && node.nodeName === 'shadow') {\r\n      // Strip off IDs from shadow blocks.  There should never be a 'block' as\r\n      // a child of a 'shadow', so no need to check that.\r\n      (node as Element).removeAttribute('id');\r\n    }\r\n    if (node.firstChild) {\r\n      node = node.firstChild;\r\n    } else {\r\n      while (node && !node.nextSibling) {\r\n        textNode = node;\r\n        node = node.parentNode;\r\n        if (\r\n          textNode.nodeType === dom.NodeType.TEXT_NODE &&\r\n          (textNode as Text).data.trim() === '' &&\r\n          node?.firstChild !== textNode\r\n        ) {\r\n          // Prune whitespace after a tag.\r\n          dom.removeNode(textNode);\r\n        }\r\n      }\r\n      if (node) {\r\n        textNode = node;\r\n        node = node.nextSibling;\r\n        if (\r\n          textNode.nodeType === dom.NodeType.TEXT_NODE &&\r\n          (textNode as Text).data.trim() === ''\r\n        ) {\r\n          // Prune whitespace before a tag.\r\n          dom.removeNode(textNode);\r\n        }\r\n      }\r\n    }\r\n  }\r\n  return shadow;\r\n}\r\n\r\n/**\r\n * Converts a DOM structure into plain text.\r\n * Currently the text format is fairly ugly: all one line with no whitespace,\r\n * unless the DOM itself has whitespace built-in.\r\n *\r\n * @param dom A tree of XML nodes.\r\n * @returns Text representation.\r\n */\r\nexport function domToText(dom: Node): string {\r\n  const text = utilsXml.domToText(dom);\r\n  // Unpack self-closing tags.  These tags fail when embedded in HTML.\r\n  // <block name=\"foo\"/> -> <block name=\"foo\"></block>\r\n  return text.replace(/<(\\w+)([^<]*)\\/>/g, '<$1$2></$1>');\r\n}\r\n\r\n/**\r\n * Converts a DOM structure into properly indented text.\r\n *\r\n * @param dom A tree of XML elements.\r\n * @returns Text representation.\r\n */\r\nexport function domToPrettyText(dom: Node): string {\r\n  // This function is not guaranteed to be correct for all XML.\r\n  // But it handles the XML that Blockly generates.\r\n  const blob = domToText(dom);\r\n  // Place every open and close tag on its own line.\r\n  const lines = blob.split('<');\r\n  // Indent every line.\r\n  let indent = '';\r\n  for (let i = 1; i < lines.length; i++) {\r\n    const line = lines[i];\r\n    if (line[0] === '/') {\r\n      indent = indent.substring(2);\r\n    }\r\n    lines[i] = indent + '<' + line;\r\n    if (line[0] !== '/' && line.slice(-2) !== '/>') {\r\n      indent += '  ';\r\n    }\r\n  }\r\n  // Pull simple tags back together.\r\n  // E.g. <foo></foo>\r\n  let text = lines.join('\\n');\r\n  text = text.replace(/(<(\\w+)\\b[^>]*>[^\\n]*)\\n *<\\/\\2>/g, '$1</$2>');\r\n  // Trim leading blank line.\r\n  return text.replace(/^\\n/, '');\r\n}\r\n\r\n/**\r\n * Clear the given workspace then decode an XML DOM and\r\n * create blocks on the workspace.\r\n *\r\n * @param xml XML DOM.\r\n * @param workspace The workspace.\r\n * @returns An array containing new block IDs.\r\n */\r\nexport function clearWorkspaceAndLoadFromXml(\r\n  xml: Element,\r\n  workspace: WorkspaceSvg,\r\n): string[] {\r\n  workspace.setResizesEnabled(false);\r\n  workspace.clear();\r\n  const blockIds = domToWorkspace(xml, workspace);\r\n  workspace.setResizesEnabled(true);\r\n  return blockIds;\r\n}\r\n\r\n/**\r\n * Decode an XML DOM and create blocks on the workspace.\r\n *\r\n * @param xml XML DOM.\r\n * @param workspace The workspace.\r\n * @returns An array containing new block IDs.\r\n */\r\nexport function domToWorkspace(xml: Element, workspace: Workspace): string[] {\r\n  let width = 0; // Not used in LTR.\r\n  if (workspace.RTL) {\r\n    width = workspace.getWidth();\r\n  }\r\n  const newBlockIds = []; // A list of block IDs added by this call.\r\n  dom.startTextWidthCache();\r\n  const existingGroup = eventUtils.getGroup();\r\n  if (!existingGroup) {\r\n    eventUtils.setGroup(true);\r\n  }\r\n\r\n  // Disable workspace resizes as an optimization.\r\n  // Assume it is rendered so we can check.\r\n  if ((workspace as WorkspaceSvg).setResizesEnabled) {\r\n    (workspace as WorkspaceSvg).setResizesEnabled(false);\r\n  }\r\n  let variablesFirst = true;\r\n  try {\r\n    for (let i = 0, xmlChild; (xmlChild = xml.childNodes[i]); i++) {\r\n      const name = xmlChild.nodeName.toLowerCase();\r\n      const xmlChildElement = xmlChild as Element;\r\n      if (\r\n        name === 'block' ||\r\n        (name === 'shadow' && !eventUtils.getRecordUndo())\r\n      ) {\r\n        // Allow top-level shadow blocks if recordUndo is disabled since\r\n        // that means an undo is in progress.  Such a block is expected\r\n        // to be moved to a nested destination in the next operation.\r\n        const block = domToBlockInternal(xmlChildElement, workspace);\r\n        newBlockIds.push(block.id);\r\n        const blockX = parseInt(xmlChildElement.getAttribute('x') ?? '10', 10);\r\n        const blockY = parseInt(xmlChildElement.getAttribute('y') ?? '10', 10);\r\n        if (!isNaN(blockX) && !isNaN(blockY)) {\r\n          block.moveBy(workspace.RTL ? width - blockX : blockX, blockY, [\r\n            'create',\r\n          ]);\r\n        }\r\n        variablesFirst = false;\r\n      } else if (name === 'shadow') {\r\n        throw TypeError('Shadow block cannot be a top-level block.');\r\n      } else if (name === 'comment') {\r\n        if (workspace.rendered) {\r\n          WorkspaceCommentSvg.fromXmlRendered(\r\n            xmlChildElement,\r\n            workspace as WorkspaceSvg,\r\n            width,\r\n          );\r\n        } else {\r\n          WorkspaceComment.fromXml(xmlChildElement, workspace);\r\n        }\r\n      } else if (name === 'variables') {\r\n        if (variablesFirst) {\r\n          domToVariables(xmlChildElement, workspace);\r\n        } else {\r\n          throw Error(\r\n            \"'variables' tag must exist once before block and \" +\r\n              'shadow tag elements in the workspace XML, but it was found in ' +\r\n              'another location.',\r\n          );\r\n        }\r\n        variablesFirst = false;\r\n      }\r\n    }\r\n  } finally {\r\n    eventUtils.setGroup(existingGroup);\r\n    if ((workspace as WorkspaceSvg).setResizesEnabled) {\r\n      (workspace as WorkspaceSvg).setResizesEnabled(true);\r\n    }\r\n    if (workspace.rendered) renderManagement.triggerQueuedRenders();\r\n    dom.stopTextWidthCache();\r\n  }\r\n  // Re-enable workspace resizing.\r\n  eventUtils.fire(new (eventUtils.get(eventUtils.FINISHED_LOADING))(workspace));\r\n  return newBlockIds;\r\n}\r\n\r\n/**\r\n * Decode an XML DOM and create blocks on the workspace. Position the new\r\n * blocks immediately below prior blocks, aligned by their starting edge.\r\n *\r\n * @param xml The XML DOM.\r\n * @param workspace The workspace to add to.\r\n * @returns An array containing new block IDs.\r\n */\r\nexport function appendDomToWorkspace(\r\n  xml: Element,\r\n  workspace: WorkspaceSvg,\r\n): string[] {\r\n  // First check if we have a WorkspaceSvg, otherwise the blocks have no shape\r\n  // and the position does not matter.\r\n  // Assume it is rendered so we can check.\r\n  if (!(workspace as WorkspaceSvg).getBlocksBoundingBox) {\r\n    return domToWorkspace(xml, workspace);\r\n  }\r\n\r\n  const bbox = (workspace as WorkspaceSvg).getBlocksBoundingBox();\r\n  // Load the new blocks into the workspace and get the IDs of the new blocks.\r\n  const newBlockIds = domToWorkspace(xml, workspace);\r\n  if (bbox && bbox.top !== bbox.bottom) {\r\n    // Check if any previous block.\r\n    let offsetY = 0; // Offset to add to y of the new block.\r\n    let offsetX = 0;\r\n    const farY = bbox.bottom; // Bottom position.\r\n    const topX = workspace.RTL ? bbox.right : bbox.left; // X of bounding box.\r\n    // Check position of the new blocks.\r\n    let newLeftX = Infinity; // X of top left corner.\r\n    let newRightX = -Infinity; // X of top right corner.\r\n    let newY = Infinity; // Y of top corner.\r\n    const ySeparation = 10;\r\n    for (let i = 0; i < newBlockIds.length; i++) {\r\n      const blockXY = workspace\r\n        .getBlockById(newBlockIds[i])!\r\n        .getRelativeToSurfaceXY();\r\n      if (blockXY.y < newY) {\r\n        newY = blockXY.y;\r\n      }\r\n      if (blockXY.x < newLeftX) {\r\n        // if we left align also on x\r\n        newLeftX = blockXY.x;\r\n      }\r\n      if (blockXY.x > newRightX) {\r\n        // if we right align also on x\r\n        newRightX = blockXY.x;\r\n      }\r\n    }\r\n    offsetY = farY - newY + ySeparation;\r\n    offsetX = workspace.RTL ? topX - newRightX : topX - newLeftX;\r\n    for (let i = 0; i < newBlockIds.length; i++) {\r\n      const block = workspace.getBlockById(newBlockIds[i]);\r\n      block!.moveBy(offsetX, offsetY, ['create']);\r\n    }\r\n  }\r\n  return newBlockIds;\r\n}\r\n\r\n/**\r\n * Decode an XML block tag and create a block (and possibly sub blocks) on the\r\n * workspace.\r\n *\r\n * @param xmlBlock XML block element.\r\n * @param workspace The workspace.\r\n * @returns The root block created.\r\n */\r\nexport function domToBlock(xmlBlock: Element, workspace: Workspace): Block {\r\n  const block = domToBlockInternal(xmlBlock, workspace);\r\n  if (workspace.rendered) renderManagement.triggerQueuedRenders();\r\n  return block;\r\n}\r\n\r\n/**\r\n * Decode an XML block tag and create a block (and possibly sub blocks) on the\r\n * workspace.\r\n *\r\n * This is defined internally so that it doesn't trigger an immediate render,\r\n * which we do want to happen for external calls.\r\n *\r\n * @param xmlBlock XML block element.\r\n * @param workspace The workspace.\r\n * @returns The root block created.\r\n * @internal\r\n */\r\nexport function domToBlockInternal(\r\n  xmlBlock: Element,\r\n  workspace: Workspace,\r\n): Block {\r\n  // Create top-level block.\r\n  eventUtils.disable();\r\n  const variablesBeforeCreation = workspace.getAllVariables();\r\n  let topBlock;\r\n  try {\r\n    topBlock = domToBlockHeadless(xmlBlock, workspace);\r\n    // Generate list of all blocks.\r\n    if (workspace.rendered) {\r\n      const topBlockSvg = topBlock as BlockSvg;\r\n      const blocks = topBlock.getDescendants(false);\r\n      topBlockSvg.setConnectionTracking(false);\r\n      // Render each block.\r\n      for (let i = blocks.length - 1; i >= 0; i--) {\r\n        (blocks[i] as BlockSvg).initSvg();\r\n      }\r\n      for (let i = blocks.length - 1; i >= 0; i--) {\r\n        (blocks[i] as BlockSvg).queueRender();\r\n      }\r\n      // Populating the connection database may be deferred until after the\r\n      // blocks have rendered.\r\n      setTimeout(function () {\r\n        if (!topBlockSvg.disposed) {\r\n          topBlockSvg.setConnectionTracking(true);\r\n        }\r\n      }, 1);\r\n      // Allow the scrollbars to resize and move based on the new contents.\r\n      // TODO(@picklesrus): #387. Remove when domToBlock avoids resizing.\r\n      (workspace as WorkspaceSvg).resizeContents();\r\n    } else {\r\n      const blocks = topBlock.getDescendants(false);\r\n      for (let i = blocks.length - 1; i >= 0; i--) {\r\n        blocks[i].initModel();\r\n      }\r\n    }\r\n  } finally {\r\n    eventUtils.enable();\r\n  }\r\n  if (eventUtils.isEnabled()) {\r\n    const newVariables = Variables.getAddedVariables(\r\n      workspace,\r\n      variablesBeforeCreation,\r\n    );\r\n    // Fire a VarCreate event for each (if any) new variable created.\r\n    for (let i = 0; i < newVariables.length; i++) {\r\n      const thisVariable = newVariables[i];\r\n      eventUtils.fire(\r\n        new (eventUtils.get(eventUtils.VAR_CREATE))(thisVariable),\r\n      );\r\n    }\r\n    // Block events come after var events, in case they refer to newly created\r\n    // variables.\r\n    eventUtils.fire(new (eventUtils.get(eventUtils.CREATE))(topBlock));\r\n  }\r\n  return topBlock;\r\n}\r\n\r\n/**\r\n * Decode an XML list of variables and add the variables to the workspace.\r\n *\r\n * @param xmlVariables List of XML variable elements.\r\n * @param workspace The workspace to which the variable should be added.\r\n */\r\nexport function domToVariables(xmlVariables: Element, workspace: Workspace) {\r\n  for (let i = 0; i < xmlVariables.children.length; i++) {\r\n    const xmlChild = xmlVariables.children[i];\r\n    const type = xmlChild.getAttribute('type');\r\n    const id = xmlChild.getAttribute('id');\r\n    const name = xmlChild.textContent;\r\n\r\n    if (!name) return;\r\n    workspace.createVariable(name, type, id);\r\n  }\r\n}\r\n\r\n/** A mapping of nodeName to node for child nodes of xmlBlock. */\r\ninterface childNodeTagMap {\r\n  mutation: Element[];\r\n  comment: Element[];\r\n  data: Element[];\r\n  field: Element[];\r\n  input: Element[];\r\n  next: Element[];\r\n}\r\n\r\n/**\r\n * Creates a mapping of childNodes for each supported XML tag for the provided\r\n * xmlBlock. Logs a warning for any encountered unsupported tags.\r\n *\r\n * @param xmlBlock XML block element.\r\n * @returns The childNode map from nodeName to node.\r\n */\r\nfunction mapSupportedXmlTags(xmlBlock: Element): childNodeTagMap {\r\n  const childNodeMap = {\r\n    mutation: new Array<Element>(),\r\n    comment: new Array<Element>(),\r\n    data: new Array<Element>(),\r\n    field: new Array<Element>(),\r\n    input: new Array<Element>(),\r\n    next: new Array<Element>(),\r\n  };\r\n  for (let i = 0; i < xmlBlock.children.length; i++) {\r\n    const xmlChild = xmlBlock.children[i];\r\n    if (xmlChild.nodeType === dom.NodeType.TEXT_NODE) {\r\n      // Ignore any text at the <block> level.  It's all whitespace anyway.\r\n      continue;\r\n    }\r\n    switch (xmlChild.nodeName.toLowerCase()) {\r\n      case 'mutation':\r\n        childNodeMap.mutation.push(xmlChild);\r\n        break;\r\n      case 'comment':\r\n        childNodeMap.comment.push(xmlChild);\r\n        break;\r\n      case 'data':\r\n        childNodeMap.data.push(xmlChild);\r\n        break;\r\n      case 'title':\r\n      // Titles were renamed to field in December 2013.\r\n      // Fall through.\r\n      case 'field':\r\n        childNodeMap.field.push(xmlChild);\r\n        break;\r\n      case 'value':\r\n      case 'statement':\r\n        childNodeMap.input.push(xmlChild);\r\n        break;\r\n      case 'next':\r\n        childNodeMap.next.push(xmlChild);\r\n        break;\r\n      default:\r\n        // Unknown tag; ignore.  Same principle as HTML parsers.\r\n        console.warn('Ignoring unknown tag: ' + xmlChild.nodeName);\r\n    }\r\n  }\r\n  return childNodeMap;\r\n}\r\n\r\n/**\r\n * Applies mutation tag child nodes to the given block.\r\n *\r\n * @param xmlChildren Child nodes.\r\n * @param block The block to apply the child nodes on.\r\n * @returns True if mutation may have added some elements that need\r\n *     initialization (requiring initSvg call).\r\n */\r\nfunction applyMutationTagNodes(xmlChildren: Element[], block: Block): boolean {\r\n  let shouldCallInitSvg = false;\r\n  for (let i = 0; i < xmlChildren.length; i++) {\r\n    const xmlChild = xmlChildren[i];\r\n    // Custom data for an advanced block.\r\n    if (block.domToMutation) {\r\n      block.domToMutation(xmlChild);\r\n      if ((block as BlockSvg).initSvg) {\r\n        // Mutation may have added some elements that need initializing.\r\n        shouldCallInitSvg = true;\r\n      }\r\n    }\r\n  }\r\n  return shouldCallInitSvg;\r\n}\r\n\r\n/**\r\n * Applies comment tag child nodes to the given block.\r\n *\r\n * @param xmlChildren Child nodes.\r\n * @param block The block to apply the child nodes on.\r\n */\r\nfunction applyCommentTagNodes(xmlChildren: Element[], block: Block) {\r\n  for (let i = 0; i < xmlChildren.length; i++) {\r\n    const xmlChild = xmlChildren[i];\r\n    const text = xmlChild.textContent;\r\n    const pinned = xmlChild.getAttribute('pinned') === 'true';\r\n    const width = parseInt(xmlChild.getAttribute('w') ?? '50', 10);\r\n    const height = parseInt(xmlChild.getAttribute('h') ?? '50', 10);\r\n\r\n    block.setCommentText(text);\r\n    const comment = block.getIcon(IconType.COMMENT)!;\r\n    if (!isNaN(width) && !isNaN(height)) {\r\n      comment.setBubbleSize(new Size(width, height));\r\n    }\r\n    // Set the pinned state of the bubble.\r\n    comment.setBubbleVisible(pinned);\r\n    // Actually show the bubble after the block has been rendered.\r\n    setTimeout(() => comment.setBubbleVisible(pinned), 1);\r\n  }\r\n}\r\n\r\n/**\r\n * Applies data tag child nodes to the given block.\r\n *\r\n * @param xmlChildren Child nodes.\r\n * @param block The block to apply the child nodes on.\r\n */\r\nfunction applyDataTagNodes(xmlChildren: Element[], block: Block) {\r\n  for (let i = 0; i < xmlChildren.length; i++) {\r\n    const xmlChild = xmlChildren[i];\r\n    block.data = xmlChild.textContent;\r\n  }\r\n}\r\n\r\n/**\r\n * Applies field tag child nodes to the given block.\r\n *\r\n * @param xmlChildren Child nodes.\r\n * @param block The block to apply the child nodes on.\r\n */\r\nfunction applyFieldTagNodes(xmlChildren: Element[], block: Block) {\r\n  for (let i = 0; i < xmlChildren.length; i++) {\r\n    const xmlChild = xmlChildren[i];\r\n    const nodeName = xmlChild.getAttribute('name');\r\n    if (!nodeName) {\r\n      console.warn(`Ignoring unnamed field in block ${block.type}`);\r\n      continue;\r\n    }\r\n    domToField(block, nodeName, xmlChild);\r\n  }\r\n}\r\n\r\n/**\r\n * Finds any enclosed blocks or shadows within this XML node.\r\n *\r\n * @param xmlNode The XML node to extract child block info from.\r\n * @returns Any found child block.\r\n */\r\nfunction findChildBlocks(xmlNode: Element): {\r\n  childBlockElement: Element | null;\r\n  childShadowElement: Element | null;\r\n} {\r\n  let childBlockElement: Element | null = null;\r\n  let childShadowElement: Element | null = null;\r\n  for (let i = 0; i < xmlNode.childNodes.length; i++) {\r\n    const xmlChild = xmlNode.childNodes[i];\r\n    if (isElement(xmlChild)) {\r\n      if (xmlChild.nodeName.toLowerCase() === 'block') {\r\n        childBlockElement = xmlChild;\r\n      } else if (xmlChild.nodeName.toLowerCase() === 'shadow') {\r\n        childShadowElement = xmlChild;\r\n      }\r\n    }\r\n  }\r\n  return {childBlockElement, childShadowElement};\r\n}\r\n/**\r\n * Applies input child nodes (value or statement) to the given block.\r\n *\r\n * @param xmlChildren Child nodes.\r\n * @param workspace The workspace containing the given block.\r\n * @param block The block to apply the child nodes on.\r\n * @param prototypeName The prototype name of the block.\r\n */\r\nfunction applyInputTagNodes(\r\n  xmlChildren: Element[],\r\n  workspace: Workspace,\r\n  block: Block,\r\n  prototypeName: string,\r\n) {\r\n  for (let i = 0; i < xmlChildren.length; i++) {\r\n    const xmlChild = xmlChildren[i];\r\n    const nodeName = xmlChild.getAttribute('name');\r\n    const input = nodeName ? block.getInput(nodeName) : null;\r\n    if (!input) {\r\n      console.warn(\r\n        'Ignoring non-existent input ' +\r\n          nodeName +\r\n          ' in block ' +\r\n          prototypeName,\r\n      );\r\n      break;\r\n    }\r\n    const childBlockInfo = findChildBlocks(xmlChild);\r\n    if (childBlockInfo.childBlockElement) {\r\n      if (!input.connection) {\r\n        throw TypeError('Input connection does not exist.');\r\n      }\r\n      domToBlockHeadless(\r\n        childBlockInfo.childBlockElement,\r\n        workspace,\r\n        input.connection,\r\n        false,\r\n      );\r\n    }\r\n    // Set shadow after so we don't create a shadow we delete immediately.\r\n    if (childBlockInfo.childShadowElement) {\r\n      input.connection?.setShadowDom(childBlockInfo.childShadowElement);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Applies next child nodes to the given block.\r\n *\r\n * @param xmlChildren Child nodes.\r\n * @param workspace The workspace containing the given block.\r\n * @param block The block to apply the child nodes on.\r\n */\r\nfunction applyNextTagNodes(\r\n  xmlChildren: Element[],\r\n  workspace: Workspace,\r\n  block: Block,\r\n) {\r\n  for (let i = 0; i < xmlChildren.length; i++) {\r\n    const xmlChild = xmlChildren[i];\r\n    const childBlockInfo = findChildBlocks(xmlChild);\r\n    if (childBlockInfo.childBlockElement) {\r\n      if (!block.nextConnection) {\r\n        throw TypeError('Next statement does not exist.');\r\n      }\r\n      // If there is more than one XML 'next' tag.\r\n      if (block.nextConnection.isConnected()) {\r\n        throw TypeError('Next statement is already connected.');\r\n      }\r\n      // Create child block.\r\n      domToBlockHeadless(\r\n        childBlockInfo.childBlockElement,\r\n        workspace,\r\n        block.nextConnection,\r\n        true,\r\n      );\r\n    }\r\n    // Set shadow after so we don't create a shadow we delete immediately.\r\n    if (childBlockInfo.childShadowElement && block.nextConnection) {\r\n      block.nextConnection.setShadowDom(childBlockInfo.childShadowElement);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Decode an XML block tag and create a block (and possibly sub blocks) on the\r\n * workspace.\r\n *\r\n * @param xmlBlock XML block element.\r\n * @param workspace The workspace.\r\n * @param parentConnection The parent connection to to connect this block to\r\n *     after instantiating.\r\n * @param connectedToParentNext Whether the provided parent connection is a next\r\n *     connection, rather than output or statement.\r\n * @returns The root block created.\r\n */\r\nfunction domToBlockHeadless(\r\n  xmlBlock: Element,\r\n  workspace: Workspace,\r\n  parentConnection?: Connection,\r\n  connectedToParentNext?: boolean,\r\n): Block {\r\n  let block = null;\r\n  const prototypeName = xmlBlock.getAttribute('type');\r\n  if (!prototypeName) {\r\n    throw TypeError('Block type unspecified: ' + xmlBlock.outerHTML);\r\n  }\r\n  const id = xmlBlock.getAttribute('id') ?? undefined;\r\n  block = workspace.newBlock(prototypeName, id);\r\n\r\n  // Preprocess childNodes so tags can be processed in a consistent order.\r\n  const xmlChildNameMap = mapSupportedXmlTags(xmlBlock);\r\n\r\n  const shouldCallInitSvg = applyMutationTagNodes(\r\n    xmlChildNameMap.mutation,\r\n    block,\r\n  );\r\n  applyCommentTagNodes(xmlChildNameMap.comment, block);\r\n  applyDataTagNodes(xmlChildNameMap.data, block);\r\n\r\n  // Connect parent after processing mutation and before setting fields.\r\n  if (parentConnection) {\r\n    if (connectedToParentNext) {\r\n      if (block.previousConnection) {\r\n        parentConnection.connect(block.previousConnection);\r\n      } else {\r\n        throw TypeError('Next block does not have previous statement.');\r\n      }\r\n    } else {\r\n      if (block.outputConnection) {\r\n        parentConnection.connect(block.outputConnection);\r\n      } else if (block.previousConnection) {\r\n        parentConnection.connect(block.previousConnection);\r\n      } else {\r\n        throw TypeError(\r\n          'Child block does not have output or previous statement.',\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  applyFieldTagNodes(xmlChildNameMap.field, block);\r\n  applyInputTagNodes(xmlChildNameMap.input, workspace, block, prototypeName);\r\n  applyNextTagNodes(xmlChildNameMap.next, workspace, block);\r\n\r\n  if (shouldCallInitSvg) {\r\n    // This shouldn't even be called here\r\n    // (ref: https://github.com/google/blockly/pull/4296#issuecomment-884226021\r\n    // But the XML serializer/deserializer is iceboxed so I'm not going to fix\r\n    // it.\r\n    (block as BlockSvg).initSvg();\r\n  }\r\n\r\n  const inline = xmlBlock.getAttribute('inline');\r\n  if (inline) {\r\n    block.setInputsInline(inline === 'true');\r\n  }\r\n  const disabled = xmlBlock.getAttribute('disabled');\r\n  if (disabled) {\r\n    block.setEnabled(disabled !== 'true' && disabled !== 'disabled');\r\n  }\r\n  const deletable = xmlBlock.getAttribute('deletable');\r\n  if (deletable) {\r\n    block.setDeletable(deletable === 'true');\r\n  }\r\n  const movable = xmlBlock.getAttribute('movable');\r\n  if (movable) {\r\n    block.setMovable(movable === 'true');\r\n  }\r\n  const editable = xmlBlock.getAttribute('editable');\r\n  if (editable) {\r\n    block.setEditable(editable === 'true');\r\n  }\r\n  const collapsed = xmlBlock.getAttribute('collapsed');\r\n  if (collapsed) {\r\n    block.setCollapsed(collapsed === 'true');\r\n  }\r\n  if (xmlBlock.nodeName.toLowerCase() === 'shadow') {\r\n    // Ensure all children are also shadows.\r\n    const children = block.getChildren(false);\r\n    for (let i = 0; i < children.length; i++) {\r\n      const child = children[i];\r\n      if (!child.isShadow()) {\r\n        throw TypeError('Shadow block not allowed non-shadow child.');\r\n      }\r\n    }\r\n\r\n    block.setShadow(true);\r\n  }\r\n  return block;\r\n}\r\n\r\n/**\r\n * Decode an XML field tag and set the value of that field on the given block.\r\n *\r\n * @param block The block that is currently being deserialized.\r\n * @param fieldName The name of the field on the block.\r\n * @param xml The field tag to decode.\r\n */\r\nfunction domToField(block: Block, fieldName: string, xml: Element) {\r\n  const field = block.getField(fieldName);\r\n  if (!field) {\r\n    console.warn(\r\n      'Ignoring non-existent field ' + fieldName + ' in block ' + block.type,\r\n    );\r\n    return;\r\n  }\r\n  field.fromXml(xml);\r\n}\r\n\r\n/**\r\n * Remove any 'next' block (statements in a stack).\r\n *\r\n * @param xmlBlock XML block element or an empty DocumentFragment if the block\r\n *     was an insertion marker.\r\n */\r\nexport function deleteNext(xmlBlock: Element | DocumentFragment) {\r\n  for (let i = 0; i < xmlBlock.childNodes.length; i++) {\r\n    const child = xmlBlock.childNodes[i];\r\n    if (child.nodeName.toLowerCase() === 'next') {\r\n      xmlBlock.removeChild(child);\r\n      break;\r\n    }\r\n  }\r\n}\r\n\r\nfunction isElement(node: Node): node is Element {\r\n  return node.nodeType === dom.NodeType.ELEMENT_NODE;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2023 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport interface ISerializable {\r\n  /**\r\n   * @param doFullSerialization If true, this signals that any backing data\r\n   *     structures used by this ISerializable should also be serialized. This\r\n   *     is used for copy-paste.\r\n   * @returns a JSON serializable value that records the ISerializable's state.\r\n   */\r\n  saveState(doFullSerialization: boolean): any;\r\n\r\n  /**\r\n   * Takes in a JSON serializable value and sets the ISerializable's state\r\n   * based on that.\r\n   *\r\n   * @param state The state to apply to the ISerializable.\r\n   */\r\n  loadState(state: any): void;\r\n}\r\n\r\n/** Type guard that checks whether the given object is a ISerializable. */\r\nexport function isSerializable(obj: any): obj is ISerializable {\r\n  return obj.saveState !== undefined && obj.loadState !== undefined;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.serialization.registry\r\n\r\nimport type {ISerializer} from '../interfaces/i_serializer.js';\r\nimport * as registry from '../registry.js';\r\n\r\n/**\r\n * Registers the given serializer so that it can be used for serialization and\r\n * deserialization.\r\n *\r\n * @param name The name of the serializer to register.\r\n * @param serializer The serializer to register.\r\n */\r\nexport function register(name: string, serializer: ISerializer) {\r\n  registry.register(registry.Type.SERIALIZER, name, serializer);\r\n}\r\n\r\n/**\r\n * Unregisters the serializer associated with the given name.\r\n *\r\n * @param name The name of the serializer to unregister.\r\n */\r\nexport function unregister(name: string) {\r\n  registry.unregister(registry.Type.SERIALIZER, name);\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.serialization.blocks\r\n\r\nimport type {Block} from '../block.js';\r\nimport type {BlockSvg} from '../block_svg.js';\r\nimport type {Connection} from '../connection.js';\r\nimport * as eventUtils from '../events/utils.js';\r\nimport {inputTypes} from '../inputs/input_types.js';\r\nimport {isSerializable} from '../interfaces/i_serializable.js';\r\nimport type {ISerializer} from '../interfaces/i_serializer.js';\r\nimport * as registry from '../registry.js';\r\nimport * as utilsXml from '../utils/xml.js';\r\nimport type {Workspace} from '../workspace.js';\r\nimport * as Xml from '../xml.js';\r\nimport * as renderManagement from '../render_management.js';\r\n\r\nimport {\r\n  BadConnectionCheck,\r\n  MissingBlockType,\r\n  MissingConnection,\r\n  RealChildOfShadow,\r\n  UnregisteredIcon,\r\n} from './exceptions.js';\r\nimport * as priorities from './priorities.js';\r\nimport * as serializationRegistry from './registry.js';\r\n\r\n// TODO(#5160): Remove this once lint is fixed.\r\n/* eslint-disable no-use-before-define */\r\n\r\n/**\r\n * Represents the state of a connection.\r\n */\r\nexport interface ConnectionState {\r\n  shadow?: State;\r\n  block?: State;\r\n}\r\n\r\n/**\r\n * Represents the state of a given block.\r\n */\r\nexport interface State {\r\n  type: string;\r\n  id?: string;\r\n  x?: number;\r\n  y?: number;\r\n  collapsed?: boolean;\r\n  deletable?: boolean;\r\n  movable?: boolean;\r\n  editable?: boolean;\r\n  enabled?: boolean;\r\n  inline?: boolean;\r\n  data?: string;\r\n  extraState?: AnyDuringMigration;\r\n  icons?: {[key: string]: AnyDuringMigration};\r\n  fields?: {[key: string]: AnyDuringMigration};\r\n  inputs?: {[key: string]: ConnectionState};\r\n  next?: ConnectionState;\r\n}\r\n\r\n/**\r\n * Returns the state of the given block as a plain JavaScript object.\r\n *\r\n * @param block The block to serialize.\r\n * @param param1 addCoordinates: If true, the coordinates of the block are added\r\n *     to the serialized state. False by default. addinputBlocks: If true,\r\n *     children of the block which are connected to inputs will be serialized.\r\n *     True by default. addNextBlocks: If true, children of the block which are\r\n *     connected to the block's next connection (if it exists) will be\r\n *     serialized. True by default. doFullSerialization: If true, fields that\r\n *     normally just save a reference to some external state (eg variables) will\r\n *     instead serialize all of the info about that state. This supports\r\n *     deserializing the block into a workspace where that state doesn't yet\r\n *     exist. True by default.\r\n * @returns The serialized state of the block, or null if the block could not be\r\n *     serialied (eg it was an insertion marker).\r\n */\r\nexport function save(\r\n  block: Block,\r\n  {\r\n    addCoordinates = false,\r\n    addInputBlocks = true,\r\n    addNextBlocks = true,\r\n    doFullSerialization = true,\r\n    saveIds = true,\r\n  }: {\r\n    addCoordinates?: boolean;\r\n    addInputBlocks?: boolean;\r\n    addNextBlocks?: boolean;\r\n    doFullSerialization?: boolean;\r\n    saveIds?: boolean;\r\n  } = {},\r\n): State | null {\r\n  if (block.isInsertionMarker()) {\r\n    return null;\r\n  }\r\n  const state = {\r\n    'type': block.type,\r\n    'id': saveIds ? block.id : undefined,\r\n  };\r\n\r\n  if (addCoordinates) {\r\n    // AnyDuringMigration because:  Argument of type '{ type: string; id:\r\n    // string; }' is not assignable to parameter of type 'State'.\r\n    saveCoords(block, state as AnyDuringMigration);\r\n  }\r\n  // AnyDuringMigration because:  Argument of type '{ type: string; id: string;\r\n  // }' is not assignable to parameter of type 'State'.\r\n  saveAttributes(block, state as AnyDuringMigration);\r\n  // AnyDuringMigration because:  Argument of type '{ type: string; id: string;\r\n  // }' is not assignable to parameter of type 'State'.\r\n  saveExtraState(block, state as AnyDuringMigration, doFullSerialization);\r\n  // AnyDuringMigration because:  Argument of type '{ type: string; id: string;\r\n  // }' is not assignable to parameter of type 'State'.\r\n  saveIcons(block, state as AnyDuringMigration, doFullSerialization);\r\n  // AnyDuringMigration because:  Argument of type '{ type: string; id: string;\r\n  // }' is not assignable to parameter of type 'State'.\r\n  saveFields(block, state as AnyDuringMigration, doFullSerialization);\r\n  if (addInputBlocks) {\r\n    // AnyDuringMigration because:  Argument of type '{ type: string; id:\r\n    // string; }' is not assignable to parameter of type 'State'.\r\n    saveInputBlocks(\r\n      block,\r\n      state as AnyDuringMigration,\r\n      doFullSerialization,\r\n      saveIds,\r\n    );\r\n  }\r\n  if (addNextBlocks) {\r\n    // AnyDuringMigration because:  Argument of type '{ type: string; id:\r\n    // string; }' is not assignable to parameter of type 'State'.\r\n    saveNextBlocks(\r\n      block,\r\n      state as AnyDuringMigration,\r\n      doFullSerialization,\r\n      saveIds,\r\n    );\r\n  }\r\n\r\n  // AnyDuringMigration because:  Type '{ type: string; id: string; }' is not\r\n  // assignable to type 'State'.\r\n  return state as AnyDuringMigration;\r\n}\r\n\r\n/**\r\n * Adds attributes to the given state object based on the state of the block.\r\n * Eg collapsed, disabled, inline, etc.\r\n *\r\n * @param block The block to base the attributes on.\r\n * @param state The state object to append to.\r\n */\r\nfunction saveAttributes(block: Block, state: State) {\r\n  if (block.isCollapsed()) {\r\n    state['collapsed'] = true;\r\n  }\r\n  if (!block.isEnabled()) {\r\n    state['enabled'] = false;\r\n  }\r\n  if (!block.isOwnDeletable()) {\r\n    state['deletable'] = false;\r\n  }\r\n  if (!block.isOwnMovable()) {\r\n    state['movable'] = false;\r\n  }\r\n  if (!block.isOwnEditable()) {\r\n    state['editable'] = false;\r\n  }\r\n  if (\r\n    block.inputsInline !== undefined &&\r\n    block.inputsInline !== block.inputsInlineDefault\r\n  ) {\r\n    state['inline'] = block.inputsInline;\r\n  }\r\n  // Data is a nullable string, so we don't need to worry about falsy values.\r\n  if (block.data) {\r\n    state['data'] = block.data;\r\n  }\r\n}\r\n\r\n/**\r\n * Adds the coordinates of the given block to the given state object.\r\n *\r\n * @param block The block to base the coordinates on.\r\n * @param state The state object to append to.\r\n */\r\nfunction saveCoords(block: Block, state: State) {\r\n  const workspace = block.workspace;\r\n  const xy = block.getRelativeToSurfaceXY();\r\n  state['x'] = Math.round(workspace.RTL ? workspace.getWidth() - xy.x : xy.x);\r\n  state['y'] = Math.round(xy.y);\r\n}\r\n\r\n/**\r\n * Adds any extra state the block may provide to the given state object.\r\n *\r\n * @param block The block to serialize the extra state of.\r\n * @param state The state object to append to.\r\n * @param doFullSerialization Whether or not to serialize the full state of the\r\n *     extra state (rather than possibly saving a reference to some state).\r\n */\r\nfunction saveExtraState(\r\n  block: Block,\r\n  state: State,\r\n  doFullSerialization: boolean,\r\n) {\r\n  if (block.saveExtraState) {\r\n    const extraState = block.saveExtraState(doFullSerialization);\r\n    if (extraState !== null) {\r\n      state['extraState'] = extraState;\r\n    }\r\n  } else if (block.mutationToDom) {\r\n    const extraState = block.mutationToDom();\r\n    if (extraState !== null) {\r\n      state['extraState'] = Xml.domToText(extraState).replace(\r\n        ' xmlns=\"https://developers.google.com/blockly/xml\"',\r\n        '',\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Adds the state of all of the icons on the block to the given state object.\r\n *\r\n * @param block The block to serialize the icon state of.\r\n * @param state The state object to append to.\r\n * @param doFullSerialization Whether or not to serialize the full state of the\r\n *     icon (rather than possibly saving a reference to some state).\r\n */\r\nfunction saveIcons(block: Block, state: State, doFullSerialization: boolean) {\r\n  const icons = Object.create(null);\r\n  for (const icon of block.getIcons()) {\r\n    if (isSerializable(icon)) {\r\n      const state = icon.saveState(doFullSerialization);\r\n      if (state) icons[icon.getType().toString()] = state;\r\n    }\r\n  }\r\n\r\n  if (Object.keys(icons).length) {\r\n    state['icons'] = icons;\r\n  }\r\n}\r\n\r\n/**\r\n * Adds the state of all of the fields on the block to the given state object.\r\n *\r\n * @param block The block to serialize the field state of.\r\n * @param state The state object to append to.\r\n * @param doFullSerialization Whether or not to serialize the full state of the\r\n *     field (rather than possibly saving a reference to some state).\r\n */\r\nfunction saveFields(block: Block, state: State, doFullSerialization: boolean) {\r\n  const fields = Object.create(null);\r\n  for (let i = 0; i < block.inputList.length; i++) {\r\n    const input = block.inputList[i];\r\n    for (let j = 0; j < input.fieldRow.length; j++) {\r\n      const field = input.fieldRow[j];\r\n      if (field.isSerializable()) {\r\n        fields[field.name!] = field.saveState(doFullSerialization);\r\n      }\r\n    }\r\n  }\r\n  if (Object.keys(fields).length) {\r\n    state['fields'] = fields;\r\n  }\r\n}\r\n\r\n/**\r\n * Adds the state of all of the child blocks of the given block (which are\r\n * connected to inputs) to the given state object.\r\n *\r\n * @param block The block to serialize the input blocks of.\r\n * @param state The state object to append to.\r\n * @param doFullSerialization Whether or not to do full serialization.\r\n */\r\nfunction saveInputBlocks(\r\n  block: Block,\r\n  state: State,\r\n  doFullSerialization: boolean,\r\n  saveIds: boolean,\r\n) {\r\n  const inputs = Object.create(null);\r\n  for (let i = 0; i < block.inputList.length; i++) {\r\n    const input = block.inputList[i];\r\n    if (!input.connection) continue;\r\n    const connectionState = saveConnection(\r\n      input.connection as Connection,\r\n      doFullSerialization,\r\n      saveIds,\r\n    );\r\n    if (connectionState) {\r\n      inputs[input.name] = connectionState;\r\n    }\r\n  }\r\n\r\n  if (Object.keys(inputs).length) {\r\n    state['inputs'] = inputs;\r\n  }\r\n}\r\n\r\n/**\r\n * Adds the state of all of the next blocks of the given block to the given\r\n * state object.\r\n *\r\n * @param block The block to serialize the next blocks of.\r\n * @param state The state object to append to.\r\n * @param doFullSerialization Whether or not to do full serialization.\r\n */\r\nfunction saveNextBlocks(\r\n  block: Block,\r\n  state: State,\r\n  doFullSerialization: boolean,\r\n  saveIds: boolean,\r\n) {\r\n  if (!block.nextConnection) {\r\n    return;\r\n  }\r\n  const connectionState = saveConnection(\r\n    block.nextConnection,\r\n    doFullSerialization,\r\n    saveIds,\r\n  );\r\n  if (connectionState) {\r\n    state['next'] = connectionState;\r\n  }\r\n}\r\n\r\n/**\r\n * Returns the state of the given connection (ie the state of any connected\r\n * shadow or real blocks).\r\n *\r\n * @param connection The connection to serialize the connected blocks of.\r\n * @returns An object containing the state of any connected shadow block, or any\r\n *     connected real block.\r\n * @param doFullSerialization Whether or not to do full serialization.\r\n */\r\nfunction saveConnection(\r\n  connection: Connection,\r\n  doFullSerialization: boolean,\r\n  saveIds: boolean,\r\n): ConnectionState | null {\r\n  const shadow = connection.getShadowState(true);\r\n  const child = connection.targetBlock();\r\n  if (!shadow && !child) {\r\n    return null;\r\n  }\r\n  const state = Object.create(null);\r\n  if (shadow) {\r\n    state['shadow'] = shadow;\r\n  }\r\n  if (child && !child.isShadow()) {\r\n    state['block'] = save(child, {doFullSerialization, saveIds});\r\n  }\r\n  return state;\r\n}\r\n\r\n/**\r\n * Loads the block represented by the given state into the given workspace.\r\n *\r\n * @param state The state of a block to deserialize into the workspace.\r\n * @param workspace The workspace to add the block to.\r\n * @param param1 recordUndo: If true, events triggered by this function will be\r\n *     undo-able by the user. False by default.\r\n * @returns The block that was just loaded.\r\n */\r\nexport function append(\r\n  state: State,\r\n  workspace: Workspace,\r\n  {recordUndo = false}: {recordUndo?: boolean} = {},\r\n): Block {\r\n  const block = appendInternal(state, workspace, {recordUndo});\r\n  if (workspace.rendered) renderManagement.triggerQueuedRenders();\r\n  return block;\r\n}\r\n\r\n/**\r\n * Loads the block represented by the given state into the given workspace.\r\n * This is defined internally so that the extra parameters don't clutter our\r\n * external API.\r\n * But it is exported so that other places within Blockly can call it directly\r\n * with the extra parameters.\r\n *\r\n * @param state The state of a block to deserialize into the workspace.\r\n * @param workspace The workspace to add the block to.\r\n * @param param1 parentConnection: If provided, the system will attempt to\r\n *     connect the block to this connection after it is created. Undefined by\r\n *     default. isShadow: If true, the block will be set to a shadow block after\r\n *     it is created. False by default. recordUndo: If true, events triggered by\r\n *     this function will be undo-able by the user. False by default.\r\n * @returns The block that was just appended.\r\n * @internal\r\n */\r\nexport function appendInternal(\r\n  state: State,\r\n  workspace: Workspace,\r\n  {\r\n    parentConnection = undefined,\r\n    isShadow = false,\r\n    recordUndo = false,\r\n  }: {\r\n    parentConnection?: Connection;\r\n    isShadow?: boolean;\r\n    recordUndo?: boolean;\r\n  } = {},\r\n): Block {\r\n  const prevRecordUndo = eventUtils.getRecordUndo();\r\n  eventUtils.setRecordUndo(recordUndo);\r\n  const existingGroup = eventUtils.getGroup();\r\n  if (!existingGroup) {\r\n    eventUtils.setGroup(true);\r\n  }\r\n  eventUtils.disable();\r\n\r\n  let block;\r\n  try {\r\n    block = appendPrivate(state, workspace, {parentConnection, isShadow});\r\n  } finally {\r\n    eventUtils.enable();\r\n  }\r\n\r\n  if (eventUtils.isEnabled()) {\r\n    eventUtils.fire(new (eventUtils.get(eventUtils.BLOCK_CREATE))(block));\r\n  }\r\n  eventUtils.setGroup(existingGroup);\r\n  eventUtils.setRecordUndo(prevRecordUndo);\r\n\r\n  // Adding connections to the connection db is expensive. This defers that\r\n  // operation to decrease load time.\r\n  if (workspace.rendered) {\r\n    const blockSvg = block as BlockSvg;\r\n    setTimeout(() => {\r\n      if (!blockSvg.disposed) {\r\n        blockSvg.setConnectionTracking(true);\r\n      }\r\n    }, 1);\r\n  }\r\n\r\n  return block;\r\n}\r\n\r\n/**\r\n * Loads the block represented by the given state into the given workspace.\r\n * This is defined privately so that it can be called recursively without firing\r\n * eroneous events. Events (and other things we only want to occur on the top\r\n * block) are handled by appendInternal.\r\n *\r\n * @param state The state of a block to deserialize into the workspace.\r\n * @param workspace The workspace to add the block to.\r\n * @param param1 parentConnection: If provided, the system will attempt to\r\n *     connect the block to this connection after it is created. Undefined by\r\n *     default. isShadow: The block will be set to a shadow block after it is\r\n *     created. False by default.\r\n * @returns The block that was just appended.\r\n */\r\nfunction appendPrivate(\r\n  state: State,\r\n  workspace: Workspace,\r\n  {\r\n    parentConnection = undefined,\r\n    isShadow = false,\r\n  }: {parentConnection?: Connection; isShadow?: boolean} = {},\r\n): Block {\r\n  if (!state['type']) {\r\n    throw new MissingBlockType(state);\r\n  }\r\n\r\n  const block = workspace.newBlock(state['type'], state['id']);\r\n  block.setShadow(isShadow);\r\n  loadCoords(block, state);\r\n  loadAttributes(block, state);\r\n  loadExtraState(block, state);\r\n  tryToConnectParent(parentConnection, block, state);\r\n  loadIcons(block, state);\r\n  loadFields(block, state);\r\n  loadInputBlocks(block, state);\r\n  loadNextBlocks(block, state);\r\n  initBlock(block, workspace.rendered);\r\n\r\n  return block;\r\n}\r\n\r\n/**\r\n * Applies any coordinate information available on the state object to the\r\n * block.\r\n *\r\n * @param block The block to set the position of.\r\n * @param state The state object to reference.\r\n */\r\nfunction loadCoords(block: Block, state: State) {\r\n  let x = state['x'] === undefined ? 0 : state['x'];\r\n  const y = state['y'] === undefined ? 0 : state['y'];\r\n\r\n  const workspace = block.workspace;\r\n  x = workspace.RTL ? workspace.getWidth() - x : x;\r\n\r\n  block.moveBy(x, y);\r\n}\r\n\r\n/**\r\n * Applies any attribute information available on the state object to the block.\r\n *\r\n * @param block The block to set the attributes of.\r\n * @param state The state object to reference.\r\n */\r\nfunction loadAttributes(block: Block, state: State) {\r\n  if (state['collapsed']) {\r\n    block.setCollapsed(true);\r\n  }\r\n  if (state['deletable'] === false) {\r\n    block.setDeletable(false);\r\n  }\r\n  if (state['movable'] === false) {\r\n    block.setMovable(false);\r\n  }\r\n  if (state['editable'] === false) {\r\n    block.setEditable(false);\r\n  }\r\n  if (state['enabled'] === false) {\r\n    block.setEnabled(false);\r\n  }\r\n  if (state['inline'] !== undefined) {\r\n    block.setInputsInline(state['inline']);\r\n  }\r\n  if (state['data'] !== undefined) {\r\n    block.data = state['data'];\r\n  }\r\n}\r\n\r\n/**\r\n * Applies any extra state information available on the state object to the\r\n * block.\r\n *\r\n * @param block The block to set the extra state of.\r\n * @param state The state object to reference.\r\n */\r\nfunction loadExtraState(block: Block, state: State) {\r\n  if (!state['extraState']) {\r\n    return;\r\n  }\r\n  if (block.loadExtraState) {\r\n    block.loadExtraState(state['extraState']);\r\n  } else if (block.domToMutation) {\r\n    block.domToMutation(utilsXml.textToDom(state['extraState']));\r\n  }\r\n}\r\n\r\n/**\r\n * Attempts to connect the block to the parent connection, if it exists.\r\n *\r\n * @param parentConnection The parent connection to try to connect the block to.\r\n * @param child The block to try to connect to the parent.\r\n * @param state The state which defines the given block\r\n */\r\nfunction tryToConnectParent(\r\n  parentConnection: Connection | undefined,\r\n  child: Block,\r\n  state: State,\r\n) {\r\n  if (!parentConnection) {\r\n    return;\r\n  }\r\n\r\n  if (parentConnection.getSourceBlock().isShadow() && !child.isShadow()) {\r\n    throw new RealChildOfShadow(state);\r\n  }\r\n\r\n  let connected = false;\r\n  let childConnection;\r\n  if (parentConnection.type === inputTypes.VALUE) {\r\n    childConnection = child.outputConnection;\r\n    if (!childConnection) {\r\n      throw new MissingConnection('output', child, state);\r\n    }\r\n    connected = parentConnection.connect(childConnection);\r\n  } else {\r\n    // Statement type.\r\n    childConnection = child.previousConnection;\r\n    if (!childConnection) {\r\n      throw new MissingConnection('previous', child, state);\r\n    }\r\n    connected = parentConnection.connect(childConnection);\r\n  }\r\n\r\n  if (!connected) {\r\n    const checker = child.workspace.connectionChecker;\r\n    throw new BadConnectionCheck(\r\n      checker.getErrorMessage(\r\n        checker.canConnectWithReason(childConnection, parentConnection, false),\r\n        childConnection,\r\n        parentConnection,\r\n      ),\r\n      parentConnection.type === inputTypes.VALUE\r\n        ? 'output connection'\r\n        : 'previous connection',\r\n      child,\r\n      state,\r\n    );\r\n  }\r\n}\r\n\r\n/**\r\n * Applies icon state to the icons on the block, based on the given state\r\n * object.\r\n *\r\n * @param block The block to set the icon state of.\r\n * @param state The state object to reference.\r\n */\r\nfunction loadIcons(block: Block, state: State) {\r\n  if (!state['icons']) return;\r\n\r\n  const iconTypes = Object.keys(state['icons']);\r\n  for (const iconType of iconTypes) {\r\n    const iconState = state['icons'][iconType];\r\n    let icon = block.getIcon(iconType);\r\n    if (!icon) {\r\n      const constructor = registry.getClass(\r\n        registry.Type.ICON,\r\n        iconType,\r\n        false,\r\n      );\r\n      if (!constructor) throw new UnregisteredIcon(iconType, block, state);\r\n      icon = new constructor(block);\r\n      block.addIcon(icon);\r\n    }\r\n    if (isSerializable(icon)) icon.loadState(iconState);\r\n  }\r\n}\r\n\r\n/**\r\n * Applies any field information available on the state object to the block.\r\n *\r\n * @param block The block to set the field state of.\r\n * @param state The state object to reference.\r\n */\r\nfunction loadFields(block: Block, state: State) {\r\n  if (!state['fields']) {\r\n    return;\r\n  }\r\n  const keys = Object.keys(state['fields']);\r\n  for (let i = 0; i < keys.length; i++) {\r\n    const fieldName = keys[i];\r\n    const fieldState = state['fields'][fieldName];\r\n    const field = block.getField(fieldName);\r\n    if (!field) {\r\n      console.warn(\r\n        `Ignoring non-existant field ${fieldName} in block ${block.type}`,\r\n      );\r\n      continue;\r\n    }\r\n    field.loadState(fieldState);\r\n  }\r\n}\r\n\r\n/**\r\n * Creates any child blocks (attached to inputs) defined by the given state\r\n * and attaches them to the given block.\r\n *\r\n * @param block The block to attach input blocks to.\r\n * @param state The state object to reference.\r\n */\r\nfunction loadInputBlocks(block: Block, state: State) {\r\n  if (!state['inputs']) {\r\n    return;\r\n  }\r\n  const keys = Object.keys(state['inputs']);\r\n  for (let i = 0; i < keys.length; i++) {\r\n    const inputName = keys[i];\r\n    const input = block.getInput(inputName);\r\n    if (!input || !input.connection) {\r\n      throw new MissingConnection(inputName, block, state);\r\n    }\r\n    loadConnection(input.connection, state['inputs'][inputName]);\r\n  }\r\n}\r\n\r\n/**\r\n * Creates any next blocks defined by the given state and attaches them to the\r\n * given block.\r\n *\r\n * @param block The block to attach next blocks to.\r\n * @param state The state object to reference.\r\n */\r\nfunction loadNextBlocks(block: Block, state: State) {\r\n  if (!state['next']) {\r\n    return;\r\n  }\r\n  if (!block.nextConnection) {\r\n    throw new MissingConnection('next', block, state);\r\n  }\r\n  loadConnection(block.nextConnection, state['next']);\r\n}\r\n/**\r\n * Applies the state defined by connectionState to the given connection, ie\r\n * assigns shadows and attaches child blocks.\r\n *\r\n * @param connection The connection to deserialize the connected blocks of.\r\n * @param connectionState The object containing the state of any connected\r\n *     shadow block, or any connected real block.\r\n */\r\nfunction loadConnection(\r\n  connection: Connection,\r\n  connectionState: ConnectionState,\r\n) {\r\n  if (connectionState['shadow']) {\r\n    connection.setShadowState(connectionState['shadow']);\r\n  }\r\n  if (connectionState['block']) {\r\n    appendPrivate(\r\n      connectionState['block'],\r\n      connection.getSourceBlock().workspace,\r\n      {parentConnection: connection},\r\n    );\r\n  }\r\n}\r\n\r\n// TODO(#5146): Remove this from the serialization system.\r\n/**\r\n * Initializes the give block, eg init the model, inits the svg, renders, etc.\r\n *\r\n * @param block The block to initialize.\r\n * @param rendered Whether the block is a rendered or headless block.\r\n */\r\nfunction initBlock(block: Block, rendered: boolean) {\r\n  if (rendered) {\r\n    const blockSvg = block as BlockSvg;\r\n    // Adding connections to the connection db is expensive. This defers that\r\n    // operation to decrease load time.\r\n    blockSvg.setConnectionTracking(false);\r\n\r\n    blockSvg.initSvg();\r\n    blockSvg.queueRender();\r\n\r\n    // fixes #6076 JSO deserialization doesn't\r\n    // set .iconXY_ property so here it will be set\r\n    for (const icon of blockSvg.getIcons()) {\r\n      icon.onLocationChange(blockSvg.getRelativeToSurfaceXY());\r\n    }\r\n  } else {\r\n    block.initModel();\r\n  }\r\n}\r\n\r\n// Alias to disambiguate saving within the serializer.\r\nconst saveBlock = save;\r\n\r\n/**\r\n * Serializer for saving and loading block state.\r\n */\r\nexport class BlockSerializer implements ISerializer {\r\n  priority: number;\r\n\r\n  /* eslint-disable-next-line require-jsdoc */\r\n  constructor() {\r\n    /** The priority for deserializing blocks. */\r\n    this.priority = priorities.BLOCKS;\r\n  }\r\n\r\n  /**\r\n   * Serializes the blocks of the given workspace.\r\n   *\r\n   * @param workspace The workspace to save the blocks of.\r\n   * @returns The state of the workspace's blocks, or null if there are no\r\n   *     blocks.\r\n   */\r\n  save(\r\n    workspace: Workspace,\r\n  ): {languageVersion: number; blocks: State[]} | null {\r\n    const blockStates = [];\r\n    for (const block of workspace.getTopBlocks(false)) {\r\n      const state = saveBlock(block, {\r\n        addCoordinates: true,\r\n        doFullSerialization: false,\r\n      });\r\n      if (state) {\r\n        blockStates.push(state);\r\n      }\r\n    }\r\n    if (blockStates.length) {\r\n      return {\r\n        'languageVersion': 0, // Currently unused.\r\n        'blocks': blockStates,\r\n      };\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Deserializes the blocks defined by the given state into the given\r\n   * workspace.\r\n   *\r\n   * @param state The state of the blocks to deserialize.\r\n   * @param workspace The workspace to deserialize into.\r\n   */\r\n  load(\r\n    state: {languageVersion: number; blocks: State[]},\r\n    workspace: Workspace,\r\n  ) {\r\n    const blockStates = state['blocks'];\r\n    for (const state of blockStates) {\r\n      append(state, workspace, {recordUndo: eventUtils.getRecordUndo()});\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Disposes of any blocks that exist on the workspace.\r\n   *\r\n   * @param workspace The workspace to clear the blocks of.\r\n   */\r\n  clear(workspace: Workspace) {\r\n    // Cannot use workspace.clear() because that also removes variables.\r\n    for (const block of workspace.getTopBlocks(false)) {\r\n      block.dispose(false);\r\n    }\r\n  }\r\n}\r\n\r\nserializationRegistry.register('blocks', new BlockSerializer());\r\n","/**\r\n * @license\r\n * Copyright 2023 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport {BlockSvg} from '../block_svg.js';\r\nimport * as registry from './registry.js';\r\nimport {ICopyData} from '../interfaces/i_copyable.js';\r\nimport {IPaster} from '../interfaces/i_paster.js';\r\nimport {State, append} from '../serialization/blocks.js';\r\nimport {Coordinate} from '../utils/coordinate.js';\r\nimport {WorkspaceSvg} from '../workspace_svg.js';\r\nimport * as eventUtils from '../events/utils.js';\r\nimport {config} from '../config.js';\r\n\r\nexport class BlockPaster implements IPaster<BlockCopyData, BlockSvg> {\r\n  static TYPE = 'block';\r\n\r\n  paste(\r\n    copyData: BlockCopyData,\r\n    workspace: WorkspaceSvg,\r\n    coordinate?: Coordinate,\r\n  ): BlockSvg | null {\r\n    if (!workspace.isCapacityAvailable(copyData.typeCounts!)) return null;\r\n\r\n    if (coordinate) {\r\n      copyData.blockState['x'] = coordinate.x;\r\n      copyData.blockState['y'] = coordinate.y;\r\n    }\r\n\r\n    eventUtils.disable();\r\n    let block;\r\n    try {\r\n      block = append(copyData.blockState, workspace) as BlockSvg;\r\n      moveBlockToNotConflict(block);\r\n    } finally {\r\n      eventUtils.enable();\r\n    }\r\n\r\n    if (!block) return block;\r\n\r\n    if (eventUtils.isEnabled() && !block.isShadow()) {\r\n      eventUtils.fire(new (eventUtils.get(eventUtils.BLOCK_CREATE))(block));\r\n    }\r\n    block.select();\r\n    return block;\r\n  }\r\n}\r\n\r\n/**\r\n * Moves the given block to a location where it does not: (1) overlap exactly\r\n * with any other blocks, or (2) look like it is connected to any other blocks.\r\n *\r\n * Exported for testing.\r\n *\r\n * @param block The block to move to an unambiguous location.\r\n * @internal\r\n */\r\nexport function moveBlockToNotConflict(block: BlockSvg) {\r\n  const workspace = block.workspace;\r\n  const snapRadius = config.snapRadius;\r\n  const coord = block.getRelativeToSurfaceXY();\r\n  const offset = new Coordinate(0, 0);\r\n  // getRelativeToSurfaceXY is really expensive, so we want to cache this.\r\n  const otherCoords = workspace\r\n    .getAllBlocks(false)\r\n    .filter((otherBlock) => otherBlock.id != block.id)\r\n    .map((b) => b.getRelativeToSurfaceXY());\r\n\r\n  while (\r\n    blockOverlapsOtherExactly(Coordinate.sum(coord, offset), otherCoords) ||\r\n    blockIsInSnapRadius(block, offset, snapRadius)\r\n  ) {\r\n    if (workspace.RTL) {\r\n      offset.translate(-snapRadius, snapRadius * 2);\r\n    } else {\r\n      offset.translate(snapRadius, snapRadius * 2);\r\n    }\r\n  }\r\n\r\n  block!.moveTo(Coordinate.sum(coord, offset));\r\n}\r\n\r\n/**\r\n * @returns true if the given block coordinates are less than a delta of 1 from\r\n *     any of the other coordinates.\r\n */\r\nfunction blockOverlapsOtherExactly(\r\n  coord: Coordinate,\r\n  otherCoords: Coordinate[],\r\n): boolean {\r\n  return otherCoords.some(\r\n    (otherCoord) =>\r\n      Math.abs(otherCoord.x - coord.x) <= 1 &&\r\n      Math.abs(otherCoord.y - coord.y) <= 1,\r\n  );\r\n}\r\n\r\n/**\r\n * @returns true if the given block (when offset by the given amount) is close\r\n *     enough to any other connections (within the snap radius) that it looks\r\n *     like they could connect.\r\n */\r\nfunction blockIsInSnapRadius(\r\n  block: BlockSvg,\r\n  offset: Coordinate,\r\n  snapRadius: number,\r\n): boolean {\r\n  return block\r\n    .getConnections_(false)\r\n    .some((connection) => !!connection.closest(snapRadius, offset).connection);\r\n}\r\n\r\nexport interface BlockCopyData extends ICopyData {\r\n  blockState: State;\r\n  typeCounts: {[key: string]: number};\r\n}\r\n\r\nregistry.register(BlockPaster.TYPE, new BlockPaster());\r\n","/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.clipboard\r\n\r\nimport type {ICopyData, ICopyable} from './interfaces/i_copyable.js';\r\nimport {BlockPaster} from './clipboard/block_paster.js';\r\nimport * as globalRegistry from './registry.js';\r\nimport {WorkspaceSvg} from './workspace_svg.js';\r\nimport * as registry from './clipboard/registry.js';\r\nimport {Coordinate} from './utils/coordinate.js';\r\nimport * as deprecation from './utils/deprecation.js';\r\n\r\n/** Metadata about the object that is currently on the clipboard. */\r\nlet stashedCopyData: ICopyData | null = null;\r\n\r\nlet stashedWorkspace: WorkspaceSvg | null = null;\r\n\r\n/**\r\n * Copy a copyable element onto the local clipboard.\r\n *\r\n * @param toCopy The copyable element to be copied.\r\n * @deprecated v11. Use `myCopyable.toCopyData()` instead. To be removed v12.\r\n * @internal\r\n */\r\nexport function copy<T extends ICopyData>(toCopy: ICopyable<T>): T | null {\r\n  deprecation.warn(\r\n    'Blockly.clipboard.copy',\r\n    'v11',\r\n    'v12',\r\n    'myCopyable.toCopyData()',\r\n  );\r\n  return TEST_ONLY.copyInternal(toCopy);\r\n}\r\n\r\n/**\r\n * Private version of copy for stubbing in tests.\r\n */\r\nfunction copyInternal<T extends ICopyData>(toCopy: ICopyable<T>): T | null {\r\n  const data = toCopy.toCopyData();\r\n  stashedCopyData = data;\r\n  stashedWorkspace = (toCopy as any).workspace ?? null;\r\n  return data;\r\n}\r\n\r\n/**\r\n * Paste a pasteable element into the workspace.\r\n *\r\n * @param copyData The data to paste into the workspace.\r\n * @param workspace The workspace to paste the data into.\r\n * @param coordinate The location to paste the thing at.\r\n * @returns The pasted thing if the paste was successful, null otherwise.\r\n */\r\nexport function paste<T extends ICopyData>(\r\n  copyData: T,\r\n  workspace: WorkspaceSvg,\r\n  coordinate?: Coordinate,\r\n): ICopyable<T> | null;\r\n\r\n/**\r\n * Pastes the last copied ICopyable into the workspace.\r\n *\r\n * @returns the pasted thing if the paste was successful, null otherwise.\r\n */\r\nexport function paste(): ICopyable<ICopyData> | null;\r\n\r\n/**\r\n * Pastes the given data into the workspace, or the last copied ICopyable if\r\n * no data is passed.\r\n *\r\n * @param copyData The data to paste into the workspace.\r\n * @param workspace The workspace to paste the data into.\r\n * @param coordinate The location to paste the thing at.\r\n * @returns The pasted thing if the paste was successful, null otherwise.\r\n */\r\nexport function paste<T extends ICopyData>(\r\n  copyData?: T,\r\n  workspace?: WorkspaceSvg,\r\n  coordinate?: Coordinate,\r\n): ICopyable<ICopyData> | null {\r\n  if (!copyData || !workspace) {\r\n    if (!stashedCopyData || !stashedWorkspace) return null;\r\n    return pasteFromData(stashedCopyData, stashedWorkspace);\r\n  }\r\n  return pasteFromData(copyData, workspace, coordinate);\r\n}\r\n\r\n/**\r\n * Paste a pasteable element into the workspace.\r\n *\r\n * @param copyData The data to paste into the workspace.\r\n * @param workspace The workspace to paste the data into.\r\n * @param coordinate The location to paste the thing at.\r\n * @returns The pasted thing if the paste was successful, null otherwise.\r\n */\r\nfunction pasteFromData<T extends ICopyData>(\r\n  copyData: T,\r\n  workspace: WorkspaceSvg,\r\n  coordinate?: Coordinate,\r\n): ICopyable<T> | null {\r\n  workspace = workspace.getRootWorkspace() ?? workspace;\r\n  return (globalRegistry\r\n    .getObject(globalRegistry.Type.PASTER, copyData.paster, false)\r\n    ?.paste(copyData, workspace, coordinate) ?? null) as ICopyable<T> | null;\r\n}\r\n\r\n/**\r\n * Duplicate this copy-paste-able element.\r\n *\r\n * @param toDuplicate The element to be duplicated.\r\n * @returns The element that was duplicated, or null if the duplication failed.\r\n * @deprecated v11. Use\r\n *     `Blockly.clipboard.paste(myCopyable.toCopyData(), myWorkspace)` instead.\r\n *     To be removed v12.\r\n * @internal\r\n */\r\nexport function duplicate<\r\n  U extends ICopyData,\r\n  T extends ICopyable<U> & IHasWorkspace,\r\n>(toDuplicate: T): T | null {\r\n  deprecation.warn(\r\n    'Blockly.clipboard.duplicate',\r\n    'v11',\r\n    'v12',\r\n    'Blockly.clipboard.paste(myCopyable.toCopyData(), myWorkspace)',\r\n  );\r\n  return TEST_ONLY.duplicateInternal(toDuplicate);\r\n}\r\n\r\n/**\r\n * Private version of duplicate for stubbing in tests.\r\n */\r\nfunction duplicateInternal<\r\n  U extends ICopyData,\r\n  T extends ICopyable<U> & IHasWorkspace,\r\n>(toDuplicate: T): T | null {\r\n  const data = toDuplicate.toCopyData();\r\n  if (!data) return null;\r\n  return paste(data, toDuplicate.workspace) as T;\r\n}\r\n\r\ninterface IHasWorkspace {\r\n  workspace: WorkspaceSvg;\r\n}\r\n\r\nexport const TEST_ONLY = {\r\n  duplicateInternal,\r\n  copyInternal,\r\n};\r\n\r\nexport {BlockPaster, registry};\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.utils.aria\r\n\r\n/** ARIA states/properties prefix. */\r\nconst ARIA_PREFIX = 'aria-';\r\n\r\n/** ARIA role attribute. */\r\nconst ROLE_ATTRIBUTE = 'role';\r\n\r\n/**\r\n * ARIA role values.\r\n * Copied from Closure's goog.a11y.aria.Role\r\n */\r\nexport enum Role {\r\n  // ARIA role for an interactive control of tabular data.\r\n  GRID = 'grid',\r\n\r\n  // ARIA role for a cell in a grid.\r\n  GRIDCELL = 'gridcell',\r\n  // ARIA role for a group of related elements like tree item siblings.\r\n  GROUP = 'group',\r\n\r\n  // ARIA role for a listbox.\r\n  LISTBOX = 'listbox',\r\n\r\n  // ARIA role for a popup menu.\r\n  MENU = 'menu',\r\n\r\n  // ARIA role for menu item elements.\r\n  MENUITEM = 'menuitem',\r\n  // ARIA role for a checkbox box element inside a menu.\r\n  MENUITEMCHECKBOX = 'menuitemcheckbox',\r\n  // ARIA role for option items that are  children of combobox, listbox, menu,\r\n  // radiogroup, or tree elements.\r\n  OPTION = 'option',\r\n  // ARIA role for ignorable cosmetic elements with no semantic significance.\r\n  PRESENTATION = 'presentation',\r\n\r\n  // ARIA role for a row of cells in a grid.\r\n  ROW = 'row',\r\n  // ARIA role for a tree.\r\n  TREE = 'tree',\r\n\r\n  // ARIA role for a tree item that sometimes may be expanded or collapsed.\r\n  TREEITEM = 'treeitem',\r\n}\r\n\r\n/**\r\n * ARIA states and properties.\r\n * Copied from Closure's goog.a11y.aria.State\r\n */\r\nexport enum State {\r\n  // ARIA property for setting the currently active descendant of an element,\r\n  // for example the selected item in a list box. Value: ID of an element.\r\n  ACTIVEDESCENDANT = 'activedescendant',\r\n  // ARIA property defines the total number of columns in a table, grid, or\r\n  // treegrid.\r\n  // Value: integer.\r\n  COLCOUNT = 'colcount',\r\n  // ARIA state for a disabled item. Value: one of {true, false}.\r\n  DISABLED = 'disabled',\r\n\r\n  // ARIA state for setting whether the element like a tree node is expanded.\r\n  // Value: one of {true, false, undefined}.\r\n  EXPANDED = 'expanded',\r\n\r\n  // ARIA state indicating that the entered value does not conform. Value:\r\n  // one of {false, true, 'grammar', 'spelling'}\r\n  INVALID = 'invalid',\r\n\r\n  // ARIA property that provides a label to override any other text, value, or\r\n  // contents used to describe this element. Value: string.\r\n  LABEL = 'label',\r\n  // ARIA property for setting the element which labels another element.\r\n  // Value: space-separated IDs of elements.\r\n  LABELLEDBY = 'labelledby',\r\n\r\n  // ARIA property for setting the level of an element in the hierarchy.\r\n  // Value: integer.\r\n  LEVEL = 'level',\r\n  // ARIA property indicating if the element is horizontal or vertical.\r\n  // Value: one of {'vertical', 'horizontal'}.\r\n  ORIENTATION = 'orientation',\r\n\r\n  // ARIA property that defines an element's number of position in a list.\r\n  // Value: integer.\r\n  POSINSET = 'posinset',\r\n\r\n  // ARIA property defines the total number of rows in a table, grid, or\r\n  // treegrid.\r\n  // Value: integer.\r\n  ROWCOUNT = 'rowcount',\r\n\r\n  // ARIA state for setting the currently selected item in the list.\r\n  // Value: one of {true, false, undefined}.\r\n  SELECTED = 'selected',\r\n  // ARIA property defining the number of items in a list. Value: integer.\r\n  SETSIZE = 'setsize',\r\n\r\n  // ARIA property for slider maximum value. Value: number.\r\n  VALUEMAX = 'valuemax',\r\n\r\n  // ARIA property for slider minimum value. Value: number.\r\n  VALUEMIN = 'valuemin',\r\n}\r\n\r\n/**\r\n * Sets the role of an element.\r\n *\r\n * Similar to Closure's goog.a11y.aria\r\n *\r\n * @param element DOM node to set role of.\r\n * @param roleName Role name.\r\n */\r\nexport function setRole(element: Element, roleName: Role) {\r\n  element.setAttribute(ROLE_ATTRIBUTE, roleName);\r\n}\r\n\r\n/**\r\n * Sets the state or property of an element.\r\n * Copied from Closure's goog.a11y.aria\r\n *\r\n * @param element DOM node where we set state.\r\n * @param stateName State attribute being set.\r\n *     Automatically adds prefix 'aria-' to the state name if the attribute is\r\n * not an extra attribute.\r\n * @param value Value for the state attribute.\r\n */\r\nexport function setState(\r\n  element: Element,\r\n  stateName: State,\r\n  value: string | boolean | number | string[],\r\n) {\r\n  if (Array.isArray(value)) {\r\n    value = value.join(' ');\r\n  }\r\n  const attrStateName = ARIA_PREFIX + stateName;\r\n  element.setAttribute(attrStateName, `${value}`);\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2013 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.WidgetDiv\r\n\r\nimport * as common from './common.js';\r\nimport * as dom from './utils/dom.js';\r\nimport type {Field} from './field.js';\r\nimport type {Rect} from './utils/rect.js';\r\nimport type {Size} from './utils/size.js';\r\nimport type {WorkspaceSvg} from './workspace_svg.js';\r\n\r\n/** The object currently using this container. */\r\nlet owner: unknown = null;\r\n\r\n/** Optional cleanup function set by whichever object uses the widget. */\r\nlet dispose: (() => void) | null = null;\r\n\r\n/** A class name representing the current owner's workspace container. */\r\nconst containerClassName = 'blocklyWidgetDiv';\r\n\r\n/** A class name representing the current owner's workspace renderer. */\r\nlet rendererClassName = '';\r\n\r\n/** A class name representing the current owner's workspace theme. */\r\nlet themeClassName = '';\r\n\r\n/** The HTML container for popup overlays (e.g. editor widgets). */\r\nlet containerDiv: HTMLDivElement | null;\r\n\r\n/**\r\n * Returns the HTML container for editor widgets.\r\n *\r\n * @returns The editor widget container.\r\n */\r\nexport function getDiv(): HTMLDivElement | null {\r\n  return containerDiv;\r\n}\r\n\r\n/**\r\n * Allows unit tests to reset the div. Do not use outside of tests.\r\n *\r\n * @param newDiv The new value for the DIV field.\r\n * @internal\r\n */\r\nexport function testOnly_setDiv(newDiv: HTMLDivElement | null) {\r\n  containerDiv = newDiv;\r\n  if (newDiv === null) {\r\n    document.querySelector('.' + containerClassName)?.remove();\r\n  }\r\n}\r\n\r\n/**\r\n * Create the widget div and inject it onto the page.\r\n */\r\nexport function createDom() {\r\n  if (document.querySelector('.' + containerClassName)) {\r\n    return; // Already created.\r\n  }\r\n\r\n  containerDiv = document.createElement('div') as HTMLDivElement;\r\n  containerDiv.className = containerClassName;\r\n  const container = common.getParentContainer() || document.body;\r\n  container.appendChild(containerDiv);\r\n}\r\n\r\n/**\r\n * Initialize and display the widget div.  Close the old one if needed.\r\n *\r\n * @param newOwner The object that will be using this container.\r\n * @param rtl Right-to-left (true) or left-to-right (false).\r\n * @param newDispose Optional cleanup function to be run when the widget is\r\n *     closed.\r\n */\r\nexport function show(newOwner: unknown, rtl: boolean, newDispose: () => void) {\r\n  hide();\r\n  owner = newOwner;\r\n  dispose = newDispose;\r\n  const div = containerDiv;\r\n  if (!div) return;\r\n  div.style.direction = rtl ? 'rtl' : 'ltr';\r\n  div.style.display = 'block';\r\n  const mainWorkspace = common.getMainWorkspace() as WorkspaceSvg;\r\n  rendererClassName = mainWorkspace.getRenderer().getClassName();\r\n  themeClassName = mainWorkspace.getTheme().getClassName();\r\n  if (rendererClassName) {\r\n    dom.addClass(div, rendererClassName);\r\n  }\r\n  if (themeClassName) {\r\n    dom.addClass(div, themeClassName);\r\n  }\r\n}\r\n\r\n/**\r\n * Destroy the widget and hide the div.\r\n */\r\nexport function hide() {\r\n  if (!isVisible()) {\r\n    return;\r\n  }\r\n  owner = null;\r\n\r\n  const div = containerDiv;\r\n  if (!div) return;\r\n  div.style.display = 'none';\r\n  div.style.left = '';\r\n  div.style.top = '';\r\n  dispose && dispose();\r\n  dispose = null;\r\n  div.textContent = '';\r\n\r\n  if (rendererClassName) {\r\n    dom.removeClass(div, rendererClassName);\r\n    rendererClassName = '';\r\n  }\r\n  if (themeClassName) {\r\n    dom.removeClass(div, themeClassName);\r\n    themeClassName = '';\r\n  }\r\n  (common.getMainWorkspace() as WorkspaceSvg).markFocused();\r\n}\r\n\r\n/**\r\n * Is the container visible?\r\n *\r\n * @returns True if visible.\r\n */\r\nexport function isVisible(): boolean {\r\n  return !!owner;\r\n}\r\n\r\n/**\r\n * Destroy the widget and hide the div if it is being used by the specified\r\n * object.\r\n *\r\n * @param oldOwner The object that was using this container.\r\n */\r\nexport function hideIfOwner(oldOwner: unknown) {\r\n  if (owner === oldOwner) {\r\n    hide();\r\n  }\r\n}\r\n/**\r\n * Set the widget div's position and height.  This function does nothing clever:\r\n * it will not ensure that your widget div ends up in the visible window.\r\n *\r\n * @param x Horizontal location (window coordinates, not body).\r\n * @param y Vertical location (window coordinates, not body).\r\n * @param height The height of the widget div (pixels).\r\n */\r\nfunction positionInternal(x: number, y: number, height: number) {\r\n  containerDiv!.style.left = x + 'px';\r\n  containerDiv!.style.top = y + 'px';\r\n  containerDiv!.style.height = height + 'px';\r\n}\r\n\r\n/**\r\n * Position the widget div based on an anchor rectangle.\r\n * The widget should be placed adjacent to but not overlapping the anchor\r\n * rectangle.  The preferred position is directly below and aligned to the left\r\n * (LTR) or right (RTL) side of the anchor.\r\n *\r\n * @param viewportBBox The bounding rectangle of the current viewport, in window\r\n *     coordinates.\r\n * @param anchorBBox The bounding rectangle of the anchor, in window\r\n *     coordinates.\r\n * @param widgetSize The size of the widget that is inside the widget div, in\r\n *     window coordinates.\r\n * @param rtl Whether the workspace is in RTL mode.  This determines horizontal\r\n *     alignment.\r\n * @internal\r\n */\r\nexport function positionWithAnchor(\r\n  viewportBBox: Rect,\r\n  anchorBBox: Rect,\r\n  widgetSize: Size,\r\n  rtl: boolean,\r\n) {\r\n  const y = calculateY(viewportBBox, anchorBBox, widgetSize);\r\n  const x = calculateX(viewportBBox, anchorBBox, widgetSize, rtl);\r\n\r\n  if (y < 0) {\r\n    positionInternal(x, 0, widgetSize.height + y);\r\n  } else {\r\n    positionInternal(x, y, widgetSize.height);\r\n  }\r\n}\r\n\r\n/**\r\n * Calculate an x position (in window coordinates) such that the widget will not\r\n * be offscreen on the right or left.\r\n *\r\n * @param viewportBBox The bounding rectangle of the current viewport, in window\r\n *     coordinates.\r\n * @param anchorBBox The bounding rectangle of the anchor, in window\r\n *     coordinates.\r\n * @param widgetSize The dimensions of the widget inside the widget div.\r\n * @param rtl Whether the Blockly workspace is in RTL mode.\r\n * @returns A valid x-coordinate for the top left corner of the widget div, in\r\n *     window coordinates.\r\n */\r\nfunction calculateX(\r\n  viewportBBox: Rect,\r\n  anchorBBox: Rect,\r\n  widgetSize: Size,\r\n  rtl: boolean,\r\n): number {\r\n  if (rtl) {\r\n    // Try to align the right side of the field and the right side of widget.\r\n    const widgetLeft = anchorBBox.right - widgetSize.width;\r\n    // Don't go offscreen left.\r\n    const x = Math.max(widgetLeft, viewportBBox.left);\r\n    // But really don't go offscreen right:\r\n    return Math.min(x, viewportBBox.right - widgetSize.width);\r\n  } else {\r\n    // Try to align the left side of the field and the left side of widget.\r\n    // Don't go offscreen right.\r\n    const x = Math.min(anchorBBox.left, viewportBBox.right - widgetSize.width);\r\n    // But left is more important, because that's where the text is.\r\n    return Math.max(x, viewportBBox.left);\r\n  }\r\n}\r\n\r\n/**\r\n * Calculate a y position (in window coordinates) such that the widget will not\r\n * be offscreen on the top or bottom.\r\n *\r\n * @param viewportBBox The bounding rectangle of the current viewport, in window\r\n *     coordinates.\r\n * @param anchorBBox The bounding rectangle of the anchor, in window\r\n *     coordinates.\r\n * @param widgetSize The dimensions of the widget inside the widget div.\r\n * @returns A valid y-coordinate for the top left corner of the widget div, in\r\n *     window coordinates.\r\n */\r\nfunction calculateY(\r\n  viewportBBox: Rect,\r\n  anchorBBox: Rect,\r\n  widgetSize: Size,\r\n): number {\r\n  // Flip the widget vertically if off the bottom.\r\n  // The widget could go off the top of the window, but it would also go off\r\n  // the bottom.  The window is just too small.\r\n  if (anchorBBox.bottom + widgetSize.height >= viewportBBox.bottom) {\r\n    // The bottom of the widget is at the top of the field.\r\n    return anchorBBox.top - widgetSize.height;\r\n  } else {\r\n    // The top of the widget is at the bottom of the field.\r\n    return anchorBBox.bottom;\r\n  }\r\n}\r\n\r\n/**\r\n * Determine if the owner is a field for purposes of repositioning.\r\n * We can't simply check `instanceof Field` as that would introduce a circular\r\n * dependency.\r\n */\r\nfunction isRepositionable(item: any): item is Field {\r\n  return !!item?.repositionForWindowResize;\r\n}\r\n\r\n/**\r\n * Reposition the widget div if the owner of it says to.\r\n * If the owner isn't a field, just give up and hide it.\r\n */\r\nexport function repositionForWindowResize(): void {\r\n  if (!isRepositionable(owner) || !owner.repositionForWindowResize()) {\r\n    // If the owner is not a Field, or if the owner returns false from the\r\n    // reposition method, we should hide the widget div. Otherwise, we'll assume\r\n    // the owner handled any needed resize.\r\n    hide();\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2011 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.ContextMenu\r\n\r\nimport type {Block} from './block.js';\r\nimport type {BlockSvg} from './block_svg.js';\r\nimport * as browserEvents from './browser_events.js';\r\nimport * as clipboard from './clipboard.js';\r\nimport {config} from './config.js';\r\nimport * as dom from './utils/dom.js';\r\nimport type {\r\n  ContextMenuOption,\r\n  LegacyContextMenuOption,\r\n} from './contextmenu_registry.js';\r\nimport * as eventUtils from './events/utils.js';\r\nimport {Menu} from './menu.js';\r\nimport {MenuItem} from './menuitem.js';\r\nimport {Msg} from './msg.js';\r\nimport * as aria from './utils/aria.js';\r\nimport {Coordinate} from './utils/coordinate.js';\r\nimport {Rect} from './utils/rect.js';\r\nimport * as serializationBlocks from './serialization/blocks.js';\r\nimport * as svgMath from './utils/svg_math.js';\r\nimport * as WidgetDiv from './widgetdiv.js';\r\nimport {WorkspaceCommentSvg} from './workspace_comment_svg.js';\r\nimport type {WorkspaceSvg} from './workspace_svg.js';\r\nimport * as Xml from './xml.js';\r\n\r\n/**\r\n * Which block is the context menu attached to?\r\n */\r\nlet currentBlock: Block | null = null;\r\n\r\nconst dummyOwner = {};\r\n\r\n/**\r\n * Gets the block the context menu is currently attached to.\r\n *\r\n * @returns The block the context menu is attached to.\r\n */\r\nexport function getCurrentBlock(): Block | null {\r\n  return currentBlock;\r\n}\r\n\r\n/**\r\n * Sets the block the context menu is currently attached to.\r\n *\r\n * @param block The block the context menu is attached to.\r\n */\r\nexport function setCurrentBlock(block: Block | null) {\r\n  currentBlock = block;\r\n}\r\n\r\n/**\r\n * Menu object.\r\n */\r\nlet menu_: Menu | null = null;\r\n\r\n/**\r\n * Construct the menu based on the list of options and show the menu.\r\n *\r\n * @param e Mouse event.\r\n * @param options Array of menu options.\r\n * @param rtl True if RTL, false if LTR.\r\n */\r\nexport function show(\r\n  e: Event,\r\n  options: (ContextMenuOption | LegacyContextMenuOption)[],\r\n  rtl: boolean,\r\n) {\r\n  WidgetDiv.show(dummyOwner, rtl, dispose);\r\n  if (!options.length) {\r\n    hide();\r\n    return;\r\n  }\r\n  const menu = populate_(options, rtl);\r\n  menu_ = menu;\r\n\r\n  position_(menu, e, rtl);\r\n  // 1ms delay is required for focusing on context menus because some other\r\n  // mouse event is still waiting in the queue and clears focus.\r\n  setTimeout(function () {\r\n    menu.focus();\r\n  }, 1);\r\n  currentBlock = null; // May be set by Blockly.Block.\r\n}\r\n\r\n/**\r\n * Create the context menu object and populate it with the given options.\r\n *\r\n * @param options Array of menu options.\r\n * @param rtl True if RTL, false if LTR.\r\n * @returns The menu that will be shown on right click.\r\n */\r\nfunction populate_(\r\n  options: (ContextMenuOption | LegacyContextMenuOption)[],\r\n  rtl: boolean,\r\n): Menu {\r\n  /* Here's what one option object looks like:\r\n      {text: 'Make It So',\r\n       enabled: true,\r\n       callback: Blockly.MakeItSo}\r\n    */\r\n  const menu = new Menu();\r\n  menu.setRole(aria.Role.MENU);\r\n  for (let i = 0; i < options.length; i++) {\r\n    const option = options[i];\r\n    const menuItem = new MenuItem(option.text);\r\n    menuItem.setRightToLeft(rtl);\r\n    menuItem.setRole(aria.Role.MENUITEM);\r\n    menu.addChild(menuItem);\r\n    menuItem.setEnabled(option.enabled);\r\n    if (option.enabled) {\r\n      const actionHandler = function () {\r\n        hide();\r\n        requestAnimationFrame(() => {\r\n          setTimeout(() => {\r\n            // If .scope does not exist on the option, then the callback\r\n            // will not be expecting a scope parameter, so there should be\r\n            // no problems. Just assume it is a ContextMenuOption and we'll\r\n            // pass undefined if it's not.\r\n            option.callback((option as ContextMenuOption).scope);\r\n          }, 0);\r\n        });\r\n      };\r\n      menuItem.onAction(actionHandler, {});\r\n    }\r\n  }\r\n  return menu;\r\n}\r\n\r\n/**\r\n * Add the menu to the page and position it correctly.\r\n *\r\n * @param menu The menu to add and position.\r\n * @param e Mouse event for the right click that is making the context\r\n *     menu appear.\r\n * @param rtl True if RTL, false if LTR.\r\n */\r\nfunction position_(menu: Menu, e: Event, rtl: boolean) {\r\n  // Record windowSize and scrollOffset before adding menu.\r\n  const viewportBBox = svgMath.getViewportBBox();\r\n  const mouseEvent = e as MouseEvent;\r\n  // This one is just a point, but we'll pretend that it's a rect so we can use\r\n  // some helper functions.\r\n  const anchorBBox = new Rect(\r\n    mouseEvent.clientY + viewportBBox.top,\r\n    mouseEvent.clientY + viewportBBox.top,\r\n    mouseEvent.clientX + viewportBBox.left,\r\n    mouseEvent.clientX + viewportBBox.left,\r\n  );\r\n\r\n  createWidget_(menu);\r\n  const menuSize = menu.getSize();\r\n\r\n  if (rtl) {\r\n    anchorBBox.left += menuSize.width;\r\n    anchorBBox.right += menuSize.width;\r\n    viewportBBox.left += menuSize.width;\r\n    viewportBBox.right += menuSize.width;\r\n  }\r\n\r\n  WidgetDiv.positionWithAnchor(viewportBBox, anchorBBox, menuSize, rtl);\r\n  // Calling menuDom.focus() has to wait until after the menu has been placed\r\n  // correctly.  Otherwise it will cause a page scroll to get the misplaced menu\r\n  // in view.  See issue #1329.\r\n  menu.focus();\r\n}\r\n\r\n/**\r\n * Create and render the menu widget inside Blockly's widget div.\r\n *\r\n * @param menu The menu to add to the widget div.\r\n */\r\nfunction createWidget_(menu: Menu) {\r\n  const div = WidgetDiv.getDiv();\r\n  if (!div) {\r\n    throw Error('Attempting to create a context menu when widget div is null');\r\n  }\r\n  const menuDom = menu.render(div);\r\n  dom.addClass(menuDom, 'blocklyContextMenu');\r\n  // Prevent system context menu when right-clicking a Blockly context menu.\r\n  browserEvents.conditionalBind(\r\n    menuDom as EventTarget,\r\n    'contextmenu',\r\n    null,\r\n    haltPropagation,\r\n  );\r\n  // Focus only after the initial render to avoid issue #1329.\r\n  menu.focus();\r\n}\r\n/**\r\n * Halts the propagation of the event without doing anything else.\r\n *\r\n * @param e An event.\r\n */\r\nfunction haltPropagation(e: Event) {\r\n  // This event has been handled.  No need to bubble up to the document.\r\n  e.preventDefault();\r\n  e.stopPropagation();\r\n}\r\n\r\n/**\r\n * Hide the context menu.\r\n */\r\nexport function hide() {\r\n  WidgetDiv.hideIfOwner(dummyOwner);\r\n  currentBlock = null;\r\n}\r\n\r\n/**\r\n * Dispose of the menu.\r\n */\r\nexport function dispose() {\r\n  if (menu_) {\r\n    menu_.dispose();\r\n    menu_ = null;\r\n  }\r\n}\r\n\r\n/**\r\n * Create a callback function that creates and configures a block,\r\n *   then places the new block next to the original and returns it.\r\n *\r\n * @param block Original block.\r\n * @param state XML or JSON object representation of the new block.\r\n * @returns Function that creates a block.\r\n */\r\nexport function callbackFactory(\r\n  block: Block,\r\n  state: Element | serializationBlocks.State,\r\n): () => BlockSvg {\r\n  return () => {\r\n    eventUtils.disable();\r\n    let newBlock: BlockSvg;\r\n    try {\r\n      if (state instanceof Element) {\r\n        newBlock = Xml.domToBlockInternal(state, block.workspace!) as BlockSvg;\r\n      } else {\r\n        newBlock = serializationBlocks.appendInternal(\r\n          state,\r\n          block.workspace,\r\n        ) as BlockSvg;\r\n      }\r\n      // Move the new block next to the old block.\r\n      const xy = block.getRelativeToSurfaceXY();\r\n      if (block.RTL) {\r\n        xy.x -= config.snapRadius;\r\n      } else {\r\n        xy.x += config.snapRadius;\r\n      }\r\n      xy.y += config.snapRadius * 2;\r\n      newBlock.moveBy(xy.x, xy.y);\r\n    } finally {\r\n      eventUtils.enable();\r\n    }\r\n    if (eventUtils.isEnabled() && !newBlock.isShadow()) {\r\n      eventUtils.fire(new (eventUtils.get(eventUtils.BLOCK_CREATE))(newBlock));\r\n    }\r\n    newBlock.select();\r\n    return newBlock;\r\n  };\r\n}\r\n\r\n// Helper functions for creating context menu options.\r\n\r\n/**\r\n * Make a context menu option for deleting the current workspace comment.\r\n *\r\n * @param comment The workspace comment where the\r\n *     right-click originated.\r\n * @returns A menu option,\r\n *     containing text, enabled, and a callback.\r\n * @internal\r\n */\r\nexport function commentDeleteOption(\r\n  comment: WorkspaceCommentSvg,\r\n): LegacyContextMenuOption {\r\n  const deleteOption = {\r\n    text: Msg['REMOVE_COMMENT'],\r\n    enabled: true,\r\n    callback: function () {\r\n      eventUtils.setGroup(true);\r\n      comment.dispose();\r\n      eventUtils.setGroup(false);\r\n    },\r\n  };\r\n  return deleteOption;\r\n}\r\n\r\n/**\r\n * Make a context menu option for duplicating the current workspace comment.\r\n *\r\n * @param comment The workspace comment where the\r\n *     right-click originated.\r\n * @returns A menu option,\r\n *     containing text, enabled, and a callback.\r\n * @internal\r\n */\r\nexport function commentDuplicateOption(\r\n  comment: WorkspaceCommentSvg,\r\n): LegacyContextMenuOption {\r\n  const duplicateOption = {\r\n    text: Msg['DUPLICATE_COMMENT'],\r\n    enabled: true,\r\n    callback: function () {\r\n      const data = comment.toCopyData();\r\n      if (!data) return;\r\n      clipboard.paste(data, comment.workspace);\r\n    },\r\n  };\r\n  return duplicateOption;\r\n}\r\n\r\n/**\r\n * Make a context menu option for adding a comment on the workspace.\r\n *\r\n * @param ws The workspace where the right-click\r\n *     originated.\r\n * @param e The right-click mouse event.\r\n * @returns A menu option, containing text, enabled, and a callback.\r\n *     comments are not bundled in.\r\n * @internal\r\n */\r\nexport function workspaceCommentOption(\r\n  ws: WorkspaceSvg,\r\n  e: Event,\r\n): ContextMenuOption {\r\n  /**\r\n   * Helper function to create and position a comment correctly based on the\r\n   * location of the mouse event.\r\n   */\r\n  function addWsComment() {\r\n    const comment = new WorkspaceCommentSvg(\r\n      ws,\r\n      Msg['WORKSPACE_COMMENT_DEFAULT_TEXT'],\r\n      WorkspaceCommentSvg.DEFAULT_SIZE,\r\n      WorkspaceCommentSvg.DEFAULT_SIZE,\r\n    );\r\n\r\n    const injectionDiv = ws.getInjectionDiv();\r\n    // Bounding rect coordinates are in client coordinates, meaning that they\r\n    // are in pixels relative to the upper left corner of the visible browser\r\n    // window.  These coordinates change when you scroll the browser window.\r\n    const boundingRect = injectionDiv.getBoundingClientRect();\r\n\r\n    // The client coordinates offset by the injection div's upper left corner.\r\n    const mouseEvent = e as MouseEvent;\r\n    const clientOffsetPixels = new Coordinate(\r\n      mouseEvent.clientX - boundingRect.left,\r\n      mouseEvent.clientY - boundingRect.top,\r\n    );\r\n\r\n    // The offset in pixels between the main workspace's origin and the upper\r\n    // left corner of the injection div.\r\n    const mainOffsetPixels = ws.getOriginOffsetInPixels();\r\n\r\n    // The position of the new comment in pixels relative to the origin of the\r\n    // main workspace.\r\n    const finalOffset = Coordinate.difference(\r\n      clientOffsetPixels,\r\n      mainOffsetPixels,\r\n    );\r\n    // The position of the new comment in main workspace coordinates.\r\n    finalOffset.scale(1 / ws.scale);\r\n\r\n    const commentX = finalOffset.x;\r\n    const commentY = finalOffset.y;\r\n    comment.moveBy(commentX, commentY);\r\n    if (ws.rendered) {\r\n      comment.initSvg();\r\n      comment.render();\r\n      comment.select();\r\n    }\r\n  }\r\n\r\n  const wsCommentOption = {\r\n    enabled: true,\r\n  } as ContextMenuOption;\r\n  wsCommentOption.text = Msg['ADD_COMMENT'];\r\n  wsCommentOption.callback = function () {\r\n    addWsComment();\r\n  };\r\n  return wsCommentOption;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.utils.math\r\n\r\n/**\r\n * Converts degrees to radians.\r\n * Copied from Closure's goog.math.toRadians.\r\n *\r\n * @param angleDegrees Angle in degrees.\r\n * @returns Angle in radians.\r\n */\r\nexport function toRadians(angleDegrees: number): number {\r\n  return (angleDegrees * Math.PI) / 180;\r\n}\r\n\r\n/**\r\n * Converts radians to degrees.\r\n * Copied from Closure's goog.math.toDegrees.\r\n *\r\n * @param angleRadians Angle in radians.\r\n * @returns Angle in degrees.\r\n */\r\nexport function toDegrees(angleRadians: number): number {\r\n  return (angleRadians * 180) / Math.PI;\r\n}\r\n\r\n/**\r\n * Clamp the provided number between the lower bound and the upper bound.\r\n *\r\n * @param lowerBound The desired lower bound.\r\n * @param number The number to clamp.\r\n * @param upperBound The desired upper bound.\r\n * @returns The clamped number.\r\n */\r\nexport function clamp(\r\n  lowerBound: number,\r\n  number: number,\r\n  upperBound: number,\r\n): number {\r\n  if (upperBound < lowerBound) {\r\n    const temp = upperBound;\r\n    upperBound = lowerBound;\r\n    lowerBound = temp;\r\n  }\r\n  return Math.max(lowerBound, Math.min(number, upperBound));\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2016 Massachusetts Institute of Technology\r\n * All rights reserved.\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * A div that floats on top of the workspace, for drop-down menus.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.dropDownDiv\r\n\r\nimport type {BlockSvg} from './block_svg.js';\r\nimport * as common from './common.js';\r\nimport * as dom from './utils/dom.js';\r\nimport type {Field} from './field.js';\r\nimport * as math from './utils/math.js';\r\nimport {Rect} from './utils/rect.js';\r\nimport type {Size} from './utils/size.js';\r\nimport * as style from './utils/style.js';\r\nimport type {WorkspaceSvg} from './workspace_svg.js';\r\n\r\n/**\r\n * Arrow size in px. Should match the value in CSS\r\n * (need to position pre-render).\r\n */\r\nexport const ARROW_SIZE = 16;\r\n\r\n/**\r\n * Drop-down border size in px. Should match the value in CSS (need to position\r\n * the arrow).\r\n */\r\nexport const BORDER_SIZE = 1;\r\n\r\n/**\r\n * Amount the arrow must be kept away from the edges of the main drop-down div,\r\n * in px.\r\n */\r\nexport const ARROW_HORIZONTAL_PADDING = 12;\r\n\r\n/** Amount drop-downs should be padded away from the source, in px. */\r\nexport const PADDING_Y = 16;\r\n\r\n/** Length of animations in seconds. */\r\nexport const ANIMATION_TIME = 0.25;\r\n\r\n/**\r\n * Timer for animation out, to be cleared if we need to immediately hide\r\n * without disrupting new shows.\r\n */\r\nlet animateOutTimer: ReturnType<typeof setTimeout> | null = null;\r\n\r\n/** Callback for when the drop-down is hidden. */\r\nlet onHide: Function | null = null;\r\n\r\n/** A class name representing the current owner's workspace renderer. */\r\nlet renderedClassName = '';\r\n\r\n/** A class name representing the current owner's workspace theme. */\r\nlet themeClassName = '';\r\n\r\n/** The content element. */\r\nlet div: HTMLDivElement;\r\n\r\n/** The content element. */\r\nlet content: HTMLDivElement;\r\n\r\n/** The arrow element. */\r\nlet arrow: HTMLDivElement;\r\n\r\n/**\r\n * Drop-downs will appear within the bounds of this element if possible.\r\n * Set in setBoundsElement.\r\n */\r\nlet boundsElement: Element | null = null;\r\n\r\n/** The object currently using the drop-down. */\r\nlet owner: Field | null = null;\r\n\r\n/** Whether the dropdown was positioned to a field or the source block. */\r\nlet positionToField: boolean | null = null;\r\n\r\n/**\r\n * Dropdown bounds info object used to encapsulate sizing information about a\r\n * bounding element (bounding box and width/height).\r\n */\r\nexport interface BoundsInfo {\r\n  top: number;\r\n  left: number;\r\n  bottom: number;\r\n  right: number;\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\n/** Dropdown position metrics. */\r\nexport interface PositionMetrics {\r\n  initialX: number;\r\n  initialY: number;\r\n  finalX: number;\r\n  finalY: number;\r\n  arrowX: number | null;\r\n  arrowY: number | null;\r\n  arrowAtTop: boolean | null;\r\n  arrowVisible: boolean;\r\n}\r\n\r\n/**\r\n * Create and insert the DOM element for this div.\r\n *\r\n * @internal\r\n */\r\nexport function createDom() {\r\n  if (document.querySelector('.blocklyDropDownDiv')) {\r\n    return; // Already created.\r\n  }\r\n  div = document.createElement('div');\r\n  div.className = 'blocklyDropDownDiv';\r\n  const parentDiv = common.getParentContainer() || document.body;\r\n  parentDiv.appendChild(div);\r\n\r\n  content = document.createElement('div');\r\n  content.className = 'blocklyDropDownContent';\r\n  div.appendChild(content);\r\n\r\n  arrow = document.createElement('div');\r\n  arrow.className = 'blocklyDropDownArrow';\r\n  div.appendChild(arrow);\r\n\r\n  div.style.opacity = '0';\r\n  // Transition animation for transform: translate() and opacity.\r\n  div.style.transition =\r\n    'transform ' + ANIMATION_TIME + 's, ' + 'opacity ' + ANIMATION_TIME + 's';\r\n\r\n  // Handle focusin/out events to add a visual indicator when\r\n  // a child is focused or blurred.\r\n  div.addEventListener('focusin', function () {\r\n    dom.addClass(div, 'blocklyFocused');\r\n  });\r\n  div.addEventListener('focusout', function () {\r\n    dom.removeClass(div, 'blocklyFocused');\r\n  });\r\n}\r\n\r\n/**\r\n * Set an element to maintain bounds within. Drop-downs will appear\r\n * within the box of this element if possible.\r\n *\r\n * @param boundsElem Element to bind drop-down to.\r\n */\r\nexport function setBoundsElement(boundsElem: Element | null) {\r\n  boundsElement = boundsElem;\r\n}\r\n\r\n/**\r\n * @returns The field that currently owns this, or null.\r\n */\r\nexport function getOwner(): Field | null {\r\n  return owner;\r\n}\r\n\r\n/**\r\n * Provide the div for inserting content into the drop-down.\r\n *\r\n * @returns Div to populate with content.\r\n */\r\nexport function getContentDiv(): Element {\r\n  return content;\r\n}\r\n\r\n/** Clear the content of the drop-down. */\r\nexport function clearContent() {\r\n  content.textContent = '';\r\n  content.style.width = '';\r\n}\r\n\r\n/**\r\n * Set the colour for the drop-down.\r\n *\r\n * @param backgroundColour Any CSS colour for the background.\r\n * @param borderColour Any CSS colour for the border.\r\n */\r\nexport function setColour(backgroundColour: string, borderColour: string) {\r\n  div.style.backgroundColor = backgroundColour;\r\n  div.style.borderColor = borderColour;\r\n}\r\n\r\n/**\r\n * Shortcut to show and place the drop-down with positioning determined\r\n * by a particular block. The primary position will be below the block,\r\n * and the secondary position above the block. Drop-down will be\r\n * constrained to the block's workspace.\r\n *\r\n * @param field The field showing the drop-down.\r\n * @param block Block to position the drop-down around.\r\n * @param opt_onHide Optional callback for when the drop-down is hidden.\r\n * @param opt_secondaryYOffset Optional Y offset for above-block positioning.\r\n * @returns True if the menu rendered below block; false if above.\r\n */\r\nexport function showPositionedByBlock<T>(\r\n  field: Field<T>,\r\n  block: BlockSvg,\r\n  opt_onHide?: Function,\r\n  opt_secondaryYOffset?: number,\r\n): boolean {\r\n  return showPositionedByRect(\r\n    getScaledBboxOfBlock(block),\r\n    field as Field,\r\n    opt_onHide,\r\n    opt_secondaryYOffset,\r\n  );\r\n}\r\n\r\n/**\r\n * Shortcut to show and place the drop-down with positioning determined\r\n * by a particular field. The primary position will be below the field,\r\n * and the secondary position above the field. Drop-down will be\r\n * constrained to the block's workspace.\r\n *\r\n * @param field The field to position the dropdown against.\r\n * @param opt_onHide Optional callback for when the drop-down is hidden.\r\n * @param opt_secondaryYOffset Optional Y offset for above-block positioning.\r\n * @returns True if the menu rendered below block; false if above.\r\n */\r\nexport function showPositionedByField<T>(\r\n  field: Field<T>,\r\n  opt_onHide?: Function,\r\n  opt_secondaryYOffset?: number,\r\n): boolean {\r\n  positionToField = true;\r\n  return showPositionedByRect(\r\n    getScaledBboxOfField(field as Field),\r\n    field as Field,\r\n    opt_onHide,\r\n    opt_secondaryYOffset,\r\n  );\r\n}\r\n/**\r\n * Get the scaled bounding box of a block.\r\n *\r\n * @param block The block.\r\n * @returns The scaled bounding box of the block.\r\n */\r\nfunction getScaledBboxOfBlock(block: BlockSvg): Rect {\r\n  const blockSvg = block.getSvgRoot();\r\n  const scale = block.workspace.scale;\r\n  const scaledHeight = block.height * scale;\r\n  const scaledWidth = block.width * scale;\r\n  const xy = style.getPageOffset(blockSvg);\r\n  return new Rect(xy.y, xy.y + scaledHeight, xy.x, xy.x + scaledWidth);\r\n}\r\n\r\n/**\r\n * Get the scaled bounding box of a field.\r\n *\r\n * @param field The field.\r\n * @returns The scaled bounding box of the field.\r\n */\r\nfunction getScaledBboxOfField(field: Field): Rect {\r\n  const bBox = field.getScaledBBox();\r\n  return new Rect(bBox.top, bBox.bottom, bBox.left, bBox.right);\r\n}\r\n\r\n/**\r\n * Helper method to show and place the drop-down with positioning determined\r\n * by a scaled bounding box.  The primary position will be below the rect,\r\n * and the secondary position above the rect. Drop-down will be constrained to\r\n * the block's workspace.\r\n *\r\n * @param bBox The scaled bounding box.\r\n * @param field The field to position the dropdown against.\r\n * @param opt_onHide Optional callback for when the drop-down is hidden.\r\n * @param opt_secondaryYOffset Optional Y offset for above-block positioning.\r\n * @returns True if the menu rendered below block; false if above.\r\n */\r\nfunction showPositionedByRect(\r\n  bBox: Rect,\r\n  field: Field,\r\n  opt_onHide?: Function,\r\n  opt_secondaryYOffset?: number,\r\n): boolean {\r\n  // If we can fit it, render below the block.\r\n  const primaryX = bBox.left + (bBox.right - bBox.left) / 2;\r\n  const primaryY = bBox.bottom;\r\n  // If we can't fit it, render above the entire parent block.\r\n  const secondaryX = primaryX;\r\n  let secondaryY = bBox.top;\r\n  if (opt_secondaryYOffset) {\r\n    secondaryY += opt_secondaryYOffset;\r\n  }\r\n  const sourceBlock = field.getSourceBlock() as BlockSvg;\r\n  // Set bounds to main workspace; show the drop-down.\r\n  let workspace = sourceBlock.workspace;\r\n  while (workspace.options.parentWorkspace) {\r\n    workspace = workspace.options.parentWorkspace;\r\n  }\r\n  setBoundsElement(workspace.getParentSvg().parentNode as Element | null);\r\n  return show(\r\n    field,\r\n    sourceBlock.RTL,\r\n    primaryX,\r\n    primaryY,\r\n    secondaryX,\r\n    secondaryY,\r\n    opt_onHide,\r\n  );\r\n}\r\n\r\n/**\r\n * Show and place the drop-down.\r\n * The drop-down is placed with an absolute \"origin point\" (x, y) - i.e.,\r\n * the arrow will point at this origin and box will positioned below or above\r\n * it.  If we can maintain the container bounds at the primary point, the arrow\r\n * will point there, and the container will be positioned below it.\r\n * If we can't maintain the container bounds at the primary point, fall-back to\r\n * the secondary point and position above.\r\n *\r\n * @param newOwner The object showing the drop-down\r\n * @param rtl Right-to-left (true) or left-to-right (false).\r\n * @param primaryX Desired origin point x, in absolute px.\r\n * @param primaryY Desired origin point y, in absolute px.\r\n * @param secondaryX Secondary/alternative origin point x, in absolute px.\r\n * @param secondaryY Secondary/alternative origin point y, in absolute px.\r\n * @param opt_onHide Optional callback for when the drop-down is hidden.\r\n * @returns True if the menu rendered at the primary origin point.\r\n * @internal\r\n */\r\nexport function show<T>(\r\n  newOwner: Field<T>,\r\n  rtl: boolean,\r\n  primaryX: number,\r\n  primaryY: number,\r\n  secondaryX: number,\r\n  secondaryY: number,\r\n  opt_onHide?: Function,\r\n): boolean {\r\n  owner = newOwner as Field;\r\n  onHide = opt_onHide || null;\r\n  // Set direction.\r\n  div.style.direction = rtl ? 'rtl' : 'ltr';\r\n\r\n  const mainWorkspace = common.getMainWorkspace() as WorkspaceSvg;\r\n  renderedClassName = mainWorkspace.getRenderer().getClassName();\r\n  themeClassName = mainWorkspace.getTheme().getClassName();\r\n  if (renderedClassName) {\r\n    dom.addClass(div, renderedClassName);\r\n  }\r\n  if (themeClassName) {\r\n    dom.addClass(div, themeClassName);\r\n  }\r\n\r\n  // When we change `translate` multiple times in close succession,\r\n  // Chrome may choose to wait and apply them all at once.\r\n  // Since we want the translation to initial X, Y to be immediate,\r\n  // and the translation to final X, Y to be animated,\r\n  // we saw problems where both would be applied after animation was turned on,\r\n  // making the dropdown appear to fly in from (0, 0).\r\n  // Using both `left`, `top` for the initial translation and then `translate`\r\n  // for the animated transition to final X, Y is a workaround.\r\n  return positionInternal(primaryX, primaryY, secondaryX, secondaryY);\r\n}\r\n\r\nconst internal = {\r\n  /**\r\n   * Get sizing info about the bounding element.\r\n   *\r\n   * @returns An object containing size information about the bounding element\r\n   *     (bounding box and width/height).\r\n   */\r\n  getBoundsInfo: function (): BoundsInfo {\r\n    const boundPosition = style.getPageOffset(boundsElement as Element);\r\n    const boundSize = style.getSize(boundsElement as Element);\r\n\r\n    return {\r\n      left: boundPosition.x,\r\n      right: boundPosition.x + boundSize.width,\r\n      top: boundPosition.y,\r\n      bottom: boundPosition.y + boundSize.height,\r\n      width: boundSize.width,\r\n      height: boundSize.height,\r\n    };\r\n  },\r\n\r\n  /**\r\n   * Helper to position the drop-down and the arrow, maintaining bounds.\r\n   * See explanation of origin points in show.\r\n   *\r\n   * @param primaryX Desired origin point x, in absolute px.\r\n   * @param primaryY Desired origin point y, in absolute px.\r\n   * @param secondaryX Secondary/alternative origin point x, in absolute px.\r\n   * @param secondaryY Secondary/alternative origin point y, in absolute px.\r\n   * @returns Various final metrics, including rendered positions for drop-down\r\n   *     and arrow.\r\n   */\r\n  getPositionMetrics: function (\r\n    primaryX: number,\r\n    primaryY: number,\r\n    secondaryX: number,\r\n    secondaryY: number,\r\n  ): PositionMetrics {\r\n    const boundsInfo = internal.getBoundsInfo();\r\n    const divSize = style.getSize(div as Element);\r\n\r\n    // Can we fit in-bounds below the target?\r\n    if (primaryY + divSize.height < boundsInfo.bottom) {\r\n      return getPositionBelowMetrics(primaryX, primaryY, boundsInfo, divSize);\r\n    }\r\n    // Can we fit in-bounds above the target?\r\n    if (secondaryY - divSize.height > boundsInfo.top) {\r\n      return getPositionAboveMetrics(\r\n        secondaryX,\r\n        secondaryY,\r\n        boundsInfo,\r\n        divSize,\r\n      );\r\n    }\r\n    // Can we fit outside the workspace bounds (but inside the window)\r\n    // below?\r\n    if (primaryY + divSize.height < document.documentElement.clientHeight) {\r\n      return getPositionBelowMetrics(primaryX, primaryY, boundsInfo, divSize);\r\n    }\r\n    // Can we fit outside the workspace bounds (but inside the window)\r\n    // above?\r\n    if (secondaryY - divSize.height > document.documentElement.clientTop) {\r\n      return getPositionAboveMetrics(\r\n        secondaryX,\r\n        secondaryY,\r\n        boundsInfo,\r\n        divSize,\r\n      );\r\n    }\r\n\r\n    // Last resort, render at top of page.\r\n    return getPositionTopOfPageMetrics(primaryX, boundsInfo, divSize);\r\n  },\r\n};\r\n\r\n/**\r\n * Get the metrics for positioning the div below the source.\r\n *\r\n * @param primaryX Desired origin point x, in absolute px.\r\n * @param primaryY Desired origin point y, in absolute px.\r\n * @param boundsInfo An object containing size information about the bounding\r\n *     element (bounding box and width/height).\r\n * @param divSize An object containing information about the size of the\r\n *     DropDownDiv (width & height).\r\n * @returns Various final metrics, including rendered positions for drop-down\r\n *     and arrow.\r\n */\r\nfunction getPositionBelowMetrics(\r\n  primaryX: number,\r\n  primaryY: number,\r\n  boundsInfo: BoundsInfo,\r\n  divSize: Size,\r\n): PositionMetrics {\r\n  const xCoords = getPositionX(\r\n    primaryX,\r\n    boundsInfo.left,\r\n    boundsInfo.right,\r\n    divSize.width,\r\n  );\r\n\r\n  const arrowY = -(ARROW_SIZE / 2 + BORDER_SIZE);\r\n  const finalY = primaryY + PADDING_Y;\r\n\r\n  return {\r\n    initialX: xCoords.divX,\r\n    initialY: primaryY,\r\n    finalX: xCoords.divX, // X position remains constant during animation.\r\n    finalY,\r\n    arrowX: xCoords.arrowX,\r\n    arrowY,\r\n    arrowAtTop: true,\r\n    arrowVisible: true,\r\n  };\r\n}\r\n\r\n/**\r\n * Get the metrics for positioning the div above the source.\r\n *\r\n * @param secondaryX Secondary/alternative origin point x, in absolute px.\r\n * @param secondaryY Secondary/alternative origin point y, in absolute px.\r\n * @param boundsInfo An object containing size information about the bounding\r\n *     element (bounding box and width/height).\r\n * @param divSize An object containing information about the size of the\r\n *     DropDownDiv (width & height).\r\n * @returns Various final metrics, including rendered positions for drop-down\r\n *     and arrow.\r\n */\r\nfunction getPositionAboveMetrics(\r\n  secondaryX: number,\r\n  secondaryY: number,\r\n  boundsInfo: BoundsInfo,\r\n  divSize: Size,\r\n): PositionMetrics {\r\n  const xCoords = getPositionX(\r\n    secondaryX,\r\n    boundsInfo.left,\r\n    boundsInfo.right,\r\n    divSize.width,\r\n  );\r\n\r\n  const arrowY = divSize.height - BORDER_SIZE * 2 - ARROW_SIZE / 2;\r\n  const finalY = secondaryY - divSize.height - PADDING_Y;\r\n  const initialY = secondaryY - divSize.height; // No padding on Y.\r\n\r\n  return {\r\n    initialX: xCoords.divX,\r\n    initialY,\r\n    finalX: xCoords.divX, // X position remains constant during animation.\r\n    finalY,\r\n    arrowX: xCoords.arrowX,\r\n    arrowY,\r\n    arrowAtTop: false,\r\n    arrowVisible: true,\r\n  };\r\n}\r\n\r\n/**\r\n * Get the metrics for positioning the div at the top of the page.\r\n *\r\n * @param sourceX Desired origin point x, in absolute px.\r\n * @param boundsInfo An object containing size information about the bounding\r\n *     element (bounding box and width/height).\r\n * @param divSize An object containing information about the size of the\r\n *     DropDownDiv (width & height).\r\n * @returns Various final metrics, including rendered positions for drop-down\r\n *     and arrow.\r\n */\r\nfunction getPositionTopOfPageMetrics(\r\n  sourceX: number,\r\n  boundsInfo: BoundsInfo,\r\n  divSize: Size,\r\n): PositionMetrics {\r\n  const xCoords = getPositionX(\r\n    sourceX,\r\n    boundsInfo.left,\r\n    boundsInfo.right,\r\n    divSize.width,\r\n  );\r\n\r\n  // No need to provide arrow-specific information because it won't be visible.\r\n  return {\r\n    initialX: xCoords.divX,\r\n    initialY: 0,\r\n    finalX: xCoords.divX, // X position remains constant during animation.\r\n    finalY: 0, // Y position remains constant during animation.\r\n    arrowAtTop: null,\r\n    arrowX: null,\r\n    arrowY: null,\r\n    arrowVisible: false,\r\n  };\r\n}\r\n\r\n/**\r\n * Get the x positions for the left side of the DropDownDiv and the arrow,\r\n * accounting for the bounds of the workspace.\r\n *\r\n * @param sourceX Desired origin point x, in absolute px.\r\n * @param boundsLeft The left edge of the bounding element, in absolute px.\r\n * @param boundsRight The right edge of the bounding element, in absolute px.\r\n * @param divWidth The width of the div in px.\r\n * @returns An object containing metrics for the x positions of the left side of\r\n *     the DropDownDiv and the arrow.\r\n * @internal\r\n */\r\nexport function getPositionX(\r\n  sourceX: number,\r\n  boundsLeft: number,\r\n  boundsRight: number,\r\n  divWidth: number,\r\n): {divX: number; arrowX: number} {\r\n  let divX = sourceX;\r\n  // Offset the topLeft coord so that the dropdowndiv is centered.\r\n  divX -= divWidth / 2;\r\n  // Fit the dropdowndiv within the bounds of the workspace.\r\n  divX = math.clamp(boundsLeft, divX, boundsRight - divWidth);\r\n\r\n  let arrowX = sourceX;\r\n  // Offset the arrow coord so that the arrow is centered.\r\n  arrowX -= ARROW_SIZE / 2;\r\n  // Convert the arrow position to be relative to the top left of the div.\r\n  let relativeArrowX = arrowX - divX;\r\n  const horizPadding = ARROW_HORIZONTAL_PADDING;\r\n  // Clamp the arrow position so that it stays attached to the dropdowndiv.\r\n  relativeArrowX = math.clamp(\r\n    horizPadding,\r\n    relativeArrowX,\r\n    divWidth - horizPadding - ARROW_SIZE,\r\n  );\r\n\r\n  return {arrowX: relativeArrowX, divX};\r\n}\r\n\r\n/**\r\n * Is the container visible?\r\n *\r\n * @returns True if visible.\r\n */\r\nexport function isVisible(): boolean {\r\n  return !!owner;\r\n}\r\n\r\n/**\r\n * Hide the menu only if it is owned by the provided object.\r\n *\r\n * @param divOwner Object which must be owning the drop-down to hide.\r\n * @param opt_withoutAnimation True if we should hide the dropdown without\r\n *     animating.\r\n * @returns True if hidden.\r\n */\r\nexport function hideIfOwner<T>(\r\n  divOwner: Field<T>,\r\n  opt_withoutAnimation?: boolean,\r\n): boolean {\r\n  if (owner === divOwner) {\r\n    if (opt_withoutAnimation) {\r\n      hideWithoutAnimation();\r\n    } else {\r\n      hide();\r\n    }\r\n    return true;\r\n  }\r\n  return false;\r\n}\r\n\r\n/** Hide the menu, triggering animation. */\r\nexport function hide() {\r\n  // Start the animation by setting the translation and fading out.\r\n  // Reset to (initialX, initialY) - i.e., no translation.\r\n  div.style.transform = 'translate(0, 0)';\r\n  div.style.opacity = '0';\r\n  // Finish animation - reset all values to default.\r\n  animateOutTimer = setTimeout(function () {\r\n    hideWithoutAnimation();\r\n  }, ANIMATION_TIME * 1000);\r\n  if (onHide) {\r\n    onHide();\r\n    onHide = null;\r\n  }\r\n}\r\n\r\n/** Hide the menu, without animation. */\r\nexport function hideWithoutAnimation() {\r\n  if (!isVisible()) {\r\n    return;\r\n  }\r\n  if (animateOutTimer) {\r\n    clearTimeout(animateOutTimer);\r\n  }\r\n\r\n  // Reset style properties in case this gets called directly\r\n  // instead of hide() - see discussion on #2551.\r\n  div.style.transform = '';\r\n  div.style.left = '';\r\n  div.style.top = '';\r\n  div.style.opacity = '0';\r\n  div.style.display = 'none';\r\n  div.style.backgroundColor = '';\r\n  div.style.borderColor = '';\r\n\r\n  if (onHide) {\r\n    onHide();\r\n    onHide = null;\r\n  }\r\n  clearContent();\r\n  owner = null;\r\n\r\n  if (renderedClassName) {\r\n    dom.removeClass(div, renderedClassName);\r\n    renderedClassName = '';\r\n  }\r\n  if (themeClassName) {\r\n    dom.removeClass(div, themeClassName);\r\n    themeClassName = '';\r\n  }\r\n  (common.getMainWorkspace() as WorkspaceSvg).markFocused();\r\n}\r\n\r\n/**\r\n * Set the dropdown div's position.\r\n *\r\n * @param primaryX Desired origin point x, in absolute px.\r\n * @param primaryY Desired origin point y, in absolute px.\r\n * @param secondaryX Secondary/alternative origin point x, in absolute px.\r\n * @param secondaryY Secondary/alternative origin point y, in absolute px.\r\n * @returns True if the menu rendered at the primary origin point.\r\n */\r\nfunction positionInternal(\r\n  primaryX: number,\r\n  primaryY: number,\r\n  secondaryX: number,\r\n  secondaryY: number,\r\n): boolean {\r\n  const metrics = internal.getPositionMetrics(\r\n    primaryX,\r\n    primaryY,\r\n    secondaryX,\r\n    secondaryY,\r\n  );\r\n\r\n  // Update arrow CSS.\r\n  if (metrics.arrowVisible) {\r\n    arrow.style.display = '';\r\n    arrow.style.transform =\r\n      'translate(' +\r\n      metrics.arrowX +\r\n      'px,' +\r\n      metrics.arrowY +\r\n      'px) rotate(45deg)';\r\n    arrow.setAttribute(\r\n      'class',\r\n      metrics.arrowAtTop\r\n        ? 'blocklyDropDownArrow blocklyArrowTop'\r\n        : 'blocklyDropDownArrow blocklyArrowBottom',\r\n    );\r\n  } else {\r\n    arrow.style.display = 'none';\r\n  }\r\n\r\n  const initialX = Math.floor(metrics.initialX);\r\n  const initialY = Math.floor(metrics.initialY);\r\n  const finalX = Math.floor(metrics.finalX);\r\n  const finalY = Math.floor(metrics.finalY);\r\n\r\n  // First apply initial translation.\r\n  div.style.left = initialX + 'px';\r\n  div.style.top = initialY + 'px';\r\n\r\n  // Show the div.\r\n  div.style.display = 'block';\r\n  div.style.opacity = '1';\r\n  // Add final translate, animated through `transition`.\r\n  // Coordinates are relative to (initialX, initialY),\r\n  // where the drop-down is absolutely positioned.\r\n  const dx = finalX - initialX;\r\n  const dy = finalY - initialY;\r\n  div.style.transform = 'translate(' + dx + 'px,' + dy + 'px)';\r\n\r\n  return !!metrics.arrowAtTop;\r\n}\r\n\r\n/**\r\n * Repositions the dropdownDiv on window resize. If it doesn't know how to\r\n * calculate the new position, it will just hide it instead.\r\n *\r\n * @internal\r\n */\r\nexport function repositionForWindowResize() {\r\n  // This condition mainly catches the dropdown div when it is being used as a\r\n  // dropdown.  It is important not to close it in this case because on Android,\r\n  // when a field is focused, the soft keyboard opens triggering a window resize\r\n  // event and we want the dropdown div to stick around so users can type into\r\n  // it.\r\n  if (owner) {\r\n    const block = owner.getSourceBlock() as BlockSvg;\r\n    const bBox = positionToField\r\n      ? getScaledBboxOfField(owner)\r\n      : getScaledBboxOfBlock(block);\r\n    // If we can fit it, render below the block.\r\n    const primaryX = bBox.left + (bBox.right - bBox.left) / 2;\r\n    const primaryY = bBox.bottom;\r\n    // If we can't fit it, render above the entire parent block.\r\n    const secondaryX = primaryX;\r\n    const secondaryY = bBox.top;\r\n    positionInternal(primaryX, primaryY, secondaryX, secondaryY);\r\n  } else {\r\n    hide();\r\n  }\r\n}\r\n\r\nexport const TEST_ONLY = internal;\r\n","/**\r\n * @license\r\n * Copyright 2018 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.blockAnimations\r\n\r\nimport type {BlockSvg} from './block_svg.js';\r\nimport * as dom from './utils/dom.js';\r\nimport {Svg} from './utils/svg.js';\r\n\r\n/** A bounding box for a cloned block. */\r\ninterface CloneRect {\r\n  x: number;\r\n  y: number;\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\n/** PID of disconnect UI animation.  There can only be one at a time. */\r\nlet disconnectPid: ReturnType<typeof setTimeout> | null = null;\r\n\r\n/** The wobbling block.  There can only be one at a time. */\r\nlet wobblingBlock: BlockSvg | null = null;\r\n\r\n/**\r\n * Play some UI effects (sound, animation) when disposing of a block.\r\n *\r\n * @param block The block being disposed of.\r\n * @internal\r\n */\r\nexport function disposeUiEffect(block: BlockSvg) {\r\n  // Disposing is going to take so long the animation won't play anyway.\r\n  if (block.getDescendants(false).length > 100) return;\r\n\r\n  const workspace = block.workspace;\r\n  const svgGroup = block.getSvgRoot();\r\n  workspace.getAudioManager().play('delete');\r\n\r\n  const xy = workspace.getSvgXY(svgGroup);\r\n  // Deeply clone the current block.\r\n  const clone: SVGGElement = svgGroup.cloneNode(true) as SVGGElement;\r\n  clone.setAttribute('transform', 'translate(' + xy.x + ',' + xy.y + ')');\r\n  workspace.getParentSvg().appendChild(clone);\r\n  const cloneRect = {\r\n    'x': xy.x,\r\n    'y': xy.y,\r\n    'width': block.width,\r\n    'height': block.height,\r\n  };\r\n  disposeUiStep(clone, cloneRect, workspace.RTL, new Date(), workspace.scale);\r\n}\r\n/**\r\n * Animate a cloned block and eventually dispose of it.\r\n * This is a class method, not an instance method since the original block has\r\n * been destroyed and is no longer accessible.\r\n *\r\n * @param clone SVG element to animate and dispose of.\r\n * @param rect Starting rect of the clone.\r\n * @param rtl True if RTL, false if LTR.\r\n * @param start Date of animation's start.\r\n * @param workspaceScale Scale of workspace.\r\n */\r\nfunction disposeUiStep(\r\n  clone: Element,\r\n  rect: CloneRect,\r\n  rtl: boolean,\r\n  start: Date,\r\n  workspaceScale: number,\r\n) {\r\n  const ms = new Date().getTime() - start.getTime();\r\n  const percent = ms / 150;\r\n  if (percent > 1) {\r\n    dom.removeNode(clone);\r\n  } else {\r\n    const x =\r\n      rect.x + (((rtl ? -1 : 1) * rect.width * workspaceScale) / 2) * percent;\r\n    const y = rect.y + rect.height * workspaceScale * percent;\r\n    const scale = (1 - percent) * workspaceScale;\r\n    clone.setAttribute(\r\n      'transform',\r\n      'translate(' + x + ',' + y + ')' + ' scale(' + scale + ')',\r\n    );\r\n    setTimeout(disposeUiStep, 10, clone, rect, rtl, start, workspaceScale);\r\n  }\r\n}\r\n\r\n/**\r\n * Play some UI effects (sound, ripple) after a connection has been established.\r\n *\r\n * @param block The block being connected.\r\n * @internal\r\n */\r\nexport function connectionUiEffect(block: BlockSvg) {\r\n  const workspace = block.workspace;\r\n  const scale = workspace.scale;\r\n  workspace.getAudioManager().play('click');\r\n  if (scale < 1) {\r\n    return; // Too small to care about visual effects.\r\n  }\r\n  // Determine the absolute coordinates of the inferior block.\r\n  const xy = workspace.getSvgXY(block.getSvgRoot());\r\n  // Offset the coordinates based on the two connection types, fix scale.\r\n  if (block.outputConnection) {\r\n    xy.x += (block.RTL ? 3 : -3) * scale;\r\n    xy.y += 13 * scale;\r\n  } else if (block.previousConnection) {\r\n    xy.x += (block.RTL ? -23 : 23) * scale;\r\n    xy.y += 3 * scale;\r\n  }\r\n  const ripple = dom.createSvgElement(\r\n    Svg.CIRCLE,\r\n    {\r\n      'cx': xy.x,\r\n      'cy': xy.y,\r\n      'r': 0,\r\n      'fill': 'none',\r\n      'stroke': '#888',\r\n      'stroke-width': 10,\r\n    },\r\n    workspace.getParentSvg(),\r\n  );\r\n\r\n  const scaleAnimation = dom.createSvgElement(\r\n    Svg.ANIMATE,\r\n    {\r\n      'id': 'animationCircle',\r\n      'begin': 'indefinite',\r\n      'attributeName': 'r',\r\n      'dur': '150ms',\r\n      'from': 0,\r\n      'to': 25 * scale,\r\n    },\r\n    ripple,\r\n  );\r\n  const opacityAnimation = dom.createSvgElement(\r\n    Svg.ANIMATE,\r\n    {\r\n      'id': 'animationOpacity',\r\n      'begin': 'indefinite',\r\n      'attributeName': 'opacity',\r\n      'dur': '150ms',\r\n      'from': 1,\r\n      'to': 0,\r\n    },\r\n    ripple,\r\n  );\r\n\r\n  scaleAnimation.beginElement();\r\n  opacityAnimation.beginElement();\r\n\r\n  setTimeout(() => void dom.removeNode(ripple), 150);\r\n}\r\n\r\n/**\r\n * Play some UI effects (sound, animation) when disconnecting a block.\r\n *\r\n * @param block The block being disconnected.\r\n * @internal\r\n */\r\nexport function disconnectUiEffect(block: BlockSvg) {\r\n  disconnectUiStop();\r\n  block.workspace.getAudioManager().play('disconnect');\r\n  if (block.workspace.scale < 1) {\r\n    return; // Too small to care about visual effects.\r\n  }\r\n  // Horizontal distance for bottom of block to wiggle.\r\n  const DISPLACEMENT = 10;\r\n  // Scale magnitude of skew to height of block.\r\n  const height = block.getHeightWidth().height;\r\n  let magnitude = (Math.atan(DISPLACEMENT / height) / Math.PI) * 180;\r\n  if (!block.RTL) {\r\n    magnitude *= -1;\r\n  }\r\n  // Start the animation.\r\n  wobblingBlock = block;\r\n  disconnectUiStep(block, magnitude, new Date());\r\n}\r\n\r\n/**\r\n * Animate a brief wiggle of a disconnected block.\r\n *\r\n * @param block Block to animate.\r\n * @param magnitude Maximum degrees skew (reversed for RTL).\r\n * @param start Date of animation's start.\r\n */\r\nfunction disconnectUiStep(block: BlockSvg, magnitude: number, start: Date) {\r\n  const DURATION = 200; // Milliseconds.\r\n  const WIGGLES = 3; // Half oscillations.\r\n\r\n  const ms = new Date().getTime() - start.getTime();\r\n  const percent = ms / DURATION;\r\n\r\n  let skew = '';\r\n  if (percent <= 1) {\r\n    const val = Math.round(\r\n      Math.sin(percent * Math.PI * WIGGLES) * (1 - percent) * magnitude,\r\n    );\r\n    skew = `skewX(${val})`;\r\n    disconnectPid = setTimeout(disconnectUiStep, 10, block, magnitude, start);\r\n  }\r\n\r\n  block\r\n    .getSvgRoot()\r\n    .setAttribute('transform', `${block.getTranslation()} ${skew}`);\r\n}\r\n\r\n/**\r\n * Stop the disconnect UI animation immediately.\r\n *\r\n * @internal\r\n */\r\nexport function disconnectUiStop() {\r\n  if (!wobblingBlock) return;\r\n  if (disconnectPid) {\r\n    clearTimeout(disconnectPid);\r\n    disconnectPid = null;\r\n  }\r\n  wobblingBlock\r\n    .getSvgRoot()\r\n    .setAttribute('transform', wobblingBlock.getTranslation());\r\n  wobblingBlock = null;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.utils.string\r\n\r\nimport * as deprecation from './deprecation.js';\r\n\r\n/**\r\n * Fast prefix-checker.\r\n * Copied from Closure's goog.string.startsWith.\r\n *\r\n * @param str The string to check.\r\n * @param prefix A string to look for at the start of `str`.\r\n * @returns True if `str` begins with `prefix`.\r\n * @deprecated Use built-in **string.startsWith** instead.\r\n */\r\nexport function startsWith(str: string, prefix: string): boolean {\r\n  deprecation.warn(\r\n    'Blockly.utils.string.startsWith()',\r\n    'April 2022',\r\n    'April 2023',\r\n    'Use built-in string.startsWith',\r\n  );\r\n  return str.startsWith(prefix);\r\n}\r\n\r\n/**\r\n * Given an array of strings, return the length of the shortest one.\r\n *\r\n * @param array Array of strings.\r\n * @returns Length of shortest string.\r\n */\r\nexport function shortestStringLength(array: string[]): number {\r\n  if (!array.length) {\r\n    return 0;\r\n  }\r\n  return array.reduce(function (a, b) {\r\n    return a.length < b.length ? a : b;\r\n  }).length;\r\n}\r\n\r\n/**\r\n * Given an array of strings, return the length of the common prefix.\r\n * Words may not be split.  Any space after a word is included in the length.\r\n *\r\n * @param array Array of strings.\r\n * @param opt_shortest Length of shortest string.\r\n * @returns Length of common prefix.\r\n */\r\nexport function commonWordPrefix(\r\n  array: string[],\r\n  opt_shortest?: number,\r\n): number {\r\n  if (!array.length) {\r\n    return 0;\r\n  } else if (array.length === 1) {\r\n    return array[0].length;\r\n  }\r\n  let wordPrefix = 0;\r\n  const max = opt_shortest || shortestStringLength(array);\r\n  let len;\r\n  for (len = 0; len < max; len++) {\r\n    const letter = array[0][len];\r\n    for (let i = 1; i < array.length; i++) {\r\n      if (letter !== array[i][len]) {\r\n        return wordPrefix;\r\n      }\r\n    }\r\n    if (letter === ' ') {\r\n      wordPrefix = len + 1;\r\n    }\r\n  }\r\n  for (let i = 1; i < array.length; i++) {\r\n    const letter = array[i][len];\r\n    if (letter && letter !== ' ') {\r\n      return wordPrefix;\r\n    }\r\n  }\r\n  return max;\r\n}\r\n\r\n/**\r\n * Given an array of strings, return the length of the common suffix.\r\n * Words may not be split.  Any space after a word is included in the length.\r\n *\r\n * @param array Array of strings.\r\n * @param opt_shortest Length of shortest string.\r\n * @returns Length of common suffix.\r\n */\r\nexport function commonWordSuffix(\r\n  array: string[],\r\n  opt_shortest?: number,\r\n): number {\r\n  if (!array.length) {\r\n    return 0;\r\n  } else if (array.length === 1) {\r\n    return array[0].length;\r\n  }\r\n  let wordPrefix = 0;\r\n  const max = opt_shortest || shortestStringLength(array);\r\n  let len;\r\n  for (len = 0; len < max; len++) {\r\n    const letter = array[0].substr(-len - 1, 1);\r\n    for (let i = 1; i < array.length; i++) {\r\n      if (letter !== array[i].substr(-len - 1, 1)) {\r\n        return wordPrefix;\r\n      }\r\n    }\r\n    if (letter === ' ') {\r\n      wordPrefix = len + 1;\r\n    }\r\n  }\r\n  for (let i = 1; i < array.length; i++) {\r\n    const letter = array[i].charAt(array[i].length - len - 1);\r\n    if (letter && letter !== ' ') {\r\n      return wordPrefix;\r\n    }\r\n  }\r\n  return max;\r\n}\r\n\r\n/**\r\n * Wrap text to the specified width.\r\n *\r\n * @param text Text to wrap.\r\n * @param limit Width to wrap each line.\r\n * @returns Wrapped text.\r\n */\r\nexport function wrap(text: string, limit: number): string {\r\n  const lines = text.split('\\n');\r\n  for (let i = 0; i < lines.length; i++) {\r\n    lines[i] = wrapLine(lines[i], limit);\r\n  }\r\n  return lines.join('\\n');\r\n}\r\n\r\n/**\r\n * Wrap single line of text to the specified width.\r\n *\r\n * @param text Text to wrap.\r\n * @param limit Width to wrap each line.\r\n * @returns Wrapped text.\r\n */\r\nfunction wrapLine(text: string, limit: number): string {\r\n  if (text.length <= limit) {\r\n    // Short text, no need to wrap.\r\n    return text;\r\n  }\r\n  // Split the text into words.\r\n  const words = text.trim().split(/\\s+/);\r\n  // Set limit to be the length of the largest word.\r\n  for (let i = 0; i < words.length; i++) {\r\n    if (words[i].length > limit) {\r\n      limit = words[i].length;\r\n    }\r\n  }\r\n\r\n  let lastScore;\r\n  let score = -Infinity;\r\n  let lastText;\r\n  let lineCount = 1;\r\n  do {\r\n    lastScore = score;\r\n    lastText = text;\r\n    // Create a list of booleans representing if a space (false) or\r\n    // a break (true) appears after each word.\r\n    let wordBreaks = [];\r\n    // Seed the list with evenly spaced linebreaks.\r\n    const steps = words.length / lineCount;\r\n    let insertedBreaks = 1;\r\n    for (let i = 0; i < words.length - 1; i++) {\r\n      if (insertedBreaks < (i + 1.5) / steps) {\r\n        insertedBreaks++;\r\n        wordBreaks[i] = true;\r\n      } else {\r\n        wordBreaks[i] = false;\r\n      }\r\n    }\r\n    wordBreaks = wrapMutate(words, wordBreaks, limit);\r\n    score = wrapScore(words, wordBreaks, limit);\r\n    text = wrapToText(words, wordBreaks);\r\n    lineCount++;\r\n  } while (score > lastScore);\r\n  return lastText;\r\n}\r\n\r\n/**\r\n * Compute a score for how good the wrapping is.\r\n *\r\n * @param words Array of each word.\r\n * @param wordBreaks Array of line breaks.\r\n * @param limit Width to wrap each line.\r\n * @returns Larger the better.\r\n */\r\nfunction wrapScore(\r\n  words: string[],\r\n  wordBreaks: boolean[],\r\n  limit: number,\r\n): number {\r\n  // If this function becomes a performance liability, add caching.\r\n  // Compute the length of each line.\r\n  const lineLengths = [0];\r\n  const linePunctuation = [];\r\n  for (let i = 0; i < words.length; i++) {\r\n    lineLengths[lineLengths.length - 1] += words[i].length;\r\n    if (wordBreaks[i] === true) {\r\n      lineLengths.push(0);\r\n      linePunctuation.push(words[i].charAt(words[i].length - 1));\r\n    } else if (wordBreaks[i] === false) {\r\n      lineLengths[lineLengths.length - 1]++;\r\n    }\r\n  }\r\n  const maxLength = Math.max(...lineLengths);\r\n\r\n  let score = 0;\r\n  for (let i = 0; i < lineLengths.length; i++) {\r\n    // Optimize for width.\r\n    // -2 points per char over limit (scaled to the power of 1.5).\r\n    score -= Math.pow(Math.abs(limit - lineLengths[i]), 1.5) * 2;\r\n    // Optimize for even lines.\r\n    // -1 point per char smaller than max (scaled to the power of 1.5).\r\n    score -= Math.pow(maxLength - lineLengths[i], 1.5);\r\n    // Optimize for structure.\r\n    // Add score to line endings after punctuation.\r\n    if ('.?!'.indexOf(linePunctuation[i]) !== -1) {\r\n      score += limit / 3;\r\n    } else if (',;)]}'.indexOf(linePunctuation[i]) !== -1) {\r\n      score += limit / 4;\r\n    }\r\n  }\r\n  // All else being equal, the last line should not be longer than the\r\n  // previous line.  For example, this looks wrong:\r\n  // aaa bbb\r\n  // ccc ddd eee\r\n  if (\r\n    lineLengths.length > 1 &&\r\n    lineLengths[lineLengths.length - 1] <= lineLengths[lineLengths.length - 2]\r\n  ) {\r\n    score += 0.5;\r\n  }\r\n  return score;\r\n}\r\n/**\r\n * Mutate the array of line break locations until an optimal solution is found.\r\n * No line breaks are added or deleted, they are simply moved around.\r\n *\r\n * @param words Array of each word.\r\n * @param wordBreaks Array of line breaks.\r\n * @param limit Width to wrap each line.\r\n * @returns New array of optimal line breaks.\r\n */\r\nfunction wrapMutate(\r\n  words: string[],\r\n  wordBreaks: boolean[],\r\n  limit: number,\r\n): boolean[] {\r\n  let bestScore = wrapScore(words, wordBreaks, limit);\r\n  let bestBreaks;\r\n  // Try shifting every line break forward or backward.\r\n  for (let i = 0; i < wordBreaks.length - 1; i++) {\r\n    if (wordBreaks[i] === wordBreaks[i + 1]) {\r\n      continue;\r\n    }\r\n    const mutatedWordBreaks = new Array<boolean>().concat(wordBreaks);\r\n    mutatedWordBreaks[i] = !mutatedWordBreaks[i];\r\n    mutatedWordBreaks[i + 1] = !mutatedWordBreaks[i + 1];\r\n    const mutatedScore = wrapScore(words, mutatedWordBreaks, limit);\r\n    if (mutatedScore > bestScore) {\r\n      bestScore = mutatedScore;\r\n      bestBreaks = mutatedWordBreaks;\r\n    }\r\n  }\r\n  if (bestBreaks) {\r\n    // Found an improvement.  See if it may be improved further.\r\n    return wrapMutate(words, bestBreaks, limit);\r\n  }\r\n  // No improvements found.  Done.\r\n  return wordBreaks;\r\n}\r\n\r\n/**\r\n * Reassemble the array of words into text, with the specified line breaks.\r\n *\r\n * @param words Array of each word.\r\n * @param wordBreaks Array of line breaks.\r\n * @returns Plain text.\r\n */\r\nfunction wrapToText(words: string[], wordBreaks: boolean[]): string {\r\n  const text = [];\r\n  for (let i = 0; i < words.length; i++) {\r\n    text.push(words[i]);\r\n    if (wordBreaks[i] !== undefined) {\r\n      text.push(wordBreaks[i] ? '\\n' : ' ');\r\n    }\r\n  }\r\n  return text.join('');\r\n}\r\n\r\n/**\r\n * Is the given string a number (includes negative and decimals).\r\n *\r\n * @param str Input string.\r\n * @returns True if number, false otherwise.\r\n */\r\nexport function isNumber(str: string): boolean {\r\n  return /^\\s*-?\\d+(\\.\\d+)?\\s*$/.test(str);\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2011 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.Tooltip\r\n\r\nimport * as browserEvents from './browser_events.js';\r\nimport * as common from './common.js';\r\nimport * as blocklyString from './utils/string.js';\r\n\r\n/**\r\n * A type which can define a tooltip.\r\n * Either a string, an object containing a tooltip property, or a function which\r\n * returns either a string, or another arbitrarily nested function which\r\n * eventually unwinds to a string.\r\n */\r\nexport type TipInfo =\r\n  | string\r\n  | {tooltip: AnyDuringMigration}\r\n  | (() => TipInfo | string | Function);\r\n\r\n/**\r\n * A function that renders custom tooltip UI.\r\n * 1st parameter: the div element to render content into.\r\n * 2nd parameter: the element being moused over (i.e., the element for which the\r\n * tooltip should be shown).\r\n */\r\nexport type CustomTooltip = (p1: Element, p2: Element) => AnyDuringMigration;\r\n\r\n/**\r\n * An optional function that renders custom tooltips into the provided DIV. If\r\n * this is defined, the function will be called instead of rendering the default\r\n * tooltip UI.\r\n */\r\nlet customTooltip: CustomTooltip | undefined = undefined;\r\n\r\n/**\r\n * Sets a custom function that will be called if present instead of the default\r\n * tooltip UI.\r\n *\r\n * @param customFn A custom tooltip used to render an alternate tooltip UI.\r\n */\r\nexport function setCustomTooltip(customFn: CustomTooltip) {\r\n  customTooltip = customFn;\r\n}\r\n\r\n/**\r\n * Gets the custom tooltip function.\r\n *\r\n * @returns The custom tooltip function, if defined.\r\n */\r\nexport function getCustomTooltip(): CustomTooltip | undefined {\r\n  return customTooltip;\r\n}\r\n\r\n/** Is a tooltip currently showing? */\r\nlet visible = false;\r\n\r\n/**\r\n * Returns whether or not a tooltip is showing\r\n *\r\n * @returns True if a tooltip is showing\r\n */\r\nexport function isVisible(): boolean {\r\n  return visible;\r\n}\r\n\r\n/** Is someone else blocking the tooltip from being shown? */\r\nlet blocked = false;\r\n\r\n/**\r\n * Maximum width (in characters) of a tooltip.\r\n */\r\nexport const LIMIT = 50;\r\n\r\n/** PID of suspended thread to clear tooltip on mouse out. */\r\nlet mouseOutPid: AnyDuringMigration = 0;\r\n\r\n/** PID of suspended thread to show the tooltip. */\r\nlet showPid: AnyDuringMigration = 0;\r\n\r\n/**\r\n * Last observed X location of the mouse pointer (freezes when tooltip appears).\r\n */\r\nlet lastX = 0;\r\n\r\n/**\r\n * Last observed Y location of the mouse pointer (freezes when tooltip appears).\r\n */\r\nlet lastY = 0;\r\n\r\n/** Current element being pointed at. */\r\nlet element: AnyDuringMigration = null;\r\n\r\n/**\r\n * Once a tooltip has opened for an element, that element is 'poisoned' and\r\n * cannot respawn a tooltip until the pointer moves over a different element.\r\n */\r\nlet poisonedElement: AnyDuringMigration = null;\r\n\r\n/**\r\n * Horizontal offset between mouse cursor and tooltip.\r\n */\r\nexport const OFFSET_X = 0;\r\n\r\n/**\r\n * Vertical offset between mouse cursor and tooltip.\r\n */\r\nexport const OFFSET_Y = 10;\r\n\r\n/**\r\n * Radius mouse can move before killing tooltip.\r\n */\r\nexport const RADIUS_OK = 10;\r\n\r\n/**\r\n * Delay before tooltip appears.\r\n */\r\nexport const HOVER_MS = 750;\r\n\r\n/**\r\n * Horizontal padding between tooltip and screen edge.\r\n */\r\nexport const MARGINS = 5;\r\n\r\n/** The HTML container.  Set once by createDom. */\r\nlet containerDiv: HTMLDivElement | null = null;\r\n\r\n/**\r\n * Returns the HTML tooltip container.\r\n *\r\n * @returns The HTML tooltip container.\r\n */\r\nexport function getDiv(): HTMLDivElement | null {\r\n  return containerDiv;\r\n}\r\n\r\n/**\r\n * Returns the tooltip text for the given element.\r\n *\r\n * @param object The object to get the tooltip text of.\r\n * @returns The tooltip text of the element.\r\n */\r\nexport function getTooltipOfObject(object: AnyDuringMigration | null): string {\r\n  const obj = getTargetObject(object);\r\n  if (obj) {\r\n    let tooltip = obj.tooltip;\r\n    while (typeof tooltip === 'function') {\r\n      tooltip = tooltip();\r\n    }\r\n    if (typeof tooltip !== 'string') {\r\n      throw Error('Tooltip function must return a string.');\r\n    }\r\n    return tooltip;\r\n  }\r\n  return '';\r\n}\r\n\r\n/**\r\n * Returns the target object that the given object is targeting for its\r\n * tooltip. Could be the object itself.\r\n *\r\n * @param obj The object are trying to find the target tooltip object of.\r\n * @returns The target tooltip object.\r\n */\r\nfunction getTargetObject(\r\n  obj: object | null,\r\n): {tooltip: AnyDuringMigration} | null {\r\n  while (obj && (obj as any).tooltip) {\r\n    if (\r\n      typeof (obj as any).tooltip === 'string' ||\r\n      typeof (obj as any).tooltip === 'function'\r\n    ) {\r\n      return obj as {tooltip: string | (() => string)};\r\n    }\r\n    obj = (obj as any).tooltip;\r\n  }\r\n  return null;\r\n}\r\n\r\n/**\r\n * Create the tooltip div and inject it onto the page.\r\n */\r\nexport function createDom() {\r\n  if (document.querySelector('.blocklyTooltipDiv')) {\r\n    return; // Already created.\r\n  }\r\n  // Create an HTML container for popup overlays (e.g. editor widgets).\r\n  containerDiv = document.createElement('div');\r\n  containerDiv.className = 'blocklyTooltipDiv';\r\n  const container = common.getParentContainer() || document.body;\r\n  container.appendChild(containerDiv);\r\n}\r\n\r\n/**\r\n * Binds the required mouse events onto an SVG element.\r\n *\r\n * @param element SVG element onto which tooltip is to be bound.\r\n */\r\nexport function bindMouseEvents(element: Element) {\r\n  // TODO (#6097): Don't stash wrapper info on the DOM.\r\n  (element as AnyDuringMigration).mouseOverWrapper_ = browserEvents.bind(\r\n    element,\r\n    'pointerover',\r\n    null,\r\n    onMouseOver,\r\n  );\r\n  (element as AnyDuringMigration).mouseOutWrapper_ = browserEvents.bind(\r\n    element,\r\n    'pointerout',\r\n    null,\r\n    onMouseOut,\r\n  );\r\n\r\n  // Don't use bindEvent_ for mousemove since that would create a\r\n  // corresponding touch handler, even though this only makes sense in the\r\n  // context of a mouseover/mouseout.\r\n  element.addEventListener('pointermove', onMouseMove, false);\r\n}\r\n\r\n/**\r\n * Unbinds tooltip mouse events from the SVG element.\r\n *\r\n * @param element SVG element onto which tooltip is bound.\r\n */\r\nexport function unbindMouseEvents(element: Element | null) {\r\n  if (!element) {\r\n    return;\r\n  }\r\n  // TODO (#6097): Don't stash wrapper info on the DOM.\r\n  browserEvents.unbind((element as AnyDuringMigration).mouseOverWrapper_);\r\n  browserEvents.unbind((element as AnyDuringMigration).mouseOutWrapper_);\r\n  element.removeEventListener('pointermove', onMouseMove);\r\n}\r\n\r\n/**\r\n * Hide the tooltip if the mouse is over a different object.\r\n * Initialize the tooltip to potentially appear for this object.\r\n *\r\n * @param e Mouse event.\r\n */\r\nfunction onMouseOver(e: PointerEvent) {\r\n  if (blocked) {\r\n    // Someone doesn't want us to show tooltips.\r\n    return;\r\n  }\r\n  // If the tooltip is an object, treat it as a pointer to the next object in\r\n  // the chain to look at.  Terminate when a string or function is found.\r\n  const newElement = getTargetObject(e.currentTarget);\r\n  if (element !== newElement) {\r\n    hide();\r\n    poisonedElement = null;\r\n    element = newElement;\r\n  }\r\n  // Forget about any immediately preceding mouseOut event.\r\n  clearTimeout(mouseOutPid);\r\n}\r\n\r\n/**\r\n * Hide the tooltip if the mouse leaves the object and enters the workspace.\r\n *\r\n * @param _e Mouse event.\r\n */\r\nfunction onMouseOut(_e: PointerEvent) {\r\n  if (blocked) {\r\n    // Someone doesn't want us to show tooltips.\r\n    return;\r\n  }\r\n  // Moving from one element to another (overlapping or with no gap) generates\r\n  // a mouseOut followed instantly by a mouseOver.  Fork off the mouseOut\r\n  // event and kill it if a mouseOver is received immediately.\r\n  // This way the task only fully executes if mousing into the void.\r\n  mouseOutPid = setTimeout(function () {\r\n    element = null;\r\n    poisonedElement = null;\r\n    hide();\r\n  }, 1);\r\n  clearTimeout(showPid);\r\n  showPid = 0;\r\n}\r\n\r\n/**\r\n * When hovering over an element, schedule a tooltip to be shown.  If a tooltip\r\n * is already visible, hide it if the mouse strays out of a certain radius.\r\n *\r\n * @param e Mouse event.\r\n */\r\nfunction onMouseMove(e: Event) {\r\n  if (!element || !(element as AnyDuringMigration).tooltip) {\r\n    // No tooltip here to show.\r\n    return;\r\n  } else if (blocked) {\r\n    // Someone doesn't want us to show tooltips.  We are probably handling a\r\n    // user gesture, such as a click or drag.\r\n    return;\r\n  }\r\n  if (visible) {\r\n    // Compute the distance between the mouse position when the tooltip was\r\n    // shown and the current mouse position.  Pythagorean theorem.\r\n    // AnyDuringMigration because:  Property 'pageX' does not exist on type\r\n    // 'Event'.\r\n    const dx = lastX - (e as AnyDuringMigration).pageX;\r\n    // AnyDuringMigration because:  Property 'pageY' does not exist on type\r\n    // 'Event'.\r\n    const dy = lastY - (e as AnyDuringMigration).pageY;\r\n    if (Math.sqrt(dx * dx + dy * dy) > RADIUS_OK) {\r\n      hide();\r\n    }\r\n  } else if (poisonedElement !== element) {\r\n    // The mouse moved, clear any previously scheduled tooltip.\r\n    clearTimeout(showPid);\r\n    // Maybe this time the mouse will stay put.  Schedule showing of tooltip.\r\n    // AnyDuringMigration because:  Property 'pageX' does not exist on type\r\n    // 'Event'.\r\n    lastX = (e as AnyDuringMigration).pageX;\r\n    // AnyDuringMigration because:  Property 'pageY' does not exist on type\r\n    // 'Event'.\r\n    lastY = (e as AnyDuringMigration).pageY;\r\n    showPid = setTimeout(show, HOVER_MS);\r\n  }\r\n}\r\n\r\n/**\r\n * Dispose of the tooltip.\r\n *\r\n * @internal\r\n */\r\nexport function dispose() {\r\n  element = null;\r\n  poisonedElement = null;\r\n  hide();\r\n}\r\n\r\n/**\r\n * Hide the tooltip.\r\n */\r\nexport function hide() {\r\n  if (visible) {\r\n    visible = false;\r\n    if (containerDiv) {\r\n      containerDiv.style.display = 'none';\r\n    }\r\n  }\r\n  if (showPid) {\r\n    clearTimeout(showPid);\r\n    showPid = 0;\r\n  }\r\n}\r\n\r\n/**\r\n * Hide any in-progress tooltips and block showing new tooltips until the next\r\n * call to unblock().\r\n *\r\n * @internal\r\n */\r\nexport function block() {\r\n  hide();\r\n  blocked = true;\r\n}\r\n\r\n/**\r\n * Unblock tooltips: allow them to be scheduled and shown according to their own\r\n * logic.\r\n *\r\n * @internal\r\n */\r\nexport function unblock() {\r\n  blocked = false;\r\n}\r\n\r\n/** Renders the tooltip content into the tooltip div. */\r\nfunction renderContent() {\r\n  if (!containerDiv || !element) {\r\n    // This shouldn't happen, but if it does, we can't render.\r\n    return;\r\n  }\r\n  if (typeof customTooltip === 'function') {\r\n    customTooltip(containerDiv, element);\r\n  } else {\r\n    renderDefaultContent();\r\n  }\r\n}\r\n\r\n/** Renders the default tooltip UI. */\r\nfunction renderDefaultContent() {\r\n  let tip = getTooltipOfObject(element);\r\n  tip = blocklyString.wrap(tip, LIMIT);\r\n  // Create new text, line by line.\r\n  const lines = tip.split('\\n');\r\n  for (let i = 0; i < lines.length; i++) {\r\n    const div = document.createElement('div');\r\n    div.appendChild(document.createTextNode(lines[i]));\r\n    containerDiv!.appendChild(div);\r\n  }\r\n}\r\n\r\n/**\r\n * Gets the coordinates for the tooltip div, taking into account the edges of\r\n * the screen to prevent showing the tooltip offscreen.\r\n *\r\n * @param rtl True if the tooltip should be in right-to-left layout.\r\n * @returns Coordinates at which the tooltip div should be placed.\r\n */\r\nfunction getPosition(rtl: boolean): {x: number; y: number} {\r\n  // Position the tooltip just below the cursor.\r\n  const windowWidth = document.documentElement.clientWidth;\r\n  const windowHeight = document.documentElement.clientHeight;\r\n\r\n  let anchorX = lastX;\r\n  if (rtl) {\r\n    anchorX -= OFFSET_X + containerDiv!.offsetWidth;\r\n  } else {\r\n    anchorX += OFFSET_X;\r\n  }\r\n\r\n  let anchorY = lastY + OFFSET_Y;\r\n  if (anchorY + containerDiv!.offsetHeight > windowHeight + window.scrollY) {\r\n    // Falling off the bottom of the screen; shift the tooltip up.\r\n    anchorY -= containerDiv!.offsetHeight + 2 * OFFSET_Y;\r\n  }\r\n\r\n  if (rtl) {\r\n    // Prevent falling off left edge in RTL mode.\r\n    anchorX = Math.max(MARGINS - window.scrollX, anchorX);\r\n  } else {\r\n    if (\r\n      anchorX + containerDiv!.offsetWidth >\r\n      windowWidth + window.scrollX - 2 * MARGINS\r\n    ) {\r\n      // Falling off the right edge of the screen;\r\n      // clamp the tooltip on the edge.\r\n      anchorX = windowWidth - containerDiv!.offsetWidth - 2 * MARGINS;\r\n    }\r\n  }\r\n\r\n  return {x: anchorX, y: anchorY};\r\n}\r\n\r\n/** Create the tooltip and show it. */\r\nfunction show() {\r\n  if (blocked) {\r\n    // Someone doesn't want us to show tooltips.\r\n    return;\r\n  }\r\n  poisonedElement = element;\r\n  if (!containerDiv) {\r\n    return;\r\n  }\r\n  // Erase all existing text.\r\n  containerDiv.textContent = '';\r\n\r\n  // Add new content.\r\n  renderContent();\r\n\r\n  // Display the tooltip.\r\n  const rtl = (element as any).RTL;\r\n  containerDiv.style.direction = rtl ? 'rtl' : 'ltr';\r\n  containerDiv.style.display = 'block';\r\n  visible = true;\r\n\r\n  const {x, y} = getPosition(rtl);\r\n  containerDiv.style.left = x + 'px';\r\n  containerDiv.style.top = y + 'px';\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.utils.object\r\n\r\n/**\r\n * Complete a deep merge of all members of a source object with a target object.\r\n *\r\n * @param target Target.\r\n * @param source Source.\r\n * @returns The resulting object.\r\n */\r\nexport function deepMerge(\r\n  target: AnyDuringMigration,\r\n  source: AnyDuringMigration,\r\n): AnyDuringMigration {\r\n  for (const x in source) {\r\n    if (source[x] !== null && typeof source[x] === 'object') {\r\n      target[x] = deepMerge(target[x] || Object.create(null), source[x]);\r\n    } else {\r\n      target[x] = source[x];\r\n    }\r\n  }\r\n  return target;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2023 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport interface IHasBubble {\r\n  /** @returns True if the bubble is currently open, false otherwise. */\r\n  bubbleIsVisible(): boolean;\r\n\r\n  /** Sets whether the bubble is open or not. */\r\n  setBubbleVisible(visible: boolean): void;\r\n}\r\n\r\n/** Type guard that checks whether the given object is a IHasBubble. */\r\nexport function hasBubble(obj: any): obj is IHasBubble {\r\n  return (\r\n    obj.bubbleIsVisible !== undefined && obj.setBubbleVisible !== undefined\r\n  );\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.utils.colour\r\n\r\n/**\r\n * The richness of block colours, regardless of the hue.\r\n * Must be in the range of 0 (inclusive) to 1 (exclusive).\r\n */\r\nlet hsvSaturation = 0.45;\r\n\r\n/**\r\n * Get the richness of block colours, regardless of the hue.\r\n *\r\n * @returns The current richness.\r\n * @internal\r\n */\r\nexport function getHsvSaturation(): number {\r\n  return hsvSaturation;\r\n}\r\n\r\n/**\r\n * Set the richness of block colours, regardless of the hue.\r\n *\r\n * @param newSaturation The new richness, in the range of  0 (inclusive) to 1\r\n *     (exclusive)\r\n * @internal\r\n */\r\nexport function setHsvSaturation(newSaturation: number) {\r\n  hsvSaturation = newSaturation;\r\n}\r\n\r\n/**\r\n * The intensity of block colours, regardless of the hue.\r\n * Must be in the range of 0 (inclusive) to 1 (exclusive).\r\n */\r\nlet hsvValue = 0.65;\r\n\r\n/**\r\n * Get the intensity of block colours, regardless of the hue.\r\n *\r\n * @returns The current intensity.\r\n * @internal\r\n */\r\nexport function getHsvValue(): number {\r\n  return hsvValue;\r\n}\r\n\r\n/**\r\n * Set the intensity of block colours, regardless of the hue.\r\n *\r\n * @param newValue The new intensity, in the range of  0 (inclusive) to 1\r\n *     (exclusive)\r\n * @internal\r\n */\r\nexport function setHsvValue(newValue: number) {\r\n  hsvValue = newValue;\r\n}\r\n\r\n/**\r\n * Parses a colour from a string.\r\n * .parse('red') = '#ff0000'\r\n * .parse('#f00') = '#ff0000'\r\n * .parse('#ff0000') = '#ff0000'\r\n * .parse('0xff0000') = '#ff0000'\r\n * .parse('rgb(255, 0, 0)') = '#ff0000'\r\n *\r\n * @param str Colour in some CSS format.\r\n * @returns A string containing a hex representation of the colour, or null if\r\n *     can't be parsed.\r\n */\r\nexport function parse(str: string | number): string | null {\r\n  str = `${str}`.toLowerCase().trim();\r\n  let hex = names[str];\r\n  if (hex) {\r\n    // e.g. 'red'\r\n    return hex;\r\n  }\r\n  hex = str.substring(0, 2) === '0x' ? '#' + str.substring(2) : str;\r\n  hex = hex[0] === '#' ? hex : '#' + hex;\r\n  if (/^#[0-9a-f]{6}$/.test(hex)) {\r\n    // e.g. '#00ff88'\r\n    return hex;\r\n  }\r\n  if (/^#[0-9a-f]{3}$/.test(hex)) {\r\n    // e.g. '#0f8'\r\n    return ['#', hex[1], hex[1], hex[2], hex[2], hex[3], hex[3]].join('');\r\n  }\r\n  const rgb = str.match(/^(?:rgb)?\\s*\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*\\)$/);\r\n  if (rgb) {\r\n    // e.g. 'rgb(0, 128, 255)'\r\n    const r = Number(rgb[1]);\r\n    const g = Number(rgb[2]);\r\n    const b = Number(rgb[3]);\r\n    if (r >= 0 && r < 256 && g >= 0 && g < 256 && b >= 0 && b < 256) {\r\n      return rgbToHex(r, g, b);\r\n    }\r\n  }\r\n  return null;\r\n}\r\n\r\n/**\r\n * Converts a colour from RGB to hex representation.\r\n *\r\n * @param r Amount of red, int between 0 and 255.\r\n * @param g Amount of green, int between 0 and 255.\r\n * @param b Amount of blue, int between 0 and 255.\r\n * @returns Hex representation of the colour.\r\n */\r\nexport function rgbToHex(r: number, g: number, b: number): string {\r\n  const rgb = (r << 16) | (g << 8) | b;\r\n  if (r < 0x10) {\r\n    return '#' + (0x1000000 | rgb).toString(16).substr(1);\r\n  }\r\n  return '#' + rgb.toString(16);\r\n}\r\n\r\n/**\r\n * Converts a colour to RGB.\r\n *\r\n * @param colour String representing colour in any colour format ('#ff0000',\r\n *     'red', '0xff000', etc).\r\n * @returns RGB representation of the colour.\r\n */\r\nexport function hexToRgb(colour: string): number[] {\r\n  const hex = parse(colour);\r\n  if (!hex) {\r\n    return [0, 0, 0];\r\n  }\r\n\r\n  const rgb = parseInt(hex.substr(1), 16);\r\n  const r = rgb >> 16;\r\n  const g = (rgb >> 8) & 255;\r\n  const b = rgb & 255;\r\n\r\n  return [r, g, b];\r\n}\r\n\r\n/**\r\n * Converts an HSV triplet to hex representation.\r\n *\r\n * @param h Hue value in [0, 360].\r\n * @param s Saturation value in [0, 1].\r\n * @param v Brightness in [0, 255].\r\n * @returns Hex representation of the colour.\r\n */\r\nexport function hsvToHex(h: number, s: number, v: number): string {\r\n  let red = 0;\r\n  let green = 0;\r\n  let blue = 0;\r\n  if (s === 0) {\r\n    red = v;\r\n    green = v;\r\n    blue = v;\r\n  } else {\r\n    const sextant = Math.floor(h / 60);\r\n    const remainder = h / 60 - sextant;\r\n    const val1 = v * (1 - s);\r\n    const val2 = v * (1 - s * remainder);\r\n    const val3 = v * (1 - s * (1 - remainder));\r\n    switch (sextant) {\r\n      case 1:\r\n        red = val2;\r\n        green = v;\r\n        blue = val1;\r\n        break;\r\n      case 2:\r\n        red = val1;\r\n        green = v;\r\n        blue = val3;\r\n        break;\r\n      case 3:\r\n        red = val1;\r\n        green = val2;\r\n        blue = v;\r\n        break;\r\n      case 4:\r\n        red = val3;\r\n        green = val1;\r\n        blue = v;\r\n        break;\r\n      case 5:\r\n        red = v;\r\n        green = val1;\r\n        blue = val2;\r\n        break;\r\n      case 6:\r\n      case 0:\r\n        red = v;\r\n        green = val3;\r\n        blue = val1;\r\n        break;\r\n    }\r\n  }\r\n  return rgbToHex(Math.floor(red), Math.floor(green), Math.floor(blue));\r\n}\r\n\r\n/**\r\n * Blend two colours together, using the specified factor to indicate the\r\n * weight given to the first colour.\r\n *\r\n * @param colour1 First colour.\r\n * @param colour2 Second colour.\r\n * @param factor The weight to be given to colour1 over colour2.\r\n *     Values should be in the range [0, 1].\r\n * @returns Combined colour represented in hex.\r\n */\r\nexport function blend(\r\n  colour1: string,\r\n  colour2: string,\r\n  factor: number,\r\n): string | null {\r\n  const hex1 = parse(colour1);\r\n  if (!hex1) {\r\n    return null;\r\n  }\r\n  const hex2 = parse(colour2);\r\n  if (!hex2) {\r\n    return null;\r\n  }\r\n  const rgb1 = hexToRgb(hex1);\r\n  const rgb2 = hexToRgb(hex2);\r\n  const r = Math.round(rgb2[0] + factor * (rgb1[0] - rgb2[0]));\r\n  const g = Math.round(rgb2[1] + factor * (rgb1[1] - rgb2[1]));\r\n  const b = Math.round(rgb2[2] + factor * (rgb1[2] - rgb2[2]));\r\n  return rgbToHex(r, g, b);\r\n}\r\n\r\n/**\r\n * A map that contains the 16 basic colour keywords as defined by W3C:\r\n * https://www.w3.org/TR/2018/REC-css-color-3-20180619/#html4\r\n * The keys of this map are the lowercase \"readable\" names of the colours,\r\n * while the values are the \"hex\" values.\r\n */\r\nexport const names: {[key: string]: string} = {\r\n  'aqua': '#00ffff',\r\n  'black': '#000000',\r\n  'blue': '#0000ff',\r\n  'fuchsia': '#ff00ff',\r\n  'gray': '#808080',\r\n  'green': '#008000',\r\n  'lime': '#00ff00',\r\n  'maroon': '#800000',\r\n  'navy': '#000080',\r\n  'olive': '#808000',\r\n  'purple': '#800080',\r\n  'red': '#ff0000',\r\n  'silver': '#c0c0c0',\r\n  'teal': '#008080',\r\n  'white': '#ffffff',\r\n  'yellow': '#ffff00',\r\n};\r\n\r\n/**\r\n * Convert a hue (HSV model) into an RGB hex triplet.\r\n *\r\n * @param hue Hue on a colour wheel (0-360).\r\n * @returns RGB code, e.g. '#5ba65b'.\r\n */\r\nexport function hueToHex(hue: number): string {\r\n  return hsvToHex(hue, hsvSaturation, hsvValue * 255);\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.utils.parsing\r\n\r\nimport {Msg} from '../msg.js';\r\n\r\nimport * as colourUtils from './colour.js';\r\n\r\n/**\r\n * Internal implementation of the message reference and interpolation token\r\n * parsing used by tokenizeInterpolation() and replaceMessageReferences().\r\n *\r\n * @param message Text which might contain string table references and\r\n *     interpolation tokens.\r\n * @param parseInterpolationTokens Option to parse numeric interpolation\r\n *     tokens (%1, %2, ...) when true.\r\n * @param tokenizeNewlines Split individual newline characters into separate\r\n *     tokens when true.\r\n * @returns Array of strings and numbers.\r\n */\r\nfunction tokenizeInterpolationInternal(\r\n  message: string,\r\n  parseInterpolationTokens: boolean,\r\n  tokenizeNewlines: boolean,\r\n): (string | number)[] {\r\n  const tokens = [];\r\n  const chars = message.split('');\r\n  chars.push(''); // End marker.\r\n  // Parse the message with a finite state machine.\r\n  // 0 - Base case.\r\n  // 1 - % found.\r\n  // 2 - Digit found.\r\n  // 3 - Message ref found.\r\n  let state = 0;\r\n  const buffer = new Array<string>();\r\n  let number = null;\r\n  for (let i = 0; i < chars.length; i++) {\r\n    const c = chars[i];\r\n    if (state === 0) {\r\n      // Start escape.\r\n      if (c === '%') {\r\n        const text = buffer.join('');\r\n        if (text) {\r\n          tokens.push(text);\r\n        }\r\n        buffer.length = 0;\r\n        state = 1;\r\n      } else if (tokenizeNewlines && c === '\\n') {\r\n        // Output newline characters as single-character tokens, to be replaced\r\n        // with endOfRow dummies during interpolation.\r\n        const text = buffer.join('');\r\n        if (text) {\r\n          tokens.push(text);\r\n        }\r\n        buffer.length = 0;\r\n        tokens.push(c);\r\n      } else {\r\n        buffer.push(c); // Regular char.\r\n      }\r\n    } else if (state === 1) {\r\n      if (c === '%') {\r\n        buffer.push(c); // Escaped %: %%\r\n        state = 0;\r\n      } else if (parseInterpolationTokens && '0' <= c && c <= '9') {\r\n        state = 2;\r\n        number = c;\r\n        const text = buffer.join('');\r\n        if (text) {\r\n          tokens.push(text);\r\n        }\r\n        buffer.length = 0;\r\n      } else if (c === '{') {\r\n        state = 3;\r\n      } else {\r\n        buffer.push('%', c); // Not recognized. Return as literal.\r\n        state = 0;\r\n      }\r\n    } else if (state === 2) {\r\n      if ('0' <= c && c <= '9') {\r\n        number += c; // Multi-digit number.\r\n      } else {\r\n        tokens.push(parseInt(number ?? '', 10));\r\n        i--; // Parse this char again.\r\n        state = 0;\r\n      }\r\n    } else if (state === 3) {\r\n      // String table reference\r\n      if (c === '') {\r\n        // Premature end before closing '}'\r\n        buffer.splice(0, 0, '%{'); // Re-insert leading delimiter\r\n        i--; // Parse this char again.\r\n        state = 0; // and parse as string literal.\r\n      } else if (c !== '}') {\r\n        buffer.push(c);\r\n      } else {\r\n        const rawKey = buffer.join('');\r\n        if (/[A-Z]\\w*/i.test(rawKey)) {\r\n          // Strict matching\r\n          // Found a valid string key. Attempt case insensitive match.\r\n          const keyUpper = rawKey.toUpperCase();\r\n\r\n          // BKY_ is the prefix used to namespace the strings used in\r\n          // Blockly core files and the predefined blocks in ../blocks/.\r\n          // These strings are defined in ../msgs/ files.\r\n          const bklyKey = keyUpper.startsWith('BKY_')\r\n            ? keyUpper.substring(4)\r\n            : null;\r\n          if (bklyKey && bklyKey in Msg) {\r\n            const rawValue = Msg[bklyKey];\r\n            if (typeof rawValue === 'string') {\r\n              // Attempt to dereference substrings, too, appending to the\r\n              // end.\r\n              Array.prototype.push.apply(\r\n                tokens,\r\n                tokenizeInterpolationInternal(\r\n                  rawValue,\r\n                  parseInterpolationTokens,\r\n                  tokenizeNewlines,\r\n                ),\r\n              );\r\n            } else if (parseInterpolationTokens) {\r\n              // When parsing interpolation tokens, numbers are special\r\n              // placeholders (%1, %2, etc). Make sure all other values are\r\n              // strings.\r\n              tokens.push(`${rawValue}`);\r\n            } else {\r\n              tokens.push(rawValue);\r\n            }\r\n          } else {\r\n            // No entry found in the string table. Pass reference as string.\r\n            tokens.push('%{' + rawKey + '}');\r\n          }\r\n          buffer.length = 0; // Clear the array\r\n          state = 0;\r\n        } else {\r\n          tokens.push('%{' + rawKey + '}');\r\n          buffer.length = 0;\r\n          state = 0; // and parse as string literal.\r\n        }\r\n      }\r\n    }\r\n  }\r\n  let text = buffer.join('');\r\n  if (text) {\r\n    tokens.push(text);\r\n  }\r\n\r\n  // Merge adjacent text tokens into a single string (but if newlines should be\r\n  // tokenized, don't merge those with adjacent text).\r\n  const mergedTokens = [];\r\n  buffer.length = 0;\r\n  for (let i = 0; i < tokens.length; i++) {\r\n    if (\r\n      typeof tokens[i] === 'string' &&\r\n      !(tokenizeNewlines && tokens[i] === '\\n')\r\n    ) {\r\n      buffer.push(tokens[i] as string);\r\n    } else {\r\n      text = buffer.join('');\r\n      if (text) {\r\n        mergedTokens.push(text);\r\n      }\r\n      buffer.length = 0;\r\n      mergedTokens.push(tokens[i]);\r\n    }\r\n  }\r\n  text = buffer.join('');\r\n  if (text) {\r\n    mergedTokens.push(text);\r\n  }\r\n  buffer.length = 0;\r\n\r\n  return mergedTokens;\r\n}\r\n\r\n/**\r\n * Parse a string with any number of interpolation tokens (%1, %2, ...).\r\n * It will also replace string table references (e.g., %{bky_my_msg} and\r\n * %{BKY_MY_MSG} will both be replaced with the value in\r\n * Msg['MY_MSG']). Percentage sign characters '%' may be self-escaped\r\n * (e.g., '%%'). Newline characters will also be output as string tokens\r\n * containing a single newline character.\r\n *\r\n * @param message Text which might contain string table references and\r\n *     interpolation tokens.\r\n * @returns Array of strings and numbers.\r\n */\r\nexport function tokenizeInterpolation(message: string): (string | number)[] {\r\n  return tokenizeInterpolationInternal(message, true, true);\r\n}\r\n\r\n/**\r\n * Replaces string table references in a message, if the message is a string.\r\n * For example, \"%{bky_my_msg}\" and \"%{BKY_MY_MSG}\" will both be replaced with\r\n * the value in Msg['MY_MSG'].\r\n *\r\n * @param message Message, which may be a string that contains\r\n *     string table references.\r\n * @returns String with message references replaced.\r\n */\r\nexport function replaceMessageReferences(message: string | any): string {\r\n  if (typeof message !== 'string') {\r\n    return message;\r\n  }\r\n  const interpolatedResult = tokenizeInterpolationInternal(\r\n    message,\r\n    false,\r\n    false,\r\n  );\r\n  // When parseInterpolationTokens and tokenizeNewlines are false,\r\n  // interpolatedResult should be at most length 1.\r\n  return interpolatedResult.length ? String(interpolatedResult[0]) : '';\r\n}\r\n\r\n/**\r\n * Validates that any %{MSG_KEY} references in the message refer to keys of\r\n * the Msg string table.\r\n *\r\n * @param message Text which might contain string table references.\r\n * @returns True if all message references have matching values.\r\n *     Otherwise, false.\r\n */\r\nexport function checkMessageReferences(message: string): boolean {\r\n  let validSoFar = true;\r\n\r\n  const msgTable = Msg;\r\n  // TODO (#1169): Implement support for other string tables,\r\n  // prefixes other than BKY_.\r\n  const m = message.match(/%{BKY_[A-Z]\\w*}/gi);\r\n  if (m) {\r\n    for (let i = 0; i < m.length; i++) {\r\n      const msgKey = m[i].toUpperCase();\r\n      if (msgTable[msgKey.slice(6, -1)] === undefined) {\r\n        console.warn('No message string for ' + m[i] + ' in ' + message);\r\n        validSoFar = false; // Continue to report other errors.\r\n      }\r\n    }\r\n  }\r\n\r\n  return validSoFar;\r\n}\r\n\r\n/**\r\n * Parse a block colour from a number or string, as provided in a block\r\n * definition.\r\n *\r\n * @param colour HSV hue value (0 to 360), #RRGGBB string,\r\n *     or a message reference string pointing to one of those two values.\r\n * @returns An object containing the colour as\r\n *     a #RRGGBB string, and the hue if the input was an HSV hue value.\r\n * @throws {Error} If the colour cannot be parsed.\r\n */\r\nexport function parseBlockColour(colour: number | string): {\r\n  hue: number | null;\r\n  hex: string;\r\n} {\r\n  const dereferenced =\r\n    typeof colour === 'string' ? replaceMessageReferences(colour) : colour;\r\n\r\n  const hue = Number(dereferenced);\r\n  if (!isNaN(hue) && 0 <= hue && hue <= 360) {\r\n    return {\r\n      hue: hue,\r\n      hex: colourUtils.hsvToHex(\r\n        hue,\r\n        colourUtils.getHsvSaturation(),\r\n        colourUtils.getHsvValue() * 255,\r\n      ),\r\n    };\r\n  } else {\r\n    const hex = colourUtils.parse(dereferenced);\r\n    if (hex) {\r\n      // Only store hue if colour is set as a hue.\r\n      return {hue: null, hex: hex};\r\n    } else {\r\n      let errorMsg = 'Invalid colour: \"' + dereferenced + '\"';\r\n      if (colour !== dereferenced) {\r\n        errorMsg += ' (from \"' + colour + '\")';\r\n      }\r\n      throw Error(errorMsg);\r\n    }\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2022 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport type {Block} from '../block.js';\r\nimport {IProcedureModel} from './i_procedure_model.js';\r\n// Former goog.module ID: Blockly.procedures.IProcedureBlock\r\n\r\n/** The interface for a block which models a procedure. */\r\nexport interface IProcedureBlock {\r\n  getProcedureModel(): IProcedureModel;\r\n  doProcedureUpdate(): void;\r\n  isProcedureDef(): boolean;\r\n}\r\n\r\n/** A type guard which checks if the given block is a procedure block. */\r\nexport function isProcedureBlock(\r\n  block: Block | IProcedureBlock,\r\n): block is IProcedureBlock {\r\n  return (\r\n    (block as IProcedureBlock).getProcedureModel !== undefined &&\r\n    (block as IProcedureBlock).doProcedureUpdate !== undefined &&\r\n    (block as IProcedureBlock).isProcedureDef !== undefined\r\n  );\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2022 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * An object that fires events optionally.\r\n *\r\n * @internal\r\n */\r\nexport interface IObservable {\r\n  startPublishing(): void;\r\n  stopPublishing(): void;\r\n}\r\n\r\n/**\r\n * Type guard for checking if an object fulfills IObservable.\r\n *\r\n * @internal\r\n */\r\nexport function isObservable(obj: any): obj is IObservable {\r\n  return obj.startPublishing !== undefined && obj.stopPublishing !== undefined;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.fieldRegistry\r\n\r\nimport type {Field, FieldProto} from './field.js';\r\nimport * as registry from './registry.js';\r\n\r\ninterface RegistryOptions {\r\n  type: string;\r\n  [key: string]: unknown;\r\n}\r\n\r\n/**\r\n * Registers a field type.\r\n * fieldRegistry.fromJson uses this registry to\r\n * find the appropriate field type.\r\n *\r\n * @param type The field type name as used in the JSON definition.\r\n * @param fieldClass The field class containing a fromJson function that can\r\n *     construct an instance of the field.\r\n * @throws {Error} if the type name is empty, the field is already registered,\r\n *     or the fieldClass is not an object containing a fromJson function.\r\n */\r\nexport function register(type: string, fieldClass: FieldProto) {\r\n  registry.register(registry.Type.FIELD, type, fieldClass);\r\n}\r\n\r\n/**\r\n * Unregisters the field registered with the given type.\r\n *\r\n * @param type The field type name as used in the JSON definition.\r\n */\r\nexport function unregister(type: string) {\r\n  registry.unregister(registry.Type.FIELD, type);\r\n}\r\n\r\n/**\r\n * Construct a Field from a JSON arg object.\r\n * Finds the appropriate registered field by the type name as registered using\r\n * fieldRegistry.register.\r\n *\r\n * @param options A JSON object with a type and options specific to the field\r\n *     type.\r\n * @returns The new field instance or null if a field wasn't found with the\r\n *     given type name\r\n * @internal\r\n */\r\nexport function fromJson<T>(options: RegistryOptions): Field<T> | null {\r\n  return TEST_ONLY.fromJsonInternal(options);\r\n}\r\n\r\n/**\r\n * Private version of fromJson for stubbing in tests.\r\n *\r\n * @param options\r\n */\r\nfunction fromJsonInternal<T>(options: RegistryOptions): Field<T> | null {\r\n  const fieldObject = registry.getObject(registry.Type.FIELD, options.type);\r\n  if (!fieldObject) {\r\n    console.warn(\r\n      'Blockly could not create a field of type ' +\r\n        options['type'] +\r\n        '. The field is probably not being registered. This could be because' +\r\n        ' the file is not loaded, the field does not register itself (Issue' +\r\n        ' #1584), or the registration is not being reached.',\r\n    );\r\n    return null;\r\n  } else if (typeof (fieldObject as any).fromJson !== 'function') {\r\n    throw new TypeError('returned Field was not a IRegistrableField');\r\n  } else {\r\n    type fromJson = (options: {}) => Field<T>;\r\n    return (fieldObject as unknown as {fromJson: fromJson}).fromJson(options);\r\n  }\r\n}\r\n\r\nexport const TEST_ONLY = {\r\n  fromJsonInternal,\r\n};\r\n","/**\r\n * @license\r\n * Copyright 2012 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Dropdown input field.  Used for editable titles and variables.\r\n * In the interests of a consistent UI, the toolbox shares some functions and\r\n * properties with the context menu.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.FieldDropdown\r\n\r\nimport type {BlockSvg} from './block_svg.js';\r\nimport * as dropDownDiv from './dropdowndiv.js';\r\nimport {\r\n  Field,\r\n  FieldConfig,\r\n  FieldValidator,\r\n  UnattachedFieldError,\r\n} from './field.js';\r\nimport * as fieldRegistry from './field_registry.js';\r\nimport {Menu} from './menu.js';\r\nimport {MenuItem} from './menuitem.js';\r\nimport * as style from './utils/style.js';\r\nimport * as aria from './utils/aria.js';\r\nimport {Coordinate} from './utils/coordinate.js';\r\nimport * as dom from './utils/dom.js';\r\nimport * as parsing from './utils/parsing.js';\r\nimport * as utilsString from './utils/string.js';\r\nimport {Svg} from './utils/svg.js';\r\n\r\n/**\r\n * Class for an editable dropdown field.\r\n */\r\nexport class FieldDropdown extends Field<string> {\r\n  /** Horizontal distance that a checkmark overhangs the dropdown. */\r\n  static CHECKMARK_OVERHANG = 25;\r\n\r\n  /**\r\n   * Maximum height of the dropdown menu, as a percentage of the viewport\r\n   * height.\r\n   */\r\n  static MAX_MENU_HEIGHT_VH = 0.45;\r\n\r\n  static ARROW_CHAR = '';\r\n\r\n  /** A reference to the currently selected menu item. */\r\n  private selectedMenuItem: MenuItem | null = null;\r\n\r\n  /** The dropdown menu. */\r\n  protected menu_: Menu | null = null;\r\n\r\n  /**\r\n   * SVG image element if currently selected option is an image, or null.\r\n   */\r\n  private imageElement: SVGImageElement | null = null;\r\n\r\n  /** Tspan based arrow element. */\r\n  private arrow: SVGTSpanElement | null = null;\r\n\r\n  /** SVG based arrow element. */\r\n  private svgArrow: SVGElement | null = null;\r\n\r\n  /**\r\n   * Serializable fields are saved by the serializer, non-serializable fields\r\n   * are not. Editable fields should also be serializable.\r\n   */\r\n  override SERIALIZABLE = true;\r\n\r\n  /** Mouse cursor style when over the hotspot that initiates the editor. */\r\n  override CURSOR = 'default';\r\n\r\n  protected menuGenerator_?: MenuGenerator;\r\n\r\n  /** A cache of the most recently generated options. */\r\n  private generatedOptions: MenuOption[] | null = null;\r\n\r\n  /**\r\n   * The prefix field label, of common words set after options are trimmed.\r\n   *\r\n   * @internal\r\n   */\r\n  override prefixField: string | null = null;\r\n\r\n  /**\r\n   * The suffix field label, of common words set after options are trimmed.\r\n   *\r\n   * @internal\r\n   */\r\n  override suffixField: string | null = null;\r\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\r\n  private selectedOption!: MenuOption;\r\n  override clickTarget_: SVGElement | null = null;\r\n\r\n  /**\r\n   * @param menuGenerator A non-empty array of options for a dropdown list, or a\r\n   *     function which generates these options. Also accepts Field.SKIP_SETUP\r\n   *     if you wish to skip setup (only used by subclasses that want to handle\r\n   *     configuration and setting the field value after their own constructors\r\n   *     have run).\r\n   * @param validator A function that is called to validate changes to the\r\n   *     field's value. Takes in a language-neutral dropdown option & returns a\r\n   *     validated language-neutral dropdown option, or null to abort the\r\n   *     change.\r\n   * @param config A map of options used to configure the field.\r\n   *     See the [field creation documentation]{@link\r\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/dropdown#creation}\r\n   * for a list of properties this parameter supports.\r\n   * @throws {TypeError} If `menuGenerator` options are incorrectly structured.\r\n   */\r\n  constructor(\r\n    menuGenerator: MenuGenerator,\r\n    validator?: FieldDropdownValidator,\r\n    config?: FieldDropdownConfig,\r\n  );\r\n  constructor(menuGenerator: typeof Field.SKIP_SETUP);\r\n  constructor(\r\n    menuGenerator: MenuGenerator | typeof Field.SKIP_SETUP,\r\n    validator?: FieldDropdownValidator,\r\n    config?: FieldDropdownConfig,\r\n  ) {\r\n    super(Field.SKIP_SETUP);\r\n\r\n    // If we pass SKIP_SETUP, don't do *anything* with the menu generator.\r\n    if (menuGenerator === Field.SKIP_SETUP) return;\r\n\r\n    if (Array.isArray(menuGenerator)) {\r\n      validateOptions(menuGenerator);\r\n      const trimmed = trimOptions(menuGenerator);\r\n      this.menuGenerator_ = trimmed.options;\r\n      this.prefixField = trimmed.prefix || null;\r\n      this.suffixField = trimmed.suffix || null;\r\n    } else {\r\n      this.menuGenerator_ = menuGenerator;\r\n    }\r\n\r\n    /**\r\n     * The currently selected option. The field is initialized with the\r\n     * first option selected.\r\n     */\r\n    this.selectedOption = this.getOptions(false)[0];\r\n\r\n    if (config) {\r\n      this.configure_(config);\r\n    }\r\n    this.setValue(this.selectedOption[1]);\r\n    if (validator) {\r\n      this.setValidator(validator);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Sets the field's value based on the given XML element. Should only be\r\n   * called by Blockly.Xml.\r\n   *\r\n   * @param fieldElement The element containing info about the field's state.\r\n   * @internal\r\n   */\r\n  override fromXml(fieldElement: Element) {\r\n    if (this.isOptionListDynamic()) {\r\n      this.getOptions(false);\r\n    }\r\n    this.setValue(fieldElement.textContent);\r\n  }\r\n\r\n  /**\r\n   * Sets the field's value based on the given state.\r\n   *\r\n   * @param state The state to apply to the dropdown field.\r\n   * @internal\r\n   */\r\n  override loadState(state: AnyDuringMigration) {\r\n    if (this.loadLegacyState(FieldDropdown, state)) {\r\n      return;\r\n    }\r\n    if (this.isOptionListDynamic()) {\r\n      this.getOptions(false);\r\n    }\r\n    this.setValue(state);\r\n  }\r\n\r\n  /**\r\n   * Create the block UI for this dropdown.\r\n   */\r\n  override initView() {\r\n    if (this.shouldAddBorderRect_()) {\r\n      this.createBorderRect_();\r\n    } else {\r\n      this.clickTarget_ = (this.sourceBlock_ as BlockSvg).getSvgRoot();\r\n    }\r\n    this.createTextElement_();\r\n\r\n    this.imageElement = dom.createSvgElement(Svg.IMAGE, {}, this.fieldGroup_);\r\n\r\n    if (this.getConstants()!.FIELD_DROPDOWN_SVG_ARROW) {\r\n      this.createSVGArrow_();\r\n    } else {\r\n      this.createTextArrow_();\r\n    }\r\n\r\n    if (this.borderRect_) {\r\n      dom.addClass(this.borderRect_, 'blocklyDropdownRect');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Whether or not the dropdown should add a border rect.\r\n   *\r\n   * @returns True if the dropdown field should add a border rect.\r\n   */\r\n  protected shouldAddBorderRect_(): boolean {\r\n    return (\r\n      !this.getConstants()!.FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW ||\r\n      (this.getConstants()!.FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW &&\r\n        !this.getSourceBlock()?.isShadow())\r\n    );\r\n  }\r\n\r\n  /** Create a tspan based arrow. */\r\n  protected createTextArrow_() {\r\n    this.arrow = dom.createSvgElement(Svg.TSPAN, {}, this.textElement_);\r\n    this.arrow!.appendChild(\r\n      document.createTextNode(\r\n        this.getSourceBlock()?.RTL\r\n          ? FieldDropdown.ARROW_CHAR + ' '\r\n          : ' ' + FieldDropdown.ARROW_CHAR,\r\n      ),\r\n    );\r\n    if (this.getSourceBlock()?.RTL) {\r\n      this.getTextElement().insertBefore(this.arrow, this.textContent_);\r\n    } else {\r\n      this.getTextElement().appendChild(this.arrow);\r\n    }\r\n  }\r\n\r\n  /** Create an SVG based arrow. */\r\n  protected createSVGArrow_() {\r\n    this.svgArrow = dom.createSvgElement(\r\n      Svg.IMAGE,\r\n      {\r\n        'height': this.getConstants()!.FIELD_DROPDOWN_SVG_ARROW_SIZE + 'px',\r\n        'width': this.getConstants()!.FIELD_DROPDOWN_SVG_ARROW_SIZE + 'px',\r\n      },\r\n      this.fieldGroup_,\r\n    );\r\n    this.svgArrow!.setAttributeNS(\r\n      dom.XLINK_NS,\r\n      'xlink:href',\r\n      this.getConstants()!.FIELD_DROPDOWN_SVG_ARROW_DATAURI,\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Create a dropdown menu under the text.\r\n   *\r\n   * @param e Optional mouse event that triggered the field to open, or\r\n   *     undefined if triggered programmatically.\r\n   */\r\n  protected override showEditor_(e?: MouseEvent) {\r\n    const block = this.getSourceBlock();\r\n    if (!block) {\r\n      throw new UnattachedFieldError();\r\n    }\r\n    this.dropdownCreate();\r\n    if (e && typeof e.clientX === 'number') {\r\n      this.menu_!.openingCoords = new Coordinate(e.clientX, e.clientY);\r\n    } else {\r\n      this.menu_!.openingCoords = null;\r\n    }\r\n\r\n    // Remove any pre-existing elements in the dropdown.\r\n    dropDownDiv.clearContent();\r\n    // Element gets created in render.\r\n    const menuElement = this.menu_!.render(dropDownDiv.getContentDiv());\r\n    dom.addClass(menuElement, 'blocklyDropdownMenu');\r\n\r\n    if (this.getConstants()!.FIELD_DROPDOWN_COLOURED_DIV) {\r\n      const primaryColour = block.getColour();\r\n      const borderColour = (this.sourceBlock_ as BlockSvg).style.colourTertiary;\r\n      dropDownDiv.setColour(primaryColour, borderColour);\r\n    }\r\n\r\n    dropDownDiv.showPositionedByField(this, this.dropdownDispose_.bind(this));\r\n\r\n    // Focusing needs to be handled after the menu is rendered and positioned.\r\n    // Otherwise it will cause a page scroll to get the misplaced menu in\r\n    // view. See issue #1329.\r\n    this.menu_!.focus();\r\n\r\n    if (this.selectedMenuItem) {\r\n      this.menu_!.setHighlighted(this.selectedMenuItem);\r\n      style.scrollIntoContainerView(\r\n        this.selectedMenuItem.getElement()!,\r\n        dropDownDiv.getContentDiv(),\r\n        true,\r\n      );\r\n    }\r\n\r\n    this.applyColour();\r\n  }\r\n\r\n  /** Create the dropdown editor. */\r\n  private dropdownCreate() {\r\n    const block = this.getSourceBlock();\r\n    if (!block) {\r\n      throw new UnattachedFieldError();\r\n    }\r\n    const menu = new Menu();\r\n    menu.setRole(aria.Role.LISTBOX);\r\n    this.menu_ = menu;\r\n\r\n    const options = this.getOptions(false);\r\n    this.selectedMenuItem = null;\r\n    for (let i = 0; i < options.length; i++) {\r\n      const [label, value] = options[i];\r\n      const content = (() => {\r\n        if (typeof label === 'object') {\r\n          // Convert ImageProperties to an HTMLImageElement.\r\n          const image = new Image(label['width'], label['height']);\r\n          image.src = label['src'];\r\n          image.alt = label['alt'] || '';\r\n          return image;\r\n        }\r\n        return label;\r\n      })();\r\n      const menuItem = new MenuItem(content, value);\r\n      menuItem.setRole(aria.Role.OPTION);\r\n      menuItem.setRightToLeft(block.RTL);\r\n      menuItem.setCheckable(true);\r\n      menu.addChild(menuItem);\r\n      menuItem.setChecked(value === this.value_);\r\n      if (value === this.value_) {\r\n        this.selectedMenuItem = menuItem;\r\n      }\r\n      menuItem.onAction(this.handleMenuActionEvent, this);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Disposes of events and DOM-references belonging to the dropdown editor.\r\n   */\r\n  protected dropdownDispose_() {\r\n    if (this.menu_) {\r\n      this.menu_.dispose();\r\n    }\r\n    this.menu_ = null;\r\n    this.selectedMenuItem = null;\r\n    this.applyColour();\r\n  }\r\n\r\n  /**\r\n   * Handle an action in the dropdown menu.\r\n   *\r\n   * @param menuItem The MenuItem selected within menu.\r\n   */\r\n  private handleMenuActionEvent(menuItem: MenuItem) {\r\n    dropDownDiv.hideIfOwner(this, true);\r\n    this.onItemSelected_(this.menu_ as Menu, menuItem);\r\n  }\r\n\r\n  /**\r\n   * Handle the selection of an item in the dropdown menu.\r\n   *\r\n   * @param menu The Menu component clicked.\r\n   * @param menuItem The MenuItem selected within menu.\r\n   */\r\n  protected onItemSelected_(menu: Menu, menuItem: MenuItem) {\r\n    this.setValue(menuItem.getValue());\r\n  }\r\n\r\n  /**\r\n   * @returns True if the option list is generated by a function.\r\n   *     Otherwise false.\r\n   */\r\n  isOptionListDynamic(): boolean {\r\n    return typeof this.menuGenerator_ === 'function';\r\n  }\r\n\r\n  /**\r\n   * Return a list of the options for this dropdown.\r\n   *\r\n   * @param useCache For dynamic options, whether or not to use the cached\r\n   *     options or to re-generate them.\r\n   * @returns A non-empty array of option tuples:\r\n   *     (human-readable text or image, language-neutral name).\r\n   * @throws {TypeError} If generated options are incorrectly structured.\r\n   */\r\n  getOptions(useCache?: boolean): MenuOption[] {\r\n    if (!this.menuGenerator_) {\r\n      // A subclass improperly skipped setup without defining the menu\r\n      // generator.\r\n      throw TypeError('A menu generator was never defined.');\r\n    }\r\n    if (Array.isArray(this.menuGenerator_)) return this.menuGenerator_;\r\n    if (useCache && this.generatedOptions) return this.generatedOptions;\r\n\r\n    this.generatedOptions = this.menuGenerator_();\r\n    validateOptions(this.generatedOptions);\r\n    return this.generatedOptions;\r\n  }\r\n\r\n  /**\r\n   * Ensure that the input value is a valid language-neutral option.\r\n   *\r\n   * @param newValue The input value.\r\n   * @returns A valid language-neutral option, or null if invalid.\r\n   */\r\n  protected override doClassValidation_(newValue?: string): string | null {\r\n    const options = this.getOptions(true);\r\n    const isValueValid = options.some((option) => option[1] === newValue);\r\n\r\n    if (!isValueValid) {\r\n      if (this.sourceBlock_) {\r\n        console.warn(\r\n          \"Cannot set the dropdown's value to an unavailable option.\" +\r\n            ' Block type: ' +\r\n            this.sourceBlock_.type +\r\n            ', Field name: ' +\r\n            this.name +\r\n            ', Value: ' +\r\n            newValue,\r\n        );\r\n      }\r\n      return null;\r\n    }\r\n    return newValue as string;\r\n  }\r\n\r\n  /**\r\n   * Update the value of this dropdown field.\r\n   *\r\n   * @param newValue The value to be saved. The default validator guarantees\r\n   *     that this is one of the valid dropdown options.\r\n   */\r\n  protected override doValueUpdate_(newValue: string) {\r\n    super.doValueUpdate_(newValue);\r\n    const options = this.getOptions(true);\r\n    for (let i = 0, option; (option = options[i]); i++) {\r\n      if (option[1] === this.value_) {\r\n        this.selectedOption = option;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Updates the dropdown arrow to match the colour/style of the block.\r\n   */\r\n  override applyColour() {\r\n    const style = (this.sourceBlock_ as BlockSvg).style;\r\n    if (this.borderRect_) {\r\n      this.borderRect_.setAttribute('stroke', style.colourTertiary);\r\n      if (this.menu_) {\r\n        this.borderRect_.setAttribute('fill', style.colourTertiary);\r\n      } else {\r\n        this.borderRect_.setAttribute('fill', 'transparent');\r\n      }\r\n    }\r\n    // Update arrow's colour.\r\n    if (this.sourceBlock_ && this.arrow) {\r\n      if (this.sourceBlock_.isShadow()) {\r\n        this.arrow.style.fill = style.colourSecondary;\r\n      } else {\r\n        this.arrow.style.fill = style.colourPrimary;\r\n      }\r\n    }\r\n  }\r\n\r\n  /** Draws the border with the correct width. */\r\n  protected override render_() {\r\n    // Hide both elements.\r\n    this.getTextContent().nodeValue = '';\r\n    this.imageElement!.style.display = 'none';\r\n\r\n    // Show correct element.\r\n    const option = this.selectedOption && this.selectedOption[0];\r\n    if (option && typeof option === 'object') {\r\n      this.renderSelectedImage(option);\r\n    } else {\r\n      this.renderSelectedText();\r\n    }\r\n\r\n    this.positionBorderRect_();\r\n  }\r\n\r\n  /**\r\n   * Renders the selected option, which must be an image.\r\n   *\r\n   * @param imageJson Selected option that must be an image.\r\n   */\r\n  private renderSelectedImage(imageJson: ImageProperties) {\r\n    const block = this.getSourceBlock();\r\n    if (!block) {\r\n      throw new UnattachedFieldError();\r\n    }\r\n    this.imageElement!.style.display = '';\r\n    this.imageElement!.setAttributeNS(\r\n      dom.XLINK_NS,\r\n      'xlink:href',\r\n      imageJson.src,\r\n    );\r\n    this.imageElement!.setAttribute('height', String(imageJson.height));\r\n    this.imageElement!.setAttribute('width', String(imageJson.width));\r\n\r\n    const imageHeight = Number(imageJson.height);\r\n    const imageWidth = Number(imageJson.width);\r\n\r\n    // Height and width include the border rect.\r\n    const hasBorder = !!this.borderRect_;\r\n    const height = Math.max(\r\n      hasBorder ? this.getConstants()!.FIELD_DROPDOWN_BORDER_RECT_HEIGHT : 0,\r\n      imageHeight + IMAGE_Y_PADDING,\r\n    );\r\n    const xPadding = hasBorder\r\n      ? this.getConstants()!.FIELD_BORDER_RECT_X_PADDING\r\n      : 0;\r\n    let arrowWidth = 0;\r\n    if (this.svgArrow) {\r\n      arrowWidth = this.positionSVGArrow(\r\n        imageWidth + xPadding,\r\n        height / 2 - this.getConstants()!.FIELD_DROPDOWN_SVG_ARROW_SIZE / 2,\r\n      );\r\n    } else {\r\n      arrowWidth = dom.getFastTextWidth(\r\n        this.arrow as SVGTSpanElement,\r\n        this.getConstants()!.FIELD_TEXT_FONTSIZE,\r\n        this.getConstants()!.FIELD_TEXT_FONTWEIGHT,\r\n        this.getConstants()!.FIELD_TEXT_FONTFAMILY,\r\n      );\r\n    }\r\n    this.size_.width = imageWidth + arrowWidth + xPadding * 2;\r\n    this.size_.height = height;\r\n\r\n    let arrowX = 0;\r\n    if (block.RTL) {\r\n      const imageX = xPadding + arrowWidth;\r\n      this.imageElement!.setAttribute('x', `${imageX}`);\r\n    } else {\r\n      arrowX = imageWidth + arrowWidth;\r\n      this.getTextElement().setAttribute('text-anchor', 'end');\r\n      this.imageElement!.setAttribute('x', `${xPadding}`);\r\n    }\r\n    this.imageElement!.setAttribute('y', String(height / 2 - imageHeight / 2));\r\n\r\n    this.positionTextElement_(arrowX + xPadding, imageWidth + arrowWidth);\r\n  }\r\n\r\n  /** Renders the selected option, which must be text. */\r\n  private renderSelectedText() {\r\n    // Retrieves the selected option to display through getText_.\r\n    this.getTextContent().nodeValue = this.getDisplayText_();\r\n    const textElement = this.getTextElement();\r\n    dom.addClass(textElement, 'blocklyDropdownText');\r\n    textElement.setAttribute('text-anchor', 'start');\r\n\r\n    // Height and width include the border rect.\r\n    const hasBorder = !!this.borderRect_;\r\n    const height = Math.max(\r\n      hasBorder ? this.getConstants()!.FIELD_DROPDOWN_BORDER_RECT_HEIGHT : 0,\r\n      this.getConstants()!.FIELD_TEXT_HEIGHT,\r\n    );\r\n    const textWidth = dom.getFastTextWidth(\r\n      this.getTextElement(),\r\n      this.getConstants()!.FIELD_TEXT_FONTSIZE,\r\n      this.getConstants()!.FIELD_TEXT_FONTWEIGHT,\r\n      this.getConstants()!.FIELD_TEXT_FONTFAMILY,\r\n    );\r\n    const xPadding = hasBorder\r\n      ? this.getConstants()!.FIELD_BORDER_RECT_X_PADDING\r\n      : 0;\r\n    let arrowWidth = 0;\r\n    if (this.svgArrow) {\r\n      arrowWidth = this.positionSVGArrow(\r\n        textWidth + xPadding,\r\n        height / 2 - this.getConstants()!.FIELD_DROPDOWN_SVG_ARROW_SIZE / 2,\r\n      );\r\n    }\r\n    this.size_.width = textWidth + arrowWidth + xPadding * 2;\r\n    this.size_.height = height;\r\n\r\n    this.positionTextElement_(xPadding, textWidth);\r\n  }\r\n\r\n  /**\r\n   * Position a drop-down arrow at the appropriate location at render-time.\r\n   *\r\n   * @param x X position the arrow is being rendered at, in px.\r\n   * @param y Y position the arrow is being rendered at, in px.\r\n   * @returns Amount of space the arrow is taking up, in px.\r\n   */\r\n  private positionSVGArrow(x: number, y: number): number {\r\n    if (!this.svgArrow) {\r\n      return 0;\r\n    }\r\n    const block = this.getSourceBlock();\r\n    if (!block) {\r\n      throw new UnattachedFieldError();\r\n    }\r\n    const hasBorder = !!this.borderRect_;\r\n    const xPadding = hasBorder\r\n      ? this.getConstants()!.FIELD_BORDER_RECT_X_PADDING\r\n      : 0;\r\n    const textPadding = this.getConstants()!.FIELD_DROPDOWN_SVG_ARROW_PADDING;\r\n    const svgArrowSize = this.getConstants()!.FIELD_DROPDOWN_SVG_ARROW_SIZE;\r\n    const arrowX = block.RTL ? xPadding : x + textPadding;\r\n    this.svgArrow.setAttribute(\r\n      'transform',\r\n      'translate(' + arrowX + ',' + y + ')',\r\n    );\r\n    return svgArrowSize + textPadding;\r\n  }\r\n\r\n  /**\r\n   * Use the `getText_` developer hook to override the field's text\r\n   * representation.  Get the selected option text.  If the selected option is\r\n   * an image we return the image alt text.\r\n   *\r\n   * @returns Selected option text.\r\n   */\r\n  protected override getText_(): string | null {\r\n    if (!this.selectedOption) {\r\n      return null;\r\n    }\r\n    const option = this.selectedOption[0];\r\n    if (typeof option === 'object') {\r\n      return option['alt'];\r\n    }\r\n    return option;\r\n  }\r\n\r\n  /**\r\n   * Construct a FieldDropdown from a JSON arg object.\r\n   *\r\n   * @param options A JSON object with options (options).\r\n   * @returns The new field instance.\r\n   * @nocollapse\r\n   * @internal\r\n   */\r\n  static fromJson(options: FieldDropdownFromJsonConfig): FieldDropdown {\r\n    if (!options.options) {\r\n      throw new Error(\r\n        'options are required for the dropdown field. The ' +\r\n          'options property must be assigned an array of ' +\r\n          '[humanReadableValue, languageNeutralValue] tuples.',\r\n      );\r\n    }\r\n    // `this` might be a subclass of FieldDropdown if that class doesn't\r\n    // override the static fromJson method.\r\n    return new this(options.options, undefined, options);\r\n  }\r\n}\r\n\r\n/**\r\n * Definition of a human-readable image dropdown option.\r\n */\r\nexport interface ImageProperties {\r\n  src: string;\r\n  alt: string;\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\n/**\r\n * An individual option in the dropdown menu. The first element is the human-\r\n * readable value (text or image), and the second element is the language-\r\n * neutral value.\r\n */\r\nexport type MenuOption = [string | ImageProperties, string];\r\n\r\n/**\r\n * A function that generates an array of menu options for FieldDropdown\r\n * or its descendants.\r\n */\r\nexport type MenuGeneratorFunction = (this: FieldDropdown) => MenuOption[];\r\n\r\n/**\r\n * Either an array of menu options or a function that generates an array of\r\n * menu options for FieldDropdown or its descendants.\r\n */\r\nexport type MenuGenerator = MenuOption[] | MenuGeneratorFunction;\r\n\r\n/**\r\n * Config options for the dropdown field.\r\n */\r\nexport type FieldDropdownConfig = FieldConfig;\r\n\r\n/**\r\n * fromJson config for the dropdown field.\r\n */\r\nexport interface FieldDropdownFromJsonConfig extends FieldDropdownConfig {\r\n  options?: MenuOption[];\r\n}\r\n\r\n/**\r\n * A function that is called to validate changes to the field's value before\r\n * they are set.\r\n *\r\n * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/fields/validators#return_values}\r\n * @param newValue The value to be validated.\r\n * @returns One of three instructions for setting the new value: `T`, `null`,\r\n * or `undefined`.\r\n *\r\n * - `T` to set this function's returned value instead of `newValue`.\r\n *\r\n * - `null` to invoke `doValueInvalid_` and not set a value.\r\n *\r\n * - `undefined` to set `newValue` as is.\r\n */\r\nexport type FieldDropdownValidator = FieldValidator<string>;\r\n\r\n/**\r\n * The y offset from the top of the field to the top of the image, if an image\r\n * is selected.\r\n */\r\nconst IMAGE_Y_OFFSET = 5;\r\n\r\n/** The total vertical padding above and below an image. */\r\nconst IMAGE_Y_PADDING: number = IMAGE_Y_OFFSET * 2;\r\n\r\n/**\r\n * Factor out common words in statically defined options.\r\n * Create prefix and/or suffix labels.\r\n */\r\nfunction trimOptions(options: MenuOption[]): {\r\n  options: MenuOption[];\r\n  prefix?: string;\r\n  suffix?: string;\r\n} {\r\n  let hasImages = false;\r\n  const trimmedOptions = options.map(([label, value]): MenuOption => {\r\n    if (typeof label === 'string') {\r\n      return [parsing.replaceMessageReferences(label), value];\r\n    }\r\n\r\n    hasImages = true;\r\n    // Copy the image properties so they're not influenced by the original.\r\n    // NOTE: No need to deep copy since image properties are only 1 level deep.\r\n    const imageLabel =\r\n      label.alt !== null\r\n        ? {...label, alt: parsing.replaceMessageReferences(label.alt)}\r\n        : {...label};\r\n    return [imageLabel, value];\r\n  });\r\n\r\n  if (hasImages || options.length < 2) return {options: trimmedOptions};\r\n\r\n  const stringOptions = trimmedOptions as [string, string][];\r\n  const stringLabels = stringOptions.map(([label]) => label);\r\n\r\n  const shortest = utilsString.shortestStringLength(stringLabels);\r\n  const prefixLength = utilsString.commonWordPrefix(stringLabels, shortest);\r\n  const suffixLength = utilsString.commonWordSuffix(stringLabels, shortest);\r\n\r\n  if (\r\n    (!prefixLength && !suffixLength) ||\r\n    shortest <= prefixLength + suffixLength\r\n  ) {\r\n    // One or more strings will entirely vanish if we proceed.  Abort.\r\n    return {options: stringOptions};\r\n  }\r\n\r\n  const prefix = prefixLength\r\n    ? stringLabels[0].substring(0, prefixLength - 1)\r\n    : undefined;\r\n  const suffix = suffixLength\r\n    ? stringLabels[0].substr(1 - suffixLength)\r\n    : undefined;\r\n  return {\r\n    options: applyTrim(stringOptions, prefixLength, suffixLength),\r\n    prefix,\r\n    suffix,\r\n  };\r\n}\r\n\r\n/**\r\n * Use the calculated prefix and suffix lengths to trim all of the options in\r\n * the given array.\r\n *\r\n * @param options Array of option tuples:\r\n *     (human-readable text or image, language-neutral name).\r\n * @param prefixLength The length of the common prefix.\r\n * @param suffixLength The length of the common suffix\r\n * @returns A new array with all of the option text trimmed.\r\n */\r\nfunction applyTrim(\r\n  options: [string, string][],\r\n  prefixLength: number,\r\n  suffixLength: number,\r\n): MenuOption[] {\r\n  return options.map(([text, value]) => [\r\n    text.substring(prefixLength, text.length - suffixLength),\r\n    value,\r\n  ]);\r\n}\r\n\r\n/**\r\n * Validates the data structure to be processed as an options list.\r\n *\r\n * @param options The proposed dropdown options.\r\n * @throws {TypeError} If proposed options are incorrectly structured.\r\n */\r\nfunction validateOptions(options: MenuOption[]) {\r\n  if (!Array.isArray(options)) {\r\n    throw TypeError('FieldDropdown options must be an array.');\r\n  }\r\n  if (!options.length) {\r\n    throw TypeError('FieldDropdown options must not be an empty array.');\r\n  }\r\n  let foundError = false;\r\n  for (let i = 0; i < options.length; i++) {\r\n    const tuple = options[i];\r\n    if (!Array.isArray(tuple)) {\r\n      foundError = true;\r\n      console.error(\r\n        'Invalid option[' +\r\n          i +\r\n          ']: Each FieldDropdown option must be an ' +\r\n          'array. Found: ',\r\n        tuple,\r\n      );\r\n    } else if (typeof tuple[1] !== 'string') {\r\n      foundError = true;\r\n      console.error(\r\n        'Invalid option[' +\r\n          i +\r\n          ']: Each FieldDropdown option id must be ' +\r\n          'a string. Found ' +\r\n          tuple[1] +\r\n          ' in: ',\r\n        tuple,\r\n      );\r\n    } else if (\r\n      tuple[0] &&\r\n      typeof tuple[0] !== 'string' &&\r\n      typeof tuple[0].src !== 'string'\r\n    ) {\r\n      foundError = true;\r\n      console.error(\r\n        'Invalid option[' +\r\n          i +\r\n          ']: Each FieldDropdown option must have a ' +\r\n          'string label or image description. Found' +\r\n          tuple[0] +\r\n          ' in: ',\r\n        tuple,\r\n      );\r\n    }\r\n  }\r\n  if (foundError) {\r\n    throw TypeError('Found invalid FieldDropdown options.');\r\n  }\r\n}\r\n\r\nfieldRegistry.register('field_dropdown', FieldDropdown);\r\n","/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.Extensions\r\n\r\nimport type {Block} from './block.js';\r\nimport type {BlockSvg} from './block_svg.js';\r\nimport {FieldDropdown} from './field_dropdown.js';\r\nimport {MutatorIcon} from './icons/mutator_icon.js';\r\nimport * as parsing from './utils/parsing.js';\r\n\r\n/** The set of all registered extensions, keyed by extension name/id. */\r\nconst allExtensions = Object.create(null);\r\nexport const TEST_ONLY = {allExtensions};\r\n\r\n/**\r\n * Registers a new extension function. Extensions are functions that help\r\n * initialize blocks, usually adding dynamic behavior such as onchange\r\n * handlers and mutators. These are applied using Block.applyExtension(), or\r\n * the JSON \"extensions\" array attribute.\r\n *\r\n * @param name The name of this extension.\r\n * @param initFn The function to initialize an extended block.\r\n * @throws {Error} if the extension name is empty, the extension is already\r\n *     registered, or extensionFn is not a function.\r\n */\r\nexport function register(name: string, initFn: Function) {\r\n  if (typeof name !== 'string' || name.trim() === '') {\r\n    throw Error('Error: Invalid extension name \"' + name + '\"');\r\n  }\r\n  if (allExtensions[name]) {\r\n    throw Error('Error: Extension \"' + name + '\" is already registered.');\r\n  }\r\n  if (typeof initFn !== 'function') {\r\n    throw Error('Error: Extension \"' + name + '\" must be a function');\r\n  }\r\n  allExtensions[name] = initFn;\r\n}\r\n\r\n/**\r\n * Registers a new extension function that adds all key/value of mixinObj.\r\n *\r\n * @param name The name of this extension.\r\n * @param mixinObj The values to mix in.\r\n * @throws {Error} if the extension name is empty or the extension is already\r\n *     registered.\r\n */\r\nexport function registerMixin(name: string, mixinObj: AnyDuringMigration) {\r\n  if (!mixinObj || typeof mixinObj !== 'object') {\r\n    throw Error('Error: Mixin \"' + name + '\" must be a object');\r\n  }\r\n  register(name, function (this: Block) {\r\n    this.mixin(mixinObj);\r\n  });\r\n}\r\n\r\n/**\r\n * Registers a new extension function that adds a mutator to the block.\r\n * At register time this performs some basic sanity checks on the mutator.\r\n * The wrapper may also add a mutator dialog to the block, if both compose and\r\n * decompose are defined on the mixin.\r\n *\r\n * @param name The name of this mutator extension.\r\n * @param mixinObj The values to mix in.\r\n * @param opt_helperFn An optional function to apply after mixing in the object.\r\n * @param opt_blockList A list of blocks to appear in the flyout of the mutator\r\n *     dialog.\r\n * @throws {Error} if the mutation is invalid or can't be applied to the block.\r\n */\r\nexport function registerMutator(\r\n  name: string,\r\n  mixinObj: AnyDuringMigration,\r\n  opt_helperFn?: () => AnyDuringMigration,\r\n  opt_blockList?: string[],\r\n) {\r\n  const errorPrefix = 'Error when registering mutator \"' + name + '\": ';\r\n\r\n  checkHasMutatorProperties(errorPrefix, mixinObj);\r\n  const hasMutatorDialog = checkMutatorDialog(mixinObj, errorPrefix);\r\n\r\n  if (opt_helperFn && typeof opt_helperFn !== 'function') {\r\n    throw Error(errorPrefix + 'Extension \"' + name + '\" is not a function');\r\n  }\r\n\r\n  // Sanity checks passed.\r\n  register(name, function (this: Block) {\r\n    if (hasMutatorDialog) {\r\n      this.setMutator(new MutatorIcon(opt_blockList || [], this as BlockSvg));\r\n    }\r\n    // Mixin the object.\r\n    this.mixin(mixinObj);\r\n\r\n    if (opt_helperFn) {\r\n      opt_helperFn.apply(this);\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Unregisters the extension registered with the given name.\r\n *\r\n * @param name The name of the extension to unregister.\r\n */\r\nexport function unregister(name: string) {\r\n  if (isRegistered(name)) {\r\n    delete allExtensions[name];\r\n  } else {\r\n    console.warn(\r\n      'No extension mapping for name \"' + name + '\" found to unregister',\r\n    );\r\n  }\r\n}\r\n\r\n/**\r\n * Returns whether an extension is registered with the given name.\r\n *\r\n * @param name The name of the extension to check for.\r\n * @returns True if the extension is registered.  False if it is not registered.\r\n */\r\nexport function isRegistered(name: string): boolean {\r\n  return !!allExtensions[name];\r\n}\r\n\r\n/**\r\n * Applies an extension method to a block. This should only be called during\r\n * block construction.\r\n *\r\n * @param name The name of the extension.\r\n * @param block The block to apply the named extension to.\r\n * @param isMutator True if this extension defines a mutator.\r\n * @throws {Error} if the extension is not found.\r\n */\r\nexport function apply(name: string, block: Block, isMutator: boolean) {\r\n  const extensionFn = allExtensions[name];\r\n  if (typeof extensionFn !== 'function') {\r\n    throw Error('Error: Extension \"' + name + '\" not found.');\r\n  }\r\n  let mutatorProperties;\r\n  if (isMutator) {\r\n    // Fail early if the block already has mutation properties.\r\n    checkNoMutatorProperties(name, block);\r\n  } else {\r\n    // Record the old properties so we can make sure they don't change after\r\n    // applying the extension.\r\n    mutatorProperties = getMutatorProperties(block);\r\n  }\r\n  extensionFn.apply(block);\r\n\r\n  if (isMutator) {\r\n    const errorPrefix = 'Error after applying mutator \"' + name + '\": ';\r\n    checkHasMutatorProperties(errorPrefix, block);\r\n  } else {\r\n    if (\r\n      !mutatorPropertiesMatch(mutatorProperties as AnyDuringMigration[], block)\r\n    ) {\r\n      throw Error(\r\n        'Error when applying extension \"' +\r\n          name +\r\n          '\": ' +\r\n          'mutation properties changed when applying a non-mutator extension.',\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Check that the given block does not have any of the four mutator properties\r\n * defined on it.  This function should be called before applying a mutator\r\n * extension to a block, to make sure we are not overwriting properties.\r\n *\r\n * @param mutationName The name of the mutation to reference in error messages.\r\n * @param block The block to check.\r\n * @throws {Error} if any of the properties already exist on the block.\r\n */\r\nfunction checkNoMutatorProperties(mutationName: string, block: Block) {\r\n  const properties = getMutatorProperties(block);\r\n  if (properties.length) {\r\n    throw Error(\r\n      'Error: tried to apply mutation \"' +\r\n        mutationName +\r\n        '\" to a block that already has mutator functions.' +\r\n        '  Block id: ' +\r\n        block.id,\r\n    );\r\n  }\r\n}\r\n\r\n/**\r\n * Checks if the given object has both the 'mutationToDom' and 'domToMutation'\r\n * functions.\r\n *\r\n * @param object The object to check.\r\n * @param errorPrefix The string to prepend to any error message.\r\n * @returns True if the object has both functions.  False if it has neither\r\n *     function.\r\n * @throws {Error} if the object has only one of the functions, or either is not\r\n *     actually a function.\r\n */\r\nfunction checkXmlHooks(\r\n  object: AnyDuringMigration,\r\n  errorPrefix: string,\r\n): boolean {\r\n  return checkHasFunctionPair(\r\n    object.mutationToDom,\r\n    object.domToMutation,\r\n    errorPrefix + ' mutationToDom/domToMutation',\r\n  );\r\n}\r\n/**\r\n * Checks if the given object has both the 'saveExtraState' and 'loadExtraState'\r\n * functions.\r\n *\r\n * @param object The object to check.\r\n * @param errorPrefix The string to prepend to any error message.\r\n * @returns True if the object has both functions.  False if it has neither\r\n *     function.\r\n * @throws {Error} if the object has only one of the functions, or either is not\r\n *     actually a function.\r\n */\r\nfunction checkJsonHooks(\r\n  object: AnyDuringMigration,\r\n  errorPrefix: string,\r\n): boolean {\r\n  return checkHasFunctionPair(\r\n    object.saveExtraState,\r\n    object.loadExtraState,\r\n    errorPrefix + ' saveExtraState/loadExtraState',\r\n  );\r\n}\r\n\r\n/**\r\n * Checks if the given object has both the 'compose' and 'decompose' functions.\r\n *\r\n * @param object The object to check.\r\n * @param errorPrefix The string to prepend to any error message.\r\n * @returns True if the object has both functions.  False if it has neither\r\n *     function.\r\n * @throws {Error} if the object has only one of the functions, or either is not\r\n *     actually a function.\r\n */\r\nfunction checkMutatorDialog(\r\n  object: AnyDuringMigration,\r\n  errorPrefix: string,\r\n): boolean {\r\n  return checkHasFunctionPair(\r\n    object.compose,\r\n    object.decompose,\r\n    errorPrefix + ' compose/decompose',\r\n  );\r\n}\r\n\r\n/**\r\n * Checks that both or neither of the given functions exist and that they are\r\n * indeed functions.\r\n *\r\n * @param func1 The first function in the pair.\r\n * @param func2 The second function in the pair.\r\n * @param errorPrefix The string to prepend to any error message.\r\n * @returns True if the object has both functions.  False if it has neither\r\n *     function.\r\n * @throws {Error} If the object has only one of the functions, or either is not\r\n *     actually a function.\r\n */\r\nfunction checkHasFunctionPair(\r\n  func1: AnyDuringMigration,\r\n  func2: AnyDuringMigration,\r\n  errorPrefix: string,\r\n): boolean {\r\n  if (func1 && func2) {\r\n    if (typeof func1 !== 'function' || typeof func2 !== 'function') {\r\n      throw Error(errorPrefix + ' must be a function');\r\n    }\r\n    return true;\r\n  } else if (!func1 && !func2) {\r\n    return false;\r\n  }\r\n  throw Error(errorPrefix + 'Must have both or neither functions');\r\n}\r\n\r\n/**\r\n * Checks that the given object required mutator properties.\r\n *\r\n * @param errorPrefix The string to prepend to any error message.\r\n * @param object The object to inspect.\r\n */\r\nfunction checkHasMutatorProperties(\r\n  errorPrefix: string,\r\n  object: AnyDuringMigration,\r\n) {\r\n  const hasXmlHooks = checkXmlHooks(object, errorPrefix);\r\n  const hasJsonHooks = checkJsonHooks(object, errorPrefix);\r\n  if (!hasXmlHooks && !hasJsonHooks) {\r\n    throw Error(\r\n      errorPrefix +\r\n        'Mutations must contain either XML hooks, or JSON hooks, or both',\r\n    );\r\n  }\r\n  // A block with a mutator isn't required to have a mutation dialog, but\r\n  // it should still have both or neither of compose and decompose.\r\n  checkMutatorDialog(object, errorPrefix);\r\n}\r\n\r\n/**\r\n * Get a list of values of mutator properties on the given block.\r\n *\r\n * @param block The block to inspect.\r\n * @returns A list with all of the defined properties, which should be\r\n *     functions, but may be anything other than undefined.\r\n */\r\nfunction getMutatorProperties(block: Block): AnyDuringMigration[] {\r\n  const result = [];\r\n  // List each function explicitly by reference to allow for renaming\r\n  // during compilation.\r\n  if (block.domToMutation !== undefined) {\r\n    result.push(block.domToMutation);\r\n  }\r\n  if (block.mutationToDom !== undefined) {\r\n    result.push(block.mutationToDom);\r\n  }\r\n  if (block.saveExtraState !== undefined) {\r\n    result.push(block.saveExtraState);\r\n  }\r\n  if (block.loadExtraState !== undefined) {\r\n    result.push(block.loadExtraState);\r\n  }\r\n  if (block.compose !== undefined) {\r\n    result.push(block.compose);\r\n  }\r\n  if (block.decompose !== undefined) {\r\n    result.push(block.decompose);\r\n  }\r\n  return result;\r\n}\r\n\r\n/**\r\n * Check that the current mutator properties match a list of old mutator\r\n * properties.  This should be called after applying a non-mutator extension,\r\n * to verify that the extension didn't change properties it shouldn't.\r\n *\r\n * @param oldProperties The old values to compare to.\r\n * @param block The block to inspect for new values.\r\n * @returns True if the property lists match.\r\n */\r\nfunction mutatorPropertiesMatch(\r\n  oldProperties: AnyDuringMigration[],\r\n  block: Block,\r\n): boolean {\r\n  const newProperties = getMutatorProperties(block);\r\n  if (newProperties.length !== oldProperties.length) {\r\n    return false;\r\n  }\r\n  for (let i = 0; i < newProperties.length; i++) {\r\n    if (oldProperties[i] !== newProperties[i]) {\r\n      return false;\r\n    }\r\n  }\r\n  return true;\r\n}\r\n\r\n/**\r\n * Calls a function after the page has loaded, possibly immediately.\r\n *\r\n * @param fn Function to run.\r\n * @throws Error Will throw if no global document can be found (e.g., Node.js).\r\n * @internal\r\n */\r\nexport function runAfterPageLoad(fn: () => void) {\r\n  if (typeof document !== 'object') {\r\n    throw Error('runAfterPageLoad() requires browser document.');\r\n  }\r\n  if (document.readyState === 'complete') {\r\n    fn(); // Page has already loaded. Call immediately.\r\n  } else {\r\n    // Poll readyState.\r\n    const readyStateCheckInterval = setInterval(function () {\r\n      if (document.readyState === 'complete') {\r\n        clearInterval(readyStateCheckInterval);\r\n        fn();\r\n      }\r\n    }, 10);\r\n  }\r\n}\r\n\r\n/**\r\n * Builds an extension function that will map a dropdown value to a tooltip\r\n * string.\r\n *\r\n * @param dropdownName The name of the field whose value is the key to the\r\n *     lookup table.\r\n * @param lookupTable The table of field values to tooltip text.\r\n * @returns The extension function.\r\n */\r\nexport function buildTooltipForDropdown(\r\n  dropdownName: string,\r\n  lookupTable: {[key: string]: string},\r\n): (this: Block) => void {\r\n  // List of block types already validated, to minimize duplicate warnings.\r\n  const blockTypesChecked: string[] = [];\r\n\r\n  return function (this: Block) {\r\n    if (blockTypesChecked.indexOf(this.type) === -1) {\r\n      checkDropdownOptionsInTable(this, dropdownName, lookupTable);\r\n      blockTypesChecked.push(this.type);\r\n    }\r\n\r\n    this.setTooltip(\r\n      function (this: Block) {\r\n        const value = String(this.getFieldValue(dropdownName));\r\n        return parsing.replaceMessageReferences(lookupTable[value]);\r\n      }.bind(this),\r\n    );\r\n  };\r\n}\r\n\r\n/**\r\n * Checks all options keys are present in the provided string lookup table.\r\n * Emits console warnings when they are not.\r\n *\r\n * @param block The block containing the dropdown\r\n * @param dropdownName The name of the dropdown\r\n * @param lookupTable The string lookup table\r\n */\r\nfunction checkDropdownOptionsInTable(\r\n  block: Block,\r\n  dropdownName: string,\r\n  lookupTable: {[key: string]: string},\r\n) {\r\n  const dropdown = block.getField(dropdownName);\r\n  if (!(dropdown instanceof FieldDropdown) || dropdown.isOptionListDynamic()) {\r\n    return;\r\n  }\r\n\r\n  const options = dropdown.getOptions();\r\n  for (const [, key] of options) {\r\n    if (lookupTable[key] === undefined) {\r\n      console.warn(\r\n        `No tooltip mapping for value ${key} of field ` +\r\n          `${dropdownName} of block type ${block.type}.`,\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Builds an extension function that will install a dynamic tooltip. The\r\n * tooltip message should include the string '%1' and that string will be\r\n * replaced with the text of the named field.\r\n *\r\n * @param msgTemplate The template form to of the message text, with %1\r\n *     placeholder.\r\n * @param fieldName The field with the replacement text.\r\n * @returns The extension function.\r\n */\r\nexport function buildTooltipWithFieldText(\r\n  msgTemplate: string,\r\n  fieldName: string,\r\n): (this: Block) => void {\r\n  return function (this: Block) {\r\n    this.setTooltip(\r\n      function (this: Block) {\r\n        const field = this.getField(fieldName);\r\n        return parsing\r\n          .replaceMessageReferences(msgTemplate)\r\n          .replace('%1', field ? field.getText() : '');\r\n      }.bind(this),\r\n    );\r\n  };\r\n}\r\n\r\n/**\r\n * Configures the tooltip to mimic the parent block when connected. Otherwise,\r\n * uses the tooltip text at the time this extension is initialized. This takes\r\n * advantage of the fact that all other values from JSON are initialized before\r\n * extensions.\r\n */\r\nfunction extensionParentTooltip(this: Block) {\r\n  const tooltipWhenNotConnected = this.tooltip;\r\n  this.setTooltip(\r\n    function (this: Block) {\r\n      const parent = this.getParent();\r\n      return (\r\n        (parent && parent.getInputsInline() && parent.tooltip) ||\r\n        tooltipWhenNotConnected\r\n      );\r\n    }.bind(this),\r\n  );\r\n}\r\nregister('parent_tooltip_when_inline', extensionParentTooltip);\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.utils.svgPaths\r\n\r\n/**\r\n * Create a string representing the given x, y pair.  It does not matter whether\r\n * the coordinate is relative or absolute.  The result has leading\r\n * and trailing spaces, and separates the x and y coordinates with a comma but\r\n * no space.\r\n *\r\n * @param x The x coordinate.\r\n * @param y The y coordinate.\r\n * @returns A string of the format ' x,y '\r\n */\r\nexport function point(x: number, y: number): string {\r\n  return ' ' + x + ',' + y + ' ';\r\n}\r\n\r\n/**\r\n * Draw a cubic or quadratic curve.  See\r\n * developer.mozilla.org/en-US/docs/Web/SVG/Attribute/d#Cubic_B%C3%A9zier_Curve\r\n * These coordinates are unitless and hence in the user coordinate system.\r\n *\r\n * @param command The command to use.\r\n *     Should be one of: c, C, s, S, q, Q.\r\n * @param points  An array containing all of the points to pass to the curve\r\n *     command, in order.  The points are represented as strings of the format '\r\n *     x, y '.\r\n * @returns A string defining one or more Bezier curves.  See the MDN\r\n *     documentation for exact format.\r\n */\r\nexport function curve(command: string, points: string[]): string {\r\n  return ' ' + command + points.join('');\r\n}\r\n\r\n/**\r\n * Move the cursor to the given position without drawing a line.\r\n * The coordinates are absolute.\r\n * These coordinates are unitless and hence in the user coordinate system.\r\n * See developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/Paths#Line_commands\r\n *\r\n * @param x The absolute x coordinate.\r\n * @param y The absolute y coordinate.\r\n * @returns A string of the format ' M x,y '\r\n */\r\nexport function moveTo(x: number, y: number): string {\r\n  return ' M ' + x + ',' + y + ' ';\r\n}\r\n\r\n/**\r\n * Move the cursor to the given position without drawing a line.\r\n * Coordinates are relative.\r\n * These coordinates are unitless and hence in the user coordinate system.\r\n * See developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/Paths#Line_commands\r\n *\r\n * @param dx The relative x coordinate.\r\n * @param dy The relative y coordinate.\r\n * @returns A string of the format ' m dx,dy '\r\n */\r\nexport function moveBy(dx: number, dy: number): string {\r\n  return ' m ' + dx + ',' + dy + ' ';\r\n}\r\n\r\n/**\r\n * Draw a line from the current point to the end point, which is the current\r\n * point shifted by dx along the x-axis and dy along the y-axis.\r\n * These coordinates are unitless and hence in the user coordinate system.\r\n * See developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/Paths#Line_commands\r\n *\r\n * @param dx The relative x coordinate.\r\n * @param dy The relative y coordinate.\r\n * @returns A string of the format ' l dx,dy '\r\n */\r\nexport function lineTo(dx: number, dy: number): string {\r\n  return ' l ' + dx + ',' + dy + ' ';\r\n}\r\n\r\n/**\r\n * Draw multiple lines connecting all of the given points in order.  This is\r\n * equivalent to a series of 'l' commands.\r\n * These coordinates are unitless and hence in the user coordinate system.\r\n * See developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/Paths#Line_commands\r\n *\r\n * @param points An array containing all of the points to draw lines to, in\r\n *     order.  The points are represented as strings of the format ' dx,dy '.\r\n * @returns A string of the format ' l (dx,dy)+ '\r\n */\r\nexport function line(points: string[]): string {\r\n  return ' l' + points.join('');\r\n}\r\n\r\n/**\r\n * Draw a horizontal or vertical line.\r\n * The first argument specifies the direction and whether the given position is\r\n * relative or absolute.\r\n * These coordinates are unitless and hence in the user coordinate system.\r\n * See developer.mozilla.org/en-US/docs/Web/SVG/Attribute/d#LineTo_path_commands\r\n *\r\n * @param command The command to prepend to the coordinate.  This should be one\r\n *     of: V, v, H, h.\r\n * @param val The coordinate to pass to the command.  It may be absolute or\r\n *     relative.\r\n * @returns A string of the format ' command val '\r\n */\r\nexport function lineOnAxis(command: string, val: number): string {\r\n  return ' ' + command + ' ' + val + ' ';\r\n}\r\n\r\n/**\r\n * Draw an elliptical arc curve.\r\n * These coordinates are unitless and hence in the user coordinate system.\r\n * See developer.mozilla.org/en-US/docs/Web/SVG/Attribute/d#Elliptical_Arc_Curve\r\n *\r\n * @param command The command string.  Either 'a' or 'A'.\r\n * @param flags The flag string.  See the MDN documentation for a description\r\n *     and examples.\r\n * @param radius The radius of the arc to draw.\r\n * @param point The point to move the cursor to after drawing the arc, specified\r\n *     either in absolute or relative coordinates depending on the command.\r\n * @returns A string of the format 'command radius radius flags point'\r\n */\r\nexport function arc(\r\n  command: string,\r\n  flags: string,\r\n  radius: number,\r\n  point: string,\r\n): string {\r\n  return command + ' ' + radius + ' ' + radius + ' ' + flags + point;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2023 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport type {Block} from '../block.js';\r\nimport type {IIcon} from '../interfaces/i_icon.js';\r\nimport * as registry from '../registry.js';\r\nimport {IconType} from './icon_types.js';\r\n\r\n/**\r\n * Registers the given icon so that it can be deserialized.\r\n *\r\n * @param type The type of the icon to register. This should be the same string\r\n *     that is returned from its `getType` method.\r\n * @param iconConstructor The icon class/constructor to register.\r\n */\r\nexport function register(\r\n  type: IconType<IIcon>,\r\n  iconConstructor: new (block: Block) => IIcon,\r\n) {\r\n  registry.register(registry.Type.ICON, type.toString(), iconConstructor);\r\n}\r\n\r\n/**\r\n * Unregisters the icon associated with the given type.\r\n *\r\n * @param type The type of the icon to unregister.\r\n */\r\nexport function unregister(type: string) {\r\n  registry.unregister(registry.Type.ICON, type);\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2012 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.Procedures\r\n\r\n// Unused import preserved for side-effects. Remove if unneeded.\r\nimport './events/events_block_change.js';\r\n\r\nimport type {Block} from './block.js';\r\nimport type {BlockSvg} from './block_svg.js';\r\nimport {Blocks} from './blocks.js';\r\nimport * as common from './common.js';\r\nimport type {Abstract} from './events/events_abstract.js';\r\nimport type {BubbleOpen} from './events/events_bubble_open.js';\r\nimport * as eventUtils from './events/utils.js';\r\nimport {Field, UnattachedFieldError} from './field.js';\r\nimport {Msg} from './msg.js';\r\nimport {Names} from './names.js';\r\nimport {IParameterModel} from './interfaces/i_parameter_model.js';\r\nimport {IProcedureMap} from './interfaces/i_procedure_map.js';\r\nimport {IProcedureModel} from './interfaces/i_procedure_model.js';\r\nimport {\r\n  IProcedureBlock,\r\n  isProcedureBlock,\r\n} from './interfaces/i_procedure_block.js';\r\nimport {\r\n  isLegacyProcedureCallBlock,\r\n  isLegacyProcedureDefBlock,\r\n  ProcedureBlock,\r\n  ProcedureTuple,\r\n} from './interfaces/i_legacy_procedure_blocks.js';\r\nimport {ObservableProcedureMap} from './observable_procedure_map.js';\r\nimport * as utilsXml from './utils/xml.js';\r\nimport * as Variables from './variables.js';\r\nimport type {Workspace} from './workspace.js';\r\nimport type {WorkspaceSvg} from './workspace_svg.js';\r\nimport {MutatorIcon} from './icons.js';\r\n\r\n/**\r\n * String for use in the \"custom\" attribute of a category in toolbox XML.\r\n * This string indicates that the category should be dynamically populated with\r\n * procedure blocks.\r\n * See also Blockly.Variables.CATEGORY_NAME and\r\n * Blockly.VariablesDynamic.CATEGORY_NAME.\r\n */\r\nexport const CATEGORY_NAME = 'PROCEDURE';\r\n\r\n/**\r\n * The default argument for a procedures_mutatorarg block.\r\n */\r\nexport const DEFAULT_ARG = 'x';\r\n\r\n/**\r\n * Find all user-created procedure definitions in a workspace.\r\n *\r\n * @param root Root workspace.\r\n * @returns Pair of arrays, the first contains procedures without return\r\n *     variables, the second with. Each procedure is defined by a three-element\r\n *     list of name, parameter list, and return value boolean.\r\n */\r\nexport function allProcedures(\r\n  root: Workspace,\r\n): [ProcedureTuple[], ProcedureTuple[]] {\r\n  const proceduresNoReturn: ProcedureTuple[] = root\r\n    .getProcedureMap()\r\n    .getProcedures()\r\n    .filter((p) => !p.getReturnTypes())\r\n    .map((p) => [\r\n      p.getName(),\r\n      p.getParameters().map((pa) => pa.getName()),\r\n      false,\r\n    ]);\r\n  root.getBlocksByType('procedures_defnoreturn', false).forEach((b) => {\r\n    if (!isProcedureBlock(b) && isLegacyProcedureDefBlock(b)) {\r\n      proceduresNoReturn.push(b.getProcedureDef());\r\n    }\r\n  });\r\n\r\n  const proceduresReturn: ProcedureTuple[] = root\r\n    .getProcedureMap()\r\n    .getProcedures()\r\n    .filter((p) => !!p.getReturnTypes())\r\n    .map((p) => [\r\n      p.getName(),\r\n      p.getParameters().map((pa) => pa.getName()),\r\n      true,\r\n    ]);\r\n  root.getBlocksByType('procedures_defreturn', false).forEach((b) => {\r\n    if (!isProcedureBlock(b) && isLegacyProcedureDefBlock(b)) {\r\n      proceduresReturn.push(b.getProcedureDef());\r\n    }\r\n  });\r\n  proceduresNoReturn.sort(procTupleComparator);\r\n  proceduresReturn.sort(procTupleComparator);\r\n  return [proceduresNoReturn, proceduresReturn];\r\n}\r\n\r\n/**\r\n * Comparison function for case-insensitive sorting of the first element of\r\n * a tuple.\r\n *\r\n * @param ta First tuple.\r\n * @param tb Second tuple.\r\n * @returns -1, 0, or 1 to signify greater than, equality, or less than.\r\n */\r\nfunction procTupleComparator(ta: ProcedureTuple, tb: ProcedureTuple): number {\r\n  return ta[0].localeCompare(tb[0], undefined, {sensitivity: 'base'});\r\n}\r\n\r\n/**\r\n * Ensure two identically-named procedures don't exist.\r\n * Take the proposed procedure name, and return a legal name i.e. one that\r\n * is not empty and doesn't collide with other procedures.\r\n *\r\n * @param name Proposed procedure name.\r\n * @param block Block to disambiguate.\r\n * @returns Non-colliding name.\r\n */\r\nexport function findLegalName(name: string, block: Block): string {\r\n  if (block.isInFlyout) {\r\n    // Flyouts can have multiple procedures called 'do something'.\r\n    return name;\r\n  }\r\n  name = name || Msg['UNNAMED_KEY'] || 'unnamed';\r\n  while (!isLegalName(name, block.workspace, block)) {\r\n    // Collision with another procedure.\r\n    const r = name.match(/^(.*?)(\\d+)$/);\r\n    if (!r) {\r\n      name += '2';\r\n    } else {\r\n      name = r[1] + (parseInt(r[2]) + 1);\r\n    }\r\n  }\r\n  return name;\r\n}\r\n/**\r\n * Does this procedure have a legal name?  Illegal names include names of\r\n * procedures already defined.\r\n *\r\n * @param name The questionable name.\r\n * @param workspace The workspace to scan for collisions.\r\n * @param opt_exclude Optional block to exclude from comparisons (one doesn't\r\n *     want to collide with oneself).\r\n * @returns True if the name is legal.\r\n */\r\nfunction isLegalName(\r\n  name: string,\r\n  workspace: Workspace,\r\n  opt_exclude?: Block,\r\n): boolean {\r\n  return !isNameUsed(name, workspace, opt_exclude);\r\n}\r\n\r\n/**\r\n * Return if the given name is already a procedure name.\r\n *\r\n * @param name The questionable name.\r\n * @param workspace The workspace to scan for collisions.\r\n * @param opt_exclude Optional block to exclude from comparisons (one doesn't\r\n *     want to collide with oneself).\r\n * @returns True if the name is used, otherwise return false.\r\n */\r\nexport function isNameUsed(\r\n  name: string,\r\n  workspace: Workspace,\r\n  opt_exclude?: Block,\r\n): boolean {\r\n  for (const block of workspace.getAllBlocks(false)) {\r\n    if (block === opt_exclude) continue;\r\n\r\n    if (\r\n      isLegacyProcedureDefBlock(block) &&\r\n      Names.equals(block.getProcedureDef()[0], name)\r\n    ) {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  const excludeModel =\r\n    opt_exclude && isProcedureBlock(opt_exclude)\r\n      ? opt_exclude?.getProcedureModel()\r\n      : undefined;\r\n  for (const model of workspace.getProcedureMap().getProcedures()) {\r\n    if (model === excludeModel) continue;\r\n    if (Names.equals(model.getName(), name)) return true;\r\n  }\r\n  return false;\r\n}\r\n\r\n/**\r\n * Rename a procedure.  Called by the editable field.\r\n *\r\n * @param name The proposed new name.\r\n * @returns The accepted name.\r\n */\r\nexport function rename(this: Field, name: string): string {\r\n  const block = this.getSourceBlock();\r\n  if (!block) {\r\n    throw new UnattachedFieldError();\r\n  }\r\n\r\n  // Strip leading and trailing whitespace.  Beyond this, all names are legal.\r\n  name = name.trim();\r\n\r\n  const legalName = findLegalName(name, block);\r\n  if (isProcedureBlock(block) && !block.isInsertionMarker()) {\r\n    block.getProcedureModel().setName(legalName);\r\n  }\r\n  const oldName = this.getValue();\r\n  if (oldName !== name && oldName !== legalName) {\r\n    // Rename any callers.\r\n    const blocks = block.workspace.getAllBlocks(false);\r\n    for (let i = 0; i < blocks.length; i++) {\r\n      // Assume it is a procedure so we can check.\r\n      const procedureBlock = blocks[i] as unknown as ProcedureBlock;\r\n      if (procedureBlock.renameProcedure) {\r\n        procedureBlock.renameProcedure(oldName as string, legalName);\r\n      }\r\n    }\r\n  }\r\n  return legalName;\r\n}\r\n\r\n/**\r\n * Construct the blocks required by the flyout for the procedure category.\r\n *\r\n * @param workspace The workspace containing procedures.\r\n * @returns Array of XML block elements.\r\n */\r\nexport function flyoutCategory(workspace: WorkspaceSvg): Element[] {\r\n  const xmlList = [];\r\n  if (Blocks['procedures_defnoreturn']) {\r\n    // <block type=\"procedures_defnoreturn\" gap=\"16\">\r\n    //     <field name=\"NAME\">do something</field>\r\n    // </block>\r\n    const block = utilsXml.createElement('block');\r\n    block.setAttribute('type', 'procedures_defnoreturn');\r\n    block.setAttribute('gap', '16');\r\n    const nameField = utilsXml.createElement('field');\r\n    nameField.setAttribute('name', 'NAME');\r\n    nameField.appendChild(\r\n      utilsXml.createTextNode(Msg['PROCEDURES_DEFNORETURN_PROCEDURE']),\r\n    );\r\n    block.appendChild(nameField);\r\n    xmlList.push(block);\r\n  }\r\n  if (Blocks['procedures_defreturn']) {\r\n    // <block type=\"procedures_defreturn\" gap=\"16\">\r\n    //     <field name=\"NAME\">do something</field>\r\n    // </block>\r\n    const block = utilsXml.createElement('block');\r\n    block.setAttribute('type', 'procedures_defreturn');\r\n    block.setAttribute('gap', '16');\r\n    const nameField = utilsXml.createElement('field');\r\n    nameField.setAttribute('name', 'NAME');\r\n    nameField.appendChild(\r\n      utilsXml.createTextNode(Msg['PROCEDURES_DEFRETURN_PROCEDURE']),\r\n    );\r\n    block.appendChild(nameField);\r\n    xmlList.push(block);\r\n  }\r\n  if (Blocks['procedures_ifreturn']) {\r\n    // <block type=\"procedures_ifreturn\" gap=\"16\"></block>\r\n    const block = utilsXml.createElement('block');\r\n    block.setAttribute('type', 'procedures_ifreturn');\r\n    block.setAttribute('gap', '16');\r\n    xmlList.push(block);\r\n  }\r\n  if (xmlList.length) {\r\n    // Add slightly larger gap between system blocks and user calls.\r\n    xmlList[xmlList.length - 1].setAttribute('gap', '24');\r\n  }\r\n\r\n  /**\r\n   * Add items to xmlList for each listed procedure.\r\n   *\r\n   * @param procedureList A list of procedures, each of which is defined by a\r\n   *     three-element list of name, parameter list, and return value boolean.\r\n   * @param templateName The type of the block to generate.\r\n   */\r\n  function populateProcedures(\r\n    procedureList: ProcedureTuple[],\r\n    templateName: string,\r\n  ) {\r\n    for (let i = 0; i < procedureList.length; i++) {\r\n      const name = procedureList[i][0];\r\n      const args = procedureList[i][1];\r\n      // <block type=\"procedures_callnoreturn\" gap=\"16\">\r\n      //   <mutation name=\"do something\">\r\n      //     <arg name=\"x\"></arg>\r\n      //   </mutation>\r\n      // </block>\r\n      const block = utilsXml.createElement('block');\r\n      block.setAttribute('type', templateName);\r\n      block.setAttribute('gap', '16');\r\n      const mutation = utilsXml.createElement('mutation');\r\n      mutation.setAttribute('name', name);\r\n      block.appendChild(mutation);\r\n      for (let j = 0; j < args.length; j++) {\r\n        const arg = utilsXml.createElement('arg');\r\n        arg.setAttribute('name', args[j]);\r\n        mutation.appendChild(arg);\r\n      }\r\n      xmlList.push(block);\r\n    }\r\n  }\r\n\r\n  const tuple = allProcedures(workspace);\r\n  populateProcedures(tuple[0], 'procedures_callnoreturn');\r\n  populateProcedures(tuple[1], 'procedures_callreturn');\r\n  return xmlList;\r\n}\r\n\r\n/**\r\n * Updates the procedure mutator's flyout so that the arg block is not a\r\n * duplicate of another arg.\r\n *\r\n * @param workspace The procedure mutator's workspace. This workspace's flyout\r\n *     is what is being updated.\r\n */\r\nfunction updateMutatorFlyout(workspace: WorkspaceSvg) {\r\n  const usedNames = [];\r\n  const blocks = workspace.getBlocksByType('procedures_mutatorarg', false);\r\n  for (let i = 0, block; (block = blocks[i]); i++) {\r\n    usedNames.push(block.getFieldValue('NAME'));\r\n  }\r\n\r\n  const xmlElement = utilsXml.createElement('xml');\r\n  const argBlock = utilsXml.createElement('block');\r\n  argBlock.setAttribute('type', 'procedures_mutatorarg');\r\n  const nameField = utilsXml.createElement('field');\r\n  nameField.setAttribute('name', 'NAME');\r\n  const argValue = Variables.generateUniqueNameFromOptions(\r\n    DEFAULT_ARG,\r\n    usedNames,\r\n  );\r\n  const fieldContent = utilsXml.createTextNode(argValue);\r\n\r\n  nameField.appendChild(fieldContent);\r\n  argBlock.appendChild(nameField);\r\n  xmlElement.appendChild(argBlock);\r\n\r\n  workspace.updateToolbox(xmlElement);\r\n}\r\n\r\n/**\r\n * Listens for when a procedure mutator is opened. Then it triggers a flyout\r\n * update and adds a mutator change listener to the mutator workspace.\r\n *\r\n * @param e The event that triggered this listener.\r\n * @internal\r\n */\r\nexport function mutatorOpenListener(e: Abstract) {\r\n  if (e.type !== eventUtils.BUBBLE_OPEN) {\r\n    return;\r\n  }\r\n  const bubbleEvent = e as BubbleOpen;\r\n  if (\r\n    !(bubbleEvent.bubbleType === 'mutator' && bubbleEvent.isOpen) ||\r\n    !bubbleEvent.blockId\r\n  ) {\r\n    return;\r\n  }\r\n  const workspaceId = bubbleEvent.workspaceId;\r\n  const block = common\r\n    .getWorkspaceById(workspaceId)!\r\n    .getBlockById(bubbleEvent.blockId) as BlockSvg;\r\n  const type = block.type;\r\n  if (type !== 'procedures_defnoreturn' && type !== 'procedures_defreturn') {\r\n    return;\r\n  }\r\n  const workspace = (\r\n    block.getIcon(MutatorIcon.TYPE) as MutatorIcon\r\n  ).getWorkspace()!;\r\n  updateMutatorFlyout(workspace);\r\n  workspace.addChangeListener(mutatorChangeListener);\r\n}\r\n/**\r\n * Listens for changes in a procedure mutator and triggers flyout updates when\r\n * necessary.\r\n *\r\n * @param e The event that triggered this listener.\r\n */\r\nfunction mutatorChangeListener(e: Abstract) {\r\n  if (\r\n    e.type !== eventUtils.BLOCK_CREATE &&\r\n    e.type !== eventUtils.BLOCK_DELETE &&\r\n    e.type !== eventUtils.BLOCK_CHANGE &&\r\n    e.type !== eventUtils.BLOCK_FIELD_INTERMEDIATE_CHANGE\r\n  ) {\r\n    return;\r\n  }\r\n  const workspaceId = e.workspaceId as string;\r\n  const workspace = common.getWorkspaceById(workspaceId) as WorkspaceSvg;\r\n  updateMutatorFlyout(workspace);\r\n}\r\n\r\n/**\r\n * Find all the callers of a named procedure.\r\n *\r\n * @param name Name of procedure.\r\n * @param workspace The workspace to find callers in.\r\n * @returns Array of caller blocks.\r\n */\r\nexport function getCallers(name: string, workspace: Workspace): Block[] {\r\n  return workspace.getAllBlocks(false).filter((block) => {\r\n    return (\r\n      blockIsModernCallerFor(block, name) ||\r\n      (isLegacyProcedureCallBlock(block) &&\r\n        Names.equals(block.getProcedureCall(), name))\r\n    );\r\n  });\r\n}\r\n\r\n/**\r\n * @returns True if the given block is a modern-style caller block of the given\r\n *     procedure name.\r\n */\r\nfunction blockIsModernCallerFor(block: Block, procName: string): boolean {\r\n  return (\r\n    isProcedureBlock(block) &&\r\n    !block.isProcedureDef() &&\r\n    block.getProcedureModel() &&\r\n    Names.equals(block.getProcedureModel().getName(), procName)\r\n  );\r\n}\r\n\r\n/**\r\n * When a procedure definition changes its parameters, find and edit all its\r\n * callers.\r\n *\r\n * @param defBlock Procedure definition block.\r\n */\r\nexport function mutateCallers(defBlock: Block) {\r\n  const oldRecordUndo = eventUtils.getRecordUndo();\r\n  const procedureBlock = defBlock as unknown as ProcedureBlock;\r\n  const name = procedureBlock.getProcedureDef()[0];\r\n  const xmlElement = defBlock.mutationToDom!(true);\r\n  const callers = getCallers(name, defBlock.workspace);\r\n  for (let i = 0, caller; (caller = callers[i]); i++) {\r\n    const oldMutationDom = caller.mutationToDom!();\r\n    const oldMutation = oldMutationDom && utilsXml.domToText(oldMutationDom);\r\n    if (caller.domToMutation) {\r\n      caller.domToMutation(xmlElement);\r\n    }\r\n    const newMutationDom = caller.mutationToDom!();\r\n    const newMutation = newMutationDom && utilsXml.domToText(newMutationDom);\r\n    if (oldMutation !== newMutation) {\r\n      // Fire a mutation on every caller block.  But don't record this as an\r\n      // undo action since it is deterministically tied to the procedure's\r\n      // definition mutation.\r\n      eventUtils.setRecordUndo(false);\r\n      eventUtils.fire(\r\n        new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\r\n          caller,\r\n          'mutation',\r\n          null,\r\n          oldMutation,\r\n          newMutation,\r\n        ),\r\n      );\r\n      eventUtils.setRecordUndo(oldRecordUndo);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Find the definition block for the named procedure.\r\n *\r\n * @param name Name of procedure.\r\n * @param workspace The workspace to search.\r\n * @returns The procedure definition block, or null not found.\r\n */\r\nexport function getDefinition(\r\n  name: string,\r\n  workspace: Workspace,\r\n): Block | null {\r\n  // Do not assume procedure is a top block. Some languages allow nested\r\n  // procedures. Also do not assume it is one of the built-in blocks. Only\r\n  // rely on isProcedureDef and getProcedureDef.\r\n  for (const block of workspace.getAllBlocks(false)) {\r\n    if (\r\n      isProcedureBlock(block) &&\r\n      block.isProcedureDef() &&\r\n      Names.equals(block.getProcedureModel().getName(), name)\r\n    ) {\r\n      return block;\r\n    }\r\n    if (\r\n      isLegacyProcedureDefBlock(block) &&\r\n      Names.equals(block.getProcedureDef()[0], name)\r\n    ) {\r\n      return block;\r\n    }\r\n  }\r\n  return null;\r\n}\r\n\r\nexport {\r\n  ObservableProcedureMap,\r\n  IParameterModel,\r\n  IProcedureBlock,\r\n  isProcedureBlock,\r\n  IProcedureMap,\r\n  IProcedureModel,\r\n  ProcedureTuple,\r\n};\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.blockRendering.ConstantProvider\r\n\r\nimport {ConnectionType} from '../../connection_type.js';\r\nimport type {RenderedConnection} from '../../rendered_connection.js';\r\nimport type {BlockStyle, Theme} from '../../theme.js';\r\nimport * as colour from '../../utils/colour.js';\r\nimport * as dom from '../../utils/dom.js';\r\nimport * as parsing from '../../utils/parsing.js';\r\nimport {Svg} from '../../utils/svg.js';\r\nimport * as svgPaths from '../../utils/svg_paths.js';\r\n\r\n/** An object containing sizing and path information about outside corners. */\r\nexport interface OutsideCorners {\r\n  topLeft: string;\r\n  topRight: string;\r\n  bottomRight: string;\r\n  bottomLeft: string;\r\n  rightHeight: number;\r\n}\r\n\r\n/** An object containing sizing and path information about inside corners. */\r\nexport interface InsideCorners {\r\n  width: number;\r\n  height: number;\r\n  pathTop: string;\r\n  pathBottom: string;\r\n}\r\n\r\n/** An object containing sizing and path information about a start hat. */\r\nexport interface StartHat {\r\n  height: number;\r\n  width: number;\r\n  path: string;\r\n}\r\n\r\n/** An object containing sizing and path information about a notch. */\r\nexport interface Notch {\r\n  type: number;\r\n  width: number;\r\n  height: number;\r\n  pathLeft: string;\r\n  pathRight: string;\r\n}\r\n\r\n/** An object containing sizing and path information about a puzzle tab. */\r\nexport interface PuzzleTab {\r\n  type: number;\r\n  width: number;\r\n  height: number;\r\n  pathDown: string;\r\n  pathUp: string;\r\n}\r\n\r\n/**\r\n * An object containing sizing and path information about collapsed block\r\n * indicators.\r\n */\r\nexport interface JaggedTeeth {\r\n  height: number;\r\n  width: number;\r\n  path: string;\r\n}\r\n\r\nexport type BaseShape = {\r\n  type: number;\r\n  width: number;\r\n  height: number;\r\n};\r\n\r\n/** An object containing sizing and type information about a dynamic shape. */\r\nexport type DynamicShape = {\r\n  type: number;\r\n  width: (p1: number) => number;\r\n  height: (p1: number) => number;\r\n  isDynamic: true;\r\n  connectionOffsetY: (p1: number) => number;\r\n  connectionOffsetX: (p1: number) => number;\r\n  pathDown: (p1: number) => string;\r\n  pathUp: (p1: number) => string;\r\n  pathRightDown: (p1: number) => string;\r\n  pathRightUp: (p1: number) => string;\r\n};\r\n\r\n/** An object containing sizing and type information about a shape. */\r\nexport type Shape = BaseShape | DynamicShape;\r\n\r\n/**\r\n * Returns whether the shape is dynamic or not.\r\n *\r\n * @param shape The shape to check for dynamic-ness.\r\n * @returns Whether the shape is a dynamic shape or not.\r\n */\r\nexport function isDynamicShape(shape: Shape): shape is DynamicShape {\r\n  return (shape as DynamicShape).isDynamic;\r\n}\r\n\r\n/** Returns whether the shape is a puzzle tab or not. */\r\nexport function isPuzzleTab(shape: Shape): shape is PuzzleTab {\r\n  return (\r\n    (shape as PuzzleTab).pathDown !== undefined &&\r\n    (shape as PuzzleTab).pathUp !== undefined\r\n  );\r\n}\r\n\r\n/** Returns whether the shape is a notch or not. */\r\nexport function isNotch(shape: Shape): shape is Notch {\r\n  return (\r\n    (shape as Notch).pathLeft !== undefined &&\r\n    (shape as Notch).pathRight !== undefined\r\n  );\r\n}\r\n\r\n/**\r\n * An object that provides constants for rendering blocks.\r\n */\r\nexport class ConstantProvider {\r\n  /** The size of an empty spacer. */\r\n  NO_PADDING = 0;\r\n\r\n  /** The size of small padding. */\r\n  SMALL_PADDING = 3;\r\n\r\n  /** The size of medium padding. */\r\n  MEDIUM_PADDING = 5;\r\n\r\n  /** The size of medium-large padding. */\r\n  MEDIUM_LARGE_PADDING = 8;\r\n\r\n  /** The size of large padding. */\r\n  LARGE_PADDING = 10;\r\n  TALL_INPUT_FIELD_OFFSET_Y: number;\r\n\r\n  /** The height of the puzzle tab used for input and output connections. */\r\n  TAB_HEIGHT = 15;\r\n\r\n  /**\r\n   * The offset from the top of the block at which a puzzle tab is positioned.\r\n   */\r\n  TAB_OFFSET_FROM_TOP = 5;\r\n\r\n  /**\r\n   * Vertical overlap of the puzzle tab, used to make it look more like a\r\n   * puzzle piece.\r\n   */\r\n  TAB_VERTICAL_OVERLAP = 2.5;\r\n\r\n  /** The width of the puzzle tab used for input and output connections. */\r\n  TAB_WIDTH = 8;\r\n\r\n  /** The width of the notch used for previous and next connections. */\r\n  NOTCH_WIDTH = 15;\r\n\r\n  /** The height of the notch used for previous and next connections. */\r\n  NOTCH_HEIGHT = 4;\r\n\r\n  /** The minimum width of the block. */\r\n  MIN_BLOCK_WIDTH = 12;\r\n  EMPTY_BLOCK_SPACER_HEIGHT = 16;\r\n  DUMMY_INPUT_MIN_HEIGHT: number;\r\n  DUMMY_INPUT_SHADOW_MIN_HEIGHT: number;\r\n\r\n  /** Rounded corner radius. */\r\n  CORNER_RADIUS = 8;\r\n\r\n  /**\r\n   * Offset from the left side of a block or the inside of a statement input\r\n   * to the left side of the notch.\r\n   */\r\n  NOTCH_OFFSET_LEFT = 15;\r\n  STATEMENT_INPUT_NOTCH_OFFSET: number;\r\n\r\n  STATEMENT_BOTTOM_SPACER = 0;\r\n  STATEMENT_INPUT_PADDING_LEFT = 20;\r\n\r\n  /** Vertical padding between consecutive statement inputs. */\r\n  BETWEEN_STATEMENT_PADDING_Y = 4;\r\n  TOP_ROW_MIN_HEIGHT: number;\r\n  TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT: number;\r\n  BOTTOM_ROW_MIN_HEIGHT: number;\r\n  BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT: number;\r\n\r\n  /**\r\n   * Whether to add a 'hat' on top of all blocks with no previous or output\r\n   * connections. Can be overridden by 'hat' property on Theme.BlockStyle.\r\n   */\r\n  ADD_START_HATS = false;\r\n\r\n  /** Height of the top hat. */\r\n  START_HAT_HEIGHT = 15;\r\n\r\n  /** Width of the top hat. */\r\n  START_HAT_WIDTH = 100;\r\n\r\n  SPACER_DEFAULT_HEIGHT = 15;\r\n\r\n  MIN_BLOCK_HEIGHT = 24;\r\n\r\n  EMPTY_INLINE_INPUT_PADDING = 14.5;\r\n  EMPTY_INLINE_INPUT_HEIGHT: number;\r\n\r\n  EXTERNAL_VALUE_INPUT_PADDING = 2;\r\n  EMPTY_STATEMENT_INPUT_HEIGHT: number;\r\n  START_POINT: string;\r\n\r\n  /** Height of SVG path for jagged teeth at the end of collapsed blocks. */\r\n  JAGGED_TEETH_HEIGHT = 12;\r\n\r\n  /** Width of SVG path for jagged teeth at the end of collapsed blocks. */\r\n  JAGGED_TEETH_WIDTH = 6;\r\n\r\n  /** Point size of text. */\r\n  FIELD_TEXT_FONTSIZE = 11;\r\n\r\n  /** Text font weight. */\r\n  FIELD_TEXT_FONTWEIGHT = 'normal';\r\n\r\n  /** Text font family. */\r\n  FIELD_TEXT_FONTFAMILY = 'sans-serif';\r\n\r\n  /**\r\n   * Height of text.  This constant is dynamically set in\r\n   * `setFontConstants_` to be the height of the text based on the font\r\n   * used.\r\n   */\r\n  FIELD_TEXT_HEIGHT = -1; // Dynamically set.\r\n\r\n  /**\r\n   * Text baseline.  This constant is dynamically set in `setFontConstants_`\r\n   * to be the baseline of the text based on the font used.\r\n   */\r\n  FIELD_TEXT_BASELINE = -1; // Dynamically set.\r\n\r\n  /** A field's border rect corner radius. */\r\n  FIELD_BORDER_RECT_RADIUS = 4;\r\n\r\n  /** A field's border rect default height. */\r\n  FIELD_BORDER_RECT_HEIGHT = 16;\r\n\r\n  /** A field's border rect X padding. */\r\n  FIELD_BORDER_RECT_X_PADDING = 5;\r\n\r\n  /** A field's border rect Y padding. */\r\n  FIELD_BORDER_RECT_Y_PADDING = 3;\r\n\r\n  /**\r\n   * The backing colour of a field's border rect.\r\n   */\r\n  FIELD_BORDER_RECT_COLOUR = '#fff';\r\n  FIELD_TEXT_BASELINE_CENTER: boolean;\r\n  FIELD_DROPDOWN_BORDER_RECT_HEIGHT: number;\r\n\r\n  /**\r\n   * Whether or not a dropdown field should add a border rect when in a shadow\r\n   * block.\r\n   */\r\n  FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW = false;\r\n\r\n  /**\r\n   * Whether or not a dropdown field's div should be coloured to match the\r\n   * block colours.\r\n   */\r\n  FIELD_DROPDOWN_COLOURED_DIV = false;\r\n\r\n  /** Whether or not a dropdown field uses a text or SVG arrow. */\r\n  FIELD_DROPDOWN_SVG_ARROW = false;\r\n  FIELD_DROPDOWN_SVG_ARROW_PADDING: number;\r\n\r\n  /** A dropdown field's SVG arrow size. */\r\n  FIELD_DROPDOWN_SVG_ARROW_SIZE = 12;\r\n  FIELD_DROPDOWN_SVG_ARROW_DATAURI: string;\r\n\r\n  /**\r\n   * Whether or not to show a box shadow around the widget div. This is only a\r\n   * feature of full block fields.\r\n   */\r\n  FIELD_TEXTINPUT_BOX_SHADOW = false;\r\n\r\n  /**\r\n   * Whether or not the colour field should display its colour value on the\r\n   * entire block.\r\n   */\r\n  FIELD_COLOUR_FULL_BLOCK = false;\r\n\r\n  /** A colour field's default width. */\r\n  FIELD_COLOUR_DEFAULT_WIDTH = 26;\r\n  FIELD_COLOUR_DEFAULT_HEIGHT: number;\r\n  FIELD_CHECKBOX_X_OFFSET: number;\r\n  randomIdentifier: string;\r\n\r\n  /**\r\n   * The defs tag that contains all filters and patterns for this Blockly\r\n   * instance.\r\n   */\r\n  private defs: SVGElement | null = null;\r\n\r\n  /**\r\n   * The ID of the emboss filter, or the empty string if no filter is set.\r\n   */\r\n  embossFilterId = '';\r\n\r\n  /** The <filter> element to use for highlighting, or null if not set. */\r\n  private embossFilter: SVGElement | null = null;\r\n\r\n  /**\r\n   * The ID of the disabled pattern, or the empty string if no pattern is set.\r\n   */\r\n  disabledPatternId = '';\r\n\r\n  /**\r\n   * The <pattern> element to use for disabled blocks, or null if not set.\r\n   */\r\n  private disabledPattern: SVGElement | null = null;\r\n\r\n  /**\r\n   * The ID of the debug filter, or the empty string if no pattern is set.\r\n   */\r\n  debugFilterId = '';\r\n\r\n  /**\r\n   * The <filter> element to use for a debug highlight, or null if not set.\r\n   */\r\n  private debugFilter: SVGElement | null = null;\r\n\r\n  /** The <style> element to use for injecting renderer specific CSS. */\r\n  private cssNode: HTMLStyleElement | null = null;\r\n\r\n  /**\r\n   * Cursor colour.\r\n   */\r\n  CURSOR_COLOUR = '#cc0a0a';\r\n\r\n  /**\r\n   * Immovable marker colour.\r\n   */\r\n  MARKER_COLOUR = '#4286f4';\r\n\r\n  /**\r\n   * Width of the horizontal cursor.\r\n   */\r\n  CURSOR_WS_WIDTH = 100;\r\n\r\n  /**\r\n   * Height of the horizontal cursor.\r\n   */\r\n  WS_CURSOR_HEIGHT = 5;\r\n\r\n  /**\r\n   * Padding around a stack.\r\n   */\r\n  CURSOR_STACK_PADDING = 10;\r\n\r\n  /**\r\n   * Padding around a block.\r\n   */\r\n  CURSOR_BLOCK_PADDING = 2;\r\n\r\n  /**\r\n   * Stroke of the cursor.\r\n   */\r\n  CURSOR_STROKE_WIDTH = 4;\r\n\r\n  /**\r\n   * Whether text input and colour fields fill up the entire source block.\r\n   */\r\n  FULL_BLOCK_FIELDS = false;\r\n\r\n  /**\r\n   * The main colour of insertion markers, in hex.  The block is rendered a\r\n   * transparent grey by changing the fill opacity in CSS.\r\n   */\r\n  INSERTION_MARKER_COLOUR = '#000000';\r\n\r\n  /**\r\n   * The insertion marker opacity.\r\n   */\r\n  INSERTION_MARKER_OPACITY = 0.2;\r\n\r\n  SHAPES: {[key: string]: number} = {PUZZLE: 1, NOTCH: 2};\r\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\r\n  JAGGED_TEETH!: JaggedTeeth;\r\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\r\n  NOTCH!: Notch;\r\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\r\n  START_HAT!: StartHat;\r\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\r\n  PUZZLE_TAB!: PuzzleTab;\r\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\r\n  INSIDE_CORNERS!: InsideCorners;\r\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\r\n  OUTSIDE_CORNERS!: OutsideCorners;\r\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\r\n\r\n  blockStyles!: {[key: string]: BlockStyle};\r\n\r\n  constructor() {\r\n    /**\r\n     * Offset from the top of the row for placing fields on inline input rows\r\n     * and statement input rows.\r\n     * Matches existing rendering (in 2019).\r\n     */\r\n    this.TALL_INPUT_FIELD_OFFSET_Y = this.MEDIUM_PADDING;\r\n\r\n    /** The minimum height of a dummy input row. */\r\n    this.DUMMY_INPUT_MIN_HEIGHT = this.TAB_HEIGHT;\r\n\r\n    /** The minimum height of a dummy input row in a shadow block. */\r\n    this.DUMMY_INPUT_SHADOW_MIN_HEIGHT = this.TAB_HEIGHT;\r\n\r\n    /**\r\n     * Additional offset added to the statement input's width to account for the\r\n     * notch.\r\n     */\r\n    this.STATEMENT_INPUT_NOTCH_OFFSET = this.NOTCH_OFFSET_LEFT;\r\n\r\n    /** The top row's minimum height. */\r\n    this.TOP_ROW_MIN_HEIGHT = this.MEDIUM_PADDING;\r\n\r\n    /** The top row's minimum height if it precedes a statement. */\r\n    this.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT = this.LARGE_PADDING;\r\n\r\n    /** The bottom row's minimum height. */\r\n    this.BOTTOM_ROW_MIN_HEIGHT = this.MEDIUM_PADDING;\r\n\r\n    /** The bottom row's minimum height if it follows a statement input. */\r\n    this.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT = this.LARGE_PADDING;\r\n\r\n    /** The height of an empty inline input. */\r\n    this.EMPTY_INLINE_INPUT_HEIGHT = this.TAB_HEIGHT + 11;\r\n\r\n    /**\r\n     * The height of an empty statement input.  Note that in the old rendering\r\n     * this varies slightly depending on whether the block has external or\r\n     * inline inputs. In the new rendering this is consistent.  It seems\r\n     * unlikely that the old behaviour was intentional.\r\n     */\r\n    this.EMPTY_STATEMENT_INPUT_HEIGHT = this.MIN_BLOCK_HEIGHT;\r\n\r\n    this.START_POINT = svgPaths.moveBy(0, 0);\r\n\r\n    /**\r\n     * A field's text element's dominant baseline. Pre-2022 this could be false\r\n     * for certain browsers.\r\n     */\r\n    this.FIELD_TEXT_BASELINE_CENTER = true;\r\n\r\n    /** A dropdown field's border rect height. */\r\n    this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT = this.FIELD_BORDER_RECT_HEIGHT;\r\n\r\n    /** A dropdown field's SVG arrow padding. */\r\n    this.FIELD_DROPDOWN_SVG_ARROW_PADDING = this.FIELD_BORDER_RECT_X_PADDING;\r\n\r\n    /** A dropdown field's SVG arrow datauri. */\r\n    this.FIELD_DROPDOWN_SVG_ARROW_DATAURI =\r\n      'data:image/svg+xml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllci' +\r\n      'AxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMi43MSIgaG' +\r\n      'VpZ2h0PSI4Ljc5IiB2aWV3Qm94PSIwIDAgMTIuNzEgOC43OSI+PHRpdGxlPmRyb3Bkb3duLW' +\r\n      'Fycm93PC90aXRsZT48ZyBvcGFjaXR5PSIwLjEiPjxwYXRoIGQ9Ik0xMi43MSwyLjQ0QTIuND' +\r\n      'EsMi40MSwwLDAsMSwxMiw0LjE2TDguMDgsOC4wOGEyLjQ1LDIuNDUsMCwwLDEtMy40NSwwTD' +\r\n      'AuNzIsNC4xNkEyLjQyLDIuNDIsMCwwLDEsMCwyLjQ0LDIuNDgsMi40OCwwLDAsMSwuNzEuNz' +\r\n      'FDMSwwLjQ3LDEuNDMsMCw2LjM2LDBTMTEuNzUsMC40NiwxMiwuNzFBMi40NCwyLjQ0LDAsMC' +\r\n      'wxLDEyLjcxLDIuNDRaIiBmaWxsPSIjMjMxZjIwIi8+PC9nPjxwYXRoIGQ9Ik02LjM2LDcuNz' +\r\n      'lhMS40MywxLjQzLDAsMCwxLTEtLjQyTDEuNDIsMy40NWExLjQ0LDEuNDQsMCwwLDEsMC0yYz' +\r\n      'AuNTYtLjU2LDkuMzEtMC41Niw5Ljg3LDBhMS40NCwxLjQ0LDAsMCwxLDAsMkw3LjM3LDcuMz' +\r\n      'dBMS40MywxLjQzLDAsMCwxLDYuMzYsNy43OVoiIGZpbGw9IiNmZmYiLz48L3N2Zz4=';\r\n\r\n    /** A colour field's default height. */\r\n    this.FIELD_COLOUR_DEFAULT_HEIGHT = this.FIELD_BORDER_RECT_HEIGHT;\r\n\r\n    /** A checkbox field's X offset. */\r\n    this.FIELD_CHECKBOX_X_OFFSET = this.FIELD_BORDER_RECT_X_PADDING - 3;\r\n\r\n    /**\r\n     * A random identifier used to ensure a unique ID is used for each\r\n     * filter/pattern for the case of multiple Blockly instances on a page.\r\n     */\r\n    this.randomIdentifier = String(Math.random()).substring(2);\r\n  }\r\n\r\n  /**\r\n   * Initialize shape objects based on the constants set in the constructor.\r\n   */\r\n  init() {\r\n    /**\r\n     * An object containing sizing and path information about collapsed block\r\n     * indicators.\r\n     */\r\n    this.JAGGED_TEETH = this.makeJaggedTeeth();\r\n\r\n    /** An object containing sizing and path information about notches. */\r\n    this.NOTCH = this.makeNotch();\r\n\r\n    /** An object containing sizing and path information about start hats */\r\n    this.START_HAT = this.makeStartHat();\r\n\r\n    /**\r\n     * An object containing sizing and path information about puzzle tabs.\r\n     */\r\n    this.PUZZLE_TAB = this.makePuzzleTab();\r\n\r\n    /**\r\n     * An object containing sizing and path information about inside corners\r\n     */\r\n    this.INSIDE_CORNERS = this.makeInsideCorners();\r\n\r\n    /**\r\n     * An object containing sizing and path information about outside corners.\r\n     */\r\n    this.OUTSIDE_CORNERS = this.makeOutsideCorners();\r\n  }\r\n\r\n  /**\r\n   * Refresh constants properties that depend on the theme.\r\n   *\r\n   * @param theme The current workspace theme.\r\n   */\r\n  setTheme(theme: Theme) {\r\n    /** The block styles map. */\r\n    this.blockStyles = Object.create(null);\r\n\r\n    const blockStyles = theme.blockStyles;\r\n    for (const key in blockStyles) {\r\n      this.blockStyles[key] = this.validatedBlockStyle_(blockStyles[key]);\r\n    }\r\n\r\n    this.setDynamicProperties_(theme);\r\n  }\r\n\r\n  /**\r\n   * Sets dynamic properties that depend on other values or theme properties.\r\n   *\r\n   * @param theme The current workspace theme.\r\n   */\r\n  protected setDynamicProperties_(theme: Theme) {\r\n    this.setFontConstants_(theme);\r\n    this.setComponentConstants_(theme);\r\n\r\n    this.ADD_START_HATS =\r\n      theme.startHats !== undefined ? theme.startHats : this.ADD_START_HATS;\r\n  }\r\n\r\n  /**\r\n   * Set constants related to fonts.\r\n   *\r\n   * @param theme The current workspace theme.\r\n   */\r\n  protected setFontConstants_(theme: Theme) {\r\n    if (theme.fontStyle && theme.fontStyle['family']) {\r\n      this.FIELD_TEXT_FONTFAMILY = theme.fontStyle['family'];\r\n    }\r\n\r\n    if (theme.fontStyle && theme.fontStyle['weight']) {\r\n      this.FIELD_TEXT_FONTWEIGHT = theme.fontStyle['weight'];\r\n    }\r\n\r\n    if (theme.fontStyle && theme.fontStyle['size']) {\r\n      this.FIELD_TEXT_FONTSIZE = theme.fontStyle['size'];\r\n    }\r\n\r\n    const fontMetrics = dom.measureFontMetrics(\r\n      'Hg',\r\n      this.FIELD_TEXT_FONTSIZE + 'pt',\r\n      this.FIELD_TEXT_FONTWEIGHT,\r\n      this.FIELD_TEXT_FONTFAMILY,\r\n    );\r\n\r\n    this.FIELD_TEXT_HEIGHT = fontMetrics.height;\r\n    this.FIELD_TEXT_BASELINE = fontMetrics.baseline;\r\n  }\r\n\r\n  /**\r\n   * Set constants from a theme's component styles.\r\n   *\r\n   * @param theme The current workspace theme.\r\n   */\r\n  protected setComponentConstants_(theme: Theme) {\r\n    this.CURSOR_COLOUR =\r\n      theme.getComponentStyle('cursorColour') || this.CURSOR_COLOUR;\r\n    this.MARKER_COLOUR =\r\n      theme.getComponentStyle('markerColour') || this.MARKER_COLOUR;\r\n    this.INSERTION_MARKER_COLOUR =\r\n      theme.getComponentStyle('insertionMarkerColour') ||\r\n      this.INSERTION_MARKER_COLOUR;\r\n    this.INSERTION_MARKER_OPACITY =\r\n      Number(theme.getComponentStyle('insertionMarkerOpacity')) ||\r\n      this.INSERTION_MARKER_OPACITY;\r\n  }\r\n\r\n  /**\r\n   * Get or create a block style based on a single colour value.  Generate a\r\n   * name for the style based on the colour.\r\n   *\r\n   * @param colour #RRGGBB colour string.\r\n   * @returns An object containing the style and an autogenerated name for that\r\n   *     style.\r\n   */\r\n  getBlockStyleForColour(colour: string): {style: BlockStyle; name: string} {\r\n    const name = 'auto_' + colour;\r\n    if (!this.blockStyles[name]) {\r\n      this.blockStyles[name] = this.createBlockStyle_(colour);\r\n    }\r\n    return {style: this.blockStyles[name], name};\r\n  }\r\n\r\n  /**\r\n   * Gets the BlockStyle for the given block style name.\r\n   *\r\n   * @param blockStyleName The name of the block style.\r\n   * @returns The named block style, or a default style if no style with the\r\n   *     given name was found.\r\n   */\r\n  getBlockStyle(blockStyleName: string | null): BlockStyle {\r\n    return (\r\n      this.blockStyles[blockStyleName || ''] ||\r\n      (blockStyleName && blockStyleName.indexOf('auto_') === 0\r\n        ? this.getBlockStyleForColour(blockStyleName.substring(5)).style\r\n        : this.createBlockStyle_('#000000'))\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Create a block style object based on the given colour.\r\n   *\r\n   * @param colour #RRGGBB colour string.\r\n   * @returns A populated block style based on the given colour.\r\n   */\r\n  protected createBlockStyle_(colour: string): BlockStyle {\r\n    return this.validatedBlockStyle_({'colourPrimary': colour});\r\n  }\r\n\r\n  /**\r\n   * Get a full block style object based on the input style object.  Populate\r\n   * any missing values.\r\n   *\r\n   * @param blockStyle A full or partial block style object.\r\n   * @returns A full block style object, with all required properties populated.\r\n   */\r\n  protected validatedBlockStyle_(blockStyle: Partial<BlockStyle>): BlockStyle {\r\n    // Make a new object with all of the same properties.\r\n    const valid = {} as BlockStyle;\r\n    if (blockStyle) {\r\n      Object.assign(valid, blockStyle);\r\n    }\r\n    // Validate required properties.\r\n    const parsedColour = parsing.parseBlockColour(\r\n      valid['colourPrimary'] || '#000',\r\n    );\r\n    valid.colourPrimary = parsedColour.hex;\r\n    valid.colourSecondary = valid['colourSecondary']\r\n      ? parsing.parseBlockColour(valid['colourSecondary']).hex\r\n      : this.generateSecondaryColour_(valid.colourPrimary);\r\n    valid.colourTertiary = valid['colourTertiary']\r\n      ? parsing.parseBlockColour(valid['colourTertiary']).hex\r\n      : this.generateTertiaryColour_(valid.colourPrimary);\r\n\r\n    valid.hat = valid['hat'] || '';\r\n    return valid;\r\n  }\r\n\r\n  /**\r\n   * Generate a secondary colour from the passed in primary colour.\r\n   *\r\n   * @param inputColour Primary colour.\r\n   * @returns The generated secondary colour.\r\n   */\r\n  protected generateSecondaryColour_(inputColour: string): string {\r\n    return colour.blend('#fff', inputColour, 0.6) || inputColour;\r\n  }\r\n\r\n  /**\r\n   * Generate a tertiary colour from the passed in primary colour.\r\n   *\r\n   * @param inputColour Primary colour.\r\n   * @returns The generated tertiary colour.\r\n   */\r\n  protected generateTertiaryColour_(inputColour: string): string {\r\n    return colour.blend('#fff', inputColour, 0.3) || inputColour;\r\n  }\r\n\r\n  /**\r\n   * Dispose of this constants provider.\r\n   * Delete all DOM elements that this provider created.\r\n   */\r\n  dispose() {\r\n    if (this.embossFilter) {\r\n      dom.removeNode(this.embossFilter);\r\n    }\r\n    if (this.disabledPattern) {\r\n      dom.removeNode(this.disabledPattern);\r\n    }\r\n    if (this.debugFilter) {\r\n      dom.removeNode(this.debugFilter);\r\n    }\r\n    this.cssNode = null;\r\n  }\r\n\r\n  /**\r\n   * @returns An object containing sizing and path information about collapsed\r\n   *     block indicators.\r\n   */\r\n  protected makeJaggedTeeth(): JaggedTeeth {\r\n    const height = this.JAGGED_TEETH_HEIGHT;\r\n    const width = this.JAGGED_TEETH_WIDTH;\r\n\r\n    const mainPath = svgPaths.line([\r\n      svgPaths.point(width, height / 4),\r\n      svgPaths.point(-width * 2, height / 2),\r\n      svgPaths.point(width, height / 4),\r\n    ]);\r\n    return {height, width, path: mainPath};\r\n  }\r\n\r\n  /**\r\n   * @returns An object containing sizing and path information about start hats.\r\n   */\r\n  protected makeStartHat(): StartHat {\r\n    const height = this.START_HAT_HEIGHT;\r\n    const width = this.START_HAT_WIDTH;\r\n\r\n    const mainPath = svgPaths.curve('c', [\r\n      svgPaths.point(30, -height),\r\n      svgPaths.point(70, -height),\r\n      svgPaths.point(width, 0),\r\n    ]);\r\n    return {height, width, path: mainPath};\r\n  }\r\n\r\n  /**\r\n   * @returns An object containing sizing and path information about puzzle\r\n   *     tabs.\r\n   */\r\n  protected makePuzzleTab(): PuzzleTab {\r\n    const width = this.TAB_WIDTH;\r\n    const height = this.TAB_HEIGHT;\r\n\r\n    /**\r\n     * Make the main path for the puzzle tab made out of a few curves (c and s).\r\n     * Those curves are defined with relative positions.  The 'up' and 'down'\r\n     * versions of the paths are the same, but the Y sign flips.  Forward and\r\n     * back are the signs to use to move the cursor in the direction that the\r\n     * path is being drawn.\r\n     *\r\n     * @param up True if the path should be drawn from bottom to top, false\r\n     *     otherwise.\r\n     * @returns A path fragment describing a puzzle tab.\r\n     */\r\n    function makeMainPath(up: boolean): string {\r\n      const forward = up ? -1 : 1;\r\n      const back = -forward;\r\n\r\n      const overlap = 2.5;\r\n      const halfHeight = height / 2;\r\n      const control1Y = halfHeight + overlap;\r\n      const control2Y = halfHeight + 0.5;\r\n      const control3Y = overlap; // 2.5\r\n\r\n      const endPoint1 = svgPaths.point(-width, forward * halfHeight);\r\n      const endPoint2 = svgPaths.point(width, forward * halfHeight);\r\n\r\n      return (\r\n        svgPaths.curve('c', [\r\n          svgPaths.point(0, forward * control1Y),\r\n          svgPaths.point(-width, back * control2Y),\r\n          endPoint1,\r\n        ]) +\r\n        svgPaths.curve('s', [\r\n          svgPaths.point(width, back * control3Y),\r\n          endPoint2,\r\n        ])\r\n      );\r\n    }\r\n\r\n    // c 0,-10  -8,8  -8,-7.5  s 8,2.5  8,-7.5\r\n    const pathUp = makeMainPath(true);\r\n    // c 0,10  -8,-8  -8,7.5  s 8,-2.5  8,7.5\r\n    const pathDown = makeMainPath(false);\r\n\r\n    return {\r\n      type: this.SHAPES.PUZZLE,\r\n      width,\r\n      height,\r\n      pathDown,\r\n      pathUp,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * @returns An object containing sizing and path information about notches.\r\n   */\r\n  protected makeNotch(): Notch {\r\n    const width = this.NOTCH_WIDTH;\r\n    const height = this.NOTCH_HEIGHT;\r\n    const innerWidth = 3;\r\n    const outerWidth = (width - innerWidth) / 2;\r\n\r\n    /**\r\n     * Make the main path for the notch.\r\n     *\r\n     * @param dir Direction multiplier to apply to horizontal offsets along the\r\n     *     path. Either 1 or -1.\r\n     * @returns A path fragment describing a notch.\r\n     */\r\n    function makeMainPath(dir: number): string {\r\n      return svgPaths.line([\r\n        svgPaths.point(dir * outerWidth, height),\r\n        svgPaths.point(dir * innerWidth, 0),\r\n        svgPaths.point(dir * outerWidth, -height),\r\n      ]);\r\n    }\r\n    const pathLeft = makeMainPath(1);\r\n    const pathRight = makeMainPath(-1);\r\n\r\n    return {\r\n      type: this.SHAPES.NOTCH,\r\n      width,\r\n      height,\r\n      pathLeft,\r\n      pathRight,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * @returns An object containing sizing and path information about inside\r\n   *     corners.\r\n   */\r\n  protected makeInsideCorners(): InsideCorners {\r\n    const radius = this.CORNER_RADIUS;\r\n\r\n    const innerTopLeftCorner = svgPaths.arc(\r\n      'a',\r\n      '0 0,0',\r\n      radius,\r\n      svgPaths.point(-radius, radius),\r\n    );\r\n\r\n    const innerBottomLeftCorner = svgPaths.arc(\r\n      'a',\r\n      '0 0,0',\r\n      radius,\r\n      svgPaths.point(radius, radius),\r\n    );\r\n\r\n    return {\r\n      width: radius,\r\n      height: radius,\r\n      pathTop: innerTopLeftCorner,\r\n      pathBottom: innerBottomLeftCorner,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * @returns An object containing sizing and path information about outside\r\n   *     corners.\r\n   */\r\n  protected makeOutsideCorners(): OutsideCorners {\r\n    const radius = this.CORNER_RADIUS;\r\n    /** SVG path for drawing the rounded top-left corner. */\r\n    const topLeft =\r\n      svgPaths.moveBy(0, radius) +\r\n      svgPaths.arc('a', '0 0,1', radius, svgPaths.point(radius, -radius));\r\n\r\n    /** SVG path for drawing the rounded top-right corner. */\r\n    const topRight = svgPaths.arc(\r\n      'a',\r\n      '0 0,1',\r\n      radius,\r\n      svgPaths.point(radius, radius),\r\n    );\r\n\r\n    /** SVG path for drawing the rounded bottom-left corner. */\r\n    const bottomLeft = svgPaths.arc(\r\n      'a',\r\n      '0 0,1',\r\n      radius,\r\n      svgPaths.point(-radius, -radius),\r\n    );\r\n\r\n    /** SVG path for drawing the rounded bottom-right corner. */\r\n    const bottomRight = svgPaths.arc(\r\n      'a',\r\n      '0 0,1',\r\n      radius,\r\n      svgPaths.point(-radius, radius),\r\n    );\r\n\r\n    return {\r\n      topLeft,\r\n      topRight,\r\n      bottomRight,\r\n      bottomLeft,\r\n      rightHeight: radius,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get an object with connection shape and sizing information based on the\r\n   * type of the connection.\r\n   *\r\n   * @param connection The connection to find a shape object for\r\n   * @returns The shape object for the connection.\r\n   */\r\n  shapeFor(connection: RenderedConnection): Shape {\r\n    switch (connection.type) {\r\n      case ConnectionType.INPUT_VALUE:\r\n      case ConnectionType.OUTPUT_VALUE:\r\n        return this.PUZZLE_TAB;\r\n      case ConnectionType.PREVIOUS_STATEMENT:\r\n      case ConnectionType.NEXT_STATEMENT:\r\n        return this.NOTCH;\r\n      default:\r\n        throw Error('Unknown connection type');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create any DOM elements that this renderer needs (filters, patterns, etc).\r\n   *\r\n   * @param svg The root of the workspace's SVG.\r\n   * @param tagName The name to use for the CSS style tag.\r\n   * @param selector The CSS selector to use.\r\n   */\r\n  createDom(svg: SVGElement, tagName: string, selector: string) {\r\n    this.injectCSS_(tagName, selector);\r\n\r\n    /*\r\n        <defs>\r\n          ... filters go here ...\r\n        </defs>\r\n        */\r\n    this.defs = dom.createSvgElement(Svg.DEFS, {}, svg);\r\n    /*\r\n          <filter id=\"blocklyEmbossFilter837493\">\r\n            <feGaussianBlur in=\"SourceAlpha\" stdDeviation=\"1\" result=\"blur\" />\r\n            <feSpecularLighting in=\"blur\" surfaceScale=\"1\"\r\n       specularConstant=\"0.5\" specularExponent=\"10\" lighting-color=\"white\"\r\n                                result=\"specOut\">\r\n              <fePointLight x=\"-5000\" y=\"-10000\" z=\"20000\" />\r\n            </feSpecularLighting>\r\n            <feComposite in=\"specOut\" in2=\"SourceAlpha\" operator=\"in\"\r\n                         result=\"specOut\" />\r\n            <feComposite in=\"SourceGraphic\" in2=\"specOut\" operator=\"arithmetic\"\r\n                         k1=\"0\" k2=\"1\" k3=\"1\" k4=\"0\" />\r\n          </filter>\r\n        */\r\n    const embossFilter = dom.createSvgElement(\r\n      Svg.FILTER,\r\n      {'id': 'blocklyEmbossFilter' + this.randomIdentifier},\r\n      this.defs,\r\n    );\r\n    dom.createSvgElement(\r\n      Svg.FEGAUSSIANBLUR,\r\n      {'in': 'SourceAlpha', 'stdDeviation': 1, 'result': 'blur'},\r\n      embossFilter,\r\n    );\r\n    const feSpecularLighting = dom.createSvgElement(\r\n      Svg.FESPECULARLIGHTING,\r\n      {\r\n        'in': 'blur',\r\n        'surfaceScale': 1,\r\n        'specularConstant': 0.5,\r\n        'specularExponent': 10,\r\n        'lighting-color': 'white',\r\n        'result': 'specOut',\r\n      },\r\n      embossFilter,\r\n    );\r\n    dom.createSvgElement(\r\n      Svg.FEPOINTLIGHT,\r\n      {'x': -5000, 'y': -10000, 'z': 20000},\r\n      feSpecularLighting,\r\n    );\r\n    dom.createSvgElement(\r\n      Svg.FECOMPOSITE,\r\n      {\r\n        'in': 'specOut',\r\n        'in2': 'SourceAlpha',\r\n        'operator': 'in',\r\n        'result': 'specOut',\r\n      },\r\n      embossFilter,\r\n    );\r\n    dom.createSvgElement(\r\n      Svg.FECOMPOSITE,\r\n      {\r\n        'in': 'SourceGraphic',\r\n        'in2': 'specOut',\r\n        'operator': 'arithmetic',\r\n        'k1': 0,\r\n        'k2': 1,\r\n        'k3': 1,\r\n        'k4': 0,\r\n      },\r\n      embossFilter,\r\n    );\r\n    this.embossFilterId = embossFilter.id;\r\n    this.embossFilter = embossFilter;\r\n\r\n    /*\r\n          <pattern id=\"blocklyDisabledPattern837493\"\r\n       patternUnits=\"userSpaceOnUse\" width=\"10\" height=\"10\"> <rect width=\"10\"\r\n       height=\"10\" fill=\"#aaa\" /> <path d=\"M 0 0 L 10 10 M 10 0 L 0 10\"\r\n       stroke=\"#cc0\" />\r\n          </pattern>\r\n        */\r\n    const disabledPattern = dom.createSvgElement(\r\n      Svg.PATTERN,\r\n      {\r\n        'id': 'blocklyDisabledPattern' + this.randomIdentifier,\r\n        'patternUnits': 'userSpaceOnUse',\r\n        'width': 10,\r\n        'height': 10,\r\n      },\r\n      this.defs,\r\n    );\r\n    dom.createSvgElement(\r\n      Svg.RECT,\r\n      {'width': 10, 'height': 10, 'fill': '#aaa'},\r\n      disabledPattern,\r\n    );\r\n    dom.createSvgElement(\r\n      Svg.PATH,\r\n      {'d': 'M 0 0 L 10 10 M 10 0 L 0 10', 'stroke': '#cc0'},\r\n      disabledPattern,\r\n    );\r\n    this.disabledPatternId = disabledPattern.id;\r\n    this.disabledPattern = disabledPattern;\r\n\r\n    this.createDebugFilter();\r\n  }\r\n\r\n  /**\r\n   * Create a filter for highlighting the currently rendering block during\r\n   * render debugging.\r\n   */\r\n  private createDebugFilter() {\r\n    // Only create the debug filter once.\r\n    if (!this.debugFilter) {\r\n      const debugFilter = dom.createSvgElement(\r\n        Svg.FILTER,\r\n        {\r\n          'id': 'blocklyDebugFilter' + this.randomIdentifier,\r\n          'height': '160%',\r\n          'width': '180%',\r\n          'y': '-30%',\r\n          'x': '-40%',\r\n        },\r\n        this.defs,\r\n      );\r\n      // Set all gaussian blur pixels to 1 opacity before applying flood\r\n      const debugComponentTransfer = dom.createSvgElement(\r\n        Svg.FECOMPONENTTRANSFER,\r\n        {'result': 'outBlur'},\r\n        debugFilter,\r\n      );\r\n      dom.createSvgElement(\r\n        Svg.FEFUNCA,\r\n        {'type': 'table', 'tableValues': '0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1'},\r\n        debugComponentTransfer,\r\n      );\r\n      // Color the highlight\r\n      dom.createSvgElement(\r\n        Svg.FEFLOOD,\r\n        {\r\n          'flood-color': '#ff0000',\r\n          'flood-opacity': 0.5,\r\n          'result': 'outColor',\r\n        },\r\n        debugFilter,\r\n      );\r\n      dom.createSvgElement(\r\n        Svg.FECOMPOSITE,\r\n        {\r\n          'in': 'outColor',\r\n          'in2': 'outBlur',\r\n          'operator': 'in',\r\n          'result': 'outGlow',\r\n        },\r\n        debugFilter,\r\n      );\r\n      this.debugFilterId = debugFilter.id;\r\n      this.debugFilter = debugFilter;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Inject renderer specific CSS into the page.\r\n   *\r\n   * @param tagName The name of the style tag to use.\r\n   * @param selector The CSS selector to use.\r\n   */\r\n  protected injectCSS_(tagName: string, selector: string) {\r\n    const cssArray = this.getCSS_(selector);\r\n    const cssNodeId = 'blockly-renderer-style-' + tagName;\r\n    this.cssNode = document.getElementById(cssNodeId) as HTMLStyleElement;\r\n    const text = cssArray.join('\\n');\r\n    if (this.cssNode) {\r\n      // Already injected, update if the theme changed.\r\n      this.cssNode.firstChild!.textContent = text;\r\n      return;\r\n    }\r\n    // Inject CSS tag at start of head.\r\n    const cssNode = document.createElement('style');\r\n    cssNode.id = cssNodeId;\r\n    const cssTextNode = document.createTextNode(text);\r\n    cssNode.appendChild(cssTextNode);\r\n    document.head.insertBefore(cssNode, document.head.firstChild);\r\n    this.cssNode = cssNode;\r\n  }\r\n\r\n  /**\r\n   * Get any renderer specific CSS to inject when the renderer is initialized.\r\n   *\r\n   * @param selector CSS selector to use.\r\n   * @returns Array of CSS strings.\r\n   */\r\n  protected getCSS_(selector: string): string[] {\r\n    // prettier-ignore\r\n    return [\r\n      // Text.\r\n      `${selector} .blocklyText, `,\r\n      `${selector} .blocklyFlyoutLabelText {`,\r\n        `font: ${this.FIELD_TEXT_FONTWEIGHT} ` +\r\n            `${this.FIELD_TEXT_FONTSIZE}pt ${this.FIELD_TEXT_FONTFAMILY};`,\r\n      `}`,\r\n\r\n      // Fields.\r\n      `${selector} .blocklyText {`,\r\n        `fill: #fff;`,\r\n      `}`,\r\n      `${selector} .blocklyNonEditableText>rect,`,\r\n      `${selector} .blocklyEditableText>rect {`,\r\n        `fill: ${this.FIELD_BORDER_RECT_COLOUR};`,\r\n        `fill-opacity: .6;`,\r\n        `stroke: none;`,\r\n      `}`,\r\n      `${selector} .blocklyNonEditableText>text,`,\r\n      `${selector} .blocklyEditableText>text {`,\r\n        `fill: #000;`,\r\n      `}`,\r\n\r\n      // Flyout labels.\r\n      `${selector} .blocklyFlyoutLabelText {`,\r\n        `fill: #000;`,\r\n      `}`,\r\n\r\n      // Bubbles.\r\n      `${selector} .blocklyText.blocklyBubbleText {`,\r\n        `fill: #000;`,\r\n      `}`,\r\n\r\n      // Editable field hover.\r\n      `${selector} .blocklyEditableText:not(.editing):hover>rect {`,\r\n        `stroke: #fff;`,\r\n        `stroke-width: 2;`,\r\n      `}`,\r\n\r\n      // Text field input.\r\n      `${selector} .blocklyHtmlInput {`,\r\n        `font-family: ${this.FIELD_TEXT_FONTFAMILY};`,\r\n        `font-weight: ${this.FIELD_TEXT_FONTWEIGHT};`,\r\n      `}`,\r\n\r\n      // Selection highlight.\r\n      `${selector} .blocklySelected>.blocklyPath {`,\r\n        `stroke: #fc3;`,\r\n        `stroke-width: 3px;`,\r\n      `}`,\r\n\r\n      // Connection highlight.\r\n      `${selector} .blocklyHighlightedConnectionPath {`,\r\n        `stroke: #fc3;`,\r\n      `}`,\r\n\r\n      // Replaceable highlight.\r\n      `${selector} .blocklyReplaceable .blocklyPath {`,\r\n        `fill-opacity: .5;`,\r\n      `}`,\r\n      `${selector} .blocklyReplaceable .blocklyPathLight,`,\r\n      `${selector} .blocklyReplaceable .blocklyPathDark {`,\r\n        `display: none;`,\r\n      `}`,\r\n\r\n      // Insertion marker.\r\n      `${selector} .blocklyInsertionMarker>.blocklyPath {`,\r\n        `fill-opacity: ${this.INSERTION_MARKER_OPACITY};`,\r\n        `stroke: none;`,\r\n      `}`,\r\n    ];\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * The class representing an AST node.\r\n * Used to traverse the Blockly AST.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.ASTNode\r\n\r\nimport type {Block} from '../block.js';\r\nimport type {Connection} from '../connection.js';\r\nimport {ConnectionType} from '../connection_type.js';\r\nimport type {Field} from '../field.js';\r\nimport type {Input} from '../inputs/input.js';\r\nimport type {IASTNodeLocation} from '../interfaces/i_ast_node_location.js';\r\nimport type {IASTNodeLocationWithBlock} from '../interfaces/i_ast_node_location_with_block.js';\r\nimport {Coordinate} from '../utils/coordinate.js';\r\nimport type {Workspace} from '../workspace.js';\r\n\r\n/**\r\n * Class for an AST node.\r\n * It is recommended that you use one of the createNode methods instead of\r\n * creating a node directly.\r\n */\r\nexport class ASTNode {\r\n  /**\r\n   * True to navigate to all fields. False to only navigate to clickable fields.\r\n   */\r\n  static NAVIGATE_ALL_FIELDS = false;\r\n\r\n  /**\r\n   * The default y offset to use when moving the cursor from a stack to the\r\n   * workspace.\r\n   */\r\n  private static readonly DEFAULT_OFFSET_Y: number = -20;\r\n  private readonly type: string;\r\n  private readonly isConnectionLocation: boolean;\r\n  private readonly location: IASTNodeLocation;\r\n\r\n  /** The coordinate on the workspace. */\r\n  // AnyDuringMigration because:  Type 'null' is not assignable to type\r\n  // 'Coordinate'.\r\n  private wsCoordinate: Coordinate = null as AnyDuringMigration;\r\n\r\n  /**\r\n   * @param type The type of the location.\r\n   *     Must be in ASTNode.types.\r\n   * @param location The position in the AST.\r\n   * @param opt_params Optional dictionary of options.\r\n   */\r\n  constructor(type: string, location: IASTNodeLocation, opt_params?: Params) {\r\n    if (!location) {\r\n      throw Error('Cannot create a node without a location.');\r\n    }\r\n\r\n    /**\r\n     * The type of the location.\r\n     * One of ASTNode.types\r\n     */\r\n    this.type = type;\r\n\r\n    /** Whether the location points to a connection. */\r\n    this.isConnectionLocation = ASTNode.isConnectionType(type);\r\n\r\n    /** The location of the AST node. */\r\n    this.location = location;\r\n\r\n    this.processParams(opt_params || null);\r\n  }\r\n\r\n  /**\r\n   * Parse the optional parameters.\r\n   *\r\n   * @param params The user specified parameters.\r\n   */\r\n  private processParams(params: Params | null) {\r\n    if (!params) {\r\n      return;\r\n    }\r\n    if (params.wsCoordinate) {\r\n      this.wsCoordinate = params.wsCoordinate;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets the value pointed to by this node.\r\n   * It is the callers responsibility to check the node type to figure out what\r\n   * type of object they get back from this.\r\n   *\r\n   * @returns The current field, connection, workspace, or block the cursor is\r\n   *     on.\r\n   */\r\n  getLocation(): IASTNodeLocation {\r\n    return this.location;\r\n  }\r\n\r\n  /**\r\n   * The type of the current location.\r\n   * One of ASTNode.types\r\n   *\r\n   * @returns The type of the location.\r\n   */\r\n  getType(): string {\r\n    return this.type;\r\n  }\r\n\r\n  /**\r\n   * The coordinate on the workspace.\r\n   *\r\n   * @returns The workspace coordinate or null if the location is not a\r\n   *     workspace.\r\n   */\r\n  getWsCoordinate(): Coordinate {\r\n    return this.wsCoordinate;\r\n  }\r\n\r\n  /**\r\n   * Whether the node points to a connection.\r\n   *\r\n   * @returns [description]\r\n   * @internal\r\n   */\r\n  isConnection(): boolean {\r\n    return this.isConnectionLocation;\r\n  }\r\n\r\n  /**\r\n   * Given an input find the next editable field or an input with a non null\r\n   * connection in the same block. The current location must be an input\r\n   * connection.\r\n   *\r\n   * @returns The AST node holding the next field or connection or null if there\r\n   *     is no editable field or input connection after the given input.\r\n   */\r\n  private findNextForInput(): ASTNode | null {\r\n    const location = this.location as Connection;\r\n    const parentInput = location.getParentInput();\r\n    const block = parentInput!.getSourceBlock();\r\n    // AnyDuringMigration because:  Argument of type 'Input | null' is not\r\n    // assignable to parameter of type 'Input'.\r\n    const curIdx = block!.inputList.indexOf(parentInput as AnyDuringMigration);\r\n    for (let i = curIdx + 1; i < block!.inputList.length; i++) {\r\n      const input = block!.inputList[i];\r\n      const fieldRow = input.fieldRow;\r\n      for (let j = 0; j < fieldRow.length; j++) {\r\n        const field = fieldRow[j];\r\n        if (field.isClickable() || ASTNode.NAVIGATE_ALL_FIELDS) {\r\n          return ASTNode.createFieldNode(field);\r\n        }\r\n      }\r\n      if (input.connection) {\r\n        return ASTNode.createInputNode(input);\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Given a field find the next editable field or an input with a non null\r\n   * connection in the same block. The current location must be a field.\r\n   *\r\n   * @returns The AST node pointing to the next field or connection or null if\r\n   *     there is no editable field or input connection after the given input.\r\n   */\r\n  private findNextForField(): ASTNode | null {\r\n    const location = this.location as Field;\r\n    const input = location.getParentInput();\r\n    const block = location.getSourceBlock();\r\n    if (!block) {\r\n      throw new Error(\r\n        'The current AST location is not associated with a block',\r\n      );\r\n    }\r\n    const curIdx = block.inputList.indexOf(input);\r\n    let fieldIdx = input.fieldRow.indexOf(location) + 1;\r\n    for (let i = curIdx; i < block.inputList.length; i++) {\r\n      const newInput = block.inputList[i];\r\n      const fieldRow = newInput.fieldRow;\r\n      while (fieldIdx < fieldRow.length) {\r\n        if (fieldRow[fieldIdx].isClickable() || ASTNode.NAVIGATE_ALL_FIELDS) {\r\n          return ASTNode.createFieldNode(fieldRow[fieldIdx]);\r\n        }\r\n        fieldIdx++;\r\n      }\r\n      fieldIdx = 0;\r\n      if (newInput.connection) {\r\n        return ASTNode.createInputNode(newInput);\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Given an input find the previous editable field or an input with a non null\r\n   * connection in the same block. The current location must be an input\r\n   * connection.\r\n   *\r\n   * @returns The AST node holding the previous field or connection.\r\n   */\r\n  private findPrevForInput(): ASTNode | null {\r\n    const location = this.location as Connection;\r\n    const parentInput = location.getParentInput();\r\n    const block = parentInput!.getSourceBlock();\r\n    // AnyDuringMigration because:  Argument of type 'Input | null' is not\r\n    // assignable to parameter of type 'Input'.\r\n    const curIdx = block!.inputList.indexOf(parentInput as AnyDuringMigration);\r\n    for (let i = curIdx; i >= 0; i--) {\r\n      const input = block!.inputList[i];\r\n      if (input.connection && input !== parentInput) {\r\n        return ASTNode.createInputNode(input);\r\n      }\r\n      const fieldRow = input.fieldRow;\r\n      for (let j = fieldRow.length - 1; j >= 0; j--) {\r\n        const field = fieldRow[j];\r\n        if (field.isClickable() || ASTNode.NAVIGATE_ALL_FIELDS) {\r\n          return ASTNode.createFieldNode(field);\r\n        }\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Given a field find the previous editable field or an input with a non null\r\n   * connection in the same block. The current location must be a field.\r\n   *\r\n   * @returns The AST node holding the previous input or field.\r\n   */\r\n  private findPrevForField(): ASTNode | null {\r\n    const location = this.location as Field;\r\n    const parentInput = location.getParentInput();\r\n    const block = location.getSourceBlock();\r\n    if (!block) {\r\n      throw new Error(\r\n        'The current AST location is not associated with a block',\r\n      );\r\n    }\r\n    const curIdx = block.inputList.indexOf(parentInput);\r\n    let fieldIdx = parentInput.fieldRow.indexOf(location) - 1;\r\n    for (let i = curIdx; i >= 0; i--) {\r\n      const input = block.inputList[i];\r\n      if (input.connection && input !== parentInput) {\r\n        return ASTNode.createInputNode(input);\r\n      }\r\n      const fieldRow = input.fieldRow;\r\n      while (fieldIdx > -1) {\r\n        if (fieldRow[fieldIdx].isClickable() || ASTNode.NAVIGATE_ALL_FIELDS) {\r\n          return ASTNode.createFieldNode(fieldRow[fieldIdx]);\r\n        }\r\n        fieldIdx--;\r\n      }\r\n      // Reset the fieldIdx to the length of the field row of the previous\r\n      // input.\r\n      if (i - 1 >= 0) {\r\n        fieldIdx = block.inputList[i - 1].fieldRow.length - 1;\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Navigate between stacks of blocks on the workspace.\r\n   *\r\n   * @param forward True to go forward. False to go backwards.\r\n   * @returns The first block of the next stack or null if there are no blocks\r\n   *     on the workspace.\r\n   */\r\n  private navigateBetweenStacks(forward: boolean): ASTNode | null {\r\n    let curLocation = this.getLocation();\r\n    // TODO(#6097): Use instanceof checks to exit early for values of\r\n    // curLocation that don't make sense.\r\n    if ((curLocation as IASTNodeLocationWithBlock).getSourceBlock) {\r\n      const block = (curLocation as IASTNodeLocationWithBlock).getSourceBlock();\r\n      if (block) {\r\n        curLocation = block;\r\n      }\r\n    }\r\n    // TODO(#6097): Use instanceof checks to exit early for values of\r\n    // curLocation that don't make sense.\r\n    const curLocationAsBlock = curLocation as Block;\r\n    if (!curLocationAsBlock || curLocationAsBlock.isDeadOrDying()) {\r\n      return null;\r\n    }\r\n    const curRoot = curLocationAsBlock.getRootBlock();\r\n    const topBlocks = curRoot.workspace.getTopBlocks(true);\r\n    for (let i = 0; i < topBlocks.length; i++) {\r\n      const topBlock = topBlocks[i];\r\n      if (curRoot.id === topBlock.id) {\r\n        const offset = forward ? 1 : -1;\r\n        const resultIndex = i + offset;\r\n        if (resultIndex === -1 || resultIndex === topBlocks.length) {\r\n          return null;\r\n        }\r\n        return ASTNode.createStackNode(topBlocks[resultIndex]);\r\n      }\r\n    }\r\n    throw Error(\r\n      \"Couldn't find \" + (forward ? 'next' : 'previous') + ' stack?!',\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Finds the top most AST node for a given block.\r\n   * This is either the previous connection, output connection or block\r\n   * depending on what kind of connections the block has.\r\n   *\r\n   * @param block The block that we want to find the top connection on.\r\n   * @returns The AST node containing the top connection.\r\n   */\r\n  private findTopASTNodeForBlock(block: Block): ASTNode | null {\r\n    const topConnection = getParentConnection(block);\r\n    if (topConnection) {\r\n      return ASTNode.createConnectionNode(topConnection);\r\n    } else {\r\n      return ASTNode.createBlockNode(block);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the AST node pointing to the input that the block is nested under or if\r\n   * the block is not nested then get the stack AST node.\r\n   *\r\n   * @param block The source block of the current location.\r\n   * @returns The AST node pointing to the input connection or the top block of\r\n   *     the stack this block is in.\r\n   */\r\n  private getOutAstNodeForBlock(block: Block): ASTNode | null {\r\n    if (!block) {\r\n      return null;\r\n    }\r\n    // If the block doesn't have a previous connection then it is the top of the\r\n    // substack.\r\n    const topBlock = block.getTopStackBlock();\r\n    const topConnection = getParentConnection(topBlock);\r\n    // If the top connection has a parentInput, create an AST node pointing to\r\n    // that input.\r\n    if (\r\n      topConnection &&\r\n      topConnection.targetConnection &&\r\n      topConnection.targetConnection.getParentInput()\r\n    ) {\r\n      // AnyDuringMigration because:  Argument of type 'Input | null' is not\r\n      // assignable to parameter of type 'Input'.\r\n      return ASTNode.createInputNode(\r\n        topConnection.targetConnection.getParentInput() as AnyDuringMigration,\r\n      );\r\n    } else {\r\n      // Go to stack level if you are not underneath an input.\r\n      return ASTNode.createStackNode(topBlock);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Find the first editable field or input with a connection on a given block.\r\n   *\r\n   * @param block The source block of the current location.\r\n   * @returns An AST node pointing to the first field or input.\r\n   * Null if there are no editable fields or inputs with connections on the\r\n   * block.\r\n   */\r\n  private findFirstFieldOrInput(block: Block): ASTNode | null {\r\n    const inputs = block.inputList;\r\n    for (let i = 0; i < inputs.length; i++) {\r\n      const input = inputs[i];\r\n      const fieldRow = input.fieldRow;\r\n      for (let j = 0; j < fieldRow.length; j++) {\r\n        const field = fieldRow[j];\r\n        if (field.isClickable() || ASTNode.NAVIGATE_ALL_FIELDS) {\r\n          return ASTNode.createFieldNode(field);\r\n        }\r\n      }\r\n      if (input.connection) {\r\n        return ASTNode.createInputNode(input);\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Finds the source block of the location of this node.\r\n   *\r\n   * @returns The source block of the location, or null if the node is of type\r\n   *     workspace.\r\n   */\r\n  getSourceBlock(): Block | null {\r\n    if (this.getType() === ASTNode.types.BLOCK) {\r\n      return this.getLocation() as Block;\r\n    } else if (this.getType() === ASTNode.types.STACK) {\r\n      return this.getLocation() as Block;\r\n    } else if (this.getType() === ASTNode.types.WORKSPACE) {\r\n      return null;\r\n    } else {\r\n      return (this.getLocation() as IASTNodeLocationWithBlock).getSourceBlock();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Find the element to the right of the current element in the AST.\r\n   *\r\n   * @returns An AST node that wraps the next field, connection, block, or\r\n   *     workspace. Or null if there is no node to the right.\r\n   */\r\n  next(): ASTNode | null {\r\n    switch (this.type) {\r\n      case ASTNode.types.STACK:\r\n        return this.navigateBetweenStacks(true);\r\n\r\n      case ASTNode.types.OUTPUT: {\r\n        const connection = this.location as Connection;\r\n        return ASTNode.createBlockNode(connection.getSourceBlock());\r\n      }\r\n      case ASTNode.types.FIELD:\r\n        return this.findNextForField();\r\n\r\n      case ASTNode.types.INPUT:\r\n        return this.findNextForInput();\r\n\r\n      case ASTNode.types.BLOCK: {\r\n        const block = this.location as Block;\r\n        const nextConnection = block.nextConnection;\r\n        if (!nextConnection) return null;\r\n        return ASTNode.createConnectionNode(nextConnection);\r\n      }\r\n      case ASTNode.types.PREVIOUS: {\r\n        const connection = this.location as Connection;\r\n        return ASTNode.createBlockNode(connection.getSourceBlock());\r\n      }\r\n      case ASTNode.types.NEXT: {\r\n        const connection = this.location as Connection;\r\n        const targetConnection = connection.targetConnection;\r\n        return ASTNode.createConnectionNode(targetConnection!);\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Find the element one level below and all the way to the left of the current\r\n   * location.\r\n   *\r\n   * @returns An AST node that wraps the next field, connection, workspace, or\r\n   *     block. Or null if there is nothing below this node.\r\n   */\r\n  in(): ASTNode | null {\r\n    switch (this.type) {\r\n      case ASTNode.types.WORKSPACE: {\r\n        const workspace = this.location as Workspace;\r\n        const topBlocks = workspace.getTopBlocks(true);\r\n        if (topBlocks.length > 0) {\r\n          return ASTNode.createStackNode(topBlocks[0]);\r\n        }\r\n        break;\r\n      }\r\n      case ASTNode.types.STACK: {\r\n        const block = this.location as Block;\r\n        return this.findTopASTNodeForBlock(block);\r\n      }\r\n      case ASTNode.types.BLOCK: {\r\n        const block = this.location as Block;\r\n        return this.findFirstFieldOrInput(block);\r\n      }\r\n      case ASTNode.types.INPUT: {\r\n        const connection = this.location as Connection;\r\n        const targetConnection = connection.targetConnection;\r\n        return ASTNode.createConnectionNode(targetConnection!);\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Find the element to the left of the current element in the AST.\r\n   *\r\n   * @returns An AST node that wraps the previous field, connection, workspace\r\n   *     or block. Or null if no node exists to the left. null.\r\n   */\r\n  prev(): ASTNode | null {\r\n    switch (this.type) {\r\n      case ASTNode.types.STACK:\r\n        return this.navigateBetweenStacks(false);\r\n\r\n      case ASTNode.types.OUTPUT:\r\n        return null;\r\n\r\n      case ASTNode.types.FIELD:\r\n        return this.findPrevForField();\r\n\r\n      case ASTNode.types.INPUT:\r\n        return this.findPrevForInput();\r\n\r\n      case ASTNode.types.BLOCK: {\r\n        const block = this.location as Block;\r\n        const topConnection = getParentConnection(block);\r\n        if (!topConnection) return null;\r\n        return ASTNode.createConnectionNode(topConnection);\r\n      }\r\n      case ASTNode.types.PREVIOUS: {\r\n        const connection = this.location as Connection;\r\n        const targetConnection = connection.targetConnection;\r\n        if (targetConnection && !targetConnection.getParentInput()) {\r\n          return ASTNode.createConnectionNode(targetConnection);\r\n        }\r\n        break;\r\n      }\r\n      case ASTNode.types.NEXT: {\r\n        const connection = this.location as Connection;\r\n        return ASTNode.createBlockNode(connection.getSourceBlock());\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Find the next element that is one position above and all the way to the\r\n   * left of the current location.\r\n   *\r\n   * @returns An AST node that wraps the next field, connection, workspace or\r\n   *     block. Or null if we are at the workspace level.\r\n   */\r\n  out(): ASTNode | null {\r\n    switch (this.type) {\r\n      case ASTNode.types.STACK: {\r\n        const block = this.location as Block;\r\n        const blockPos = block.getRelativeToSurfaceXY();\r\n        // TODO: Make sure this is in the bounds of the workspace.\r\n        const wsCoordinate = new Coordinate(\r\n          blockPos.x,\r\n          blockPos.y + ASTNode.DEFAULT_OFFSET_Y,\r\n        );\r\n        return ASTNode.createWorkspaceNode(block.workspace, wsCoordinate);\r\n      }\r\n      case ASTNode.types.OUTPUT: {\r\n        const connection = this.location as Connection;\r\n        const target = connection.targetConnection;\r\n        if (target) {\r\n          return ASTNode.createConnectionNode(target);\r\n        }\r\n        return ASTNode.createStackNode(connection.getSourceBlock());\r\n      }\r\n      case ASTNode.types.FIELD: {\r\n        const field = this.location as Field;\r\n        const block = field.getSourceBlock();\r\n        if (!block) {\r\n          throw new Error(\r\n            'The current AST location is not associated with a block',\r\n          );\r\n        }\r\n        return ASTNode.createBlockNode(block);\r\n      }\r\n      case ASTNode.types.INPUT: {\r\n        const connection = this.location as Connection;\r\n        return ASTNode.createBlockNode(connection.getSourceBlock());\r\n      }\r\n      case ASTNode.types.BLOCK: {\r\n        const block = this.location as Block;\r\n        return this.getOutAstNodeForBlock(block);\r\n      }\r\n      case ASTNode.types.PREVIOUS: {\r\n        const connection = this.location as Connection;\r\n        return this.getOutAstNodeForBlock(connection.getSourceBlock());\r\n      }\r\n      case ASTNode.types.NEXT: {\r\n        const connection = this.location as Connection;\r\n        return this.getOutAstNodeForBlock(connection.getSourceBlock());\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Whether an AST node of the given type points to a connection.\r\n   *\r\n   * @param type The type to check.  One of ASTNode.types.\r\n   * @returns True if a node of the given type points to a connection.\r\n   */\r\n  private static isConnectionType(type: string): boolean {\r\n    switch (type) {\r\n      case ASTNode.types.PREVIOUS:\r\n      case ASTNode.types.NEXT:\r\n      case ASTNode.types.INPUT:\r\n      case ASTNode.types.OUTPUT:\r\n        return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Create an AST node pointing to a field.\r\n   *\r\n   * @param field The location of the AST node.\r\n   * @returns An AST node pointing to a field.\r\n   */\r\n  static createFieldNode(field: Field): ASTNode | null {\r\n    if (!field) {\r\n      return null;\r\n    }\r\n    return new ASTNode(ASTNode.types.FIELD, field);\r\n  }\r\n\r\n  /**\r\n   * Creates an AST node pointing to a connection. If the connection has a\r\n   * parent input then create an AST node of type input that will hold the\r\n   * connection.\r\n   *\r\n   * @param connection This is the connection the node will point to.\r\n   * @returns An AST node pointing to a connection.\r\n   */\r\n  static createConnectionNode(connection: Connection): ASTNode | null {\r\n    if (!connection) {\r\n      return null;\r\n    }\r\n    const type = connection.type;\r\n    if (type === ConnectionType.INPUT_VALUE) {\r\n      // AnyDuringMigration because:  Argument of type 'Input | null' is not\r\n      // assignable to parameter of type 'Input'.\r\n      return ASTNode.createInputNode(\r\n        connection.getParentInput() as AnyDuringMigration,\r\n      );\r\n    } else if (\r\n      type === ConnectionType.NEXT_STATEMENT &&\r\n      connection.getParentInput()\r\n    ) {\r\n      // AnyDuringMigration because:  Argument of type 'Input | null' is not\r\n      // assignable to parameter of type 'Input'.\r\n      return ASTNode.createInputNode(\r\n        connection.getParentInput() as AnyDuringMigration,\r\n      );\r\n    } else if (type === ConnectionType.NEXT_STATEMENT) {\r\n      return new ASTNode(ASTNode.types.NEXT, connection);\r\n    } else if (type === ConnectionType.OUTPUT_VALUE) {\r\n      return new ASTNode(ASTNode.types.OUTPUT, connection);\r\n    } else if (type === ConnectionType.PREVIOUS_STATEMENT) {\r\n      return new ASTNode(ASTNode.types.PREVIOUS, connection);\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Creates an AST node pointing to an input. Stores the input connection as\r\n   * the location.\r\n   *\r\n   * @param input The input used to create an AST node.\r\n   * @returns An AST node pointing to a input.\r\n   */\r\n  static createInputNode(input: Input): ASTNode | null {\r\n    if (!input || !input.connection) {\r\n      return null;\r\n    }\r\n    return new ASTNode(ASTNode.types.INPUT, input.connection);\r\n  }\r\n\r\n  /**\r\n   * Creates an AST node pointing to a block.\r\n   *\r\n   * @param block The block used to create an AST node.\r\n   * @returns An AST node pointing to a block.\r\n   */\r\n  static createBlockNode(block: Block): ASTNode | null {\r\n    if (!block) {\r\n      return null;\r\n    }\r\n    return new ASTNode(ASTNode.types.BLOCK, block);\r\n  }\r\n\r\n  /**\r\n   * Create an AST node of type stack. A stack, represented by its top block, is\r\n   *     the set of all blocks connected to a top block, including the top\r\n   * block.\r\n   *\r\n   * @param topBlock A top block has no parent and can be found in the list\r\n   *     returned by workspace.getTopBlocks().\r\n   * @returns An AST node of type stack that points to the top block on the\r\n   *     stack.\r\n   */\r\n  static createStackNode(topBlock: Block): ASTNode | null {\r\n    if (!topBlock) {\r\n      return null;\r\n    }\r\n    return new ASTNode(ASTNode.types.STACK, topBlock);\r\n  }\r\n\r\n  /**\r\n   * Creates an AST node pointing to a workspace.\r\n   *\r\n   * @param workspace The workspace that we are on.\r\n   * @param wsCoordinate The position on the workspace for this node.\r\n   * @returns An AST node pointing to a workspace and a position on the\r\n   *     workspace.\r\n   */\r\n  static createWorkspaceNode(\r\n    workspace: Workspace | null,\r\n    wsCoordinate: Coordinate | null,\r\n  ): ASTNode | null {\r\n    if (!wsCoordinate || !workspace) {\r\n      return null;\r\n    }\r\n    const params = {wsCoordinate};\r\n    return new ASTNode(ASTNode.types.WORKSPACE, workspace, params);\r\n  }\r\n\r\n  /**\r\n   * Creates an AST node for the top position on a block.\r\n   * This is either an output connection, previous connection, or block.\r\n   *\r\n   * @param block The block to find the top most AST node on.\r\n   * @returns The AST node holding the top most position on the block.\r\n   */\r\n  static createTopNode(block: Block): ASTNode | null {\r\n    let astNode;\r\n    const topConnection = getParentConnection(block);\r\n    if (topConnection) {\r\n      astNode = ASTNode.createConnectionNode(topConnection);\r\n    } else {\r\n      astNode = ASTNode.createBlockNode(block);\r\n    }\r\n    return astNode;\r\n  }\r\n}\r\n\r\nexport namespace ASTNode {\r\n  export interface Params {\r\n    wsCoordinate: Coordinate;\r\n  }\r\n\r\n  export enum types {\r\n    FIELD = 'field',\r\n    BLOCK = 'block',\r\n    INPUT = 'input',\r\n    OUTPUT = 'output',\r\n    NEXT = 'next',\r\n    PREVIOUS = 'previous',\r\n    STACK = 'stack',\r\n    WORKSPACE = 'workspace',\r\n  }\r\n}\r\n\r\nexport type Params = ASTNode.Params;\r\n// No need to export ASTNode.types from the module at this time because (1) it\r\n// wasn't automatically converted by the automatic migration script, (2) the\r\n// name doesn't follow the styleguide.\r\n\r\n/**\r\n * Gets the parent connection on a block.\r\n * This is either an output connection, previous connection or undefined.\r\n * If both connections exist return the one that is actually connected\r\n * to another block.\r\n *\r\n * @param block The block to find the parent connection on.\r\n * @returns The connection connecting to the parent of the block.\r\n */\r\nfunction getParentConnection(block: Block): Connection | null {\r\n  let topConnection = block.outputConnection;\r\n  if (\r\n    !topConnection ||\r\n    (block.previousConnection && block.previousConnection.isConnected())\r\n  ) {\r\n    topConnection = block.previousConnection;\r\n  }\r\n  return topConnection;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2011 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Components for creating connections between blocks.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.Connection\r\n\r\nimport type {Block} from './block.js';\r\nimport {ConnectionType} from './connection_type.js';\r\nimport type {BlockMove} from './events/events_block_move.js';\r\nimport * as eventUtils from './events/utils.js';\r\nimport type {Input} from './inputs/input.js';\r\nimport type {IASTNodeLocationWithBlock} from './interfaces/i_ast_node_location_with_block.js';\r\nimport type {IConnectionChecker} from './interfaces/i_connection_checker.js';\r\nimport * as blocks from './serialization/blocks.js';\r\nimport * as Xml from './xml.js';\r\n\r\n/**\r\n * Class for a connection between blocks.\r\n */\r\nexport class Connection implements IASTNodeLocationWithBlock {\r\n  /** Constants for checking whether two connections are compatible. */\r\n  static CAN_CONNECT = 0;\r\n  static REASON_SELF_CONNECTION = 1;\r\n  static REASON_WRONG_TYPE = 2;\r\n  static REASON_TARGET_NULL = 3;\r\n  static REASON_CHECKS_FAILED = 4;\r\n  static REASON_DIFFERENT_WORKSPACES = 5;\r\n  static REASON_SHADOW_PARENT = 6;\r\n  static REASON_DRAG_CHECKS_FAILED = 7;\r\n  static REASON_PREVIOUS_AND_OUTPUT = 8;\r\n\r\n  protected sourceBlock_: Block;\r\n\r\n  /** Connection this connection connects to.  Null if not connected. */\r\n  targetConnection: Connection | null = null;\r\n\r\n  /**\r\n   * Has this connection been disposed of?\r\n   *\r\n   * @internal\r\n   */\r\n  disposed = false;\r\n\r\n  /** List of compatible value types.  Null if all types are compatible. */\r\n  private check: string[] | null = null;\r\n\r\n  /** DOM representation of a shadow block, or null if none. */\r\n  private shadowDom: Element | null = null;\r\n\r\n  /**\r\n   * Horizontal location of this connection.\r\n   *\r\n   * @internal\r\n   */\r\n  x = 0;\r\n\r\n  /**\r\n   * Vertical location of this connection.\r\n   *\r\n   * @internal\r\n   */\r\n  y = 0;\r\n\r\n  private shadowState: blocks.State | null = null;\r\n\r\n  /**\r\n   * @param source The block establishing this connection.\r\n   * @param type The type of the connection.\r\n   */\r\n  constructor(\r\n    source: Block,\r\n    public type: number,\r\n  ) {\r\n    this.sourceBlock_ = source;\r\n  }\r\n\r\n  /**\r\n   * Connect two connections together.  This is the connection on the superior\r\n   * block.\r\n   *\r\n   * @param childConnection Connection on inferior block.\r\n   */\r\n  protected connect_(childConnection: Connection) {\r\n    const INPUT = ConnectionType.INPUT_VALUE;\r\n    const parentBlock = this.getSourceBlock();\r\n    const childBlock = childConnection.getSourceBlock();\r\n\r\n    // Make sure the childConnection is available.\r\n    if (childConnection.isConnected()) {\r\n      childConnection.disconnectInternal(false);\r\n    }\r\n\r\n    // Make sure the parentConnection is available.\r\n    let orphan;\r\n    if (this.isConnected()) {\r\n      const shadowState = this.stashShadowState();\r\n      const target = this.targetBlock();\r\n      if (target!.isShadow()) {\r\n        target!.dispose(false);\r\n      } else {\r\n        this.disconnectInternal();\r\n        orphan = target;\r\n      }\r\n      this.applyShadowState(shadowState);\r\n    }\r\n\r\n    // Connect the new connection to the parent.\r\n    let event;\r\n    if (eventUtils.isEnabled()) {\r\n      event = new (eventUtils.get(eventUtils.BLOCK_MOVE))(\r\n        childBlock,\r\n      ) as BlockMove;\r\n      event.setReason(['connect']);\r\n    }\r\n    connectReciprocally(this, childConnection);\r\n    childBlock.setParent(parentBlock);\r\n    if (event) {\r\n      event.recordNew();\r\n      eventUtils.fire(event);\r\n    }\r\n\r\n    // Deal with the orphan if it exists.\r\n    if (orphan) {\r\n      const orphanConnection =\r\n        this.type === INPUT\r\n          ? orphan.outputConnection\r\n          : orphan.previousConnection;\r\n      if (!orphanConnection) return;\r\n      const connection = Connection.getConnectionForOrphanedConnection(\r\n        childBlock,\r\n        orphanConnection,\r\n      );\r\n      if (connection) {\r\n        orphanConnection.connect(connection);\r\n      } else {\r\n        orphanConnection.onFailedConnect(this);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Dispose of this connection and deal with connected blocks.\r\n   *\r\n   * @internal\r\n   */\r\n  dispose() {\r\n    // isConnected returns true for shadows and non-shadows.\r\n    if (this.isConnected()) {\r\n      // Destroy the attached shadow block & its children (if it exists).\r\n      this.setShadowStateInternal();\r\n\r\n      const targetBlock = this.targetBlock();\r\n      if (targetBlock && !targetBlock.isDeadOrDying()) {\r\n        // Disconnect the attached normal block.\r\n        targetBlock.unplug();\r\n      }\r\n    }\r\n\r\n    this.disposed = true;\r\n  }\r\n\r\n  /**\r\n   * Get the source block for this connection.\r\n   *\r\n   * @returns The source block.\r\n   */\r\n  getSourceBlock(): Block {\r\n    return this.sourceBlock_;\r\n  }\r\n\r\n  /**\r\n   * Does the connection belong to a superior block (higher in the source\r\n   * stack)?\r\n   *\r\n   * @returns True if connection faces down or right.\r\n   */\r\n  isSuperior(): boolean {\r\n    return (\r\n      this.type === ConnectionType.INPUT_VALUE ||\r\n      this.type === ConnectionType.NEXT_STATEMENT\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Is the connection connected?\r\n   *\r\n   * @returns True if connection is connected to another connection.\r\n   */\r\n  isConnected(): boolean {\r\n    return !!this.targetConnection;\r\n  }\r\n\r\n  /**\r\n   * Get the workspace's connection type checker object.\r\n   *\r\n   * @returns The connection type checker for the source block's workspace.\r\n   * @internal\r\n   */\r\n  getConnectionChecker(): IConnectionChecker {\r\n    return this.sourceBlock_.workspace.connectionChecker;\r\n  }\r\n\r\n  /**\r\n   * Called when an attempted connection fails. NOP by default (i.e. for\r\n   * headless workspaces).\r\n   *\r\n   * @param _otherConnection Connection that this connection failed to connect\r\n   *     to.\r\n   * @internal\r\n   */\r\n  onFailedConnect(_otherConnection: Connection) {}\r\n  // NOP\r\n\r\n  /**\r\n   * Connect this connection to another connection.\r\n   *\r\n   * @param otherConnection Connection to connect to.\r\n   * @returns Whether the the blocks are now connected or not.\r\n   */\r\n  connect(otherConnection: Connection): boolean {\r\n    if (this.targetConnection === otherConnection) {\r\n      // Already connected together.  NOP.\r\n      return true;\r\n    }\r\n\r\n    const checker = this.getConnectionChecker();\r\n    if (checker.canConnect(this, otherConnection, false)) {\r\n      const existingGroup = eventUtils.getGroup();\r\n      if (!existingGroup) {\r\n        eventUtils.setGroup(true);\r\n      }\r\n      // Determine which block is superior (higher in the source stack).\r\n      if (this.isSuperior()) {\r\n        // Superior block.\r\n        this.connect_(otherConnection);\r\n      } else {\r\n        // Inferior block.\r\n        otherConnection.connect_(this);\r\n      }\r\n      eventUtils.setGroup(existingGroup);\r\n    }\r\n\r\n    return this.isConnected();\r\n  }\r\n\r\n  /**\r\n   * Disconnect this connection.\r\n   */\r\n  disconnect() {\r\n    this.disconnectInternal();\r\n  }\r\n\r\n  /**\r\n   * Disconnect two blocks that are connected by this connection.\r\n   *\r\n   * @param setParent Whether to set the parent of the disconnected block or\r\n   *     not, defaults to true.\r\n   *     If you do not set the parent, ensure that a subsequent action does,\r\n   *     otherwise the view and model will be out of sync.\r\n   */\r\n  protected disconnectInternal(setParent = true) {\r\n    const {parentConnection, childConnection} =\r\n      this.getParentAndChildConnections();\r\n    if (!parentConnection || !childConnection) {\r\n      throw Error('Source connection not connected.');\r\n    }\r\n\r\n    const existingGroup = eventUtils.getGroup();\r\n    if (!existingGroup) {\r\n      eventUtils.setGroup(true);\r\n    }\r\n\r\n    let event;\r\n    if (eventUtils.isEnabled()) {\r\n      event = new (eventUtils.get(eventUtils.BLOCK_MOVE))(\r\n        childConnection.getSourceBlock(),\r\n      ) as BlockMove;\r\n      event.setReason(['disconnect']);\r\n    }\r\n    const otherConnection = this.targetConnection;\r\n    if (otherConnection) {\r\n      otherConnection.targetConnection = null;\r\n    }\r\n    this.targetConnection = null;\r\n    if (setParent) childConnection.getSourceBlock().setParent(null);\r\n    if (event) {\r\n      event.recordNew();\r\n      eventUtils.fire(event);\r\n    }\r\n\r\n    if (!childConnection.getSourceBlock().isShadow()) {\r\n      // If we were disconnecting a shadow, no need to spawn a new one.\r\n      parentConnection.respawnShadow_();\r\n    }\r\n\r\n    eventUtils.setGroup(existingGroup);\r\n  }\r\n\r\n  /**\r\n   * Returns the parent connection (superior) and child connection (inferior)\r\n   * given this connection and the connection it is connected to.\r\n   *\r\n   * @returns The parent connection and child connection, given this connection\r\n   *     and the connection it is connected to.\r\n   */\r\n  protected getParentAndChildConnections(): {\r\n    parentConnection?: Connection;\r\n    childConnection?: Connection;\r\n  } {\r\n    if (!this.targetConnection) return {};\r\n    if (this.isSuperior()) {\r\n      return {\r\n        parentConnection: this,\r\n        childConnection: this.targetConnection,\r\n      };\r\n    }\r\n    return {\r\n      parentConnection: this.targetConnection,\r\n      childConnection: this,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Respawn the shadow block if there was one connected to the this connection.\r\n   */\r\n  protected respawnShadow_() {\r\n    // Have to keep respawnShadow_ for backwards compatibility.\r\n    this.createShadowBlock(true);\r\n  }\r\n\r\n  /**\r\n   * Reconnects this connection to the input with the given name on the given\r\n   * block. If there is already a connection connected to that input, that\r\n   * connection is disconnected.\r\n   *\r\n   * @param block The block to connect this connection to.\r\n   * @param inputName The name of the input to connect this connection to.\r\n   * @returns True if this connection was able to connect, false otherwise.\r\n   */\r\n  reconnect(block: Block, inputName: string): boolean {\r\n    // No need to reconnect if this connection's block is deleted.\r\n    if (this.getSourceBlock().isDeadOrDying()) return false;\r\n\r\n    const connectionParent = block.getInput(inputName)?.connection;\r\n    const currentParent = this.targetBlock();\r\n    if (\r\n      (!currentParent || currentParent === block) &&\r\n      connectionParent &&\r\n      connectionParent.targetConnection !== this\r\n    ) {\r\n      if (connectionParent.isConnected()) {\r\n        // There's already something connected here.  Get rid of it.\r\n        connectionParent.disconnect();\r\n      }\r\n      connectionParent.connect(this);\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Returns the block that this connection connects to.\r\n   *\r\n   * @returns The connected block or null if none is connected.\r\n   */\r\n  targetBlock(): Block | null {\r\n    if (this.isConnected()) {\r\n      return this.targetConnection?.getSourceBlock() ?? null;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Function to be called when this connection's compatible types have changed.\r\n   */\r\n  protected onCheckChanged_() {\r\n    // The new value type may not be compatible with the existing connection.\r\n    if (\r\n      this.isConnected() &&\r\n      (!this.targetConnection ||\r\n        !this.getConnectionChecker().canConnect(\r\n          this,\r\n          this.targetConnection,\r\n          false,\r\n        ))\r\n    ) {\r\n      const child = this.isSuperior() ? this.targetBlock() : this.sourceBlock_;\r\n      child!.unplug();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Change a connection's compatibility.\r\n   *\r\n   * @param check Compatible value type or list of value types. Null if all\r\n   *     types are compatible.\r\n   * @returns The connection being modified (to allow chaining).\r\n   */\r\n  setCheck(check: string | string[] | null): Connection {\r\n    if (check) {\r\n      if (!Array.isArray(check)) {\r\n        check = [check];\r\n      }\r\n      this.check = check;\r\n      this.onCheckChanged_();\r\n    } else {\r\n      this.check = null;\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Get a connection's compatibility.\r\n   *\r\n   * @returns List of compatible value types.\r\n   *     Null if all types are compatible.\r\n   */\r\n  getCheck(): string[] | null {\r\n    return this.check;\r\n  }\r\n\r\n  /**\r\n   * Changes the connection's shadow block.\r\n   *\r\n   * @param shadowDom DOM representation of a block or null.\r\n   */\r\n  setShadowDom(shadowDom: Element | null) {\r\n    this.setShadowStateInternal({shadowDom});\r\n  }\r\n\r\n  /**\r\n   * Returns the xml representation of the connection's shadow block.\r\n   *\r\n   * @param returnCurrent If true, and the shadow block is currently attached to\r\n   *     this connection, this serializes the state of that block and returns it\r\n   *     (so that field values are correct). Otherwise the saved shadowDom is\r\n   *     just returned.\r\n   * @returns Shadow DOM representation of a block or null.\r\n   */\r\n  getShadowDom(returnCurrent?: boolean): Element | null {\r\n    return returnCurrent && this.targetBlock()!.isShadow()\r\n      ? (Xml.blockToDom(this.targetBlock() as Block) as Element)\r\n      : this.shadowDom;\r\n  }\r\n\r\n  /**\r\n   * Changes the connection's shadow block.\r\n   *\r\n   * @param shadowState An state represetation of the block or null.\r\n   */\r\n  setShadowState(shadowState: blocks.State | null) {\r\n    this.setShadowStateInternal({shadowState});\r\n  }\r\n\r\n  /**\r\n   * Returns the serialized object representation of the connection's shadow\r\n   * block.\r\n   *\r\n   * @param returnCurrent If true, and the shadow block is currently attached to\r\n   *     this connection, this serializes the state of that block and returns it\r\n   *     (so that field values are correct). Otherwise the saved state is just\r\n   *     returned.\r\n   * @returns Serialized object representation of the block, or null.\r\n   */\r\n  getShadowState(returnCurrent?: boolean): blocks.State | null {\r\n    if (returnCurrent && this.targetBlock() && this.targetBlock()!.isShadow()) {\r\n      return blocks.save(this.targetBlock() as Block);\r\n    }\r\n    return this.shadowState;\r\n  }\r\n\r\n  /**\r\n   * Find all nearby compatible connections to this connection.\r\n   * Type checking does not apply, since this function is used for bumping.\r\n   *\r\n   * Headless configurations (the default) do not have neighboring connection,\r\n   * and always return an empty list (the default).\r\n   * {@link RenderedConnection#neighbours} overrides this behavior with a list\r\n   * computed from the rendered positioning.\r\n   *\r\n   * @param _maxLimit The maximum radius to another connection.\r\n   * @returns List of connections.\r\n   * @internal\r\n   */\r\n  neighbours(_maxLimit: number): Connection[] {\r\n    return [];\r\n  }\r\n\r\n  /**\r\n   * Get the parent input of a connection.\r\n   *\r\n   * @returns The input that the connection belongs to or null if no parent\r\n   *     exists.\r\n   * @internal\r\n   */\r\n  getParentInput(): Input | null {\r\n    let parentInput = null;\r\n    const inputs = this.sourceBlock_.inputList;\r\n    for (let i = 0; i < inputs.length; i++) {\r\n      if (inputs[i].connection === this) {\r\n        parentInput = inputs[i];\r\n        break;\r\n      }\r\n    }\r\n    return parentInput;\r\n  }\r\n\r\n  /**\r\n   * This method returns a string describing this Connection in developer terms\r\n   * (English only). Intended to on be used in console logs and errors.\r\n   *\r\n   * @returns The description.\r\n   */\r\n  toString(): string {\r\n    const block = this.sourceBlock_;\r\n    if (!block) {\r\n      return 'Orphan Connection';\r\n    }\r\n    let msg;\r\n    if (block.outputConnection === this) {\r\n      msg = 'Output Connection of ';\r\n    } else if (block.previousConnection === this) {\r\n      msg = 'Previous Connection of ';\r\n    } else if (block.nextConnection === this) {\r\n      msg = 'Next Connection of ';\r\n    } else {\r\n      let parentInput = null;\r\n      for (let i = 0, input; (input = block.inputList[i]); i++) {\r\n        if (input.connection === this) {\r\n          parentInput = input;\r\n          break;\r\n        }\r\n      }\r\n      if (parentInput) {\r\n        msg = 'Input \"' + parentInput.name + '\" connection on ';\r\n      } else {\r\n        console.warn('Connection not actually connected to sourceBlock_');\r\n        return 'Orphan Connection';\r\n      }\r\n    }\r\n    return msg + block.toDevString();\r\n  }\r\n\r\n  /**\r\n   * Returns the state of the shadowDom_ and shadowState_ properties, then\r\n   * temporarily sets those properties to null so no shadow respawns.\r\n   *\r\n   * @returns The state of both the shadowDom_ and shadowState_ properties.\r\n   */\r\n  private stashShadowState(): {\r\n    shadowDom: Element | null;\r\n    shadowState: blocks.State | null;\r\n  } {\r\n    const shadowDom = this.getShadowDom(true);\r\n    const shadowState = this.getShadowState(true);\r\n    // Set to null so it doesn't respawn.\r\n    this.shadowDom = null;\r\n    this.shadowState = null;\r\n    return {shadowDom, shadowState};\r\n  }\r\n\r\n  /**\r\n   * Reapplies the stashed state of the shadowDom_ and shadowState_ properties.\r\n   *\r\n   * @param param0 The state to reapply to the shadowDom_ and shadowState_\r\n   *     properties.\r\n   */\r\n  private applyShadowState({\r\n    shadowDom,\r\n    shadowState,\r\n  }: {\r\n    shadowDom: Element | null;\r\n    shadowState: blocks.State | null;\r\n  }) {\r\n    this.shadowDom = shadowDom;\r\n    this.shadowState = shadowState;\r\n  }\r\n\r\n  /**\r\n   * Sets the state of the shadow of this connection.\r\n   *\r\n   * @param param0 The state to set the shadow of this connection to.\r\n   */\r\n  private setShadowStateInternal({\r\n    shadowDom = null,\r\n    shadowState = null,\r\n  }: {\r\n    shadowDom?: Element | null;\r\n    shadowState?: blocks.State | null;\r\n  } = {}) {\r\n    // One or both of these should always be null.\r\n    // If neither is null, the shadowState will get priority.\r\n    this.shadowDom = shadowDom;\r\n    this.shadowState = shadowState;\r\n\r\n    const target = this.targetBlock();\r\n    if (!target) {\r\n      this.respawnShadow_();\r\n      if (this.targetBlock() && this.targetBlock()!.isShadow()) {\r\n        this.serializeShadow(this.targetBlock());\r\n      }\r\n    } else if (target.isShadow()) {\r\n      target.dispose(false);\r\n      if (this.getSourceBlock().isDeadOrDying()) return;\r\n      this.respawnShadow_();\r\n      if (this.targetBlock() && this.targetBlock()!.isShadow()) {\r\n        this.serializeShadow(this.targetBlock());\r\n      }\r\n    } else {\r\n      const shadow = this.createShadowBlock(false);\r\n      this.serializeShadow(shadow);\r\n      if (shadow) {\r\n        shadow.dispose(false);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Creates a shadow block based on the current shadowState_ or shadowDom_.\r\n   * shadowState_ gets priority.\r\n   *\r\n   * @param attemptToConnect Whether to try to connect the shadow block to this\r\n   *     connection or not.\r\n   * @returns The shadow block that was created, or null if both the\r\n   *     shadowState_ and shadowDom_ are null.\r\n   */\r\n  private createShadowBlock(attemptToConnect: boolean): Block | null {\r\n    const parentBlock = this.getSourceBlock();\r\n    const shadowState = this.getShadowState();\r\n    const shadowDom = this.getShadowDom();\r\n    if (parentBlock.isDeadOrDying() || (!shadowState && !shadowDom)) {\r\n      return null;\r\n    }\r\n\r\n    let blockShadow;\r\n    if (shadowState) {\r\n      blockShadow = blocks.appendInternal(shadowState, parentBlock.workspace, {\r\n        parentConnection: attemptToConnect ? this : undefined,\r\n        isShadow: true,\r\n        recordUndo: false,\r\n      });\r\n      return blockShadow;\r\n    }\r\n\r\n    if (shadowDom) {\r\n      blockShadow = Xml.domToBlockInternal(shadowDom, parentBlock.workspace);\r\n      if (attemptToConnect) {\r\n        if (this.type === ConnectionType.INPUT_VALUE) {\r\n          if (!blockShadow.outputConnection) {\r\n            throw new Error('Shadow block is missing an output connection');\r\n          }\r\n          if (!this.connect(blockShadow.outputConnection)) {\r\n            throw new Error('Could not connect shadow block to connection');\r\n          }\r\n        } else if (this.type === ConnectionType.NEXT_STATEMENT) {\r\n          if (!blockShadow.previousConnection) {\r\n            throw new Error('Shadow block is missing previous connection');\r\n          }\r\n          if (!this.connect(blockShadow.previousConnection)) {\r\n            throw new Error('Could not connect shadow block to connection');\r\n          }\r\n        } else {\r\n          throw new Error(\r\n            'Cannot connect a shadow block to a previous/output connection',\r\n          );\r\n        }\r\n      }\r\n      return blockShadow;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Saves the given shadow block to both the shadowDom_ and shadowState_\r\n   * properties, in their respective serialized forms.\r\n   *\r\n   * @param shadow The shadow to serialize, or null.\r\n   */\r\n  private serializeShadow(shadow: Block | null) {\r\n    if (!shadow) {\r\n      return;\r\n    }\r\n    this.shadowDom = Xml.blockToDom(shadow) as Element;\r\n    this.shadowState = blocks.save(shadow);\r\n  }\r\n\r\n  /**\r\n   * Returns the connection (starting at the startBlock) which will accept\r\n   * the given connection. This includes compatible connection types and\r\n   * connection checks.\r\n   *\r\n   * @param startBlock The block on which to start the search.\r\n   * @param orphanConnection The connection that is looking for a home.\r\n   * @returns The suitable connection point on the chain of blocks, or null.\r\n   */\r\n  static getConnectionForOrphanedConnection(\r\n    startBlock: Block,\r\n    orphanConnection: Connection,\r\n  ): Connection | null {\r\n    if (orphanConnection.type === ConnectionType.OUTPUT_VALUE) {\r\n      return getConnectionForOrphanedOutput(\r\n        startBlock,\r\n        orphanConnection.getSourceBlock(),\r\n      );\r\n    }\r\n    // Otherwise we're dealing with a stack.\r\n    const connection = startBlock.lastConnectionInStack(true);\r\n    const checker = orphanConnection.getConnectionChecker();\r\n    if (connection && checker.canConnect(orphanConnection, connection, false)) {\r\n      return connection;\r\n    }\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Update two connections to target each other.\r\n *\r\n * @param first The first connection to update.\r\n * @param second The second connection to update.\r\n */\r\nfunction connectReciprocally(first: Connection, second: Connection) {\r\n  if (!first || !second) {\r\n    throw Error('Cannot connect null connections.');\r\n  }\r\n  first.targetConnection = second;\r\n  second.targetConnection = first;\r\n}\r\n/**\r\n * Returns the single connection on the block that will accept the orphaned\r\n * block, if one can be found. If the block has multiple compatible connections\r\n * (even if they are filled) this returns null. If the block has no compatible\r\n * connections, this returns null.\r\n *\r\n * @param block The superior block.\r\n * @param orphanBlock The inferior block.\r\n * @returns The suitable connection point on 'block', or null.\r\n */\r\nfunction getSingleConnection(\r\n  block: Block,\r\n  orphanBlock: Block,\r\n): Connection | null {\r\n  let foundConnection = null;\r\n  const output = orphanBlock.outputConnection;\r\n  const typeChecker = output?.getConnectionChecker();\r\n\r\n  for (let i = 0, input; (input = block.inputList[i]); i++) {\r\n    const connection = input.connection;\r\n    if (connection && typeChecker?.canConnect(output, connection, false)) {\r\n      if (foundConnection) {\r\n        return null; // More than one connection.\r\n      }\r\n      foundConnection = connection;\r\n    }\r\n  }\r\n  return foundConnection;\r\n}\r\n\r\n/**\r\n * Walks down a row a blocks, at each stage checking if there are any\r\n * connections that will accept the orphaned block.  If at any point there\r\n * are zero or multiple eligible connections, returns null.  Otherwise\r\n * returns the only input on the last block in the chain.\r\n * Terminates early for shadow blocks.\r\n *\r\n * @param startBlock The block on which to start the search.\r\n * @param orphanBlock The block that is looking for a home.\r\n * @returns The suitable connection point on the chain of blocks, or null.\r\n */\r\nfunction getConnectionForOrphanedOutput(\r\n  startBlock: Block,\r\n  orphanBlock: Block,\r\n): Connection | null {\r\n  let newBlock: Block | null = startBlock;\r\n  let connection;\r\n  while ((connection = getSingleConnection(newBlock, orphanBlock))) {\r\n    newBlock = connection.targetBlock();\r\n    if (!newBlock || newBlock.isShadow()) {\r\n      return connection;\r\n    }\r\n  }\r\n  return null;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.blockRendering\r\n\r\nimport * as registry from '../../registry.js';\r\nimport type {Theme} from '../../theme.js';\r\nimport {Measurable} from '../measurables/base.js';\r\nimport {BottomRow} from '../measurables/bottom_row.js';\r\nimport {Connection} from '../measurables/connection.js';\r\nimport {ExternalValueInput} from '../measurables/external_value_input.js';\r\nimport {Field} from '../measurables/field.js';\r\nimport {Hat} from '../measurables/hat.js';\r\nimport {Icon} from '../measurables/icon.js';\r\nimport {InRowSpacer} from '../measurables/in_row_spacer.js';\r\nimport {InlineInput} from '../measurables/inline_input.js';\r\nimport {InputConnection} from '../measurables/input_connection.js';\r\nimport {InputRow} from '../measurables/input_row.js';\r\nimport {JaggedEdge} from '../measurables/jagged_edge.js';\r\nimport {NextConnection} from '../measurables/next_connection.js';\r\nimport {OutputConnection} from '../measurables/output_connection.js';\r\nimport {PreviousConnection} from '../measurables/previous_connection.js';\r\nimport {RoundCorner} from '../measurables/round_corner.js';\r\nimport {Row} from '../measurables/row.js';\r\nimport {SpacerRow} from '../measurables/spacer_row.js';\r\nimport {SquareCorner} from '../measurables/square_corner.js';\r\nimport {StatementInput} from '../measurables/statement_input.js';\r\nimport {TopRow} from '../measurables/top_row.js';\r\nimport {Types} from '../measurables/types.js';\r\n\r\nimport {Drawer} from './drawer.js';\r\nimport type {IPathObject} from './i_path_object.js';\r\nimport {RenderInfo} from './info.js';\r\nimport {MarkerSvg} from './marker_svg.js';\r\nimport {PathObject} from './path_object.js';\r\nimport {Renderer} from './renderer.js';\r\n\r\n/**\r\n * Registers a new renderer.\r\n *\r\n * @param name The name of the renderer.\r\n * @param rendererClass The new renderer class to register.\r\n * @throws {Error} if a renderer with the same name has already been registered.\r\n */\r\nexport function register(name: string, rendererClass: Function) {\r\n  registry.register(registry.Type.RENDERER, name, rendererClass);\r\n}\r\n\r\n/**\r\n * Unregisters the renderer registered with the given name.\r\n *\r\n * @param name The name of the renderer.\r\n */\r\nexport function unregister(name: string) {\r\n  registry.unregister(registry.Type.RENDERER, name);\r\n}\r\n\r\n/**\r\n * Initialize anything needed for rendering (constants, etc).\r\n *\r\n * @param name Name of the renderer to initialize.\r\n * @param theme The workspace theme object.\r\n * @param opt_rendererOverrides Rendering constant overrides.\r\n * @returns The new instance of a renderer.\r\n *     Already initialized.\r\n * @internal\r\n */\r\nexport function init(\r\n  name: string,\r\n  theme: Theme,\r\n  opt_rendererOverrides?: {[rendererConstant: string]: any},\r\n): Renderer {\r\n  const rendererClass = registry.getClass(registry.Type.RENDERER, name);\r\n  const renderer = new rendererClass!(name);\r\n  renderer.init(theme, opt_rendererOverrides);\r\n  return renderer;\r\n}\r\nexport {BottomRow};\r\nexport {Connection};\r\nexport {Drawer};\r\nexport {ExternalValueInput};\r\nexport {Field};\r\nexport {Hat};\r\nexport {Icon};\r\nexport {InRowSpacer};\r\nexport {InlineInput};\r\nexport {InputConnection};\r\nexport {InputRow};\r\nexport {IPathObject};\r\nexport {JaggedEdge};\r\nexport {MarkerSvg};\r\nexport {Measurable};\r\nexport {NextConnection};\r\nexport {OutputConnection};\r\nexport {PathObject};\r\nexport {PreviousConnection};\r\nexport {Renderer};\r\nexport {RenderInfo};\r\nexport {RoundCorner};\r\nexport {Row};\r\nexport {SpacerRow};\r\nexport {SquareCorner};\r\nexport {StatementInput};\r\nexport {TopRow};\r\nexport {Types};\r\n\r\nexport {\r\n  OutsideCorners,\r\n  InsideCorners,\r\n  StartHat,\r\n  Notch,\r\n  PuzzleTab,\r\n  JaggedTeeth,\r\n  BaseShape,\r\n  DynamicShape,\r\n  ConstantProvider,\r\n} from './constants.js';\r\n","/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.VariablesDynamic\r\n\r\nimport {Blocks} from './blocks.js';\r\nimport {Msg} from './msg.js';\r\nimport * as xml from './utils/xml.js';\r\nimport {VariableModel} from './variable_model.js';\r\nimport * as Variables from './variables.js';\r\nimport type {Workspace} from './workspace.js';\r\nimport type {WorkspaceSvg} from './workspace_svg.js';\r\nimport type {FlyoutButton} from './flyout_button.js';\r\n\r\n/**\r\n * String for use in the \"custom\" attribute of a category in toolbox XML.\r\n * This string indicates that the category should be dynamically populated with\r\n * variable blocks.\r\n * See also Blockly.Variables.CATEGORY_NAME and\r\n * Blockly.Procedures.CATEGORY_NAME.\r\n */\r\nexport const CATEGORY_NAME = 'VARIABLE_DYNAMIC';\r\n\r\n/**\r\n * Click handler for a button that creates String variables.\r\n *\r\n * @param button\r\n */\r\nfunction stringButtonClickHandler(button: FlyoutButton) {\r\n  Variables.createVariableButtonHandler(\r\n    button.getTargetWorkspace(),\r\n    undefined,\r\n    'String',\r\n  );\r\n}\r\n// eslint-disable-next-line camelcase\r\nexport const onCreateVariableButtonClick_String = stringButtonClickHandler;\r\n\r\n/**\r\n * Click handler for a button that creates Number variables.\r\n *\r\n * @param button\r\n */\r\nfunction numberButtonClickHandler(button: FlyoutButton) {\r\n  Variables.createVariableButtonHandler(\r\n    button.getTargetWorkspace(),\r\n    undefined,\r\n    'Number',\r\n  );\r\n}\r\n// eslint-disable-next-line camelcase\r\nexport const onCreateVariableButtonClick_Number = numberButtonClickHandler;\r\n\r\n/**\r\n * Click handler for a button that creates Colour variables.\r\n *\r\n * @param button\r\n */\r\nfunction colourButtonClickHandler(button: FlyoutButton) {\r\n  Variables.createVariableButtonHandler(\r\n    button.getTargetWorkspace(),\r\n    undefined,\r\n    'Colour',\r\n  );\r\n}\r\n// eslint-disable-next-line camelcase\r\nexport const onCreateVariableButtonClick_Colour = colourButtonClickHandler;\r\n\r\n/**\r\n * Construct the elements (blocks and button) required by the flyout for the\r\n * variable category.\r\n *\r\n * @param workspace The workspace containing variables.\r\n * @returns Array of XML elements.\r\n */\r\nexport function flyoutCategory(workspace: WorkspaceSvg): Element[] {\r\n  let xmlList = new Array<Element>();\r\n  let button = document.createElement('button');\r\n  button.setAttribute('text', Msg['NEW_STRING_VARIABLE']);\r\n  button.setAttribute('callbackKey', 'CREATE_VARIABLE_STRING');\r\n  xmlList.push(button);\r\n  button = document.createElement('button');\r\n  button.setAttribute('text', Msg['NEW_NUMBER_VARIABLE']);\r\n  button.setAttribute('callbackKey', 'CREATE_VARIABLE_NUMBER');\r\n  xmlList.push(button);\r\n  button = document.createElement('button');\r\n  button.setAttribute('text', Msg['NEW_COLOUR_VARIABLE']);\r\n  button.setAttribute('callbackKey', 'CREATE_VARIABLE_COLOUR');\r\n  xmlList.push(button);\r\n\r\n  workspace.registerButtonCallback(\r\n    'CREATE_VARIABLE_STRING',\r\n    stringButtonClickHandler,\r\n  );\r\n  workspace.registerButtonCallback(\r\n    'CREATE_VARIABLE_NUMBER',\r\n    numberButtonClickHandler,\r\n  );\r\n  workspace.registerButtonCallback(\r\n    'CREATE_VARIABLE_COLOUR',\r\n    colourButtonClickHandler,\r\n  );\r\n\r\n  const blockList = flyoutCategoryBlocks(workspace);\r\n  xmlList = xmlList.concat(blockList);\r\n  return xmlList;\r\n}\r\n\r\n/**\r\n * Construct the blocks required by the flyout for the variable category.\r\n *\r\n * @param workspace The workspace containing variables.\r\n * @returns Array of XML block elements.\r\n */\r\nexport function flyoutCategoryBlocks(workspace: Workspace): Element[] {\r\n  const variableModelList = workspace.getAllVariables();\r\n\r\n  const xmlList = [];\r\n  if (variableModelList.length > 0) {\r\n    if (Blocks['variables_set_dynamic']) {\r\n      const firstVariable = variableModelList[variableModelList.length - 1];\r\n      const block = xml.createElement('block');\r\n      block.setAttribute('type', 'variables_set_dynamic');\r\n      block.setAttribute('gap', '24');\r\n      block.appendChild(Variables.generateVariableFieldDom(firstVariable));\r\n      xmlList.push(block);\r\n    }\r\n    if (Blocks['variables_get_dynamic']) {\r\n      variableModelList.sort(VariableModel.compareByName);\r\n      for (let i = 0, variable; (variable = variableModelList[i]); i++) {\r\n        const block = xml.createElement('block');\r\n        block.setAttribute('type', 'variables_get_dynamic');\r\n        block.setAttribute('gap', '8');\r\n        block.appendChild(Variables.generateVariableFieldDom(variable));\r\n        xmlList.push(block);\r\n      }\r\n    }\r\n  }\r\n  return xmlList;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2014 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Object representing a workspace rendered as SVG.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.WorkspaceSvg\r\n\r\n// Unused import preserved for side-effects. Remove if unneeded.\r\nimport './events/events_block_create.js';\r\n// Unused import preserved for side-effects. Remove if unneeded.\r\nimport './events/events_theme_change.js';\r\n// Unused import preserved for side-effects. Remove if unneeded.\r\nimport './events/events_viewport.js';\r\n\r\nimport type {Block} from './block.js';\r\nimport type {BlockSvg} from './block_svg.js';\r\nimport type {BlocklyOptions} from './blockly_options.js';\r\nimport * as browserEvents from './browser_events.js';\r\nimport * as common from './common.js';\r\nimport {ComponentManager} from './component_manager.js';\r\nimport {config} from './config.js';\r\nimport {ConnectionDB} from './connection_db.js';\r\nimport * as ContextMenu from './contextmenu.js';\r\nimport {ContextMenuRegistry} from './contextmenu_registry.js';\r\nimport * as dropDownDiv from './dropdowndiv.js';\r\nimport * as eventUtils from './events/utils.js';\r\nimport type {FlyoutButton} from './flyout_button.js';\r\nimport {Gesture} from './gesture.js';\r\nimport {Grid} from './grid.js';\r\nimport type {IASTNodeLocationSvg} from './interfaces/i_ast_node_location_svg.js';\r\nimport type {IBoundedElement} from './interfaces/i_bounded_element.js';\r\nimport type {ICopyData, ICopyable} from './interfaces/i_copyable.js';\r\nimport type {IDragTarget} from './interfaces/i_drag_target.js';\r\nimport type {IFlyout} from './interfaces/i_flyout.js';\r\nimport type {IMetricsManager} from './interfaces/i_metrics_manager.js';\r\nimport type {IToolbox} from './interfaces/i_toolbox.js';\r\nimport type {Cursor} from './keyboard_nav/cursor.js';\r\nimport type {Marker} from './keyboard_nav/marker.js';\r\nimport {MarkerManager} from './marker_manager.js';\r\nimport {Options} from './options.js';\r\nimport * as Procedures from './procedures.js';\r\nimport * as registry from './registry.js';\r\nimport * as blockRendering from './renderers/common/block_rendering.js';\r\nimport type {Renderer} from './renderers/common/renderer.js';\r\nimport type {ScrollbarPair} from './scrollbar_pair.js';\r\nimport * as blocks from './serialization/blocks.js';\r\nimport type {Theme} from './theme.js';\r\nimport {Classic} from './theme/classic.js';\r\nimport {ThemeManager} from './theme_manager.js';\r\nimport * as Tooltip from './tooltip.js';\r\nimport type {Trashcan} from './trashcan.js';\r\nimport * as arrayUtils from './utils/array.js';\r\nimport {Coordinate} from './utils/coordinate.js';\r\nimport * as dom from './utils/dom.js';\r\nimport type {Metrics} from './utils/metrics.js';\r\nimport {Rect} from './utils/rect.js';\r\nimport {Size} from './utils/size.js';\r\nimport {Svg} from './utils/svg.js';\r\nimport * as svgMath from './utils/svg_math.js';\r\nimport * as toolbox from './utils/toolbox.js';\r\nimport * as userAgent from './utils/useragent.js';\r\nimport type {VariableModel} from './variable_model.js';\r\nimport * as Variables from './variables.js';\r\nimport * as VariablesDynamic from './variables_dynamic.js';\r\nimport * as WidgetDiv from './widgetdiv.js';\r\nimport {Workspace} from './workspace.js';\r\nimport {WorkspaceAudio} from './workspace_audio.js';\r\nimport {WorkspaceComment} from './workspace_comment.js';\r\nimport {WorkspaceCommentSvg} from './workspace_comment_svg.js';\r\nimport * as Xml from './xml.js';\r\nimport {ZoomControls} from './zoom_controls.js';\r\nimport {ContextMenuOption} from './contextmenu_registry.js';\r\nimport * as renderManagement from './render_management.js';\r\nimport * as deprecation from './utils/deprecation.js';\r\nimport {LayerManager} from './layer_manager.js';\r\n\r\n/** Margin around the top/bottom/left/right after a zoomToFit call. */\r\nconst ZOOM_TO_FIT_MARGIN = 20;\r\n\r\n/**\r\n * Class for a workspace.  This is an onscreen area with optional trashcan,\r\n * scrollbars, bubbles, and dragging.\r\n */\r\nexport class WorkspaceSvg extends Workspace implements IASTNodeLocationSvg {\r\n  /**\r\n   * A wrapper function called when a resize event occurs.\r\n   * You can pass the result to `eventHandling.unbind`.\r\n   */\r\n  private resizeHandlerWrapper: browserEvents.Data | null = null;\r\n\r\n  /**\r\n   * The render status of an SVG workspace.\r\n   * Returns `false` for headless workspaces and true for instances of\r\n   * `WorkspaceSvg`.\r\n   */\r\n  override rendered = true;\r\n\r\n  /**\r\n   * Whether the workspace is visible.  False if the workspace has been hidden\r\n   * by calling `setVisible(false)`.\r\n   */\r\n  private isVisible_ = true;\r\n\r\n  /**\r\n   * Whether this workspace has resizes enabled.\r\n   * Disable during batch operations for a performance improvement.\r\n   */\r\n  private resizesEnabled = true;\r\n\r\n  /**\r\n   * Current horizontal scrolling offset in pixel units, relative to the\r\n   * workspace origin.\r\n   *\r\n   * It is useful to think about a view, and a canvas moving beneath that\r\n   * view. As the canvas moves right, this value becomes more positive, and\r\n   * the view is now \"seeing\" the left side of the canvas. As the canvas moves\r\n   * left, this value becomes more negative, and the view is now \"seeing\" the\r\n   * right side of the canvas.\r\n   *\r\n   * The confusing thing about this value is that it does not, and must not\r\n   * include the absoluteLeft offset. This is because it is used to calculate\r\n   * the viewLeft value.\r\n   *\r\n   * The viewLeft is relative to the workspace origin (although in pixel\r\n   * units). The workspace origin is the top-left corner of the workspace (at\r\n   * least when it is enabled). It is shifted from the top-left of the\r\n   * blocklyDiv so as not to be beneath the toolbox.\r\n   *\r\n   * When the workspace is enabled the viewLeft and workspace origin are at\r\n   * the same X location. As the canvas slides towards the right beneath the\r\n   * view this value (scrollX) becomes more positive, and the viewLeft becomes\r\n   * more negative relative to the workspace origin (imagine the workspace\r\n   * origin as a dot on the canvas sliding to the right as the canvas moves).\r\n   *\r\n   * So if the scrollX were to include the absoluteLeft this would in a way\r\n   * \"unshift\" the workspace origin. This means that the viewLeft would be\r\n   * representing the left edge of the blocklyDiv, rather than the left edge\r\n   * of the workspace.\r\n   */\r\n  scrollX = 0;\r\n\r\n  /**\r\n   * Current vertical scrolling offset in pixel units, relative to the\r\n   * workspace origin.\r\n   *\r\n   * It is useful to think about a view, and a canvas moving beneath that\r\n   * view. As the canvas moves down, this value becomes more positive, and the\r\n   * view is now \"seeing\" the upper part of the canvas. As the canvas moves\r\n   * up, this value becomes more negative, and the view is \"seeing\" the lower\r\n   * part of the canvas.\r\n   *\r\n   * This confusing thing about this value is that it does not, and must not\r\n   * include the absoluteTop offset. This is because it is used to calculate\r\n   * the viewTop value.\r\n   *\r\n   * The viewTop is relative to the workspace origin (although in pixel\r\n   * units). The workspace origin is the top-left corner of the workspace (at\r\n   * least when it is enabled). It is shifted from the top-left of the\r\n   * blocklyDiv so as not to be beneath the toolbox.\r\n   *\r\n   * When the workspace is enabled the viewTop and workspace origin are at the\r\n   * same Y location. As the canvas slides towards the bottom this value\r\n   * (scrollY) becomes more positive, and the viewTop becomes more negative\r\n   * relative to the workspace origin (image in the workspace origin as a dot\r\n   * on the canvas sliding downwards as the canvas moves).\r\n   *\r\n   * So if the scrollY were to include the absoluteTop this would in a way\r\n   * \"unshift\" the workspace origin. This means that the viewTop would be\r\n   * representing the top edge of the blocklyDiv, rather than the top edge of\r\n   * the workspace.\r\n   */\r\n  scrollY = 0;\r\n\r\n  /** Horizontal scroll value when scrolling started in pixel units. */\r\n  startScrollX = 0;\r\n\r\n  /** Vertical scroll value when scrolling started in pixel units. */\r\n  startScrollY = 0;\r\n\r\n  /** Distance from mouse to object being dragged. */\r\n  private dragDeltaXY: Coordinate | null = null;\r\n\r\n  /** Current scale. */\r\n  scale = 1;\r\n\r\n  /** Cached scale value. Used to detect changes in viewport. */\r\n  private oldScale = 1;\r\n\r\n  /** Cached viewport top value. Used to detect changes in viewport. */\r\n  private oldTop = 0;\r\n\r\n  /** Cached viewport left value. Used to detect changes in viewport. */\r\n  private oldLeft = 0;\r\n\r\n  /** The workspace's trashcan (if any). */\r\n  trashcan: Trashcan | null = null;\r\n\r\n  /** This workspace's scrollbars, if they exist. */\r\n  scrollbar: ScrollbarPair | null = null;\r\n\r\n  /**\r\n   * Fixed flyout providing blocks which may be dragged into this workspace.\r\n   */\r\n  private flyout: IFlyout | null = null;\r\n\r\n  /**\r\n   * Category-based toolbox providing blocks which may be dragged into this\r\n   * workspace.\r\n   */\r\n  private toolbox_: IToolbox | null = null;\r\n\r\n  /**\r\n   * The current gesture in progress on this workspace, if any.\r\n   *\r\n   * @internal\r\n   */\r\n  currentGesture_: Gesture | null = null;\r\n\r\n  /**\r\n   * The first parent div with 'injectionDiv' in the name, or null if not set.\r\n   * Access this with getInjectionDiv.\r\n   */\r\n  private injectionDiv: Element | null = null;\r\n\r\n  /**\r\n   * Last known position of the page scroll.\r\n   * This is used to determine whether we have recalculated screen coordinate\r\n   * stuff since the page scrolled.\r\n   */\r\n  private lastRecordedPageScroll: Coordinate | null = null;\r\n\r\n  /**\r\n   * Developers may define this function to add custom menu options to the\r\n   * workspace's context menu or edit the workspace-created set of menu\r\n   * options.\r\n   *\r\n   * @param options List of menu options to add to.\r\n   * @param e The right-click event that triggered the context menu.\r\n   */\r\n  configureContextMenu:\r\n    | ((menuOptions: ContextMenuOption[], e: Event) => void)\r\n    | null = null;\r\n\r\n  /**\r\n   * A dummy wheel event listener used as a workaround for a Safari scrolling issue.\r\n   * Set in createDom and used for removal in dispose to ensure proper cleanup.\r\n   */\r\n  private dummyWheelListener: (() => void) | null = null;\r\n\r\n  /**\r\n   * In a flyout, the target workspace where blocks should be placed after a\r\n   * drag. Otherwise null.\r\n   *\r\n   * @internal\r\n   */\r\n  targetWorkspace: WorkspaceSvg | null = null;\r\n\r\n  /** Inverted screen CTM, for use in mouseToSvg. */\r\n  private inverseScreenCTM: SVGMatrix | null = null;\r\n\r\n  /** Inverted screen CTM is dirty, recalculate it. */\r\n  private inverseScreenCTMDirty = true;\r\n  private metricsManager: IMetricsManager;\r\n  /** @internal */\r\n  getMetrics: () => Metrics;\r\n  /** @internal */\r\n  setMetrics: (p1: {x?: number; y?: number}) => void;\r\n  private readonly componentManager: ComponentManager;\r\n\r\n  /**\r\n   * List of currently highlighted blocks.  Block highlighting is often used\r\n   * to visually mark blocks currently being executed.\r\n   */\r\n  private readonly highlightedBlocks: BlockSvg[] = [];\r\n  private audioManager: WorkspaceAudio;\r\n  private grid: Grid | null;\r\n  private markerManager: MarkerManager;\r\n\r\n  /**\r\n   * Map from function names to callbacks, for deciding what to do when a\r\n   * custom toolbox category is opened.\r\n   */\r\n  private toolboxCategoryCallbacks = new Map<\r\n    string,\r\n    (p1: WorkspaceSvg) => toolbox.FlyoutDefinition\r\n  >();\r\n\r\n  /**\r\n   * Map from function names to callbacks, for deciding what to do when a\r\n   * button is clicked.\r\n   */\r\n  private flyoutButtonCallbacks = new Map<string, (p1: FlyoutButton) => void>();\r\n  protected themeManager_: ThemeManager;\r\n  private readonly renderer: Renderer;\r\n\r\n  /** Cached parent SVG. */\r\n  private cachedParentSvg: SVGElement | null = null;\r\n\r\n  /** True if keyboard accessibility mode is on, false otherwise. */\r\n  keyboardAccessibilityMode = false;\r\n\r\n  /** The list of top-level bounded elements on the workspace. */\r\n  private topBoundedElements: IBoundedElement[] = [];\r\n\r\n  /** The recorded drag targets. */\r\n  private dragTargetAreas: Array<{component: IDragTarget; clientRect: Rect}> =\r\n    [];\r\n  private readonly cachedParentSvgSize: Size;\r\n  private layerManager: LayerManager | null = null;\r\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\r\n  svgGroup_!: SVGElement;\r\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\r\n  svgBackground_!: SVGElement;\r\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\r\n  svgBlockCanvas_!: SVGElement;\r\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\r\n  svgBubbleCanvas_!: SVGElement;\r\n  zoomControls_: ZoomControls | null = null;\r\n\r\n  /**\r\n   * @param options Dictionary of options.\r\n   */\r\n  constructor(options: Options) {\r\n    super(options);\r\n\r\n    const MetricsManagerClass = registry.getClassFromOptions(\r\n      registry.Type.METRICS_MANAGER,\r\n      options,\r\n      true,\r\n    );\r\n    /** Object in charge of calculating metrics for the workspace. */\r\n    this.metricsManager = new MetricsManagerClass!(this);\r\n\r\n    /** Method to get all the metrics that have to do with a workspace. */\r\n    this.getMetrics =\r\n      options.getMetrics ||\r\n      this.metricsManager.getMetrics.bind(this.metricsManager);\r\n\r\n    /** Translates the workspace. */\r\n    this.setMetrics =\r\n      options.setMetrics || WorkspaceSvg.setTopLevelWorkspaceMetrics_;\r\n\r\n    this.componentManager = new ComponentManager();\r\n\r\n    this.connectionDBList = ConnectionDB.init(this.connectionChecker);\r\n\r\n    /**\r\n     * Object in charge of loading, storing, and playing audio for a workspace.\r\n     */\r\n    this.audioManager = new WorkspaceAudio(\r\n      options.parentWorkspace as WorkspaceSvg,\r\n    );\r\n\r\n    /** This workspace's grid object or null. */\r\n    this.grid = this.options.gridPattern\r\n      ? new Grid(this.options.gridPattern, options.gridOptions)\r\n      : null;\r\n\r\n    /** Manager in charge of markers and cursors. */\r\n    this.markerManager = new MarkerManager(this);\r\n\r\n    if (Variables && Variables.flyoutCategory) {\r\n      this.registerToolboxCategoryCallback(\r\n        Variables.CATEGORY_NAME,\r\n        Variables.flyoutCategory,\r\n      );\r\n    }\r\n\r\n    if (VariablesDynamic && VariablesDynamic.flyoutCategory) {\r\n      this.registerToolboxCategoryCallback(\r\n        VariablesDynamic.CATEGORY_NAME,\r\n        VariablesDynamic.flyoutCategory,\r\n      );\r\n    }\r\n\r\n    if (Procedures && Procedures.flyoutCategory) {\r\n      this.registerToolboxCategoryCallback(\r\n        Procedures.CATEGORY_NAME,\r\n        Procedures.flyoutCategory,\r\n      );\r\n      this.addChangeListener(Procedures.mutatorOpenListener);\r\n    }\r\n\r\n    /** Object in charge of storing and updating the workspace theme. */\r\n    this.themeManager_ = this.options.parentWorkspace\r\n      ? this.options.parentWorkspace.getThemeManager()\r\n      : new ThemeManager(this, this.options.theme || Classic);\r\n    this.themeManager_.subscribeWorkspace(this);\r\n\r\n    /** The block renderer used for rendering blocks on this workspace. */\r\n    this.renderer = blockRendering.init(\r\n      this.options.renderer || 'geras',\r\n      this.getTheme(),\r\n      this.options.rendererOverrides ?? undefined,\r\n    );\r\n\r\n    /**\r\n     * The cached size of the parent svg element.\r\n     * Used to compute svg metrics.\r\n     */\r\n    this.cachedParentSvgSize = new Size(0, 0);\r\n  }\r\n\r\n  /**\r\n   * Get the marker manager for this workspace.\r\n   *\r\n   * @returns The marker manager.\r\n   */\r\n  getMarkerManager(): MarkerManager {\r\n    return this.markerManager;\r\n  }\r\n\r\n  /**\r\n   * Gets the metrics manager for this workspace.\r\n   *\r\n   * @returns The metrics manager.\r\n   */\r\n  getMetricsManager(): IMetricsManager {\r\n    return this.metricsManager;\r\n  }\r\n\r\n  /**\r\n   * Sets the metrics manager for the workspace.\r\n   *\r\n   * @param metricsManager The metrics manager.\r\n   * @internal\r\n   */\r\n  setMetricsManager(metricsManager: IMetricsManager) {\r\n    this.metricsManager = metricsManager;\r\n    this.getMetrics = this.metricsManager.getMetrics.bind(this.metricsManager);\r\n  }\r\n\r\n  /**\r\n   * Gets the component manager for this workspace.\r\n   *\r\n   * @returns The component manager.\r\n   */\r\n  getComponentManager(): ComponentManager {\r\n    return this.componentManager;\r\n  }\r\n\r\n  /**\r\n   * Add the cursor SVG to this workspaces SVG group.\r\n   *\r\n   * @param cursorSvg The SVG root of the cursor to be added to the workspace\r\n   *     SVG group.\r\n   * @internal\r\n   */\r\n  setCursorSvg(cursorSvg: SVGElement) {\r\n    this.markerManager.setCursorSvg(cursorSvg);\r\n  }\r\n\r\n  /**\r\n   * Add the marker SVG to this workspaces SVG group.\r\n   *\r\n   * @param markerSvg The SVG root of the marker to be added to the workspace\r\n   *     SVG group.\r\n   * @internal\r\n   */\r\n  setMarkerSvg(markerSvg: SVGElement) {\r\n    this.markerManager.setMarkerSvg(markerSvg);\r\n  }\r\n\r\n  /**\r\n   * Get the marker with the given ID.\r\n   *\r\n   * @param id The ID of the marker.\r\n   * @returns The marker with the given ID or null if no marker with the given\r\n   *     ID exists.\r\n   * @internal\r\n   */\r\n  getMarker(id: string): Marker | null {\r\n    if (this.markerManager) {\r\n      return this.markerManager.getMarker(id);\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * The cursor for this workspace.\r\n   *\r\n   * @returns The cursor for the workspace.\r\n   */\r\n  getCursor(): Cursor | null {\r\n    if (this.markerManager) {\r\n      return this.markerManager.getCursor();\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Get the block renderer attached to this workspace.\r\n   *\r\n   * @returns The renderer attached to this workspace.\r\n   */\r\n  getRenderer(): Renderer {\r\n    return this.renderer;\r\n  }\r\n\r\n  /**\r\n   * Get the theme manager for this workspace.\r\n   *\r\n   * @returns The theme manager for this workspace.\r\n   * @internal\r\n   */\r\n  getThemeManager(): ThemeManager {\r\n    return this.themeManager_;\r\n  }\r\n\r\n  /**\r\n   * Get the workspace theme object.\r\n   *\r\n   * @returns The workspace theme object.\r\n   */\r\n  getTheme(): Theme {\r\n    return this.themeManager_.getTheme();\r\n  }\r\n\r\n  /**\r\n   * Set the workspace theme object.\r\n   * If no theme is passed, default to the `Classic` theme.\r\n   *\r\n   * @param theme The workspace theme object.\r\n   */\r\n  setTheme(theme: Theme) {\r\n    if (!theme) {\r\n      theme = Classic as Theme;\r\n    }\r\n    this.themeManager_.setTheme(theme);\r\n  }\r\n\r\n  /**\r\n   * Refresh all blocks on the workspace after a theme update.\r\n   */\r\n  refreshTheme() {\r\n    if (this.svgGroup_) {\r\n      this.renderer.refreshDom(this.svgGroup_, this.getTheme());\r\n    }\r\n\r\n    // Update all blocks in workspace that have a style name.\r\n    this.updateBlockStyles_(\r\n      this.getAllBlocks(false).filter(function (block) {\r\n        return !!block.getStyleName();\r\n      }),\r\n    );\r\n\r\n    // Update current toolbox selection.\r\n    this.refreshToolboxSelection();\r\n    if (this.toolbox_) {\r\n      this.toolbox_.refreshTheme();\r\n    }\r\n\r\n    // Re-render if workspace is visible\r\n    if (this.isVisible()) {\r\n      this.setVisible(true);\r\n    }\r\n\r\n    const event = new (eventUtils.get(eventUtils.THEME_CHANGE))(\r\n      this.getTheme().name,\r\n      this.id,\r\n    );\r\n    eventUtils.fire(event);\r\n  }\r\n\r\n  /**\r\n   * Updates all the blocks with new style.\r\n   *\r\n   * @param blocks List of blocks to update the style on.\r\n   */\r\n  private updateBlockStyles_(blocks: Block[]) {\r\n    for (let i = 0, block; (block = blocks[i]); i++) {\r\n      const blockStyleName = block.getStyleName();\r\n      if (blockStyleName) {\r\n        const blockSvg = block as BlockSvg;\r\n        blockSvg.setStyle(blockStyleName);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Getter for the inverted screen CTM.\r\n   *\r\n   * @returns The matrix to use in mouseToSvg\r\n   */\r\n  getInverseScreenCTM(): SVGMatrix | null {\r\n    // Defer getting the screen CTM until we actually need it, this should\r\n    // avoid forced reflows from any calls to updateInverseScreenCTM.\r\n    if (this.inverseScreenCTMDirty) {\r\n      const ctm = this.getParentSvg().getScreenCTM();\r\n      if (ctm) {\r\n        this.inverseScreenCTM = ctm.inverse();\r\n        this.inverseScreenCTMDirty = false;\r\n      }\r\n    }\r\n\r\n    return this.inverseScreenCTM;\r\n  }\r\n\r\n  /** Mark the inverse screen CTM as dirty. */\r\n  updateInverseScreenCTM() {\r\n    this.inverseScreenCTMDirty = true;\r\n  }\r\n\r\n  /**\r\n   * Getter for isVisible\r\n   *\r\n   * @returns Whether the workspace is visible.\r\n   *     False if the workspace has been hidden by calling `setVisible(false)`.\r\n   */\r\n  isVisible(): boolean {\r\n    return this.isVisible_;\r\n  }\r\n\r\n  /**\r\n   * Return the absolute coordinates of the top-left corner of this element,\r\n   * scales that after canvas SVG element, if it's a descendant.\r\n   * The origin (0,0) is the top-left corner of the Blockly SVG.\r\n   *\r\n   * @param element SVG element to find the coordinates of.\r\n   * @returns Object with .x and .y properties.\r\n   * @internal\r\n   */\r\n  getSvgXY(element: SVGElement): Coordinate {\r\n    let x = 0;\r\n    let y = 0;\r\n    let scale = 1;\r\n    if (\r\n      this.getCanvas().contains(element) ||\r\n      this.getBubbleCanvas().contains(element)\r\n    ) {\r\n      // Before the SVG canvas, scale the coordinates.\r\n      scale = this.scale;\r\n    }\r\n    do {\r\n      // Loop through this block and every parent.\r\n      const xy = svgMath.getRelativeXY(element);\r\n      if (element === this.getCanvas() || element === this.getBubbleCanvas()) {\r\n        // After the SVG canvas, don't scale the coordinates.\r\n        scale = 1;\r\n      }\r\n      x += xy.x * scale;\r\n      y += xy.y * scale;\r\n      element = element.parentNode as SVGElement;\r\n    } while (\r\n      element &&\r\n      element !== this.getParentSvg() &&\r\n      element !== this.getInjectionDiv()\r\n    );\r\n    return new Coordinate(x, y);\r\n  }\r\n\r\n  /**\r\n   * Gets the size of the workspace's parent SVG element.\r\n   *\r\n   * @returns The cached width and height of the workspace's parent SVG element.\r\n   * @internal\r\n   */\r\n  getCachedParentSvgSize(): Size {\r\n    const size = this.cachedParentSvgSize;\r\n    return new Size(size.width, size.height);\r\n  }\r\n\r\n  /**\r\n   * Return the position of the workspace origin relative to the injection div\r\n   * origin in pixels.\r\n   * The workspace origin is where a block would render at position (0, 0).\r\n   * It is not the upper left corner of the workspace SVG.\r\n   *\r\n   * @returns Offset in pixels.\r\n   * @internal\r\n   */\r\n  getOriginOffsetInPixels(): Coordinate {\r\n    return svgMath.getInjectionDivXY(this.getCanvas());\r\n  }\r\n\r\n  /**\r\n   * Return the injection div that is a parent of this workspace.\r\n   * Walks the DOM the first time it's called, then returns a cached value.\r\n   * Note: We assume this is only called after the workspace has been injected\r\n   * into the DOM.\r\n   *\r\n   * @returns The first parent div with 'injectionDiv' in the name.\r\n   * @internal\r\n   */\r\n  getInjectionDiv(): Element {\r\n    // NB: it would be better to pass this in at createDom, but is more likely\r\n    // to break existing uses of Blockly.\r\n    if (!this.injectionDiv) {\r\n      let element: Element = this.svgGroup_;\r\n      while (element) {\r\n        const classes = element.getAttribute('class') || '';\r\n        if ((' ' + classes + ' ').indexOf(' injectionDiv ') !== -1) {\r\n          this.injectionDiv = element;\r\n          break;\r\n        }\r\n        element = element.parentNode as Element;\r\n      }\r\n    }\r\n    return this.injectionDiv!;\r\n  }\r\n\r\n  /**\r\n   * Returns the SVG group for the workspace.\r\n   *\r\n   * @returns The SVG group for the workspace.\r\n   */\r\n  getSvgGroup(): Element {\r\n    return this.svgGroup_;\r\n  }\r\n\r\n  /**\r\n   * Get the SVG block canvas for the workspace.\r\n   *\r\n   * @returns The SVG group for the workspace.\r\n   * @internal\r\n   */\r\n  getBlockCanvas(): SVGElement | null {\r\n    return this.getCanvas();\r\n  }\r\n\r\n  /**\r\n   * Save resize handler data so we can delete it later in dispose.\r\n   *\r\n   * @param handler Data that can be passed to eventHandling.unbind.\r\n   */\r\n  setResizeHandlerWrapper(handler: browserEvents.Data) {\r\n    this.resizeHandlerWrapper = handler;\r\n  }\r\n\r\n  /**\r\n   * Create the workspace DOM elements.\r\n   *\r\n   * @param opt_backgroundClass Either 'blocklyMainBackground' or\r\n   *     'blocklyMutatorBackground'.\r\n   * @returns The workspace's SVG group.\r\n   */\r\n  createDom(opt_backgroundClass?: string, injectionDiv?: Element): Element {\r\n    if (!this.injectionDiv) {\r\n      this.injectionDiv = injectionDiv ?? null;\r\n    }\r\n\r\n    /**\r\n     * <g class=\"blocklyWorkspace\">\r\n     *   <rect class=\"blocklyMainBackground\" height=\"100%\" width=\"100%\"></rect>\r\n     *   [Trashcan and/or flyout may go here]\r\n     *   <g class=\"blocklyBlockCanvas\"></g>\r\n     *   <g class=\"blocklyBubbleCanvas\"></g>\r\n     * </g>\r\n     */\r\n    this.svgGroup_ = dom.createSvgElement(Svg.G, {'class': 'blocklyWorkspace'});\r\n\r\n    // Note that a <g> alone does not receive mouse events--it must have a\r\n    // valid target inside it.  If no background class is specified, as in the\r\n    // flyout, the workspace will not receive mouse events.\r\n    if (opt_backgroundClass) {\r\n      this.svgBackground_ = dom.createSvgElement(\r\n        Svg.RECT,\r\n        {'height': '100%', 'width': '100%', 'class': opt_backgroundClass},\r\n        this.svgGroup_,\r\n      );\r\n\r\n      if (opt_backgroundClass === 'blocklyMainBackground' && this.grid) {\r\n        this.svgBackground_.style.fill =\r\n          'url(#' + this.grid.getPatternId() + ')';\r\n      } else {\r\n        this.themeManager_.subscribe(\r\n          this.svgBackground_,\r\n          'workspaceBackgroundColour',\r\n          'fill',\r\n        );\r\n      }\r\n    }\r\n\r\n    this.layerManager = new LayerManager(this);\r\n    // Assign the canvases for backwards compatibility.\r\n    this.svgBlockCanvas_ = this.layerManager.getBlockLayer();\r\n    this.svgBubbleCanvas_ = this.layerManager.getBubbleLayer();\r\n\r\n    if (!this.isFlyout) {\r\n      browserEvents.conditionalBind(\r\n        this.svgGroup_,\r\n        'pointerdown',\r\n        this,\r\n        this.onMouseDown_,\r\n        false,\r\n      );\r\n      // This no-op works around https://bugs.webkit.org/show_bug.cgi?id=226683,\r\n      // which otherwise prevents zoom/scroll events from being observed in\r\n      // Safari. Once that bug is fixed it should be removed.\r\n      this.dummyWheelListener = () => {};\r\n      document.body.addEventListener('wheel', this.dummyWheelListener);\r\n      browserEvents.conditionalBind(\r\n        this.svgGroup_,\r\n        'wheel',\r\n        this,\r\n        this.onMouseWheel_,\r\n      );\r\n    }\r\n\r\n    // Determine if there needs to be a category tree, or a simple list of\r\n    // blocks.  This cannot be changed later, since the UI is very different.\r\n    if (this.options.hasCategories) {\r\n      const ToolboxClass = registry.getClassFromOptions(\r\n        registry.Type.TOOLBOX,\r\n        this.options,\r\n        true,\r\n      );\r\n      this.toolbox_ = new ToolboxClass!(this);\r\n    }\r\n    if (this.grid) {\r\n      this.grid.update(this.scale);\r\n    }\r\n    this.recordDragTargets();\r\n    const CursorClass = registry.getClassFromOptions(\r\n      registry.Type.CURSOR,\r\n      this.options,\r\n    );\r\n\r\n    CursorClass && this.markerManager.setCursor(new CursorClass());\r\n\r\n    this.renderer.createDom(this.svgGroup_, this.getTheme());\r\n    return this.svgGroup_;\r\n  }\r\n\r\n  /**\r\n   * Dispose of this workspace.\r\n   * Unlink from all DOM elements to prevent memory leaks.\r\n   */\r\n  override dispose() {\r\n    // Stop rerendering.\r\n    this.rendered = false;\r\n    if (this.currentGesture_) {\r\n      this.currentGesture_.cancel();\r\n    }\r\n    if (this.svgGroup_) {\r\n      dom.removeNode(this.svgGroup_);\r\n    }\r\n    if (this.toolbox_) {\r\n      this.toolbox_.dispose();\r\n      this.toolbox_ = null;\r\n    }\r\n    if (this.flyout) {\r\n      this.flyout.dispose();\r\n      this.flyout = null;\r\n    }\r\n    if (this.trashcan) {\r\n      this.trashcan.dispose();\r\n      this.trashcan = null;\r\n    }\r\n    if (this.scrollbar) {\r\n      this.scrollbar.dispose();\r\n      this.scrollbar = null;\r\n    }\r\n    if (this.zoomControls_) {\r\n      this.zoomControls_.dispose();\r\n    }\r\n\r\n    if (this.audioManager) {\r\n      this.audioManager.dispose();\r\n    }\r\n\r\n    if (this.grid) {\r\n      this.grid = null;\r\n    }\r\n\r\n    this.renderer.dispose();\r\n\r\n    if (this.markerManager) {\r\n      this.markerManager.dispose();\r\n    }\r\n\r\n    super.dispose();\r\n\r\n    // Dispose of theme manager after all blocks and mutators are disposed of.\r\n    if (this.themeManager_) {\r\n      this.themeManager_.unsubscribeWorkspace(this);\r\n      this.themeManager_.unsubscribe(this.svgBackground_);\r\n      if (!this.options.parentWorkspace) {\r\n        this.themeManager_.dispose();\r\n      }\r\n    }\r\n\r\n    this.connectionDBList.length = 0;\r\n\r\n    this.toolboxCategoryCallbacks.clear();\r\n    this.flyoutButtonCallbacks.clear();\r\n\r\n    if (!this.options.parentWorkspace) {\r\n      // Top-most workspace.  Dispose of the div that the\r\n      // SVG is injected into (i.e. injectionDiv).\r\n      const parentSvg = this.getParentSvg();\r\n      if (parentSvg && parentSvg.parentNode) {\r\n        dom.removeNode(parentSvg.parentNode);\r\n      }\r\n    }\r\n    if (this.resizeHandlerWrapper) {\r\n      browserEvents.unbind(this.resizeHandlerWrapper);\r\n      this.resizeHandlerWrapper = null;\r\n    }\r\n\r\n    // Remove the dummy wheel listener\r\n    if (this.dummyWheelListener) {\r\n      document.body.removeEventListener('wheel', this.dummyWheelListener);\r\n      this.dummyWheelListener = null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add a trashcan.\r\n   *\r\n   * @internal\r\n   */\r\n  addTrashcan() {\r\n    this.trashcan = WorkspaceSvg.newTrashcan(this);\r\n    const svgTrashcan = this.trashcan.createDom();\r\n    this.svgGroup_.insertBefore(svgTrashcan, this.getCanvas());\r\n  }\r\n\r\n  /**\r\n   * @param _workspace\r\n   * @internal\r\n   */\r\n  static newTrashcan(_workspace: WorkspaceSvg): Trashcan {\r\n    throw new Error(\r\n      'The implementation of newTrashcan should be ' +\r\n        'monkey-patched in by blockly.ts',\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Add zoom controls.\r\n   *\r\n   * @internal\r\n   */\r\n  addZoomControls() {\r\n    this.zoomControls_ = new ZoomControls(this);\r\n    const svgZoomControls = this.zoomControls_.createDom();\r\n    this.svgGroup_.appendChild(svgZoomControls);\r\n  }\r\n\r\n  /**\r\n   * Add a flyout element in an element with the given tag name.\r\n   *\r\n   * @param tagName What type of tag the flyout belongs in.\r\n   * @returns The element containing the flyout DOM.\r\n   * @internal\r\n   */\r\n  addFlyout(tagName: string | Svg<SVGSVGElement> | Svg<SVGGElement>): Element {\r\n    const workspaceOptions = new Options({\r\n      'parentWorkspace': this,\r\n      'rtl': this.RTL,\r\n      'oneBasedIndex': this.options.oneBasedIndex,\r\n      'horizontalLayout': this.horizontalLayout,\r\n      'renderer': this.options.renderer,\r\n      'rendererOverrides': this.options.rendererOverrides,\r\n      'move': {\r\n        'scrollbars': true,\r\n      },\r\n    } as BlocklyOptions);\r\n    workspaceOptions.toolboxPosition = this.options.toolboxPosition;\r\n    if (this.horizontalLayout) {\r\n      const HorizontalFlyout = registry.getClassFromOptions(\r\n        registry.Type.FLYOUTS_HORIZONTAL_TOOLBOX,\r\n        this.options,\r\n        true,\r\n      );\r\n      this.flyout = new HorizontalFlyout!(workspaceOptions);\r\n    } else {\r\n      const VerticalFlyout = registry.getClassFromOptions(\r\n        registry.Type.FLYOUTS_VERTICAL_TOOLBOX,\r\n        this.options,\r\n        true,\r\n      );\r\n      this.flyout = new VerticalFlyout!(workspaceOptions);\r\n    }\r\n    this.flyout.autoClose = false;\r\n    this.flyout.getWorkspace().setVisible(true);\r\n\r\n    // Return the element so that callers can place it in their desired\r\n    // spot in the DOM.  For example, mutator flyouts do not go in the same\r\n    // place as main workspace flyouts.\r\n    return this.flyout.createDom(tagName);\r\n  }\r\n\r\n  /**\r\n   * Getter for the flyout associated with this workspace.  This flyout may be\r\n   * owned by either the toolbox or the workspace, depending on toolbox\r\n   * configuration.  It will be null if there is no flyout.\r\n   *\r\n   * @param opt_own Whether to only return the workspace's own flyout.\r\n   * @returns The flyout on this workspace.\r\n   */\r\n  getFlyout(opt_own?: boolean): IFlyout | null {\r\n    if (this.flyout || opt_own) {\r\n      return this.flyout;\r\n    }\r\n    if (this.toolbox_) {\r\n      return this.toolbox_.getFlyout();\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Getter for the toolbox associated with this workspace, if one exists.\r\n   *\r\n   * @returns The toolbox on this workspace.\r\n   */\r\n  getToolbox(): IToolbox | null {\r\n    return this.toolbox_;\r\n  }\r\n\r\n  /**\r\n   * Update items that use screen coordinate calculations\r\n   * because something has changed (e.g. scroll position, window size).\r\n   */\r\n  private updateScreenCalculations_() {\r\n    this.updateInverseScreenCTM();\r\n    this.recordDragTargets();\r\n  }\r\n\r\n  /**\r\n   * If enabled, resize the parts of the workspace that change when the\r\n   * workspace contents (e.g. block positions) change.  This will also scroll\r\n   * the workspace contents if needed.\r\n   *\r\n   * @internal\r\n   */\r\n  resizeContents() {\r\n    if (!this.resizesEnabled || !this.rendered) {\r\n      return;\r\n    }\r\n    if (this.scrollbar) {\r\n      this.scrollbar.resize();\r\n    }\r\n    this.updateInverseScreenCTM();\r\n  }\r\n\r\n  /**\r\n   * Resize and reposition all of the workspace chrome (toolbox,\r\n   * trash, scrollbars etc.)\r\n   * This should be called when something changes that\r\n   * requires recalculating dimensions and positions of the\r\n   * trash, zoom, toolbox, etc. (e.g. window resize).\r\n   */\r\n  resize() {\r\n    if (this.toolbox_) {\r\n      this.toolbox_.position();\r\n    }\r\n    if (this.flyout) {\r\n      this.flyout.position();\r\n    }\r\n\r\n    const positionables = this.componentManager.getComponents(\r\n      ComponentManager.Capability.POSITIONABLE,\r\n      true,\r\n    );\r\n    const metrics = this.getMetricsManager().getUiMetrics();\r\n    const savedPositions = [];\r\n    for (let i = 0, positionable; (positionable = positionables[i]); i++) {\r\n      positionable.position(metrics, savedPositions);\r\n      const boundingRect = positionable.getBoundingRectangle();\r\n      if (boundingRect) {\r\n        savedPositions.push(boundingRect);\r\n      }\r\n    }\r\n\r\n    if (this.scrollbar) {\r\n      this.scrollbar.resize();\r\n    }\r\n    this.updateScreenCalculations_();\r\n  }\r\n\r\n  /**\r\n   * Resizes and repositions workspace chrome if the page has a new\r\n   * scroll position.\r\n   *\r\n   * @internal\r\n   */\r\n  updateScreenCalculationsIfScrolled() {\r\n    /* eslint-disable indent */\r\n    const currScroll = svgMath.getDocumentScroll();\r\n    if (!Coordinate.equals(this.lastRecordedPageScroll, currScroll)) {\r\n      this.lastRecordedPageScroll = currScroll;\r\n      this.updateScreenCalculations_();\r\n    }\r\n  }\r\n  /* eslint-enable indent */\r\n\r\n  /**\r\n   * @returns The layer manager for this workspace.\r\n   *\r\n   * @internal\r\n   */\r\n  getLayerManager(): LayerManager | null {\r\n    return this.layerManager;\r\n  }\r\n\r\n  /**\r\n   * Get the SVG element that forms the drawing surface.\r\n   *\r\n   * @returns SVG group element.\r\n   */\r\n  getCanvas(): SVGGElement {\r\n    return this.layerManager!.getBlockLayer();\r\n  }\r\n\r\n  /**\r\n   * Caches the width and height of the workspace's parent SVG element for use\r\n   * with getSvgMetrics.\r\n   *\r\n   * @param width The width of the parent SVG element.\r\n   * @param height The height of the parent SVG element\r\n   * @internal\r\n   */\r\n  setCachedParentSvgSize(width: number | null, height: number | null) {\r\n    const svg = this.getParentSvg();\r\n    if (width != null) {\r\n      this.cachedParentSvgSize.width = width;\r\n      // This is set to support the public (but deprecated) Blockly.svgSize\r\n      // method.\r\n      svg.setAttribute('data-cached-width', `${width}`);\r\n    }\r\n    if (height != null) {\r\n      this.cachedParentSvgSize.height = height;\r\n      // This is set to support the public (but deprecated) Blockly.svgSize\r\n      // method.\r\n      svg.setAttribute('data-cached-height', `${height}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the SVG element that forms the bubble surface.\r\n   *\r\n   * @returns SVG group element.\r\n   */\r\n  getBubbleCanvas(): SVGGElement {\r\n    return this.layerManager!.getBubbleLayer();\r\n  }\r\n\r\n  /**\r\n   * Get the SVG element that contains this workspace.\r\n   * Note: We assume this is only called after the workspace has been injected\r\n   * into the DOM.\r\n   *\r\n   * @returns SVG element.\r\n   */\r\n  getParentSvg(): SVGSVGElement {\r\n    if (!this.cachedParentSvg) {\r\n      let element = this.svgGroup_;\r\n      while (element) {\r\n        if (element.tagName === 'svg') {\r\n          this.cachedParentSvg = element;\r\n          break;\r\n        }\r\n        element = element.parentNode as SVGSVGElement;\r\n      }\r\n    }\r\n    return this.cachedParentSvg as SVGSVGElement;\r\n  }\r\n\r\n  /**\r\n   * Fires a viewport event if events are enabled and there is a change in\r\n   * viewport values.\r\n   *\r\n   * @internal\r\n   */\r\n  maybeFireViewportChangeEvent() {\r\n    if (!eventUtils.isEnabled()) {\r\n      return;\r\n    }\r\n    const scale = this.scale;\r\n    const top = -this.scrollY;\r\n    const left = -this.scrollX;\r\n    if (\r\n      scale === this.oldScale &&\r\n      Math.abs(top - this.oldTop) < 1 &&\r\n      Math.abs(left - this.oldLeft) < 1\r\n    ) {\r\n      // Ignore sub-pixel changes in top and left. Due to #4192 there are a lot\r\n      // of negligible changes in viewport top/left.\r\n      return;\r\n    }\r\n    const event = new (eventUtils.get(eventUtils.VIEWPORT_CHANGE))(\r\n      top,\r\n      left,\r\n      scale,\r\n      this.id,\r\n      this.oldScale,\r\n    );\r\n    this.oldScale = scale;\r\n    this.oldTop = top;\r\n    this.oldLeft = left;\r\n    eventUtils.fire(event);\r\n  }\r\n\r\n  /**\r\n   * Translate this workspace to new coordinates.\r\n   *\r\n   * @param x Horizontal translation, in pixel units relative to the top left of\r\n   *     the Blockly div.\r\n   * @param y Vertical translation, in pixel units relative to the top left of\r\n   *     the Blockly div.\r\n   */\r\n  translate(x: number, y: number) {\r\n    this.layerManager?.translateLayers(new Coordinate(x, y), this.scale);\r\n    this.grid?.moveTo(x, y);\r\n    this.maybeFireViewportChangeEvent();\r\n  }\r\n\r\n  /**\r\n   * Returns the horizontal offset of the workspace.\r\n   * Intended for LTR/RTL compatibility in XML.\r\n   *\r\n   * @returns Width.\r\n   */\r\n  override getWidth(): number {\r\n    const metrics = this.getMetrics();\r\n    return metrics ? metrics.viewWidth / this.scale : 0;\r\n  }\r\n\r\n  /**\r\n   * Toggles the visibility of the workspace.\r\n   * Currently only intended for main workspace.\r\n   *\r\n   * @param isVisible True if workspace should be visible.\r\n   */\r\n  setVisible(isVisible: boolean) {\r\n    this.isVisible_ = isVisible;\r\n    if (!this.svgGroup_) {\r\n      return;\r\n    }\r\n\r\n    // Tell the scrollbar whether its container is visible so it can\r\n    // tell when to hide itself.\r\n    if (this.scrollbar) {\r\n      this.scrollbar.setContainerVisible(isVisible);\r\n    }\r\n\r\n    // Tell the flyout whether its container is visible so it can\r\n    // tell when to hide itself.\r\n    if (this.getFlyout()) {\r\n      this.getFlyout()!.setContainerVisible(isVisible);\r\n    }\r\n\r\n    this.getParentSvg().style.display = isVisible ? 'block' : 'none';\r\n    if (this.toolbox_) {\r\n      // Currently does not support toolboxes in mutators.\r\n      this.toolbox_.setVisible(isVisible);\r\n    }\r\n    if (!isVisible) {\r\n      this.hideChaff(true);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Render all blocks in workspace.\r\n   */\r\n  render() {\r\n    // Generate list of all blocks.\r\n    const blocks = this.getAllBlocks(false);\r\n    // Render each block.\r\n    for (let i = blocks.length - 1; i >= 0; i--) {\r\n      blocks[i].queueRender();\r\n    }\r\n\r\n    if (this.currentGesture_) {\r\n      const imList = this.currentGesture_.getInsertionMarkers();\r\n      for (let i = 0; i < imList.length; i++) {\r\n        imList[i].queueRender();\r\n      }\r\n    }\r\n\r\n    renderManagement\r\n      .finishQueuedRenders()\r\n      .then(() => void this.markerManager.updateMarkers());\r\n  }\r\n\r\n  /**\r\n   * Highlight or unhighlight a block in the workspace.  Block highlighting is\r\n   * often used to visually mark blocks currently being executed.\r\n   *\r\n   * @param id ID of block to highlight/unhighlight, or null for no block (used\r\n   *     to unhighlight all blocks).\r\n   * @param opt_state If undefined, highlight specified block and automatically\r\n   *     unhighlight all others.  If true or false, manually\r\n   *     highlight/unhighlight the specified block.\r\n   */\r\n  highlightBlock(id: string | null, opt_state?: boolean) {\r\n    if (opt_state === undefined) {\r\n      // Unhighlight all blocks.\r\n      for (let i = 0, block; (block = this.highlightedBlocks[i]); i++) {\r\n        block.setHighlighted(false);\r\n      }\r\n      this.highlightedBlocks.length = 0;\r\n    }\r\n    // Highlight/unhighlight the specified block.\r\n    const block = id ? this.getBlockById(id) : null;\r\n    if (block) {\r\n      const state = opt_state === undefined || opt_state;\r\n      // Using Set here would be great, but at the cost of IE10 support.\r\n      if (!state) {\r\n        arrayUtils.removeElem(this.highlightedBlocks, block);\r\n      } else if (this.highlightedBlocks.indexOf(block) === -1) {\r\n        this.highlightedBlocks.push(block);\r\n      }\r\n      block.setHighlighted(state);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Pastes the provided block or workspace comment onto the workspace.\r\n   * Does not check whether there is remaining capacity for the object, that\r\n   * should be done before calling this method.\r\n   *\r\n   * @param state The representation of the thing to paste.\r\n   * @returns The pasted thing, or null if the paste was not successful.\r\n   * @deprecated v10. Use `Blockly.clipboard.paste` instead. To be removed in\r\n   *     v11.\r\n   */\r\n  paste(\r\n    state: AnyDuringMigration | Element | DocumentFragment,\r\n  ): ICopyable<ICopyData> | null {\r\n    deprecation.warn(\r\n      'Blockly.WorkspaceSvg.prototype.paste',\r\n      'v10',\r\n      'v11',\r\n      'Blockly.clipboard.paste',\r\n    );\r\n    if (!this.rendered || (!state['type'] && !state['tagName'])) {\r\n      return null;\r\n    }\r\n    if (this.currentGesture_) {\r\n      // Dragging while pasting?  No.\r\n      this.currentGesture_.cancel();\r\n    }\r\n\r\n    const existingGroup = eventUtils.getGroup();\r\n    if (!existingGroup) {\r\n      eventUtils.setGroup(true);\r\n    }\r\n    let pastedThing;\r\n    try {\r\n      // Checks if this is JSON. JSON has a type property, while elements don't.\r\n      if (state['type']) {\r\n        pastedThing = this.pasteBlock_(null, state as blocks.State);\r\n      } else {\r\n        const xmlBlock = state as Element;\r\n        if (xmlBlock.tagName.toLowerCase() === 'comment') {\r\n          pastedThing = this.pasteWorkspaceComment_(xmlBlock);\r\n        } else {\r\n          pastedThing = this.pasteBlock_(xmlBlock, null);\r\n        }\r\n      }\r\n    } finally {\r\n      eventUtils.setGroup(existingGroup);\r\n    }\r\n    return pastedThing;\r\n  }\r\n\r\n  /**\r\n   * Paste the provided block onto the workspace.\r\n   *\r\n   * @param xmlBlock XML block element.\r\n   * @param jsonBlock JSON block representation.\r\n   * @returns The pasted block.\r\n   */\r\n  private pasteBlock_(\r\n    xmlBlock: Element | null,\r\n    jsonBlock: blocks.State | null,\r\n  ): BlockSvg {\r\n    eventUtils.disable();\r\n    let block: BlockSvg;\r\n    try {\r\n      let blockX = 0;\r\n      let blockY = 0;\r\n      if (xmlBlock) {\r\n        block = Xml.domToBlockInternal(xmlBlock, this) as BlockSvg;\r\n        blockX = parseInt(xmlBlock.getAttribute('x') ?? '0');\r\n        if (this.RTL) {\r\n          blockX = -blockX;\r\n        }\r\n        blockY = parseInt(xmlBlock.getAttribute('y') ?? '0');\r\n      } else if (jsonBlock) {\r\n        block = blocks.append(jsonBlock, this) as BlockSvg;\r\n        blockX = jsonBlock['x'] || 10;\r\n        if (this.RTL) {\r\n          blockX = this.getWidth() - blockX;\r\n        }\r\n        blockY = jsonBlock['y'] || 10;\r\n      }\r\n\r\n      // Move the duplicate to original position.\r\n      if (!isNaN(blockX) && !isNaN(blockY)) {\r\n        // Offset block until not clobbering another block and not in connection\r\n        // distance with neighbouring blocks.\r\n        let collide;\r\n        do {\r\n          collide = false;\r\n          const allBlocks = this.getAllBlocks(false);\r\n          for (let i = 0, otherBlock; (otherBlock = allBlocks[i]); i++) {\r\n            const otherXY = otherBlock.getRelativeToSurfaceXY();\r\n            if (\r\n              Math.abs(blockX - otherXY.x) <= 1 &&\r\n              Math.abs(blockY - otherXY.y) <= 1\r\n            ) {\r\n              collide = true;\r\n              break;\r\n            }\r\n          }\r\n          if (!collide) {\r\n            // Check for blocks in snap range to any of its connections.\r\n            const connections = block!.getConnections_(false);\r\n            for (let i = 0, connection; (connection = connections[i]); i++) {\r\n              const neighbour = connection.closest(\r\n                config.snapRadius,\r\n                // This code doesn't work because it's passing absolute coords\r\n                // instead of relative coords. But we're deprecating the `paste`\r\n                // function anyway so we're not going to fix it.\r\n                new Coordinate(blockX, blockY),\r\n              );\r\n              if (neighbour.connection) {\r\n                collide = true;\r\n                break;\r\n              }\r\n            }\r\n          }\r\n          if (collide) {\r\n            if (this.RTL) {\r\n              blockX -= config.snapRadius;\r\n            } else {\r\n              blockX += config.snapRadius;\r\n            }\r\n            blockY += config.snapRadius * 2;\r\n          }\r\n        } while (collide);\r\n        // No 'reason' provided since events are disabled.\r\n        block!.moveTo(new Coordinate(blockX, blockY));\r\n      }\r\n    } finally {\r\n      eventUtils.enable();\r\n    }\r\n    if (eventUtils.isEnabled() && !block!.isShadow()) {\r\n      eventUtils.fire(new (eventUtils.get(eventUtils.BLOCK_CREATE))(block!));\r\n    }\r\n    block!.select();\r\n    return block!;\r\n  }\r\n\r\n  /**\r\n   * Paste the provided comment onto the workspace.\r\n   *\r\n   * @param xmlComment XML workspace comment element.\r\n   * @returns The pasted workspace comment.\r\n   */\r\n  private pasteWorkspaceComment_(xmlComment: Element): WorkspaceCommentSvg {\r\n    eventUtils.disable();\r\n    let comment: WorkspaceCommentSvg;\r\n    try {\r\n      comment = WorkspaceCommentSvg.fromXmlRendered(xmlComment, this);\r\n      // Move the duplicate to original position.\r\n      let commentX = parseInt(xmlComment.getAttribute('x') ?? '0');\r\n      let commentY = parseInt(xmlComment.getAttribute('y') ?? '0');\r\n      if (!isNaN(commentX) && !isNaN(commentY)) {\r\n        if (this.RTL) {\r\n          commentX = -commentX;\r\n        }\r\n        // Offset workspace comment.\r\n        // TODO (#1719): Properly offset comment such that it's not interfering\r\n        // with any blocks.\r\n        commentX += 50;\r\n        commentY += 50;\r\n        // This code doesn't work because it's passing absolute coords\r\n        // instead of relative coords. But we're deprecating the `paste`\r\n        // function anyway so we're not going to fix it.\r\n        comment.moveBy(commentX, commentY);\r\n      }\r\n    } finally {\r\n      eventUtils.enable();\r\n    }\r\n    if (eventUtils.isEnabled()) {\r\n      WorkspaceComment.fireCreateEvent(comment);\r\n    }\r\n    comment.select();\r\n    return comment;\r\n  }\r\n\r\n  /**\r\n   * Refresh the toolbox unless there's a drag in progress.\r\n   *\r\n   * @internal\r\n   */\r\n  refreshToolboxSelection() {\r\n    const ws = this.isFlyout ? this.targetWorkspace : this;\r\n    if (ws && !ws.currentGesture_ && ws.toolbox_ && ws.toolbox_.getFlyout()) {\r\n      ws.toolbox_.refreshSelection();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Rename a variable by updating its name in the variable map.  Update the\r\n   *     flyout to show the renamed variable immediately.\r\n   *\r\n   * @param id ID of the variable to rename.\r\n   * @param newName New variable name.\r\n   */\r\n  override renameVariableById(id: string, newName: string) {\r\n    super.renameVariableById(id, newName);\r\n    this.refreshToolboxSelection();\r\n  }\r\n\r\n  /**\r\n   * Delete a variable by the passed in ID.   Update the flyout to show\r\n   *     immediately that the variable is deleted.\r\n   *\r\n   * @param id ID of variable to delete.\r\n   */\r\n  override deleteVariableById(id: string) {\r\n    super.deleteVariableById(id);\r\n    this.refreshToolboxSelection();\r\n  }\r\n\r\n  /**\r\n   * Create a new variable with the given name.  Update the flyout to show the\r\n   *     new variable immediately.\r\n   *\r\n   * @param name The new variable's name.\r\n   * @param opt_type The type of the variable like 'int' or 'string'.\r\n   *     Does not need to be unique. Field_variable can filter variables based\r\n   * on their type. This will default to '' which is a specific type.\r\n   * @param opt_id The unique ID of the variable. This will default to a UUID.\r\n   * @returns The newly created variable.\r\n   */\r\n  override createVariable(\r\n    name: string,\r\n    opt_type?: string | null,\r\n    opt_id?: string | null,\r\n  ): VariableModel {\r\n    const newVar = super.createVariable(name, opt_type, opt_id);\r\n    this.refreshToolboxSelection();\r\n    return newVar;\r\n  }\r\n\r\n  /** Make a list of all the delete areas for this workspace. */\r\n  recordDragTargets() {\r\n    const dragTargets = this.componentManager.getComponents(\r\n      ComponentManager.Capability.DRAG_TARGET,\r\n      true,\r\n    );\r\n\r\n    this.dragTargetAreas = [];\r\n    for (let i = 0, targetArea; (targetArea = dragTargets[i]); i++) {\r\n      const rect = targetArea.getClientRect();\r\n      if (rect) {\r\n        this.dragTargetAreas.push({\r\n          component: targetArea,\r\n          clientRect: rect,\r\n        });\r\n      }\r\n    }\r\n  }\r\n  /* eslint-disable jsdoc/require-returns-check */\r\n  /* eslint-disable @typescript-eslint/no-unused-vars */\r\n  /**\r\n   * Obtain a newly created block.\r\n   *\r\n   * @param prototypeName Name of the language object containing type-specific\r\n   *     functions for this block.\r\n   * @param opt_id Optional ID.  Use this ID if provided, otherwise create a new\r\n   *     ID.\r\n   * @returns The created block.\r\n   */\r\n  override newBlock(prototypeName: string, opt_id?: string): BlockSvg {\r\n    throw new Error(\r\n      'The implementation of newBlock should be ' +\r\n        'monkey-patched in by blockly.ts',\r\n    );\r\n  }\r\n  /* eslint-enable */\r\n\r\n  /**\r\n   * Returns the drag target the pointer event is over.\r\n   *\r\n   * @param e Pointer move event.\r\n   * @returns Null if not over a drag target, or the drag target the event is\r\n   *     over.\r\n   */\r\n  getDragTarget(e: PointerEvent): IDragTarget | null {\r\n    for (let i = 0, targetArea; (targetArea = this.dragTargetAreas[i]); i++) {\r\n      if (targetArea.clientRect.contains(e.clientX, e.clientY)) {\r\n        return targetArea.component;\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Handle a pointerdown on SVG drawing surface.\r\n   *\r\n   * @param e Pointer down event.\r\n   */\r\n  private onMouseDown_(e: PointerEvent) {\r\n    const gesture = this.getGesture(e);\r\n    if (gesture) {\r\n      gesture.handleWsStart(e, this);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Start tracking a drag of an object on this workspace.\r\n   *\r\n   * @param e Pointer down event.\r\n   * @param xy Starting location of object.\r\n   */\r\n  startDrag(e: PointerEvent, xy: Coordinate) {\r\n    // Record the starting offset between the bubble's location and the mouse.\r\n    const point = browserEvents.mouseToSvg(\r\n      e,\r\n      this.getParentSvg(),\r\n      this.getInverseScreenCTM(),\r\n    );\r\n    // Fix scale of mouse event.\r\n    point.x /= this.scale;\r\n    point.y /= this.scale;\r\n    this.dragDeltaXY = Coordinate.difference(xy, point);\r\n  }\r\n\r\n  /**\r\n   * Track a drag of an object on this workspace.\r\n   *\r\n   * @param e Pointer move event.\r\n   * @returns New location of object.\r\n   */\r\n  moveDrag(e: PointerEvent): Coordinate {\r\n    const point = browserEvents.mouseToSvg(\r\n      e,\r\n      this.getParentSvg(),\r\n      this.getInverseScreenCTM(),\r\n    );\r\n    // Fix scale of mouse event.\r\n    point.x /= this.scale;\r\n    point.y /= this.scale;\r\n    return Coordinate.sum(this.dragDeltaXY!, point);\r\n  }\r\n\r\n  /**\r\n   * Is the user currently dragging a block or scrolling the flyout/workspace?\r\n   *\r\n   * @returns True if currently dragging or scrolling.\r\n   */\r\n  isDragging(): boolean {\r\n    return this.currentGesture_ !== null && this.currentGesture_.isDragging();\r\n  }\r\n\r\n  /**\r\n   * Is this workspace draggable?\r\n   *\r\n   * @returns True if this workspace may be dragged.\r\n   */\r\n  isDraggable(): boolean {\r\n    return this.options.moveOptions && this.options.moveOptions.drag;\r\n  }\r\n\r\n  /**\r\n   * Is this workspace movable?\r\n   *\r\n   * This means the user can reposition the X Y coordinates of the workspace\r\n   * through input. This can be through scrollbars, scroll wheel, dragging, or\r\n   * through zooming with the scroll wheel or pinch (since the zoom is centered\r\n   * on the mouse position). This does not include zooming with the zoom\r\n   * controls since the X Y coordinates are decided programmatically.\r\n   *\r\n   * @returns True if the workspace is movable, false otherwise.\r\n   */\r\n  isMovable(): boolean {\r\n    return (\r\n      (this.options.moveOptions && !!this.options.moveOptions.scrollbars) ||\r\n      (this.options.moveOptions && this.options.moveOptions.wheel) ||\r\n      (this.options.moveOptions && this.options.moveOptions.drag) ||\r\n      (this.options.zoomOptions && this.options.zoomOptions.wheel) ||\r\n      (this.options.zoomOptions && this.options.zoomOptions.pinch)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Is this workspace movable horizontally?\r\n   *\r\n   * @returns True if the workspace is movable horizontally, false otherwise.\r\n   */\r\n  isMovableHorizontally(): boolean {\r\n    const hasScrollbars = !!this.scrollbar;\r\n    return (\r\n      this.isMovable() &&\r\n      (!hasScrollbars ||\r\n        (hasScrollbars && this.scrollbar!.canScrollHorizontally()))\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Is this workspace movable vertically?\r\n   *\r\n   * @returns True if the workspace is movable vertically, false otherwise.\r\n   */\r\n  isMovableVertically(): boolean {\r\n    const hasScrollbars = !!this.scrollbar;\r\n    return (\r\n      this.isMovable() &&\r\n      (!hasScrollbars ||\r\n        (hasScrollbars && this.scrollbar!.canScrollVertically()))\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Handle a mouse-wheel on SVG drawing surface.\r\n   *\r\n   * @param e Mouse wheel event.\r\n   */\r\n  private onMouseWheel_(e: WheelEvent) {\r\n    // Don't scroll or zoom anything if drag is in progress.\r\n    if (Gesture.inProgress()) {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      return;\r\n    }\r\n    const canWheelZoom =\r\n      this.options.zoomOptions && this.options.zoomOptions.wheel;\r\n    const canWheelMove =\r\n      this.options.moveOptions && this.options.moveOptions.wheel;\r\n    if (!canWheelZoom && !canWheelMove) {\r\n      return;\r\n    }\r\n\r\n    const scrollDelta = browserEvents.getScrollDeltaPixels(e);\r\n\r\n    // Zoom should also be enabled by the command key on Mac devices,\r\n    // but not super on Unix.\r\n    let commandKey;\r\n    if (userAgent.MAC) {\r\n      commandKey = e.metaKey;\r\n    }\r\n\r\n    if (canWheelZoom && (e.ctrlKey || commandKey || !canWheelMove)) {\r\n      // Zoom.\r\n      // The vertical scroll distance that corresponds to a click of a zoom\r\n      // button.\r\n      const PIXELS_PER_ZOOM_STEP = 50;\r\n      const delta = -scrollDelta.y / PIXELS_PER_ZOOM_STEP;\r\n      const position = browserEvents.mouseToSvg(\r\n        e,\r\n        this.getParentSvg(),\r\n        this.getInverseScreenCTM(),\r\n      );\r\n      this.zoom(position.x, position.y, delta);\r\n    } else {\r\n      // Scroll.\r\n      let x = this.scrollX - scrollDelta.x;\r\n      let y = this.scrollY - scrollDelta.y;\r\n\r\n      if (e.shiftKey && !scrollDelta.x) {\r\n        // Scroll horizontally (based on vertical scroll delta).\r\n        // This is needed as for some browser/system combinations which do not\r\n        // set deltaX.\r\n        x = this.scrollX - scrollDelta.y;\r\n        y = this.scrollY; // Don't scroll vertically.\r\n      }\r\n      this.scroll(x, y);\r\n    }\r\n    e.preventDefault();\r\n  }\r\n\r\n  /**\r\n   * Calculate the bounding box for the blocks on the workspace.\r\n   * Coordinate system: workspace coordinates.\r\n   *\r\n   * @returns Contains the position and size of the bounding box containing the\r\n   *     blocks on the workspace.\r\n   */\r\n  getBlocksBoundingBox(): Rect {\r\n    const topElements = this.getTopBoundedElements();\r\n    // There are no blocks, return empty rectangle.\r\n    if (!topElements.length) {\r\n      return new Rect(0, 0, 0, 0);\r\n    }\r\n\r\n    // Initialize boundary using the first block.\r\n    const boundary = topElements[0].getBoundingRectangle();\r\n\r\n    // Start at 1 since the 0th block was used for initialization.\r\n    for (let i = 1; i < topElements.length; i++) {\r\n      const topElement = topElements[i];\r\n      if (\r\n        (topElement as any).isInsertionMarker &&\r\n        (topElement as any).isInsertionMarker()\r\n      ) {\r\n        continue;\r\n      }\r\n      const blockBoundary = topElement.getBoundingRectangle();\r\n      if (blockBoundary.top < boundary.top) {\r\n        boundary.top = blockBoundary.top;\r\n      }\r\n      if (blockBoundary.bottom > boundary.bottom) {\r\n        boundary.bottom = blockBoundary.bottom;\r\n      }\r\n      if (blockBoundary.left < boundary.left) {\r\n        boundary.left = blockBoundary.left;\r\n      }\r\n      if (blockBoundary.right > boundary.right) {\r\n        boundary.right = blockBoundary.right;\r\n      }\r\n    }\r\n    return boundary;\r\n  }\r\n\r\n  /** Clean up the workspace by ordering all the blocks in a column. */\r\n  cleanUp() {\r\n    this.setResizesEnabled(false);\r\n    eventUtils.setGroup(true);\r\n    const topBlocks = this.getTopBlocks(true);\r\n    let cursorY = 0;\r\n    for (let i = 0, block; (block = topBlocks[i]); i++) {\r\n      if (!block.isMovable()) {\r\n        continue;\r\n      }\r\n      const xy = block.getRelativeToSurfaceXY();\r\n      block.moveBy(-xy.x, cursorY - xy.y, ['cleanup']);\r\n      block.snapToGrid();\r\n      cursorY =\r\n        block.getRelativeToSurfaceXY().y +\r\n        block.getHeightWidth().height +\r\n        this.renderer.getConstants().MIN_BLOCK_HEIGHT;\r\n    }\r\n    eventUtils.setGroup(false);\r\n    this.setResizesEnabled(true);\r\n  }\r\n\r\n  /**\r\n   * Show the context menu for the workspace.\r\n   *\r\n   * @param e Mouse event.\r\n   * @internal\r\n   */\r\n  showContextMenu(e: Event) {\r\n    if (this.options.readOnly || this.isFlyout) {\r\n      return;\r\n    }\r\n    const menuOptions = ContextMenuRegistry.registry.getContextMenuOptions(\r\n      ContextMenuRegistry.ScopeType.WORKSPACE,\r\n      {workspace: this},\r\n    );\r\n\r\n    // Allow the developer to add or modify menuOptions.\r\n    if (this.configureContextMenu) {\r\n      this.configureContextMenu(menuOptions, e);\r\n    }\r\n\r\n    ContextMenu.show(e, menuOptions, this.RTL);\r\n  }\r\n\r\n  /**\r\n   * Modify the block tree on the existing toolbox.\r\n   *\r\n   * @param toolboxDef DOM tree of toolbox contents, string of toolbox contents,\r\n   *     or JSON representing toolbox definition.\r\n   */\r\n  updateToolbox(toolboxDef: toolbox.ToolboxDefinition | null) {\r\n    const parsedToolboxDef = toolbox.convertToolboxDefToJson(toolboxDef);\r\n\r\n    if (!parsedToolboxDef) {\r\n      if (this.options.languageTree) {\r\n        throw Error(\"Can't nullify an existing toolbox.\");\r\n      }\r\n      return; // No change (null to null).\r\n    }\r\n    if (!this.options.languageTree) {\r\n      throw Error(\"Existing toolbox is null.  Can't create new toolbox.\");\r\n    }\r\n\r\n    if (toolbox.hasCategories(parsedToolboxDef)) {\r\n      if (!this.toolbox_) {\r\n        throw Error(\"Existing toolbox has no categories.  Can't change mode.\");\r\n      }\r\n      this.options.languageTree = parsedToolboxDef;\r\n      this.toolbox_.render(parsedToolboxDef);\r\n    } else {\r\n      if (!this.flyout) {\r\n        throw Error(\"Existing toolbox has categories.  Can't change mode.\");\r\n      }\r\n      this.options.languageTree = parsedToolboxDef;\r\n      this.flyout.show(parsedToolboxDef);\r\n    }\r\n  }\r\n\r\n  /** Mark this workspace as the currently focused main workspace. */\r\n  markFocused() {\r\n    if (this.options.parentWorkspace) {\r\n      this.options.parentWorkspace.markFocused();\r\n    } else {\r\n      common.setMainWorkspace(this);\r\n      // We call e.preventDefault in many event handlers which means we\r\n      // need to explicitly grab focus (e.g from a textarea) because\r\n      // the browser will not do it for us.\r\n      this.getParentSvg().focus({preventScroll: true});\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Zooms the workspace in or out relative to/centered on the given (x, y)\r\n   * coordinate.\r\n   *\r\n   * @param x X coordinate of center, in pixel units relative to the top-left\r\n   *     corner of the parentSVG.\r\n   * @param y Y coordinate of center, in pixel units relative to the top-left\r\n   *     corner of the parentSVG.\r\n   * @param amount Amount of zooming. The formula for the new scale is newScale\r\n   *     = currentScale * (scaleSpeed^amount). scaleSpeed is set in the\r\n   *     workspace options. Negative amount values zoom out, and positive amount\r\n   *     values zoom in.\r\n   */\r\n  zoom(x: number, y: number, amount: number) {\r\n    // Scale factor.\r\n    const speed = this.options.zoomOptions.scaleSpeed;\r\n    let scaleChange = Math.pow(speed, amount);\r\n    const newScale = this.scale * scaleChange;\r\n    if (this.scale === newScale) {\r\n      return; // No change in zoom.\r\n    }\r\n\r\n    // Clamp scale within valid range.\r\n    if (newScale > this.options.zoomOptions.maxScale) {\r\n      scaleChange = this.options.zoomOptions.maxScale / this.scale;\r\n    } else if (newScale < this.options.zoomOptions.minScale) {\r\n      scaleChange = this.options.zoomOptions.minScale / this.scale;\r\n    }\r\n\r\n    // Transform the x/y coordinates from the parentSVG's space into the\r\n    // canvas' space, so that they are in workspace units relative to the top\r\n    // left of the visible portion of the workspace.\r\n    let matrix = this.getCanvas().getCTM();\r\n    let center = this.getParentSvg().createSVGPoint();\r\n    center.x = x;\r\n    center.y = y;\r\n    center = center.matrixTransform(matrix!.inverse());\r\n    x = center.x;\r\n    y = center.y;\r\n\r\n    // Find the new scrollX/scrollY so that the center remains in the same\r\n    // position (relative to the center) after we zoom.\r\n    // newScale and matrix.a should be identical (within a rounding error).\r\n    matrix = matrix!\r\n      .translate(x * (1 - scaleChange), y * (1 - scaleChange))\r\n      .scale(scaleChange);\r\n    // scrollX and scrollY are in pixels.\r\n    // The scrollX and scrollY still need to have absoluteLeft and absoluteTop\r\n    // subtracted from them, but we'll leave that for setScale so that they're\r\n    // correctly updated for the new flyout size if we have a simple toolbox.\r\n    this.scrollX = matrix.e;\r\n    this.scrollY = matrix.f;\r\n    this.setScale(newScale);\r\n  }\r\n\r\n  /**\r\n   * Zooming the blocks centered in the center of view with zooming in or out.\r\n   *\r\n   * @param type Type of zooming (-1 zooming out and 1 zooming in).\r\n   */\r\n  zoomCenter(type: number) {\r\n    const metrics = this.getMetrics();\r\n    let x;\r\n    let y;\r\n    if (this.flyout) {\r\n      // If you want blocks in the center of the view (visible portion of the\r\n      // workspace) to stay centered when the size of the view decreases (i.e.\r\n      // when the size of the flyout increases) you need the center of the\r\n      // *blockly div* to stay in the same pixel-position.\r\n      // Note: This only works because of how scrollCenter positions blocks.\r\n      x = metrics.svgWidth ? metrics.svgWidth / 2 : 0;\r\n      y = metrics.svgHeight ? metrics.svgHeight / 2 : 0;\r\n    } else {\r\n      x = metrics.viewWidth / 2 + metrics.absoluteLeft;\r\n      y = metrics.viewHeight / 2 + metrics.absoluteTop;\r\n    }\r\n    this.zoom(x, y, type);\r\n  }\r\n\r\n  /** Zoom the blocks to fit in the workspace if possible. */\r\n  zoomToFit() {\r\n    if (!this.isMovable()) {\r\n      console.warn(\r\n        'Tried to move a non-movable workspace. This could result' +\r\n          ' in blocks becoming inaccessible.',\r\n      );\r\n      return;\r\n    }\r\n\r\n    const metrics = this.getMetrics();\r\n    let workspaceWidth = metrics.viewWidth;\r\n    let workspaceHeight = metrics.viewHeight;\r\n    const blocksBox = this.getBlocksBoundingBox();\r\n    const doubleMargin = ZOOM_TO_FIT_MARGIN * 2;\r\n    let blocksWidth = blocksBox.right - blocksBox.left + doubleMargin;\r\n    let blocksHeight = blocksBox.bottom - blocksBox.top + doubleMargin;\r\n    if (!blocksWidth) {\r\n      return; // Prevents zooming to infinity.\r\n    }\r\n    if (this.flyout) {\r\n      // We have to add the flyout size to both the workspace size and the\r\n      // block size because the blocks we want to resize include the blocks in\r\n      // the flyout, and the area we want to fit them includes the portion of\r\n      // the workspace that is behind the flyout.\r\n      if (this.horizontalLayout) {\r\n        workspaceHeight += this.flyout.getHeight();\r\n        // Convert from pixels to workspace coordinates.\r\n        blocksHeight += this.flyout.getHeight() / this.scale;\r\n      } else {\r\n        workspaceWidth += this.flyout.getWidth();\r\n        // Convert from pixels to workspace coordinates.\r\n        blocksWidth += this.flyout.getWidth() / this.scale;\r\n      }\r\n    }\r\n\r\n    // Scale Units: (pixels / workspaceUnit)\r\n    const ratioX = workspaceWidth / blocksWidth;\r\n    const ratioY = workspaceHeight / blocksHeight;\r\n    eventUtils.disable();\r\n    try {\r\n      this.setScale(Math.min(ratioX, ratioY));\r\n      this.scrollCenter();\r\n    } finally {\r\n      eventUtils.enable();\r\n    }\r\n    this.maybeFireViewportChangeEvent();\r\n  }\r\n\r\n  /**\r\n   * Add a transition class to the block and bubble canvas, to animate any\r\n   * transform changes.\r\n   *\r\n   * @internal\r\n   */\r\n  beginCanvasTransition() {\r\n    dom.addClass(this.getCanvas(), 'blocklyCanvasTransitioning');\r\n    dom.addClass(this.getBubbleCanvas(), 'blocklyCanvasTransitioning');\r\n  }\r\n\r\n  /**\r\n   * Remove transition class from the block and bubble canvas.\r\n   *\r\n   * @internal\r\n   */\r\n  endCanvasTransition() {\r\n    dom.removeClass(this.getCanvas(), 'blocklyCanvasTransitioning');\r\n    dom.removeClass(this.getBubbleCanvas(), 'blocklyCanvasTransitioning');\r\n  }\r\n\r\n  /** Center the workspace. */\r\n  scrollCenter() {\r\n    if (!this.isMovable()) {\r\n      console.warn(\r\n        'Tried to move a non-movable workspace. This could result' +\r\n          ' in blocks becoming inaccessible.',\r\n      );\r\n      return;\r\n    }\r\n\r\n    const metrics = this.getMetrics();\r\n    let x = (metrics.scrollWidth - metrics.viewWidth) / 2;\r\n    let y = (metrics.scrollHeight - metrics.viewHeight) / 2;\r\n\r\n    // Convert from workspace directions to canvas directions.\r\n    x = -x - metrics.scrollLeft;\r\n    y = -y - metrics.scrollTop;\r\n    this.scroll(x, y);\r\n  }\r\n\r\n  /**\r\n   * Scroll the workspace to center on the given block. If the block has other\r\n   * blocks stacked below it, the workspace will be centered on the stack,\r\n   * unless blockOnly is true.\r\n   *\r\n   * @param id ID of block center on.\r\n   * @param blockOnly True to center only on the block itself, not its stack.\r\n   */\r\n  centerOnBlock(id: string | null, blockOnly?: boolean) {\r\n    if (!this.isMovable()) {\r\n      console.warn(\r\n        'Tried to move a non-movable workspace. This could result' +\r\n          ' in blocks becoming inaccessible.',\r\n      );\r\n      return;\r\n    }\r\n\r\n    const block = id ? this.getBlockById(id) : null;\r\n    if (!block) {\r\n      return;\r\n    }\r\n\r\n    // XY is in workspace coordinates.\r\n    const xy = block.getRelativeToSurfaceXY();\r\n    // Height/width is in workspace units.\r\n    const heightWidth = blockOnly\r\n      ? {height: block.height, width: block.width}\r\n      : block.getHeightWidth();\r\n\r\n    // Find the enter of the block in workspace units.\r\n    const blockCenterY = xy.y + heightWidth.height / 2;\r\n\r\n    // In RTL the block's position is the top right of the block, not top left.\r\n    const multiplier = this.RTL ? -1 : 1;\r\n    const blockCenterX = xy.x + (multiplier * heightWidth.width) / 2;\r\n\r\n    // Workspace scale, used to convert from workspace coordinates to pixels.\r\n    const scale = this.scale;\r\n\r\n    // Center of block in pixels, relative to workspace origin (center 0,0).\r\n    // Scrolling to here would put the block in the top-left corner of the\r\n    // visible workspace.\r\n    const pixelX = blockCenterX * scale;\r\n    const pixelY = blockCenterY * scale;\r\n\r\n    const metrics = this.getMetrics();\r\n\r\n    // viewHeight and viewWidth are in pixels.\r\n    const halfViewWidth = metrics.viewWidth / 2;\r\n    const halfViewHeight = metrics.viewHeight / 2;\r\n\r\n    // Put the block in the center of the visible workspace instead.\r\n    const scrollToCenterX = pixelX - halfViewWidth;\r\n    const scrollToCenterY = pixelY - halfViewHeight;\r\n\r\n    // Convert from workspace directions to canvas directions.\r\n    const x = -scrollToCenterX;\r\n    const y = -scrollToCenterY;\r\n\r\n    this.scroll(x, y);\r\n  }\r\n\r\n  /**\r\n   * Set the workspace's zoom factor.\r\n   *\r\n   * @param newScale Zoom factor. Units: (pixels / workspaceUnit).\r\n   */\r\n  setScale(newScale: number) {\r\n    if (\r\n      this.options.zoomOptions.maxScale &&\r\n      newScale > this.options.zoomOptions.maxScale\r\n    ) {\r\n      newScale = this.options.zoomOptions.maxScale;\r\n    } else if (\r\n      this.options.zoomOptions.minScale &&\r\n      newScale < this.options.zoomOptions.minScale\r\n    ) {\r\n      newScale = this.options.zoomOptions.minScale;\r\n    }\r\n    this.scale = newScale;\r\n\r\n    this.hideChaff(false);\r\n    // Get the flyout, if any, whether our own or owned by the toolbox.\r\n    const flyout = this.getFlyout(false);\r\n    if (flyout && flyout.isVisible()) {\r\n      flyout.reflow();\r\n      this.recordDragTargets();\r\n    }\r\n    if (this.grid) {\r\n      this.grid.update(this.scale);\r\n    }\r\n\r\n    // We call scroll instead of scrollbar.resize() so that we can center the\r\n    // zoom correctly without scrollbars, but scroll does not resize the\r\n    // scrollbars so we have to call resizeView/resizeContent as well.\r\n    const metrics = this.getMetrics();\r\n\r\n    this.scrollX -= metrics.absoluteLeft;\r\n    this.scrollY -= metrics.absoluteTop;\r\n    // The scroll values and the view values are additive inverses of\r\n    // each other, so when we subtract from one we have to add to the other.\r\n    metrics.viewLeft += metrics.absoluteLeft;\r\n    metrics.viewTop += metrics.absoluteTop;\r\n\r\n    this.scroll(this.scrollX, this.scrollY);\r\n    if (this.scrollbar) {\r\n      if (this.flyout) {\r\n        this.scrollbar.resizeView(metrics);\r\n      } else {\r\n        this.scrollbar.resizeContent(metrics);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the workspace's zoom factor.  If the workspace has a parent, we call\r\n   * into the parent to get the workspace scale.\r\n   *\r\n   * @returns The workspace zoom factor. Units: (pixels / workspaceUnit).\r\n   */\r\n  getScale(): number {\r\n    if (this.options.parentWorkspace) {\r\n      return this.options.parentWorkspace.getScale();\r\n    }\r\n    return this.scale;\r\n  }\r\n\r\n  /**\r\n   * Scroll the workspace to a specified offset (in pixels), keeping in the\r\n   * workspace bounds. See comment on workspaceSvg.scrollX for more detail on\r\n   * the meaning of these values.\r\n   *\r\n   * @param x Target X to scroll to.\r\n   * @param y Target Y to scroll to.\r\n   * @internal\r\n   */\r\n  scroll(x: number, y: number) {\r\n    this.hideChaff(/* opt_onlyClosePopups= */ true);\r\n\r\n    // Keep scrolling within the bounds of the content.\r\n    const metrics = this.getMetrics();\r\n    // Canvas coordinates (aka scroll coordinates) have inverse directionality\r\n    // to workspace coordinates so we have to inverse them.\r\n    x = Math.min(x, -metrics.scrollLeft);\r\n    y = Math.min(y, -metrics.scrollTop);\r\n    const maxXDisplacement = Math.max(\r\n      0,\r\n      metrics.scrollWidth - metrics.viewWidth,\r\n    );\r\n    const maxXScroll = metrics.scrollLeft + maxXDisplacement;\r\n    const maxYDisplacement = Math.max(\r\n      0,\r\n      metrics.scrollHeight - metrics.viewHeight,\r\n    );\r\n    const maxYScroll = metrics.scrollTop + maxYDisplacement;\r\n    x = Math.max(x, -maxXScroll);\r\n    y = Math.max(y, -maxYScroll);\r\n    this.scrollX = x;\r\n    this.scrollY = y;\r\n\r\n    if (this.scrollbar) {\r\n      // The content position (displacement from the content's top-left to the\r\n      // origin) plus the scroll position (displacement from the view's top-left\r\n      // to the origin) gives us the distance from the view's top-left to the\r\n      // content's top-left. Then we negate this so we get the displacement from\r\n      // the content's top-left to the view's top-left, matching the\r\n      // directionality of the scrollbars.\r\n      this.scrollbar.set(\r\n        -(x + metrics.scrollLeft),\r\n        -(y + metrics.scrollTop),\r\n        false,\r\n      );\r\n    }\r\n    // We have to shift the translation so that when the canvas is at 0, 0 the\r\n    // workspace origin is not underneath the toolbox.\r\n    x += metrics.absoluteLeft;\r\n    y += metrics.absoluteTop;\r\n    this.translate(x, y);\r\n  }\r\n\r\n  /**\r\n   * Find the block on this workspace with the specified ID.\r\n   *\r\n   * @param id ID of block to find.\r\n   * @returns The sought after block, or null if not found.\r\n   */\r\n  override getBlockById(id: string): BlockSvg | null {\r\n    return super.getBlockById(id) as BlockSvg;\r\n  }\r\n\r\n  /**\r\n   * Find all blocks in workspace.  Blocks are optionally sorted\r\n   * by position; top to bottom (with slight LTR or RTL bias).\r\n   *\r\n   * @param ordered Sort the list if true.\r\n   * @returns Array of blocks.\r\n   */\r\n  override getAllBlocks(ordered = false): BlockSvg[] {\r\n    return super.getAllBlocks(ordered) as BlockSvg[];\r\n  }\r\n\r\n  /**\r\n   * Finds the top-level blocks and returns them.  Blocks are optionally sorted\r\n   * by position; top to bottom (with slight LTR or RTL bias).\r\n   *\r\n   * @param ordered Sort the list if true.\r\n   * @returns The top-level block objects.\r\n   */\r\n  override getTopBlocks(ordered = false): BlockSvg[] {\r\n    return super.getTopBlocks(ordered) as BlockSvg[];\r\n  }\r\n\r\n  /**\r\n   * Adds a block to the list of top blocks.\r\n   *\r\n   * @param block Block to add.\r\n   */\r\n  override addTopBlock(block: Block) {\r\n    this.addTopBoundedElement(block as BlockSvg);\r\n    super.addTopBlock(block);\r\n  }\r\n\r\n  /**\r\n   * Removes a block from the list of top blocks.\r\n   *\r\n   * @param block Block to remove.\r\n   */\r\n  override removeTopBlock(block: Block) {\r\n    this.removeTopBoundedElement(block as BlockSvg);\r\n    super.removeTopBlock(block);\r\n  }\r\n\r\n  /**\r\n   * Adds a comment to the list of top comments.\r\n   *\r\n   * @param comment comment to add.\r\n   */\r\n  override addTopComment(comment: WorkspaceComment) {\r\n    this.addTopBoundedElement(comment as WorkspaceCommentSvg);\r\n    super.addTopComment(comment);\r\n  }\r\n\r\n  /**\r\n   * Removes a comment from the list of top comments.\r\n   *\r\n   * @param comment comment to remove.\r\n   */\r\n  override removeTopComment(comment: WorkspaceComment) {\r\n    this.removeTopBoundedElement(comment as WorkspaceCommentSvg);\r\n    super.removeTopComment(comment);\r\n  }\r\n\r\n  override getRootWorkspace(): WorkspaceSvg | null {\r\n    return super.getRootWorkspace() as WorkspaceSvg | null;\r\n  }\r\n\r\n  /**\r\n   * Adds a bounded element to the list of top bounded elements.\r\n   *\r\n   * @param element Bounded element to add.\r\n   */\r\n  addTopBoundedElement(element: IBoundedElement) {\r\n    this.topBoundedElements.push(element);\r\n  }\r\n\r\n  /**\r\n   * Removes a bounded element from the list of top bounded elements.\r\n   *\r\n   * @param element Bounded element to remove.\r\n   */\r\n  removeTopBoundedElement(element: IBoundedElement) {\r\n    arrayUtils.removeElem(this.topBoundedElements, element);\r\n  }\r\n\r\n  /**\r\n   * Finds the top-level bounded elements and returns them.\r\n   *\r\n   * @returns The top-level bounded elements.\r\n   */\r\n  getTopBoundedElements(): IBoundedElement[] {\r\n    return new Array<IBoundedElement>().concat(this.topBoundedElements);\r\n  }\r\n\r\n  /**\r\n   * Update whether this workspace has resizes enabled.\r\n   * If enabled, workspace will resize when appropriate.\r\n   * If disabled, workspace will not resize until re-enabled.\r\n   * Use to avoid resizing during a batch operation, for performance.\r\n   *\r\n   * @param enabled Whether resizes should be enabled.\r\n   */\r\n  setResizesEnabled(enabled: boolean) {\r\n    const reenabled = !this.resizesEnabled && enabled;\r\n    this.resizesEnabled = enabled;\r\n    if (reenabled) {\r\n      // Newly enabled.  Trigger a resize.\r\n      this.resizeContents();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Dispose of all blocks in workspace, with an optimization to prevent\r\n   * resizes.\r\n   */\r\n  override clear() {\r\n    this.setResizesEnabled(false);\r\n    super.clear();\r\n    this.topBoundedElements = [];\r\n    this.setResizesEnabled(true);\r\n  }\r\n\r\n  /**\r\n   * Register a callback function associated with a given key, for clicks on\r\n   * buttons and labels in the flyout.\r\n   * For instance, a button specified by the XML\r\n   * <button text=\"create variable\" callbackKey=\"CREATE_VARIABLE\"></button>\r\n   * should be matched by a call to\r\n   * registerButtonCallback(\"CREATE_VARIABLE\", yourCallbackFunction).\r\n   *\r\n   * @param key The name to use to look up this function.\r\n   * @param func The function to call when the given button is clicked.\r\n   */\r\n  registerButtonCallback(key: string, func: (p1: FlyoutButton) => void) {\r\n    if (typeof func !== 'function') {\r\n      throw TypeError('Button callbacks must be functions.');\r\n    }\r\n    this.flyoutButtonCallbacks.set(key, func);\r\n  }\r\n\r\n  /**\r\n   * Get the callback function associated with a given key, for clicks on\r\n   * buttons and labels in the flyout.\r\n   *\r\n   * @param key The name to use to look up the function.\r\n   * @returns The function corresponding to the given key for this workspace;\r\n   *     null if no callback is registered.\r\n   */\r\n  getButtonCallback(key: string): ((p1: FlyoutButton) => void) | null {\r\n    return this.flyoutButtonCallbacks.get(key) ?? null;\r\n  }\r\n\r\n  /**\r\n   * Remove a callback for a click on a button in the flyout.\r\n   *\r\n   * @param key The name associated with the callback function.\r\n   */\r\n  removeButtonCallback(key: string) {\r\n    this.flyoutButtonCallbacks.delete(key);\r\n  }\r\n\r\n  /**\r\n   * Register a callback function associated with a given key, for populating\r\n   * custom toolbox categories in this workspace.  See the variable and\r\n   * procedure categories as an example.\r\n   *\r\n   * @param key The name to use to look up this function.\r\n   * @param func The function to call when the given toolbox category is opened.\r\n   */\r\n  registerToolboxCategoryCallback(\r\n    key: string,\r\n    func: (p1: WorkspaceSvg) => toolbox.FlyoutDefinition,\r\n  ) {\r\n    if (typeof func !== 'function') {\r\n      throw TypeError('Toolbox category callbacks must be functions.');\r\n    }\r\n    this.toolboxCategoryCallbacks.set(key, func);\r\n  }\r\n\r\n  /**\r\n   * Get the callback function associated with a given key, for populating\r\n   * custom toolbox categories in this workspace.\r\n   *\r\n   * @param key The name to use to look up the function.\r\n   * @returns The function corresponding to the given key for this workspace, or\r\n   *     null if no function is registered.\r\n   */\r\n  getToolboxCategoryCallback(\r\n    key: string,\r\n  ): ((p1: WorkspaceSvg) => toolbox.FlyoutDefinition) | null {\r\n    return this.toolboxCategoryCallbacks.get(key) || null;\r\n  }\r\n\r\n  /**\r\n   * Remove a callback for a click on a custom category's name in the toolbox.\r\n   *\r\n   * @param key The name associated with the callback function.\r\n   */\r\n  removeToolboxCategoryCallback(key: string) {\r\n    this.toolboxCategoryCallbacks.delete(key);\r\n  }\r\n\r\n  /**\r\n   * Look up the gesture that is tracking this touch stream on this workspace.\r\n   * May create a new gesture.\r\n   *\r\n   * @param e Pointer event.\r\n   * @returns The gesture that is tracking this touch stream, or null if no\r\n   *     valid gesture exists.\r\n   * @internal\r\n   */\r\n  getGesture(e: PointerEvent): Gesture | null {\r\n    const isStart = e.type === 'pointerdown';\r\n\r\n    const gesture = this.currentGesture_;\r\n    if (gesture) {\r\n      if (isStart && gesture.hasStarted()) {\r\n        console.warn('Tried to start the same gesture twice.');\r\n        // That's funny.  We must have missed a mouse up.\r\n        // Cancel it, rather than try to retrieve all of the state we need.\r\n        gesture.cancel();\r\n        return null;\r\n      }\r\n      return gesture;\r\n    }\r\n\r\n    // No gesture existed on this workspace, but this looks like the start of a\r\n    // new gesture.\r\n    if (isStart) {\r\n      this.currentGesture_ = new Gesture(e, this);\r\n      return this.currentGesture_;\r\n    }\r\n    // No gesture existed and this event couldn't be the start of a new gesture.\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Clear the reference to the current gesture.\r\n   *\r\n   * @internal\r\n   */\r\n  clearGesture() {\r\n    this.currentGesture_ = null;\r\n  }\r\n\r\n  /**\r\n   * Cancel the current gesture, if one exists.\r\n   *\r\n   * @internal\r\n   */\r\n  cancelCurrentGesture() {\r\n    if (this.currentGesture_) {\r\n      this.currentGesture_.cancel();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the audio manager for this workspace.\r\n   *\r\n   * @returns The audio manager for this workspace.\r\n   */\r\n  getAudioManager(): WorkspaceAudio {\r\n    return this.audioManager;\r\n  }\r\n\r\n  /**\r\n   * Get the grid object for this workspace, or null if there is none.\r\n   *\r\n   * @returns The grid object for this workspace.\r\n   */\r\n  getGrid(): Grid | null {\r\n    return this.grid;\r\n  }\r\n\r\n  /**\r\n   * Close tooltips, context menus, dropdown selections, etc.\r\n   *\r\n   * @param onlyClosePopups Whether only popups should be closed. Defaults to\r\n   *     false.\r\n   */\r\n  hideChaff(onlyClosePopups = false) {\r\n    Tooltip.hide();\r\n    WidgetDiv.hide();\r\n    dropDownDiv.hideWithoutAnimation();\r\n\r\n    this.hideComponents(onlyClosePopups);\r\n  }\r\n\r\n  /**\r\n   * Hide any autohideable components (like flyout, trashcan, and any\r\n   * user-registered components).\r\n   *\r\n   * @param onlyClosePopups Whether only popups should be closed. Defaults to\r\n   *     false.\r\n   */\r\n  hideComponents(onlyClosePopups = false) {\r\n    const autoHideables = this.getComponentManager().getComponents(\r\n      ComponentManager.Capability.AUTOHIDEABLE,\r\n      true,\r\n    );\r\n    autoHideables.forEach((autoHideable) =>\r\n      autoHideable.autoHide(onlyClosePopups),\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Sets the X/Y translations of a top level workspace.\r\n   *\r\n   * @param xyRatio Contains an x and/or y property which is a float between 0\r\n   *     and 1 specifying the degree of scrolling.\r\n   */\r\n  private static setTopLevelWorkspaceMetrics_(\r\n    this: WorkspaceSvg,\r\n    xyRatio: {x?: number; y?: number},\r\n  ) {\r\n    const metrics = this.getMetrics();\r\n\r\n    if (typeof xyRatio.x === 'number') {\r\n      this.scrollX = -(\r\n        metrics.scrollLeft +\r\n        (metrics.scrollWidth - metrics.viewWidth) * xyRatio.x\r\n      );\r\n    }\r\n    if (typeof xyRatio.y === 'number') {\r\n      this.scrollY = -(\r\n        metrics.scrollTop +\r\n        (metrics.scrollHeight - metrics.viewHeight) * xyRatio.y\r\n      );\r\n    }\r\n    // We have to shift the translation so that when the canvas is at 0, 0 the\r\n    // workspace origin is not underneath the toolbox.\r\n    const x = this.scrollX + metrics.absoluteLeft;\r\n    const y = this.scrollY + metrics.absoluteTop;\r\n    // We could call scroll here, but that has extra checks we don't need to do.\r\n    this.translate(x, y);\r\n  }\r\n}\r\n\r\n/**\r\n * Size the workspace when the contents change.  This also updates\r\n * scrollbars accordingly.\r\n *\r\n * @param workspace The workspace to resize.\r\n * @internal\r\n */\r\nexport function resizeSvgContents(workspace: WorkspaceSvg) {\r\n  workspace.resizeContents();\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.ICopyable\r\n\r\nimport type {ISelectable} from './i_selectable.js';\r\n\r\nexport interface ICopyable<T extends ICopyData> extends ISelectable {\r\n  /**\r\n   * Encode for copying.\r\n   *\r\n   * @returns Copy metadata.\r\n   */\r\n  toCopyData(): T | null;\r\n}\r\n\r\nexport namespace ICopyable {\r\n  export interface ICopyData {\r\n    paster: string;\r\n  }\r\n}\r\n\r\nexport type ICopyData = ICopyable.ICopyData;\r\n\r\n/** @returns true if the given object is copyable. */\r\nexport function isCopyable(obj: any): obj is ICopyable<ICopyData> {\r\n  return obj.toCopyData !== undefined;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.ShortcutItems\r\n\r\nimport {BlockSvg} from './block_svg.js';\r\nimport * as clipboard from './clipboard.js';\r\nimport * as common from './common.js';\r\nimport {Gesture} from './gesture.js';\r\nimport {ICopyData, isCopyable} from './interfaces/i_copyable.js';\r\nimport {KeyboardShortcut, ShortcutRegistry} from './shortcut_registry.js';\r\nimport {KeyCodes} from './utils/keycodes.js';\r\nimport type {WorkspaceSvg} from './workspace_svg.js';\r\n\r\n/**\r\n * Object holding the names of the default shortcut items.\r\n */\r\nexport enum names {\r\n  ESCAPE = 'escape',\r\n  DELETE = 'delete',\r\n  COPY = 'copy',\r\n  CUT = 'cut',\r\n  PASTE = 'paste',\r\n  UNDO = 'undo',\r\n  REDO = 'redo',\r\n}\r\n\r\n/**\r\n * Keyboard shortcut to hide chaff on escape.\r\n */\r\nexport function registerEscape() {\r\n  const escapeAction: KeyboardShortcut = {\r\n    name: names.ESCAPE,\r\n    preconditionFn(workspace) {\r\n      return !workspace.options.readOnly;\r\n    },\r\n    callback(workspace) {\r\n      // AnyDuringMigration because:  Property 'hideChaff' does not exist on\r\n      // type 'Workspace'.\r\n      (workspace as AnyDuringMigration).hideChaff();\r\n      return true;\r\n    },\r\n    keyCodes: [KeyCodes.ESC],\r\n  };\r\n  ShortcutRegistry.registry.register(escapeAction);\r\n}\r\n\r\n/**\r\n * Keyboard shortcut to delete a block on delete or backspace\r\n */\r\nexport function registerDelete() {\r\n  const deleteShortcut: KeyboardShortcut = {\r\n    name: names.DELETE,\r\n    preconditionFn(workspace) {\r\n      const selected = common.getSelected();\r\n      return (\r\n        !workspace.options.readOnly &&\r\n        selected != null &&\r\n        selected.isDeletable()\r\n      );\r\n    },\r\n    callback(workspace, e) {\r\n      // Delete or backspace.\r\n      // Stop the browser from going back to the previous page.\r\n      // Do this first to prevent an error in the delete code from resulting in\r\n      // data loss.\r\n      e.preventDefault();\r\n      // Don't delete while dragging.  Jeez.\r\n      if (Gesture.inProgress()) {\r\n        return false;\r\n      }\r\n      (common.getSelected() as BlockSvg).checkAndDelete();\r\n      return true;\r\n    },\r\n    keyCodes: [KeyCodes.DELETE, KeyCodes.BACKSPACE],\r\n  };\r\n  ShortcutRegistry.registry.register(deleteShortcut);\r\n}\r\n\r\nlet copyData: ICopyData | null = null;\r\nlet copyWorkspace: WorkspaceSvg | null = null;\r\n\r\n/**\r\n * Keyboard shortcut to copy a block on ctrl+c, cmd+c, or alt+c.\r\n */\r\nexport function registerCopy() {\r\n  const ctrlC = ShortcutRegistry.registry.createSerializedKey(KeyCodes.C, [\r\n    KeyCodes.CTRL,\r\n  ]);\r\n  const altC = ShortcutRegistry.registry.createSerializedKey(KeyCodes.C, [\r\n    KeyCodes.ALT,\r\n  ]);\r\n  const metaC = ShortcutRegistry.registry.createSerializedKey(KeyCodes.C, [\r\n    KeyCodes.META,\r\n  ]);\r\n\r\n  const copyShortcut: KeyboardShortcut = {\r\n    name: names.COPY,\r\n    preconditionFn(workspace) {\r\n      const selected = common.getSelected();\r\n      return (\r\n        !workspace.options.readOnly &&\r\n        !Gesture.inProgress() &&\r\n        selected != null &&\r\n        selected.isDeletable() &&\r\n        selected.isMovable() &&\r\n        isCopyable(selected)\r\n      );\r\n    },\r\n    callback(workspace, e) {\r\n      // Prevent the default copy behavior, which may beep or otherwise indicate\r\n      // an error due to the lack of a selection.\r\n      e.preventDefault();\r\n      workspace.hideChaff();\r\n      const selected = common.getSelected();\r\n      if (!selected || !isCopyable(selected)) return false;\r\n      copyData = selected.toCopyData();\r\n      copyWorkspace = workspace;\r\n      return !!copyData;\r\n    },\r\n    keyCodes: [ctrlC, altC, metaC],\r\n  };\r\n  ShortcutRegistry.registry.register(copyShortcut);\r\n}\r\n\r\n/**\r\n * Keyboard shortcut to copy and delete a block on ctrl+x, cmd+x, or alt+x.\r\n */\r\nexport function registerCut() {\r\n  const ctrlX = ShortcutRegistry.registry.createSerializedKey(KeyCodes.X, [\r\n    KeyCodes.CTRL,\r\n  ]);\r\n  const altX = ShortcutRegistry.registry.createSerializedKey(KeyCodes.X, [\r\n    KeyCodes.ALT,\r\n  ]);\r\n  const metaX = ShortcutRegistry.registry.createSerializedKey(KeyCodes.X, [\r\n    KeyCodes.META,\r\n  ]);\r\n\r\n  const cutShortcut: KeyboardShortcut = {\r\n    name: names.CUT,\r\n    preconditionFn(workspace) {\r\n      const selected = common.getSelected();\r\n      return (\r\n        !workspace.options.readOnly &&\r\n        !Gesture.inProgress() &&\r\n        selected != null &&\r\n        selected instanceof BlockSvg &&\r\n        selected.isDeletable() &&\r\n        selected.isMovable() &&\r\n        !selected.workspace!.isFlyout\r\n      );\r\n    },\r\n    callback(workspace) {\r\n      const selected = common.getSelected();\r\n      if (!selected || !isCopyable(selected)) return false;\r\n      copyData = selected.toCopyData();\r\n      copyWorkspace = workspace;\r\n      (selected as BlockSvg).checkAndDelete();\r\n      return true;\r\n    },\r\n    keyCodes: [ctrlX, altX, metaX],\r\n  };\r\n\r\n  ShortcutRegistry.registry.register(cutShortcut);\r\n}\r\n\r\n/**\r\n * Keyboard shortcut to paste a block on ctrl+v, cmd+v, or alt+v.\r\n */\r\nexport function registerPaste() {\r\n  const ctrlV = ShortcutRegistry.registry.createSerializedKey(KeyCodes.V, [\r\n    KeyCodes.CTRL,\r\n  ]);\r\n  const altV = ShortcutRegistry.registry.createSerializedKey(KeyCodes.V, [\r\n    KeyCodes.ALT,\r\n  ]);\r\n  const metaV = ShortcutRegistry.registry.createSerializedKey(KeyCodes.V, [\r\n    KeyCodes.META,\r\n  ]);\r\n\r\n  const pasteShortcut: KeyboardShortcut = {\r\n    name: names.PASTE,\r\n    preconditionFn(workspace) {\r\n      return !workspace.options.readOnly && !Gesture.inProgress();\r\n    },\r\n    callback() {\r\n      if (!copyData || !copyWorkspace) return false;\r\n      return !!clipboard.paste(copyData, copyWorkspace);\r\n    },\r\n    keyCodes: [ctrlV, altV, metaV],\r\n  };\r\n\r\n  ShortcutRegistry.registry.register(pasteShortcut);\r\n}\r\n\r\n/**\r\n * Keyboard shortcut to undo the previous action on ctrl+z, cmd+z, or alt+z.\r\n */\r\nexport function registerUndo() {\r\n  const ctrlZ = ShortcutRegistry.registry.createSerializedKey(KeyCodes.Z, [\r\n    KeyCodes.CTRL,\r\n  ]);\r\n  const altZ = ShortcutRegistry.registry.createSerializedKey(KeyCodes.Z, [\r\n    KeyCodes.ALT,\r\n  ]);\r\n  const metaZ = ShortcutRegistry.registry.createSerializedKey(KeyCodes.Z, [\r\n    KeyCodes.META,\r\n  ]);\r\n\r\n  const undoShortcut: KeyboardShortcut = {\r\n    name: names.UNDO,\r\n    preconditionFn(workspace) {\r\n      return !workspace.options.readOnly && !Gesture.inProgress();\r\n    },\r\n    callback(workspace) {\r\n      // 'z' for undo 'Z' is for redo.\r\n      (workspace as WorkspaceSvg).hideChaff();\r\n      workspace.undo(false);\r\n      return true;\r\n    },\r\n    keyCodes: [ctrlZ, altZ, metaZ],\r\n  };\r\n  ShortcutRegistry.registry.register(undoShortcut);\r\n}\r\n\r\n/**\r\n * Keyboard shortcut to redo the previous action on ctrl+shift+z, cmd+shift+z,\r\n * or alt+shift+z.\r\n */\r\nexport function registerRedo() {\r\n  const ctrlShiftZ = ShortcutRegistry.registry.createSerializedKey(KeyCodes.Z, [\r\n    KeyCodes.SHIFT,\r\n    KeyCodes.CTRL,\r\n  ]);\r\n  const altShiftZ = ShortcutRegistry.registry.createSerializedKey(KeyCodes.Z, [\r\n    KeyCodes.SHIFT,\r\n    KeyCodes.ALT,\r\n  ]);\r\n  const metaShiftZ = ShortcutRegistry.registry.createSerializedKey(KeyCodes.Z, [\r\n    KeyCodes.SHIFT,\r\n    KeyCodes.META,\r\n  ]);\r\n  // Ctrl-y is redo in Windows.  Command-y is never valid on Macs.\r\n  const ctrlY = ShortcutRegistry.registry.createSerializedKey(KeyCodes.Y, [\r\n    KeyCodes.CTRL,\r\n  ]);\r\n\r\n  const redoShortcut: KeyboardShortcut = {\r\n    name: names.REDO,\r\n    preconditionFn(workspace) {\r\n      return !Gesture.inProgress() && !workspace.options.readOnly;\r\n    },\r\n    callback(workspace) {\r\n      // 'z' for undo 'Z' is for redo.\r\n      (workspace as WorkspaceSvg).hideChaff();\r\n      workspace.undo(true);\r\n      return true;\r\n    },\r\n    keyCodes: [ctrlShiftZ, altShiftZ, metaShiftZ, ctrlY],\r\n  };\r\n  ShortcutRegistry.registry.register(redoShortcut);\r\n}\r\n\r\n/**\r\n * Registers all default keyboard shortcut item. This should be called once per\r\n * instance of KeyboardShortcutRegistry.\r\n *\r\n * @internal\r\n */\r\nexport function registerDefaultShortcuts() {\r\n  registerEscape();\r\n  registerDelete();\r\n  registerCopy();\r\n  registerCut();\r\n  registerPaste();\r\n  registerUndo();\r\n  registerRedo();\r\n}\r\n\r\nregisterDefaultShortcuts();\r\n","/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport {IParameterModel} from '../interfaces/i_parameter_model.js';\r\nimport {IProcedureModel} from '../interfaces/i_procedure_model.js';\r\nimport type {ISerializer} from '../interfaces/i_serializer.js';\r\nimport * as priorities from './priorities.js';\r\nimport type {Workspace} from '../workspace.js';\r\n\r\n/**\r\n * Representation of a procedure data model.\r\n */\r\nexport interface State {\r\n  // TODO: This should also handle enabled.\r\n  id: string;\r\n  name: string;\r\n  returnTypes: string[] | null;\r\n  parameters?: ParameterState[];\r\n}\r\n\r\n/**\r\n * Representation of a parameter data model.\r\n */\r\nexport interface ParameterState {\r\n  id: string;\r\n  name: string;\r\n  types?: string[];\r\n}\r\n\r\n/**\r\n * A newable signature for an IProcedureModel.\r\n *\r\n * Refer to\r\n * https://www.typescriptlang.org/docs/handbook/2/generics.html#using-class-types-in-generics\r\n * for what is going on with this.\r\n */\r\ntype ProcedureModelConstructor<ProcedureModel extends IProcedureModel> = new (\r\n  workspace: Workspace,\r\n  name: string,\r\n  id: string,\r\n) => ProcedureModel;\r\n\r\n/**\r\n * A newable signature for an IParameterModel.\r\n *\r\n * Refer to\r\n * https://www.typescriptlang.org/docs/handbook/2/generics.html#using-class-types-in-generics\r\n * for what is going on with this.\r\n */\r\ntype ParameterModelConstructor<ParameterModel extends IParameterModel> = new (\r\n  workspace: Workspace,\r\n  name: string,\r\n  id: string,\r\n) => ParameterModel;\r\n\r\n/**\r\n * Serializes the given IProcedureModel to JSON.\r\n *\r\n * @internal\r\n */\r\nexport function saveProcedure(proc: IProcedureModel): State {\r\n  const state: State = {\r\n    id: proc.getId(),\r\n    name: proc.getName(),\r\n    returnTypes: proc.getReturnTypes(),\r\n  };\r\n  if (!proc.getParameters().length) return state;\r\n  state.parameters = proc.getParameters().map((param) => saveParameter(param));\r\n  return state;\r\n}\r\n\r\n/**\r\n * Serializes the given IParameterModel to JSON.\r\n *\r\n * @internal\r\n */\r\nexport function saveParameter(param: IParameterModel): ParameterState {\r\n  const state: ParameterState = {\r\n    id: param.getId(),\r\n    name: param.getName(),\r\n  };\r\n  if (!param.getTypes().length) return state;\r\n  state.types = param.getTypes();\r\n  return state;\r\n}\r\n\r\n/**\r\n * Deserializes the given procedure model State from JSON.\r\n *\r\n * @internal\r\n */\r\nexport function loadProcedure<\r\n  ProcedureModel extends IProcedureModel,\r\n  ParameterModel extends IParameterModel,\r\n>(\r\n  procedureModelClass: ProcedureModelConstructor<ProcedureModel>,\r\n  parameterModelClass: ParameterModelConstructor<ParameterModel>,\r\n  state: State,\r\n  workspace: Workspace,\r\n): ProcedureModel {\r\n  const proc = new procedureModelClass(\r\n    workspace,\r\n    state.name,\r\n    state.id,\r\n  ).setReturnTypes(state.returnTypes);\r\n  if (!state.parameters) return proc;\r\n  for (const [index, param] of state.parameters.entries()) {\r\n    proc.insertParameter(\r\n      loadParameter(parameterModelClass, param, workspace),\r\n      index,\r\n    );\r\n  }\r\n  return proc;\r\n}\r\n\r\n/**\r\n * Deserializes the given ParameterState from JSON.\r\n *\r\n * @internal\r\n */\r\nexport function loadParameter<ParameterModel extends IParameterModel>(\r\n  parameterModelClass: ParameterModelConstructor<ParameterModel>,\r\n  state: ParameterState,\r\n  workspace: Workspace,\r\n): ParameterModel {\r\n  const model = new parameterModelClass(workspace, state.name, state.id);\r\n  if (state.types) model.setTypes(state.types);\r\n  return model;\r\n}\r\n\r\n/** Serializer for saving and loading procedure state. */\r\nexport class ProcedureSerializer<\r\n  ProcedureModel extends IProcedureModel,\r\n  ParameterModel extends IParameterModel,\r\n> implements ISerializer\r\n{\r\n  public priority = priorities.PROCEDURES;\r\n\r\n  /**\r\n   * Constructs the procedure serializer.\r\n   *\r\n   * Example usage:\r\n   *   new ProcedureSerializer(MyProcedureModelClass, MyParameterModelClass)\r\n   *\r\n   * @param procedureModelClass The class (implementing IProcedureModel) that\r\n   *     you want this serializer to deserialize.\r\n   * @param parameterModelClass The class (implementing IParameterModel) that\r\n   *     you want this serializer to deserialize.\r\n   */\r\n  constructor(\r\n    private readonly procedureModelClass: ProcedureModelConstructor<ProcedureModel>,\r\n    private readonly parameterModelClass: ParameterModelConstructor<ParameterModel>,\r\n  ) {}\r\n\r\n  /** Serializes the procedure models of the given workspace. */\r\n  save(workspace: Workspace): State[] | null {\r\n    const save = workspace\r\n      .getProcedureMap()\r\n      .getProcedures()\r\n      .map((proc) => saveProcedure(proc));\r\n    return save.length ? save : null;\r\n  }\r\n\r\n  /**\r\n   * Deserializes the procedures models defined by the given state into the\r\n   * workspace.\r\n   */\r\n  load(state: State[], workspace: Workspace) {\r\n    const map = workspace.getProcedureMap();\r\n    for (const procState of state) {\r\n      map.add(\r\n        loadProcedure(\r\n          this.procedureModelClass,\r\n          this.parameterModelClass,\r\n          procState,\r\n          workspace,\r\n        ),\r\n      );\r\n    }\r\n  }\r\n\r\n  /** Disposes of any procedure models that exist on the workspace. */\r\n  clear(workspace: Workspace) {\r\n    workspace.getProcedureMap().clear();\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.serialization.workspaces\r\n\r\nimport * as eventUtils from '../events/utils.js';\r\nimport type {ISerializer} from '../interfaces/i_serializer.js';\r\nimport * as registry from '../registry.js';\r\nimport * as dom from '../utils/dom.js';\r\n// eslint-disable-next-line no-unused-vars\r\nimport type {Workspace} from '../workspace.js';\r\nimport {WorkspaceSvg} from '../workspace_svg.js';\r\n\r\n/**\r\n * Returns the state of the workspace as a plain JavaScript object.\r\n *\r\n * @param workspace The workspace to serialize.\r\n * @returns The serialized state of the workspace.\r\n */\r\nexport function save(workspace: Workspace): {\r\n  [key: string]: AnyDuringMigration;\r\n} {\r\n  const state = Object.create(null);\r\n  const serializerMap = registry.getAllItems(registry.Type.SERIALIZER, true);\r\n  for (const key in serializerMap) {\r\n    const save = (serializerMap[key] as ISerializer)?.save(workspace);\r\n    if (save) {\r\n      state[key] = save;\r\n    }\r\n  }\r\n  return state;\r\n}\r\n\r\n/**\r\n * Loads the variable represented by the given state into the given workspace.\r\n *\r\n * @param state The state of the workspace to deserialize into the workspace.\r\n * @param workspace The workspace to add the new state to.\r\n * @param param1 recordUndo: If true, events triggered by this function will be\r\n *     undo-able by the user. False by default.\r\n */\r\nexport function load(\r\n  state: {[key: string]: AnyDuringMigration},\r\n  workspace: Workspace,\r\n  {recordUndo = false}: {recordUndo?: boolean} = {},\r\n) {\r\n  const serializerMap = registry.getAllItems(registry.Type.SERIALIZER, true);\r\n  if (!serializerMap) {\r\n    return;\r\n  }\r\n\r\n  const deserializers = Object.entries(serializerMap).sort(\r\n    (a, b) => (b[1] as ISerializer)!.priority - (a[1] as ISerializer)!.priority,\r\n  );\r\n\r\n  const prevRecordUndo = eventUtils.getRecordUndo();\r\n  eventUtils.setRecordUndo(recordUndo);\r\n  const existingGroup = eventUtils.getGroup();\r\n  if (!existingGroup) {\r\n    eventUtils.setGroup(true);\r\n  }\r\n\r\n  dom.startTextWidthCache();\r\n  if (workspace instanceof WorkspaceSvg) {\r\n    workspace.setResizesEnabled(false);\r\n  }\r\n\r\n  // We want to trigger clearing in reverse priority order so plugins don't end\r\n  // up missing dependencies.\r\n  for (const [, deserializer] of deserializers.reverse()) {\r\n    (deserializer as ISerializer)?.clear(workspace);\r\n  }\r\n\r\n  // reverse() is destructive, so we have to re-reverse to correct the order.\r\n  for (let [name, deserializer] of deserializers.reverse()) {\r\n    name = name;\r\n    const pluginState = state[name];\r\n    if (pluginState) {\r\n      (deserializer as ISerializer)?.load(state[name], workspace);\r\n    }\r\n  }\r\n\r\n  if (workspace instanceof WorkspaceSvg) {\r\n    workspace.setResizesEnabled(true);\r\n  }\r\n  dom.stopTextWidthCache();\r\n\r\n  eventUtils.fire(new (eventUtils.get(eventUtils.FINISHED_LOADING))(workspace));\r\n\r\n  eventUtils.setGroup(existingGroup);\r\n  eventUtils.setRecordUndo(prevRecordUndo);\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.bumpObjects\r\n\r\nimport type {BlockSvg} from './block_svg.js';\r\nimport type {Abstract} from './events/events_abstract.js';\r\nimport type {BlockCreate} from './events/events_block_create.js';\r\nimport type {BlockMove} from './events/events_block_move.js';\r\nimport type {CommentCreate} from './events/events_comment_create.js';\r\nimport type {CommentMove} from './events/events_comment_move.js';\r\nimport type {ViewportChange} from './events/events_viewport.js';\r\nimport * as eventUtils from './events/utils.js';\r\nimport type {IBoundedElement} from './interfaces/i_bounded_element.js';\r\nimport type {ContainerRegion} from './metrics_manager.js';\r\nimport * as mathUtils from './utils/math.js';\r\nimport type {WorkspaceCommentSvg} from './workspace_comment_svg.js';\r\nimport type {WorkspaceSvg} from './workspace_svg.js';\r\n\r\n/**\r\n * Bumps the given object that has passed out of bounds.\r\n *\r\n * @param workspace The workspace containing the object.\r\n * @param bounds The region to bump an object into. For example, pass\r\n *     ScrollMetrics to bump a block into the scrollable region of the\r\n *     workspace, or pass ViewMetrics to bump a block into the visible region of\r\n *     the workspace. This should be specified in workspace coordinates.\r\n * @param object The object to bump.\r\n * @returns True if object was bumped.\r\n */\r\nfunction bumpObjectIntoBounds(\r\n  workspace: WorkspaceSvg,\r\n  bounds: ContainerRegion,\r\n  object: IBoundedElement,\r\n): boolean {\r\n  // Compute new top/left position for object.\r\n  const objectMetrics = object.getBoundingRectangle();\r\n  const height = objectMetrics.bottom - objectMetrics.top;\r\n  const width = objectMetrics.right - objectMetrics.left;\r\n\r\n  const topClamp = bounds.top;\r\n  const boundsBottom = bounds.top + bounds.height;\r\n  const bottomClamp = boundsBottom - height;\r\n  // If the object is taller than the workspace we want to\r\n  // top-align the block\r\n  const newYPosition = mathUtils.clamp(\r\n    topClamp,\r\n    objectMetrics.top,\r\n    bottomClamp,\r\n  );\r\n  const deltaY = newYPosition - objectMetrics.top;\r\n\r\n  // Note: Even in RTL mode the \"anchor\" of the object is the\r\n  // top-left corner of the object.\r\n  let leftClamp = bounds.left;\r\n  const boundsRight = bounds.left + bounds.width;\r\n  let rightClamp = boundsRight - width;\r\n  if (workspace.RTL) {\r\n    // If the object is wider than the workspace and we're in RTL\r\n    // mode we want to right-align the block, which means setting\r\n    // the left clamp to match.\r\n    leftClamp = Math.min(rightClamp, leftClamp);\r\n  } else {\r\n    // If the object is wider than the workspace and we're in LTR\r\n    // mode we want to left-align the block, which means setting\r\n    // the right clamp to match.\r\n    rightClamp = Math.max(leftClamp, rightClamp);\r\n  }\r\n  const newXPosition = mathUtils.clamp(\r\n    leftClamp,\r\n    objectMetrics.left,\r\n    rightClamp,\r\n  );\r\n  const deltaX = newXPosition - objectMetrics.left;\r\n\r\n  if (deltaX || deltaY) {\r\n    object.moveBy(deltaX, deltaY, ['inbounds']);\r\n    return true;\r\n  }\r\n  return false;\r\n}\r\nexport const bumpIntoBounds = bumpObjectIntoBounds;\r\n\r\n/**\r\n * Creates a handler for bumping objects when they cross fixed bounds.\r\n *\r\n * @param workspace The workspace to handle.\r\n * @returns The event handler.\r\n */\r\nexport function bumpIntoBoundsHandler(\r\n  workspace: WorkspaceSvg,\r\n): (p1: Abstract) => void {\r\n  return (e) => {\r\n    const metricsManager = workspace.getMetricsManager();\r\n    if (!metricsManager.hasFixedEdges() || workspace.isDragging()) {\r\n      return;\r\n    }\r\n\r\n    if (eventUtils.BUMP_EVENTS.indexOf(e.type ?? '') !== -1) {\r\n      const scrollMetricsInWsCoords = metricsManager.getScrollMetrics(true);\r\n\r\n      // Triggered by move/create event\r\n      const object = extractObjectFromEvent(\r\n        workspace,\r\n        e as eventUtils.BumpEvent,\r\n      );\r\n      if (!object) {\r\n        return;\r\n      }\r\n      // Handle undo.\r\n      const existingGroup = eventUtils.getGroup() || false;\r\n      eventUtils.setGroup(e.group);\r\n\r\n      const wasBumped = bumpObjectIntoBounds(\r\n        workspace,\r\n        scrollMetricsInWsCoords,\r\n        object as IBoundedElement,\r\n      );\r\n\r\n      if (wasBumped && !e.group) {\r\n        console.warn(\r\n          'Moved object in bounds but there was no' +\r\n            ' event group. This may break undo.',\r\n        );\r\n      }\r\n      eventUtils.setGroup(existingGroup);\r\n    } else if (e.type === eventUtils.VIEWPORT_CHANGE) {\r\n      const viewportEvent = e as ViewportChange;\r\n      if (\r\n        viewportEvent.scale &&\r\n        viewportEvent.oldScale &&\r\n        viewportEvent.scale > viewportEvent.oldScale\r\n      ) {\r\n        bumpTopObjectsIntoBounds(workspace);\r\n      }\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * Extracts the object from the given event.\r\n *\r\n * @param workspace The workspace the event originated\r\n *    from.\r\n * @param e An event containing an object.\r\n * @returns The extracted\r\n *    object.\r\n */\r\nfunction extractObjectFromEvent(\r\n  workspace: WorkspaceSvg,\r\n  e: eventUtils.BumpEvent,\r\n): BlockSvg | null | WorkspaceCommentSvg {\r\n  let object = null;\r\n  switch (e.type) {\r\n    case eventUtils.BLOCK_CREATE:\r\n    case eventUtils.BLOCK_MOVE:\r\n      object = workspace.getBlockById((e as BlockCreate | BlockMove).blockId!);\r\n      if (object) {\r\n        object = object.getRootBlock();\r\n      }\r\n      break;\r\n    case eventUtils.COMMENT_CREATE:\r\n    case eventUtils.COMMENT_MOVE:\r\n      object = workspace.getCommentById(\r\n        (e as CommentCreate | CommentMove).commentId!,\r\n      ) as WorkspaceCommentSvg | null;\r\n      break;\r\n  }\r\n  return object;\r\n}\r\n\r\n/**\r\n * Bumps the top objects in the given workspace into bounds.\r\n *\r\n * @param workspace The workspace.\r\n */\r\nexport function bumpTopObjectsIntoBounds(workspace: WorkspaceSvg) {\r\n  const metricsManager = workspace.getMetricsManager();\r\n  if (!metricsManager.hasFixedEdges() || workspace.isDragging()) {\r\n    return;\r\n  }\r\n\r\n  const scrollMetricsInWsCoords = metricsManager.getScrollMetrics(true);\r\n  const topBlocks = workspace.getTopBoundedElements();\r\n  for (let i = 0, block; (block = topBlocks[i]); i++) {\r\n    bumpObjectIntoBounds(workspace, scrollMetricsInWsCoords, block);\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Methods for dragging a block visually.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.BlockDragger\r\n\r\n// Unused import preserved for side-effects. Remove if unneeded.\r\nimport './events/events_block_drag.js';\r\n\r\nimport * as blockAnimation from './block_animations.js';\r\nimport type {BlockSvg} from './block_svg.js';\r\nimport * as bumpObjects from './bump_objects.js';\r\nimport * as common from './common.js';\r\nimport type {BlockMove} from './events/events_block_move.js';\r\nimport * as eventUtils from './events/utils.js';\r\nimport type {Icon} from './icons/icon.js';\r\nimport type {IBlockDragger} from './interfaces/i_block_dragger.js';\r\nimport type {IDragTarget} from './interfaces/i_drag_target.js';\r\nimport * as registry from './registry.js';\r\nimport {Coordinate} from './utils/coordinate.js';\r\nimport * as dom from './utils/dom.js';\r\nimport type {WorkspaceSvg} from './workspace_svg.js';\r\nimport {hasBubble} from './interfaces/i_has_bubble.js';\r\nimport * as deprecation from './utils/deprecation.js';\r\nimport * as layers from './layers.js';\r\nimport {ConnectionType, IConnectionPreviewer} from './blockly.js';\r\nimport {RenderedConnection} from './rendered_connection.js';\r\nimport {config} from './config.js';\r\nimport {ComponentManager} from './component_manager.js';\r\nimport {IDeleteArea} from './interfaces/i_delete_area.js';\r\nimport {Connection} from './connection.js';\r\nimport {Block} from './block.js';\r\nimport {finishQueuedRenders} from './render_management.js';\r\n\r\n/** Represents a nearby valid connection. */\r\ninterface ConnectionCandidate {\r\n  /** A connection on the dragging stack that is compatible with neighbour. */\r\n  local: RenderedConnection;\r\n\r\n  /** A nearby connection that is compatible with local. */\r\n  neighbour: RenderedConnection;\r\n\r\n  /** The distance between the local connection and the neighbour connection. */\r\n  distance: number;\r\n}\r\n\r\n/**\r\n * Class for a block dragger.  It moves blocks around the workspace when they\r\n * are being dragged by a mouse or touch.\r\n */\r\nexport class BlockDragger implements IBlockDragger {\r\n  /** The top block in the stack that is being dragged. */\r\n  protected draggingBlock_: BlockSvg;\r\n\r\n  protected connectionPreviewer: IConnectionPreviewer;\r\n\r\n  /** The workspace on which the block is being dragged. */\r\n  protected workspace_: WorkspaceSvg;\r\n\r\n  /** Which drag area the mouse pointer is over, if any. */\r\n  private dragTarget_: IDragTarget | null = null;\r\n\r\n  private connectionCandidate: ConnectionCandidate | null = null;\r\n\r\n  /** Whether the block would be deleted if dropped immediately. */\r\n  protected wouldDeleteBlock_ = false;\r\n  protected startXY_: Coordinate;\r\n\r\n  /**\r\n   * @deprecated To be removed in v11. Updating icons is now handled by the\r\n   *     block's `moveDuringDrag` method.\r\n   */\r\n  protected dragIconData_: IconPositionData[] = [];\r\n\r\n  /**\r\n   * @param block The block to drag.\r\n   * @param workspace The workspace to drag on.\r\n   */\r\n  constructor(block: BlockSvg, workspace: WorkspaceSvg) {\r\n    this.draggingBlock_ = block;\r\n    this.workspace_ = workspace;\r\n\r\n    const previewerConstructor = registry.getClassFromOptions(\r\n      registry.Type.CONNECTION_PREVIEWER,\r\n      this.workspace_.options,\r\n    );\r\n    this.connectionPreviewer = new previewerConstructor!(block);\r\n\r\n    /**\r\n     * The location of the top left corner of the dragging block at the\r\n     * beginning of the drag in workspace coordinates.\r\n     */\r\n    this.startXY_ = this.draggingBlock_.getRelativeToSurfaceXY();\r\n\r\n    this.dragIconData_ = initIconData(block, this.startXY_);\r\n  }\r\n\r\n  /**\r\n   * Sever all links from this object.\r\n   *\r\n   * @internal\r\n   */\r\n  dispose() {\r\n    this.dragIconData_.length = 0;\r\n    this.connectionPreviewer.dispose();\r\n  }\r\n\r\n  /**\r\n   * Start dragging a block.\r\n   *\r\n   * @param currentDragDeltaXY How far the pointer has moved from the position\r\n   *     at mouse down, in pixel units.\r\n   * @param healStack Whether or not to heal the stack after disconnecting.\r\n   */\r\n  startDrag(currentDragDeltaXY: Coordinate, healStack: boolean) {\r\n    if (!eventUtils.getGroup()) {\r\n      eventUtils.setGroup(true);\r\n    }\r\n    this.fireDragStartEvent_();\r\n\r\n    // The z-order of blocks depends on their order in the SVG, so move the\r\n    // block being dragged to the front so that it will appear atop other blocks\r\n    // in the workspace.\r\n    this.draggingBlock_.bringToFront(true);\r\n\r\n    // During a drag there may be a lot of rerenders, but not field changes.\r\n    // Turn the cache on so we don't do spurious remeasures during the drag.\r\n    dom.startTextWidthCache();\r\n    this.workspace_.setResizesEnabled(false);\r\n    blockAnimation.disconnectUiStop();\r\n\r\n    if (this.shouldDisconnect_(healStack)) {\r\n      this.disconnectBlock_(healStack, currentDragDeltaXY);\r\n    }\r\n    this.draggingBlock_.setDragging(true);\r\n    this.workspace_.getLayerManager()?.moveToDragLayer(this.draggingBlock_);\r\n  }\r\n\r\n  /**\r\n   * Whether or not we should disconnect the block when a drag is started.\r\n   *\r\n   * @param healStack Whether or not to heal the stack after disconnecting.\r\n   * @returns True to disconnect the block, false otherwise.\r\n   */\r\n  protected shouldDisconnect_(healStack: boolean): boolean {\r\n    return !!(\r\n      this.draggingBlock_.getParent() ||\r\n      (healStack &&\r\n        this.draggingBlock_.nextConnection &&\r\n        this.draggingBlock_.nextConnection.targetBlock())\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Disconnects the block and moves it to a new location.\r\n   *\r\n   * @param healStack Whether or not to heal the stack after disconnecting.\r\n   * @param currentDragDeltaXY How far the pointer has moved from the position\r\n   *     at mouse down, in pixel units.\r\n   */\r\n  protected disconnectBlock_(\r\n    healStack: boolean,\r\n    currentDragDeltaXY: Coordinate,\r\n  ) {\r\n    this.draggingBlock_.unplug(healStack);\r\n    const delta = this.pixelsToWorkspaceUnits_(currentDragDeltaXY);\r\n    const newLoc = Coordinate.sum(this.startXY_, delta);\r\n\r\n    this.draggingBlock_.translate(newLoc.x, newLoc.y);\r\n    blockAnimation.disconnectUiEffect(this.draggingBlock_);\r\n  }\r\n\r\n  /** Fire a UI event at the start of a block drag. */\r\n  protected fireDragStartEvent_() {\r\n    const event = new (eventUtils.get(eventUtils.BLOCK_DRAG))(\r\n      this.draggingBlock_,\r\n      true,\r\n      this.draggingBlock_.getDescendants(false),\r\n    );\r\n    eventUtils.fire(event);\r\n  }\r\n\r\n  /**\r\n   * Execute a step of block dragging, based on the given event.  Update the\r\n   * display accordingly.\r\n   *\r\n   * @param e The most recent move event.\r\n   * @param delta How far the pointer has moved from the position\r\n   *     at the start of the drag, in pixel units.\r\n   */\r\n  drag(e: PointerEvent, delta: Coordinate) {\r\n    const block = this.draggingBlock_;\r\n    this.moveBlock(block, delta);\r\n    this.updateDragTargets(e, block);\r\n    this.wouldDeleteBlock_ = this.wouldDeleteBlock(e, block, delta);\r\n    this.updateCursorDuringBlockDrag_();\r\n    this.updateConnectionPreview(block, delta);\r\n  }\r\n\r\n  /**\r\n   * @param draggingBlock The block being dragged.\r\n   * @param dragDelta How far the pointer has moved from the position\r\n   *     at the start of the drag, in pixel units.\r\n   */\r\n  private moveBlock(draggingBlock: BlockSvg, dragDelta: Coordinate) {\r\n    const delta = this.pixelsToWorkspaceUnits_(dragDelta);\r\n    const newLoc = Coordinate.sum(this.startXY_, delta);\r\n    draggingBlock.moveDuringDrag(newLoc);\r\n  }\r\n\r\n  private updateDragTargets(e: PointerEvent, draggingBlock: BlockSvg) {\r\n    const newDragTarget = this.workspace_.getDragTarget(e);\r\n    if (this.dragTarget_ !== newDragTarget) {\r\n      this.dragTarget_?.onDragExit(draggingBlock);\r\n      newDragTarget?.onDragEnter(draggingBlock);\r\n    }\r\n    newDragTarget?.onDragOver(draggingBlock);\r\n    this.dragTarget_ = newDragTarget;\r\n  }\r\n\r\n  /**\r\n   * Returns true if we would delete the block if it was dropped at this time,\r\n   * false otherwise.\r\n   *\r\n   * @param e The most recent move event.\r\n   * @param draggingBlock The block being dragged.\r\n   * @param delta How far the pointer has moved from the position\r\n   *     at the start of the drag, in pixel units.\r\n   */\r\n  private wouldDeleteBlock(\r\n    e: PointerEvent,\r\n    draggingBlock: BlockSvg,\r\n    delta: Coordinate,\r\n  ): boolean {\r\n    const dragTarget = this.workspace_.getDragTarget(e);\r\n    if (!dragTarget) return false;\r\n\r\n    const componentManager = this.workspace_.getComponentManager();\r\n    const isDeleteArea = componentManager.hasCapability(\r\n      dragTarget.id,\r\n      ComponentManager.Capability.DELETE_AREA,\r\n    );\r\n    if (!isDeleteArea) return false;\r\n\r\n    return (dragTarget as IDeleteArea).wouldDelete(\r\n      draggingBlock,\r\n      !!this.getConnectionCandidate(draggingBlock, delta),\r\n    );\r\n  }\r\n\r\n  /**\r\n   * @param draggingBlock The block being dragged.\r\n   * @param dragDelta How far the pointer has moved from the position\r\n   *     at the start of the drag, in pixel units.\r\n   */\r\n  private updateConnectionPreview(\r\n    draggingBlock: BlockSvg,\r\n    dragDelta: Coordinate,\r\n  ) {\r\n    const delta = this.pixelsToWorkspaceUnits_(dragDelta);\r\n    const currCandidate = this.connectionCandidate;\r\n    const newCandidate = this.getConnectionCandidate(draggingBlock, delta);\r\n    if (!newCandidate) {\r\n      this.connectionPreviewer.hidePreview();\r\n      this.connectionCandidate = null;\r\n      return;\r\n    }\r\n    const candidate =\r\n      currCandidate &&\r\n      this.currCandidateIsBetter(currCandidate, delta, newCandidate)\r\n        ? currCandidate\r\n        : newCandidate;\r\n    this.connectionCandidate = candidate;\r\n    const {local, neighbour} = candidate;\r\n    if (\r\n      (local.type === ConnectionType.OUTPUT_VALUE ||\r\n        local.type === ConnectionType.PREVIOUS_STATEMENT) &&\r\n      neighbour.isConnected() &&\r\n      !neighbour.targetBlock()!.isInsertionMarker() &&\r\n      !this.orphanCanConnectAtEnd(\r\n        draggingBlock,\r\n        neighbour.targetBlock()!,\r\n        local.type,\r\n      )\r\n    ) {\r\n      this.connectionPreviewer.previewReplacement(\r\n        local,\r\n        neighbour,\r\n        neighbour.targetBlock()!,\r\n      );\r\n      return;\r\n    }\r\n    this.connectionPreviewer.previewConnection(local, neighbour);\r\n  }\r\n\r\n  /**\r\n   * Returns true if the given orphan block can connect at the end of the\r\n   * top block's stack or row, false otherwise.\r\n   */\r\n  private orphanCanConnectAtEnd(\r\n    topBlock: BlockSvg,\r\n    orphanBlock: BlockSvg,\r\n    localType: number,\r\n  ): boolean {\r\n    const orphanConnection =\r\n      localType === ConnectionType.OUTPUT_VALUE\r\n        ? orphanBlock.outputConnection\r\n        : orphanBlock.previousConnection;\r\n    return !!Connection.getConnectionForOrphanedConnection(\r\n      topBlock as Block,\r\n      orphanConnection as Connection,\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Returns true if the current candidate is better than the new candidate.\r\n   *\r\n   * We slightly prefer the current candidate even if it is farther away.\r\n   */\r\n  private currCandidateIsBetter(\r\n    currCandiate: ConnectionCandidate,\r\n    delta: Coordinate,\r\n    newCandidate: ConnectionCandidate,\r\n  ): boolean {\r\n    const {local: currLocal, neighbour: currNeighbour} = currCandiate;\r\n    const localPos = new Coordinate(currLocal.x, currLocal.y);\r\n    const neighbourPos = new Coordinate(currNeighbour.x, currNeighbour.y);\r\n    const distance = Coordinate.distance(\r\n      Coordinate.sum(localPos, delta),\r\n      neighbourPos,\r\n    );\r\n    return (\r\n      newCandidate.distance > distance - config.currentConnectionPreference\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Returns the closest valid candidate connection, if one can be found.\r\n   *\r\n   * Valid neighbour connections are within the configured start radius, with a\r\n   * compatible type (input, output, etc) and connection check.\r\n   */\r\n  private getConnectionCandidate(\r\n    draggingBlock: BlockSvg,\r\n    delta: Coordinate,\r\n  ): ConnectionCandidate | null {\r\n    const localConns = this.getLocalConnections(draggingBlock);\r\n    let radius = this.connectionCandidate\r\n      ? config.connectingSnapRadius\r\n      : config.snapRadius;\r\n    let candidate = null;\r\n\r\n    for (const conn of localConns) {\r\n      const {connection: neighbour, radius: rad} = conn.closest(radius, delta);\r\n      if (neighbour) {\r\n        candidate = {\r\n          local: conn,\r\n          neighbour: neighbour,\r\n          distance: rad,\r\n        };\r\n        radius = rad;\r\n      }\r\n    }\r\n\r\n    return candidate;\r\n  }\r\n\r\n  /**\r\n   * Returns all of the connections we might connect to blocks on the workspace.\r\n   *\r\n   * Includes any connections on the dragging block, and any last next\r\n   * connection on the stack (if one exists).\r\n   */\r\n  private getLocalConnections(draggingBlock: BlockSvg): RenderedConnection[] {\r\n    const available = draggingBlock.getConnections_(false);\r\n    const lastOnStack = draggingBlock.lastConnectionInStack(true);\r\n    if (lastOnStack && lastOnStack !== draggingBlock.nextConnection) {\r\n      available.push(lastOnStack);\r\n    }\r\n    return available;\r\n  }\r\n\r\n  /**\r\n   * Finish a block drag and put the block back on the workspace.\r\n   *\r\n   * @param e The pointerup event.\r\n   * @param currentDragDeltaXY How far the pointer has moved from the position\r\n   *     at the start of the drag, in pixel units.\r\n   */\r\n  endDrag(e: PointerEvent, currentDragDeltaXY: Coordinate) {\r\n    // Make sure internal state is fresh.\r\n    this.drag(e, currentDragDeltaXY);\r\n    this.fireDragEndEvent_();\r\n\r\n    dom.stopTextWidthCache();\r\n\r\n    blockAnimation.disconnectUiStop();\r\n    this.connectionPreviewer.hidePreview();\r\n\r\n    const preventMove =\r\n      !!this.dragTarget_ &&\r\n      this.dragTarget_.shouldPreventMove(this.draggingBlock_);\r\n    let delta: Coordinate | null = null;\r\n    if (!preventMove) {\r\n      const newValues = this.getNewLocationAfterDrag_(currentDragDeltaXY);\r\n      delta = newValues.delta;\r\n    }\r\n\r\n    if (this.dragTarget_) {\r\n      this.dragTarget_.onDrop(this.draggingBlock_);\r\n    }\r\n\r\n    const deleted = this.maybeDeleteBlock_();\r\n    if (!deleted) {\r\n      // These are expensive and don't need to be done if we're deleting.\r\n      this.workspace_\r\n        .getLayerManager()\r\n        ?.moveOffDragLayer(this.draggingBlock_, layers.BLOCK);\r\n      this.draggingBlock_.setDragging(false);\r\n      if (delta) {\r\n        // !preventMove\r\n        this.updateBlockAfterMove_();\r\n      } else {\r\n        // Blocks dragged directly from a flyout may need to be bumped into\r\n        // bounds.\r\n        bumpObjects.bumpIntoBounds(\r\n          this.draggingBlock_.workspace,\r\n          this.workspace_.getMetricsManager().getScrollMetrics(true),\r\n          this.draggingBlock_,\r\n        );\r\n      }\r\n    }\r\n    // Must dispose after `updateBlockAfterMove_` is called to not break the\r\n    // dynamic connections plugin.\r\n    this.connectionPreviewer.dispose();\r\n    this.workspace_.setResizesEnabled(true);\r\n\r\n    eventUtils.setGroup(false);\r\n  }\r\n\r\n  /**\r\n   * Calculates the drag delta and new location values after a block is dragged.\r\n   *\r\n   * @param currentDragDeltaXY How far the pointer has moved from the start of\r\n   *     the drag, in pixel units.\r\n   * @returns New location after drag. delta is in workspace units. newLocation\r\n   *     is the new coordinate where the block should end up.\r\n   */\r\n  protected getNewLocationAfterDrag_(currentDragDeltaXY: Coordinate): {\r\n    delta: Coordinate;\r\n    newLocation: Coordinate;\r\n  } {\r\n    const delta = this.pixelsToWorkspaceUnits_(currentDragDeltaXY);\r\n    const newLocation = Coordinate.sum(this.startXY_, delta);\r\n    return {\r\n      delta,\r\n      newLocation,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * May delete the dragging block, if allowed. If `this.wouldDeleteBlock_` is\r\n   * not true, the block will not be deleted. This should be called at the end\r\n   * of a block drag.\r\n   *\r\n   * @returns True if the block was deleted.\r\n   */\r\n  protected maybeDeleteBlock_(): boolean {\r\n    if (this.wouldDeleteBlock_) {\r\n      // Fire a move event, so we know where to go back to for an undo.\r\n      this.fireMoveEvent_();\r\n      this.draggingBlock_.dispose(false, true);\r\n      common.draggingConnections.length = 0;\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Updates the necessary information to place a block at a certain location.\r\n   */\r\n  protected updateBlockAfterMove_() {\r\n    this.fireMoveEvent_();\r\n    if (this.connectionCandidate) {\r\n      // Applying connections also rerenders the relevant blocks.\r\n      this.applyConnections(this.connectionCandidate);\r\n    } else {\r\n      this.draggingBlock_.queueRender();\r\n    }\r\n    this.draggingBlock_.scheduleSnapAndBump();\r\n  }\r\n\r\n  private applyConnections(candidate: ConnectionCandidate) {\r\n    const {local, neighbour} = candidate;\r\n    local.connect(neighbour);\r\n    // TODO: We can remove this `rendered` check when we reconcile with v11.\r\n    if (this.draggingBlock_.rendered) {\r\n      const inferiorConnection = local.isSuperior() ? neighbour : local;\r\n      const rootBlock = this.draggingBlock_.getRootBlock();\r\n\r\n      finishQueuedRenders().then(() => {\r\n        blockAnimation.connectionUiEffect(inferiorConnection.getSourceBlock());\r\n        // bringToFront is incredibly expensive. Delay until the next frame.\r\n        setTimeout(() => {\r\n          rootBlock.bringToFront();\r\n        }, 0);\r\n      });\r\n    }\r\n  }\r\n\r\n  /** Fire a UI event at the end of a block drag. */\r\n  protected fireDragEndEvent_() {\r\n    const event = new (eventUtils.get(eventUtils.BLOCK_DRAG))(\r\n      this.draggingBlock_,\r\n      false,\r\n      this.draggingBlock_.getDescendants(false),\r\n    );\r\n    eventUtils.fire(event);\r\n  }\r\n\r\n  /**\r\n   * Adds or removes the style of the cursor for the toolbox.\r\n   * This is what changes the cursor to display an x when a deletable block is\r\n   * held over the toolbox.\r\n   *\r\n   * @param isEnd True if we are at the end of a drag, false otherwise.\r\n   */\r\n  protected updateToolboxStyle_(isEnd: boolean) {\r\n    const toolbox = this.workspace_.getToolbox();\r\n\r\n    if (toolbox) {\r\n      const style = this.draggingBlock_.isDeletable()\r\n        ? 'blocklyToolboxDelete'\r\n        : 'blocklyToolboxGrab';\r\n\r\n      // AnyDuringMigration because:  Property 'removeStyle' does not exist on\r\n      // type 'IToolbox'.\r\n      if (\r\n        isEnd &&\r\n        typeof (toolbox as AnyDuringMigration).removeStyle === 'function'\r\n      ) {\r\n        // AnyDuringMigration because:  Property 'removeStyle' does not exist on\r\n        // type 'IToolbox'.\r\n        (toolbox as AnyDuringMigration).removeStyle(style);\r\n        // AnyDuringMigration because:  Property 'addStyle' does not exist on\r\n        // type 'IToolbox'.\r\n      } else if (\r\n        !isEnd &&\r\n        typeof (toolbox as AnyDuringMigration).addStyle === 'function'\r\n      ) {\r\n        // AnyDuringMigration because:  Property 'addStyle' does not exist on\r\n        // type 'IToolbox'.\r\n        (toolbox as AnyDuringMigration).addStyle(style);\r\n      }\r\n    }\r\n  }\r\n\r\n  /** Fire a move event at the end of a block drag. */\r\n  protected fireMoveEvent_() {\r\n    if (this.draggingBlock_.isDeadOrDying()) return;\r\n    const event = new (eventUtils.get(eventUtils.BLOCK_MOVE))(\r\n      this.draggingBlock_,\r\n    ) as BlockMove;\r\n    event.setReason(['drag']);\r\n    event.oldCoordinate = this.startXY_;\r\n    event.recordNew();\r\n    eventUtils.fire(event);\r\n  }\r\n\r\n  /**\r\n   * Update the cursor (and possibly the trash can lid) to reflect whether the\r\n   * dragging block would be deleted if released immediately.\r\n   */\r\n  protected updateCursorDuringBlockDrag_() {\r\n    this.draggingBlock_.setDeleteStyle(this.wouldDeleteBlock_);\r\n  }\r\n\r\n  /**\r\n   * Convert a coordinate object from pixels to workspace units, including a\r\n   * correction for mutator workspaces.\r\n   * This function does not consider differing origins.  It simply scales the\r\n   * input's x and y values.\r\n   *\r\n   * @param pixelCoord A coordinate with x and y values in CSS pixel units.\r\n   * @returns The input coordinate divided by the workspace scale.\r\n   */\r\n  protected pixelsToWorkspaceUnits_(pixelCoord: Coordinate): Coordinate {\r\n    const result = new Coordinate(\r\n      pixelCoord.x / this.workspace_.scale,\r\n      pixelCoord.y / this.workspace_.scale,\r\n    );\r\n    if (this.workspace_.isMutator) {\r\n      // If we're in a mutator, its scale is always 1, purely because of some\r\n      // oddities in our rendering optimizations.  The actual scale is the same\r\n      // as the scale on the parent workspace. Fix that for dragging.\r\n      const mainScale = this.workspace_.options.parentWorkspace!.scale;\r\n      result.scale(1 / mainScale);\r\n    }\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Move all of the icons connected to this drag.\r\n   *\r\n   * @deprecated To be removed in v11. This is now handled by the block's\r\n   *     `moveDuringDrag` method.\r\n   */\r\n  protected dragIcons_() {\r\n    deprecation.warn('Blockly.BlockDragger.prototype.dragIcons_', 'v10', 'v11');\r\n  }\r\n\r\n  /**\r\n   * Get a list of the insertion markers that currently exist.  Drags have 0, 1,\r\n   * or 2 insertion markers.\r\n   *\r\n   * @returns A possibly empty list of insertion marker blocks.\r\n   */\r\n  getInsertionMarkers(): BlockSvg[] {\r\n    return this.workspace_\r\n      .getAllBlocks()\r\n      .filter((block) => block.isInsertionMarker());\r\n  }\r\n}\r\n\r\n/** Data about the position of a given icon. */\r\nexport interface IconPositionData {\r\n  location: Coordinate;\r\n  icon: Icon;\r\n}\r\n\r\n/**\r\n * Make a list of all of the icons (comment, warning, and mutator) that are\r\n * on this block and its descendants.  Moving an icon moves the bubble that\r\n * extends from it if that bubble is open.\r\n *\r\n * @param block The root block that is being dragged.\r\n * @param blockOrigin The top left of the given block in workspace coordinates.\r\n * @returns The list of all icons and their locations.\r\n */\r\nfunction initIconData(\r\n  block: BlockSvg,\r\n  blockOrigin: Coordinate,\r\n): IconPositionData[] {\r\n  // Build a list of icons that need to be moved and where they started.\r\n  const dragIconData = [];\r\n\r\n  for (const icon of block.getIcons()) {\r\n    // Only bother to track icons whose bubble is visible.\r\n    if (hasBubble(icon) && !icon.bubbleIsVisible()) continue;\r\n\r\n    dragIconData.push({location: blockOrigin, icon: icon});\r\n    icon.onLocationChange(blockOrigin);\r\n  }\r\n\r\n  for (const child of block.getChildren(false)) {\r\n    dragIconData.push(\r\n      ...initIconData(child, Coordinate.sum(blockOrigin, child.relativeCoords)),\r\n    );\r\n  }\r\n  // AnyDuringMigration because:  Type '{ location: Coordinate | null; icon:\r\n  // Icon; }[]' is not assignable to type 'IconPositionData[]'.\r\n  return dragIconData as AnyDuringMigration;\r\n}\r\n\r\nregistry.register(registry.Type.BLOCK_DRAGGER, registry.DEFAULT, BlockDragger);\r\n","/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.ContextMenuItems\r\n\r\nimport type {BlockSvg} from './block_svg.js';\r\nimport * as clipboard from './clipboard.js';\r\nimport {\r\n  ContextMenuRegistry,\r\n  RegistryItem,\r\n  Scope,\r\n} from './contextmenu_registry.js';\r\nimport * as dialog from './dialog.js';\r\nimport * as Events from './events/events.js';\r\nimport * as eventUtils from './events/utils.js';\r\nimport {CommentIcon} from './icons/comment_icon.js';\r\nimport {Msg} from './msg.js';\r\nimport {StatementInput} from './renderers/zelos/zelos.js';\r\nimport type {WorkspaceSvg} from './workspace_svg.js';\r\n\r\n/**\r\n * Option to undo previous action.\r\n */\r\nexport function registerUndo() {\r\n  const undoOption: RegistryItem = {\r\n    displayText() {\r\n      return Msg['UNDO'];\r\n    },\r\n    preconditionFn(scope: Scope) {\r\n      if (scope.workspace!.getUndoStack().length > 0) {\r\n        return 'enabled';\r\n      }\r\n      return 'disabled';\r\n    },\r\n    callback(scope: Scope) {\r\n      scope.workspace!.undo(false);\r\n    },\r\n    scopeType: ContextMenuRegistry.ScopeType.WORKSPACE,\r\n    id: 'undoWorkspace',\r\n    weight: 1,\r\n  };\r\n  ContextMenuRegistry.registry.register(undoOption);\r\n}\r\n\r\n/**\r\n * Option to redo previous action.\r\n */\r\nexport function registerRedo() {\r\n  const redoOption: RegistryItem = {\r\n    displayText() {\r\n      return Msg['REDO'];\r\n    },\r\n    preconditionFn(scope: Scope) {\r\n      if (scope.workspace!.getRedoStack().length > 0) {\r\n        return 'enabled';\r\n      }\r\n      return 'disabled';\r\n    },\r\n    callback(scope: Scope) {\r\n      scope.workspace!.undo(true);\r\n    },\r\n    scopeType: ContextMenuRegistry.ScopeType.WORKSPACE,\r\n    id: 'redoWorkspace',\r\n    weight: 2,\r\n  };\r\n  ContextMenuRegistry.registry.register(redoOption);\r\n}\r\n\r\n/**\r\n * Option to clean up blocks.\r\n */\r\nexport function registerCleanup() {\r\n  const cleanOption: RegistryItem = {\r\n    displayText() {\r\n      return Msg['CLEAN_UP'];\r\n    },\r\n    preconditionFn(scope: Scope) {\r\n      if (scope.workspace!.isMovable()) {\r\n        if (scope.workspace!.getTopBlocks(false).length > 1) {\r\n          return 'enabled';\r\n        }\r\n        return 'disabled';\r\n      }\r\n      return 'hidden';\r\n    },\r\n    callback(scope: Scope) {\r\n      scope.workspace!.cleanUp();\r\n    },\r\n    scopeType: ContextMenuRegistry.ScopeType.WORKSPACE,\r\n    id: 'cleanWorkspace',\r\n    weight: 3,\r\n  };\r\n  ContextMenuRegistry.registry.register(cleanOption);\r\n}\r\n/**\r\n * Creates a callback to collapse or expand top blocks.\r\n *\r\n * @param shouldCollapse Whether a block should collapse.\r\n * @param topBlocks Top blocks in the workspace.\r\n */\r\nfunction toggleOption_(shouldCollapse: boolean, topBlocks: BlockSvg[]) {\r\n  const DELAY = 10;\r\n  let ms = 0;\r\n  let timeoutCounter = 0;\r\n  function timeoutFn(block: BlockSvg) {\r\n    timeoutCounter--;\r\n    block.setCollapsed(shouldCollapse);\r\n    if (timeoutCounter === 0) {\r\n      Events.setGroup(false);\r\n    }\r\n  }\r\n  Events.setGroup(true);\r\n  for (let i = 0; i < topBlocks.length; i++) {\r\n    let block: BlockSvg | null = topBlocks[i];\r\n    while (block) {\r\n      timeoutCounter++;\r\n      setTimeout(timeoutFn.bind(null, block), ms);\r\n      block = block.getNextBlock();\r\n      ms += DELAY;\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Option to collapse all blocks.\r\n */\r\nexport function registerCollapse() {\r\n  const collapseOption: RegistryItem = {\r\n    displayText() {\r\n      return Msg['COLLAPSE_ALL'];\r\n    },\r\n    preconditionFn(scope: Scope) {\r\n      if (scope.workspace!.options.collapse) {\r\n        const topBlocks = scope.workspace!.getTopBlocks(false);\r\n        for (let i = 0; i < topBlocks.length; i++) {\r\n          let block: BlockSvg | null = topBlocks[i];\r\n          while (block) {\r\n            if (!block.isCollapsed()) {\r\n              return 'enabled';\r\n            }\r\n            block = block.getNextBlock();\r\n          }\r\n        }\r\n        return 'disabled';\r\n      }\r\n      return 'hidden';\r\n    },\r\n    callback(scope: Scope) {\r\n      toggleOption_(true, scope.workspace!.getTopBlocks(true));\r\n    },\r\n    scopeType: ContextMenuRegistry.ScopeType.WORKSPACE,\r\n    id: 'collapseWorkspace',\r\n    weight: 4,\r\n  };\r\n  ContextMenuRegistry.registry.register(collapseOption);\r\n}\r\n\r\n/**\r\n * Option to expand all blocks.\r\n */\r\nexport function registerExpand() {\r\n  const expandOption: RegistryItem = {\r\n    displayText() {\r\n      return Msg['EXPAND_ALL'];\r\n    },\r\n    preconditionFn(scope: Scope) {\r\n      if (scope.workspace!.options.collapse) {\r\n        const topBlocks = scope.workspace!.getTopBlocks(false);\r\n        for (let i = 0; i < topBlocks.length; i++) {\r\n          let block: BlockSvg | null = topBlocks[i];\r\n          while (block) {\r\n            if (block.isCollapsed()) {\r\n              return 'enabled';\r\n            }\r\n            block = block.getNextBlock();\r\n          }\r\n        }\r\n        return 'disabled';\r\n      }\r\n      return 'hidden';\r\n    },\r\n    callback(scope: Scope) {\r\n      toggleOption_(false, scope.workspace!.getTopBlocks(true));\r\n    },\r\n    scopeType: ContextMenuRegistry.ScopeType.WORKSPACE,\r\n    id: 'expandWorkspace',\r\n    weight: 5,\r\n  };\r\n  ContextMenuRegistry.registry.register(expandOption);\r\n}\r\n/**\r\n * Adds a block and its children to a list of deletable blocks.\r\n *\r\n * @param block to delete.\r\n * @param deleteList list of blocks that can be deleted.\r\n *     This will be modified in place with the given block and its descendants.\r\n */\r\nfunction addDeletableBlocks_(block: BlockSvg, deleteList: BlockSvg[]) {\r\n  if (block.isDeletable()) {\r\n    Array.prototype.push.apply(deleteList, block.getDescendants(false));\r\n  } else {\r\n    const children = block.getChildren(false);\r\n    for (let i = 0; i < children.length; i++) {\r\n      addDeletableBlocks_(children[i], deleteList);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Constructs a list of blocks that can be deleted in the given workspace.\r\n *\r\n * @param workspace to delete all blocks from.\r\n * @returns list of blocks to delete.\r\n */\r\nfunction getDeletableBlocks_(workspace: WorkspaceSvg): BlockSvg[] {\r\n  const deleteList: BlockSvg[] = [];\r\n  const topBlocks = workspace.getTopBlocks(true);\r\n  for (let i = 0; i < topBlocks.length; i++) {\r\n    addDeletableBlocks_(topBlocks[i], deleteList);\r\n  }\r\n  return deleteList;\r\n}\r\n\r\n/**\r\n * Deletes the given blocks. Used to delete all blocks in the workspace.\r\n *\r\n * @param deleteList List of blocks to delete.\r\n * @param eventGroup Event group ID with which all delete events should be\r\n *     associated.  If not specified, create a new group.\r\n */\r\nfunction deleteNext_(deleteList: BlockSvg[], eventGroup?: string) {\r\n  const DELAY = 10;\r\n  if (eventGroup) {\r\n    eventUtils.setGroup(eventGroup);\r\n  } else {\r\n    eventUtils.setGroup(true);\r\n    eventGroup = eventUtils.getGroup();\r\n  }\r\n  const block = deleteList.shift();\r\n  if (block) {\r\n    if (!block.isDeadOrDying()) {\r\n      block.dispose(false, true);\r\n      setTimeout(deleteNext_, DELAY, deleteList, eventGroup);\r\n    } else {\r\n      deleteNext_(deleteList, eventGroup);\r\n    }\r\n  }\r\n  eventUtils.setGroup(false);\r\n}\r\n\r\n/**\r\n * Option to delete all blocks.\r\n */\r\nexport function registerDeleteAll() {\r\n  const deleteOption: RegistryItem = {\r\n    displayText(scope: Scope) {\r\n      if (!scope.workspace) {\r\n        return '';\r\n      }\r\n      const deletableBlocksLength = getDeletableBlocks_(scope.workspace).length;\r\n      if (deletableBlocksLength === 1) {\r\n        return Msg['DELETE_BLOCK'];\r\n      }\r\n      return Msg['DELETE_X_BLOCKS'].replace('%1', `${deletableBlocksLength}`);\r\n    },\r\n    preconditionFn(scope: Scope) {\r\n      if (!scope.workspace) {\r\n        return 'disabled';\r\n      }\r\n      const deletableBlocksLength = getDeletableBlocks_(scope.workspace).length;\r\n      return deletableBlocksLength > 0 ? 'enabled' : 'disabled';\r\n    },\r\n    callback(scope: Scope) {\r\n      if (!scope.workspace) {\r\n        return;\r\n      }\r\n      scope.workspace.cancelCurrentGesture();\r\n      const deletableBlocks = getDeletableBlocks_(scope.workspace);\r\n      if (deletableBlocks.length < 2) {\r\n        deleteNext_(deletableBlocks);\r\n      } else {\r\n        dialog.confirm(\r\n          Msg['DELETE_ALL_BLOCKS'].replace(\r\n            '%1',\r\n            String(deletableBlocks.length),\r\n          ),\r\n          function (ok) {\r\n            if (ok) {\r\n              deleteNext_(deletableBlocks);\r\n            }\r\n          },\r\n        );\r\n      }\r\n    },\r\n    scopeType: ContextMenuRegistry.ScopeType.WORKSPACE,\r\n    id: 'workspaceDelete',\r\n    weight: 6,\r\n  };\r\n  ContextMenuRegistry.registry.register(deleteOption);\r\n}\r\n/** Registers all workspace-scoped context menu items. */\r\nfunction registerWorkspaceOptions_() {\r\n  registerUndo();\r\n  registerRedo();\r\n  registerCleanup();\r\n  registerCollapse();\r\n  registerExpand();\r\n  registerDeleteAll();\r\n}\r\n\r\n/**\r\n * Option to duplicate a block.\r\n */\r\nexport function registerDuplicate() {\r\n  const duplicateOption: RegistryItem = {\r\n    displayText() {\r\n      return Msg['DUPLICATE_BLOCK'];\r\n    },\r\n    preconditionFn(scope: Scope) {\r\n      const block = scope.block;\r\n      if (!block!.isInFlyout && block!.isDeletable() && block!.isMovable()) {\r\n        if (block!.isDuplicatable()) {\r\n          return 'enabled';\r\n        }\r\n        return 'disabled';\r\n      }\r\n      return 'hidden';\r\n    },\r\n    callback(scope: Scope) {\r\n      if (!scope.block) return;\r\n      const data = scope.block.toCopyData();\r\n      if (!data) return;\r\n      clipboard.paste(data, scope.block.workspace);\r\n    },\r\n    scopeType: ContextMenuRegistry.ScopeType.BLOCK,\r\n    id: 'blockDuplicate',\r\n    weight: 1,\r\n  };\r\n  ContextMenuRegistry.registry.register(duplicateOption);\r\n}\r\n\r\n/**\r\n * Option to add or remove block-level comment.\r\n */\r\nexport function registerComment() {\r\n  const commentOption: RegistryItem = {\r\n    displayText(scope: Scope) {\r\n      if (scope.block!.hasIcon(CommentIcon.TYPE)) {\r\n        // If there's already a comment,  option is to remove.\r\n        return Msg['REMOVE_COMMENT'];\r\n      }\r\n      // If there's no comment yet, option is to add.\r\n      return Msg['ADD_COMMENT'];\r\n    },\r\n    preconditionFn(scope: Scope) {\r\n      const block = scope.block;\r\n      if (\r\n        !block!.isInFlyout &&\r\n        block!.workspace.options.comments &&\r\n        !block!.isCollapsed() &&\r\n        block!.isEditable()\r\n      ) {\r\n        return 'enabled';\r\n      }\r\n      return 'hidden';\r\n    },\r\n    callback(scope: Scope) {\r\n      const block = scope.block;\r\n      if (block!.hasIcon(CommentIcon.TYPE)) {\r\n        block!.setCommentText(null);\r\n      } else {\r\n        block!.setCommentText('');\r\n      }\r\n    },\r\n    scopeType: ContextMenuRegistry.ScopeType.BLOCK,\r\n    id: 'blockComment',\r\n    weight: 2,\r\n  };\r\n  ContextMenuRegistry.registry.register(commentOption);\r\n}\r\n\r\n/**\r\n * Option to inline variables.\r\n */\r\nexport function registerInline() {\r\n  const inlineOption: RegistryItem = {\r\n    displayText(scope: Scope) {\r\n      return scope.block!.getInputsInline()\r\n        ? Msg['EXTERNAL_INPUTS']\r\n        : Msg['INLINE_INPUTS'];\r\n    },\r\n    preconditionFn(scope: Scope) {\r\n      const block = scope.block;\r\n      if (!block!.isInFlyout && block!.isMovable() && !block!.isCollapsed()) {\r\n        for (let i = 1; i < block!.inputList.length; i++) {\r\n          // Only display this option if there are two value or dummy inputs\r\n          // next to each other.\r\n          if (\r\n            !(block!.inputList[i - 1] instanceof StatementInput) &&\r\n            !(block!.inputList[i] instanceof StatementInput)\r\n          ) {\r\n            return 'enabled';\r\n          }\r\n        }\r\n      }\r\n      return 'hidden';\r\n    },\r\n    callback(scope: Scope) {\r\n      scope.block!.setInputsInline(!scope.block!.getInputsInline());\r\n    },\r\n    scopeType: ContextMenuRegistry.ScopeType.BLOCK,\r\n    id: 'blockInline',\r\n    weight: 3,\r\n  };\r\n  ContextMenuRegistry.registry.register(inlineOption);\r\n}\r\n\r\n/**\r\n * Option to collapse or expand a block.\r\n */\r\nexport function registerCollapseExpandBlock() {\r\n  const collapseExpandOption: RegistryItem = {\r\n    displayText(scope: Scope) {\r\n      return scope.block!.isCollapsed()\r\n        ? Msg['EXPAND_BLOCK']\r\n        : Msg['COLLAPSE_BLOCK'];\r\n    },\r\n    preconditionFn(scope: Scope) {\r\n      const block = scope.block;\r\n      if (\r\n        !block!.isInFlyout &&\r\n        block!.isMovable() &&\r\n        block!.workspace.options.collapse\r\n      ) {\r\n        return 'enabled';\r\n      }\r\n      return 'hidden';\r\n    },\r\n    callback(scope: Scope) {\r\n      scope.block!.setCollapsed(!scope.block!.isCollapsed());\r\n    },\r\n    scopeType: ContextMenuRegistry.ScopeType.BLOCK,\r\n    id: 'blockCollapseExpand',\r\n    weight: 4,\r\n  };\r\n  ContextMenuRegistry.registry.register(collapseExpandOption);\r\n}\r\n\r\n/**\r\n * Option to disable or enable a block.\r\n */\r\nexport function registerDisable() {\r\n  const disableOption: RegistryItem = {\r\n    displayText(scope: Scope) {\r\n      return scope.block!.isEnabled()\r\n        ? Msg['DISABLE_BLOCK']\r\n        : Msg['ENABLE_BLOCK'];\r\n    },\r\n    preconditionFn(scope: Scope) {\r\n      const block = scope.block;\r\n      if (\r\n        !block!.isInFlyout &&\r\n        block!.workspace.options.disable &&\r\n        block!.isEditable()\r\n      ) {\r\n        if (block!.getInheritedDisabled()) {\r\n          return 'disabled';\r\n        }\r\n        return 'enabled';\r\n      }\r\n      return 'hidden';\r\n    },\r\n    callback(scope: Scope) {\r\n      const block = scope.block;\r\n      const existingGroup = eventUtils.getGroup();\r\n      if (!existingGroup) {\r\n        eventUtils.setGroup(true);\r\n      }\r\n      block!.setEnabled(!block!.isEnabled());\r\n      eventUtils.setGroup(existingGroup);\r\n    },\r\n    scopeType: ContextMenuRegistry.ScopeType.BLOCK,\r\n    id: 'blockDisable',\r\n    weight: 5,\r\n  };\r\n  ContextMenuRegistry.registry.register(disableOption);\r\n}\r\n\r\n/**\r\n * Option to delete a block.\r\n */\r\nexport function registerDelete() {\r\n  const deleteOption: RegistryItem = {\r\n    displayText(scope: Scope) {\r\n      const block = scope.block;\r\n      // Count the number of blocks that are nested in this block.\r\n      let descendantCount = block!.getDescendants(false).length;\r\n      const nextBlock = block!.getNextBlock();\r\n      if (nextBlock) {\r\n        // Blocks in the current stack would survive this block's deletion.\r\n        descendantCount -= nextBlock.getDescendants(false).length;\r\n      }\r\n      return descendantCount === 1\r\n        ? Msg['DELETE_BLOCK']\r\n        : Msg['DELETE_X_BLOCKS'].replace('%1', `${descendantCount}`);\r\n    },\r\n    preconditionFn(scope: Scope) {\r\n      if (!scope.block!.isInFlyout && scope.block!.isDeletable()) {\r\n        return 'enabled';\r\n      }\r\n      return 'hidden';\r\n    },\r\n    callback(scope: Scope) {\r\n      if (scope.block) {\r\n        scope.block.checkAndDelete();\r\n      }\r\n    },\r\n    scopeType: ContextMenuRegistry.ScopeType.BLOCK,\r\n    id: 'blockDelete',\r\n    weight: 6,\r\n  };\r\n  ContextMenuRegistry.registry.register(deleteOption);\r\n}\r\n\r\n/**\r\n * Option to open help for a block.\r\n */\r\nexport function registerHelp() {\r\n  const helpOption: RegistryItem = {\r\n    displayText() {\r\n      return Msg['HELP'];\r\n    },\r\n    preconditionFn(scope: Scope) {\r\n      const block = scope.block;\r\n      const url =\r\n        typeof block!.helpUrl === 'function'\r\n          ? block!.helpUrl()\r\n          : block!.helpUrl;\r\n      if (url) {\r\n        return 'enabled';\r\n      }\r\n      return 'hidden';\r\n    },\r\n    callback(scope: Scope) {\r\n      scope.block!.showHelp();\r\n    },\r\n    scopeType: ContextMenuRegistry.ScopeType.BLOCK,\r\n    id: 'blockHelp',\r\n    weight: 7,\r\n  };\r\n  ContextMenuRegistry.registry.register(helpOption);\r\n}\r\n\r\n/** Registers all block-scoped context menu items. */\r\nfunction registerBlockOptions_() {\r\n  registerDuplicate();\r\n  registerComment();\r\n  registerInline();\r\n  registerCollapseExpandBlock();\r\n  registerDisable();\r\n  registerDelete();\r\n  registerHelp();\r\n}\r\n\r\n/**\r\n * Registers all default context menu items. This should be called once per\r\n * instance of ContextMenuRegistry.\r\n *\r\n * @internal\r\n */\r\nexport function registerDefaultOptions() {\r\n  registerWorkspaceOptions_();\r\n  registerBlockOptions_();\r\n}\r\n\r\nregisterDefaultOptions();\r\n","/**\r\n * @license\r\n * Copyright 2011 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.inject\r\n\r\nimport type {BlocklyOptions} from './blockly_options.js';\r\nimport * as browserEvents from './browser_events.js';\r\nimport * as bumpObjects from './bump_objects.js';\r\nimport * as common from './common.js';\r\nimport * as Css from './css.js';\r\nimport * as dropDownDiv from './dropdowndiv.js';\r\nimport {Grid} from './grid.js';\r\nimport {Msg} from './msg.js';\r\nimport {Options} from './options.js';\r\nimport {ScrollbarPair} from './scrollbar_pair.js';\r\nimport {ShortcutRegistry} from './shortcut_registry.js';\r\nimport * as Tooltip from './tooltip.js';\r\nimport * as Touch from './touch.js';\r\nimport * as aria from './utils/aria.js';\r\nimport * as dom from './utils/dom.js';\r\nimport {Svg} from './utils/svg.js';\r\nimport * as userAgent from './utils/useragent.js';\r\nimport * as WidgetDiv from './widgetdiv.js';\r\nimport {WorkspaceSvg} from './workspace_svg.js';\r\n\r\n/**\r\n * Inject a Blockly editor into the specified container element (usually a div).\r\n *\r\n * @param container Containing element, or its ID, or a CSS selector.\r\n * @param opt_options Optional dictionary of options.\r\n * @returns Newly created main workspace.\r\n */\r\nexport function inject(\r\n  container: Element | string,\r\n  opt_options?: BlocklyOptions,\r\n): WorkspaceSvg {\r\n  let containerElement: Element | null = null;\r\n  if (typeof container === 'string') {\r\n    containerElement =\r\n      document.getElementById(container) || document.querySelector(container);\r\n  } else {\r\n    containerElement = container;\r\n  }\r\n  // Verify that the container is in document.\r\n  if (\r\n    !document.contains(containerElement) &&\r\n    document !== containerElement?.ownerDocument\r\n  ) {\r\n    throw Error('Error: container is not in current document');\r\n  }\r\n  const options = new Options(opt_options || ({} as BlocklyOptions));\r\n  const subContainer = document.createElement('div');\r\n  subContainer.className = 'injectionDiv';\r\n  subContainer.tabIndex = 0;\r\n  aria.setState(subContainer, aria.State.LABEL, Msg['WORKSPACE_ARIA_LABEL']);\r\n\r\n  containerElement!.appendChild(subContainer);\r\n  const svg = createDom(subContainer, options);\r\n\r\n  const workspace = createMainWorkspace(subContainer, svg, options);\r\n\r\n  init(workspace);\r\n\r\n  // Keep focus on the first workspace so entering keyboard navigation looks\r\n  // correct.\r\n  common.setMainWorkspace(workspace);\r\n\r\n  common.svgResize(workspace);\r\n\r\n  subContainer.addEventListener('focusin', function () {\r\n    common.setMainWorkspace(workspace);\r\n  });\r\n\r\n  return workspace;\r\n}\r\n\r\n/**\r\n * Create the SVG image.\r\n *\r\n * @param container Containing element.\r\n * @param options Dictionary of options.\r\n * @returns Newly created SVG image.\r\n */\r\nfunction createDom(container: Element, options: Options): SVGElement {\r\n  // Sadly browsers (Chrome vs Firefox) are currently inconsistent in laying\r\n  // out content in RTL mode.  Therefore Blockly forces the use of LTR,\r\n  // then manually positions content in RTL as needed.\r\n  container.setAttribute('dir', 'LTR');\r\n\r\n  // Load CSS.\r\n  Css.inject(options.hasCss, options.pathToMedia);\r\n\r\n  // Build the SVG DOM.\r\n  /*\r\n    <svg\r\n      xmlns=\"http://www.w3.org/2000/svg\"\r\n      xmlns:html=\"http://www.w3.org/1999/xhtml\"\r\n      xmlns:xlink=\"http://www.w3.org/1999/xlink\"\r\n      version=\"1.1\"\r\n      class=\"blocklySvg\">\r\n      ...\r\n    </svg>\r\n    */\r\n  const svg = dom.createSvgElement(\r\n    Svg.SVG,\r\n    {\r\n      'xmlns': dom.SVG_NS,\r\n      'xmlns:html': dom.HTML_NS,\r\n      'xmlns:xlink': dom.XLINK_NS,\r\n      'version': '1.1',\r\n      'class': 'blocklySvg',\r\n      'tabindex': '0',\r\n    },\r\n    container,\r\n  );\r\n  /*\r\n    <defs>\r\n      ... filters go here ...\r\n    </defs>\r\n    */\r\n  const defs = dom.createSvgElement(Svg.DEFS, {}, svg);\r\n  // Each filter/pattern needs a unique ID for the case of multiple Blockly\r\n  // instances on a page.  Browser behaviour becomes undefined otherwise.\r\n  // https://neil.fraser.name/news/2015/11/01/\r\n  const rnd = String(Math.random()).substring(2);\r\n\r\n  options.gridPattern = Grid.createDom(rnd, options.gridOptions, defs);\r\n  return svg;\r\n}\r\n\r\n/**\r\n * Create a main workspace and add it to the SVG.\r\n *\r\n * @param svg SVG element with pattern defined.\r\n * @param options Dictionary of options.\r\n * @returns Newly created main workspace.\r\n */\r\nfunction createMainWorkspace(\r\n  injectionDiv: Element,\r\n  svg: SVGElement,\r\n  options: Options,\r\n): WorkspaceSvg {\r\n  options.parentWorkspace = null;\r\n  const mainWorkspace = new WorkspaceSvg(options);\r\n  const wsOptions = mainWorkspace.options;\r\n  mainWorkspace.scale = wsOptions.zoomOptions.startScale;\r\n  svg.appendChild(\r\n    mainWorkspace.createDom('blocklyMainBackground', injectionDiv),\r\n  );\r\n\r\n  // Set the theme name and renderer name onto the injection div.\r\n  const rendererClassName = mainWorkspace.getRenderer().getClassName();\r\n  if (rendererClassName) {\r\n    dom.addClass(injectionDiv, rendererClassName);\r\n  }\r\n  const themeClassName = mainWorkspace.getTheme().getClassName();\r\n  if (themeClassName) {\r\n    dom.addClass(injectionDiv, themeClassName);\r\n  }\r\n\r\n  if (!wsOptions.hasCategories && wsOptions.languageTree) {\r\n    // Add flyout as an <svg> that is a sibling of the workspace SVG.\r\n    const flyout = mainWorkspace.addFlyout(Svg.SVG);\r\n    dom.insertAfter(flyout, svg);\r\n  }\r\n  if (wsOptions.hasTrashcan) {\r\n    mainWorkspace.addTrashcan();\r\n  }\r\n  if (wsOptions.zoomOptions && wsOptions.zoomOptions.controls) {\r\n    mainWorkspace.addZoomControls();\r\n  }\r\n  // Register the workspace svg as a UI component.\r\n  mainWorkspace\r\n    .getThemeManager()\r\n    .subscribe(svg, 'workspaceBackgroundColour', 'background-color');\r\n\r\n  // A null translation will also apply the correct initial scale.\r\n  mainWorkspace.translate(0, 0);\r\n\r\n  mainWorkspace.addChangeListener(\r\n    bumpObjects.bumpIntoBoundsHandler(mainWorkspace),\r\n  );\r\n\r\n  // The SVG is now fully assembled.\r\n  common.svgResize(mainWorkspace);\r\n  WidgetDiv.createDom();\r\n  dropDownDiv.createDom();\r\n  Tooltip.createDom();\r\n  return mainWorkspace;\r\n}\r\n\r\n/**\r\n * Initialize Blockly with various handlers.\r\n *\r\n * @param mainWorkspace Newly created main workspace.\r\n */\r\nfunction init(mainWorkspace: WorkspaceSvg) {\r\n  const options = mainWorkspace.options;\r\n  const svg = mainWorkspace.getParentSvg();\r\n\r\n  // Suppress the browser's context menu.\r\n  browserEvents.conditionalBind(\r\n    svg.parentNode as Element,\r\n    'contextmenu',\r\n    null,\r\n    function (e: Event) {\r\n      if (!browserEvents.isTargetInput(e)) {\r\n        e.preventDefault();\r\n      }\r\n    },\r\n  );\r\n\r\n  const workspaceResizeHandler = browserEvents.conditionalBind(\r\n    window,\r\n    'resize',\r\n    null,\r\n    function () {\r\n      // Don't hide all the chaff. Leave the dropdown and widget divs open if\r\n      // possible.\r\n      Tooltip.hide();\r\n      mainWorkspace.hideComponents(true);\r\n      dropDownDiv.repositionForWindowResize();\r\n      WidgetDiv.repositionForWindowResize();\r\n      common.svgResize(mainWorkspace);\r\n      bumpObjects.bumpTopObjectsIntoBounds(mainWorkspace);\r\n    },\r\n  );\r\n  mainWorkspace.setResizeHandlerWrapper(workspaceResizeHandler);\r\n\r\n  bindDocumentEvents();\r\n\r\n  if (options.languageTree) {\r\n    const toolbox = mainWorkspace.getToolbox();\r\n    const flyout = mainWorkspace.getFlyout(true);\r\n    if (toolbox) {\r\n      toolbox.init();\r\n    } else if (flyout) {\r\n      // Build a fixed flyout with the root blocks.\r\n      flyout.init(mainWorkspace);\r\n      flyout.show(options.languageTree);\r\n      if (typeof flyout.scrollToStart === 'function') {\r\n        flyout.scrollToStart();\r\n      }\r\n    }\r\n  }\r\n\r\n  if (options.hasTrashcan) {\r\n    mainWorkspace.trashcan!.init();\r\n  }\r\n  if (options.zoomOptions && options.zoomOptions.controls) {\r\n    mainWorkspace.zoomControls_!.init();\r\n  }\r\n\r\n  if (options.moveOptions && options.moveOptions.scrollbars) {\r\n    const horizontalScroll =\r\n      options.moveOptions.scrollbars === true ||\r\n      !!options.moveOptions.scrollbars.horizontal;\r\n    const verticalScroll =\r\n      options.moveOptions.scrollbars === true ||\r\n      !!options.moveOptions.scrollbars.vertical;\r\n    mainWorkspace.scrollbar = new ScrollbarPair(\r\n      mainWorkspace,\r\n      horizontalScroll,\r\n      verticalScroll,\r\n      'blocklyMainWorkspaceScrollbar',\r\n    );\r\n    mainWorkspace.scrollbar.resize();\r\n  } else {\r\n    mainWorkspace.setMetrics({x: 0.5, y: 0.5});\r\n  }\r\n\r\n  // Load the sounds.\r\n  if (options.hasSounds) {\r\n    loadSounds(options.pathToMedia, mainWorkspace);\r\n  }\r\n}\r\n\r\n/**\r\n * Handle a key-down on SVG drawing surface. Does nothing if the main workspace\r\n * is not visible.\r\n *\r\n * @param e Key down event.\r\n */\r\n// TODO (https://github.com/google/blockly/issues/1998) handle cases where there\r\n// are multiple workspaces and non-main workspaces are able to accept input.\r\nfunction onKeyDown(e: KeyboardEvent) {\r\n  const mainWorkspace = common.getMainWorkspace() as WorkspaceSvg;\r\n  if (!mainWorkspace) {\r\n    return;\r\n  }\r\n\r\n  if (\r\n    browserEvents.isTargetInput(e) ||\r\n    (mainWorkspace.rendered && !mainWorkspace.isVisible())\r\n  ) {\r\n    // When focused on an HTML text input widget, don't trap any keys.\r\n    // Ignore keypresses on rendered workspaces that have been explicitly\r\n    // hidden.\r\n    return;\r\n  }\r\n  ShortcutRegistry.registry.onKeyDown(mainWorkspace, e);\r\n}\r\n\r\n/**\r\n * Whether event handlers have been bound. Document event handlers will only\r\n * be bound once, even if Blockly is destroyed and reinjected.\r\n */\r\nlet documentEventsBound = false;\r\n\r\n/**\r\n * Bind document events, but only once.  Destroying and reinjecting Blockly\r\n * should not bind again.\r\n * Bind events for scrolling the workspace.\r\n * Most of these events should be bound to the SVG's surface.\r\n * However, 'mouseup' has to be on the whole document so that a block dragged\r\n * out of bounds and released will know that it has been released.\r\n * Also, 'keydown' has to be on the whole document since the browser doesn't\r\n * understand a concept of focus on the SVG image.\r\n */\r\nfunction bindDocumentEvents() {\r\n  if (!documentEventsBound) {\r\n    browserEvents.conditionalBind(document, 'scroll', null, function () {\r\n      const workspaces = common.getAllWorkspaces();\r\n      for (let i = 0, workspace; (workspace = workspaces[i]); i++) {\r\n        if (workspace instanceof WorkspaceSvg) {\r\n          workspace.updateInverseScreenCTM();\r\n        }\r\n      }\r\n    });\r\n    browserEvents.conditionalBind(document, 'keydown', null, onKeyDown);\r\n    // longStop needs to run to stop the context menu from showing up.  It\r\n    // should run regardless of what other touch event handlers have run.\r\n    browserEvents.bind(document, 'touchend', null, Touch.longStop);\r\n    browserEvents.bind(document, 'touchcancel', null, Touch.longStop);\r\n    // Some iPad versions don't fire resize after portrait to landscape change.\r\n    if (userAgent.IPAD) {\r\n      browserEvents.conditionalBind(\r\n        window,\r\n        'orientationchange',\r\n        document,\r\n        function () {\r\n          // TODO (#397): Fix for multiple Blockly workspaces.\r\n          common.svgResize(common.getMainWorkspace() as WorkspaceSvg);\r\n        },\r\n      );\r\n    }\r\n  }\r\n  documentEventsBound = true;\r\n}\r\n\r\n/**\r\n * Load sounds for the given workspace.\r\n *\r\n * @param pathToMedia The path to the media directory.\r\n * @param workspace The workspace to load sounds for.\r\n */\r\nfunction loadSounds(pathToMedia: string, workspace: WorkspaceSvg) {\r\n  const audioMgr = workspace.getAudioManager();\r\n  audioMgr.load(\r\n    [\r\n      pathToMedia + 'click.mp3',\r\n      pathToMedia + 'click.wav',\r\n      pathToMedia + 'click.ogg',\r\n    ],\r\n    'click',\r\n  );\r\n  audioMgr.load(\r\n    [\r\n      pathToMedia + 'disconnect.wav',\r\n      pathToMedia + 'disconnect.mp3',\r\n      pathToMedia + 'disconnect.ogg',\r\n    ],\r\n    'disconnect',\r\n  );\r\n  audioMgr.load(\r\n    [\r\n      pathToMedia + 'delete.mp3',\r\n      pathToMedia + 'delete.ogg',\r\n      pathToMedia + 'delete.wav',\r\n    ],\r\n    'delete',\r\n  );\r\n\r\n  // Bind temporary hooks that preload the sounds.\r\n  const soundBinds: browserEvents.Data[] = [];\r\n  /**\r\n   *\r\n   */\r\n  function unbindSounds() {\r\n    while (soundBinds.length) {\r\n      const oldSoundBinding = soundBinds.pop();\r\n      if (oldSoundBinding) {\r\n        browserEvents.unbind(oldSoundBinding);\r\n      }\r\n    }\r\n    audioMgr.preload();\r\n  }\r\n\r\n  // These are bound on mouse/touch events with\r\n  // Blockly.browserEvents.conditionalBind, so they restrict the touch\r\n  // identifier that will be recognized.  But this is really something that\r\n  // happens on a click, not a drag, so that's not necessary.\r\n\r\n  // Android ignores any sound not loaded as a result of a user action.\r\n  soundBinds.push(\r\n    browserEvents.conditionalBind(\r\n      document,\r\n      'pointermove',\r\n      null,\r\n      unbindSounds,\r\n      true,\r\n    ),\r\n  );\r\n  soundBinds.push(\r\n    browserEvents.conditionalBind(\r\n      document,\r\n      'touchstart',\r\n      null,\r\n      unbindSounds,\r\n      true,\r\n    ),\r\n  );\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2023 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport type {IconType} from '../icons/icon_types.js';\r\nimport type {Coordinate} from '../utils/coordinate.js';\r\nimport type {Size} from '../utils/size.js';\r\n\r\nexport interface IIcon {\r\n  /**\r\n   * @returns the IconType representing the type of the icon. This value should\r\n   *     also be used to register the icon via `Blockly.icons.registry.register`.\r\n   */\r\n  getType(): IconType<IIcon>;\r\n\r\n  /**\r\n   * Creates the SVG elements for the icon that will live on the block.\r\n   *\r\n   * @param pointerdownListener An event listener that must be attached to the\r\n   *     root SVG element by the implementation of `initView`. Used by Blockly's\r\n   *     gesture system to properly handle clicks and drags.\r\n   */\r\n  initView(pointerdownListener: (e: PointerEvent) => void): void;\r\n\r\n  /**\r\n   * Disposes of any elements of the icon.\r\n   *\r\n   * @remarks\r\n   *\r\n   * In particular, if this icon is currently showing a bubble, this should be\r\n   * used to hide it.\r\n   */\r\n  dispose(): void;\r\n\r\n  /**\r\n   * @returns the \"weight\" of the icon, which determines the static order which\r\n   *     icons should be rendered in. More positive numbers are rendered farther\r\n   *     toward the end of the block.\r\n   */\r\n  getWeight(): number;\r\n\r\n  /** @returns The dimensions of the icon for use in rendering. */\r\n  getSize(): Size;\r\n\r\n  /** Updates the icon's color when the block's color changes.. */\r\n  applyColour(): void;\r\n\r\n  /** Hides the icon when it is part of an insertion marker. */\r\n  hideForInsertionMarker(): void;\r\n\r\n  /** Updates the icon's editability when the block's editability changes. */\r\n  updateEditable(): void;\r\n\r\n  /**\r\n   * Updates the icon's collapsed-ness/view when the block's collapsed-ness\r\n   * changes.\r\n   */\r\n  updateCollapsed(): void;\r\n\r\n  /**\r\n   * @returns Whether this icon is shown when the block is collapsed. Used\r\n   *     to allow renderers to account for padding.\r\n   */\r\n  isShownWhenCollapsed(): boolean;\r\n\r\n  /**\r\n   * Notifies the icon where it is relative to its block's top-start, in\r\n   * workspace units.\r\n   */\r\n  setOffsetInBlock(offset: Coordinate): void;\r\n\r\n  /**\r\n   * Notifies the icon that it has changed locations.\r\n   *\r\n   * @param blockOrigin The location of this icon's block's top-start corner\r\n   *     in workspace coordinates.\r\n   */\r\n  onLocationChange(blockOrigin: Coordinate): void;\r\n\r\n  /**\r\n   * Notifies the icon that it has been clicked.\r\n   */\r\n  onClick(): void;\r\n\r\n  /**\r\n   * Check whether the icon should be clickable while the block is in a flyout.\r\n   * If this function is not defined, the icon will be clickable in all flyouts.\r\n   *\r\n   * @param autoClosingFlyout true if the containing flyout is an auto-closing one.\r\n   * @returns Whether the icon should be clickable while the block is in a flyout.\r\n   */\r\n  isClickableInFlyout?(autoClosingFlyout: boolean): boolean;\r\n}\r\n\r\n/** Type guard that checks whether the given object is an IIcon. */\r\nexport function isIcon(obj: any): obj is IIcon {\r\n  return (\r\n    obj.getType !== undefined &&\r\n    obj.initView !== undefined &&\r\n    obj.dispose !== undefined &&\r\n    obj.getWeight !== undefined &&\r\n    obj.getSize !== undefined &&\r\n    obj.applyColour !== undefined &&\r\n    obj.hideForInsertionMarker !== undefined &&\r\n    obj.updateEditable !== undefined &&\r\n    obj.updateCollapsed !== undefined &&\r\n    obj.isShownWhenCollapsed !== undefined &&\r\n    obj.setOffsetInBlock !== undefined &&\r\n    obj.onLocationChange !== undefined &&\r\n    obj.onClick !== undefined\r\n  );\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2023 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport {Coordinate} from '../utils/coordinate.js';\r\nimport {WorkspaceSvg} from '../workspace_svg.js';\r\nimport {ICopyable, ICopyData} from './i_copyable.js';\r\n\r\n/** An object that can paste data into a workspace. */\r\nexport interface IPaster<U extends ICopyData, T extends ICopyable<U>> {\r\n  paste(\r\n    copyData: U,\r\n    workspace: WorkspaceSvg,\r\n    coordinate?: Coordinate,\r\n  ): T | null;\r\n}\r\n\r\n/** @returns True if the given object is a paster. */\r\nexport function isPaster(\r\n  obj: any,\r\n): obj is IPaster<ICopyData, ICopyable<ICopyData>> {\r\n  return obj.paste !== undefined;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport type {FlyoutItemInfoArray} from '../utils/toolbox';\r\n// Former goog.module ID: Blockly.ISelectableToolboxItem\r\n\r\nimport type {IToolboxItem} from './i_toolbox_item.js';\r\n\r\n/**\r\n * Interface for an item in the toolbox that can be selected.\r\n */\r\nexport interface ISelectableToolboxItem extends IToolboxItem {\r\n  /**\r\n   * Gets the name of the toolbox item. Used for emitting events.\r\n   *\r\n   * @returns The name of the toolbox item.\r\n   */\r\n  getName(): string;\r\n\r\n  /**\r\n   * Gets the contents of the toolbox item. These are items that are meant to be\r\n   * displayed in the flyout.\r\n   *\r\n   * @returns The definition of items to be displayed in the flyout.\r\n   */\r\n  getContents(): FlyoutItemInfoArray | string;\r\n\r\n  /**\r\n   * Sets the current toolbox item as selected.\r\n   *\r\n   * @param _isSelected True if this category is selected, false otherwise.\r\n   */\r\n  setSelected(_isSelected: boolean): void;\r\n\r\n  /**\r\n   * Gets the HTML element that is clickable.\r\n   * The parent toolbox element receives clicks. The parent toolbox will add an\r\n   * ID to this element so it can pass the onClick event to the correct\r\n   * toolboxItem.\r\n   *\r\n   * @returns The HTML element that receives clicks.\r\n   */\r\n  getClickTarget(): Element;\r\n\r\n  /**\r\n   * Handles when the toolbox item is clicked.\r\n   *\r\n   * @param _e Click event to handle.\r\n   */\r\n  onClick(_e: Event): void;\r\n}\r\n\r\n/**\r\n * Type guard that checks whether an IToolboxItem is an ISelectableToolboxItem.\r\n */\r\nexport function isSelectableToolboxItem(\r\n  toolboxItem: IToolboxItem,\r\n): toolboxItem is ISelectableToolboxItem {\r\n  return toolboxItem.isSelectable();\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2011 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly\r\n\r\n// Unused import preserved for side-effects. Remove if unneeded.\r\nimport './events/events_block_create.js';\r\n// Unused import preserved for side-effects. Remove if unneeded.\r\nimport './events/workspace_events.js';\r\n// Unused import preserved for side-effects. Remove if unneeded.\r\nimport './events/events_ui_base.js';\r\n// Unused import preserved for side-effects. Remove if unneeded.\r\nimport './events/events_var_create.js';\r\n\r\nimport {Block} from './block.js';\r\nimport * as blockAnimations from './block_animations.js';\r\nimport {BlockDragger} from './block_dragger.js';\r\nimport {BlockSvg} from './block_svg.js';\r\nimport {BlocklyOptions} from './blockly_options.js';\r\nimport {Blocks} from './blocks.js';\r\nimport * as browserEvents from './browser_events.js';\r\nimport {Bubble} from './bubbles/bubble.js';\r\nimport * as bubbles from './bubbles.js';\r\nimport {BubbleDragger} from './bubble_dragger.js';\r\nimport * as bumpObjects from './bump_objects.js';\r\nimport * as clipboard from './clipboard.js';\r\nimport * as common from './common.js';\r\nimport {ComponentManager} from './component_manager.js';\r\nimport {config} from './config.js';\r\nimport {Connection} from './connection.js';\r\nimport {ConnectionChecker} from './connection_checker.js';\r\nimport {ConnectionDB} from './connection_db.js';\r\nimport {ConnectionType} from './connection_type.js';\r\nimport * as ContextMenu from './contextmenu.js';\r\nimport * as ContextMenuItems from './contextmenu_items.js';\r\nimport {ContextMenuRegistry} from './contextmenu_registry.js';\r\nimport * as Css from './css.js';\r\nimport {DeleteArea} from './delete_area.js';\r\nimport * as dialog from './dialog.js';\r\nimport {DragTarget} from './drag_target.js';\r\nimport * as dropDownDiv from './dropdowndiv.js';\r\nimport * as Events from './events/events.js';\r\nimport * as Extensions from './extensions.js';\r\nimport {\r\n  Field,\r\n  FieldConfig,\r\n  FieldValidator,\r\n  UnattachedFieldError,\r\n} from './field.js';\r\nimport {\r\n  FieldAngle,\r\n  FieldAngleConfig,\r\n  FieldAngleFromJsonConfig,\r\n  FieldAngleValidator,\r\n} from './field_angle.js';\r\nimport {\r\n  FieldCheckbox,\r\n  FieldCheckboxConfig,\r\n  FieldCheckboxFromJsonConfig,\r\n  FieldCheckboxValidator,\r\n} from './field_checkbox.js';\r\nimport {\r\n  FieldColour,\r\n  FieldColourConfig,\r\n  FieldColourFromJsonConfig,\r\n  FieldColourValidator,\r\n} from './field_colour.js';\r\nimport {\r\n  FieldDropdown,\r\n  FieldDropdownConfig,\r\n  FieldDropdownFromJsonConfig,\r\n  FieldDropdownValidator,\r\n  MenuGenerator,\r\n  MenuGeneratorFunction,\r\n  MenuOption,\r\n} from './field_dropdown.js';\r\nimport {\r\n  FieldImage,\r\n  FieldImageConfig,\r\n  FieldImageFromJsonConfig,\r\n} from './field_image.js';\r\nimport {\r\n  FieldLabel,\r\n  FieldLabelConfig,\r\n  FieldLabelFromJsonConfig,\r\n} from './field_label.js';\r\nimport {FieldLabelSerializable} from './field_label_serializable.js';\r\nimport {\r\n  FieldMultilineInput,\r\n  FieldMultilineInputConfig,\r\n  FieldMultilineInputFromJsonConfig,\r\n  FieldMultilineInputValidator,\r\n} from './field_multilineinput.js';\r\nimport {\r\n  FieldNumber,\r\n  FieldNumberConfig,\r\n  FieldNumberFromJsonConfig,\r\n  FieldNumberValidator,\r\n} from './field_number.js';\r\nimport * as fieldRegistry from './field_registry.js';\r\nimport {\r\n  FieldTextInput,\r\n  FieldTextInputConfig,\r\n  FieldTextInputFromJsonConfig,\r\n  FieldTextInputValidator,\r\n} from './field_textinput.js';\r\nimport {\r\n  FieldVariable,\r\n  FieldVariableConfig,\r\n  FieldVariableFromJsonConfig,\r\n  FieldVariableValidator,\r\n} from './field_variable.js';\r\nimport {Flyout} from './flyout_base.js';\r\nimport {FlyoutButton} from './flyout_button.js';\r\nimport {HorizontalFlyout} from './flyout_horizontal.js';\r\nimport {FlyoutMetricsManager} from './flyout_metrics_manager.js';\r\nimport {VerticalFlyout} from './flyout_vertical.js';\r\nimport {CodeGenerator} from './generator.js';\r\nimport {Gesture} from './gesture.js';\r\nimport {Grid} from './grid.js';\r\nimport * as icons from './icons.js';\r\nimport {inject} from './inject.js';\r\nimport {Align} from './inputs/align.js';\r\nimport {Input} from './inputs/input.js';\r\nimport {inputTypes} from './inputs/input_types.js';\r\nimport * as inputs from './inputs.js';\r\nimport {InsertionMarkerManager} from './insertion_marker_manager.js';\r\nimport {InsertionMarkerPreviewer} from './connection_previewers/insertion_marker_previewer.js';\r\nimport {IASTNodeLocation} from './interfaces/i_ast_node_location.js';\r\nimport {IASTNodeLocationSvg} from './interfaces/i_ast_node_location_svg.js';\r\nimport {IASTNodeLocationWithBlock} from './interfaces/i_ast_node_location_with_block.js';\r\nimport {IAutoHideable} from './interfaces/i_autohideable.js';\r\nimport {IBlockDragger} from './interfaces/i_block_dragger.js';\r\nimport {IBoundedElement} from './interfaces/i_bounded_element.js';\r\nimport {IBubble} from './interfaces/i_bubble.js';\r\nimport {ICollapsibleToolboxItem} from './interfaces/i_collapsible_toolbox_item.js';\r\nimport {IComponent} from './interfaces/i_component.js';\r\nimport {IConnectionChecker} from './interfaces/i_connection_checker.js';\r\nimport {IConnectionPreviewer} from './interfaces/i_connection_previewer.js';\r\nimport {IContextMenu} from './interfaces/i_contextmenu.js';\r\nimport {ICopyable, isCopyable} from './interfaces/i_copyable.js';\r\nimport {IDeletable} from './interfaces/i_deletable.js';\r\nimport {IDeleteArea} from './interfaces/i_delete_area.js';\r\nimport {IDragTarget} from './interfaces/i_drag_target.js';\r\nimport {IDraggable} from './interfaces/i_draggable.js';\r\nimport {IFlyout} from './interfaces/i_flyout.js';\r\nimport {IHasBubble, hasBubble} from './interfaces/i_has_bubble.js';\r\nimport {IIcon, isIcon} from './interfaces/i_icon.js';\r\nimport {IKeyboardAccessible} from './interfaces/i_keyboard_accessible.js';\r\nimport {IMetricsManager} from './interfaces/i_metrics_manager.js';\r\nimport {IMovable} from './interfaces/i_movable.js';\r\nimport {IObservable, isObservable} from './interfaces/i_observable.js';\r\nimport {IPaster, isPaster} from './interfaces/i_paster.js';\r\nimport {IPositionable} from './interfaces/i_positionable.js';\r\nimport {IRegistrable} from './interfaces/i_registrable.js';\r\nimport {ISelectable} from './interfaces/i_selectable.js';\r\nimport {ISelectableToolboxItem} from './interfaces/i_selectable_toolbox_item.js';\r\nimport {ISerializable, isSerializable} from './interfaces/i_serializable.js';\r\nimport {IStyleable} from './interfaces/i_styleable.js';\r\nimport {IToolbox} from './interfaces/i_toolbox.js';\r\nimport {IToolboxItem} from './interfaces/i_toolbox_item.js';\r\nimport {\r\n  IVariableBackedParameterModel,\r\n  isVariableBackedParameterModel,\r\n} from './interfaces/i_variable_backed_parameter_model.js';\r\nimport * as internalConstants from './internal_constants.js';\r\nimport {ASTNode} from './keyboard_nav/ast_node.js';\r\nimport {BasicCursor} from './keyboard_nav/basic_cursor.js';\r\nimport {Cursor} from './keyboard_nav/cursor.js';\r\nimport {Marker} from './keyboard_nav/marker.js';\r\nimport {TabNavigateCursor} from './keyboard_nav/tab_navigate_cursor.js';\r\nimport {MarkerManager} from './marker_manager.js';\r\nimport {Menu} from './menu.js';\r\nimport {MenuItem} from './menuitem.js';\r\nimport {MetricsManager} from './metrics_manager.js';\r\nimport {Msg, setLocale} from './msg.js';\r\nimport {MiniWorkspaceBubble} from './bubbles/mini_workspace_bubble.js';\r\nimport {Names} from './names.js';\r\nimport {Options} from './options.js';\r\nimport * as uiPosition from './positionable_helpers.js';\r\nimport * as Procedures from './procedures.js';\r\nimport * as registry from './registry.js';\r\nimport {RenderedConnection} from './rendered_connection.js';\r\nimport * as renderManagement from './render_management.js';\r\nimport * as blockRendering from './renderers/common/block_rendering.js';\r\nimport * as constants from './constants.js';\r\nimport * as geras from './renderers/geras/geras.js';\r\nimport * as minimalist from './renderers/minimalist/minimalist.js';\r\nimport * as thrasos from './renderers/thrasos/thrasos.js';\r\nimport * as zelos from './renderers/zelos/zelos.js';\r\nimport {Scrollbar} from './scrollbar.js';\r\nimport {ScrollbarPair} from './scrollbar_pair.js';\r\nimport * as serialization from './serialization.js';\r\nimport * as ShortcutItems from './shortcut_items.js';\r\nimport {ShortcutRegistry} from './shortcut_registry.js';\r\nimport {Theme} from './theme.js';\r\nimport * as Themes from './theme/themes.js';\r\nimport {ThemeManager} from './theme_manager.js';\r\nimport {ToolboxCategory} from './toolbox/category.js';\r\nimport {CollapsibleToolboxCategory} from './toolbox/collapsible_category.js';\r\nimport {ToolboxSeparator} from './toolbox/separator.js';\r\nimport {Toolbox} from './toolbox/toolbox.js';\r\nimport {ToolboxItem} from './toolbox/toolbox_item.js';\r\nimport * as Tooltip from './tooltip.js';\r\nimport * as Touch from './touch.js';\r\nimport {Trashcan} from './trashcan.js';\r\nimport * as utils from './utils.js';\r\nimport * as toolbox from './utils/toolbox.js';\r\nimport {VariableMap} from './variable_map.js';\r\nimport {VariableModel} from './variable_model.js';\r\nimport * as Variables from './variables.js';\r\nimport * as VariablesDynamic from './variables_dynamic.js';\r\nimport * as WidgetDiv from './widgetdiv.js';\r\nimport {Workspace} from './workspace.js';\r\nimport {WorkspaceAudio} from './workspace_audio.js';\r\nimport {WorkspaceComment} from './workspace_comment.js';\r\nimport {WorkspaceCommentSvg} from './workspace_comment_svg.js';\r\nimport {WorkspaceDragger} from './workspace_dragger.js';\r\nimport {WorkspaceSvg} from './workspace_svg.js';\r\nimport * as Xml from './xml.js';\r\nimport {ZoomControls} from './zoom_controls.js';\r\n\r\n/**\r\n * Blockly core version.\r\n * This constant is overridden by the build script (npm run build) to the value\r\n * of the version in package.json. This is done by the Closure Compiler in the\r\n * buildCompressed gulp task.\r\n * For local builds, you can pass --define='Blockly.VERSION=X.Y.Z' to the\r\n * compiler to override this constant.\r\n *\r\n * @define {string}\r\n */\r\nexport const VERSION = 'uncompiled';\r\n\r\n/*\r\n * Top-level functions and properties on the Blockly namespace.\r\n * These are used only in external code. Do not reference these\r\n * from internal code as importing from this file can cause circular\r\n * dependencies. Do not add new functions here. There is probably a better\r\n * namespace to put new functions on.\r\n */\r\n\r\n/*\r\n * Aliases for input alignments used in block defintions.\r\n */\r\n\r\n/**\r\n * @see Blockly.Input.Align.LEFT\r\n * @deprecated Use `Blockly.inputs.Align.LEFT`. To be removed in v11.\r\n */\r\nexport const ALIGN_LEFT = Align.LEFT;\r\n\r\n/**\r\n * @see Blockly.Input.Align.CENTRE\r\n * @deprecated Use `Blockly.inputs.Align.CENTER`. To be removed in v11.\r\n */\r\nexport const ALIGN_CENTRE = Align.CENTRE;\r\n\r\n/**\r\n * @see Blockly.Input.Align.RIGHT\r\n * @deprecated Use `Blockly.inputs.Align.RIGHT`. To be removed in v11.\r\n */\r\nexport const ALIGN_RIGHT = Align.RIGHT;\r\n/*\r\n * Aliases for constants used for connection and input types.\r\n */\r\n\r\n/**\r\n * @see ConnectionType.INPUT_VALUE\r\n */\r\nexport const INPUT_VALUE = ConnectionType.INPUT_VALUE;\r\n\r\n/**\r\n * @see ConnectionType.OUTPUT_VALUE\r\n */\r\nexport const OUTPUT_VALUE = ConnectionType.OUTPUT_VALUE;\r\n\r\n/**\r\n * @see ConnectionType.NEXT_STATEMENT\r\n */\r\nexport const NEXT_STATEMENT = ConnectionType.NEXT_STATEMENT;\r\n\r\n/**\r\n * @see ConnectionType.PREVIOUS_STATEMENT\r\n */\r\nexport const PREVIOUS_STATEMENT = ConnectionType.PREVIOUS_STATEMENT;\r\n\r\n/**\r\n * @see inputTypes.DUMMY_INPUT\r\n * @deprecated Use `Blockly.inputs.inputTypes.DUMMY`. To be removed in v11.\r\n */\r\nexport const DUMMY_INPUT = inputTypes.DUMMY;\r\n\r\n/** Aliases for toolbox positions. */\r\n\r\n/**\r\n * @see toolbox.Position.TOP\r\n */\r\nexport const TOOLBOX_AT_TOP = toolbox.Position.TOP;\r\n\r\n/**\r\n * @see toolbox.Position.BOTTOM\r\n */\r\nexport const TOOLBOX_AT_BOTTOM = toolbox.Position.BOTTOM;\r\n\r\n/**\r\n * @see toolbox.Position.LEFT\r\n */\r\nexport const TOOLBOX_AT_LEFT = toolbox.Position.LEFT;\r\n\r\n/**\r\n * @see toolbox.Position.RIGHT\r\n */\r\nexport const TOOLBOX_AT_RIGHT = toolbox.Position.RIGHT;\r\n\r\n/*\r\n * Other aliased functions.\r\n */\r\n\r\n/**\r\n * Size the SVG image to completely fill its container. Call this when the view\r\n * actually changes sizes (e.g. on a window resize/device orientation change).\r\n * See workspace.resizeContents to resize the workspace when the contents\r\n * change (e.g. when a block is added or removed).\r\n * Record the height/width of the SVG image.\r\n *\r\n * @param workspace Any workspace in the SVG.\r\n * @see Blockly.common.svgResize\r\n */\r\nexport const svgResize = common.svgResize;\r\n\r\n/**\r\n * Close tooltips, context menus, dropdown selections, etc.\r\n *\r\n * @param opt_onlyClosePopups Whether only popups should be closed.\r\n * @see Blockly.WorkspaceSvg.hideChaff\r\n */\r\nexport function hideChaff(opt_onlyClosePopups?: boolean) {\r\n  (common.getMainWorkspace() as WorkspaceSvg).hideChaff(opt_onlyClosePopups);\r\n}\r\n\r\n/**\r\n * Returns the main workspace.  Returns the last used main workspace (based on\r\n * focus).  Try not to use this function, particularly if there are multiple\r\n * Blockly instances on a page.\r\n *\r\n * @see Blockly.common.getMainWorkspace\r\n */\r\nexport const getMainWorkspace = common.getMainWorkspace;\r\n\r\n/**\r\n * Returns the currently selected copyable object.\r\n */\r\nexport const getSelected = common.getSelected;\r\n\r\n/**\r\n * Define blocks from an array of JSON block definitions, as might be generated\r\n * by the Blockly Developer Tools.\r\n *\r\n * @param jsonArray An array of JSON block definitions.\r\n * @see Blockly.common.defineBlocksWithJsonArray\r\n */\r\nexport const defineBlocksWithJsonArray = common.defineBlocksWithJsonArray;\r\n\r\n/**\r\n * Set the parent container.  This is the container element that the WidgetDiv,\r\n * dropDownDiv, and Tooltip are rendered into the first time `Blockly.inject`\r\n * is called.\r\n * This method is a NOP if called after the first `Blockly.inject`.\r\n *\r\n * @param container The container element.\r\n * @see Blockly.common.setParentContainer\r\n */\r\nexport const setParentContainer = common.setParentContainer;\r\n\r\n// Aliases to allow external code to access these values for legacy reasons.\r\nexport const COLLAPSE_CHARS = internalConstants.COLLAPSE_CHARS;\r\nexport const DRAG_STACK = internalConstants.DRAG_STACK;\r\nexport const OPPOSITE_TYPE = internalConstants.OPPOSITE_TYPE;\r\nexport const RENAME_VARIABLE_ID = internalConstants.RENAME_VARIABLE_ID;\r\nexport const DELETE_VARIABLE_ID = internalConstants.DELETE_VARIABLE_ID;\r\nexport const COLLAPSED_INPUT_NAME = constants.COLLAPSED_INPUT_NAME;\r\nexport const COLLAPSED_FIELD_NAME = constants.COLLAPSED_FIELD_NAME;\r\n\r\n/**\r\n * String for use in the \"custom\" attribute of a category in toolbox XML.\r\n * This string indicates that the category should be dynamically populated with\r\n * variable blocks.\r\n */\r\nexport const VARIABLE_CATEGORY_NAME: string = Variables.CATEGORY_NAME;\r\n\r\n/**\r\n * String for use in the \"custom\" attribute of a category in toolbox XML.\r\n * This string indicates that the category should be dynamically populated with\r\n * variable blocks.\r\n */\r\nexport const VARIABLE_DYNAMIC_CATEGORY_NAME: string =\r\n  VariablesDynamic.CATEGORY_NAME;\r\n/**\r\n * String for use in the \"custom\" attribute of a category in toolbox XML.\r\n * This string indicates that the category should be dynamically populated with\r\n * procedure blocks.\r\n */\r\nexport const PROCEDURE_CATEGORY_NAME: string = Procedures.CATEGORY_NAME;\r\n\r\n// Context for why we need to monkey-patch in these functions (internal):\r\n//   https://docs.google.com/document/d/1MbO0LEA-pAyx1ErGLJnyUqTLrcYTo-5zga9qplnxeXo/edit?usp=sharing&resourcekey=0-5h_32-i-dHwHjf_9KYEVKg\r\n\r\n// clang-format off\r\nWorkspace.prototype.newBlock = function (\r\n  prototypeName: string,\r\n  opt_id?: string,\r\n): Block {\r\n  return new Block(this, prototypeName, opt_id);\r\n};\r\n\r\nWorkspaceSvg.prototype.newBlock = function (\r\n  prototypeName: string,\r\n  opt_id?: string,\r\n): BlockSvg {\r\n  return new BlockSvg(this, prototypeName, opt_id);\r\n};\r\n\r\nWorkspaceSvg.newTrashcan = function (workspace: WorkspaceSvg): Trashcan {\r\n  return new Trashcan(workspace);\r\n};\r\n\r\nWorkspaceCommentSvg.prototype.showContextMenu = function (\r\n  this: WorkspaceCommentSvg,\r\n  e: Event,\r\n) {\r\n  if (this.workspace.options.readOnly) {\r\n    return;\r\n  }\r\n  const menuOptions = [];\r\n\r\n  if (this.isDeletable() && this.isMovable()) {\r\n    menuOptions.push(ContextMenu.commentDuplicateOption(this));\r\n    menuOptions.push(ContextMenu.commentDeleteOption(this));\r\n  }\r\n\r\n  ContextMenu.show(e, menuOptions, this.RTL);\r\n};\r\n\r\nMiniWorkspaceBubble.prototype.newWorkspaceSvg = function (\r\n  options: Options,\r\n): WorkspaceSvg {\r\n  return new WorkspaceSvg(options);\r\n};\r\n\r\nNames.prototype.populateProcedures = function (\r\n  this: Names,\r\n  workspace: Workspace,\r\n) {\r\n  const procedures = Procedures.allProcedures(workspace);\r\n  // Flatten the return vs no-return procedure lists.\r\n  const flattenedProcedures = procedures[0].concat(procedures[1]);\r\n  for (let i = 0; i < flattenedProcedures.length; i++) {\r\n    this.getName(flattenedProcedures[i][0], Names.NameType.PROCEDURE);\r\n  }\r\n};\r\n// clang-format on\r\n\r\n// Re-export submodules that no longer declareLegacyNamespace.\r\nexport {browserEvents};\r\nexport {ContextMenu};\r\nexport {ContextMenuItems};\r\nexport {Css};\r\nexport {Events};\r\nexport {Extensions};\r\nexport {Procedures};\r\nexport {Procedures as procedures};\r\nexport {ShortcutItems};\r\nexport {Themes};\r\nexport {Tooltip};\r\nexport {Touch};\r\nexport {Variables};\r\nexport {VariablesDynamic};\r\nexport {WidgetDiv};\r\nexport {Xml};\r\nexport {blockAnimations};\r\nexport {blockRendering};\r\nexport {bumpObjects};\r\nexport {clipboard};\r\nexport {common};\r\nexport {constants};\r\nexport {dialog};\r\nexport {fieldRegistry};\r\nexport {geras};\r\nexport {minimalist};\r\nexport {registry};\r\nexport {thrasos};\r\nexport {uiPosition};\r\nexport {utils};\r\nexport {zelos};\r\nexport {ASTNode};\r\nexport {BasicCursor};\r\nexport {Block};\r\nexport {BlocklyOptions};\r\nexport {BlockDragger};\r\nexport {BlockSvg};\r\nexport {Blocks};\r\nexport {bubbles};\r\n/** @deprecated Use Blockly.bubbles.Bubble instead. To be removed in v11. */\r\nexport {Bubble};\r\nexport {BubbleDragger};\r\nexport {CollapsibleToolboxCategory};\r\nexport {ComponentManager};\r\nexport {Connection};\r\nexport {ConnectionType};\r\nexport {ConnectionChecker};\r\nexport {ConnectionDB};\r\nexport {ContextMenuRegistry};\r\nexport {Cursor};\r\nexport {DeleteArea};\r\nexport {DragTarget};\r\nexport const DropDownDiv = dropDownDiv;\r\nexport {Field, FieldConfig, FieldValidator, UnattachedFieldError};\r\nexport {\r\n  FieldAngle,\r\n  FieldAngleConfig,\r\n  FieldAngleFromJsonConfig,\r\n  FieldAngleValidator,\r\n};\r\nexport {\r\n  FieldCheckbox,\r\n  FieldCheckboxConfig,\r\n  FieldCheckboxFromJsonConfig,\r\n  FieldCheckboxValidator,\r\n};\r\nexport {\r\n  FieldColour,\r\n  FieldColourConfig,\r\n  FieldColourFromJsonConfig,\r\n  FieldColourValidator,\r\n};\r\nexport {\r\n  FieldDropdown,\r\n  FieldDropdownConfig,\r\n  FieldDropdownFromJsonConfig,\r\n  FieldDropdownValidator,\r\n  MenuGenerator,\r\n  MenuGeneratorFunction,\r\n  MenuOption,\r\n};\r\nexport {FieldImage, FieldImageConfig, FieldImageFromJsonConfig};\r\nexport {FieldLabel, FieldLabelConfig, FieldLabelFromJsonConfig};\r\nexport {FieldLabelSerializable};\r\nexport {\r\n  FieldMultilineInput,\r\n  FieldMultilineInputConfig,\r\n  FieldMultilineInputFromJsonConfig,\r\n  FieldMultilineInputValidator,\r\n};\r\nexport {\r\n  FieldNumber,\r\n  FieldNumberConfig,\r\n  FieldNumberFromJsonConfig,\r\n  FieldNumberValidator,\r\n};\r\nexport {\r\n  FieldTextInput,\r\n  FieldTextInputConfig,\r\n  FieldTextInputFromJsonConfig,\r\n  FieldTextInputValidator,\r\n};\r\nexport {\r\n  FieldVariable,\r\n  FieldVariableConfig,\r\n  FieldVariableFromJsonConfig,\r\n  FieldVariableValidator,\r\n};\r\nexport {Flyout};\r\nexport {FlyoutButton};\r\nexport {FlyoutMetricsManager};\r\nexport {CodeGenerator};\r\nexport {CodeGenerator as Generator}; // Deprecated name, October 2022.\r\nexport {Gesture};\r\nexport {Grid};\r\nexport {HorizontalFlyout};\r\nexport {IASTNodeLocation};\r\nexport {IASTNodeLocationSvg};\r\nexport {IASTNodeLocationWithBlock};\r\nexport {IAutoHideable};\r\nexport {IBlockDragger};\r\nexport {IBoundedElement};\r\nexport {IBubble};\r\nexport {ICollapsibleToolboxItem};\r\nexport {IComponent};\r\nexport {IConnectionChecker};\r\nexport {IConnectionPreviewer};\r\nexport {IContextMenu};\r\nexport {icons};\r\nexport {ICopyable, isCopyable};\r\nexport {IDeletable};\r\nexport {IDeleteArea};\r\nexport {IDragTarget};\r\nexport {IDraggable};\r\nexport {IFlyout};\r\nexport {IHasBubble, hasBubble};\r\nexport {IIcon, isIcon};\r\nexport {IKeyboardAccessible};\r\nexport {IMetricsManager};\r\nexport {IMovable};\r\nexport {Input};\r\nexport {inputs};\r\nexport {InsertionMarkerManager};\r\nexport {InsertionMarkerPreviewer};\r\nexport {IObservable, isObservable};\r\nexport {IPaster, isPaster};\r\nexport {IPositionable};\r\nexport {IRegistrable};\r\nexport {ISelectable};\r\nexport {ISelectableToolboxItem};\r\nexport {ISerializable, isSerializable};\r\nexport {IStyleable};\r\nexport {IToolbox};\r\nexport {IToolboxItem};\r\nexport {IVariableBackedParameterModel, isVariableBackedParameterModel};\r\nexport {Marker};\r\nexport {MarkerManager};\r\nexport {Menu};\r\nexport {MenuItem};\r\nexport {MetricsManager};\r\nexport {Msg, setLocale};\r\nexport {Names};\r\nexport {Options};\r\nexport {RenderedConnection};\r\nexport {renderManagement};\r\nexport {Scrollbar};\r\nexport {ScrollbarPair};\r\nexport {ShortcutRegistry};\r\nexport {TabNavigateCursor};\r\nexport {Theme};\r\nexport {ThemeManager};\r\nexport {Toolbox};\r\nexport {ToolboxCategory};\r\nexport {ToolboxItem};\r\nexport {ToolboxSeparator};\r\nexport {Trashcan};\r\nexport {VariableMap};\r\nexport {VariableModel};\r\nexport {VerticalFlyout};\r\nexport {Workspace};\r\nexport {WorkspaceAudio};\r\nexport {WorkspaceComment};\r\nexport {WorkspaceCommentSvg};\r\nexport {WorkspaceDragger};\r\nexport {WorkspaceSvg};\r\nexport {ZoomControls};\r\nexport {config};\r\n/** @deprecated Use Blockly.ConnectionType instead. */\r\nexport const connectionTypes = ConnectionType;\r\nexport {inject};\r\n/** @deprecated Use Blockly.inputs.inputTypes instead. To be removed in v11. */\r\nexport {inputTypes};\r\nexport {serialization};\r\n","/**\r\n * @license\r\n * Copyright 2023 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/** @internal */\r\nexport interface IRenderedElement {\r\n  /**\r\n   * @returns The root SVG element of htis rendered element.\r\n   */\r\n  getSvgRoot(): SVGElement;\r\n}\r\n\r\n/**\r\n * @returns True if the given object is an IRenderedElement.\r\n *\r\n * @internal\r\n */\r\nexport function isRenderedElement(obj: any): obj is IRenderedElement {\r\n  return obj['getSvgRoot'] !== undefined;\r\n}\r\n",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"/**\r\n * @license\r\n * Copyright 2013 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.blocks\r\n\r\n/**\r\n * A block definition.  For now this very loose, but it can potentially\r\n * be refined e.g. by replacing this typedef with a class definition.\r\n */\r\nexport type BlockDefinition = AnyDuringMigration;\r\n\r\n/**\r\n * A mapping of block type names to block prototype objects.\r\n */\r\nexport const Blocks: {[key: string]: BlockDefinition} = Object.create(null);\r\n","/**\r\n * @license\r\n * Copyright 2018 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Abstract class for events fired as a result of actions in\r\n * Blockly's editor.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.Events.Abstract\r\n\r\nimport * as common from '../common.js';\r\nimport type {Workspace} from '../workspace.js';\r\n\r\nimport * as eventUtils from './utils.js';\r\n\r\n/**\r\n * Abstract class for an event.\r\n */\r\nexport abstract class Abstract {\r\n  /**\r\n   * Whether or not the event was constructed without necessary parameters\r\n   * (to be populated by fromJson).\r\n   */\r\n  abstract isBlank: boolean;\r\n\r\n  /** The workspace identifier for this event. */\r\n  workspaceId?: string = undefined;\r\n\r\n  /**\r\n   * An ID for the group of events this block is associated with.\r\n   *\r\n   * Groups define events that should be treated as an single action from the\r\n   * user's perspective, and should be undone together.\r\n   */\r\n  group: string;\r\n\r\n  /** Whether this event is undoable or not. */\r\n  recordUndo: boolean;\r\n\r\n  /** Whether or not the event is a UI event. */\r\n  isUiEvent = false;\r\n\r\n  /** Type of this event. */\r\n  type = '';\r\n\r\n  constructor() {\r\n    this.group = eventUtils.getGroup();\r\n    this.recordUndo = eventUtils.getRecordUndo();\r\n  }\r\n\r\n  /**\r\n   * Encode the event as JSON.\r\n   *\r\n   * @returns JSON representation.\r\n   */\r\n  toJson(): AbstractEventJson {\r\n    return {\r\n      'type': this.type,\r\n      'group': this.group,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Deserializes the JSON event.\r\n   *\r\n   * @param event The event to append new properties to. Should be a subclass\r\n   *     of Abstract (like all events), but we can't specify that due to the\r\n   *     fact that parameters to static methods in subclasses must be\r\n   *     supertypes of parameters to static methods in superclasses.\r\n   * @internal\r\n   */\r\n  static fromJson(\r\n    json: AbstractEventJson,\r\n    workspace: Workspace,\r\n    event: any,\r\n  ): Abstract {\r\n    event.isBlank = false;\r\n    event.group = json['group'] || '';\r\n    event.workspaceId = workspace.id;\r\n    return event;\r\n  }\r\n\r\n  /**\r\n   * Does this event record any change of state?\r\n   *\r\n   * @returns True if null, false if something changed.\r\n   */\r\n  isNull(): boolean {\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Run an event.\r\n   *\r\n   * @param _forward True if run forward, false if run backward (undo).\r\n   */\r\n  run(_forward: boolean) {\r\n    // Defined by subclasses. Cannot be abstract b/c UI events do /not/ define\r\n    // this.\r\n  }\r\n\r\n  /**\r\n   * Get workspace the event belongs to.\r\n   *\r\n   * @returns The workspace the event belongs to.\r\n   * @throws {Error} if workspace is null.\r\n   * @internal\r\n   */\r\n  getEventWorkspace_(): Workspace {\r\n    let workspace;\r\n    if (this.workspaceId) {\r\n      workspace = common.getWorkspaceById(this.workspaceId);\r\n    }\r\n    if (!workspace) {\r\n      throw Error(\r\n        'Workspace is null. Event must have been generated from real' +\r\n          ' Blockly events.',\r\n      );\r\n    }\r\n    return workspace;\r\n  }\r\n}\r\n\r\nexport interface AbstractEventJson {\r\n  type: string;\r\n  group: string;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Base class for events fired as a result of UI actions in\r\n * Blockly's editor.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.Events.UiBase\r\n\r\nimport {Abstract as AbstractEvent} from './events_abstract.js';\r\n\r\n/**\r\n * Base class for a UI event.\r\n * UI events are events that don't need to be sent over the wire for multi-user\r\n * editing to work (e.g. scrolling the workspace, zooming, opening toolbox\r\n * categories).\r\n * UI events do not undo or redo.\r\n */\r\nexport class UiBase extends AbstractEvent {\r\n  override isBlank = true;\r\n  override workspaceId: string;\r\n\r\n  // UI events do not undo or redo.\r\n  override recordUndo = false;\r\n\r\n  /** Whether or not the event is a UI event. */\r\n  override isUiEvent = true;\r\n\r\n  /**\r\n   * @param opt_workspaceId The workspace identifier for this event.\r\n   *    Undefined for a blank event.\r\n   */\r\n  constructor(opt_workspaceId?: string) {\r\n    super();\r\n\r\n    /** Whether or not the event is blank (to be populated by fromJson). */\r\n    this.isBlank = typeof opt_workspaceId === 'undefined';\r\n\r\n    /** The workspace identifier for this event. */\r\n    this.workspaceId = opt_workspaceId ? opt_workspaceId : '';\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Events fired as a result of UI click in Blockly's editor.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.Events.Click\r\n\r\nimport type {Block} from '../block.js';\r\nimport * as registry from '../registry.js';\r\nimport {AbstractEventJson} from './events_abstract.js';\r\n\r\nimport {UiBase} from './events_ui_base.js';\r\nimport * as eventUtils from './utils.js';\r\nimport {Workspace} from '../workspace.js';\r\n\r\n/**\r\n * Notifies listeners that ome blockly element was clicked.\r\n */\r\nexport class Click extends UiBase {\r\n  /** The ID of the block that was clicked, if a block was clicked. */\r\n  blockId?: string;\r\n\r\n  /**\r\n   * The type of element that was clicked; one of 'block', 'workspace',\r\n   * or 'zoom_controls'.\r\n   */\r\n  targetType?: ClickTarget;\r\n  override type = eventUtils.CLICK;\r\n\r\n  /**\r\n   * @param opt_block The affected block. Null for click events that do not have\r\n   *     an associated block (i.e. workspace click). Undefined for a blank\r\n   *     event.\r\n   * @param opt_workspaceId The workspace identifier for this event.\r\n   *    Not used if block is passed. Undefined for a blank event.\r\n   * @param opt_targetType The type of element targeted by this click event.\r\n   *     Undefined for a blank event.\r\n   */\r\n  constructor(\r\n    opt_block?: Block | null,\r\n    opt_workspaceId?: string | null,\r\n    opt_targetType?: ClickTarget,\r\n  ) {\r\n    let workspaceId = opt_block ? opt_block.workspace.id : opt_workspaceId;\r\n    if (workspaceId === null) {\r\n      workspaceId = undefined;\r\n    }\r\n    super(workspaceId);\r\n\r\n    this.blockId = opt_block ? opt_block.id : undefined;\r\n    this.targetType = opt_targetType;\r\n  }\r\n\r\n  /**\r\n   * Encode the event as JSON.\r\n   *\r\n   * @returns JSON representation.\r\n   */\r\n  override toJson(): ClickJson {\r\n    const json = super.toJson() as ClickJson;\r\n    if (!this.targetType) {\r\n      throw new Error(\r\n        'The click target type is undefined. Either pass a block to ' +\r\n          'the constructor, or call fromJson',\r\n      );\r\n    }\r\n    json['targetType'] = this.targetType;\r\n    json['blockId'] = this.blockId;\r\n    return json;\r\n  }\r\n\r\n  /**\r\n   * Deserializes the JSON event.\r\n   *\r\n   * @param event The event to append new properties to. Should be a subclass\r\n   *     of Click, but we can't specify that due to the fact that parameters to\r\n   *     static methods in subclasses must be supertypes of parameters to\r\n   *     static methods in superclasses.\r\n   * @internal\r\n   */\r\n  static fromJson(json: ClickJson, workspace: Workspace, event?: any): Click {\r\n    const newEvent = super.fromJson(\r\n      json,\r\n      workspace,\r\n      event ?? new Click(),\r\n    ) as Click;\r\n    newEvent.targetType = json['targetType'];\r\n    newEvent.blockId = json['blockId'];\r\n    return newEvent;\r\n  }\r\n}\r\n\r\nexport enum ClickTarget {\r\n  BLOCK = 'block',\r\n  WORKSPACE = 'workspace',\r\n  ZOOM_CONTROLS = 'zoom_controls',\r\n}\r\n\r\nexport interface ClickJson extends AbstractEventJson {\r\n  targetType: ClickTarget;\r\n  blockId?: string;\r\n}\r\n\r\nregistry.register(registry.Type.EVENT, eventUtils.CLICK, Click);\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.utils.userAgent\r\n\r\n/** The raw useragent string. */\r\nlet rawUserAgent: string;\r\n\r\nlet isJavaFx: boolean;\r\n\r\nlet isWebKit: boolean;\r\n\r\nlet isGecko: boolean;\r\n\r\nlet isAndroid: boolean;\r\n\r\nlet isIPad: boolean;\r\n\r\nlet isIPhone: boolean;\r\n\r\nlet isMac: boolean;\r\n\r\nlet isTablet: boolean;\r\n\r\nlet isMobile: boolean;\r\n\r\n(function (raw) {\r\n  rawUserAgent = raw;\r\n  const rawUpper = rawUserAgent.toUpperCase();\r\n  /**\r\n   * Case-insensitive test of whether name is in the useragent string.\r\n   *\r\n   * @param name Name to test.\r\n   * @returns True if name is present.\r\n   */\r\n  function has(name: string): boolean {\r\n    return rawUpper.indexOf(name.toUpperCase()) !== -1;\r\n  }\r\n\r\n  // Browsers.  Logic from:\r\n  // https://github.com/google/closure-library/blob/master/closure/goog/labs/useragent/browser.js\r\n  // Useragent for JavaFX:\r\n  // Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.44\r\n  //     (KHTML, like Gecko) JavaFX/8.0 Safari/537.44\r\n  isJavaFx = has('JavaFX');\r\n\r\n  // Engines.  Logic from:\r\n  // https://github.com/google/closure-library/blob/master/closure/goog/labs/useragent/engine.js\r\n  isWebKit = has('WebKit');\r\n  isGecko = has('Gecko') && !isWebKit;\r\n\r\n  // Platforms.  Logic from:\r\n  // https://github.com/google/closure-library/blob/master/closure/goog/labs/useragent/platform.js\r\n  // and\r\n  // https://github.com/google/closure-library/blob/master/closure/goog/labs/useragent/extra.js\r\n  isAndroid = has('Android');\r\n  const maxTouchPoints =\r\n    globalThis['navigator'] && globalThis['navigator']['maxTouchPoints'];\r\n  isIPad = has('iPad') || (has('Macintosh') && maxTouchPoints > 0);\r\n  isIPhone = has('iPhone') && !isIPad;\r\n  isMac = has('Macintosh');\r\n\r\n  // Devices.  Logic from:\r\n  // https://github.com/google/closure-library/blob/master/closure/goog/labs/useragent/device.js\r\n  isTablet = isIPad || (isAndroid && !has('Mobile')) || has('Silk');\r\n  isMobile = !isTablet && (isIPhone || isAndroid);\r\n})((globalThis['navigator'] && globalThis['navigator']['userAgent']) || '');\r\n\r\nexport const raw: string = rawUserAgent;\r\n\r\nexport const JavaFx: boolean = isJavaFx;\r\n\r\nexport const GECKO: boolean = isGecko;\r\n\r\nexport const ANDROID: boolean = isAndroid;\r\n\r\nexport const IPAD: boolean = isIPad;\r\n\r\nexport const IPHONE: boolean = isIPhone;\r\n\r\nexport const MAC: boolean = isMac;\r\n\r\nexport const MOBILE: boolean = isMobile;\r\n","/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Manager for all items registered with the workspace.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.ComponentManager\r\n\r\nimport type {IAutoHideable} from './interfaces/i_autohideable.js';\r\nimport type {IComponent} from './interfaces/i_component.js';\r\nimport type {IDeleteArea} from './interfaces/i_delete_area.js';\r\nimport type {IDragTarget} from './interfaces/i_drag_target.js';\r\nimport type {IPositionable} from './interfaces/i_positionable.js';\r\nimport * as arrayUtils from './utils/array.js';\r\n\r\nclass Capability<_T> {\r\n  static POSITIONABLE = new Capability<IPositionable>('positionable');\r\n  static DRAG_TARGET = new Capability<IDragTarget>('drag_target');\r\n  static DELETE_AREA = new Capability<IDeleteArea>('delete_area');\r\n  static AUTOHIDEABLE = new Capability<IAutoHideable>('autohideable');\r\n  private readonly name_: string;\r\n  /** @param name The name of the component capability. */\r\n  constructor(name: string) {\r\n    this.name_ = name;\r\n  }\r\n\r\n  /**\r\n   * Returns the name of the capability.\r\n   *\r\n   * @returns The name.\r\n   */\r\n  toString(): string {\r\n    return this.name_;\r\n  }\r\n}\r\n\r\n/**\r\n * Manager for all items registered with the workspace.\r\n */\r\nexport class ComponentManager {\r\n  static Capability = Capability;\r\n\r\n  /**\r\n   * A map of the components registered with the workspace, mapped to id.\r\n   */\r\n  private readonly componentData = new Map<string, ComponentDatum>();\r\n\r\n  /** A map of capabilities to component IDs. */\r\n  private readonly capabilityToComponentIds = new Map<string, string[]>();\r\n\r\n  /**\r\n   * Adds a component.\r\n   *\r\n   * @param componentInfo The data for the component to register.\r\n   * @param opt_allowOverrides True to prevent an error when overriding an\r\n   *     already registered item.\r\n   */\r\n  addComponent(componentInfo: ComponentDatum, opt_allowOverrides?: boolean) {\r\n    // Don't throw an error if opt_allowOverrides is true.\r\n    const id = componentInfo.component.id;\r\n    if (!opt_allowOverrides && this.componentData.has(id)) {\r\n      throw Error(\r\n        'Plugin \"' +\r\n          id +\r\n          '\" with capabilities \"' +\r\n          this.componentData.get(id)?.capabilities +\r\n          '\" already added.',\r\n      );\r\n    }\r\n    this.componentData.set(id, componentInfo);\r\n    const stringCapabilities = [];\r\n    for (let i = 0; i < componentInfo.capabilities.length; i++) {\r\n      const capability = String(componentInfo.capabilities[i]).toLowerCase();\r\n      stringCapabilities.push(capability);\r\n      if (!this.capabilityToComponentIds.has(capability)) {\r\n        this.capabilityToComponentIds.set(capability, [id]);\r\n      } else {\r\n        this.capabilityToComponentIds.get(capability)?.push(id);\r\n      }\r\n    }\r\n    this.componentData.get(id)!.capabilities = stringCapabilities;\r\n  }\r\n\r\n  /**\r\n   * Removes a component.\r\n   *\r\n   * @param id The ID of the component to remove.\r\n   */\r\n  removeComponent(id: string) {\r\n    const componentInfo = this.componentData.get(id);\r\n    if (!componentInfo) {\r\n      return;\r\n    }\r\n    for (let i = 0; i < componentInfo.capabilities.length; i++) {\r\n      const capability = String(componentInfo.capabilities[i]).toLowerCase();\r\n      arrayUtils.removeElem(this.capabilityToComponentIds.get(capability)!, id);\r\n    }\r\n    this.componentData.delete(id);\r\n  }\r\n\r\n  /**\r\n   * Adds a capability to a existing registered component.\r\n   *\r\n   * @param id The ID of the component to add the capability to.\r\n   * @param capability The capability to add.\r\n   */\r\n  addCapability<T>(id: string, capability: string | Capability<T>) {\r\n    if (!this.getComponent(id)) {\r\n      throw Error(\r\n        'Cannot add capability, \"' +\r\n          capability +\r\n          '\". Plugin \"' +\r\n          id +\r\n          '\" has not been added to the ComponentManager',\r\n      );\r\n    }\r\n    if (this.hasCapability(id, capability)) {\r\n      console.warn(\r\n        'Plugin \"' + id + 'already has capability \"' + capability + '\"',\r\n      );\r\n      return;\r\n    }\r\n    capability = `${capability}`.toLowerCase();\r\n    this.componentData.get(id)?.capabilities.push(capability);\r\n    this.capabilityToComponentIds.get(capability)?.push(id);\r\n  }\r\n\r\n  /**\r\n   * Removes a capability from an existing registered component.\r\n   *\r\n   * @param id The ID of the component to remove the capability from.\r\n   * @param capability The capability to remove.\r\n   */\r\n  removeCapability<T>(id: string, capability: string | Capability<T>) {\r\n    if (!this.getComponent(id)) {\r\n      throw Error(\r\n        'Cannot remove capability, \"' +\r\n          capability +\r\n          '\". Plugin \"' +\r\n          id +\r\n          '\" has not been added to the ComponentManager',\r\n      );\r\n    }\r\n    if (!this.hasCapability(id, capability)) {\r\n      console.warn(\r\n        'Plugin \"' +\r\n          id +\r\n          'doesn\\'t have capability \"' +\r\n          capability +\r\n          '\" to remove',\r\n      );\r\n      return;\r\n    }\r\n    capability = `${capability}`.toLowerCase();\r\n    arrayUtils.removeElem(this.componentData.get(id)!.capabilities, capability);\r\n    arrayUtils.removeElem(this.capabilityToComponentIds.get(capability)!, id);\r\n  }\r\n\r\n  /**\r\n   * Returns whether the component with this id has the specified capability.\r\n   *\r\n   * @param id The ID of the component to check.\r\n   * @param capability The capability to check for.\r\n   * @returns Whether the component has the capability.\r\n   */\r\n  hasCapability<T>(id: string, capability: string | Capability<T>): boolean {\r\n    capability = `${capability}`.toLowerCase();\r\n    return (\r\n      this.componentData.has(id) &&\r\n      this.componentData.get(id)!.capabilities.indexOf(capability) !== -1\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Gets the component with the given ID.\r\n   *\r\n   * @param id The ID of the component to get.\r\n   * @returns The component with the given name or undefined if not found.\r\n   */\r\n  getComponent(id: string): IComponent | undefined {\r\n    return this.componentData.get(id)?.component;\r\n  }\r\n\r\n  /**\r\n   * Gets all the components with the specified capability.\r\n   *\r\n   * @param capability The capability of the component.\r\n   * @param sorted Whether to return list ordered by weights.\r\n   * @returns The components that match the specified capability.\r\n   */\r\n  getComponents<T extends IComponent>(\r\n    capability: string | Capability<T>,\r\n    sorted: boolean,\r\n  ): T[] {\r\n    capability = `${capability}`.toLowerCase();\r\n    const componentIds = this.capabilityToComponentIds.get(capability);\r\n    if (!componentIds) {\r\n      return [];\r\n    }\r\n    const components: T[] = [];\r\n    if (sorted) {\r\n      const componentDataList: ComponentDatum[] = [];\r\n      componentIds.forEach((id) => {\r\n        componentDataList.push(this.componentData.get(id)!);\r\n      });\r\n      componentDataList.sort(function (a, b) {\r\n        return a.weight - b.weight;\r\n      });\r\n      componentDataList.forEach(function (componentDatum) {\r\n        components.push(componentDatum.component as T);\r\n      });\r\n    } else {\r\n      componentIds.forEach((id) => {\r\n        components.push(this.componentData.get(id)!.component as T);\r\n      });\r\n    }\r\n    return components;\r\n  }\r\n}\r\n\r\nexport namespace ComponentManager {\r\n  /** An object storing component information. */\r\n  export interface ComponentDatum {\r\n    component: IComponent;\r\n    capabilities: Array<string | Capability<IComponent>>;\r\n    weight: number;\r\n  }\r\n}\r\n\r\nexport type ComponentDatum = ComponentManager.ComponentDatum;\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Utility methods for coordinate manipulation.\r\n * These methods are not specific to Blockly, and could be factored out into\r\n * a JavaScript framework such as Closure.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.utils.Coordinate\r\n\r\n/**\r\n * Class for representing coordinates and positions.\r\n */\r\nexport class Coordinate {\r\n  /**\r\n   * @param x Left.\r\n   * @param y Top.\r\n   */\r\n  constructor(\r\n    public x: number,\r\n    public y: number,\r\n  ) {}\r\n\r\n  /**\r\n   * Creates a new copy of this coordinate.\r\n   *\r\n   * @returns A copy of this coordinate.\r\n   */\r\n  clone(): Coordinate {\r\n    return new Coordinate(this.x, this.y);\r\n  }\r\n\r\n  /**\r\n   * Scales this coordinate by the given scale factor.\r\n   *\r\n   * @param s The scale factor to use for both x and y dimensions.\r\n   * @returns This coordinate after scaling.\r\n   */\r\n  scale(s: number): Coordinate {\r\n    this.x *= s;\r\n    this.y *= s;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Translates this coordinate by the given offsets.\r\n   * respectively.\r\n   *\r\n   * @param tx The value to translate x by.\r\n   * @param ty The value to translate y by.\r\n   * @returns This coordinate after translating.\r\n   */\r\n  translate(tx: number, ty: number): Coordinate {\r\n    this.x += tx;\r\n    this.y += ty;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Compares coordinates for equality.\r\n   *\r\n   * @param a A Coordinate.\r\n   * @param b A Coordinate.\r\n   * @returns True iff the coordinates are equal, or if both are null.\r\n   */\r\n  static equals(a?: Coordinate | null, b?: Coordinate | null): boolean {\r\n    if (a === b) {\r\n      return true;\r\n    }\r\n    if (!a || !b) {\r\n      return false;\r\n    }\r\n    return a.x === b.x && a.y === b.y;\r\n  }\r\n\r\n  /**\r\n   * Returns the distance between two coordinates.\r\n   *\r\n   * @param a A Coordinate.\r\n   * @param b A Coordinate.\r\n   * @returns The distance between `a` and `b`.\r\n   */\r\n  static distance(a: Coordinate, b: Coordinate): number {\r\n    const dx = a.x - b.x;\r\n    const dy = a.y - b.y;\r\n    return Math.sqrt(dx * dx + dy * dy);\r\n  }\r\n\r\n  /**\r\n   * Returns the magnitude of a coordinate.\r\n   *\r\n   * @param a A Coordinate.\r\n   * @returns The distance between the origin and `a`.\r\n   */\r\n  static magnitude(a: Coordinate): number {\r\n    return Math.sqrt(a.x * a.x + a.y * a.y);\r\n  }\r\n\r\n  /**\r\n   * Returns the difference between two coordinates as a new\r\n   * Coordinate.\r\n   *\r\n   * @param a An x/y coordinate.\r\n   * @param b An x/y coordinate.\r\n   * @returns A Coordinate representing the difference between `a` and `b`.\r\n   */\r\n  static difference(\r\n    a: Coordinate | SVGPoint,\r\n    b: Coordinate | SVGPoint,\r\n  ): Coordinate {\r\n    return new Coordinate(a.x - b.x, a.y - b.y);\r\n  }\r\n\r\n  /**\r\n   * Returns the sum of two coordinates as a new Coordinate.\r\n   *\r\n   * @param a An x/y coordinate.\r\n   * @param b An x/y coordinate.\r\n   * @returns A Coordinate representing the sum of the two coordinates.\r\n   */\r\n  static sum(a: Coordinate | SVGPoint, b: Coordinate | SVGPoint): Coordinate {\r\n    return new Coordinate(a.x + b.x, a.y + b.y);\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Defines the Svg class. Its constants enumerate\r\n * all SVG tag names used by Blockly.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.utils.Svg\r\n\r\n/**\r\n * A name with the type of the SVG element stored in the generic.\r\n */\r\nexport class Svg<_T> {\r\n  /** @internal */\r\n  static ANIMATE = new Svg<SVGAnimateElement>('animate');\r\n  /** @internal */\r\n  static CIRCLE = new Svg<SVGCircleElement>('circle');\r\n  /** @internal */\r\n  static CLIPPATH = new Svg<SVGClipPathElement>('clipPath');\r\n  /** @internal */\r\n  static DEFS = new Svg<SVGDefsElement>('defs');\r\n  /** @internal */\r\n  static FECOMPOSITE = new Svg<SVGFECompositeElement>('feComposite');\r\n  /** @internal */\r\n  static FECOMPONENTTRANSFER = new Svg<SVGFEComponentTransferElement>(\r\n    'feComponentTransfer',\r\n  );\r\n  /** @internal */\r\n  static FEFLOOD = new Svg<SVGFEFloodElement>('feFlood');\r\n  /** @internal */\r\n  static FEFUNCA = new Svg<SVGFEFuncAElement>('feFuncA');\r\n  /** @internal */\r\n  static FEGAUSSIANBLUR = new Svg<SVGFEGaussianBlurElement>('feGaussianBlur');\r\n  /** @internal */\r\n  static FEPOINTLIGHT = new Svg<SVGFEPointLightElement>('fePointLight');\r\n  /** @internal */\r\n  static FESPECULARLIGHTING = new Svg<SVGFESpecularLightingElement>(\r\n    'feSpecularLighting',\r\n  );\r\n  /** @internal */\r\n  static FILTER = new Svg<SVGFilterElement>('filter');\r\n  /** @internal */\r\n  static FOREIGNOBJECT = new Svg<SVGForeignObjectElement>('foreignObject');\r\n  /** @internal */\r\n  static G = new Svg<SVGGElement>('g');\r\n  /** @internal */\r\n  static IMAGE = new Svg<SVGImageElement>('image');\r\n  /** @internal */\r\n  static LINE = new Svg<SVGLineElement>('line');\r\n  /** @internal */\r\n  static PATH = new Svg<SVGPathElement>('path');\r\n  /** @internal */\r\n  static PATTERN = new Svg<SVGPatternElement>('pattern');\r\n  /** @internal */\r\n  static POLYGON = new Svg<SVGPolygonElement>('polygon');\r\n  /** @internal */\r\n  static RECT = new Svg<SVGRectElement>('rect');\r\n  /** @internal */\r\n  static SVG = new Svg<SVGSVGElement>('svg');\r\n  /** @internal */\r\n  static TEXT = new Svg<SVGTextElement>('text');\r\n  /** @internal */\r\n  static TSPAN = new Svg<SVGTSpanElement>('tspan');\r\n\r\n  /**\r\n   * @param tagName The SVG element tag name.\r\n   * @internal\r\n   */\r\n  constructor(private readonly tagName: string) {}\r\n\r\n  /**\r\n   * Returns the SVG element tag name.\r\n   *\r\n   * @returns The name.\r\n   */\r\n  toString(): string {\r\n    return this.tagName;\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Utility methods for rectangle manipulation.\r\n * These methods are not specific to Blockly, and could be factored out into\r\n * a JavaScript framework such as Closure.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.utils.Rect\r\n\r\n/**\r\n * Class for representing rectangular regions.\r\n */\r\nexport class Rect {\r\n  /**\r\n   * @param top Top.\r\n   * @param bottom Bottom.\r\n   * @param left Left.\r\n   * @param right Right.\r\n   */\r\n  constructor(\r\n    public top: number,\r\n    public bottom: number,\r\n    public left: number,\r\n    public right: number,\r\n  ) {}\r\n\r\n  getHeight(): number {\r\n    return this.bottom - this.top;\r\n  }\r\n\r\n  getWidth(): number {\r\n    return this.right - this.left;\r\n  }\r\n\r\n  /**\r\n   * Tests whether this rectangle contains a x/y coordinate.\r\n   *\r\n   * @param x The x coordinate to test for containment.\r\n   * @param y The y coordinate to test for containment.\r\n   * @returns Whether this rectangle contains given coordinate.\r\n   */\r\n  contains(x: number, y: number): boolean {\r\n    return (\r\n      x >= this.left && x <= this.right && y >= this.top && y <= this.bottom\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Tests whether this rectangle intersects the provided rectangle.\r\n   * Assumes that the coordinate system increases going down and left.\r\n   *\r\n   * @param other The other rectangle to check for intersection with.\r\n   * @returns Whether this rectangle intersects the provided rectangle.\r\n   */\r\n  intersects(other: Rect): boolean {\r\n    return !(\r\n      this.left > other.right ||\r\n      this.right < other.left ||\r\n      this.top > other.bottom ||\r\n      this.bottom < other.top\r\n    );\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Utility methods for size calculation.\r\n * These methods are not specific to Blockly, and could be factored out into\r\n * a JavaScript framework such as Closure.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.utils.Size\r\n\r\n/**\r\n * Class for representing sizes consisting of a width and height.\r\n */\r\nexport class Size {\r\n  /**\r\n   * @param width Width.\r\n   * @param height Height.\r\n   */\r\n  constructor(\r\n    public width: number,\r\n    public height: number,\r\n  ) {}\r\n\r\n  /**\r\n   * Compares sizes for equality.\r\n   *\r\n   * @param a A Size.\r\n   * @param b A Size.\r\n   * @returns True iff the sizes have equal widths and equal heights, or if both\r\n   *     are null.\r\n   */\r\n  static equals(a: Size | null, b: Size | null): boolean {\r\n    if (a === b) {\r\n      return true;\r\n    }\r\n    if (!a || !b) {\r\n      return false;\r\n    }\r\n    return a.width === b.width && a.height === b.height;\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2011 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Object representing a scrollbar.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.Scrollbar\r\n\r\nimport * as browserEvents from './browser_events.js';\r\nimport * as Touch from './touch.js';\r\nimport {Coordinate} from './utils/coordinate.js';\r\nimport * as dom from './utils/dom.js';\r\nimport type {Metrics} from './utils/metrics.js';\r\nimport {Svg} from './utils/svg.js';\r\nimport * as svgMath from './utils/svg_math.js';\r\nimport type {WorkspaceSvg} from './workspace_svg.js';\r\n\r\n/**\r\n * A note on units: most of the numbers that are in CSS pixels are scaled if the\r\n * scrollbar is in a mutator.\r\n */\r\n\r\n/**\r\n * Class for a pure SVG scrollbar.\r\n * This technique offers a scrollbar that is guaranteed to work, but may not\r\n * look or behave like the system's scrollbars.\r\n */\r\nexport class Scrollbar {\r\n  /**\r\n   * Width of vertical scrollbar or height of horizontal scrollbar in CSS\r\n   * pixels. Scrollbars should be larger on touch devices.\r\n   */\r\n  static scrollbarThickness = Touch.TOUCH_ENABLED ? 25 : 15;\r\n\r\n  /**\r\n   * Default margin around the scrollbar (between the scrollbar and the edge of\r\n   * the viewport in pixels).\r\n   *\r\n   * @internal\r\n   */\r\n  static readonly DEFAULT_SCROLLBAR_MARGIN = 0.5;\r\n\r\n  /** Whether this scrollbar is part of a pair. */\r\n  private readonly pair: boolean;\r\n\r\n  /**\r\n   * Margin around the scrollbar (between the scrollbar and the edge of the\r\n   * viewport in pixels).\r\n   */\r\n  private readonly margin: number;\r\n\r\n  /** Previously recorded metrics from the workspace. */\r\n  private oldHostMetrics: Metrics | null = null;\r\n\r\n  /**\r\n   * The ratio of handle position offset to workspace content displacement.\r\n   *\r\n   * @internal\r\n   */\r\n  ratio = 1;\r\n\r\n  /**\r\n   * The location of the origin of the workspace that the scrollbar is in,\r\n   * measured in CSS pixels relative to the injection div origin.  This is\r\n   * usually (0, 0).  When the scrollbar is in a flyout it may have a\r\n   * different origin.\r\n   */\r\n  private origin = new Coordinate(0, 0);\r\n\r\n  /**\r\n   * The position of the mouse along this scrollbar's major axis at the start\r\n   * of the most recent drag. Units are CSS pixels, with (0, 0) at the top\r\n   * left of the browser window. For a horizontal scrollbar this is the x\r\n   * coordinate of the mouse down event; for a vertical scrollbar it's the y\r\n   * coordinate of the mouse down event.\r\n   */\r\n  private startDragMouse = 0;\r\n\r\n  /**\r\n   * The length of the scrollbars (including the handle and the background),\r\n   * in CSS pixels. This is equivalent to scrollbar background length and the\r\n   * area within which the scrollbar handle can move.\r\n   */\r\n  private scrollbarLength = 0;\r\n\r\n  /** The length of the scrollbar handle in CSS pixels. */\r\n  private handleLength = 0;\r\n\r\n  /**\r\n   * The offset of the start of the handle from the scrollbar position, in CSS\r\n   * pixels.\r\n   */\r\n  private handlePosition = 0;\r\n\r\n  private startDragHandle = 0;\r\n\r\n  /** Whether the scrollbar handle is visible. */\r\n  private isHandleVisible = true;\r\n\r\n  /** Whether the workspace containing this scrollbar is visible. */\r\n  private containerVisible = true;\r\n\r\n  /** The transparent background behind the handle. */\r\n  private svgBackground: SVGRectElement;\r\n\r\n  /** The visible handle that can be dragged around. */\r\n  private svgHandle: SVGRectElement;\r\n\r\n  /** The outermost SVG element, which contains all parts of the scrollbar. */\r\n  private outerSvg: SVGSVGElement;\r\n\r\n  /**\r\n   * The upper left corner of the scrollbar's SVG group in CSS pixels relative\r\n   * to the scrollbar's origin.  This is usually relative to the injection div\r\n   * origin.\r\n   *\r\n   * @internal\r\n   */\r\n  position = new Coordinate(0, 0);\r\n\r\n  /**\r\n   * The DOM attribute that controls the length of the scrollbar. Different\r\n   * for horizontal and vertical scrollbars.\r\n   */\r\n  lengthAttribute_: string;\r\n\r\n  /**\r\n   * The DOM attribute that controls the position of the scrollbar.\r\n   * Different for horizontal and vertical scrollbars.\r\n   */\r\n  positionAttribute_: string;\r\n\r\n  /** Handler for mouse down events on the background of the scrollbar. */\r\n  onMouseDownBarWrapper_: browserEvents.Data;\r\n\r\n  /** Handler for mouse down events on the handle of the scrollbar. */\r\n  onMouseDownHandleWrapper_: browserEvents.Data;\r\n\r\n  /** Handler for mouse move events during scrollbar drags. */\r\n  onMouseUpWrapper_: browserEvents.Data | null = null;\r\n\r\n  /** Handler for mouse up events to end scrollbar drags. */\r\n  onMouseMoveWrapper_: browserEvents.Data | null = null;\r\n\r\n  /**\r\n   * @param workspace Workspace to bind the scrollbar to.\r\n   * @param horizontal True if horizontal, false if vertical.\r\n   * @param opt_pair True if scrollbar is part of a horiz/vert pair.\r\n   * @param opt_class A class to be applied to this scrollbar.\r\n   * @param opt_margin The margin to apply to this scrollbar.\r\n   */\r\n  constructor(\r\n    private workspace: WorkspaceSvg,\r\n    private readonly horizontal: boolean,\r\n    opt_pair?: boolean,\r\n    opt_class?: string,\r\n    opt_margin?: number,\r\n  ) {\r\n    this.pair = opt_pair || false;\r\n\r\n    this.margin =\r\n      opt_margin !== undefined\r\n        ? opt_margin\r\n        : Scrollbar.DEFAULT_SCROLLBAR_MARGIN;\r\n\r\n    let className =\r\n      'blocklyScrollbar' + (this.horizontal ? 'Horizontal' : 'Vertical');\r\n    if (opt_class) {\r\n      className += ' ' + opt_class;\r\n    }\r\n\r\n    /* Create the following DOM:\r\n      <svg class=\"blocklyScrollbarHorizontal optionalClass\">\r\n        <g>\r\n          <rect class=\"blocklyScrollbarBackground\" />\r\n          <rect class=\"blocklyScrollbarHandle\" rx=\"8\" ry=\"8\" />\r\n        </g>\r\n      </svg>\r\n    */\r\n    this.outerSvg = dom.createSvgElement(Svg.SVG, {'class': className});\r\n    // Child group to hold the handle and background together.\r\n    const group = dom.createSvgElement(Svg.G, {}, this.outerSvg);\r\n\r\n    this.svgBackground = dom.createSvgElement(\r\n      Svg.RECT,\r\n      {'class': 'blocklyScrollbarBackground'},\r\n      group,\r\n    );\r\n\r\n    const radius = Math.floor((Scrollbar.scrollbarThickness - 5) / 2);\r\n    this.svgHandle = dom.createSvgElement(\r\n      Svg.RECT,\r\n      {'class': 'blocklyScrollbarHandle', 'rx': radius, 'ry': radius},\r\n      group,\r\n    );\r\n\r\n    this.workspace\r\n      .getThemeManager()\r\n      .subscribe(this.svgHandle, 'scrollbarColour', 'fill');\r\n    this.workspace\r\n      .getThemeManager()\r\n      .subscribe(this.svgHandle, 'scrollbarOpacity', 'fill-opacity');\r\n\r\n    // Add everything to the DOM.\r\n    dom.insertAfter(this.outerSvg, this.workspace.getParentSvg());\r\n\r\n    this.setInitialThickness();\r\n\r\n    if (horizontal) {\r\n      this.lengthAttribute_ = 'width';\r\n      this.positionAttribute_ = 'x';\r\n    } else {\r\n      this.lengthAttribute_ = 'height';\r\n      this.positionAttribute_ = 'y';\r\n    }\r\n\r\n    this.onMouseDownBarWrapper_ = browserEvents.conditionalBind(\r\n      this.svgBackground,\r\n      'pointerdown',\r\n      this,\r\n      this.onMouseDownBar,\r\n    );\r\n    this.onMouseDownHandleWrapper_ = browserEvents.conditionalBind(\r\n      this.svgHandle,\r\n      'pointerdown',\r\n      this,\r\n      this.onMouseDownHandle,\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Set the size of the scrollbar DOM elements along the minor axis.\r\n   */\r\n  private setInitialThickness() {\r\n    const scrollbarThickness = Scrollbar.scrollbarThickness;\r\n    if (this.horizontal) {\r\n      this.svgBackground.setAttribute('height', String(scrollbarThickness));\r\n      this.outerSvg.setAttribute('height', String(scrollbarThickness));\r\n      this.svgHandle.setAttribute('height', String(scrollbarThickness - 5));\r\n      this.svgHandle.setAttribute('y', '2.5');\r\n    } else {\r\n      this.svgBackground.setAttribute('width', String(scrollbarThickness));\r\n      this.outerSvg.setAttribute('width', String(scrollbarThickness));\r\n      this.svgHandle.setAttribute('width', String(scrollbarThickness - 5));\r\n      this.svgHandle.setAttribute('x', '2.5');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Dispose of this scrollbar. Remove DOM elements, event listeners,\r\n   * and theme subscriptions.\r\n   */\r\n  dispose() {\r\n    this.cleanUp();\r\n    browserEvents.unbind(this.onMouseDownBarWrapper_);\r\n    browserEvents.unbind(this.onMouseDownHandleWrapper_);\r\n\r\n    dom.removeNode(this.outerSvg);\r\n    this.workspace.getThemeManager().unsubscribe(this.svgHandle);\r\n  }\r\n\r\n  /**\r\n   * Constrain the handle's length within the minimum (0) and maximum\r\n   * (scrollbar background) values allowed for the scrollbar.\r\n   *\r\n   * @param value Value that is potentially out of bounds, in CSS pixels.\r\n   * @returns Constrained value, in CSS pixels.\r\n   */\r\n  private constrainHandleLength(value: number): number {\r\n    if (value <= 0 || isNaN(value)) {\r\n      value = 0;\r\n    } else {\r\n      value = Math.min(value, this.scrollbarLength);\r\n    }\r\n    return value;\r\n  }\r\n\r\n  /**\r\n   * Set the length of the scrollbar's handle and change the SVG attribute\r\n   * accordingly.\r\n   *\r\n   * @param newLength The new scrollbar handle length in CSS pixels.\r\n   */\r\n  private setHandleLength(newLength: number) {\r\n    this.handleLength = newLength;\r\n    this.svgHandle.setAttribute(\r\n      this.lengthAttribute_,\r\n      String(this.handleLength),\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Constrain the handle's position within the minimum (0) and maximum values\r\n   * allowed for the scrollbar.\r\n   *\r\n   * @param value Value that is potentially out of bounds, in CSS pixels.\r\n   * @returns Constrained value, in CSS pixels.\r\n   */\r\n  private constrainHandlePosition(value: number): number {\r\n    if (value <= 0 || isNaN(value)) {\r\n      value = 0;\r\n    } else {\r\n      // Handle length should never be greater than this.scrollbarLength_.\r\n      // If the viewSize is greater than or equal to the scrollSize, the\r\n      // handleLength will end up equal to this.scrollbarLength_.\r\n      value = Math.min(value, this.scrollbarLength - this.handleLength);\r\n    }\r\n    return value;\r\n  }\r\n\r\n  /**\r\n   * Set the offset of the scrollbar's handle from the scrollbar's position, and\r\n   * change the SVG attribute accordingly.\r\n   *\r\n   * @param newPosition The new scrollbar handle offset in CSS pixels.\r\n   */\r\n  setHandlePosition(newPosition: number) {\r\n    this.handlePosition = newPosition;\r\n    this.svgHandle.setAttribute(\r\n      this.positionAttribute_,\r\n      String(this.handlePosition),\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Set the size of the scrollbar's background and change the SVG attribute\r\n   * accordingly.\r\n   *\r\n   * @param newSize The new scrollbar background length in CSS pixels.\r\n   */\r\n  private setScrollbarLength(newSize: number) {\r\n    this.scrollbarLength = newSize;\r\n    this.outerSvg.setAttribute(\r\n      this.lengthAttribute_,\r\n      String(this.scrollbarLength),\r\n    );\r\n    this.svgBackground.setAttribute(\r\n      this.lengthAttribute_,\r\n      String(this.scrollbarLength),\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Set the position of the scrollbar's SVG group in CSS pixels relative to the\r\n   * scrollbar's origin.  This sets the scrollbar's location within the\r\n   * workspace.\r\n   *\r\n   * @param x The new x coordinate.\r\n   * @param y The new y coordinate.\r\n   * @internal\r\n   */\r\n  setPosition(x: number, y: number) {\r\n    this.position.x = x;\r\n    this.position.y = y;\r\n\r\n    const tempX = this.position.x + this.origin.x;\r\n    const tempY = this.position.y + this.origin.y;\r\n    const transform = 'translate(' + tempX + 'px,' + tempY + 'px)';\r\n    dom.setCssTransform(this.outerSvg, transform);\r\n  }\r\n\r\n  /**\r\n   * Recalculate the scrollbar's location and its length.\r\n   *\r\n   * @param opt_metrics A data structure of from the describing all the required\r\n   *     dimensions.  If not provided, it will be fetched from the host object.\r\n   */\r\n  resize(opt_metrics?: Metrics) {\r\n    // Determine the location, height and width of the host element.\r\n    let hostMetrics = opt_metrics;\r\n    if (!hostMetrics) {\r\n      hostMetrics = this.workspace.getMetrics();\r\n      if (!hostMetrics) {\r\n        // Host element is likely not visible.\r\n        return;\r\n      }\r\n    }\r\n\r\n    if (\r\n      this.oldHostMetrics &&\r\n      Scrollbar.metricsAreEquivalent(hostMetrics, this.oldHostMetrics)\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    if (this.horizontal) {\r\n      this.resizeHorizontal(hostMetrics);\r\n    } else {\r\n      this.resizeVertical(hostMetrics);\r\n    }\r\n\r\n    this.oldHostMetrics = hostMetrics;\r\n\r\n    // Resizing may have caused some scrolling.\r\n    this.updateMetrics();\r\n  }\r\n\r\n  /**\r\n   * Returns whether the a resizeView is necessary by comparing the passed\r\n   * hostMetrics with cached old host metrics.\r\n   *\r\n   * @param hostMetrics A data structure describing all the required dimensions,\r\n   *     possibly fetched from the host object.\r\n   * @returns Whether a resizeView is necessary.\r\n   */\r\n  private requiresViewResize(hostMetrics: Metrics): boolean {\r\n    if (!this.oldHostMetrics) {\r\n      return true;\r\n    }\r\n    return (\r\n      this.oldHostMetrics.viewWidth !== hostMetrics.viewWidth ||\r\n      this.oldHostMetrics.viewHeight !== hostMetrics.viewHeight ||\r\n      this.oldHostMetrics.absoluteLeft !== hostMetrics.absoluteLeft ||\r\n      this.oldHostMetrics.absoluteTop !== hostMetrics.absoluteTop\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Recalculate a horizontal scrollbar's location and length.\r\n   *\r\n   * @param hostMetrics A data structure describing all the required dimensions,\r\n   *     possibly fetched from the host object.\r\n   */\r\n  private resizeHorizontal(hostMetrics: Metrics) {\r\n    if (this.requiresViewResize(hostMetrics)) {\r\n      this.resizeViewHorizontal(hostMetrics);\r\n    } else {\r\n      this.resizeContentHorizontal(hostMetrics);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Recalculate a horizontal scrollbar's location on the screen and path\r\n   * length. This should be called when the layout or size of the window has\r\n   * changed.\r\n   *\r\n   * @param hostMetrics A data structure describing all the required dimensions,\r\n   *     possibly fetched from the host object.\r\n   */\r\n  resizeViewHorizontal(hostMetrics: Metrics) {\r\n    let viewSize = hostMetrics.viewWidth - this.margin * 2;\r\n    if (this.pair) {\r\n      // Shorten the scrollbar to make room for the corner square.\r\n      viewSize -= Scrollbar.scrollbarThickness;\r\n    }\r\n    this.setScrollbarLength(Math.max(0, viewSize));\r\n\r\n    let xCoordinate = hostMetrics.absoluteLeft + this.margin;\r\n    if (this.pair && this.workspace.RTL) {\r\n      xCoordinate += Scrollbar.scrollbarThickness;\r\n    }\r\n\r\n    // Horizontal toolbar should always be just above the bottom of the\r\n    // workspace.\r\n    const yCoordinate =\r\n      hostMetrics.absoluteTop +\r\n      hostMetrics.viewHeight -\r\n      Scrollbar.scrollbarThickness -\r\n      this.margin;\r\n    this.setPosition(xCoordinate, yCoordinate);\r\n\r\n    // If the view has been resized, a content resize will also be necessary.\r\n    // The reverse is not true.\r\n    this.resizeContentHorizontal(hostMetrics);\r\n  }\r\n\r\n  /**\r\n   * Recalculate a horizontal scrollbar's location within its path and length.\r\n   * This should be called when the contents of the workspace have changed.\r\n   *\r\n   * @param hostMetrics A data structure describing all the required dimensions,\r\n   *     possibly fetched from the host object.\r\n   */\r\n  resizeContentHorizontal(hostMetrics: Metrics) {\r\n    if (hostMetrics.viewWidth >= hostMetrics.scrollWidth) {\r\n      // viewWidth is often greater than scrollWidth in flyouts and\r\n      // non-scrollable workspaces.\r\n      this.setHandleLength(this.scrollbarLength);\r\n      this.setHandlePosition(0);\r\n      if (!this.pair) {\r\n        // The scrollbar isn't needed.\r\n        // This doesn't apply to scrollbar pairs because interactions with the\r\n        // corner square aren't handled.\r\n        this.setVisible(false);\r\n      }\r\n      return;\r\n    } else if (!this.pair) {\r\n      // The scrollbar is needed. Only non-paired scrollbars are hidden/shown.\r\n      this.setVisible(true);\r\n    }\r\n\r\n    // Resize the handle.\r\n    let handleLength =\r\n      (this.scrollbarLength * hostMetrics.viewWidth) / hostMetrics.scrollWidth;\r\n    handleLength = this.constrainHandleLength(handleLength);\r\n    this.setHandleLength(handleLength);\r\n\r\n    // Compute the handle offset.\r\n    // The position of the handle can be between:\r\n    //     0 and this.scrollbarLength_ - handleLength\r\n    // If viewLeft === scrollLeft\r\n    //     then the offset should be 0\r\n    // If viewRight === scrollRight\r\n    //     then viewLeft = scrollLeft + scrollWidth - viewWidth\r\n    //     then the offset should be max offset\r\n\r\n    const maxScrollDistance = hostMetrics.scrollWidth - hostMetrics.viewWidth;\r\n    const contentDisplacement = hostMetrics.viewLeft - hostMetrics.scrollLeft;\r\n    // Percent of content to the left of our current position.\r\n    const offsetRatio = contentDisplacement / maxScrollDistance;\r\n    // Area available to scroll * percent to the left\r\n    const maxHandleOffset = this.scrollbarLength - this.handleLength;\r\n    let handleOffset = maxHandleOffset * offsetRatio;\r\n    handleOffset = this.constrainHandlePosition(handleOffset);\r\n    this.setHandlePosition(handleOffset);\r\n\r\n    // Compute ratio (for use with set calls, which pass in content\r\n    // displacement).\r\n    this.ratio = maxHandleOffset / maxScrollDistance;\r\n  }\r\n\r\n  /**\r\n   * Recalculate a vertical scrollbar's location and length.\r\n   *\r\n   * @param hostMetrics A data structure describing all the required dimensions,\r\n   *     possibly fetched from the host object.\r\n   */\r\n  private resizeVertical(hostMetrics: Metrics) {\r\n    if (this.requiresViewResize(hostMetrics)) {\r\n      this.resizeViewVertical(hostMetrics);\r\n    } else {\r\n      this.resizeContentVertical(hostMetrics);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Recalculate a vertical scrollbar's location on the screen and path length.\r\n   * This should be called when the layout or size of the window has changed.\r\n   *\r\n   * @param hostMetrics A data structure describing all the required dimensions,\r\n   *     possibly fetched from the host object.\r\n   */\r\n  resizeViewVertical(hostMetrics: Metrics) {\r\n    let viewSize = hostMetrics.viewHeight - this.margin * 2;\r\n    if (this.pair) {\r\n      // Shorten the scrollbar to make room for the corner square.\r\n      viewSize -= Scrollbar.scrollbarThickness;\r\n    }\r\n    this.setScrollbarLength(Math.max(0, viewSize));\r\n\r\n    const xCoordinate = this.workspace.RTL\r\n      ? hostMetrics.absoluteLeft + this.margin\r\n      : hostMetrics.absoluteLeft +\r\n        hostMetrics.viewWidth -\r\n        Scrollbar.scrollbarThickness -\r\n        this.margin;\r\n\r\n    const yCoordinate = hostMetrics.absoluteTop + this.margin;\r\n    this.setPosition(xCoordinate, yCoordinate);\r\n\r\n    // If the view has been resized, a content resize will also be necessary.\r\n    // The reverse is not true.\r\n    this.resizeContentVertical(hostMetrics);\r\n  }\r\n\r\n  /**\r\n   * Recalculate a vertical scrollbar's location within its path and length.\r\n   * This should be called when the contents of the workspace have changed.\r\n   *\r\n   * @param hostMetrics A data structure describing all the required dimensions,\r\n   *     possibly fetched from the host object.\r\n   */\r\n  resizeContentVertical(hostMetrics: Metrics) {\r\n    if (hostMetrics.viewHeight >= hostMetrics.scrollHeight) {\r\n      // viewHeight is often greater than scrollHeight in flyouts and\r\n      // non-scrollable workspaces.\r\n      this.setHandleLength(this.scrollbarLength);\r\n      this.setHandlePosition(0);\r\n      if (!this.pair) {\r\n        // The scrollbar isn't needed.\r\n        // This doesn't apply to scrollbar pairs because interactions with the\r\n        // corner square aren't handled.\r\n        this.setVisible(false);\r\n      }\r\n      return;\r\n    } else if (!this.pair) {\r\n      // The scrollbar is needed. Only non-paired scrollbars are hidden/shown.\r\n      this.setVisible(true);\r\n    }\r\n\r\n    // Resize the handle.\r\n    let handleLength =\r\n      (this.scrollbarLength * hostMetrics.viewHeight) /\r\n      hostMetrics.scrollHeight;\r\n    handleLength = this.constrainHandleLength(handleLength);\r\n    this.setHandleLength(handleLength);\r\n\r\n    // Compute the handle offset.\r\n    // The position of the handle can be between:\r\n    //     0 and this.scrollbarLength_ - handleLength\r\n    // If viewTop === scrollTop\r\n    //     then the offset should be 0\r\n    // If viewBottom === scrollBottom\r\n    //     then viewTop = scrollTop + scrollHeight - viewHeight\r\n    //     then the offset should be max offset\r\n\r\n    const maxScrollDistance = hostMetrics.scrollHeight - hostMetrics.viewHeight;\r\n    const contentDisplacement = hostMetrics.viewTop - hostMetrics.scrollTop;\r\n    // Percent of content to the left of our current position.\r\n    const offsetRatio = contentDisplacement / maxScrollDistance;\r\n    // Area available to scroll * percent to the left\r\n    const maxHandleOffset = this.scrollbarLength - this.handleLength;\r\n    let handleOffset = maxHandleOffset * offsetRatio;\r\n    handleOffset = this.constrainHandlePosition(handleOffset);\r\n    this.setHandlePosition(handleOffset);\r\n\r\n    // Compute ratio (for use with set calls, which pass in content\r\n    // displacement).\r\n    this.ratio = maxHandleOffset / maxScrollDistance;\r\n  }\r\n\r\n  /**\r\n   * Is the scrollbar visible.  Non-paired scrollbars disappear when they aren't\r\n   * needed.\r\n   *\r\n   * @returns True if visible.\r\n   */\r\n  isVisible(): boolean {\r\n    return this.isHandleVisible;\r\n  }\r\n\r\n  /**\r\n   * Set whether the scrollbar's container is visible and update\r\n   * display accordingly if visibility has changed.\r\n   *\r\n   * @param visible Whether the container is visible\r\n   */\r\n  setContainerVisible(visible: boolean) {\r\n    const visibilityChanged = visible !== this.containerVisible;\r\n\r\n    this.containerVisible = visible;\r\n    if (visibilityChanged) {\r\n      this.updateDisplay_();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set whether the scrollbar is visible.\r\n   * Only applies to non-paired scrollbars.\r\n   *\r\n   * @param visible True if visible.\r\n   */\r\n  setVisible(visible: boolean) {\r\n    // Ideally this would also apply to scrollbar pairs, but that's a bigger\r\n    // headache (due to interactions with the corner square), and the fact\r\n    // that telling the pair to resize itself would cause circular dependencies.\r\n    if (this.pair) {\r\n      throw Error('Unable to toggle visibility of paired scrollbars.');\r\n    }\r\n    this.setVisibleInternal(visible);\r\n  }\r\n\r\n  /**\r\n   * Set whether the scrollbar is visible. Bypasses checking whether this\r\n   * scrollbar is part of a pair so that it can be toggled by the scrollbar\r\n   * pair.\r\n   *\r\n   * @param visible True if visible.\r\n   * @internal\r\n   */\r\n  setVisibleInternal(visible: boolean) {\r\n    const visibilityChanged = visible !== this.isVisible();\r\n    this.isHandleVisible = visible;\r\n    if (visibilityChanged) {\r\n      this.updateDisplay_();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update visibility of scrollbar based on whether it thinks it should\r\n   * be visible and whether its containing workspace is visible.\r\n   * We cannot rely on the containing workspace being hidden to hide us\r\n   * because it is not necessarily our parent in the DOM.\r\n   */\r\n  updateDisplay_() {\r\n    let show = true;\r\n    // Check whether our parent/container is visible.\r\n    if (!this.containerVisible) {\r\n      show = false;\r\n    } else {\r\n      show = this.isVisible();\r\n    }\r\n    if (show) {\r\n      this.outerSvg.setAttribute('display', 'block');\r\n    } else {\r\n      this.outerSvg.setAttribute('display', 'none');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Scroll by one pageful.\r\n   * Called when scrollbar background is clicked.\r\n   *\r\n   * @param e Mouse down event.\r\n   */\r\n  private onMouseDownBar(e: MouseEvent) {\r\n    this.workspace.markFocused();\r\n    Touch.clearTouchIdentifier(); // This is really a click.\r\n    this.cleanUp();\r\n    if (browserEvents.isRightButton(e)) {\r\n      // Right-click.\r\n      // Scrollbars have no context menu.\r\n      e.stopPropagation();\r\n      return;\r\n    }\r\n    const mouseXY = browserEvents.mouseToSvg(\r\n      e,\r\n      this.workspace.getParentSvg(),\r\n      this.workspace.getInverseScreenCTM(),\r\n    );\r\n    const mouseLocation = this.horizontal ? mouseXY.x : mouseXY.y;\r\n\r\n    const handleXY = svgMath.getInjectionDivXY(this.svgHandle);\r\n    const handleStart = this.horizontal ? handleXY.x : handleXY.y;\r\n    let handlePosition = this.handlePosition;\r\n\r\n    const pageLength = this.handleLength * 0.95;\r\n    if (mouseLocation <= handleStart) {\r\n      // Decrease the scrollbar's value by a page.\r\n      handlePosition -= pageLength;\r\n    } else if (mouseLocation >= handleStart + this.handleLength) {\r\n      // Increase the scrollbar's value by a page.\r\n      handlePosition += pageLength;\r\n    }\r\n\r\n    this.setHandlePosition(this.constrainHandlePosition(handlePosition));\r\n\r\n    this.updateMetrics();\r\n    e.stopPropagation();\r\n    e.preventDefault();\r\n  }\r\n\r\n  /**\r\n   * Start a dragging operation.\r\n   * Called when scrollbar handle is clicked.\r\n   *\r\n   * @param e Mouse down event.\r\n   */\r\n  private onMouseDownHandle(e: PointerEvent) {\r\n    this.workspace.markFocused();\r\n    this.cleanUp();\r\n    if (browserEvents.isRightButton(e)) {\r\n      // Right-click.\r\n      // Scrollbars have no context menu.\r\n      e.stopPropagation();\r\n      return;\r\n    }\r\n    // Look up the current translation and record it.\r\n    this.startDragHandle = this.handlePosition;\r\n\r\n    // Record the current mouse position.\r\n    this.startDragMouse = this.horizontal ? e.clientX : e.clientY;\r\n    this.onMouseUpWrapper_ = browserEvents.conditionalBind(\r\n      document,\r\n      'pointerup',\r\n      this,\r\n      this.onMouseUpHandle,\r\n    );\r\n    this.onMouseMoveWrapper_ = browserEvents.conditionalBind(\r\n      document,\r\n      'pointermove',\r\n      this,\r\n      this.onMouseMoveHandle,\r\n    );\r\n    e.stopPropagation();\r\n    e.preventDefault();\r\n  }\r\n\r\n  /**\r\n   * Drag the scrollbar's handle.\r\n   *\r\n   * @param e Mouse move event.\r\n   */\r\n  private onMouseMoveHandle(e: PointerEvent) {\r\n    const currentMouse = this.horizontal ? e.clientX : e.clientY;\r\n    const mouseDelta = currentMouse - this.startDragMouse;\r\n    const handlePosition = this.startDragHandle + mouseDelta;\r\n    // Position the bar.\r\n    this.setHandlePosition(this.constrainHandlePosition(handlePosition));\r\n    this.updateMetrics();\r\n  }\r\n\r\n  /** Release the scrollbar handle and reset state accordingly. */\r\n  private onMouseUpHandle() {\r\n    Touch.clearTouchIdentifier();\r\n    this.cleanUp();\r\n  }\r\n\r\n  /**\r\n   * Hide chaff and stop binding to mouseup and mousemove events.  Call this to\r\n   * wrap up loose ends associated with the scrollbar.\r\n   */\r\n  private cleanUp() {\r\n    this.workspace.hideChaff(true);\r\n    if (this.onMouseUpWrapper_) {\r\n      browserEvents.unbind(this.onMouseUpWrapper_);\r\n      this.onMouseUpWrapper_ = null;\r\n    }\r\n    if (this.onMouseMoveWrapper_) {\r\n      browserEvents.unbind(this.onMouseMoveWrapper_);\r\n      this.onMouseMoveWrapper_ = null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Helper to calculate the ratio of handle position to scrollbar view size.\r\n   *\r\n   * @returns Ratio.\r\n   * @internal\r\n   */\r\n  getRatio_(): number {\r\n    const scrollHandleRange = this.scrollbarLength - this.handleLength;\r\n    let ratio = this.handlePosition / scrollHandleRange;\r\n    if (isNaN(ratio)) {\r\n      ratio = 0;\r\n    }\r\n    return ratio;\r\n  }\r\n\r\n  /**\r\n   * Updates workspace metrics based on new scroll ratio. Called when scrollbar\r\n   * is moved.\r\n   */\r\n  private updateMetrics() {\r\n    const ratio = this.getRatio_();\r\n    if (this.horizontal) {\r\n      this.workspace.setMetrics({x: ratio});\r\n    } else {\r\n      this.workspace.setMetrics({y: ratio});\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set the scrollbar handle's position.\r\n   *\r\n   * @param value The content displacement, relative to the view in pixels.\r\n   * @param updateMetrics Whether to update metrics on this set call.\r\n   *    Defaults to true.\r\n   */\r\n  set(value: number, updateMetrics?: boolean) {\r\n    this.setHandlePosition(this.constrainHandlePosition(value * this.ratio));\r\n    if (updateMetrics || updateMetrics === undefined) {\r\n      this.updateMetrics();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Record the origin of the workspace that the scrollbar is in, in pixels\r\n   * relative to the injection div origin. This is for times when the scrollbar\r\n   * is used in an object whose origin isn't the same as the main workspace\r\n   * (e.g. in a flyout.)\r\n   *\r\n   * @param x The x coordinate of the scrollbar's origin, in CSS pixels.\r\n   * @param y The y coordinate of the scrollbar's origin, in CSS pixels.\r\n   */\r\n  setOrigin(x: number, y: number) {\r\n    this.origin = new Coordinate(x, y);\r\n  }\r\n\r\n  /**\r\n   * @param first An object containing computed measurements of a workspace.\r\n   * @param second Another object containing computed measurements of a\r\n   *     workspace.\r\n   * @returns Whether the two sets of metrics are equivalent.\r\n   */\r\n  private static metricsAreEquivalent(\r\n    first: Metrics,\r\n    second: Metrics,\r\n  ): boolean {\r\n    return (\r\n      first.viewWidth === second.viewWidth &&\r\n      first.viewHeight === second.viewHeight &&\r\n      first.viewLeft === second.viewLeft &&\r\n      first.viewTop === second.viewTop &&\r\n      first.absoluteTop === second.absoluteTop &&\r\n      first.absoluteLeft === second.absoluteLeft &&\r\n      first.scrollWidth === second.scrollWidth &&\r\n      first.scrollHeight === second.scrollHeight &&\r\n      first.scrollLeft === second.scrollLeft &&\r\n      first.scrollTop === second.scrollTop\r\n    );\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2022 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Contains the path to a single png tat holds the images for the trashcan\r\n * as well as the zoom controls.\r\n */\r\nexport const SPRITE = {\r\n  width: 96,\r\n  height: 124,\r\n  url: 'sprites.png',\r\n};\r\n","/**\r\n * @license\r\n * Copyright 2015 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Object representing a zoom icons.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.ZoomControls\r\n\r\n// Unused import preserved for side-effects. Remove if unneeded.\r\nimport './events/events_click.js';\r\n\r\nimport * as browserEvents from './browser_events.js';\r\nimport {ComponentManager} from './component_manager.js';\r\nimport * as Css from './css.js';\r\nimport * as eventUtils from './events/utils.js';\r\nimport type {IPositionable} from './interfaces/i_positionable.js';\r\nimport type {UiMetrics} from './metrics_manager.js';\r\nimport * as uiPosition from './positionable_helpers.js';\r\nimport {SPRITE} from './sprites.js';\r\nimport * as Touch from './touch.js';\r\nimport * as dom from './utils/dom.js';\r\nimport {Rect} from './utils/rect.js';\r\nimport {Size} from './utils/size.js';\r\nimport {Svg} from './utils/svg.js';\r\nimport type {WorkspaceSvg} from './workspace_svg.js';\r\n\r\n/**\r\n * Class for a zoom controls.\r\n */\r\nexport class ZoomControls implements IPositionable {\r\n  /**\r\n   * The unique ID for this component that is used to register with the\r\n   * ComponentManager.\r\n   */\r\n  id = 'zoomControls';\r\n\r\n  /**\r\n   * Array holding info needed to unbind events.\r\n   * Used for disposing.\r\n   * Ex: [[node, name, func], [node, name, func]].\r\n   */\r\n  private boundEvents: browserEvents.Data[] = [];\r\n\r\n  /** The zoom in svg <g> element. */\r\n  private zoomInGroup: SVGGElement | null = null;\r\n\r\n  /** The zoom out svg <g> element. */\r\n  private zoomOutGroup: SVGGElement | null = null;\r\n\r\n  /** The zoom reset svg <g> element. */\r\n  private zoomResetGroup: SVGGElement | null = null;\r\n\r\n  /** Width of the zoom controls. */\r\n  private readonly WIDTH = 32;\r\n\r\n  /** Height of each zoom control. */\r\n  private readonly HEIGHT = 32;\r\n\r\n  /** Small spacing used between the zoom in and out control, in pixels. */\r\n  private readonly SMALL_SPACING = 2;\r\n\r\n  /**\r\n   * Large spacing used between the zoom in and reset control, in pixels.\r\n   */\r\n  private readonly LARGE_SPACING = 11;\r\n\r\n  /** Distance between zoom controls and bottom or top edge of workspace. */\r\n  private readonly MARGIN_VERTICAL = 20;\r\n\r\n  /** Distance between zoom controls and right or left edge of workspace. */\r\n  private readonly MARGIN_HORIZONTAL = 20;\r\n\r\n  /** The SVG group containing the zoom controls. */\r\n  private svgGroup: SVGElement | null = null;\r\n\r\n  /** Left coordinate of the zoom controls. */\r\n  private left = 0;\r\n\r\n  /** Top coordinate of the zoom controls. */\r\n  private top = 0;\r\n\r\n  /** Whether this has been initialized. */\r\n  private initialized = false;\r\n\r\n  /** @param workspace The workspace to sit in. */\r\n  constructor(private readonly workspace: WorkspaceSvg) {}\r\n\r\n  /**\r\n   * Create the zoom controls.\r\n   *\r\n   * @returns The zoom controls SVG group.\r\n   */\r\n  createDom(): SVGElement {\r\n    this.svgGroup = dom.createSvgElement(Svg.G, {});\r\n\r\n    // Each filter/pattern needs a unique ID for the case of multiple Blockly\r\n    // instances on a page.  Browser behaviour becomes undefined otherwise.\r\n    // https://neil.fraser.name/news/2015/11/01/\r\n    const rnd = String(Math.random()).substring(2);\r\n    this.createZoomOutSvg(rnd);\r\n    this.createZoomInSvg(rnd);\r\n    if (this.workspace.isMovable()) {\r\n      // If we zoom to the center and the workspace isn't movable we could\r\n      // loose blocks at the edges of the workspace.\r\n      this.createZoomResetSvg(rnd);\r\n    }\r\n    return this.svgGroup;\r\n  }\r\n\r\n  /** Initializes the zoom controls. */\r\n  init() {\r\n    this.workspace.getComponentManager().addComponent({\r\n      component: this,\r\n      weight: 2,\r\n      capabilities: [ComponentManager.Capability.POSITIONABLE],\r\n    });\r\n    this.initialized = true;\r\n  }\r\n\r\n  /**\r\n   * Disposes of this zoom controls.\r\n   * Unlink from all DOM elements to prevent memory leaks.\r\n   */\r\n  dispose() {\r\n    this.workspace.getComponentManager().removeComponent('zoomControls');\r\n    if (this.svgGroup) {\r\n      dom.removeNode(this.svgGroup);\r\n    }\r\n    for (const event of this.boundEvents) {\r\n      browserEvents.unbind(event);\r\n    }\r\n    this.boundEvents.length = 0;\r\n  }\r\n\r\n  /**\r\n   * Returns the bounding rectangle of the UI element in pixel units relative to\r\n   * the Blockly injection div.\r\n   *\r\n   * @returns The UI elements's bounding box. Null if bounding box should be\r\n   *     ignored by other UI elements.\r\n   */\r\n  getBoundingRectangle(): Rect | null {\r\n    let height = this.SMALL_SPACING + 2 * this.HEIGHT;\r\n    if (this.zoomResetGroup) {\r\n      height += this.LARGE_SPACING + this.HEIGHT;\r\n    }\r\n    const bottom = this.top + height;\r\n    const right = this.left + this.WIDTH;\r\n    return new Rect(this.top, bottom, this.left, right);\r\n  }\r\n\r\n  /**\r\n   * Positions the zoom controls.\r\n   * It is positioned in the opposite corner to the corner the\r\n   * categories/toolbox starts at.\r\n   *\r\n   * @param metrics The workspace metrics.\r\n   * @param savedPositions List of rectangles that are already on the workspace.\r\n   */\r\n  position(metrics: UiMetrics, savedPositions: Rect[]) {\r\n    // Not yet initialized.\r\n    if (!this.initialized) {\r\n      return;\r\n    }\r\n\r\n    const cornerPosition = uiPosition.getCornerOppositeToolbox(\r\n      this.workspace,\r\n      metrics,\r\n    );\r\n    let height = this.SMALL_SPACING + 2 * this.HEIGHT;\r\n    if (this.zoomResetGroup) {\r\n      height += this.LARGE_SPACING + this.HEIGHT;\r\n    }\r\n    const startRect = uiPosition.getStartPositionRect(\r\n      cornerPosition,\r\n      new Size(this.WIDTH, height),\r\n      this.MARGIN_HORIZONTAL,\r\n      this.MARGIN_VERTICAL,\r\n      metrics,\r\n      this.workspace,\r\n    );\r\n\r\n    const verticalPosition = cornerPosition.vertical;\r\n    const bumpDirection =\r\n      verticalPosition === uiPosition.verticalPosition.TOP\r\n        ? uiPosition.bumpDirection.DOWN\r\n        : uiPosition.bumpDirection.UP;\r\n    const positionRect = uiPosition.bumpPositionRect(\r\n      startRect,\r\n      this.MARGIN_VERTICAL,\r\n      bumpDirection,\r\n      savedPositions,\r\n    );\r\n\r\n    if (verticalPosition === uiPosition.verticalPosition.TOP) {\r\n      const zoomInTranslateY = this.SMALL_SPACING + this.HEIGHT;\r\n      this.zoomInGroup?.setAttribute(\r\n        'transform',\r\n        'translate(0, ' + zoomInTranslateY + ')',\r\n      );\r\n      if (this.zoomResetGroup) {\r\n        const zoomResetTranslateY =\r\n          zoomInTranslateY + this.LARGE_SPACING + this.HEIGHT;\r\n        this.zoomResetGroup.setAttribute(\r\n          'transform',\r\n          'translate(0, ' + zoomResetTranslateY + ')',\r\n        );\r\n      }\r\n    } else {\r\n      const zoomInTranslateY = this.zoomResetGroup\r\n        ? this.LARGE_SPACING + this.HEIGHT\r\n        : 0;\r\n      this.zoomInGroup?.setAttribute(\r\n        'transform',\r\n        'translate(0, ' + zoomInTranslateY + ')',\r\n      );\r\n      const zoomOutTranslateY =\r\n        zoomInTranslateY + this.SMALL_SPACING + this.HEIGHT;\r\n      this.zoomOutGroup?.setAttribute(\r\n        'transform',\r\n        'translate(0, ' + zoomOutTranslateY + ')',\r\n      );\r\n    }\r\n\r\n    this.top = positionRect.top;\r\n    this.left = positionRect.left;\r\n    this.svgGroup?.setAttribute(\r\n      'transform',\r\n      'translate(' + this.left + ',' + this.top + ')',\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Create the zoom in icon and its event handler.\r\n   *\r\n   * @param rnd The random string to use as a suffix in the clip path's ID.\r\n   *     These IDs must be unique in case there are multiple Blockly instances\r\n   *     on the same page.\r\n   */\r\n  private createZoomOutSvg(rnd: string) {\r\n    /* This markup will be generated and added to the .svgGroup:\r\n        <g class=\"blocklyZoom\">\r\n          <clipPath id=\"blocklyZoomoutClipPath837493\">\r\n            <rect width=\"32\" height=\"32></rect>\r\n          </clipPath>\r\n          <image width=\"96\" height=\"124\" x=\"-64\" y=\"-92\"\r\n        xlink:href=\"media/sprites.png\"\r\n              clip-path=\"url(#blocklyZoomoutClipPath837493)\"></image>\r\n        </g>\r\n        */\r\n    this.zoomOutGroup = dom.createSvgElement(\r\n      Svg.G,\r\n      {'class': 'blocklyZoom blocklyZoomOut'},\r\n      this.svgGroup,\r\n    );\r\n    const clip = dom.createSvgElement(\r\n      Svg.CLIPPATH,\r\n      {'id': 'blocklyZoomoutClipPath' + rnd},\r\n      this.zoomOutGroup,\r\n    );\r\n    dom.createSvgElement(\r\n      Svg.RECT,\r\n      {\r\n        'width': 32,\r\n        'height': 32,\r\n      },\r\n      clip,\r\n    );\r\n    const zoomoutSvg = dom.createSvgElement(\r\n      Svg.IMAGE,\r\n      {\r\n        'width': SPRITE.width,\r\n        'height': SPRITE.height,\r\n        'x': -64,\r\n        'y': -92,\r\n        'clip-path': 'url(#blocklyZoomoutClipPath' + rnd + ')',\r\n      },\r\n      this.zoomOutGroup,\r\n    );\r\n    zoomoutSvg.setAttributeNS(\r\n      dom.XLINK_NS,\r\n      'xlink:href',\r\n      this.workspace.options.pathToMedia + SPRITE.url,\r\n    );\r\n\r\n    // Attach listener.\r\n    this.boundEvents.push(\r\n      browserEvents.conditionalBind(\r\n        this.zoomOutGroup,\r\n        'pointerdown',\r\n        null,\r\n        this.zoom.bind(this, -1),\r\n      ),\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Create the zoom out icon and its event handler.\r\n   *\r\n   * @param rnd The random string to use as a suffix in the clip path's ID.\r\n   *     These IDs must be unique in case there are multiple Blockly instances\r\n   *     on the same page.\r\n   */\r\n  private createZoomInSvg(rnd: string) {\r\n    /* This markup will be generated and added to the .svgGroup:\r\n        <g class=\"blocklyZoom\">\r\n          <clipPath id=\"blocklyZoominClipPath837493\">\r\n            <rect width=\"32\" height=\"32\"></rect>\r\n          </clipPath>\r\n          <image width=\"96\" height=\"124\" x=\"-32\" y=\"-92\"\r\n        xlink:href=\"media/sprites.png\"\r\n              clip-path=\"url(#blocklyZoominClipPath837493)\"></image>\r\n        </g>\r\n        */\r\n    this.zoomInGroup = dom.createSvgElement(\r\n      Svg.G,\r\n      {'class': 'blocklyZoom blocklyZoomIn'},\r\n      this.svgGroup,\r\n    );\r\n    const clip = dom.createSvgElement(\r\n      Svg.CLIPPATH,\r\n      {'id': 'blocklyZoominClipPath' + rnd},\r\n      this.zoomInGroup,\r\n    );\r\n    dom.createSvgElement(\r\n      Svg.RECT,\r\n      {\r\n        'width': 32,\r\n        'height': 32,\r\n      },\r\n      clip,\r\n    );\r\n    const zoominSvg = dom.createSvgElement(\r\n      Svg.IMAGE,\r\n      {\r\n        'width': SPRITE.width,\r\n        'height': SPRITE.height,\r\n        'x': -32,\r\n        'y': -92,\r\n        'clip-path': 'url(#blocklyZoominClipPath' + rnd + ')',\r\n      },\r\n      this.zoomInGroup,\r\n    );\r\n    zoominSvg.setAttributeNS(\r\n      dom.XLINK_NS,\r\n      'xlink:href',\r\n      this.workspace.options.pathToMedia + SPRITE.url,\r\n    );\r\n\r\n    // Attach listener.\r\n    this.boundEvents.push(\r\n      browserEvents.conditionalBind(\r\n        this.zoomInGroup,\r\n        'pointerdown',\r\n        null,\r\n        this.zoom.bind(this, 1),\r\n      ),\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Handles a mouse down event on the zoom in or zoom out buttons on the\r\n   *    workspace.\r\n   *\r\n   * @param amount Amount of zooming. Negative amount values zoom out, and\r\n   *     positive amount values zoom in.\r\n   * @param e A mouse down event.\r\n   */\r\n  private zoom(amount: number, e: PointerEvent) {\r\n    this.workspace.markFocused();\r\n    this.workspace.zoomCenter(amount);\r\n    this.fireZoomEvent();\r\n    Touch.clearTouchIdentifier(); // Don't block future drags.\r\n    e.stopPropagation(); // Don't start a workspace scroll.\r\n    e.preventDefault(); // Stop double-clicking from selecting text.\r\n  }\r\n\r\n  /**\r\n   * Create the zoom reset icon and its event handler.\r\n   *\r\n   * @param rnd The random string to use as a suffix in the clip path's ID.\r\n   *     These IDs must be unique in case there are multiple Blockly instances\r\n   *     on the same page.\r\n   */\r\n  private createZoomResetSvg(rnd: string) {\r\n    /* This markup will be generated and added to the .svgGroup:\r\n        <g class=\"blocklyZoom\">\r\n          <clipPath id=\"blocklyZoomresetClipPath837493\">\r\n            <rect width=\"32\" height=\"32\"></rect>\r\n          </clipPath>\r\n          <image width=\"96\" height=\"124\" x=\"-32\" y=\"-92\"\r\n        xlink:href=\"media/sprites.png\"\r\n              clip-path=\"url(#blocklyZoomresetClipPath837493)\"></image>\r\n        </g>\r\n        */\r\n    this.zoomResetGroup = dom.createSvgElement(\r\n      Svg.G,\r\n      {'class': 'blocklyZoom blocklyZoomReset'},\r\n      this.svgGroup,\r\n    );\r\n    const clip = dom.createSvgElement(\r\n      Svg.CLIPPATH,\r\n      {'id': 'blocklyZoomresetClipPath' + rnd},\r\n      this.zoomResetGroup,\r\n    );\r\n    dom.createSvgElement(Svg.RECT, {'width': 32, 'height': 32}, clip);\r\n    const zoomresetSvg = dom.createSvgElement(\r\n      Svg.IMAGE,\r\n      {\r\n        'width': SPRITE.width,\r\n        'height': SPRITE.height,\r\n        'y': -92,\r\n        'clip-path': 'url(#blocklyZoomresetClipPath' + rnd + ')',\r\n      },\r\n      this.zoomResetGroup,\r\n    );\r\n    zoomresetSvg.setAttributeNS(\r\n      dom.XLINK_NS,\r\n      'xlink:href',\r\n      this.workspace.options.pathToMedia + SPRITE.url,\r\n    );\r\n\r\n    // Attach event listeners.\r\n    this.boundEvents.push(\r\n      browserEvents.conditionalBind(\r\n        this.zoomResetGroup,\r\n        'pointerdown',\r\n        null,\r\n        this.resetZoom.bind(this),\r\n      ),\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Handles a mouse down event on the reset zoom button on the workspace.\r\n   *\r\n   * @param e A mouse down event.\r\n   */\r\n  private resetZoom(e: PointerEvent) {\r\n    this.workspace.markFocused();\r\n\r\n    // zoom is passed amount and computes the new scale using the formula:\r\n    // targetScale = currentScale * Math.pow(speed, amount)\r\n    const targetScale = this.workspace.options.zoomOptions.startScale;\r\n    const currentScale = this.workspace.scale;\r\n    const speed = this.workspace.options.zoomOptions.scaleSpeed;\r\n    // To compute amount:\r\n    // amount = log(speed, (targetScale / currentScale))\r\n    // Math.log computes natural logarithm (ln), to change the base, use\r\n    // formula: log(base, value) = ln(value) / ln(base)\r\n    const amount = Math.log(targetScale / currentScale) / Math.log(speed);\r\n    this.workspace.beginCanvasTransition();\r\n    this.workspace.zoomCenter(amount);\r\n    this.workspace.scrollCenter();\r\n\r\n    setTimeout(this.workspace.endCanvasTransition.bind(this.workspace), 500);\r\n    this.fireZoomEvent();\r\n    Touch.clearTouchIdentifier(); // Don't block future drags.\r\n    e.stopPropagation(); // Don't start a workspace scroll.\r\n    e.preventDefault(); // Stop double-clicking from selecting text.\r\n  }\r\n\r\n  /** Fires a zoom control UI event. */\r\n  private fireZoomEvent() {\r\n    const uiEvent = new (eventUtils.get(eventUtils.CLICK))(\r\n      null,\r\n      this.workspace.id,\r\n      'zoom_controls',\r\n    );\r\n    eventUtils.fire(uiEvent);\r\n  }\r\n}\r\n\r\n/** CSS for zoom controls.  See css.js for use. */\r\nCss.register(`\r\n.blocklyZoom>image, .blocklyZoom>svg>image {\r\n  opacity: .4;\r\n}\r\n\r\n.blocklyZoom>image:hover, .blocklyZoom>svg>image:hover {\r\n  opacity: .6;\r\n}\r\n\r\n.blocklyZoom>image:active, .blocklyZoom>svg>image:active {\r\n  opacity: .8;\r\n}\r\n`);\r\n","/**\r\n * @license\r\n * Copyright 2023 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport {IIcon} from '../interfaces/i_icon.js';\r\nimport {CommentIcon} from './comment_icon.js';\r\nimport {MutatorIcon} from './mutator_icon.js';\r\nimport {WarningIcon} from './warning_icon.js';\r\n\r\n/**\r\n * Defines the type of an icon, so that it can be retrieved from block.getIcon\r\n */\r\nexport class IconType<_T extends IIcon> {\r\n  /** @param name The name of the registry type. */\r\n  constructor(private readonly name: string) {}\r\n\r\n  /** @returns the name of the type. */\r\n  toString(): string {\r\n    return this.name;\r\n  }\r\n\r\n  /** @returns true if this icon type is equivalent to the given icon type. */\r\n  equals(type: IconType<IIcon>): boolean {\r\n    return this.name === type.toString();\r\n  }\r\n\r\n  static MUTATOR = new IconType<MutatorIcon>('mutator');\r\n  static WARNING = new IconType<WarningIcon>('warning');\r\n  static COMMENT = new IconType<CommentIcon>('comment');\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.inputTypes\r\n\r\nimport {ConnectionType} from '../connection_type.js';\r\n\r\n/**\r\n * Enum for the type of a connection or input.\r\n */\r\nexport enum inputTypes {\r\n  // A right-facing value input.  E.g. 'set item to' or 'return'.\r\n  VALUE = ConnectionType.INPUT_VALUE,\r\n  // A down-facing block stack.  E.g. 'if-do' or 'else'.\r\n  STATEMENT = ConnectionType.NEXT_STATEMENT,\r\n  // A dummy input.  Used to add field(s) with no input.\r\n  DUMMY = 5,\r\n  // An unknown type of input defined by an external developer.\r\n  CUSTOM = 6,\r\n  // An input with no connections that is always the last input of a row. Any\r\n  // subsequent input will be rendered on the next row. Any newline character in\r\n  // a JSON block definition's message will be parsed as an end-row input.\r\n  END_ROW = 7,\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2013 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.Msg\r\n\r\n/** A dictionary of localised messages. */\r\nexport const Msg: {[key: string]: string} = Object.create(null);\r\n\r\n/**\r\n * Sets the locale (i.e. the localized messages/block-text/etc) to the given\r\n * locale.\r\n *\r\n * This is not useful/necessary when loading from a script tag, because the\r\n * messages are automatically cluged into the Blockly.Msg object. But we provide\r\n * it in both the script-tag and non-script-tag contexts so that the tscompiler\r\n * can properly create our type definition files.\r\n *\r\n * @param locale An object defining the messages for a given language.\r\n */\r\nexport const setLocale = function (locale: {[key: string]: string}) {\r\n  Object.keys(locale).forEach(function (k) {\r\n    Msg[k] = locale[k];\r\n  });\r\n};\r\n","/**\r\n * @license\r\n * Copyright 2018 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Abstract class for a variable event.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.Events.VarBase\r\n\r\nimport type {VariableModel} from '../variable_model.js';\r\n\r\nimport {\r\n  Abstract as AbstractEvent,\r\n  AbstractEventJson,\r\n} from './events_abstract.js';\r\nimport type {Workspace} from '../workspace.js';\r\n\r\n/**\r\n * Abstract class for a variable event.\r\n */\r\nexport class VarBase extends AbstractEvent {\r\n  override isBlank = true;\r\n  /** The ID of the variable this event references. */\r\n  varId?: string;\r\n\r\n  /**\r\n   * @param opt_variable The variable this event corresponds to.  Undefined for\r\n   *     a blank event.\r\n   */\r\n  constructor(opt_variable?: VariableModel) {\r\n    super();\r\n    this.isBlank = typeof opt_variable === 'undefined';\r\n    if (!opt_variable) return;\r\n\r\n    this.varId = opt_variable.getId();\r\n    this.workspaceId = opt_variable.workspace.id;\r\n  }\r\n\r\n  /**\r\n   * Encode the event as JSON.\r\n   *\r\n   * @returns JSON representation.\r\n   */\r\n  override toJson(): VarBaseJson {\r\n    const json = super.toJson() as VarBaseJson;\r\n    if (!this.varId) {\r\n      throw new Error(\r\n        'The var ID is undefined. Either pass a variable to ' +\r\n          'the constructor, or call fromJson',\r\n      );\r\n    }\r\n    json['varId'] = this.varId;\r\n    return json;\r\n  }\r\n\r\n  /**\r\n   * Deserializes the JSON event.\r\n   *\r\n   * @param event The event to append new properties to. Should be a subclass\r\n   *     of VarBase, but we can't specify that due to the fact that parameters\r\n   *     to static methods in subclasses must be supertypes of parameters to\r\n   *     static methods in superclasses.\r\n   * @internal\r\n   */\r\n  static fromJson(\r\n    json: VarBaseJson,\r\n    workspace: Workspace,\r\n    event?: any,\r\n  ): VarBase {\r\n    const newEvent = super.fromJson(\r\n      json,\r\n      workspace,\r\n      event ?? new VarBase(),\r\n    ) as VarBase;\r\n    newEvent.varId = json['varId'];\r\n    return newEvent;\r\n  }\r\n}\r\n\r\nexport interface VarBaseJson extends AbstractEventJson {\r\n  varId: string;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2018 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Class for a variable creation event.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.Events.VarCreate\r\n\r\nimport * as registry from '../registry.js';\r\nimport type {VariableModel} from '../variable_model.js';\r\n\r\nimport {VarBase, VarBaseJson} from './events_var_base.js';\r\nimport * as eventUtils from './utils.js';\r\nimport type {Workspace} from '../workspace.js';\r\n\r\n/**\r\n * Notifies listeners that a variable model has been created.\r\n */\r\nexport class VarCreate extends VarBase {\r\n  override type = eventUtils.VAR_CREATE;\r\n\r\n  /** The type of the variable that was created. */\r\n  varType?: string;\r\n\r\n  /** The name of the variable that was created. */\r\n  varName?: string;\r\n\r\n  /**\r\n   * @param opt_variable The created variable. Undefined for a blank event.\r\n   */\r\n  constructor(opt_variable?: VariableModel) {\r\n    super(opt_variable);\r\n\r\n    if (!opt_variable) {\r\n      return; // Blank event to be populated by fromJson.\r\n    }\r\n    this.varType = opt_variable.type;\r\n    this.varName = opt_variable.name;\r\n  }\r\n\r\n  /**\r\n   * Encode the event as JSON.\r\n   *\r\n   * @returns JSON representation.\r\n   */\r\n  override toJson(): VarCreateJson {\r\n    const json = super.toJson() as VarCreateJson;\r\n    if (this.varType === undefined) {\r\n      throw new Error(\r\n        'The var type is undefined. Either pass a variable to ' +\r\n          'the constructor, or call fromJson',\r\n      );\r\n    }\r\n    if (!this.varName) {\r\n      throw new Error(\r\n        'The var name is undefined. Either pass a variable to ' +\r\n          'the constructor, or call fromJson',\r\n      );\r\n    }\r\n    json['varType'] = this.varType;\r\n    json['varName'] = this.varName;\r\n    return json;\r\n  }\r\n\r\n  /**\r\n   * Deserializes the JSON event.\r\n   *\r\n   * @param event The event to append new properties to. Should be a subclass\r\n   *     of VarCreate, but we can't specify that due to the fact that parameters\r\n   *     to static methods in subclasses must be supertypes of parameters to\r\n   *     static methods in superclasses.\r\n   * @internal\r\n   */\r\n  static fromJson(\r\n    json: VarCreateJson,\r\n    workspace: Workspace,\r\n    event?: any,\r\n  ): VarCreate {\r\n    const newEvent = super.fromJson(\r\n      json,\r\n      workspace,\r\n      event ?? new VarCreate(),\r\n    ) as VarCreate;\r\n    newEvent.varType = json['varType'];\r\n    newEvent.varName = json['varName'];\r\n    return newEvent;\r\n  }\r\n\r\n  /**\r\n   * Run a variable creation event.\r\n   *\r\n   * @param forward True if run forward, false if run backward (undo).\r\n   */\r\n  override run(forward: boolean) {\r\n    const workspace = this.getEventWorkspace_();\r\n    if (!this.varId) {\r\n      throw new Error(\r\n        'The var ID is undefined. Either pass a variable to ' +\r\n          'the constructor, or call fromJson',\r\n      );\r\n    }\r\n    if (!this.varName) {\r\n      throw new Error(\r\n        'The var name is undefined. Either pass a variable to ' +\r\n          'the constructor, or call fromJson',\r\n      );\r\n    }\r\n    if (forward) {\r\n      workspace.createVariable(this.varName, this.varType, this.varId);\r\n    } else {\r\n      workspace.deleteVariableById(this.varId);\r\n    }\r\n  }\r\n}\r\n\r\nexport interface VarCreateJson extends VarBaseJson {\r\n  varType: string;\r\n  varName: string;\r\n}\r\n\r\nregistry.register(registry.Type.EVENT, eventUtils.VAR_CREATE, VarCreate);\r\n","/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Components for the variable model.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.VariableModel\r\n\r\n// Unused import preserved for side-effects. Remove if unneeded.\r\nimport './events/events_var_create.js';\r\n\r\nimport * as idGenerator from './utils/idgenerator.js';\r\nimport type {Workspace} from './workspace.js';\r\n\r\n/**\r\n * Class for a variable model.\r\n * Holds information for the variable including name, ID, and type.\r\n *\r\n * @see {Blockly.FieldVariable}\r\n */\r\nexport class VariableModel {\r\n  type: string;\r\n  private readonly id_: string;\r\n\r\n  /**\r\n   * @param workspace The variable's workspace.\r\n   * @param name The name of the variable.  This is the user-visible name (e.g.\r\n   *     'my var' or ''), not the generated name.\r\n   * @param opt_type The type of the variable like 'int' or 'string'.\r\n   *     Does not need to be unique. Field_variable can filter variables based\r\n   * on their type. This will default to '' which is a specific type.\r\n   * @param opt_id The unique ID of the variable. This will default to a UUID.\r\n   */\r\n  constructor(\r\n    public workspace: Workspace,\r\n    public name: string,\r\n    opt_type?: string,\r\n    opt_id?: string,\r\n  ) {\r\n    /**\r\n     * The type of the variable, such as 'int' or 'sound_effect'. This may be\r\n     * used to build a list of variables of a specific type. By default this is\r\n     * the empty string '', which is a specific type.\r\n     *\r\n     * @see {Blockly.FieldVariable}\r\n     */\r\n    this.type = opt_type || '';\r\n\r\n    /**\r\n     * A unique ID for the variable. This should be defined at creation and\r\n     * not change, even if the name changes. In most cases this should be a\r\n     * UUID.\r\n     */\r\n    this.id_ = opt_id || idGenerator.genUid();\r\n  }\r\n\r\n  /** @returns The ID for the variable. */\r\n  getId(): string {\r\n    return this.id_;\r\n  }\r\n\r\n  /**\r\n   * A custom compare function for the VariableModel objects.\r\n   *\r\n   * @param var1 First variable to compare.\r\n   * @param var2 Second variable to compare.\r\n   * @returns -1 if name of var1 is less than name of var2, 0 if equal, and 1 if\r\n   *     greater.\r\n   * @internal\r\n   */\r\n  static compareByName(var1: VariableModel, var2: VariableModel): number {\r\n    return var1.name.localeCompare(var2.name, undefined, {sensitivity: 'base'});\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Object representing a code comment on the workspace.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.WorkspaceComment\r\n\r\nimport type {CommentMove} from './events/events_comment_move.js';\r\nimport * as eventUtils from './events/utils.js';\r\nimport {Coordinate} from './utils/coordinate.js';\r\nimport * as idGenerator from './utils/idgenerator.js';\r\nimport * as xml from './utils/xml.js';\r\nimport type {Workspace} from './workspace.js';\r\n\r\n/**\r\n * Class for a workspace comment.\r\n */\r\nexport class WorkspaceComment {\r\n  id: string;\r\n  protected xy_: Coordinate;\r\n  protected height_: number;\r\n  protected width_: number;\r\n  protected RTL: boolean;\r\n\r\n  private deletable = true;\r\n\r\n  private movable = true;\r\n\r\n  private editable = true;\r\n  protected content_: string;\r\n\r\n  /** Whether this comment has been disposed. */\r\n  protected disposed_ = false;\r\n  /** @internal */\r\n  isComment = true;\r\n\r\n  /**\r\n   * @param workspace The block's workspace.\r\n   * @param content The content of this workspace comment.\r\n   * @param height Height of the comment.\r\n   * @param width Width of the comment.\r\n   * @param opt_id Optional ID.  Use this ID if provided, otherwise create a new\r\n   *     ID.\r\n   */\r\n  constructor(\r\n    public workspace: Workspace,\r\n    content: string,\r\n    height: number,\r\n    width: number,\r\n    opt_id?: string,\r\n  ) {\r\n    this.id =\r\n      opt_id && !workspace.getCommentById(opt_id)\r\n        ? opt_id\r\n        : idGenerator.genUid();\r\n\r\n    workspace.addTopComment(this);\r\n\r\n    /**\r\n     * The comment's position in workspace units.  (0, 0) is at the workspace's\r\n     * origin; scale does not change this value.\r\n     */\r\n    this.xy_ = new Coordinate(0, 0);\r\n\r\n    /**\r\n     * The comment's height in workspace units.  Scale does not change this\r\n     * value.\r\n     */\r\n    this.height_ = height;\r\n\r\n    /**\r\n     * The comment's width in workspace units.  Scale does not change this\r\n     * value.\r\n     */\r\n    this.width_ = width;\r\n\r\n    this.RTL = workspace.RTL;\r\n\r\n    this.content_ = content;\r\n\r\n    WorkspaceComment.fireCreateEvent(this);\r\n  }\r\n\r\n  /**\r\n   * Dispose of this comment.\r\n   *\r\n   * @internal\r\n   */\r\n  dispose() {\r\n    if (this.disposed_) {\r\n      return;\r\n    }\r\n\r\n    if (eventUtils.isEnabled()) {\r\n      eventUtils.fire(new (eventUtils.get(eventUtils.COMMENT_DELETE))(this));\r\n    }\r\n    // Remove from the list of top comments and the comment database.\r\n    this.workspace.removeTopComment(this);\r\n    this.disposed_ = true;\r\n  }\r\n\r\n  // Height, width, x, and y are all stored on even non-rendered comments, to\r\n  // preserve state if you pass the contents through a headless workspace.\r\n\r\n  /**\r\n   * Get comment height.\r\n   *\r\n   * @returns Comment height.\r\n   * @internal\r\n   */\r\n  getHeight(): number {\r\n    return this.height_;\r\n  }\r\n\r\n  /**\r\n   * Set comment height.\r\n   *\r\n   * @param height Comment height.\r\n   * @internal\r\n   */\r\n  setHeight(height: number) {\r\n    this.height_ = height;\r\n  }\r\n\r\n  /**\r\n   * Get comment width.\r\n   *\r\n   * @returns Comment width.\r\n   * @internal\r\n   */\r\n  getWidth(): number {\r\n    return this.width_;\r\n  }\r\n\r\n  /**\r\n   * Set comment width.\r\n   *\r\n   * @param width comment width.\r\n   * @internal\r\n   */\r\n  setWidth(width: number) {\r\n    this.width_ = width;\r\n  }\r\n\r\n  /**\r\n   * Get stored location.\r\n   *\r\n   * @returns The comment's stored location.\r\n   *   This is not valid if the comment is currently being dragged.\r\n   * @internal\r\n   */\r\n  getRelativeToSurfaceXY(): Coordinate {\r\n    return new Coordinate(this.xy_.x, this.xy_.y);\r\n  }\r\n\r\n  /**\r\n   * Move a comment by a relative offset.\r\n   *\r\n   * @param dx Horizontal offset, in workspace units.\r\n   * @param dy Vertical offset, in workspace units.\r\n   * @internal\r\n   */\r\n  moveBy(dx: number, dy: number) {\r\n    const event = new (eventUtils.get(eventUtils.COMMENT_MOVE))(\r\n      this,\r\n    ) as CommentMove;\r\n    this.xy_.translate(dx, dy);\r\n    event.recordNew();\r\n    eventUtils.fire(event);\r\n  }\r\n\r\n  /**\r\n   * Get whether this comment is deletable or not.\r\n   *\r\n   * @returns True if deletable.\r\n   * @internal\r\n   */\r\n  isDeletable(): boolean {\r\n    return (\r\n      this.deletable && !(this.workspace && this.workspace.options.readOnly)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Set whether this comment is deletable or not.\r\n   *\r\n   * @param deletable True if deletable.\r\n   * @internal\r\n   */\r\n  setDeletable(deletable: boolean) {\r\n    this.deletable = deletable;\r\n  }\r\n\r\n  /**\r\n   * Get whether this comment is movable or not.\r\n   *\r\n   * @returns True if movable.\r\n   * @internal\r\n   */\r\n  isMovable(): boolean {\r\n    return this.movable && !(this.workspace && this.workspace.options.readOnly);\r\n  }\r\n\r\n  /**\r\n   * Set whether this comment is movable or not.\r\n   *\r\n   * @param movable True if movable.\r\n   * @internal\r\n   */\r\n  setMovable(movable: boolean) {\r\n    this.movable = movable;\r\n  }\r\n\r\n  /**\r\n   * Get whether this comment is editable or not.\r\n   *\r\n   * @returns True if editable.\r\n   */\r\n  isEditable(): boolean {\r\n    return (\r\n      this.editable && !(this.workspace && this.workspace.options.readOnly)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Set whether this comment is editable or not.\r\n   *\r\n   * @param editable True if editable.\r\n   */\r\n  setEditable(editable: boolean) {\r\n    this.editable = editable;\r\n  }\r\n\r\n  /**\r\n   * Returns this comment's text.\r\n   *\r\n   * @returns Comment text.\r\n   * @internal\r\n   */\r\n  getContent(): string {\r\n    return this.content_;\r\n  }\r\n\r\n  /**\r\n   * Set this comment's content.\r\n   *\r\n   * @param content Comment content.\r\n   * @internal\r\n   */\r\n  setContent(content: string) {\r\n    if (this.content_ !== content) {\r\n      eventUtils.fire(\r\n        new (eventUtils.get(eventUtils.COMMENT_CHANGE))(\r\n          this,\r\n          this.content_,\r\n          content,\r\n        ),\r\n      );\r\n      this.content_ = content;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Encode a comment subtree as XML with XY coordinates.\r\n   *\r\n   * @param opt_noId True if the encoder should skip the comment ID.\r\n   * @returns Tree of XML elements.\r\n   * @internal\r\n   */\r\n  toXmlWithXY(opt_noId?: boolean): Element {\r\n    const element = this.toXml(opt_noId);\r\n    element.setAttribute('x', String(Math.round(this.xy_.x)));\r\n    element.setAttribute('y', String(Math.round(this.xy_.y)));\r\n    element.setAttribute('h', String(this.height_));\r\n    element.setAttribute('w', String(this.width_));\r\n    return element;\r\n  }\r\n\r\n  /**\r\n   * Encode a comment subtree as XML, but don't serialize the XY coordinates.\r\n   * This method avoids some expensive metrics-related calls that are made in\r\n   * toXmlWithXY().\r\n   *\r\n   * @param opt_noId True if the encoder should skip the comment ID.\r\n   * @returns Tree of XML elements.\r\n   * @internal\r\n   */\r\n  toXml(opt_noId?: boolean): Element {\r\n    const commentElement = xml.createElement('comment');\r\n    if (!opt_noId) {\r\n      commentElement.id = this.id;\r\n    }\r\n    commentElement.textContent = this.getContent();\r\n    return commentElement;\r\n  }\r\n\r\n  /**\r\n   * Fire a create event for the given workspace comment, if comments are\r\n   * enabled.\r\n   *\r\n   * @param comment The comment that was just created.\r\n   * @internal\r\n   */\r\n  static fireCreateEvent(comment: WorkspaceComment) {\r\n    if (eventUtils.isEnabled()) {\r\n      const existingGroup = eventUtils.getGroup();\r\n      if (!existingGroup) {\r\n        eventUtils.setGroup(true);\r\n      }\r\n      try {\r\n        eventUtils.fire(\r\n          new (eventUtils.get(eventUtils.COMMENT_CREATE))(comment),\r\n        );\r\n      } finally {\r\n        eventUtils.setGroup(existingGroup);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Decode an XML comment tag and create a comment on the workspace.\r\n   *\r\n   * @param xmlComment XML comment element.\r\n   * @param workspace The workspace.\r\n   * @returns The created workspace comment.\r\n   * @internal\r\n   */\r\n  static fromXml(xmlComment: Element, workspace: Workspace): WorkspaceComment {\r\n    const info = WorkspaceComment.parseAttributes(xmlComment);\r\n\r\n    const comment = new WorkspaceComment(\r\n      workspace,\r\n      info.content,\r\n      info.h,\r\n      info.w,\r\n      info.id,\r\n    );\r\n\r\n    const xmlX = xmlComment.getAttribute('x');\r\n    const xmlY = xmlComment.getAttribute('y');\r\n    const commentX = xmlX ? parseInt(xmlX, 10) : NaN;\r\n    const commentY = xmlY ? parseInt(xmlY, 10) : NaN;\r\n    if (!isNaN(commentX) && !isNaN(commentY)) {\r\n      comment.moveBy(commentX, commentY);\r\n    }\r\n\r\n    WorkspaceComment.fireCreateEvent(comment);\r\n    return comment;\r\n  }\r\n\r\n  /**\r\n   * Decode an XML comment tag and return the results in an object.\r\n   *\r\n   * @param xml XML comment element.\r\n   * @returns An object containing the id, size, position, and comment string.\r\n   * @internal\r\n   */\r\n  static parseAttributes(xml: Element): {\r\n    id: string;\r\n    w: number;\r\n    h: number;\r\n    x: number;\r\n    y: number;\r\n    content: string;\r\n  } {\r\n    const xmlH = xml.getAttribute('h');\r\n    const xmlW = xml.getAttribute('w');\r\n    const xmlX = xml.getAttribute('x');\r\n    const xmlY = xml.getAttribute('y');\r\n    const xmlId = xml.getAttribute('id');\r\n\r\n    if (!xmlId) {\r\n      throw new Error('No ID present in XML comment definition.');\r\n    }\r\n\r\n    return {\r\n      id: xmlId,\r\n      // The height of the comment in workspace units, or 100 if not specified.\r\n      h: xmlH ? parseInt(xmlH) : 100,\r\n      // The width of the comment in workspace units, or 100 if not specified.\r\n      w: xmlW ? parseInt(xmlW) : 100,\r\n      // The x position of the comment in workspace coordinates, or NaN if not\r\n      // specified in the XML.\r\n      x: xmlX ? parseInt(xmlX) : NaN,\r\n      // The y position of the comment in workspace coordinates, or NaN if not\r\n      // specified in the XML.\r\n      y: xmlY ? parseInt(xmlY) : NaN,\r\n      content: xml.textContent ?? '',\r\n    };\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Events fired as a result of element select action.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.Events.Selected\r\n\r\nimport * as registry from '../registry.js';\r\nimport {AbstractEventJson} from './events_abstract.js';\r\n\r\nimport {UiBase} from './events_ui_base.js';\r\nimport * as eventUtils from './utils.js';\r\nimport type {Workspace} from '../workspace.js';\r\n\r\n/**\r\n * Class for a selected event.\r\n * Notifies listeners that a new element has been selected.\r\n */\r\nexport class Selected extends UiBase {\r\n  /** The id of the last selected selectable element. */\r\n  oldElementId?: string;\r\n\r\n  /**\r\n   * The id of the newly selected selectable element,\r\n   * or undefined if unselected.\r\n   */\r\n  newElementId?: string;\r\n\r\n  override type = eventUtils.SELECTED;\r\n\r\n  /**\r\n   * @param opt_oldElementId The ID of the previously selected element. Null if\r\n   *     no element last selected. Undefined for a blank event.\r\n   * @param opt_newElementId The ID of the selected element. Null if no element\r\n   *     currently selected (deselect). Undefined for a blank event.\r\n   * @param opt_workspaceId The workspace identifier for this event.\r\n   *    Null if no element previously selected. Undefined for a blank event.\r\n   */\r\n  constructor(\r\n    opt_oldElementId?: string | null,\r\n    opt_newElementId?: string | null,\r\n    opt_workspaceId?: string,\r\n  ) {\r\n    super(opt_workspaceId);\r\n\r\n    this.oldElementId = opt_oldElementId ?? undefined;\r\n    this.newElementId = opt_newElementId ?? undefined;\r\n  }\r\n\r\n  /**\r\n   * Encode the event as JSON.\r\n   *\r\n   * @returns JSON representation.\r\n   */\r\n  override toJson(): SelectedJson {\r\n    const json = super.toJson() as SelectedJson;\r\n    json['oldElementId'] = this.oldElementId;\r\n    json['newElementId'] = this.newElementId;\r\n    return json;\r\n  }\r\n\r\n  /**\r\n   * Deserializes the JSON event.\r\n   *\r\n   * @param event The event to append new properties to. Should be a subclass\r\n   *     of Selected, but we can't specify that due to the fact that parameters\r\n   *     to static methods in subclasses must be supertypes of parameters to\r\n   *     static methods in superclasses.\r\n   * @internal\r\n   */\r\n  static fromJson(\r\n    json: SelectedJson,\r\n    workspace: Workspace,\r\n    event?: any,\r\n  ): Selected {\r\n    const newEvent = super.fromJson(\r\n      json,\r\n      workspace,\r\n      event ?? new Selected(),\r\n    ) as Selected;\r\n    newEvent.oldElementId = json['oldElementId'];\r\n    newEvent.newElementId = json['newElementId'];\r\n    return newEvent;\r\n  }\r\n}\r\n\r\nexport interface SelectedJson extends AbstractEventJson {\r\n  oldElementId?: string;\r\n  newElementId?: string;\r\n}\r\n\r\nregistry.register(registry.Type.EVENT, eventUtils.SELECTED, Selected);\r\n","/**\r\n * @license\r\n * Copyright 2023 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport {IPaster} from '../interfaces/i_paster.js';\r\nimport {ICopyData} from '../interfaces/i_copyable.js';\r\nimport {Coordinate} from '../utils/coordinate.js';\r\nimport {WorkspaceSvg} from '../workspace_svg.js';\r\nimport {WorkspaceCommentSvg} from '../workspace_comment_svg.js';\r\nimport * as registry from './registry.js';\r\n\r\nexport class WorkspaceCommentPaster\r\n  implements IPaster<WorkspaceCommentCopyData, WorkspaceCommentSvg>\r\n{\r\n  static TYPE = 'workspace-comment';\r\n\r\n  paste(\r\n    copyData: WorkspaceCommentCopyData,\r\n    workspace: WorkspaceSvg,\r\n    coordinate?: Coordinate,\r\n  ): WorkspaceCommentSvg {\r\n    const state = copyData.commentState;\r\n    if (coordinate) {\r\n      state.setAttribute('x', `${coordinate.x}`);\r\n      state.setAttribute('y', `${coordinate.y}`);\r\n    } else {\r\n      const x = parseInt(state.getAttribute('x') ?? '0') + 50;\r\n      const y = parseInt(state.getAttribute('y') ?? '0') + 50;\r\n      state.setAttribute('x', `${x}`);\r\n      state.setAttribute('y', `${y}`);\r\n    }\r\n    return WorkspaceCommentSvg.fromXmlRendered(\r\n      copyData.commentState,\r\n      workspace,\r\n    );\r\n  }\r\n}\r\n\r\nexport interface WorkspaceCommentCopyData extends ICopyData {\r\n  commentState: Element;\r\n}\r\n\r\nregistry.register(WorkspaceCommentPaster.TYPE, new WorkspaceCommentPaster());\r\n","/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Object representing a code comment on a rendered workspace.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.WorkspaceCommentSvg\r\n\r\n// Unused import preserved for side-effects. Remove if unneeded.\r\nimport './events/events_selected.js';\r\n\r\nimport * as browserEvents from './browser_events.js';\r\nimport * as common from './common.js';\r\n// import * as ContextMenu from './contextmenu.js';\r\nimport * as Css from './css.js';\r\nimport type {CommentMove} from './events/events_comment_move.js';\r\nimport * as eventUtils from './events/utils.js';\r\nimport type {IBoundedElement} from './interfaces/i_bounded_element.js';\r\nimport type {IBubble} from './interfaces/i_bubble.js';\r\nimport type {ICopyable} from './interfaces/i_copyable.js';\r\nimport * as Touch from './touch.js';\r\nimport {Coordinate} from './utils/coordinate.js';\r\nimport * as dom from './utils/dom.js';\r\nimport {Rect} from './utils/rect.js';\r\nimport {Svg} from './utils/svg.js';\r\nimport * as svgMath from './utils/svg_math.js';\r\nimport {WorkspaceComment} from './workspace_comment.js';\r\nimport type {WorkspaceSvg} from './workspace_svg.js';\r\nimport {\r\n  WorkspaceCommentCopyData,\r\n  WorkspaceCommentPaster,\r\n} from './clipboard/workspace_comment_paster.js';\r\n\r\n/** Size of the resize icon. */\r\nconst RESIZE_SIZE = 8;\r\n\r\n/** Radius of the border around the comment. */\r\nconst BORDER_RADIUS = 3;\r\n\r\n/** Offset from the foreignobject edge to the textarea edge. */\r\nconst TEXTAREA_OFFSET = 2;\r\n\r\n/**\r\n * Class for a workspace comment's SVG representation.\r\n */\r\nexport class WorkspaceCommentSvg\r\n  extends WorkspaceComment\r\n  implements IBoundedElement, IBubble, ICopyable<WorkspaceCommentCopyData>\r\n{\r\n  /**\r\n   * The width and height to use to size a workspace comment when it is first\r\n   * added, before it has been edited by the user.\r\n   *\r\n   * @internal\r\n   */\r\n  static DEFAULT_SIZE = 100;\r\n\r\n  /** Offset from the top to make room for a top bar. */\r\n  private static readonly TOP_OFFSET = 10;\r\n  override workspace: WorkspaceSvg;\r\n\r\n  /** Mouse up event data. */\r\n  private onMouseUpWrapper: browserEvents.Data | null = null;\r\n\r\n  /** Mouse move event data. */\r\n  private onMouseMoveWrapper: browserEvents.Data | null = null;\r\n\r\n  /** Whether event handlers have been initialized. */\r\n  private eventsInit = false;\r\n  private textarea: HTMLTextAreaElement | null = null;\r\n\r\n  private svgRectTarget: SVGRectElement | null = null;\r\n\r\n  private svgHandleTarget: SVGRectElement | null = null;\r\n\r\n  private foreignObject: SVGForeignObjectElement | null = null;\r\n\r\n  private resizeGroup: SVGGElement | null = null;\r\n\r\n  private deleteGroup: SVGGElement | null = null;\r\n\r\n  private deleteIconBorder: SVGCircleElement | null = null;\r\n\r\n  private focused = false;\r\n  private autoLayout = false;\r\n\r\n  // Create core elements for the block.\r\n  private readonly svgGroup: SVGElement;\r\n  svgRect_: SVGRectElement;\r\n\r\n  /** Whether the comment is rendered onscreen and is a part of the DOM. */\r\n  private rendered = false;\r\n\r\n  /**\r\n   * @param workspace The block's workspace.\r\n   * @param content The content of this workspace comment.\r\n   * @param height Height of the comment.\r\n   * @param width Width of the comment.\r\n   * @param opt_id Optional ID.  Use this ID if provided, otherwise create a new\r\n   *     ID.\r\n   */\r\n  constructor(\r\n    workspace: WorkspaceSvg,\r\n    content: string,\r\n    height: number,\r\n    width: number,\r\n    opt_id?: string,\r\n  ) {\r\n    super(workspace, content, height, width, opt_id);\r\n    this.svgGroup = dom.createSvgElement(Svg.G, {'class': 'blocklyComment'});\r\n    this.workspace = workspace;\r\n\r\n    this.svgRect_ = dom.createSvgElement(Svg.RECT, {\r\n      'class': 'blocklyCommentRect',\r\n      'x': 0,\r\n      'y': 0,\r\n      'rx': BORDER_RADIUS,\r\n      'ry': BORDER_RADIUS,\r\n    });\r\n    this.svgGroup.appendChild(this.svgRect_);\r\n\r\n    this.render();\r\n  }\r\n\r\n  /**\r\n   * Dispose of this comment.\r\n   *\r\n   * @internal\r\n   */\r\n  override dispose() {\r\n    if (this.disposed_) {\r\n      return;\r\n    }\r\n    // If this comment is being dragged, unlink the mouse events.\r\n    if (common.getSelected() === this) {\r\n      this.unselect();\r\n      this.workspace.cancelCurrentGesture();\r\n    }\r\n\r\n    if (eventUtils.isEnabled()) {\r\n      eventUtils.fire(new (eventUtils.get(eventUtils.COMMENT_DELETE))(this));\r\n    }\r\n\r\n    dom.removeNode(this.svgGroup);\r\n\r\n    eventUtils.disable();\r\n    super.dispose();\r\n    eventUtils.enable();\r\n  }\r\n\r\n  /**\r\n   * Create and initialize the SVG representation of a workspace comment.\r\n   * May be called more than once.\r\n   *\r\n   * @param opt_noSelect Text inside text area will be selected if false\r\n   * @internal\r\n   */\r\n  initSvg(opt_noSelect?: boolean) {\r\n    if (!this.workspace.rendered) {\r\n      throw TypeError('Workspace is headless.');\r\n    }\r\n    if (!this.workspace.options.readOnly && !this.eventsInit) {\r\n      browserEvents.conditionalBind(\r\n        this.svgRectTarget as SVGRectElement,\r\n        'pointerdown',\r\n        this,\r\n        this.pathMouseDown,\r\n      );\r\n      browserEvents.conditionalBind(\r\n        this.svgHandleTarget as SVGRectElement,\r\n        'pointerdown',\r\n        this,\r\n        this.pathMouseDown,\r\n      );\r\n    }\r\n    this.eventsInit = true;\r\n\r\n    this.updateMovable();\r\n    if (!this.getSvgRoot().parentNode) {\r\n      this.workspace.getBubbleCanvas().appendChild(this.getSvgRoot());\r\n    }\r\n\r\n    if (!opt_noSelect && this.textarea) {\r\n      this.textarea.select();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle a pointerdown on an SVG comment.\r\n   *\r\n   * @param e Pointer down event.\r\n   */\r\n  private pathMouseDown(e: PointerEvent) {\r\n    const gesture = this.workspace.getGesture(e);\r\n    if (gesture) {\r\n      gesture.handleBubbleStart(e, this);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show the context menu for this workspace comment.\r\n   *\r\n   * @param e Pointer event.\r\n   * @internal\r\n   */\r\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n  showContextMenu(e: PointerEvent) {\r\n    throw new Error(\r\n      'The implementation of showContextMenu should be ' +\r\n        'monkey-patched in by blockly.ts',\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Select this comment.  Highlight it visually.\r\n   *\r\n   * @internal\r\n   */\r\n  select() {\r\n    if (common.getSelected() === this) {\r\n      return;\r\n    }\r\n    let oldId = null;\r\n    if (common.getSelected()) {\r\n      oldId = common.getSelected()!.id;\r\n      // Unselect any previously selected block.\r\n      eventUtils.disable();\r\n      try {\r\n        common.getSelected()!.unselect();\r\n      } finally {\r\n        eventUtils.enable();\r\n      }\r\n    }\r\n    const event = new (eventUtils.get(eventUtils.SELECTED))(\r\n      oldId,\r\n      this.id,\r\n      this.workspace.id,\r\n    );\r\n    eventUtils.fire(event);\r\n    common.setSelected(this);\r\n    this.addSelect();\r\n  }\r\n\r\n  /**\r\n   * Unselect this comment.  Remove its highlighting.\r\n   *\r\n   * @internal\r\n   */\r\n  unselect() {\r\n    if (common.getSelected() !== this) {\r\n      return;\r\n    }\r\n    const event = new (eventUtils.get(eventUtils.SELECTED))(\r\n      this.id,\r\n      null,\r\n      this.workspace.id,\r\n    );\r\n    eventUtils.fire(event);\r\n    common.setSelected(null);\r\n    this.removeSelect();\r\n    this.blurFocus();\r\n  }\r\n\r\n  /**\r\n   * Select this comment.  Highlight it visually.\r\n   *\r\n   * @internal\r\n   */\r\n  addSelect() {\r\n    dom.addClass(this.svgGroup, 'blocklySelected');\r\n    this.setFocus();\r\n  }\r\n\r\n  /**\r\n   * Unselect this comment.  Remove its highlighting.\r\n   *\r\n   * @internal\r\n   */\r\n  removeSelect() {\r\n    dom.addClass(this.svgGroup, 'blocklySelected');\r\n    this.blurFocus();\r\n  }\r\n\r\n  /**\r\n   * Focus this comment.  Highlight it visually.\r\n   *\r\n   * @internal\r\n   */\r\n  addFocus() {\r\n    dom.addClass(this.svgGroup, 'blocklyFocused');\r\n  }\r\n\r\n  /**\r\n   * Unfocus this comment.  Remove its highlighting.\r\n   *\r\n   * @internal\r\n   */\r\n  removeFocus() {\r\n    dom.removeClass(this.svgGroup, 'blocklyFocused');\r\n  }\r\n\r\n  /**\r\n   * Return the coordinates of the top-left corner of this comment relative to\r\n   * the drawing surface's origin (0,0), in workspace units.\r\n   * If the comment is on the workspace, (0, 0) is the origin of the workspace\r\n   * coordinate system.\r\n   * This does not change with workspace scale.\r\n   *\r\n   * @returns Object with .x and .y properties in workspace coordinates.\r\n   * @internal\r\n   */\r\n  override getRelativeToSurfaceXY(): Coordinate {\r\n    const layerManger = this.workspace.getLayerManager();\r\n    if (!layerManger) {\r\n      throw new Error(\r\n        'Cannot calculate position because the workspace has not been appended',\r\n      );\r\n    }\r\n\r\n    let x = 0;\r\n    let y = 0;\r\n\r\n    let element: SVGElement | null = this.getSvgRoot();\r\n    if (element) {\r\n      do {\r\n        // Loop through this comment and every parent.\r\n        const xy = svgMath.getRelativeXY(element);\r\n        x += xy.x;\r\n        y += xy.y;\r\n        element = element.parentNode as SVGElement;\r\n      } while (element && !layerManger.hasLayer(element) && element !== null);\r\n    }\r\n    this.xy_ = new Coordinate(x, y);\r\n    return this.xy_;\r\n  }\r\n\r\n  /**\r\n   * Move a comment by a relative offset.\r\n   *\r\n   * @param dx Horizontal offset, in workspace units.\r\n   * @param dy Vertical offset, in workspace units.\r\n   * @internal\r\n   */\r\n  override moveBy(dx: number, dy: number) {\r\n    const event = new (eventUtils.get(eventUtils.COMMENT_MOVE))(\r\n      this,\r\n    ) as CommentMove;\r\n    // TODO: Do I need to look up the relative to surface XY position here?\r\n    const xy = this.getRelativeToSurfaceXY();\r\n    this.translate(xy.x + dx, xy.y + dy);\r\n    this.xy_ = new Coordinate(xy.x + dx, xy.y + dy);\r\n    event.recordNew();\r\n    eventUtils.fire(event);\r\n    this.workspace.resizeContents();\r\n  }\r\n\r\n  /**\r\n   * Transforms a comment by setting the translation on the transform attribute\r\n   * of the block's SVG.\r\n   *\r\n   * @param x The x coordinate of the translation in workspace units.\r\n   * @param y The y coordinate of the translation in workspace units.\r\n   * @internal\r\n   */\r\n  translate(x: number, y: number) {\r\n    this.xy_ = new Coordinate(x, y);\r\n    this.getSvgRoot().setAttribute(\r\n      'transform',\r\n      'translate(' + x + ',' + y + ')',\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Move this comment during a drag.\r\n   *\r\n   * @param newLoc The location to translate to, in workspace coordinates.\r\n   * @internal\r\n   */\r\n  moveDuringDrag(newLoc: Coordinate) {\r\n    const translation = `translate(${newLoc.x}, ${newLoc.y})`;\r\n    this.getSvgRoot().setAttribute('transform', translation);\r\n  }\r\n\r\n  /**\r\n   * Move the bubble group to the specified location in workspace coordinates.\r\n   *\r\n   * @param x The x position to move to.\r\n   * @param y The y position to move to.\r\n   * @internal\r\n   */\r\n  moveTo(x: number, y: number) {\r\n    this.translate(x, y);\r\n  }\r\n\r\n  /**\r\n   * Clear the comment of transform=\"...\" attributes.\r\n   * Used when the comment is switching from 3d to 2d transform or vice versa.\r\n   */\r\n  private clearTransformAttributes() {\r\n    this.getSvgRoot().removeAttribute('transform');\r\n  }\r\n\r\n  /**\r\n   * Returns the coordinates of a bounding box describing the dimensions of this\r\n   * comment.\r\n   * Coordinate system: workspace coordinates.\r\n   *\r\n   * @returns Object with coordinates of the bounding box.\r\n   * @internal\r\n   */\r\n  getBoundingRectangle(): Rect {\r\n    const blockXY = this.getRelativeToSurfaceXY();\r\n    const commentBounds = this.getHeightWidth();\r\n    const top = blockXY.y;\r\n    const bottom = blockXY.y + commentBounds.height;\r\n    let left;\r\n    let right;\r\n    if (this.RTL) {\r\n      left = blockXY.x - commentBounds.width;\r\n      // Add the width of the tab/puzzle piece knob to the x coordinate\r\n      // since X is the corner of the rectangle, not the whole puzzle piece.\r\n      right = blockXY.x;\r\n    } else {\r\n      // Subtract the width of the tab/puzzle piece knob to the x coordinate\r\n      // since X is the corner of the rectangle, not the whole puzzle piece.\r\n      left = blockXY.x;\r\n      right = blockXY.x + commentBounds.width;\r\n    }\r\n    return new Rect(top, bottom, left, right);\r\n  }\r\n\r\n  /**\r\n   * Add or remove the UI indicating if this comment is movable or not.\r\n   *\r\n   * @internal\r\n   */\r\n  updateMovable() {\r\n    if (this.isMovable()) {\r\n      dom.addClass(this.svgGroup, 'blocklyDraggable');\r\n    } else {\r\n      dom.removeClass(this.svgGroup, 'blocklyDraggable');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set whether this comment is movable or not.\r\n   *\r\n   * @param movable True if movable.\r\n   * @internal\r\n   */\r\n  override setMovable(movable: boolean) {\r\n    super.setMovable(movable);\r\n    this.updateMovable();\r\n  }\r\n\r\n  /**\r\n   * Set whether this comment is editable or not.\r\n   *\r\n   * @param editable True if editable.\r\n   */\r\n  override setEditable(editable: boolean) {\r\n    super.setEditable(editable);\r\n    if (this.textarea) {\r\n      this.textarea.readOnly = !editable;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Recursively adds or removes the dragging class to this node and its\r\n   * children.\r\n   *\r\n   * @param adding True if adding, false if removing.\r\n   * @internal\r\n   */\r\n  setDragging(adding: boolean) {\r\n    if (adding) {\r\n      dom.addClass(this.getSvgRoot(), 'blocklyDragging');\r\n    } else {\r\n      dom.removeClass(this.getSvgRoot(), 'blocklyDragging');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Return the root node of the SVG or null if none exists.\r\n   *\r\n   * @returns The root SVG node (probably a group).\r\n   * @internal\r\n   */\r\n  getSvgRoot(): SVGElement {\r\n    return this.svgGroup;\r\n  }\r\n\r\n  /**\r\n   * Returns this comment's text.\r\n   *\r\n   * @returns Comment text.\r\n   * @internal\r\n   */\r\n  override getContent(): string {\r\n    return this.textarea ? this.textarea.value : this.content_;\r\n  }\r\n\r\n  /**\r\n   * Set this comment's content.\r\n   *\r\n   * @param content Comment content.\r\n   * @internal\r\n   */\r\n  override setContent(content: string) {\r\n    super.setContent(content);\r\n    if (this.textarea) {\r\n      this.textarea.value = content;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update the cursor over this comment by adding or removing a class.\r\n   *\r\n   * @param enable True if the delete cursor should be shown, false otherwise.\r\n   * @internal\r\n   */\r\n  setDeleteStyle(enable: boolean) {\r\n    if (enable) {\r\n      dom.addClass(this.svgGroup, 'blocklyDraggingDelete');\r\n    } else {\r\n      dom.removeClass(this.svgGroup, 'blocklyDraggingDelete');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set whether auto-layout of this bubble is enabled.  The first time a bubble\r\n   * is shown it positions itself to not cover any blocks.  Once a user has\r\n   * dragged it to reposition, it renders where the user put it.\r\n   *\r\n   * @param _enable True if auto-layout should be enabled, false otherwise.\r\n   * @internal\r\n   */\r\n  setAutoLayout(_enable: boolean) {}\r\n  // NOP for compatibility with the bubble dragger.\r\n\r\n  /**\r\n   * Encode a comment subtree as XML with XY coordinates.\r\n   *\r\n   * @param opt_noId True if the encoder should skip the comment ID.\r\n   * @returns Tree of XML elements.\r\n   * @internal\r\n   */\r\n  override toXmlWithXY(opt_noId?: boolean): Element {\r\n    let width = 0; // Not used in LTR.\r\n    if (this.workspace.RTL) {\r\n      // Here be performance dragons: This calls getMetrics().\r\n      width = this.workspace.getWidth();\r\n    }\r\n    const element = this.toXml(opt_noId);\r\n    const xy = this.getRelativeToSurfaceXY();\r\n    element.setAttribute(\r\n      'x',\r\n      String(Math.round(this.workspace.RTL ? width - xy.x : xy.x)),\r\n    );\r\n    element.setAttribute('y', String(Math.round(xy.y)));\r\n    element.setAttribute('h', String(this.getHeight()));\r\n    element.setAttribute('w', String(this.getWidth()));\r\n    return element;\r\n  }\r\n\r\n  /**\r\n   * Encode a comment for copying.\r\n   *\r\n   * @returns Copy metadata.\r\n   */\r\n  toCopyData(): WorkspaceCommentCopyData {\r\n    return {\r\n      paster: WorkspaceCommentPaster.TYPE,\r\n      commentState: this.toXmlWithXY(),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Returns a bounding box describing the dimensions of this comment.\r\n   *\r\n   * @returns Object with height and width properties in workspace units.\r\n   * @internal\r\n   */\r\n  getHeightWidth(): {height: number; width: number} {\r\n    return {width: this.getWidth(), height: this.getHeight()};\r\n  }\r\n\r\n  /**\r\n   * Renders the workspace comment.\r\n   *\r\n   * @internal\r\n   */\r\n  render() {\r\n    if (this.rendered) {\r\n      return;\r\n    }\r\n\r\n    const size = this.getHeightWidth();\r\n\r\n    // Add text area\r\n    const foreignObject = this.createEditor();\r\n    this.svgGroup.appendChild(foreignObject);\r\n\r\n    this.svgHandleTarget = dom.createSvgElement(Svg.RECT, {\r\n      'class': 'blocklyCommentHandleTarget',\r\n      'x': 0,\r\n      'y': 0,\r\n    });\r\n    this.svgGroup.appendChild(this.svgHandleTarget);\r\n    this.svgRectTarget = dom.createSvgElement(Svg.RECT, {\r\n      'class': 'blocklyCommentTarget',\r\n      'x': 0,\r\n      'y': 0,\r\n      'rx': BORDER_RADIUS,\r\n      'ry': BORDER_RADIUS,\r\n    });\r\n    this.svgGroup.appendChild(this.svgRectTarget);\r\n\r\n    // Add the resize icon\r\n    this.addResizeDom();\r\n    if (this.isDeletable()) {\r\n      // Add the delete icon\r\n      this.addDeleteDom();\r\n    }\r\n\r\n    this.setSize(size.width, size.height);\r\n\r\n    // Set the content\r\n    this.textarea!.value = this.content_;\r\n\r\n    this.rendered = true;\r\n\r\n    if (this.resizeGroup) {\r\n      browserEvents.conditionalBind(\r\n        this.resizeGroup,\r\n        'pointerdown',\r\n        this,\r\n        this.resizeMouseDown,\r\n      );\r\n    }\r\n\r\n    if (this.isDeletable()) {\r\n      browserEvents.conditionalBind(\r\n        this.deleteGroup as SVGGElement,\r\n        'pointerdown',\r\n        this,\r\n        this.deleteMouseDown,\r\n      );\r\n      browserEvents.conditionalBind(\r\n        this.deleteGroup as SVGGElement,\r\n        'pointerout',\r\n        this,\r\n        this.deleteMouseOut,\r\n      );\r\n      browserEvents.conditionalBind(\r\n        this.deleteGroup as SVGGElement,\r\n        'pointerup',\r\n        this,\r\n        this.deleteMouseUp,\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create the text area for the comment.\r\n   *\r\n   * @returns The top-level node of the editor.\r\n   */\r\n  private createEditor(): Element {\r\n    /* Create the editor.  Here's the markup that will be generated:\r\n          <foreignObject class=\"blocklyCommentForeignObject\" x=\"0\" y=\"10\"\r\n          width=\"164\" height=\"164\"> <body xmlns=\"http://www.w3.org/1999/xhtml\"\r\n          class=\"blocklyMinimalBody\"> <textarea\r\n       xmlns=\"http://www.w3.org/1999/xhtml\" class=\"blocklyCommentTextarea\"\r\n                  style=\"height: 164px; width: 164px;\"></textarea>\r\n            </body>\r\n          </foreignObject>\r\n        */\r\n    this.foreignObject = dom.createSvgElement(Svg.FOREIGNOBJECT, {\r\n      'x': 0,\r\n      'y': WorkspaceCommentSvg.TOP_OFFSET,\r\n      'class': 'blocklyCommentForeignObject',\r\n    });\r\n    const body = document.createElementNS(dom.HTML_NS, 'body');\r\n    body.setAttribute('xmlns', dom.HTML_NS);\r\n    body.className = 'blocklyMinimalBody';\r\n    const textarea = document.createElementNS(\r\n      dom.HTML_NS,\r\n      'textarea',\r\n    ) as HTMLTextAreaElement;\r\n    textarea.className = 'blocklyCommentTextarea';\r\n    textarea.setAttribute('dir', this.RTL ? 'RTL' : 'LTR');\r\n    textarea.readOnly = !this.isEditable();\r\n    body.appendChild(textarea);\r\n    this.textarea = textarea;\r\n    this.foreignObject.appendChild(body);\r\n    // Don't zoom with mousewheel.\r\n    browserEvents.conditionalBind(\r\n      textarea,\r\n      'wheel',\r\n      this,\r\n      function (e: WheelEvent) {\r\n        e.stopPropagation();\r\n      },\r\n    );\r\n    browserEvents.conditionalBind(\r\n      textarea,\r\n      'change',\r\n      this,\r\n      function (this: WorkspaceCommentSvg, _e: Event) {\r\n        this.setContent(textarea.value);\r\n      },\r\n    );\r\n    return this.foreignObject;\r\n  }\r\n\r\n  /** Add the resize icon to the DOM */\r\n  private addResizeDom() {\r\n    this.resizeGroup = dom.createSvgElement(\r\n      Svg.G,\r\n      {'class': this.RTL ? 'blocklyResizeSW' : 'blocklyResizeSE'},\r\n      this.svgGroup,\r\n    );\r\n    dom.createSvgElement(\r\n      Svg.POLYGON,\r\n      {\r\n        'points': `0,${RESIZE_SIZE} ${RESIZE_SIZE},${RESIZE_SIZE} ${RESIZE_SIZE},0`,\r\n      },\r\n      this.resizeGroup,\r\n    );\r\n    dom.createSvgElement(\r\n      Svg.LINE,\r\n      {\r\n        'class': 'blocklyResizeLine',\r\n        'x1': RESIZE_SIZE / 3,\r\n        'y1': RESIZE_SIZE - 1,\r\n        'x2': RESIZE_SIZE - 1,\r\n        'y2': RESIZE_SIZE / 3,\r\n      },\r\n      this.resizeGroup,\r\n    );\r\n    dom.createSvgElement(\r\n      Svg.LINE,\r\n      {\r\n        'class': 'blocklyResizeLine',\r\n        'x1': (RESIZE_SIZE * 2) / 3,\r\n        'y1': RESIZE_SIZE - 1,\r\n        'x2': RESIZE_SIZE - 1,\r\n        'y2': (RESIZE_SIZE * 2) / 3,\r\n      },\r\n      this.resizeGroup,\r\n    );\r\n  }\r\n\r\n  /** Add the delete icon to the DOM */\r\n  private addDeleteDom() {\r\n    this.deleteGroup = dom.createSvgElement(\r\n      Svg.G,\r\n      {'class': 'blocklyCommentDeleteIcon'},\r\n      this.svgGroup,\r\n    );\r\n    this.deleteIconBorder = dom.createSvgElement(\r\n      Svg.CIRCLE,\r\n      {'class': 'blocklyDeleteIconShape', 'r': '7', 'cx': '7.5', 'cy': '7.5'},\r\n      this.deleteGroup,\r\n    );\r\n    // x icon.\r\n    dom.createSvgElement(\r\n      Svg.LINE,\r\n      {\r\n        'x1': '5',\r\n        'y1': '10',\r\n        'x2': '10',\r\n        'y2': '5',\r\n        'stroke': '#fff',\r\n        'stroke-width': '2',\r\n      },\r\n      this.deleteGroup,\r\n    );\r\n    dom.createSvgElement(\r\n      Svg.LINE,\r\n      {\r\n        'x1': '5',\r\n        'y1': '5',\r\n        'x2': '10',\r\n        'y2': '10',\r\n        'stroke': '#fff',\r\n        'stroke-width': '2',\r\n      },\r\n      this.deleteGroup,\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Handle a pointerdown on comment's resize corner.\r\n   *\r\n   * @param e Pointer down event.\r\n   */\r\n  private resizeMouseDown(e: PointerEvent) {\r\n    this.unbindDragEvents();\r\n    if (browserEvents.isRightButton(e)) {\r\n      // No right-click.\r\n      e.stopPropagation();\r\n      return;\r\n    }\r\n    // Left-click (or middle click)\r\n    this.workspace.startDrag(\r\n      e,\r\n      new Coordinate(\r\n        this.workspace.RTL ? -this.width_ : this.width_,\r\n        this.height_,\r\n      ),\r\n    );\r\n\r\n    this.onMouseUpWrapper = browserEvents.conditionalBind(\r\n      document,\r\n      'pointerup',\r\n      this,\r\n      this.resizeMouseUp,\r\n    );\r\n    this.onMouseMoveWrapper = browserEvents.conditionalBind(\r\n      document,\r\n      'pointermove',\r\n      this,\r\n      this.resizeMouseMove,\r\n    );\r\n    this.workspace.hideChaff();\r\n    // This event has been handled.  No need to bubble up to the document.\r\n    e.stopPropagation();\r\n  }\r\n\r\n  /**\r\n   * Handle a pointerdown on comment's delete icon.\r\n   *\r\n   * @param e Pointer down event.\r\n   */\r\n  private deleteMouseDown(e: PointerEvent) {\r\n    // Highlight the delete icon.\r\n    if (this.deleteIconBorder) {\r\n      dom.addClass(this.deleteIconBorder, 'blocklyDeleteIconHighlighted');\r\n    }\r\n    // This event has been handled.  No need to bubble up to the document.\r\n    e.stopPropagation();\r\n  }\r\n\r\n  /**\r\n   * Handle a pointerout on comment's delete icon.\r\n   *\r\n   * @param _e Pointer out event.\r\n   */\r\n  private deleteMouseOut(_e: PointerEvent) {\r\n    // Restore highlight on the delete icon.\r\n    if (this.deleteIconBorder) {\r\n      dom.removeClass(this.deleteIconBorder, 'blocklyDeleteIconHighlighted');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle a pointerup on comment's delete icon.\r\n   *\r\n   * @param e Pointer up event.\r\n   */\r\n  private deleteMouseUp(e: PointerEvent) {\r\n    // Delete this comment.\r\n    this.dispose();\r\n    // This event has been handled.  No need to bubble up to the document.\r\n    e.stopPropagation();\r\n  }\r\n\r\n  /** Stop binding to the global pointerup and pointermove events. */\r\n  private unbindDragEvents() {\r\n    if (this.onMouseUpWrapper) {\r\n      browserEvents.unbind(this.onMouseUpWrapper);\r\n      this.onMouseUpWrapper = null;\r\n    }\r\n    if (this.onMouseMoveWrapper) {\r\n      browserEvents.unbind(this.onMouseMoveWrapper);\r\n      this.onMouseMoveWrapper = null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle a pointerup event while dragging a comment's border or resize\r\n   * handle.\r\n   *\r\n   * @param _e Pointer up event.\r\n   */\r\n  private resizeMouseUp(_e: PointerEvent) {\r\n    Touch.clearTouchIdentifier();\r\n    this.unbindDragEvents();\r\n  }\r\n\r\n  /**\r\n   * Resize this comment to follow the pointer.\r\n   *\r\n   * @param e Pointer move event.\r\n   */\r\n  private resizeMouseMove(e: PointerEvent) {\r\n    this.autoLayout = false;\r\n    const newXY = this.workspace.moveDrag(e);\r\n    this.setSize(this.RTL ? -newXY.x : newXY.x, newXY.y);\r\n  }\r\n\r\n  /**\r\n   * Callback function triggered when the comment has resized.\r\n   * Resize the text area accordingly.\r\n   */\r\n  private resizeComment() {\r\n    const size = this.getHeightWidth();\r\n    const topOffset = WorkspaceCommentSvg.TOP_OFFSET;\r\n    const textOffset = TEXTAREA_OFFSET * 2;\r\n\r\n    this.foreignObject?.setAttribute('width', String(size.width));\r\n    this.foreignObject?.setAttribute('height', String(size.height - topOffset));\r\n    if (this.RTL) {\r\n      this.foreignObject?.setAttribute('x', String(-size.width));\r\n    }\r\n\r\n    if (!this.textarea) return;\r\n    this.textarea.style.width = size.width - textOffset + 'px';\r\n    this.textarea.style.height = size.height - textOffset - topOffset + 'px';\r\n  }\r\n\r\n  /**\r\n   * Set size\r\n   *\r\n   * @param width width of the container\r\n   * @param height height of the container\r\n   */\r\n  private setSize(width: number, height: number) {\r\n    // Minimum size of a comment.\r\n    width = Math.max(width, 45);\r\n    height = Math.max(height, 20 + WorkspaceCommentSvg.TOP_OFFSET);\r\n    this.width_ = width;\r\n    this.height_ = height;\r\n    this.svgRect_.setAttribute('width', `${width}`);\r\n    this.svgRect_.setAttribute('height', `${height}`);\r\n    this.svgRectTarget?.setAttribute('width', `${width}`);\r\n    this.svgRectTarget?.setAttribute('height', `${height}`);\r\n    this.svgHandleTarget?.setAttribute('width', `${width}`);\r\n    this.svgHandleTarget?.setAttribute(\r\n      'height',\r\n      String(WorkspaceCommentSvg.TOP_OFFSET),\r\n    );\r\n    if (this.RTL) {\r\n      this.svgRect_.setAttribute('transform', 'scale(-1 1)');\r\n      this.svgRectTarget?.setAttribute('transform', 'scale(-1 1)');\r\n    }\r\n\r\n    if (this.resizeGroup) {\r\n      if (this.RTL) {\r\n        // Mirror the resize group.\r\n        this.resizeGroup.setAttribute(\r\n          'transform',\r\n          'translate(' +\r\n            (-width + RESIZE_SIZE) +\r\n            ',' +\r\n            (height - RESIZE_SIZE) +\r\n            ') scale(-1 1)',\r\n        );\r\n        this.deleteGroup?.setAttribute(\r\n          'transform',\r\n          'translate(' +\r\n            (-width + RESIZE_SIZE) +\r\n            ',' +\r\n            -RESIZE_SIZE +\r\n            ') scale(-1 1)',\r\n        );\r\n      } else {\r\n        this.resizeGroup.setAttribute(\r\n          'transform',\r\n          'translate(' +\r\n            (width - RESIZE_SIZE) +\r\n            ',' +\r\n            (height - RESIZE_SIZE) +\r\n            ')',\r\n        );\r\n        this.deleteGroup?.setAttribute(\r\n          'transform',\r\n          'translate(' + (width - RESIZE_SIZE) + ',' + -RESIZE_SIZE + ')',\r\n        );\r\n      }\r\n    }\r\n\r\n    // Allow the contents to resize.\r\n    this.resizeComment();\r\n  }\r\n\r\n  /**\r\n   * Set the focus on the text area.\r\n   *\r\n   * @internal\r\n   */\r\n  setFocus() {\r\n    this.focused = true;\r\n    // Defer CSS changes.\r\n    setTimeout(() => {\r\n      if (this.disposed_) {\r\n        return;\r\n      }\r\n      this.textarea!.focus();\r\n      this.addFocus();\r\n      if (this.svgRectTarget) {\r\n        dom.addClass(this.svgRectTarget, 'blocklyCommentTargetFocused');\r\n      }\r\n      if (this.svgHandleTarget) {\r\n        dom.addClass(this.svgHandleTarget, 'blocklyCommentHandleTargetFocused');\r\n      }\r\n    }, 0);\r\n  }\r\n\r\n  /**\r\n   * Remove focus from the text area.\r\n   *\r\n   * @internal\r\n   */\r\n  blurFocus() {\r\n    this.focused = false;\r\n    // Defer CSS changes.\r\n    setTimeout(() => {\r\n      if (this.disposed_) {\r\n        return;\r\n      }\r\n\r\n      this.textarea!.blur();\r\n      this.removeFocus();\r\n      if (this.svgRectTarget) {\r\n        dom.removeClass(this.svgRectTarget, 'blocklyCommentTargetFocused');\r\n      }\r\n      if (this.svgHandleTarget) {\r\n        dom.removeClass(\r\n          this.svgHandleTarget,\r\n          'blocklyCommentHandleTargetFocused',\r\n        );\r\n      }\r\n    }, 0);\r\n  }\r\n\r\n  /**\r\n   * Decode an XML comment tag and create a rendered comment on the workspace.\r\n   *\r\n   * @param xmlComment XML comment element.\r\n   * @param workspace The workspace.\r\n   * @param opt_wsWidth The width of the workspace, which is used to position\r\n   *     comments correctly in RTL.\r\n   * @returns The created workspace comment.\r\n   * @internal\r\n   */\r\n  static fromXmlRendered(\r\n    xmlComment: Element,\r\n    workspace: WorkspaceSvg,\r\n    opt_wsWidth?: number,\r\n  ): WorkspaceCommentSvg {\r\n    eventUtils.disable();\r\n    let comment;\r\n    try {\r\n      const info = WorkspaceComment.parseAttributes(xmlComment);\r\n\r\n      comment = new WorkspaceCommentSvg(\r\n        workspace,\r\n        info.content,\r\n        info.h,\r\n        info.w,\r\n        info.id,\r\n      );\r\n      if (workspace.rendered) {\r\n        comment.initSvg(true);\r\n        comment.render();\r\n      }\r\n      // Position the comment correctly, taking into account the width of a\r\n      // rendered RTL workspace.\r\n      if (!isNaN(info.x) && !isNaN(info.y)) {\r\n        if (workspace.RTL) {\r\n          const wsWidth = opt_wsWidth || workspace.getWidth();\r\n          comment.moveBy(wsWidth - info.x, info.y);\r\n        } else {\r\n          comment.moveBy(info.x, info.y);\r\n        }\r\n      }\r\n    } finally {\r\n      eventUtils.enable();\r\n    }\r\n\r\n    WorkspaceComment.fireCreateEvent(comment);\r\n    return comment;\r\n  }\r\n}\r\n\r\n/** CSS for workspace comment.  See css.js for use. */\r\nCss.register(`\r\n.blocklyCommentForeignObject {\r\n  position: relative;\r\n  z-index: 0;\r\n}\r\n\r\n.blocklyCommentRect {\r\n  fill: #E7DE8E;\r\n  stroke: #bcA903;\r\n  stroke-width: 1px;\r\n}\r\n\r\n.blocklyCommentTarget {\r\n  fill: transparent;\r\n  stroke: #bcA903;\r\n}\r\n\r\n.blocklyCommentTargetFocused {\r\n  fill: none;\r\n}\r\n\r\n.blocklyCommentHandleTarget {\r\n  fill: none;\r\n}\r\n\r\n.blocklyCommentHandleTargetFocused {\r\n  fill: transparent;\r\n}\r\n\r\n.blocklyFocused>.blocklyCommentRect {\r\n  fill: #B9B272;\r\n  stroke: #B9B272;\r\n}\r\n\r\n.blocklySelected>.blocklyCommentTarget {\r\n  stroke: #fc3;\r\n  stroke-width: 3px;\r\n}\r\n\r\n.blocklyCommentDeleteIcon {\r\n  cursor: pointer;\r\n  fill: #000;\r\n  display: none;\r\n}\r\n\r\n.blocklySelected > .blocklyCommentDeleteIcon {\r\n  display: block;\r\n}\r\n\r\n.blocklyDeleteIconShape {\r\n  fill: #000;\r\n  stroke: #000;\r\n  stroke-width: 1px;\r\n}\r\n\r\n.blocklyDeleteIconShape.blocklyDeleteIconHighlighted {\r\n  stroke: #fc3;\r\n}\r\n`);\r\n","/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.serialization.exceptions\r\n\r\nimport type {Block} from '../block.js';\r\nimport type {State} from './blocks.js';\r\n\r\nexport class DeserializationError extends Error {}\r\n\r\n/**\r\n * Represents an error where the serialized state is expected to provide a\r\n * block type, but it is not provided.\r\n *\r\n */\r\nexport class MissingBlockType extends DeserializationError {\r\n  /**\r\n   * @param state The state object which is missing the block type.\r\n   * @internal\r\n   */\r\n  constructor(public state: State) {\r\n    super(`Expected to find a 'type' property, defining the block type`);\r\n  }\r\n}\r\n\r\n/**\r\n * Represents an error where deserialization encountered a block that did\r\n * not have a connection that was defined in the serialized state.\r\n */\r\nexport class MissingConnection extends DeserializationError {\r\n  /**\r\n   * @param connection The name of the connection that is missing. E.g.\r\n   *     'IF0', or 'next'.\r\n   * @param block The block missing the connection.\r\n   * @param state The state object containing the bad connection.\r\n   * @internal\r\n   */\r\n  constructor(\r\n    connection: string,\r\n    public block: Block,\r\n    public state: State,\r\n  ) {\r\n    super(`The block ${block.toDevString()} is missing a(n) ${connection}\r\nconnection`);\r\n  }\r\n}\r\n\r\n/**\r\n * Represents an error where deserialization tried to connect two connections\r\n * that were not compatible.\r\n */\r\nexport class BadConnectionCheck extends DeserializationError {\r\n  /**\r\n   * @param reason The reason the connections were not compatible.\r\n   * @param childConnection The name of the incompatible child connection. E.g.\r\n   *     'output' or 'previous'.\r\n   * @param childBlock The child block that could not connect to its parent.\r\n   * @param childState The state object representing the child block.\r\n   * @internal\r\n   */\r\n  constructor(\r\n    reason: string,\r\n    childConnection: string,\r\n    public childBlock: Block,\r\n    public childState: State,\r\n  ) {\r\n    super(`The block ${childBlock.toDevString()} could not connect its\r\n${childConnection} to its parent, because: ${reason}`);\r\n  }\r\n}\r\n\r\n/**\r\n * Represents an error where deserialization encountered a real block as it\r\n * was deserializing children of a shadow.\r\n * This is an error because it is an invariant of Blockly that shadow blocks\r\n * do not have real children.\r\n */\r\nexport class RealChildOfShadow extends DeserializationError {\r\n  /**\r\n   * @param state The state object representing the real block.\r\n   * @internal\r\n   */\r\n  constructor(public state: State) {\r\n    super(`Encountered a real block which is defined as a child of a shadow\r\nblock. It is an invariant of Blockly that shadow blocks only have shadow\r\nchildren`);\r\n  }\r\n}\r\n\r\nexport class UnregisteredIcon extends DeserializationError {\r\n  /**\r\n   * @param iconType The type of the unregistered icon we are attempting to\r\n   *     deserialize.\r\n   * @param block The block we are attempting to add the unregistered icon to.\r\n   * @param state The state object representing the block.\r\n   */\r\n  constructor(\r\n    iconType: string,\r\n    public block: Block,\r\n    public state: State,\r\n  ) {\r\n    super(\r\n      `Cannot add an icon of type '${iconType}' to the block ` +\r\n        `${block.toDevString()}, because there is no icon registered with ` +\r\n        `type '${iconType}'. Make sure that all of your icons have been ` +\r\n        `registered.`,\r\n    );\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.serialization.priorities\r\n\r\n/**\r\n * The priority for deserializing variables.\r\n */\r\nexport const VARIABLES = 100;\r\n\r\n/**\r\n * The priority for deserializing variable data.\r\n */\r\nexport const PROCEDURES = 75;\r\n\r\n/**\r\n * The priority for deserializing blocks.\r\n */\r\nexport const BLOCKS = 50;\r\n","/**\r\n * @license\r\n * Copyright 2018 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Base class for all types of block events.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.Events.BlockBase\r\n\r\nimport type {Block} from '../block.js';\r\nimport type {Workspace} from '../workspace.js';\r\n\r\nimport {\r\n  Abstract as AbstractEvent,\r\n  AbstractEventJson,\r\n} from './events_abstract.js';\r\n\r\n/**\r\n * Abstract class for any event related to blocks.\r\n */\r\nexport class BlockBase extends AbstractEvent {\r\n  override isBlank = true;\r\n\r\n  /** The ID of the block associated with this event. */\r\n  blockId?: string;\r\n\r\n  /**\r\n   * @param opt_block The block this event corresponds to.\r\n   *     Undefined for a blank event.\r\n   */\r\n  constructor(opt_block?: Block) {\r\n    super();\r\n    this.isBlank = !opt_block;\r\n\r\n    if (!opt_block) return;\r\n\r\n    this.blockId = opt_block.id;\r\n    this.workspaceId = opt_block.workspace.id;\r\n  }\r\n\r\n  /**\r\n   * Encode the event as JSON.\r\n   *\r\n   * @returns JSON representation.\r\n   */\r\n  override toJson(): BlockBaseJson {\r\n    const json = super.toJson() as BlockBaseJson;\r\n    if (!this.blockId) {\r\n      throw new Error(\r\n        'The block ID is undefined. Either pass a block to ' +\r\n          'the constructor, or call fromJson',\r\n      );\r\n    }\r\n    json['blockId'] = this.blockId;\r\n    return json;\r\n  }\r\n\r\n  /**\r\n   * Deserializes the JSON event.\r\n   *\r\n   * @param event The event to append new properties to. Should be a subclass\r\n   *     of BlockBase, but we can't specify that due to the fact that parameters\r\n   *     to static methods in subclasses must be supertypes of parameters to\r\n   *     static methods in superclasses.\r\n   * @internal\r\n   */\r\n  static fromJson(\r\n    json: BlockBaseJson,\r\n    workspace: Workspace,\r\n    event?: any,\r\n  ): BlockBase {\r\n    const newEvent = super.fromJson(\r\n      json,\r\n      workspace,\r\n      event ?? new BlockBase(),\r\n    ) as BlockBase;\r\n    newEvent.blockId = json['blockId'];\r\n    return newEvent;\r\n  }\r\n}\r\n\r\nexport interface BlockBaseJson extends AbstractEventJson {\r\n  blockId: string;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2018 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Class for a block creation event.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.Events.BlockCreate\r\n\r\nimport type {Block} from '../block.js';\r\nimport * as registry from '../registry.js';\r\nimport * as blocks from '../serialization/blocks.js';\r\nimport * as utilsXml from '../utils/xml.js';\r\nimport * as Xml from '../xml.js';\r\n\r\nimport {BlockBase, BlockBaseJson} from './events_block_base.js';\r\nimport * as eventUtils from './utils.js';\r\nimport {Workspace} from '../workspace.js';\r\n\r\n/**\r\n * Notifies listeners when a block (or connected stack of blocks) is\r\n * created.\r\n */\r\nexport class BlockCreate extends BlockBase {\r\n  override type = eventUtils.BLOCK_CREATE;\r\n\r\n  /** The XML representation of the created block(s). */\r\n  xml?: Element | DocumentFragment;\r\n\r\n  /** The JSON respresentation of the created block(s). */\r\n  json?: blocks.State;\r\n\r\n  /** All of the IDs of created blocks. */\r\n  ids?: string[];\r\n\r\n  /** @param opt_block The created block.  Undefined for a blank event. */\r\n  constructor(opt_block?: Block) {\r\n    super(opt_block);\r\n\r\n    if (!opt_block) {\r\n      return; // Blank event to be populated by fromJson.\r\n    }\r\n\r\n    if (opt_block.isShadow()) {\r\n      // Moving shadow blocks is handled via disconnection.\r\n      this.recordUndo = false;\r\n    }\r\n\r\n    this.xml = Xml.blockToDomWithXY(opt_block);\r\n    this.ids = eventUtils.getDescendantIds(opt_block);\r\n\r\n    this.json = blocks.save(opt_block, {addCoordinates: true}) as blocks.State;\r\n  }\r\n\r\n  /**\r\n   * Encode the event as JSON.\r\n   *\r\n   * @returns JSON representation.\r\n   */\r\n  override toJson(): BlockCreateJson {\r\n    const json = super.toJson() as BlockCreateJson;\r\n    if (!this.xml) {\r\n      throw new Error(\r\n        'The block XML is undefined. Either pass a block to ' +\r\n          'the constructor, or call fromJson',\r\n      );\r\n    }\r\n    if (!this.ids) {\r\n      throw new Error(\r\n        'The block IDs are undefined. Either pass a block to ' +\r\n          'the constructor, or call fromJson',\r\n      );\r\n    }\r\n    if (!this.json) {\r\n      throw new Error(\r\n        'The block JSON is undefined. Either pass a block to ' +\r\n          'the constructor, or call fromJson',\r\n      );\r\n    }\r\n    json['xml'] = Xml.domToText(this.xml);\r\n    json['ids'] = this.ids;\r\n    json['json'] = this.json;\r\n    if (!this.recordUndo) {\r\n      json['recordUndo'] = this.recordUndo;\r\n    }\r\n    return json;\r\n  }\r\n\r\n  /**\r\n   * Deserializes the JSON event.\r\n   *\r\n   * @param event The event to append new properties to. Should be a subclass\r\n   *     of BlockCreate, but we can't specify that due to the fact that\r\n   *     parameters to static methods in subclasses must be supertypes of\r\n   *     parameters to static methods in superclasses.\r\n   * @internal\r\n   */\r\n  static fromJson(\r\n    json: BlockCreateJson,\r\n    workspace: Workspace,\r\n    event?: any,\r\n  ): BlockCreate {\r\n    const newEvent = super.fromJson(\r\n      json,\r\n      workspace,\r\n      event ?? new BlockCreate(),\r\n    ) as BlockCreate;\r\n    newEvent.xml = utilsXml.textToDom(json['xml']);\r\n    newEvent.ids = json['ids'];\r\n    newEvent.json = json['json'] as blocks.State;\r\n    if (json['recordUndo'] !== undefined) {\r\n      newEvent.recordUndo = json['recordUndo'];\r\n    }\r\n    return newEvent;\r\n  }\r\n\r\n  /**\r\n   * Run a creation event.\r\n   *\r\n   * @param forward True if run forward, false if run backward (undo).\r\n   */\r\n  override run(forward: boolean) {\r\n    const workspace = this.getEventWorkspace_();\r\n    if (!this.json) {\r\n      throw new Error(\r\n        'The block JSON is undefined. Either pass a block to ' +\r\n          'the constructor, or call fromJson',\r\n      );\r\n    }\r\n    if (!this.ids) {\r\n      throw new Error(\r\n        'The block IDs are undefined. Either pass a block to ' +\r\n          'the constructor, or call fromJson',\r\n      );\r\n    }\r\n    if (allShadowBlocks(workspace, this.ids)) return;\r\n    if (forward) {\r\n      blocks.append(this.json, workspace);\r\n    } else {\r\n      for (let i = 0; i < this.ids.length; i++) {\r\n        const id = this.ids[i];\r\n        const block = workspace.getBlockById(id);\r\n        if (block) {\r\n          block.dispose(false);\r\n        } else if (id === this.blockId) {\r\n          // Only complain about root-level block.\r\n          console.warn(\"Can't uncreate non-existent block: \" + id);\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n/**\r\n * Returns true if all blocks in the list are shadow blocks. If so, that means\r\n * the top-level block being created is a shadow block. This only happens when a\r\n * block that was covering up a shadow block is removed. We don't need to create\r\n * an additional block in that case because the original block still has its\r\n * shadow block.\r\n *\r\n * @param workspace Workspace to check for blocks\r\n * @param ids A list of block ids that were created in this event\r\n * @returns True if all block ids in the list are shadow blocks\r\n */\r\nconst allShadowBlocks = function (\r\n  workspace: Workspace,\r\n  ids: string[],\r\n): boolean {\r\n  const shadows = ids\r\n    .map((id) => workspace.getBlockById(id))\r\n    .filter((block) => block && block.isShadow());\r\n  return shadows.length === ids.length;\r\n};\r\n\r\nexport interface BlockCreateJson extends BlockBaseJson {\r\n  xml: string;\r\n  ids: string[];\r\n  json: object;\r\n  recordUndo?: boolean;\r\n}\r\n\r\nregistry.register(registry.Type.EVENT, eventUtils.CREATE, BlockCreate);\r\n","/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Events fired as a result of a theme update.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.Events.ThemeChange\r\n\r\nimport * as registry from '../registry.js';\r\nimport {AbstractEventJson} from './events_abstract.js';\r\nimport {UiBase} from './events_ui_base.js';\r\nimport * as eventUtils from './utils.js';\r\nimport type {Workspace} from '../workspace.js';\r\n\r\n/**\r\n * Notifies listeners that the workspace theme has changed.\r\n */\r\nexport class ThemeChange extends UiBase {\r\n  /** The name of the new theme that has been set. */\r\n  themeName?: string;\r\n\r\n  override type = eventUtils.THEME_CHANGE;\r\n\r\n  /**\r\n   * @param opt_themeName The theme name. Undefined for a blank event.\r\n   * @param opt_workspaceId The workspace identifier for this event.\r\n   *    event. Undefined for a blank event.\r\n   */\r\n  constructor(opt_themeName?: string, opt_workspaceId?: string) {\r\n    super(opt_workspaceId);\r\n    this.themeName = opt_themeName;\r\n  }\r\n\r\n  /**\r\n   * Encode the event as JSON.\r\n   *\r\n   * @returns JSON representation.\r\n   */\r\n  override toJson(): ThemeChangeJson {\r\n    const json = super.toJson() as ThemeChangeJson;\r\n    if (!this.themeName) {\r\n      throw new Error(\r\n        'The theme name is undefined. Either pass a theme name to ' +\r\n          'the constructor, or call fromJson',\r\n      );\r\n    }\r\n    json['themeName'] = this.themeName;\r\n    return json;\r\n  }\r\n\r\n  /**\r\n   * Deserializes the JSON event.\r\n   *\r\n   * @param event The event to append new properties to. Should be a subclass\r\n   *     of ThemeChange, but we can't specify that due to the fact that\r\n   *     parameters to static methods in subclasses must be supertypes of\r\n   *     parameters to static methods in superclasses.\r\n   * @internal\r\n   */\r\n  static fromJson(\r\n    json: ThemeChangeJson,\r\n    workspace: Workspace,\r\n    event?: any,\r\n  ): ThemeChange {\r\n    const newEvent = super.fromJson(\r\n      json,\r\n      workspace,\r\n      event ?? new ThemeChange(),\r\n    ) as ThemeChange;\r\n    newEvent.themeName = json['themeName'];\r\n    return newEvent;\r\n  }\r\n}\r\n\r\nexport interface ThemeChangeJson extends AbstractEventJson {\r\n  themeName: string;\r\n}\r\n\r\nregistry.register(registry.Type.EVENT, eventUtils.THEME_CHANGE, ThemeChange);\r\n","/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Events fired as a result of a viewport change.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.Events.ViewportChange\r\n\r\nimport * as registry from '../registry.js';\r\nimport {AbstractEventJson} from './events_abstract.js';\r\nimport {UiBase} from './events_ui_base.js';\r\nimport * as eventUtils from './utils.js';\r\nimport type {Workspace} from '../workspace.js';\r\n\r\n/**\r\n * Notifies listeners that the workspace surface's position or scale has\r\n * changed.\r\n *\r\n * Does not notify when the workspace itself resizes.\r\n */\r\nexport class ViewportChange extends UiBase {\r\n  /**\r\n   * Top edge of the visible portion of the workspace, relative to the\r\n   * workspace origin.\r\n   */\r\n  viewTop?: number;\r\n\r\n  /**\r\n   * The left edge of the visible portion of the workspace, relative to\r\n   * the workspace origin.\r\n   */\r\n  viewLeft?: number;\r\n\r\n  /** The scale of the workpace. */\r\n  scale?: number;\r\n\r\n  /** The previous scale of the workspace. */\r\n  oldScale?: number;\r\n\r\n  override type = eventUtils.VIEWPORT_CHANGE;\r\n\r\n  /**\r\n   * @param opt_top Top-edge of the visible portion of the workspace, relative\r\n   *     to the workspace origin. Undefined for a blank event.\r\n   * @param opt_left Left-edge of the visible portion of the workspace relative\r\n   *     to the workspace origin. Undefined for a blank event.\r\n   * @param opt_scale The scale of the workspace. Undefined for a blank event.\r\n   * @param opt_workspaceId The workspace identifier for this event.\r\n   *    Undefined for a blank event.\r\n   * @param opt_oldScale The old scale of the workspace. Undefined for a blank\r\n   *     event.\r\n   */\r\n  constructor(\r\n    opt_top?: number,\r\n    opt_left?: number,\r\n    opt_scale?: number,\r\n    opt_workspaceId?: string,\r\n    opt_oldScale?: number,\r\n  ) {\r\n    super(opt_workspaceId);\r\n\r\n    this.viewTop = opt_top;\r\n    this.viewLeft = opt_left;\r\n    this.scale = opt_scale;\r\n    this.oldScale = opt_oldScale;\r\n  }\r\n\r\n  /**\r\n   * Encode the event as JSON.\r\n   *\r\n   * @returns JSON representation.\r\n   */\r\n  override toJson(): ViewportChangeJson {\r\n    const json = super.toJson() as ViewportChangeJson;\r\n    if (this.viewTop === undefined) {\r\n      throw new Error(\r\n        'The view top is undefined. Either pass a value to ' +\r\n          'the constructor, or call fromJson',\r\n      );\r\n    }\r\n    if (this.viewLeft === undefined) {\r\n      throw new Error(\r\n        'The view left is undefined. Either pass a value to ' +\r\n          'the constructor, or call fromJson',\r\n      );\r\n    }\r\n    if (this.scale === undefined) {\r\n      throw new Error(\r\n        'The scale is undefined. Either pass a value to ' +\r\n          'the constructor, or call fromJson',\r\n      );\r\n    }\r\n    if (this.oldScale === undefined) {\r\n      throw new Error(\r\n        'The old scale is undefined. Either pass a value to ' +\r\n          'the constructor, or call fromJson',\r\n      );\r\n    }\r\n    json['viewTop'] = this.viewTop;\r\n    json['viewLeft'] = this.viewLeft;\r\n    json['scale'] = this.scale;\r\n    json['oldScale'] = this.oldScale;\r\n    return json;\r\n  }\r\n\r\n  /**\r\n   * Deserializes the JSON event.\r\n   *\r\n   * @param event The event to append new properties to. Should be a subclass\r\n   *     of Viewport, but we can't specify that due to the fact that parameters\r\n   *     to static methods in subclasses must be supertypes of parameters to\r\n   *     static methods in superclasses.\r\n   * @internal\r\n   */\r\n  static fromJson(\r\n    json: ViewportChangeJson,\r\n    workspace: Workspace,\r\n    event?: any,\r\n  ): ViewportChange {\r\n    const newEvent = super.fromJson(\r\n      json,\r\n      workspace,\r\n      event ?? new ViewportChange(),\r\n    ) as ViewportChange;\r\n    newEvent.viewTop = json['viewTop'];\r\n    newEvent.viewLeft = json['viewLeft'];\r\n    newEvent.scale = json['scale'];\r\n    newEvent.oldScale = json['oldScale'];\r\n    return newEvent;\r\n  }\r\n}\r\n\r\nexport interface ViewportChangeJson extends AbstractEventJson {\r\n  viewTop: number;\r\n  viewLeft: number;\r\n  scale: number;\r\n  oldScale: number;\r\n}\r\n\r\nregistry.register(\r\n  registry.Type.EVENT,\r\n  eventUtils.VIEWPORT_CHANGE,\r\n  ViewportChange,\r\n);\r\n","/**\r\n * @license\r\n * Copyright 2022 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.config\r\n\r\n/**\r\n * All the values that we expect developers to be able to change\r\n * before injecting Blockly.\r\n */\r\ninterface Config {\r\n  dragRadius: number;\r\n  flyoutDragRadius: number;\r\n  snapRadius: number;\r\n  currentConnectionPreference: number;\r\n  bumpDelay: number;\r\n  connectingSnapRadius: number;\r\n}\r\n\r\n/** Default snap radius. */\r\nconst DEFAULT_SNAP_RADIUS = 28;\r\n\r\n/**\r\n * Object holding all the values on Blockly that we expect developers to be\r\n * able to change.\r\n */\r\nexport const config: Config = {\r\n  /**\r\n   * Number of pixels the mouse must move before a drag starts.\r\n   *\r\n   */\r\n  dragRadius: 5,\r\n  /**\r\n   * Number of pixels the mouse must move before a drag/scroll starts from the\r\n   * flyout.  Because the drag-intention is determined when this is reached, it\r\n   * is larger than dragRadius so that the drag-direction is clearer.\r\n   *\r\n   */\r\n  flyoutDragRadius: 10,\r\n  /**\r\n   * Maximum misalignment between connections for them to snap together.\r\n   *\r\n   */\r\n  snapRadius: DEFAULT_SNAP_RADIUS,\r\n  /**\r\n   * Maximum misalignment between connections for them to snap together.\r\n   * This should be the same as the snap radius.\r\n   *\r\n   * @deprecated v11 - This is no longer used. Use snapRadius instead.\r\n   */\r\n  connectingSnapRadius: DEFAULT_SNAP_RADIUS,\r\n  /**\r\n   * How much to prefer staying connected to the current connection over moving\r\n   * to a new connection.  The current previewed connection is considered to be\r\n   * this much closer to the matching connection on the block than it actually\r\n   * is.\r\n   *\r\n   */\r\n  currentConnectionPreference: 8,\r\n  /**\r\n   * Delay in ms between trigger and bumping unconnected block out of alignment.\r\n   *\r\n   */\r\n  bumpDelay: 250,\r\n};\r\n","/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.ConnectionType\r\n\r\n/**\r\n * Enum for the type of a connection or input.\r\n */\r\nexport enum ConnectionType {\r\n  // A right-facing value input.  E.g. 'set item to' or 'return'.\r\n  INPUT_VALUE = 1,\r\n  // A left-facing value output.  E.g. 'random fraction'.\r\n  OUTPUT_VALUE,\r\n  // A down-facing block stack.  E.g. 'if-do' or 'else'.\r\n  NEXT_STATEMENT,\r\n  // An up-facing block stack.  E.g. 'break out of loop'.\r\n  PREVIOUS_STATEMENT,\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2011 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * A database of all the rendered connections that could\r\n *    possibly be connected to (i.e. not collapsed, etc).\r\n *    Sorted by y coordinate.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.ConnectionDB\r\n\r\nimport {ConnectionType} from './connection_type.js';\r\nimport type {IConnectionChecker} from './interfaces/i_connection_checker.js';\r\nimport type {RenderedConnection} from './rendered_connection.js';\r\nimport type {Coordinate} from './utils/coordinate.js';\r\n\r\n/**\r\n * Database of connections.\r\n * Connections are stored in order of their vertical component.  This way\r\n * connections in an area may be looked up quickly using a binary search.\r\n */\r\nexport class ConnectionDB {\r\n  /** Array of connections sorted by y position in workspace units. */\r\n  private readonly connections: RenderedConnection[] = [];\r\n\r\n  /**\r\n   * @param connectionChecker The workspace's connection type checker, used to\r\n   *     decide if connections are valid during a drag.\r\n   */\r\n  constructor(private readonly connectionChecker: IConnectionChecker) {}\r\n\r\n  /**\r\n   * Add a connection to the database. Should not already exist in the database.\r\n   *\r\n   * @param connection The connection to be added.\r\n   * @param yPos The y position used to decide where to insert the connection.\r\n   * @internal\r\n   */\r\n  addConnection(connection: RenderedConnection, yPos: number) {\r\n    const index = this.calculateIndexForYPos(yPos);\r\n    this.connections.splice(index, 0, connection);\r\n  }\r\n\r\n  /**\r\n   * Finds the index of the given connection.\r\n   *\r\n   * Starts by doing a binary search to find the approximate location, then\r\n   * linearly searches nearby for the exact connection.\r\n   *\r\n   * @param conn The connection to find.\r\n   * @param yPos The y position used to find the index of the connection.\r\n   * @returns The index of the connection, or -1 if the connection was not\r\n   *     found.\r\n   */\r\n  private findIndexOfConnection(\r\n    conn: RenderedConnection,\r\n    yPos: number,\r\n  ): number {\r\n    if (!this.connections.length) {\r\n      return -1;\r\n    }\r\n\r\n    const bestGuess = this.calculateIndexForYPos(yPos);\r\n    if (bestGuess >= this.connections.length) {\r\n      // Not in list\r\n      return -1;\r\n    }\r\n\r\n    yPos = conn.y;\r\n    // Walk forward and back on the y axis looking for the connection.\r\n    let pointer = bestGuess;\r\n    while (pointer >= 0 && this.connections[pointer].y === yPos) {\r\n      if (this.connections[pointer] === conn) {\r\n        return pointer;\r\n      }\r\n      pointer--;\r\n    }\r\n\r\n    pointer = bestGuess;\r\n    while (\r\n      pointer < this.connections.length &&\r\n      this.connections[pointer].y === yPos\r\n    ) {\r\n      if (this.connections[pointer] === conn) {\r\n        return pointer;\r\n      }\r\n      pointer++;\r\n    }\r\n    return -1;\r\n  }\r\n\r\n  /**\r\n   * Finds the correct index for the given y position.\r\n   *\r\n   * @param yPos The y position used to decide where to insert the connection.\r\n   * @returns The candidate index.\r\n   */\r\n  private calculateIndexForYPos(yPos: number): number {\r\n    if (!this.connections.length) {\r\n      return 0;\r\n    }\r\n    let pointerMin = 0;\r\n    let pointerMax = this.connections.length;\r\n    while (pointerMin < pointerMax) {\r\n      const pointerMid = Math.floor((pointerMin + pointerMax) / 2);\r\n      if (this.connections[pointerMid].y < yPos) {\r\n        pointerMin = pointerMid + 1;\r\n      } else if (this.connections[pointerMid].y > yPos) {\r\n        pointerMax = pointerMid;\r\n      } else {\r\n        pointerMin = pointerMid;\r\n        break;\r\n      }\r\n    }\r\n    return pointerMin;\r\n  }\r\n\r\n  /**\r\n   * Remove a connection from the database.  Must already exist in DB.\r\n   *\r\n   * @param connection The connection to be removed.\r\n   * @param yPos The y position used to find the index of the connection.\r\n   * @throws {Error} If the connection cannot be found in the database.\r\n   */\r\n  removeConnection(connection: RenderedConnection, yPos: number) {\r\n    const index = this.findIndexOfConnection(connection, yPos);\r\n    if (index === -1) {\r\n      throw Error('Unable to find connection in connectionDB.');\r\n    }\r\n    this.connections.splice(index, 1);\r\n  }\r\n\r\n  /**\r\n   * Find all nearby connections to the given connection.\r\n   * Type checking does not apply, since this function is used for bumping.\r\n   *\r\n   * @param connection The connection whose neighbours should be returned.\r\n   * @param maxRadius The maximum radius to another connection.\r\n   * @returns List of connections.\r\n   */\r\n  getNeighbours(\r\n    connection: RenderedConnection,\r\n    maxRadius: number,\r\n  ): RenderedConnection[] {\r\n    const db = this.connections;\r\n    const currentX = connection.x;\r\n    const currentY = connection.y;\r\n\r\n    // Binary search to find the closest y location.\r\n    let pointerMin = 0;\r\n    let pointerMax = db.length - 2;\r\n    let pointerMid = pointerMax;\r\n    while (pointerMin < pointerMid) {\r\n      if (db[pointerMid].y < currentY) {\r\n        pointerMin = pointerMid;\r\n      } else {\r\n        pointerMax = pointerMid;\r\n      }\r\n      pointerMid = Math.floor((pointerMin + pointerMax) / 2);\r\n    }\r\n\r\n    const neighbours: RenderedConnection[] = [];\r\n    /**\r\n     * Computes if the current connection is within the allowed radius of\r\n     * another connection. This function is a closure and has access to outside\r\n     * variables.\r\n     *\r\n     * @param yIndex The other connection's index in the database.\r\n     * @returns True if the current connection's vertical distance from the\r\n     *     other connection is less than the allowed radius.\r\n     */\r\n    function checkConnection(yIndex: number): boolean {\r\n      const dx = currentX - db[yIndex].x;\r\n      const dy = currentY - db[yIndex].y;\r\n      const r = Math.sqrt(dx * dx + dy * dy);\r\n      if (r <= maxRadius) {\r\n        neighbours.push(db[yIndex]);\r\n      }\r\n      return dy < maxRadius;\r\n    }\r\n\r\n    // Walk forward and back on the y axis looking for the closest x,y point.\r\n    pointerMin = pointerMid;\r\n    pointerMax = pointerMid;\r\n    if (db.length) {\r\n      while (pointerMin >= 0 && checkConnection(pointerMin)) {\r\n        pointerMin--;\r\n      }\r\n      do {\r\n        pointerMax++;\r\n      } while (pointerMax < db.length && checkConnection(pointerMax));\r\n    }\r\n\r\n    return neighbours;\r\n  }\r\n\r\n  /**\r\n   * Is the candidate connection close to the reference connection.\r\n   * Extremely fast; only looks at Y distance.\r\n   *\r\n   * @param index Index in database of candidate connection.\r\n   * @param baseY Reference connection's Y value.\r\n   * @param maxRadius The maximum radius to another connection.\r\n   * @returns True if connection is in range.\r\n   */\r\n  private isInYRange(index: number, baseY: number, maxRadius: number): boolean {\r\n    return Math.abs(this.connections[index].y - baseY) <= maxRadius;\r\n  }\r\n\r\n  /**\r\n   * Find the closest compatible connection to this connection.\r\n   *\r\n   * @param conn The connection searching for a compatible mate.\r\n   * @param maxRadius The maximum radius to another connection.\r\n   * @param dxy Offset between this connection's location in the database and\r\n   *     the current location (as a result of dragging).\r\n   * @returns Contains two properties: 'connection' which is either another\r\n   *     connection or null, and 'radius' which is the distance.\r\n   */\r\n  searchForClosest(\r\n    conn: RenderedConnection,\r\n    maxRadius: number,\r\n    dxy: Coordinate,\r\n  ): {connection: RenderedConnection | null; radius: number} {\r\n    if (!this.connections.length) {\r\n      // Don't bother.\r\n      return {connection: null, radius: maxRadius};\r\n    }\r\n\r\n    // Stash the values of x and y from before the drag.\r\n    const baseY = conn.y;\r\n    const baseX = conn.x;\r\n\r\n    conn.x = baseX + dxy.x;\r\n    conn.y = baseY + dxy.y;\r\n\r\n    // calculateIndexForYPos_ finds an index for insertion, which is always\r\n    // after any block with the same y index.  We want to search both forward\r\n    // and back, so search on both sides of the index.\r\n    const closestIndex = this.calculateIndexForYPos(conn.y);\r\n\r\n    let bestConnection = null;\r\n    let bestRadius = maxRadius;\r\n    let temp;\r\n\r\n    // Walk forward and back on the y axis looking for the closest x,y point.\r\n    let pointerMin = closestIndex - 1;\r\n    while (pointerMin >= 0 && this.isInYRange(pointerMin, conn.y, maxRadius)) {\r\n      temp = this.connections[pointerMin];\r\n      if (this.connectionChecker.canConnect(conn, temp, true, bestRadius)) {\r\n        bestConnection = temp;\r\n        bestRadius = temp.distanceFrom(conn);\r\n      }\r\n      pointerMin--;\r\n    }\r\n\r\n    let pointerMax = closestIndex;\r\n    while (\r\n      pointerMax < this.connections.length &&\r\n      this.isInYRange(pointerMax, conn.y, maxRadius)\r\n    ) {\r\n      temp = this.connections[pointerMax];\r\n      if (this.connectionChecker.canConnect(conn, temp, true, bestRadius)) {\r\n        bestConnection = temp;\r\n        bestRadius = temp.distanceFrom(conn);\r\n      }\r\n      pointerMax++;\r\n    }\r\n\r\n    // Reset the values of x and y.\r\n    conn.x = baseX;\r\n    conn.y = baseY;\r\n    // If there were no valid connections, bestConnection will be null.\r\n    return {connection: bestConnection, radius: bestRadius};\r\n  }\r\n\r\n  /**\r\n   * Initialize a set of connection DBs for a workspace.\r\n   *\r\n   * @param checker The workspace's connection checker, used to decide if\r\n   *     connections are valid during a drag.\r\n   * @returns Array of databases.\r\n   */\r\n  static init(checker: IConnectionChecker): ConnectionDB[] {\r\n    // Create four databases, one for each connection type.\r\n    const dbList = [];\r\n    dbList[ConnectionType.INPUT_VALUE] = new ConnectionDB(checker);\r\n    dbList[ConnectionType.OUTPUT_VALUE] = new ConnectionDB(checker);\r\n    dbList[ConnectionType.NEXT_STATEMENT] = new ConnectionDB(checker);\r\n    dbList[ConnectionType.PREVIOUS_STATEMENT] = new ConnectionDB(checker);\r\n    return dbList;\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Blockly menu similar to Closure's goog.ui.Menu\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.Menu\r\n\r\nimport * as browserEvents from './browser_events.js';\r\nimport type {MenuItem} from './menuitem.js';\r\nimport * as aria from './utils/aria.js';\r\nimport {Coordinate} from './utils/coordinate.js';\r\nimport * as dom from './utils/dom.js';\r\nimport type {Size} from './utils/size.js';\r\nimport * as style from './utils/style.js';\r\n\r\n/**\r\n * A basic menu class.\r\n */\r\nexport class Menu {\r\n  /**\r\n   * Array of menu items.\r\n   * (Nulls are never in the array, but typing the array as nullable prevents\r\n   * the compiler from objecting to .indexOf(null))\r\n   */\r\n  private readonly menuItems: MenuItem[] = [];\r\n\r\n  /**\r\n   * Coordinates of the mousedown event that caused this menu to open. Used to\r\n   * prevent the consequent mouseup event due to a simple click from\r\n   * activating a menu item immediately.\r\n   */\r\n  openingCoords: Coordinate | null = null;\r\n\r\n  /**\r\n   * This is the element that we will listen to the real focus events on.\r\n   * A value of null means no menu item is highlighted.\r\n   */\r\n  private highlightedItem: MenuItem | null = null;\r\n\r\n  /** Mouse over event data. */\r\n  private mouseOverHandler: browserEvents.Data | null = null;\r\n\r\n  /** Click event data. */\r\n  private clickHandler: browserEvents.Data | null = null;\r\n\r\n  /** Mouse enter event data. */\r\n  private mouseEnterHandler: browserEvents.Data | null = null;\r\n\r\n  /** Mouse leave event data. */\r\n  private mouseLeaveHandler: browserEvents.Data | null = null;\r\n\r\n  /** Key down event data. */\r\n  private onKeyDownHandler: browserEvents.Data | null = null;\r\n\r\n  /** The menu's root DOM element. */\r\n  private element: HTMLDivElement | null = null;\r\n\r\n  /** ARIA name for this menu. */\r\n  private roleName: aria.Role | null = null;\r\n\r\n  /** Constructs a new Menu instance. */\r\n  constructor() {}\r\n\r\n  /**\r\n   * Add a new menu item to the bottom of this menu.\r\n   *\r\n   * @param menuItem Menu item to append.\r\n   * @internal\r\n   */\r\n  addChild(menuItem: MenuItem) {\r\n    this.menuItems.push(menuItem);\r\n  }\r\n\r\n  /**\r\n   * Creates the menu DOM.\r\n   *\r\n   * @param container Element upon which to append this menu.\r\n   * @returns The menu's root DOM element.\r\n   */\r\n  render(container: Element): HTMLDivElement {\r\n    const element = document.createElement('div');\r\n    // goog-menu is deprecated, use blocklyMenu.  May 2020.\r\n    element.className = 'blocklyMenu goog-menu blocklyNonSelectable';\r\n    element.tabIndex = 0;\r\n    if (this.roleName) {\r\n      aria.setRole(element, this.roleName);\r\n    }\r\n    this.element = element;\r\n\r\n    // Add menu items.\r\n    for (let i = 0, menuItem; (menuItem = this.menuItems[i]); i++) {\r\n      element.appendChild(menuItem.createDom());\r\n    }\r\n\r\n    // Add event handlers.\r\n    this.mouseOverHandler = browserEvents.conditionalBind(\r\n      element,\r\n      'pointerover',\r\n      this,\r\n      this.handleMouseOver,\r\n      true,\r\n    );\r\n    this.clickHandler = browserEvents.conditionalBind(\r\n      element,\r\n      'pointerup',\r\n      this,\r\n      this.handleClick,\r\n      true,\r\n    );\r\n    this.mouseEnterHandler = browserEvents.conditionalBind(\r\n      element,\r\n      'pointerenter',\r\n      this,\r\n      this.handleMouseEnter,\r\n      true,\r\n    );\r\n    this.mouseLeaveHandler = browserEvents.conditionalBind(\r\n      element,\r\n      'pointerleave',\r\n      this,\r\n      this.handleMouseLeave,\r\n      true,\r\n    );\r\n    this.onKeyDownHandler = browserEvents.conditionalBind(\r\n      element,\r\n      'keydown',\r\n      this,\r\n      this.handleKeyEvent,\r\n    );\r\n\r\n    container.appendChild(element);\r\n    return element;\r\n  }\r\n\r\n  /**\r\n   * Gets the menu's element.\r\n   *\r\n   * @returns The DOM element.\r\n   * @internal\r\n   */\r\n  getElement(): HTMLDivElement | null {\r\n    return this.element;\r\n  }\r\n\r\n  /**\r\n   * Focus the menu element.\r\n   *\r\n   * @internal\r\n   */\r\n  focus() {\r\n    const el = this.getElement();\r\n    if (el) {\r\n      el.focus({preventScroll: true});\r\n      dom.addClass(el, 'blocklyFocused');\r\n    }\r\n  }\r\n\r\n  /** Blur the menu element. */\r\n  private blur() {\r\n    const el = this.getElement();\r\n    if (el) {\r\n      el.blur();\r\n      dom.removeClass(el, 'blocklyFocused');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set the menu accessibility role.\r\n   *\r\n   * @param roleName role name.\r\n   * @internal\r\n   */\r\n  setRole(roleName: aria.Role) {\r\n    this.roleName = roleName;\r\n  }\r\n\r\n  /** Dispose of this menu. */\r\n  dispose() {\r\n    // Remove event handlers.\r\n    if (this.mouseOverHandler) {\r\n      browserEvents.unbind(this.mouseOverHandler);\r\n      this.mouseOverHandler = null;\r\n    }\r\n    if (this.clickHandler) {\r\n      browserEvents.unbind(this.clickHandler);\r\n      this.clickHandler = null;\r\n    }\r\n    if (this.mouseEnterHandler) {\r\n      browserEvents.unbind(this.mouseEnterHandler);\r\n      this.mouseEnterHandler = null;\r\n    }\r\n    if (this.mouseLeaveHandler) {\r\n      browserEvents.unbind(this.mouseLeaveHandler);\r\n      this.mouseLeaveHandler = null;\r\n    }\r\n    if (this.onKeyDownHandler) {\r\n      browserEvents.unbind(this.onKeyDownHandler);\r\n      this.onKeyDownHandler = null;\r\n    }\r\n\r\n    // Remove menu items.\r\n    for (let i = 0, menuItem; (menuItem = this.menuItems[i]); i++) {\r\n      menuItem.dispose();\r\n    }\r\n    this.element = null;\r\n  }\r\n\r\n  // Child component management.\r\n\r\n  /**\r\n   * Returns the child menu item that owns the given DOM element,\r\n   * or null if no such menu item is found.\r\n   *\r\n   * @param elem DOM element whose owner is to be returned.\r\n   * @returns Menu item for which the DOM element belongs to.\r\n   */\r\n  private getMenuItem(elem: Element): MenuItem | null {\r\n    const menuElem = this.getElement();\r\n    // Node might be the menu border (resulting in no associated menu item), or\r\n    // a menu item's div, or some element within the menu item.\r\n    // Walk up parents until one meets either the menu's root element, or\r\n    // a menu item's div.\r\n    let currentElement: Element | null = elem;\r\n    while (currentElement && currentElement !== menuElem) {\r\n      if (currentElement.classList.contains('blocklyMenuItem')) {\r\n        // Having found a menu item's div, locate that menu item in this menu.\r\n        for (let i = 0, menuItem; (menuItem = this.menuItems[i]); i++) {\r\n          if (menuItem.getElement() === currentElement) {\r\n            return menuItem;\r\n          }\r\n        }\r\n      }\r\n      currentElement = currentElement.parentElement;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  // Highlight management.\r\n\r\n  /**\r\n   * Highlights the given menu item, or clears highlighting if null.\r\n   *\r\n   * @param item Item to highlight, or null.\r\n   * @internal\r\n   */\r\n  setHighlighted(item: MenuItem | null) {\r\n    const currentHighlighted = this.highlightedItem;\r\n    if (currentHighlighted) {\r\n      currentHighlighted.setHighlighted(false);\r\n      this.highlightedItem = null;\r\n    }\r\n    if (item) {\r\n      item.setHighlighted(true);\r\n      this.highlightedItem = item;\r\n      // Bring the highlighted item into view. This has no effect if the menu is\r\n      // not scrollable.\r\n      const el = this.getElement() as Element;\r\n      style.scrollIntoContainerView(item.getElement() as Element, el);\r\n\r\n      aria.setState(el, aria.State.ACTIVEDESCENDANT, item.getId());\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Highlights the next highlightable item (or the first if nothing is\r\n   * currently highlighted).\r\n   *\r\n   * @internal\r\n   */\r\n  highlightNext() {\r\n    const index = this.highlightedItem\r\n      ? this.menuItems.indexOf(this.highlightedItem)\r\n      : -1;\r\n    this.highlightHelper(index, 1);\r\n  }\r\n\r\n  /**\r\n   * Highlights the previous highlightable item (or the last if nothing is\r\n   * currently highlighted).\r\n   *\r\n   * @internal\r\n   */\r\n  highlightPrevious() {\r\n    const index = this.highlightedItem\r\n      ? this.menuItems.indexOf(this.highlightedItem)\r\n      : -1;\r\n    this.highlightHelper(index < 0 ? this.menuItems.length : index, -1);\r\n  }\r\n\r\n  /** Highlights the first highlightable item. */\r\n  private highlightFirst() {\r\n    this.highlightHelper(-1, 1);\r\n  }\r\n\r\n  /** Highlights the last highlightable item. */\r\n  private highlightLast() {\r\n    this.highlightHelper(this.menuItems.length, -1);\r\n  }\r\n\r\n  /**\r\n   * Helper function that manages the details of moving the highlight among\r\n   * child menuitems in response to keyboard events.\r\n   *\r\n   * @param startIndex Start index.\r\n   * @param delta Step direction: 1 to go down, -1 to go up.\r\n   */\r\n  private highlightHelper(startIndex: number, delta: number) {\r\n    let index = startIndex + delta;\r\n    let menuItem;\r\n    while ((menuItem = this.menuItems[index])) {\r\n      if (menuItem.isEnabled()) {\r\n        this.setHighlighted(menuItem);\r\n        break;\r\n      }\r\n      index += delta;\r\n    }\r\n  }\r\n\r\n  // Mouse events.\r\n\r\n  /**\r\n   * Handles mouseover events. Highlight menuitems as the user hovers over them.\r\n   *\r\n   * @param e Mouse event to handle.\r\n   */\r\n  private handleMouseOver(e: PointerEvent) {\r\n    const menuItem = this.getMenuItem(e.target as Element);\r\n\r\n    if (menuItem) {\r\n      if (menuItem.isEnabled()) {\r\n        if (this.highlightedItem !== menuItem) {\r\n          this.setHighlighted(menuItem);\r\n        }\r\n      } else {\r\n        this.setHighlighted(null);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles click events. Pass the event onto the child menuitem to handle.\r\n   *\r\n   * @param e Click event to handle.\r\n   */\r\n  private handleClick(e: PointerEvent) {\r\n    const oldCoords = this.openingCoords;\r\n    // Clear out the saved opening coords immediately so they're not used twice.\r\n    this.openingCoords = null;\r\n    if (oldCoords && typeof e.clientX === 'number') {\r\n      const newCoords = new Coordinate(e.clientX, e.clientY);\r\n      if (Coordinate.distance(oldCoords, newCoords) < 1) {\r\n        // This menu was opened by a mousedown and we're handling the consequent\r\n        // click event. The coords haven't changed, meaning this was the same\r\n        // opening event. Don't do the usual behavior because the menu just\r\n        // popped up under the mouse and the user didn't mean to activate this\r\n        // item.\r\n        return;\r\n      }\r\n    }\r\n\r\n    const menuItem = this.getMenuItem(e.target as Element);\r\n    if (menuItem) {\r\n      menuItem.performAction();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles mouse enter events. Focus the element.\r\n   *\r\n   * @param _e Mouse event to handle.\r\n   */\r\n  private handleMouseEnter(_e: PointerEvent) {\r\n    this.focus();\r\n  }\r\n\r\n  /**\r\n   * Handles mouse leave events. Blur and clear highlight.\r\n   *\r\n   * @param _e Mouse event to handle.\r\n   */\r\n  private handleMouseLeave(_e: PointerEvent) {\r\n    if (this.getElement()) {\r\n      this.blur();\r\n      this.setHighlighted(null);\r\n    }\r\n  }\r\n\r\n  // Keyboard events.\r\n\r\n  /**\r\n   * Attempts to handle a keyboard event, if the menu item is enabled, by\r\n   * calling\r\n   * {@link Menu#handleKeyEventInternal_}.\r\n   *\r\n   * @param e Key event to handle.\r\n   */\r\n  private handleKeyEvent(e: Event) {\r\n    if (!this.menuItems.length) {\r\n      // Empty menu.\r\n      return;\r\n    }\r\n    const keyboardEvent = e as KeyboardEvent;\r\n    if (\r\n      keyboardEvent.shiftKey ||\r\n      keyboardEvent.ctrlKey ||\r\n      keyboardEvent.metaKey ||\r\n      keyboardEvent.altKey\r\n    ) {\r\n      // Do not handle the key event if any modifier key is pressed.\r\n      return;\r\n    }\r\n\r\n    const highlighted = this.highlightedItem;\r\n    switch (keyboardEvent.key) {\r\n      case 'Enter':\r\n      case ' ':\r\n        if (highlighted) {\r\n          highlighted.performAction();\r\n        }\r\n        break;\r\n\r\n      case 'ArrowUp':\r\n        this.highlightPrevious();\r\n        break;\r\n\r\n      case 'ArrowDown':\r\n        this.highlightNext();\r\n        break;\r\n\r\n      case 'PageUp':\r\n      case 'Home':\r\n        this.highlightFirst();\r\n        break;\r\n\r\n      case 'PageDown':\r\n      case 'End':\r\n        this.highlightLast();\r\n        break;\r\n\r\n      default:\r\n        // Not a key the menu is interested in.\r\n        return;\r\n    }\r\n    // The menu used this key, don't let it have secondary effects.\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n  }\r\n\r\n  /**\r\n   * Get the size of a rendered menu.\r\n   *\r\n   * @returns Object with width and height properties.\r\n   * @internal\r\n   */\r\n  getSize(): Size {\r\n    const menuDom = this.getElement() as HTMLDivElement;\r\n    const menuSize = style.getSize(menuDom);\r\n    // Recalculate height for the total content, not only box height.\r\n    menuSize.height = menuDom.scrollHeight;\r\n    return menuSize;\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Blockly menu item similar to Closure's goog.ui.MenuItem\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.MenuItem\r\n\r\nimport * as aria from './utils/aria.js';\r\nimport * as dom from './utils/dom.js';\r\nimport * as idGenerator from './utils/idgenerator.js';\r\n\r\n/**\r\n * Class representing an item in a menu.\r\n */\r\nexport class MenuItem {\r\n  /** Is the menu item clickable, as opposed to greyed-out. */\r\n  private enabled = true;\r\n\r\n  /** The DOM element for the menu item. */\r\n  private element: HTMLDivElement | null = null;\r\n\r\n  /** Whether the menu item is rendered right-to-left. */\r\n  private rightToLeft = false;\r\n\r\n  /** ARIA name for this menu. */\r\n  private roleName: aria.Role | null = null;\r\n\r\n  /** Is this menu item checkable. */\r\n  private checkable = false;\r\n\r\n  /** Is this menu item currently checked. */\r\n  private checked = false;\r\n\r\n  /** Is this menu item currently highlighted. */\r\n  private highlight = false;\r\n\r\n  /** Bound function to call when this menu item is clicked. */\r\n  private actionHandler: Function | null = null;\r\n\r\n  /**\r\n   * @param content Text caption to display as the content of the item, or a\r\n   *     HTML element to display.\r\n   * @param opt_value Data/model associated with the menu item.\r\n   */\r\n  constructor(\r\n    private readonly content: string | HTMLElement,\r\n    private readonly opt_value?: string,\r\n  ) {}\r\n\r\n  /**\r\n   * Creates the menuitem's DOM.\r\n   *\r\n   * @returns Completed DOM.\r\n   */\r\n  createDom(): Element {\r\n    const element = document.createElement('div');\r\n    element.id = idGenerator.getNextUniqueId();\r\n    this.element = element;\r\n\r\n    // Set class and style\r\n    // goog-menuitem* is deprecated, use blocklyMenuItem*.  May 2020.\r\n    element.className =\r\n      'blocklyMenuItem goog-menuitem ' +\r\n      (this.enabled ? '' : 'blocklyMenuItemDisabled goog-menuitem-disabled ') +\r\n      (this.checked ? 'blocklyMenuItemSelected goog-option-selected ' : '') +\r\n      (this.highlight\r\n        ? 'blocklyMenuItemHighlight goog-menuitem-highlight '\r\n        : '') +\r\n      (this.rightToLeft ? 'blocklyMenuItemRtl goog-menuitem-rtl ' : '');\r\n\r\n    const content = document.createElement('div');\r\n    content.className = 'blocklyMenuItemContent goog-menuitem-content';\r\n    // Add a checkbox for checkable menu items.\r\n    if (this.checkable) {\r\n      const checkbox = document.createElement('div');\r\n      checkbox.className = 'blocklyMenuItemCheckbox goog-menuitem-checkbox';\r\n      content.appendChild(checkbox);\r\n    }\r\n\r\n    let contentDom: Node = this.content as HTMLElement;\r\n    if (typeof this.content === 'string') {\r\n      contentDom = document.createTextNode(this.content);\r\n    }\r\n    content.appendChild(contentDom);\r\n    element.appendChild(content);\r\n\r\n    // Initialize ARIA role and state.\r\n    if (this.roleName) {\r\n      aria.setRole(element, this.roleName);\r\n    }\r\n    aria.setState(\r\n      element,\r\n      aria.State.SELECTED,\r\n      (this.checkable && this.checked) || false,\r\n    );\r\n    aria.setState(element, aria.State.DISABLED, !this.enabled);\r\n\r\n    return element;\r\n  }\r\n\r\n  /** Dispose of this menu item. */\r\n  dispose() {\r\n    this.element = null;\r\n  }\r\n\r\n  /**\r\n   * Gets the menu item's element.\r\n   *\r\n   * @returns The DOM element.\r\n   * @internal\r\n   */\r\n  getElement(): Element | null {\r\n    return this.element;\r\n  }\r\n\r\n  /**\r\n   * Gets the unique ID for this menu item.\r\n   *\r\n   * @returns Unique component ID.\r\n   * @internal\r\n   */\r\n  getId(): string {\r\n    return this.element!.id;\r\n  }\r\n\r\n  /**\r\n   * Gets the value associated with the menu item.\r\n   *\r\n   * @returns value Value associated with the menu item.\r\n   * @internal\r\n   */\r\n  getValue(): string | null {\r\n    return this.opt_value ?? null;\r\n  }\r\n\r\n  /**\r\n   * Set menu item's rendering direction.\r\n   *\r\n   * @param rtl True if RTL, false if LTR.\r\n   * @internal\r\n   */\r\n  setRightToLeft(rtl: boolean) {\r\n    this.rightToLeft = rtl;\r\n  }\r\n\r\n  /**\r\n   * Set the menu item's accessibility role.\r\n   *\r\n   * @param roleName Role name.\r\n   * @internal\r\n   */\r\n  setRole(roleName: aria.Role) {\r\n    this.roleName = roleName;\r\n  }\r\n\r\n  /**\r\n   * Sets the menu item to be checkable or not. Set to true for menu items\r\n   * that represent checkable options.\r\n   *\r\n   * @param checkable Whether the menu item is checkable.\r\n   * @internal\r\n   */\r\n  setCheckable(checkable: boolean) {\r\n    this.checkable = checkable;\r\n  }\r\n\r\n  /**\r\n   * Checks or unchecks the component.\r\n   *\r\n   * @param checked Whether to check or uncheck the component.\r\n   * @internal\r\n   */\r\n  setChecked(checked: boolean) {\r\n    this.checked = checked;\r\n  }\r\n\r\n  /**\r\n   * Highlights or unhighlights the component.\r\n   *\r\n   * @param highlight Whether to highlight or unhighlight the component.\r\n   * @internal\r\n   */\r\n  setHighlighted(highlight: boolean) {\r\n    this.highlight = highlight;\r\n\r\n    const el = this.getElement();\r\n    if (el && this.isEnabled()) {\r\n      // goog-menuitem-highlight is deprecated, use blocklyMenuItemHighlight.\r\n      // May 2020.\r\n      const name = 'blocklyMenuItemHighlight';\r\n      const nameDep = 'goog-menuitem-highlight';\r\n      if (highlight) {\r\n        dom.addClass(el, name);\r\n        dom.addClass(el, nameDep);\r\n      } else {\r\n        dom.removeClass(el, name);\r\n        dom.removeClass(el, nameDep);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns true if the menu item is enabled, false otherwise.\r\n   *\r\n   * @returns Whether the menu item is enabled.\r\n   * @internal\r\n   */\r\n  isEnabled(): boolean {\r\n    return this.enabled;\r\n  }\r\n\r\n  /**\r\n   * Enables or disables the menu item.\r\n   *\r\n   * @param enabled Whether to enable or disable the menu item.\r\n   * @internal\r\n   */\r\n  setEnabled(enabled: boolean) {\r\n    this.enabled = enabled;\r\n  }\r\n\r\n  /**\r\n   * Performs the appropriate action when the menu item is activated\r\n   * by the user.\r\n   *\r\n   * @internal\r\n   */\r\n  performAction() {\r\n    if (this.isEnabled() && this.actionHandler) {\r\n      this.actionHandler(this);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set the handler that's called when the menu item is activated by the user.\r\n   * `obj` will be used as the 'this' object in the function when called.\r\n   *\r\n   * @param fn The handler.\r\n   * @param obj Used as the 'this' object in fn when called.\r\n   * @internal\r\n   */\r\n  onAction(fn: (p1: MenuItem) => void, obj: object) {\r\n    this.actionHandler = fn.bind(obj);\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Registry for context menu option items.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.ContextMenuRegistry\r\n\r\nimport type {BlockSvg} from './block_svg.js';\r\nimport type {WorkspaceSvg} from './workspace_svg.js';\r\n\r\n/**\r\n * Class for the registry of context menu items. This is intended to be a\r\n * singleton. You should not create a new instance, and only access this class\r\n * from ContextMenuRegistry.registry.\r\n */\r\nexport class ContextMenuRegistry {\r\n  static registry: ContextMenuRegistry;\r\n  /** Registry of all registered RegistryItems, keyed by ID. */\r\n  private registry_ = new Map<string, RegistryItem>();\r\n\r\n  /** Resets the existing singleton instance of ContextMenuRegistry. */\r\n  constructor() {\r\n    this.reset();\r\n  }\r\n\r\n  /** Clear and recreate the registry. */\r\n  reset() {\r\n    this.registry_.clear();\r\n  }\r\n\r\n  /**\r\n   * Registers a RegistryItem.\r\n   *\r\n   * @param item Context menu item to register.\r\n   * @throws {Error} if an item with the given ID already exists.\r\n   */\r\n  register(item: RegistryItem) {\r\n    if (this.registry_.has(item.id)) {\r\n      throw Error('Menu item with ID \"' + item.id + '\" is already registered.');\r\n    }\r\n    this.registry_.set(item.id, item);\r\n  }\r\n\r\n  /**\r\n   * Unregisters a RegistryItem with the given ID.\r\n   *\r\n   * @param id The ID of the RegistryItem to remove.\r\n   * @throws {Error} if an item with the given ID does not exist.\r\n   */\r\n  unregister(id: string) {\r\n    if (!this.registry_.has(id)) {\r\n      throw new Error('Menu item with ID \"' + id + '\" not found.');\r\n    }\r\n    this.registry_.delete(id);\r\n  }\r\n\r\n  /**\r\n   * @param id The ID of the RegistryItem to get.\r\n   * @returns RegistryItem or null if not found\r\n   */\r\n  getItem(id: string): RegistryItem | null {\r\n    return this.registry_.get(id) ?? null;\r\n  }\r\n\r\n  /**\r\n   * Gets the valid context menu options for the given scope type (e.g. block or\r\n   * workspace) and scope. Blocks are only shown if the preconditionFn shows\r\n   * they should not be hidden.\r\n   *\r\n   * @param scopeType Type of scope where menu should be shown (e.g. on a block\r\n   *     or on a workspace)\r\n   * @param scope Current scope of context menu (i.e., the exact workspace or\r\n   *     block being clicked on)\r\n   * @returns the list of ContextMenuOptions\r\n   */\r\n  getContextMenuOptions(\r\n    scopeType: ScopeType,\r\n    scope: Scope,\r\n  ): ContextMenuOption[] {\r\n    const menuOptions: ContextMenuOption[] = [];\r\n    for (const item of this.registry_.values()) {\r\n      if (scopeType === item.scopeType) {\r\n        const precondition = item.preconditionFn(scope);\r\n        if (precondition !== 'hidden') {\r\n          const displayText =\r\n            typeof item.displayText === 'function'\r\n              ? item.displayText(scope)\r\n              : item.displayText;\r\n          const menuOption: ContextMenuOption = {\r\n            text: displayText,\r\n            enabled: precondition === 'enabled',\r\n            callback: item.callback,\r\n            scope,\r\n            weight: item.weight,\r\n          };\r\n          menuOptions.push(menuOption);\r\n        }\r\n      }\r\n    }\r\n    menuOptions.sort(function (a, b) {\r\n      return a.weight - b.weight;\r\n    });\r\n    return menuOptions;\r\n  }\r\n}\r\n\r\nexport namespace ContextMenuRegistry {\r\n  /**\r\n   * Where this menu item should be rendered. If the menu item should be\r\n   * rendered in multiple scopes, e.g. on both a block and a workspace, it\r\n   * should be registered for each scope.\r\n   */\r\n  export enum ScopeType {\r\n    BLOCK = 'block',\r\n    WORKSPACE = 'workspace',\r\n  }\r\n\r\n  /**\r\n   * The actual workspace/block where the menu is being rendered. This is passed\r\n   * to callback and displayText functions that depend on this information.\r\n   */\r\n  export interface Scope {\r\n    block?: BlockSvg;\r\n    workspace?: WorkspaceSvg;\r\n  }\r\n\r\n  /**\r\n   * A menu item as entered in the registry.\r\n   */\r\n  export interface RegistryItem {\r\n    callback: (p1: Scope) => void;\r\n    scopeType: ScopeType;\r\n    displayText: ((p1: Scope) => string | HTMLElement) | string | HTMLElement;\r\n    preconditionFn: (p1: Scope) => string;\r\n    weight: number;\r\n    id: string;\r\n  }\r\n\r\n  /**\r\n   * A menu item as presented to contextmenu.js.\r\n   */\r\n  export interface ContextMenuOption {\r\n    text: string | HTMLElement;\r\n    enabled: boolean;\r\n    callback: (p1: Scope) => void;\r\n    scope: Scope;\r\n    weight: number;\r\n  }\r\n\r\n  /**\r\n   * A subset of ContextMenuOption corresponding to what was publicly\r\n   * documented.  ContextMenuOption should be preferred for new code.\r\n   */\r\n  export interface LegacyContextMenuOption {\r\n    text: string;\r\n    enabled: boolean;\r\n    callback: (p1: Scope) => void;\r\n  }\r\n\r\n  /**\r\n   * Singleton instance of this class. All interactions with this class should\r\n   * be done on this object.\r\n   */\r\n  ContextMenuRegistry.registry = new ContextMenuRegistry();\r\n}\r\n\r\nexport type ScopeType = ContextMenuRegistry.ScopeType;\r\nexport const ScopeType = ContextMenuRegistry.ScopeType;\r\nexport type Scope = ContextMenuRegistry.Scope;\r\nexport type RegistryItem = ContextMenuRegistry.RegistryItem;\r\nexport type ContextMenuOption = ContextMenuRegistry.ContextMenuOption;\r\nexport type LegacyContextMenuOption =\r\n  ContextMenuRegistry.LegacyContextMenuOption;\r\n","/**\r\n * @license\r\n * Copyright 2023 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * The layer to place blocks on.\r\n *\r\n * @internal\r\n */\r\nexport const BLOCK = 50;\r\n\r\n/**\r\n * The layer to place bubbles on.\r\n *\r\n * @internal\r\n */\r\nexport const BUBBLE = 100;\r\n","/**\r\n * @license\r\n * Copyright 2018 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Methods for dragging a bubble visually.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.BubbleDragger\r\n\r\nimport {ComponentManager} from './component_manager.js';\r\nimport type {CommentMove} from './events/events_comment_move.js';\r\nimport * as eventUtils from './events/utils.js';\r\nimport type {IBubble} from './interfaces/i_bubble.js';\r\nimport type {IDeleteArea} from './interfaces/i_delete_area.js';\r\nimport type {IDragTarget} from './interfaces/i_drag_target.js';\r\nimport {Coordinate} from './utils/coordinate.js';\r\nimport {WorkspaceCommentSvg} from './workspace_comment_svg.js';\r\nimport type {WorkspaceSvg} from './workspace_svg.js';\r\nimport * as layers from './layers.js';\r\n\r\n/**\r\n * Class for a bubble dragger.  It moves things on the bubble canvas around the\r\n * workspace when they are being dragged by a mouse or touch.  These can be\r\n * block comments, mutators, warnings, or workspace comments.\r\n */\r\nexport class BubbleDragger {\r\n  /** Which drag target the mouse pointer is over, if any. */\r\n  private dragTarget_: IDragTarget | null = null;\r\n\r\n  /** Whether the bubble would be deleted if dropped immediately. */\r\n  private wouldDeleteBubble_ = false;\r\n  private readonly startXY_: Coordinate;\r\n\r\n  /**\r\n   * @param bubble The item on the bubble canvas to drag.\r\n   * @param workspace The workspace to drag on.\r\n   */\r\n  constructor(\r\n    private bubble: IBubble,\r\n    private workspace: WorkspaceSvg,\r\n  ) {\r\n    /**\r\n     * The location of the top left corner of the dragging bubble's body at the\r\n     * beginning of the drag, in workspace coordinates.\r\n     */\r\n    this.startXY_ = this.bubble.getRelativeToSurfaceXY();\r\n  }\r\n\r\n  /**\r\n   * Start dragging a bubble.\r\n   *\r\n   * @internal\r\n   */\r\n  startBubbleDrag() {\r\n    if (!eventUtils.getGroup()) {\r\n      eventUtils.setGroup(true);\r\n    }\r\n\r\n    this.workspace.setResizesEnabled(false);\r\n    if ((this.bubble as AnyDuringMigration).setAutoLayout) {\r\n      (this.bubble as AnyDuringMigration).setAutoLayout(false);\r\n    }\r\n\r\n    this.workspace.getLayerManager()?.moveToDragLayer(this.bubble);\r\n\r\n    this.bubble.setDragging && this.bubble.setDragging(true);\r\n  }\r\n\r\n  /**\r\n   * Execute a step of bubble dragging, based on the given event.  Update the\r\n   * display accordingly.\r\n   *\r\n   * @param e The most recent move event.\r\n   * @param currentDragDeltaXY How far the pointer has moved from the position\r\n   *     at the start of the drag, in pixel units.\r\n   * @internal\r\n   */\r\n  dragBubble(e: PointerEvent, currentDragDeltaXY: Coordinate) {\r\n    const delta = this.pixelsToWorkspaceUnits_(currentDragDeltaXY);\r\n    const newLoc = Coordinate.sum(this.startXY_, delta);\r\n    this.bubble.moveDuringDrag(newLoc);\r\n\r\n    const oldDragTarget = this.dragTarget_;\r\n    this.dragTarget_ = this.workspace.getDragTarget(e);\r\n\r\n    const oldWouldDeleteBubble = this.wouldDeleteBubble_;\r\n    this.wouldDeleteBubble_ = this.shouldDelete_(this.dragTarget_);\r\n    if (oldWouldDeleteBubble !== this.wouldDeleteBubble_) {\r\n      // Prevent unnecessary add/remove class calls.\r\n      this.updateCursorDuringBubbleDrag_();\r\n    }\r\n    // Call drag enter/exit/over after wouldDeleteBlock is called in\r\n    // shouldDelete_\r\n    if (this.dragTarget_ !== oldDragTarget) {\r\n      oldDragTarget && oldDragTarget.onDragExit(this.bubble);\r\n      this.dragTarget_ && this.dragTarget_.onDragEnter(this.bubble);\r\n    }\r\n    this.dragTarget_ && this.dragTarget_.onDragOver(this.bubble);\r\n  }\r\n\r\n  /**\r\n   * Whether ending the drag would delete the bubble.\r\n   *\r\n   * @param dragTarget The drag target that the bubblee is currently over.\r\n   * @returns Whether dropping the bubble immediately would delete the block.\r\n   */\r\n  private shouldDelete_(dragTarget: IDragTarget | null): boolean {\r\n    if (dragTarget) {\r\n      const componentManager = this.workspace.getComponentManager();\r\n      const isDeleteArea = componentManager.hasCapability(\r\n        dragTarget.id,\r\n        ComponentManager.Capability.DELETE_AREA,\r\n      );\r\n      if (isDeleteArea) {\r\n        return (dragTarget as IDeleteArea).wouldDelete(this.bubble, false);\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Update the cursor (and possibly the trash can lid) to reflect whether the\r\n   * dragging bubble would be deleted if released immediately.\r\n   */\r\n  private updateCursorDuringBubbleDrag_() {\r\n    this.bubble.setDeleteStyle(this.wouldDeleteBubble_);\r\n  }\r\n\r\n  /**\r\n   * Finish a bubble drag and put the bubble back on the workspace.\r\n   *\r\n   * @param e The pointerup event.\r\n   * @param currentDragDeltaXY How far the pointer has moved from the position\r\n   *     at the start of the drag, in pixel units.\r\n   * @internal\r\n   */\r\n  endBubbleDrag(e: PointerEvent, currentDragDeltaXY: Coordinate) {\r\n    // Make sure internal state is fresh.\r\n    this.dragBubble(e, currentDragDeltaXY);\r\n\r\n    const preventMove =\r\n      this.dragTarget_ && this.dragTarget_.shouldPreventMove(this.bubble);\r\n    let newLoc;\r\n    if (preventMove) {\r\n      newLoc = this.startXY_;\r\n    } else {\r\n      const delta = this.pixelsToWorkspaceUnits_(currentDragDeltaXY);\r\n      newLoc = Coordinate.sum(this.startXY_, delta);\r\n    }\r\n    // Move the bubble to its final location.\r\n    this.bubble.moveTo(newLoc.x, newLoc.y);\r\n\r\n    if (this.dragTarget_) {\r\n      this.dragTarget_.onDrop(this.bubble);\r\n    }\r\n\r\n    if (this.wouldDeleteBubble_) {\r\n      // Fire a move event, so we know where to go back to for an undo.\r\n      this.fireMoveEvent_();\r\n      this.bubble.dispose();\r\n    } else {\r\n      // Put everything back onto the bubble canvas.\r\n      if (this.bubble.setDragging) {\r\n        this.bubble.setDragging(false);\r\n        this.workspace\r\n          .getLayerManager()\r\n          ?.moveOffDragLayer(this.bubble, layers.BUBBLE);\r\n      }\r\n      this.fireMoveEvent_();\r\n    }\r\n    this.workspace.setResizesEnabled(true);\r\n\r\n    eventUtils.setGroup(false);\r\n  }\r\n\r\n  /** Fire a move event at the end of a bubble drag. */\r\n  private fireMoveEvent_() {\r\n    if (this.bubble instanceof WorkspaceCommentSvg) {\r\n      const event = new (eventUtils.get(eventUtils.COMMENT_MOVE))(\r\n        this.bubble,\r\n      ) as CommentMove;\r\n      event.setOldCoordinate(this.startXY_);\r\n      event.recordNew();\r\n      eventUtils.fire(event);\r\n    }\r\n    // TODO (fenichel): move events for comments.\r\n    return;\r\n  }\r\n\r\n  /**\r\n   * Convert a coordinate object from pixels to workspace units, including a\r\n   * correction for mutator workspaces.\r\n   * This function does not consider differing origins.  It simply scales the\r\n   * input's x and y values.\r\n   *\r\n   * @param pixelCoord A coordinate with x and y values in CSS pixel units.\r\n   * @returns The input coordinate divided by the workspace scale.\r\n   */\r\n  private pixelsToWorkspaceUnits_(pixelCoord: Coordinate): Coordinate {\r\n    const result = new Coordinate(\r\n      pixelCoord.x / this.workspace.scale,\r\n      pixelCoord.y / this.workspace.scale,\r\n    );\r\n    if (this.workspace.isMutator) {\r\n      // If we're in a mutator, its scale is always 1, purely because of some\r\n      // oddities in our rendering optimizations.  The actual scale is the same\r\n      // as the scale on the parent workspace. Fix that for dragging.\r\n      const mainScale = this.workspace.options.parentWorkspace!.scale;\r\n      result.scale(1 / mainScale);\r\n    }\r\n    return result;\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.internalConstants\r\n\r\nimport {ConnectionType} from './connection_type.js';\r\n\r\n/**\r\n * Number of characters to truncate a collapsed block to.\r\n *\r\n * @internal\r\n */\r\nexport const COLLAPSE_CHARS = 30;\r\n\r\n/**\r\n * When dragging a block out of a stack, split the stack in two (true), or drag\r\n * out the block healing the stack (false).\r\n *\r\n * @internal\r\n */\r\nexport const DRAG_STACK = true;\r\n\r\n/**\r\n * Lookup table for determining the opposite type of a connection.\r\n *\r\n * @internal\r\n */\r\nexport const OPPOSITE_TYPE: number[] = [];\r\nOPPOSITE_TYPE[ConnectionType.INPUT_VALUE] = ConnectionType.OUTPUT_VALUE;\r\nOPPOSITE_TYPE[ConnectionType.OUTPUT_VALUE] = ConnectionType.INPUT_VALUE;\r\nOPPOSITE_TYPE[ConnectionType.NEXT_STATEMENT] =\r\n  ConnectionType.PREVIOUS_STATEMENT;\r\nOPPOSITE_TYPE[ConnectionType.PREVIOUS_STATEMENT] =\r\n  ConnectionType.NEXT_STATEMENT;\r\n\r\n/**\r\n * String for use in the dropdown created in field_variable.\r\n * This string indicates that this option in the dropdown is 'Rename\r\n * variable...' and if selected, should trigger the prompt to rename a variable.\r\n *\r\n * @internal\r\n */\r\nexport const RENAME_VARIABLE_ID = 'RENAME_VARIABLE_ID';\r\n\r\n/**\r\n * String for use in the dropdown created in field_variable.\r\n * This string indicates that this option in the dropdown is 'Delete the \"%1\"\r\n * variable' and if selected, should trigger the prompt to delete a variable.\r\n *\r\n * @internal\r\n */\r\nexport const DELETE_VARIABLE_ID = 'DELETE_VARIABLE_ID';\r\n","/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Methods for dragging a workspace visually.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.WorkspaceDragger\r\n\r\nimport * as common from './common.js';\r\nimport {Coordinate} from './utils/coordinate.js';\r\nimport type {WorkspaceSvg} from './workspace_svg.js';\r\n\r\n/**\r\n * Class for a workspace dragger.  It moves the workspace around when it is\r\n * being dragged by a mouse or touch.\r\n *\r\n */\r\nexport class WorkspaceDragger {\r\n  private readonly horizontalScrollEnabled_: boolean;\r\n  private readonly verticalScrollEnabled_: boolean;\r\n  protected startScrollXY_: Coordinate;\r\n\r\n  /** @param workspace The workspace to drag. */\r\n  constructor(private workspace: WorkspaceSvg) {\r\n    /** Whether horizontal scroll is enabled. */\r\n    this.horizontalScrollEnabled_ = this.workspace.isMovableHorizontally();\r\n\r\n    /** Whether vertical scroll is enabled. */\r\n    this.verticalScrollEnabled_ = this.workspace.isMovableVertically();\r\n\r\n    /**\r\n     * The scroll position of the workspace at the beginning of the drag.\r\n     * Coordinate system: pixel coordinates.\r\n     */\r\n    this.startScrollXY_ = new Coordinate(workspace.scrollX, workspace.scrollY);\r\n  }\r\n\r\n  /**\r\n   * Sever all links from this object.\r\n   *\r\n   * @internal\r\n   */\r\n  dispose() {\r\n    // AnyDuringMigration because:  Type 'null' is not assignable to type\r\n    // 'WorkspaceSvg'.\r\n    this.workspace = null as AnyDuringMigration;\r\n  }\r\n\r\n  /**\r\n   * Start dragging the workspace.\r\n   *\r\n   * @internal\r\n   */\r\n  startDrag() {\r\n    if (common.getSelected()) {\r\n      common.getSelected()!.unselect();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Finish dragging the workspace and put everything back where it belongs.\r\n   *\r\n   * @param currentDragDeltaXY How far the pointer has moved from the position\r\n   *     at the start of the drag, in pixel coordinates.\r\n   * @internal\r\n   */\r\n  endDrag(currentDragDeltaXY: Coordinate) {\r\n    // Make sure everything is up to date.\r\n    this.drag(currentDragDeltaXY);\r\n  }\r\n\r\n  /**\r\n   * Move the workspace based on the most recent mouse movements.\r\n   *\r\n   * @param currentDragDeltaXY How far the pointer has moved from the position\r\n   *     at the start of the drag, in pixel coordinates.\r\n   * @internal\r\n   */\r\n  drag(currentDragDeltaXY: Coordinate) {\r\n    const newXY = Coordinate.sum(this.startScrollXY_, currentDragDeltaXY);\r\n\r\n    if (this.horizontalScrollEnabled_ && this.verticalScrollEnabled_) {\r\n      this.workspace.scroll(newXY.x, newXY.y);\r\n    } else if (this.horizontalScrollEnabled_) {\r\n      this.workspace.scroll(newXY.x, this.workspace.scrollY);\r\n    } else if (this.verticalScrollEnabled_) {\r\n      this.workspace.scroll(this.workspace.scrollX, newXY.y);\r\n    } else {\r\n      throw new TypeError('Invalid state.');\r\n    }\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * The class representing an in-progress gesture, e.g. a drag,\r\n * tap, or pinch to zoom.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.Gesture\r\n\r\n// Unused import preserved for side-effects. Remove if unneeded.\r\nimport './events/events_click.js';\r\n\r\nimport * as blockAnimations from './block_animations.js';\r\nimport type {BlockSvg} from './block_svg.js';\r\nimport * as browserEvents from './browser_events.js';\r\nimport {BubbleDragger} from './bubble_dragger.js';\r\nimport * as common from './common.js';\r\nimport {config} from './config.js';\r\nimport * as dropDownDiv from './dropdowndiv.js';\r\nimport * as eventUtils from './events/utils.js';\r\nimport type {Field} from './field.js';\r\nimport type {IBlockDragger} from './interfaces/i_block_dragger.js';\r\nimport type {IBubble} from './interfaces/i_bubble.js';\r\nimport type {IFlyout} from './interfaces/i_flyout.js';\r\nimport * as internalConstants from './internal_constants.js';\r\nimport * as registry from './registry.js';\r\nimport * as Tooltip from './tooltip.js';\r\nimport * as Touch from './touch.js';\r\nimport {Coordinate} from './utils/coordinate.js';\r\nimport {WorkspaceCommentSvg} from './workspace_comment_svg.js';\r\nimport {WorkspaceDragger} from './workspace_dragger.js';\r\nimport type {WorkspaceSvg} from './workspace_svg.js';\r\nimport type {IIcon} from './interfaces/i_icon.js';\r\n\r\n/**\r\n * Note: In this file \"start\" refers to pointerdown\r\n * events.  \"End\" refers to pointerup events.\r\n */\r\n\r\n/** A multiplier used to convert the gesture scale to a zoom in delta. */\r\nconst ZOOM_IN_MULTIPLIER = 5;\r\n\r\n/** A multiplier used to convert the gesture scale to a zoom out delta. */\r\nconst ZOOM_OUT_MULTIPLIER = 6;\r\n\r\n/**\r\n * Class for one gesture.\r\n */\r\nexport class Gesture {\r\n  /**\r\n   * The position of the pointer when the gesture started.  Units are CSS\r\n   * pixels, with (0, 0) at the top left of the browser window (pointer event\r\n   * clientX/Y).\r\n   */\r\n  private mouseDownXY = new Coordinate(0, 0);\r\n  private currentDragDeltaXY: Coordinate;\r\n\r\n  /**\r\n   * The bubble that the gesture started on, or null if it did not start on a\r\n   * bubble.\r\n   */\r\n  private startBubble: IBubble | null = null;\r\n\r\n  /**\r\n   * The field that the gesture started on, or null if it did not start on a\r\n   * field.\r\n   */\r\n  private startField: Field | null = null;\r\n\r\n  /**\r\n   * The icon that the gesture started on, or null if it did not start on an\r\n   * icon.\r\n   */\r\n  private startIcon: IIcon | null = null;\r\n\r\n  /**\r\n   * The block that the gesture started on, or null if it did not start on a\r\n   * block.\r\n   */\r\n  private startBlock: BlockSvg | null = null;\r\n\r\n  /**\r\n   * The block that this gesture targets.  If the gesture started on a\r\n   * shadow block, this is the first non-shadow parent of the block.  If the\r\n   * gesture started in the flyout, this is the root block of the block group\r\n   * that was clicked or dragged.\r\n   */\r\n  private targetBlock: BlockSvg | null = null;\r\n\r\n  /**\r\n   * The workspace that the gesture started on.  There may be multiple\r\n   * workspaces on a page; this is more accurate than using\r\n   * Blockly.common.getMainWorkspace().\r\n   */\r\n  protected startWorkspace_: WorkspaceSvg | null = null;\r\n\r\n  /**\r\n   * Whether the pointer has at any point moved out of the drag radius.\r\n   * A gesture that exceeds the drag radius is a drag even if it ends exactly\r\n   * at its start point.\r\n   */\r\n  private hasExceededDragRadius = false;\r\n\r\n  /**\r\n   * Array holding info needed to unbind events.\r\n   * Used for disposing.\r\n   * Ex: [[node, name, func], [node, name, func]].\r\n   */\r\n  private boundEvents: browserEvents.Data[] = [];\r\n\r\n  /** The object tracking a bubble drag, or null if none is in progress. */\r\n  private bubbleDragger: BubbleDragger | null = null;\r\n\r\n  /** The object tracking a block drag, or null if none is in progress. */\r\n  private blockDragger: IBlockDragger | null = null;\r\n\r\n  /**\r\n   * The object tracking a workspace or flyout workspace drag, or null if none\r\n   * is in progress.\r\n   */\r\n  private workspaceDragger: WorkspaceDragger | null = null;\r\n\r\n  /** The flyout a gesture started in, if any. */\r\n  private flyout: IFlyout | null = null;\r\n\r\n  /** Boolean for sanity-checking that some code is only called once. */\r\n  private calledUpdateIsDragging = false;\r\n\r\n  /** Boolean for sanity-checking that some code is only called once. */\r\n  private gestureHasStarted = false;\r\n\r\n  /** Boolean used internally to break a cycle in disposal. */\r\n  protected isEnding_ = false;\r\n  private healStack: boolean;\r\n\r\n  /** The event that most recently updated this gesture. */\r\n  private mostRecentEvent: PointerEvent;\r\n\r\n  /** Boolean for whether or not this gesture is a multi-touch gesture. */\r\n  private isMultiTouch_ = false;\r\n\r\n  /** A map of cached points used for tracking multi-touch gestures. */\r\n  private cachedPoints = new Map<string, Coordinate | null>();\r\n\r\n  /**\r\n   * This is the ratio between the starting distance between the touch points\r\n   * and the most recent distance between the touch points.\r\n   * Scales between 0 and 1 mean the most recent zoom was a zoom out.\r\n   * Scales above 1.0 mean the most recent zoom was a zoom in.\r\n   */\r\n  private previousScale = 0;\r\n\r\n  /** The starting distance between two touch points. */\r\n  private startDistance = 0;\r\n\r\n  /** Boolean for whether or not the workspace supports pinch-zoom. */\r\n  private isPinchZoomEnabled: boolean | null = null;\r\n\r\n  /**\r\n   * The owner of the dropdownDiv when this gesture first starts.\r\n   * Needed because we'll close the dropdown before fields get to\r\n   * act on their events, and some fields care about who owns\r\n   * the dropdown.\r\n   */\r\n  currentDropdownOwner: Field | null = null;\r\n\r\n  /**\r\n   * @param e The event that kicked off this gesture.\r\n   * @param creatorWorkspace The workspace that created this gesture and has a\r\n   *     reference to it.\r\n   */\r\n  constructor(\r\n    e: PointerEvent,\r\n    private readonly creatorWorkspace: WorkspaceSvg,\r\n  ) {\r\n    this.mostRecentEvent = e;\r\n\r\n    /**\r\n     * How far the pointer has moved during this drag, in pixel units.\r\n     * (0, 0) is at this.mouseDownXY_.\r\n     */\r\n    this.currentDragDeltaXY = new Coordinate(0, 0);\r\n\r\n    /**\r\n     * Boolean used to indicate whether or not to heal the stack after\r\n     * disconnecting a block.\r\n     */\r\n    this.healStack = !internalConstants.DRAG_STACK;\r\n  }\r\n\r\n  /**\r\n   * Sever all links from this object.\r\n   *\r\n   * @internal\r\n   */\r\n  dispose() {\r\n    Touch.clearTouchIdentifier();\r\n    Tooltip.unblock();\r\n    // Clear the owner's reference to this gesture.\r\n    this.creatorWorkspace.clearGesture();\r\n\r\n    for (const event of this.boundEvents) {\r\n      browserEvents.unbind(event);\r\n    }\r\n    this.boundEvents.length = 0;\r\n\r\n    if (this.blockDragger) {\r\n      this.blockDragger.dispose();\r\n    }\r\n    if (this.workspaceDragger) {\r\n      this.workspaceDragger.dispose();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update internal state based on an event.\r\n   *\r\n   * @param e The most recent pointer event.\r\n   */\r\n  private updateFromEvent(e: PointerEvent) {\r\n    const currentXY = new Coordinate(e.clientX, e.clientY);\r\n    const changed = this.updateDragDelta(currentXY);\r\n    // Exceeded the drag radius for the first time.\r\n    if (changed) {\r\n      this.updateIsDragging();\r\n      Touch.longStop();\r\n    }\r\n    this.mostRecentEvent = e;\r\n  }\r\n\r\n  /**\r\n   * DO MATH to set currentDragDeltaXY_ based on the most recent pointer\r\n   * position.\r\n   *\r\n   * @param currentXY The most recent pointer position, in pixel units,\r\n   *     with (0, 0) at the window's top left corner.\r\n   * @returns True if the drag just exceeded the drag radius for the first time.\r\n   */\r\n  private updateDragDelta(currentXY: Coordinate): boolean {\r\n    this.currentDragDeltaXY = Coordinate.difference(\r\n      currentXY,\r\n      this.mouseDownXY,\r\n    );\r\n\r\n    if (!this.hasExceededDragRadius) {\r\n      const currentDragDelta = Coordinate.magnitude(this.currentDragDeltaXY);\r\n\r\n      // The flyout has a different drag radius from the rest of Blockly.\r\n      const limitRadius = this.flyout\r\n        ? config.flyoutDragRadius\r\n        : config.dragRadius;\r\n\r\n      this.hasExceededDragRadius = currentDragDelta > limitRadius;\r\n      return this.hasExceededDragRadius;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Update this gesture to record whether a block is being dragged from the\r\n   * flyout.\r\n   * This function should be called on a pointermove event the first time\r\n   * the drag radius is exceeded.  It should be called no more than once per\r\n   * gesture. If a block should be dragged from the flyout this function creates\r\n   * the new block on the main workspace and updates targetBlock_ and\r\n   * startWorkspace_.\r\n   *\r\n   * @returns True if a block is being dragged from the flyout.\r\n   */\r\n  private updateIsDraggingFromFlyout(): boolean {\r\n    if (!this.targetBlock || !this.flyout?.isBlockCreatable(this.targetBlock)) {\r\n      return false;\r\n    }\r\n    if (!this.flyout.targetWorkspace) {\r\n      throw new Error(`Cannot update dragging from the flyout because the ' +\r\n          'flyout's target workspace is undefined`);\r\n    }\r\n    if (\r\n      !this.flyout.isScrollable() ||\r\n      this.flyout.isDragTowardWorkspace(this.currentDragDeltaXY)\r\n    ) {\r\n      this.startWorkspace_ = this.flyout.targetWorkspace;\r\n      this.startWorkspace_.updateScreenCalculationsIfScrolled();\r\n      // Start the event group now, so that the same event group is used for\r\n      // block creation and block dragging.\r\n      if (!eventUtils.getGroup()) {\r\n        eventUtils.setGroup(true);\r\n      }\r\n      // The start block is no longer relevant, because this is a drag.\r\n      this.startBlock = null;\r\n      this.targetBlock = this.flyout.createBlock(this.targetBlock);\r\n      this.targetBlock.select();\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Update this gesture to record whether a bubble is being dragged.\r\n   * This function should be called on a pointermove event the first time\r\n   * the drag radius is exceeded.  It should be called no more than once per\r\n   * gesture. If a bubble should be dragged this function creates the necessary\r\n   * BubbleDragger and starts the drag.\r\n   *\r\n   * @returns True if a bubble is being dragged.\r\n   */\r\n  private updateIsDraggingBubble(): boolean {\r\n    if (!this.startBubble) {\r\n      return false;\r\n    }\r\n\r\n    this.startDraggingBubble();\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Check whether to start a block drag. If a block should be dragged, either\r\n   * from the flyout or in the workspace, create the necessary BlockDragger and\r\n   * start the drag.\r\n   *\r\n   * This function should be called on a pointermove event the first time\r\n   * the drag radius is exceeded.  It should be called no more than once per\r\n   * gesture. If a block should be dragged, either from the flyout or in the\r\n   * workspace, this function creates the necessary BlockDragger and starts the\r\n   * drag.\r\n   *\r\n   * @returns True if a block is being dragged.\r\n   */\r\n  private updateIsDraggingBlock(): boolean {\r\n    if (!this.targetBlock) {\r\n      return false;\r\n    }\r\n    if (this.flyout) {\r\n      if (this.updateIsDraggingFromFlyout()) {\r\n        this.startDraggingBlock();\r\n        return true;\r\n      }\r\n    } else if (this.targetBlock.isMovable()) {\r\n      this.startDraggingBlock();\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Check whether to start a workspace drag. If a workspace is being dragged,\r\n   * create the necessary WorkspaceDragger and start the drag.\r\n   *\r\n   * This function should be called on a pointermove event the first time\r\n   * the drag radius is exceeded.  It should be called no more than once per\r\n   * gesture. If a workspace is being dragged this function creates the\r\n   * necessary WorkspaceDragger and starts the drag.\r\n   */\r\n  private updateIsDraggingWorkspace() {\r\n    if (!this.startWorkspace_) {\r\n      throw new Error(\r\n        'Cannot update dragging the workspace because the ' +\r\n          'start workspace is undefined',\r\n      );\r\n    }\r\n\r\n    const wsMovable = this.flyout\r\n      ? this.flyout.isScrollable()\r\n      : this.startWorkspace_ && this.startWorkspace_.isDraggable();\r\n    if (!wsMovable) return;\r\n\r\n    this.workspaceDragger = new WorkspaceDragger(this.startWorkspace_);\r\n\r\n    this.workspaceDragger.startDrag();\r\n  }\r\n\r\n  /**\r\n   * Update this gesture to record whether anything is being dragged.\r\n   * This function should be called on a pointermove event the first time\r\n   * the drag radius is exceeded.  It should be called no more than once per\r\n   * gesture.\r\n   */\r\n  private updateIsDragging() {\r\n    // Sanity check.\r\n    if (this.calledUpdateIsDragging) {\r\n      throw Error('updateIsDragging_ should only be called once per gesture.');\r\n    }\r\n    this.calledUpdateIsDragging = true;\r\n\r\n    // First check if it was a bubble drag.  Bubbles always sit on top of\r\n    // blocks.\r\n    if (this.updateIsDraggingBubble()) {\r\n      return;\r\n    }\r\n    // Then check if it was a block drag.\r\n    if (this.updateIsDraggingBlock()) {\r\n      return;\r\n    }\r\n    // Then check if it's a workspace drag.\r\n    this.updateIsDraggingWorkspace();\r\n  }\r\n\r\n  /** Create a block dragger and start dragging the selected block. */\r\n  private startDraggingBlock() {\r\n    const BlockDraggerClass = registry.getClassFromOptions(\r\n      registry.Type.BLOCK_DRAGGER,\r\n      this.creatorWorkspace.options,\r\n      true,\r\n    );\r\n\r\n    this.blockDragger = new BlockDraggerClass!(\r\n      this.targetBlock,\r\n      this.startWorkspace_,\r\n    );\r\n    this.blockDragger!.startDrag(this.currentDragDeltaXY, this.healStack);\r\n    this.blockDragger!.drag(this.mostRecentEvent, this.currentDragDeltaXY);\r\n  }\r\n\r\n  /** Create a bubble dragger and start dragging the selected bubble. */\r\n  private startDraggingBubble() {\r\n    if (!this.startBubble) {\r\n      throw new Error(\r\n        'Cannot update dragging the bubble because the start ' +\r\n          'bubble is undefined',\r\n      );\r\n    }\r\n    if (!this.startWorkspace_) {\r\n      throw new Error(\r\n        'Cannot update dragging the bubble because the start ' +\r\n          'workspace is undefined',\r\n      );\r\n    }\r\n\r\n    this.bubbleDragger = new BubbleDragger(\r\n      this.startBubble,\r\n      this.startWorkspace_,\r\n    );\r\n    this.bubbleDragger.startBubbleDrag();\r\n    this.bubbleDragger.dragBubble(\r\n      this.mostRecentEvent,\r\n      this.currentDragDeltaXY,\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Start a gesture: update the workspace to indicate that a gesture is in\r\n   * progress and bind pointermove and pointerup handlers.\r\n   *\r\n   * @param e A pointerdown event.\r\n   * @internal\r\n   */\r\n  doStart(e: PointerEvent) {\r\n    if (!this.startWorkspace_) {\r\n      throw new Error(\r\n        'Cannot start the touch gesture becauase the start ' +\r\n          'workspace is undefined',\r\n      );\r\n    }\r\n    this.isPinchZoomEnabled =\r\n      this.startWorkspace_.options.zoomOptions &&\r\n      this.startWorkspace_.options.zoomOptions.pinch;\r\n\r\n    if (browserEvents.isTargetInput(e)) {\r\n      this.cancel();\r\n      return;\r\n    }\r\n\r\n    this.gestureHasStarted = true;\r\n\r\n    blockAnimations.disconnectUiStop();\r\n\r\n    this.startWorkspace_.updateScreenCalculationsIfScrolled();\r\n    if (this.startWorkspace_.isMutator) {\r\n      // Mutator's coordinate system could be out of date because the bubble was\r\n      // dragged, the block was moved, the parent workspace zoomed, etc.\r\n      this.startWorkspace_.resize();\r\n    }\r\n\r\n    // Keep track of which field owns the dropdown before we close it.\r\n    this.currentDropdownOwner = dropDownDiv.getOwner();\r\n    // Hide chaff also hides the flyout, so don't do it if the click is in a\r\n    // flyout.\r\n    this.startWorkspace_.hideChaff(!!this.flyout);\r\n\r\n    this.startWorkspace_.markFocused();\r\n    this.mostRecentEvent = e;\r\n\r\n    Tooltip.block();\r\n\r\n    if (this.targetBlock) {\r\n      this.targetBlock.select();\r\n    }\r\n\r\n    if (browserEvents.isRightButton(e)) {\r\n      this.handleRightClick(e);\r\n      return;\r\n    }\r\n\r\n    if (e.type.toLowerCase() === 'pointerdown' && e.pointerType !== 'mouse') {\r\n      Touch.longStart(e, this);\r\n    }\r\n\r\n    this.mouseDownXY = new Coordinate(e.clientX, e.clientY);\r\n    this.healStack = e.altKey || e.ctrlKey || e.metaKey;\r\n\r\n    this.bindMouseEvents(e);\r\n\r\n    if (!this.isEnding_) {\r\n      this.handleTouchStart(e);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Bind gesture events.\r\n   *\r\n   * @param e A pointerdown event.\r\n   * @internal\r\n   */\r\n  bindMouseEvents(e: PointerEvent) {\r\n    this.boundEvents.push(\r\n      browserEvents.conditionalBind(\r\n        document,\r\n        'pointerdown',\r\n        null,\r\n        this.handleStart.bind(this),\r\n        /* opt_noCaptureIdentifier */ true,\r\n      ),\r\n    );\r\n    this.boundEvents.push(\r\n      browserEvents.conditionalBind(\r\n        document,\r\n        'pointermove',\r\n        null,\r\n        this.handleMove.bind(this),\r\n        /* opt_noCaptureIdentifier */ true,\r\n      ),\r\n    );\r\n    this.boundEvents.push(\r\n      browserEvents.conditionalBind(\r\n        document,\r\n        'pointerup',\r\n        null,\r\n        this.handleUp.bind(this),\r\n        /* opt_noCaptureIdentifier */ true,\r\n      ),\r\n    );\r\n\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n  }\r\n\r\n  /**\r\n   * Handle a pointerdown event.\r\n   *\r\n   * @param e A pointerdown event.\r\n   * @internal\r\n   */\r\n  handleStart(e: PointerEvent) {\r\n    if (this.isDragging()) {\r\n      // A drag has already started, so this can no longer be a pinch-zoom.\r\n      return;\r\n    }\r\n    this.handleTouchStart(e);\r\n\r\n    if (this.isMultiTouch()) {\r\n      Touch.longStop();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle a pointermove event.\r\n   *\r\n   * @param e A pointermove event.\r\n   * @internal\r\n   */\r\n  handleMove(e: PointerEvent) {\r\n    if (\r\n      (this.isDragging() && Touch.shouldHandleEvent(e)) ||\r\n      !this.isMultiTouch()\r\n    ) {\r\n      this.updateFromEvent(e);\r\n      if (this.workspaceDragger) {\r\n        this.workspaceDragger.drag(this.currentDragDeltaXY);\r\n      } else if (this.blockDragger) {\r\n        this.blockDragger.drag(this.mostRecentEvent, this.currentDragDeltaXY);\r\n      } else if (this.bubbleDragger) {\r\n        this.bubbleDragger.dragBubble(\r\n          this.mostRecentEvent,\r\n          this.currentDragDeltaXY,\r\n        );\r\n      }\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    } else if (this.isMultiTouch()) {\r\n      this.handleTouchMove(e);\r\n      Touch.longStop();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle a pointerup event.\r\n   *\r\n   * @param e A pointerup event.\r\n   * @internal\r\n   */\r\n  handleUp(e: PointerEvent) {\r\n    if (!this.isDragging()) {\r\n      this.handleTouchEnd(e);\r\n    }\r\n    if (!this.isMultiTouch() || this.isDragging()) {\r\n      if (!Touch.shouldHandleEvent(e)) {\r\n        return;\r\n      }\r\n      this.updateFromEvent(e);\r\n      Touch.longStop();\r\n\r\n      if (this.isEnding_) {\r\n        console.log('Trying to end a gesture recursively.');\r\n        return;\r\n      }\r\n      this.isEnding_ = true;\r\n      // The ordering of these checks is important: drags have higher priority\r\n      // than clicks.  Fields and icons have higher priority than blocks; blocks\r\n      // have higher priority than workspaces. The ordering within drags does\r\n      // not matter, because the three types of dragging are exclusive.\r\n      if (this.bubbleDragger) {\r\n        this.bubbleDragger.endBubbleDrag(e, this.currentDragDeltaXY);\r\n      } else if (this.blockDragger) {\r\n        this.blockDragger.endDrag(e, this.currentDragDeltaXY);\r\n      } else if (this.workspaceDragger) {\r\n        this.workspaceDragger.endDrag(this.currentDragDeltaXY);\r\n      } else if (this.isBubbleClick()) {\r\n        // Bubbles are in front of all fields and blocks.\r\n        this.doBubbleClick();\r\n      } else if (this.isFieldClick()) {\r\n        this.doFieldClick();\r\n      } else if (this.isIconClick()) {\r\n        this.doIconClick();\r\n      } else if (this.isBlockClick()) {\r\n        this.doBlockClick();\r\n      } else if (this.isWorkspaceClick()) {\r\n        this.doWorkspaceClick(e);\r\n      }\r\n\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n\r\n      this.dispose();\r\n    } else {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n\r\n      this.dispose();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle a pointerdown event and keep track of current\r\n   * pointers.\r\n   *\r\n   * @param e A pointerdown event.\r\n   * @internal\r\n   */\r\n  handleTouchStart(e: PointerEvent) {\r\n    const pointerId = Touch.getTouchIdentifierFromEvent(e);\r\n    // store the pointerId in the current list of pointers\r\n    this.cachedPoints.set(pointerId, this.getTouchPoint(e));\r\n    const pointers = Array.from(this.cachedPoints.keys());\r\n    // If two pointers are down, store info\r\n    if (pointers.length === 2) {\r\n      const point0 = this.cachedPoints.get(pointers[0])!;\r\n      const point1 = this.cachedPoints.get(pointers[1])!;\r\n      this.startDistance = Coordinate.distance(point0, point1);\r\n      this.isMultiTouch_ = true;\r\n      e.preventDefault();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle a pointermove event and zoom in/out if two pointers\r\n   * are on the screen.\r\n   *\r\n   * @param e A pointermove event.\r\n   * @internal\r\n   */\r\n  handleTouchMove(e: PointerEvent) {\r\n    const pointerId = Touch.getTouchIdentifierFromEvent(e);\r\n    // Update the cache\r\n    this.cachedPoints.set(pointerId, this.getTouchPoint(e));\r\n\r\n    if (this.isPinchZoomEnabled && this.cachedPoints.size === 2) {\r\n      this.handlePinch(e);\r\n    } else {\r\n      this.handleMove(e);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle pinch zoom gesture.\r\n   *\r\n   * @param e A pointermove event.\r\n   */\r\n  private handlePinch(e: PointerEvent) {\r\n    const pointers = Array.from(this.cachedPoints.keys());\r\n    // Calculate the distance between the two pointers\r\n    const point0 = this.cachedPoints.get(pointers[0])!;\r\n    const point1 = this.cachedPoints.get(pointers[1])!;\r\n    const moveDistance = Coordinate.distance(point0, point1);\r\n    const scale = moveDistance / this.startDistance;\r\n\r\n    if (this.previousScale > 0 && this.previousScale < Infinity) {\r\n      const gestureScale = scale - this.previousScale;\r\n      const delta =\r\n        gestureScale > 0\r\n          ? gestureScale * ZOOM_IN_MULTIPLIER\r\n          : gestureScale * ZOOM_OUT_MULTIPLIER;\r\n      if (!this.startWorkspace_) {\r\n        throw new Error(\r\n          'Cannot handle a pinch because the start workspace ' + 'is undefined',\r\n        );\r\n      }\r\n      const workspace = this.startWorkspace_;\r\n      const position = browserEvents.mouseToSvg(\r\n        e,\r\n        workspace.getParentSvg(),\r\n        workspace.getInverseScreenCTM(),\r\n      );\r\n      workspace.zoom(position.x, position.y, delta);\r\n    }\r\n    this.previousScale = scale;\r\n    e.preventDefault();\r\n  }\r\n\r\n  /**\r\n   * Handle a pointerup event and end the gesture.\r\n   *\r\n   * @param e A pointerup event.\r\n   * @internal\r\n   */\r\n  handleTouchEnd(e: PointerEvent) {\r\n    const pointerId = Touch.getTouchIdentifierFromEvent(e);\r\n    if (this.cachedPoints.has(pointerId)) {\r\n      this.cachedPoints.delete(pointerId);\r\n    }\r\n    if (this.cachedPoints.size < 2) {\r\n      this.cachedPoints.clear();\r\n      this.previousScale = 0;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Helper function returning the current touch point coordinate.\r\n   *\r\n   * @param e A pointer event.\r\n   * @returns The current touch point coordinate\r\n   * @internal\r\n   */\r\n  getTouchPoint(e: PointerEvent): Coordinate | null {\r\n    if (!this.startWorkspace_) {\r\n      return null;\r\n    }\r\n    return new Coordinate(e.pageX, e.pageY);\r\n  }\r\n\r\n  /**\r\n   * Whether this gesture is part of a multi-touch gesture.\r\n   *\r\n   * @returns Whether this gesture is part of a multi-touch gesture.\r\n   * @internal\r\n   */\r\n  isMultiTouch(): boolean {\r\n    return this.isMultiTouch_;\r\n  }\r\n\r\n  /**\r\n   * Cancel an in-progress gesture.  If a workspace or block drag is in\r\n   * progress, end the drag at the most recent location.\r\n   *\r\n   * @internal\r\n   */\r\n  cancel() {\r\n    // Disposing of a block cancels in-progress drags, but dragging to a delete\r\n    // area disposes of a block and leads to recursive disposal. Break that\r\n    // cycle.\r\n    if (this.isEnding_) {\r\n      return;\r\n    }\r\n    Touch.longStop();\r\n    if (this.bubbleDragger) {\r\n      this.bubbleDragger.endBubbleDrag(\r\n        this.mostRecentEvent,\r\n        this.currentDragDeltaXY,\r\n      );\r\n    } else if (this.blockDragger) {\r\n      this.blockDragger.endDrag(this.mostRecentEvent, this.currentDragDeltaXY);\r\n    } else if (this.workspaceDragger) {\r\n      this.workspaceDragger.endDrag(this.currentDragDeltaXY);\r\n    }\r\n    this.dispose();\r\n  }\r\n\r\n  /**\r\n   * Handle a real or faked right-click event by showing a context menu.\r\n   *\r\n   * @param e A pointerdown event.\r\n   * @internal\r\n   */\r\n  handleRightClick(e: PointerEvent) {\r\n    if (this.targetBlock) {\r\n      this.bringBlockToFront();\r\n      this.targetBlock.workspace.hideChaff(!!this.flyout);\r\n      this.targetBlock.showContextMenu(e);\r\n    } else if (this.startBubble) {\r\n      this.startBubble.showContextMenu(e);\r\n    } else if (this.startWorkspace_ && !this.flyout) {\r\n      this.startWorkspace_.hideChaff();\r\n      this.startWorkspace_.showContextMenu(e);\r\n    }\r\n\r\n    // TODO: Handle right-click on a bubble.\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n\r\n    this.dispose();\r\n  }\r\n\r\n  /**\r\n   * Handle a pointerdown event on a workspace.\r\n   *\r\n   * @param e A pointerdown event.\r\n   * @param ws The workspace the event hit.\r\n   * @internal\r\n   */\r\n  handleWsStart(e: PointerEvent, ws: WorkspaceSvg) {\r\n    if (this.gestureHasStarted) {\r\n      throw Error(\r\n        'Tried to call gesture.handleWsStart, ' +\r\n          'but the gesture had already been started.',\r\n      );\r\n    }\r\n    this.setStartWorkspace(ws);\r\n    this.mostRecentEvent = e;\r\n    this.doStart(e);\r\n  }\r\n\r\n  /**\r\n   * Fires a workspace click event.\r\n   *\r\n   * @param ws The workspace that a user clicks on.\r\n   */\r\n  private fireWorkspaceClick(ws: WorkspaceSvg) {\r\n    eventUtils.fire(\r\n      new (eventUtils.get(eventUtils.CLICK))(null, ws.id, 'workspace'),\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Handle a pointerdown event on a flyout.\r\n   *\r\n   * @param e A pointerdown event.\r\n   * @param flyout The flyout the event hit.\r\n   * @internal\r\n   */\r\n  handleFlyoutStart(e: PointerEvent, flyout: IFlyout) {\r\n    if (this.gestureHasStarted) {\r\n      throw Error(\r\n        'Tried to call gesture.handleFlyoutStart, ' +\r\n          'but the gesture had already been started.',\r\n      );\r\n    }\r\n    this.setStartFlyout(flyout);\r\n    this.handleWsStart(e, flyout.getWorkspace());\r\n  }\r\n\r\n  /**\r\n   * Handle a pointerdown event on a block.\r\n   *\r\n   * @param e A pointerdown event.\r\n   * @param block The block the event hit.\r\n   * @internal\r\n   */\r\n  handleBlockStart(e: PointerEvent, block: BlockSvg) {\r\n    if (this.gestureHasStarted) {\r\n      throw Error(\r\n        'Tried to call gesture.handleBlockStart, ' +\r\n          'but the gesture had already been started.',\r\n      );\r\n    }\r\n    this.setStartBlock(block);\r\n    this.mostRecentEvent = e;\r\n  }\r\n\r\n  /**\r\n   * Handle a pointerdown event on a bubble.\r\n   *\r\n   * @param e A pointerdown event.\r\n   * @param bubble The bubble the event hit.\r\n   * @internal\r\n   */\r\n  handleBubbleStart(e: PointerEvent, bubble: IBubble) {\r\n    if (this.gestureHasStarted) {\r\n      throw Error(\r\n        'Tried to call gesture.handleBubbleStart, ' +\r\n          'but the gesture had already been started.',\r\n      );\r\n    }\r\n    this.setStartBubble(bubble);\r\n    this.mostRecentEvent = e;\r\n  }\r\n\r\n  /* Begin functions defining what actions to take to execute clicks on each\r\n   * type of target.  Any developer wanting to add behaviour on clicks should\r\n   * modify only this code. */\r\n\r\n  /** Execute a bubble click. */\r\n  private doBubbleClick() {\r\n    // TODO (#1673): Consistent handling of single clicks.\r\n    if (this.startBubble instanceof WorkspaceCommentSvg) {\r\n      this.startBubble.setFocus();\r\n      this.startBubble.select();\r\n    }\r\n  }\r\n\r\n  /** Execute a field click. */\r\n  private doFieldClick() {\r\n    if (!this.startField) {\r\n      throw new Error(\r\n        'Cannot do a field click because the start field is undefined',\r\n      );\r\n    }\r\n\r\n    // Only show the editor if the field's editor wasn't already open\r\n    // right before this gesture started.\r\n    const dropdownAlreadyOpen = this.currentDropdownOwner === this.startField;\r\n    if (!dropdownAlreadyOpen) {\r\n      this.startField.showEditor(this.mostRecentEvent);\r\n    }\r\n    this.bringBlockToFront();\r\n  }\r\n\r\n  /** Execute an icon click. */\r\n  private doIconClick() {\r\n    if (!this.startIcon) {\r\n      throw new Error(\r\n        'Cannot do an icon click because the start icon is undefined',\r\n      );\r\n    }\r\n    this.bringBlockToFront();\r\n    this.startIcon.onClick();\r\n  }\r\n\r\n  /** Execute a block click. */\r\n  private doBlockClick() {\r\n    // Block click in an autoclosing flyout.\r\n    if (this.flyout && this.flyout.autoClose) {\r\n      if (!this.targetBlock) {\r\n        throw new Error(\r\n          'Cannot do a block click because the target block is ' + 'undefined',\r\n        );\r\n      }\r\n      if (this.targetBlock.isEnabled()) {\r\n        if (!eventUtils.getGroup()) {\r\n          eventUtils.setGroup(true);\r\n        }\r\n        const newBlock = this.flyout.createBlock(this.targetBlock);\r\n        newBlock.scheduleSnapAndBump();\r\n      }\r\n    } else {\r\n      if (!this.startWorkspace_) {\r\n        throw new Error(\r\n          'Cannot do a block click because the start workspace ' +\r\n            'is undefined',\r\n        );\r\n      }\r\n      // Clicks events are on the start block, even if it was a shadow.\r\n      const event = new (eventUtils.get(eventUtils.CLICK))(\r\n        this.startBlock,\r\n        this.startWorkspace_.id,\r\n        'block',\r\n      );\r\n      eventUtils.fire(event);\r\n    }\r\n    this.bringBlockToFront();\r\n    eventUtils.setGroup(false);\r\n  }\r\n\r\n  /**\r\n   * Execute a workspace click. When in accessibility mode shift clicking will\r\n   * move the cursor.\r\n   *\r\n   * @param _e A pointerup event.\r\n   */\r\n  private doWorkspaceClick(_e: PointerEvent) {\r\n    const ws = this.creatorWorkspace;\r\n    if (common.getSelected()) {\r\n      common.getSelected()!.unselect();\r\n    }\r\n    this.fireWorkspaceClick(this.startWorkspace_ || ws);\r\n  }\r\n\r\n  /* End functions defining what actions to take to execute clicks on each type\r\n   * of target. */\r\n\r\n  // TODO (fenichel): Move bubbles to the front.\r\n\r\n  /**\r\n   * Move the dragged/clicked block to the front of the workspace so that it is\r\n   * not occluded by other blocks.\r\n   */\r\n  private bringBlockToFront() {\r\n    // Blocks in the flyout don't overlap, so skip the work.\r\n    if (this.targetBlock && !this.flyout) {\r\n      this.targetBlock.bringToFront();\r\n    }\r\n  }\r\n\r\n  /* Begin functions for populating a gesture at pointerdown. */\r\n\r\n  /**\r\n   * Record the field that a gesture started on.\r\n   *\r\n   * @param field The field the gesture started on.\r\n   * @internal\r\n   */\r\n  setStartField<T>(field: Field<T>) {\r\n    if (this.gestureHasStarted) {\r\n      throw Error(\r\n        'Tried to call gesture.setStartField, ' +\r\n          'but the gesture had already been started.',\r\n      );\r\n    }\r\n    if (!this.startField) {\r\n      this.startField = field as Field;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Record the icon that a gesture started on.\r\n   *\r\n   * @param icon The icon the gesture started on.\r\n   * @internal\r\n   */\r\n  setStartIcon(icon: IIcon) {\r\n    if (this.gestureHasStarted) {\r\n      throw Error(\r\n        'Tried to call gesture.setStartIcon, ' +\r\n          'but the gesture had already been started.',\r\n      );\r\n    }\r\n\r\n    if (!this.startIcon) this.startIcon = icon;\r\n  }\r\n\r\n  /**\r\n   * Record the bubble that a gesture started on\r\n   *\r\n   * @param bubble The bubble the gesture started on.\r\n   * @internal\r\n   */\r\n  setStartBubble(bubble: IBubble) {\r\n    if (!this.startBubble) {\r\n      this.startBubble = bubble;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Record the block that a gesture started on, and set the target block\r\n   * appropriately.\r\n   *\r\n   * @param block The block the gesture started on.\r\n   * @internal\r\n   */\r\n  setStartBlock(block: BlockSvg) {\r\n    // If the gesture already went through a bubble, don't set the start block.\r\n    if (!this.startBlock && !this.startBubble) {\r\n      this.startBlock = block;\r\n      if (block.isInFlyout && block !== block.getRootBlock()) {\r\n        this.setTargetBlock(block.getRootBlock());\r\n      } else {\r\n        this.setTargetBlock(block);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Record the block that a gesture targets, meaning the block that will be\r\n   * dragged if this turns into a drag.  If this block is a shadow, that will be\r\n   * its first non-shadow parent.\r\n   *\r\n   * @param block The block the gesture targets.\r\n   */\r\n  private setTargetBlock(block: BlockSvg) {\r\n    if (block.isShadow()) {\r\n      // Non-null assertion is fine b/c it is an invariant that shadows always\r\n      // have parents.\r\n      this.setTargetBlock(block.getParent()!);\r\n    } else {\r\n      this.targetBlock = block;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Record the workspace that a gesture started on.\r\n   *\r\n   * @param ws The workspace the gesture started on.\r\n   */\r\n  private setStartWorkspace(ws: WorkspaceSvg) {\r\n    if (!this.startWorkspace_) {\r\n      this.startWorkspace_ = ws;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Record the flyout that a gesture started on.\r\n   *\r\n   * @param flyout The flyout the gesture started on.\r\n   */\r\n  private setStartFlyout(flyout: IFlyout) {\r\n    if (!this.flyout) {\r\n      this.flyout = flyout;\r\n    }\r\n  }\r\n\r\n  /* End functions for populating a gesture at pointerdown. */\r\n\r\n  /* Begin helper functions defining types of clicks.  Any developer wanting\r\n   * to change the definition of a click should modify only this code. */\r\n\r\n  /**\r\n   * Whether this gesture is a click on a bubble.  This should only be called\r\n   * when ending a gesture (pointerup).\r\n   *\r\n   * @returns Whether this gesture was a click on a bubble.\r\n   */\r\n  private isBubbleClick(): boolean {\r\n    // A bubble click starts on a bubble and never escapes the drag radius.\r\n    const hasStartBubble = !!this.startBubble;\r\n    return hasStartBubble && !this.hasExceededDragRadius;\r\n  }\r\n\r\n  /**\r\n   * Whether this gesture is a click on a block.  This should only be called\r\n   * when ending a gesture (pointerup).\r\n   *\r\n   * @returns Whether this gesture was a click on a block.\r\n   */\r\n  private isBlockClick(): boolean {\r\n    // A block click starts on a block, never escapes the drag radius, and is\r\n    // not a field click.\r\n    const hasStartBlock = !!this.startBlock;\r\n    return (\r\n      hasStartBlock &&\r\n      !this.hasExceededDragRadius &&\r\n      !this.isFieldClick() &&\r\n      !this.isIconClick()\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Whether this gesture is a click on a field that should be handled.  This should only be called\r\n   * when ending a gesture (pointerup).\r\n   *\r\n   * @returns Whether this gesture was a click on a field.\r\n   */\r\n  private isFieldClick(): boolean {\r\n    if (!this.startField) return false;\r\n    return (\r\n      this.startField.isClickable() &&\r\n      !this.hasExceededDragRadius &&\r\n      (!this.flyout ||\r\n        this.startField.isClickableInFlyout(this.flyout.autoClose))\r\n    );\r\n  }\r\n\r\n  /** @returns Whether this gesture is a click on an icon that should be handled. */\r\n  private isIconClick(): boolean {\r\n    if (!this.startIcon) return false;\r\n    const handleInFlyout =\r\n      !this.flyout ||\r\n      !this.startIcon.isClickableInFlyout ||\r\n      this.startIcon.isClickableInFlyout(this.flyout.autoClose);\r\n    return !this.hasExceededDragRadius && handleInFlyout;\r\n  }\r\n\r\n  /**\r\n   * Whether this gesture is a click on a workspace.  This should only be called\r\n   * when ending a gesture (pointerup).\r\n   *\r\n   * @returns Whether this gesture was a click on a workspace.\r\n   */\r\n  private isWorkspaceClick(): boolean {\r\n    const onlyTouchedWorkspace =\r\n      !this.startBlock && !this.startBubble && !this.startField;\r\n    return onlyTouchedWorkspace && !this.hasExceededDragRadius;\r\n  }\r\n\r\n  /* End helper functions defining types of clicks. */\r\n\r\n  /**\r\n   * Whether this gesture is a drag of either a workspace or block.\r\n   * This function is called externally to block actions that cannot be taken\r\n   * mid-drag (e.g. using the keyboard to delete the selected blocks).\r\n   *\r\n   * @returns True if this gesture is a drag of a workspace or block.\r\n   * @internal\r\n   */\r\n  isDragging(): boolean {\r\n    return (\r\n      !!this.workspaceDragger || !!this.blockDragger || !!this.bubbleDragger\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Whether this gesture has already been started.  In theory every pointerdown\r\n   * has a corresponding pointerup, but in reality it is possible to lose a\r\n   * pointerup, leaving an in-process gesture hanging.\r\n   *\r\n   * @returns Whether this gesture was a click on a workspace.\r\n   * @internal\r\n   */\r\n  hasStarted(): boolean {\r\n    return this.gestureHasStarted;\r\n  }\r\n\r\n  /**\r\n   * Get a list of the insertion markers that currently exist.  Block drags have\r\n   * 0, 1, or 2 insertion markers.\r\n   *\r\n   * @returns A possibly empty list of insertion marker blocks.\r\n   * @internal\r\n   */\r\n  getInsertionMarkers(): BlockSvg[] {\r\n    if (this.blockDragger) {\r\n      return this.blockDragger.getInsertionMarkers();\r\n    }\r\n    return [];\r\n  }\r\n\r\n  /**\r\n   * Gets the current dragger if an item is being dragged. Null if nothing is\r\n   * being dragged.\r\n   *\r\n   * @returns The dragger that is currently in use or null if no drag is in\r\n   *     progress.\r\n   */\r\n  getCurrentDragger(): WorkspaceDragger | BubbleDragger | IBlockDragger | null {\r\n    return this.blockDragger ?? this.workspaceDragger ?? this.bubbleDragger;\r\n  }\r\n\r\n  /**\r\n   * Is a drag or other gesture currently in progress on any workspace?\r\n   *\r\n   * @returns True if gesture is occurring.\r\n   */\r\n  static inProgress(): boolean {\r\n    const workspaces = common.getAllWorkspaces();\r\n    for (let i = 0, workspace; (workspace = workspaces[i]); i++) {\r\n      // Not actually necessarily a WorkspaceSvg, but it doesn't matter b/c\r\n      // we're just checking if the property exists. Theoretically we would\r\n      // want to use instanceof, but that causes a circular dependency.\r\n      if ((workspace as WorkspaceSvg).currentGesture_) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Object for configuring and updating a workspace grid in\r\n * Blockly.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.Grid\r\n\r\nimport * as dom from './utils/dom.js';\r\nimport {Svg} from './utils/svg.js';\r\nimport {GridOptions} from './options.js';\r\n\r\n/**\r\n * Class for a workspace's grid.\r\n */\r\nexport class Grid {\r\n  private spacing: number;\r\n  private length: number;\r\n  private scale: number = 1;\r\n  private readonly line1: SVGElement;\r\n  private readonly line2: SVGElement;\r\n  private snapToGrid: boolean;\r\n\r\n  /**\r\n   * @param pattern The grid's SVG pattern, created during injection.\r\n   * @param options A dictionary of normalized options for the grid.\r\n   *     See grid documentation:\r\n   *     https://developers.google.com/blockly/guides/configure/web/grid\r\n   */\r\n  constructor(\r\n    private pattern: SVGElement,\r\n    options: GridOptions,\r\n  ) {\r\n    /** The spacing of the grid lines (in px). */\r\n    this.spacing = options['spacing'] ?? 0;\r\n\r\n    /** How long the grid lines should be (in px). */\r\n    this.length = options['length'] ?? 1;\r\n\r\n    /** The horizontal grid line, if it exists. */\r\n    this.line1 = pattern.firstChild as SVGElement;\r\n\r\n    /** The vertical grid line, if it exists. */\r\n    this.line2 = this.line1 && (this.line1.nextSibling as SVGElement);\r\n\r\n    /** Whether blocks should snap to the grid. */\r\n    this.snapToGrid = options['snap'] ?? false;\r\n  }\r\n\r\n  /**\r\n   * Sets the spacing between the centers of the grid lines.\r\n   *\r\n   * This does not trigger snapping to the newly spaced grid. If you want to\r\n   * snap blocks to the grid programmatically that needs to be triggered\r\n   * on individual top-level blocks. The next time a block is dragged and\r\n   * dropped it will snap to the grid if snapping to the grid is enabled.\r\n   */\r\n  setSpacing(spacing: number) {\r\n    this.spacing = spacing;\r\n    this.update(this.scale);\r\n  }\r\n\r\n  /** Sets the length of the grid lines. */\r\n  setLength(length: number) {\r\n    this.length = length;\r\n    this.update(this.scale);\r\n  }\r\n\r\n  /**\r\n   * Sets whether blocks should snap to the grid or not.\r\n   *\r\n   * Setting this to true does not trigger snapping. If you want to snap blocks\r\n   * to the grid programmatically that needs to be triggered on individual\r\n   * top-level blocks. The next time a block is dragged and dropped it will\r\n   * snap to the grid.\r\n   */\r\n  setSnapToGrid(snap: boolean) {\r\n    this.snapToGrid = snap;\r\n  }\r\n\r\n  /**\r\n   * Whether blocks should snap to the grid, based on the initial configuration.\r\n   *\r\n   * @returns True if blocks should snap, false otherwise.\r\n   * @internal\r\n   */\r\n  shouldSnap(): boolean {\r\n    return this.snapToGrid;\r\n  }\r\n\r\n  /**\r\n   * Get the spacing of the grid points (in px).\r\n   *\r\n   * @returns The spacing of the grid points.\r\n   * @internal\r\n   */\r\n  getSpacing(): number {\r\n    return this.spacing;\r\n  }\r\n\r\n  /**\r\n   * Get the ID of the pattern element, which should be randomized to avoid\r\n   * conflicts with other Blockly instances on the page.\r\n   *\r\n   * @returns The pattern ID.\r\n   * @internal\r\n   */\r\n  getPatternId(): string {\r\n    return this.pattern.id;\r\n  }\r\n\r\n  /**\r\n   * Update the grid with a new scale.\r\n   *\r\n   * @param scale The new workspace scale.\r\n   * @internal\r\n   */\r\n  update(scale: number) {\r\n    this.scale = scale;\r\n    const safeSpacing = this.spacing * scale;\r\n\r\n    this.pattern.setAttribute('width', `${safeSpacing}`);\r\n    this.pattern.setAttribute('height', `${safeSpacing}`);\r\n\r\n    let half = Math.floor(this.spacing / 2) + 0.5;\r\n    let start = half - this.length / 2;\r\n    let end = half + this.length / 2;\r\n\r\n    half *= scale;\r\n    start *= scale;\r\n    end *= scale;\r\n\r\n    this.setLineAttributes(this.line1, scale, start, end, half, half);\r\n    this.setLineAttributes(this.line2, scale, half, half, start, end);\r\n  }\r\n\r\n  /**\r\n   * Set the attributes on one of the lines in the grid.  Use this to update the\r\n   * length and stroke width of the grid lines.\r\n   *\r\n   * @param line Which line to update.\r\n   * @param width The new stroke size (in px).\r\n   * @param x1 The new x start position of the line (in px).\r\n   * @param x2 The new x end position of the line (in px).\r\n   * @param y1 The new y start position of the line (in px).\r\n   * @param y2 The new y end position of the line (in px).\r\n   */\r\n  private setLineAttributes(\r\n    line: SVGElement,\r\n    width: number,\r\n    x1: number,\r\n    x2: number,\r\n    y1: number,\r\n    y2: number,\r\n  ) {\r\n    if (line) {\r\n      line.setAttribute('stroke-width', `${width}`);\r\n      line.setAttribute('x1', `${x1}`);\r\n      line.setAttribute('y1', `${y1}`);\r\n      line.setAttribute('x2', `${x2}`);\r\n      line.setAttribute('y2', `${y2}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Move the grid to a new x and y position, and make sure that change is\r\n   * visible.\r\n   *\r\n   * @param x The new x position of the grid (in px).\r\n   * @param y The new y position of the grid (in px).\r\n   * @internal\r\n   */\r\n  moveTo(x: number, y: number) {\r\n    this.pattern.setAttribute('x', `${x}`);\r\n    this.pattern.setAttribute('y', `${y}`);\r\n  }\r\n\r\n  /**\r\n   * Create the DOM for the grid described by options.\r\n   *\r\n   * @param rnd A random ID to append to the pattern's ID.\r\n   * @param gridOptions The object containing grid configuration.\r\n   * @param defs The root SVG element for this workspace's defs.\r\n   * @returns The SVG element for the grid pattern.\r\n   * @internal\r\n   */\r\n  static createDom(\r\n    rnd: string,\r\n    gridOptions: GridOptions,\r\n    defs: SVGElement,\r\n  ): SVGElement {\r\n    /*\r\n          <pattern id=\"blocklyGridPattern837493\" patternUnits=\"userSpaceOnUse\">\r\n            <rect stroke=\"#888\" />\r\n            <rect stroke=\"#888\" />\r\n          </pattern>\r\n        */\r\n    const gridPattern = dom.createSvgElement(\r\n      Svg.PATTERN,\r\n      {'id': 'blocklyGridPattern' + rnd, 'patternUnits': 'userSpaceOnUse'},\r\n      defs,\r\n    );\r\n    // x1, y1, x1, x2 properties will be set later in update.\r\n    if ((gridOptions['length'] ?? 1) > 0 && (gridOptions['spacing'] ?? 0) > 0) {\r\n      dom.createSvgElement(\r\n        Svg.LINE,\r\n        {'stroke': gridOptions['colour']},\r\n        gridPattern,\r\n      );\r\n      if (gridOptions['length'] ?? 1 > 1) {\r\n        dom.createSvgElement(\r\n          Svg.LINE,\r\n          {'stroke': gridOptions['colour']},\r\n          gridPattern,\r\n        );\r\n      }\r\n    } else {\r\n      // Edge 16 doesn't handle empty patterns\r\n      dom.createSvgElement(Svg.LINE, {}, gridPattern);\r\n    }\r\n    return gridPattern;\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Object in charge of managing markers and the cursor.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.MarkerManager\r\n\r\nimport type {Cursor} from './keyboard_nav/cursor.js';\r\nimport type {Marker} from './keyboard_nav/marker.js';\r\nimport type {WorkspaceSvg} from './workspace_svg.js';\r\n\r\n/**\r\n * Class to manage the multiple markers and the cursor on a workspace.\r\n */\r\nexport class MarkerManager {\r\n  /** The name of the local marker. */\r\n  static readonly LOCAL_MARKER = 'local_marker_1';\r\n\r\n  /** The cursor. */\r\n  private cursor_: Cursor | null = null;\r\n\r\n  /** The cursor's SVG element. */\r\n  private cursorSvg_: SVGElement | null = null;\r\n\r\n  /** The map of markers for the workspace. */\r\n  private markers = new Map<string, Marker>();\r\n\r\n  /** The marker's SVG element. */\r\n  private markerSvg_: SVGElement | null = null;\r\n\r\n  /**\r\n   * @param workspace The workspace for the marker manager.\r\n   * @internal\r\n   */\r\n  constructor(private readonly workspace: WorkspaceSvg) {}\r\n\r\n  /**\r\n   * Register the marker by adding it to the map of markers.\r\n   *\r\n   * @param id A unique identifier for the marker.\r\n   * @param marker The marker to register.\r\n   */\r\n  registerMarker(id: string, marker: Marker) {\r\n    if (this.markers.has(id)) {\r\n      this.unregisterMarker(id);\r\n    }\r\n    marker.setDrawer(\r\n      this.workspace.getRenderer().makeMarkerDrawer(this.workspace, marker),\r\n    );\r\n    this.setMarkerSvg(marker.getDrawer().createDom());\r\n    this.markers.set(id, marker);\r\n  }\r\n\r\n  /**\r\n   * Unregister the marker by removing it from the map of markers.\r\n   *\r\n   * @param id The ID of the marker to unregister.\r\n   */\r\n  unregisterMarker(id: string) {\r\n    const marker = this.markers.get(id);\r\n    if (marker) {\r\n      marker.dispose();\r\n      this.markers.delete(id);\r\n    } else {\r\n      throw Error(\r\n        'Marker with ID ' +\r\n          id +\r\n          ' does not exist. ' +\r\n          'Can only unregister markers that exist.',\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the cursor for the workspace.\r\n   *\r\n   * @returns The cursor for this workspace.\r\n   */\r\n  getCursor(): Cursor | null {\r\n    return this.cursor_;\r\n  }\r\n\r\n  /**\r\n   * Get a single marker that corresponds to the given ID.\r\n   *\r\n   * @param id A unique identifier for the marker.\r\n   * @returns The marker that corresponds to the given ID, or null if none\r\n   *     exists.\r\n   */\r\n  getMarker(id: string): Marker | null {\r\n    return this.markers.get(id) || null;\r\n  }\r\n\r\n  /**\r\n   * Sets the cursor and initializes the drawer for use with keyboard\r\n   * navigation.\r\n   *\r\n   * @param cursor The cursor used to move around this workspace.\r\n   */\r\n  setCursor(cursor: Cursor) {\r\n    if (this.cursor_ && this.cursor_.getDrawer()) {\r\n      this.cursor_.getDrawer().dispose();\r\n    }\r\n    this.cursor_ = cursor;\r\n    if (this.cursor_) {\r\n      const drawer = this.workspace\r\n        .getRenderer()\r\n        .makeMarkerDrawer(this.workspace, this.cursor_);\r\n      this.cursor_.setDrawer(drawer);\r\n      this.setCursorSvg(this.cursor_.getDrawer().createDom());\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add the cursor SVG to this workspace SVG group.\r\n   *\r\n   * @param cursorSvg The SVG root of the cursor to be added to the workspace\r\n   *     SVG group.\r\n   * @internal\r\n   */\r\n  setCursorSvg(cursorSvg: SVGElement | null) {\r\n    if (!cursorSvg) {\r\n      this.cursorSvg_ = null;\r\n      return;\r\n    }\r\n\r\n    this.workspace.getBlockCanvas()!.appendChild(cursorSvg);\r\n    this.cursorSvg_ = cursorSvg;\r\n  }\r\n\r\n  /**\r\n   * Add the marker SVG to this workspaces SVG group.\r\n   *\r\n   * @param markerSvg The SVG root of the marker to be added to the workspace\r\n   *     SVG group.\r\n   * @internal\r\n   */\r\n  setMarkerSvg(markerSvg: SVGElement | null) {\r\n    if (!markerSvg) {\r\n      this.markerSvg_ = null;\r\n      return;\r\n    }\r\n\r\n    if (this.workspace.getBlockCanvas()) {\r\n      if (this.cursorSvg_) {\r\n        this.workspace\r\n          .getBlockCanvas()!\r\n          .insertBefore(markerSvg, this.cursorSvg_);\r\n      } else {\r\n        this.workspace.getBlockCanvas()!.appendChild(markerSvg);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Redraw the attached cursor SVG if needed.\r\n   *\r\n   * @internal\r\n   */\r\n  updateMarkers() {\r\n    if (this.workspace.keyboardAccessibilityMode && this.cursorSvg_) {\r\n      this.workspace.getCursor()!.draw();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Dispose of the marker manager.\r\n   * Go through and delete all markers associated with this marker manager.\r\n   *\r\n   * @internal\r\n   */\r\n  dispose() {\r\n    const markerIds = Object.keys(this.markers);\r\n    for (let i = 0, markerId; (markerId = markerIds[i]); i++) {\r\n      this.unregisterMarker(markerId);\r\n    }\r\n    this.markers.clear();\r\n    if (this.cursor_) {\r\n      this.cursor_.dispose();\r\n      this.cursor_ = null;\r\n    }\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2018 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * The class representing a theme.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.Theme\r\n\r\nimport * as registry from './registry.js';\r\nimport * as object from './utils/object.js';\r\n\r\nexport interface ITheme {\r\n  blockStyles?: {[key: string]: Partial<BlockStyle>};\r\n  categoryStyles?: {[key: string]: CategoryStyle};\r\n  componentStyles?: ComponentStyle;\r\n  fontStyle?: FontStyle;\r\n  startHats?: boolean;\r\n  base?: string | Theme;\r\n  name: string;\r\n}\r\n\r\n/**\r\n * Class for a theme.\r\n */\r\nexport class Theme implements ITheme {\r\n  /** @internal */\r\n  blockStyles: {[key: string]: BlockStyle};\r\n  /** @internal */\r\n  categoryStyles: {[key: string]: CategoryStyle};\r\n  /** @internal */\r\n  componentStyles: ComponentStyle;\r\n  /** @internal */\r\n  fontStyle: FontStyle;\r\n\r\n  /**\r\n   * Whether or not to add a 'hat' on top of all blocks with no previous or\r\n   * output connections.\r\n   *\r\n   * @internal\r\n   */\r\n  startHats?: boolean = false;\r\n\r\n  /**\r\n   * @param name Theme name.\r\n   * @param opt_blockStyles A map from style names (strings) to objects with\r\n   *     style attributes for blocks.\r\n   * @param opt_categoryStyles A map from style names (strings) to objects with\r\n   *     style attributes for categories.\r\n   * @param opt_componentStyles A map of Blockly component names to style value.\r\n   */\r\n  constructor(\r\n    public name: string,\r\n    opt_blockStyles?: {[key: string]: Partial<BlockStyle>},\r\n    opt_categoryStyles?: {[key: string]: CategoryStyle},\r\n    opt_componentStyles?: ComponentStyle,\r\n  ) {\r\n    /** The block styles map. */\r\n    this.blockStyles = opt_blockStyles || Object.create(null);\r\n\r\n    /** The category styles map. */\r\n    this.categoryStyles = opt_categoryStyles || Object.create(null);\r\n\r\n    /** The UI components styles map. */\r\n    this.componentStyles =\r\n      opt_componentStyles || (Object.create(null) as ComponentStyle);\r\n\r\n    /** The font style. */\r\n    this.fontStyle = Object.create(null) as FontStyle;\r\n\r\n    // Register the theme by name.\r\n    registry.register(registry.Type.THEME, name, this, true);\r\n  }\r\n\r\n  /**\r\n   * Gets the class name that identifies this theme.\r\n   *\r\n   * @returns The CSS class name.\r\n   * @internal\r\n   */\r\n  getClassName(): string {\r\n    return this.name + '-theme';\r\n  }\r\n\r\n  /**\r\n   * Overrides or adds a style to the blockStyles map.\r\n   *\r\n   * @param blockStyleName The name of the block style.\r\n   * @param blockStyle The block style.\r\n   */\r\n  setBlockStyle(blockStyleName: string, blockStyle: BlockStyle) {\r\n    this.blockStyles[blockStyleName] = blockStyle;\r\n  }\r\n\r\n  /**\r\n   * Overrides or adds a style to the categoryStyles map.\r\n   *\r\n   * @param categoryStyleName The name of the category style.\r\n   * @param categoryStyle The category style.\r\n   */\r\n  setCategoryStyle(categoryStyleName: string, categoryStyle: CategoryStyle) {\r\n    this.categoryStyles[categoryStyleName] = categoryStyle;\r\n  }\r\n\r\n  /**\r\n   * Gets the style for a given Blockly UI component.  If the style value is a\r\n   * string, we attempt to find the value of any named references.\r\n   *\r\n   * @param componentName The name of the component.\r\n   * @returns The style value.\r\n   */\r\n  getComponentStyle(componentName: string): string | null {\r\n    const style = (this.componentStyles as AnyDuringMigration)[componentName];\r\n    if (!style) {\r\n      return null;\r\n    }\r\n    if (typeof style === 'string') {\r\n      const recursiveStyle = this.getComponentStyle(style);\r\n      if (recursiveStyle) {\r\n        return recursiveStyle;\r\n      }\r\n    }\r\n    return `${style}`;\r\n  }\r\n\r\n  /**\r\n   * Configure a specific Blockly UI component with a style value.\r\n   *\r\n   * @param componentName The name of the component.\r\n   * @param styleValue The style value.\r\n   */\r\n  setComponentStyle(componentName: string, styleValue: AnyDuringMigration) {\r\n    (this.componentStyles as AnyDuringMigration)[componentName] = styleValue;\r\n  }\r\n\r\n  /**\r\n   * Configure a theme's font style.\r\n   *\r\n   * @param fontStyle The font style.\r\n   */\r\n  setFontStyle(fontStyle: FontStyle) {\r\n    this.fontStyle = fontStyle;\r\n  }\r\n\r\n  /**\r\n   * Configure a theme's start hats.\r\n   *\r\n   * @param startHats True if the theme enables start hats, false otherwise.\r\n   */\r\n  setStartHats(startHats: boolean) {\r\n    this.startHats = startHats;\r\n  }\r\n\r\n  /**\r\n   * Define a new Blockly theme.\r\n   *\r\n   * @param name The name of the theme.\r\n   * @param themeObj An object containing theme properties.\r\n   * @returns A new Blockly theme.\r\n   */\r\n  static defineTheme(name: string, themeObj: ITheme): Theme {\r\n    name = name.toLowerCase();\r\n    const theme = new Theme(name);\r\n    let base = themeObj['base'];\r\n    if (base) {\r\n      if (typeof base === 'string') {\r\n        base = registry.getObject(registry.Type.THEME, base) ?? undefined;\r\n      }\r\n      if (base instanceof Theme) {\r\n        object.deepMerge(theme, base);\r\n        theme.name = name;\r\n      }\r\n    }\r\n\r\n    object.deepMerge(theme.blockStyles, themeObj['blockStyles']);\r\n    object.deepMerge(theme.categoryStyles, themeObj['categoryStyles']);\r\n    object.deepMerge(theme.componentStyles, themeObj['componentStyles']);\r\n    object.deepMerge(theme.fontStyle, themeObj['fontStyle']);\r\n    if (themeObj['startHats'] !== null) {\r\n      theme.startHats = themeObj['startHats'];\r\n    }\r\n\r\n    return theme;\r\n  }\r\n}\r\n\r\nexport namespace Theme {\r\n  export interface BlockStyle {\r\n    colourPrimary: string;\r\n    colourSecondary: string;\r\n    colourTertiary: string;\r\n    hat: string;\r\n  }\r\n\r\n  export interface CategoryStyle {\r\n    colour: string;\r\n  }\r\n\r\n  export interface ComponentStyle {\r\n    workspaceBackgroundColour?: string;\r\n    toolboxBackgroundColour?: string;\r\n    toolboxForegroundColour?: string;\r\n    flyoutBackgroundColour?: string;\r\n    flyoutForegroundColour?: string;\r\n    flyoutOpacity?: number;\r\n    scrollbarColour?: string;\r\n    scrollbarOpacity?: number;\r\n    insertionMarkerColour?: string;\r\n    insertionMarkerOpacity?: number;\r\n    markerColour?: string;\r\n    cursorColour?: string;\r\n    selectedGlowColour?: string;\r\n    selectedGlowOpacity?: number;\r\n    replacementGlowColour?: string;\r\n    replacementGlowOpacity?: number;\r\n  }\r\n\r\n  export interface FontStyle {\r\n    family?: string;\r\n    weight?: string;\r\n    size?: number;\r\n  }\r\n}\r\n\r\nexport type BlockStyle = Theme.BlockStyle;\r\nexport type CategoryStyle = Theme.CategoryStyle;\r\nexport type ComponentStyle = Theme.ComponentStyle;\r\nexport type FontStyle = Theme.FontStyle;\r\n","/**\r\n * @license\r\n * Copyright 2018 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.Themes.Classic\r\n\r\nimport {Theme} from '../theme.js';\r\n\r\nconst defaultBlockStyles = {\r\n  'colour_blocks': {'colourPrimary': '20'},\r\n  'list_blocks': {'colourPrimary': '260'},\r\n  'logic_blocks': {'colourPrimary': '210'},\r\n  'loop_blocks': {'colourPrimary': '120'},\r\n  'math_blocks': {'colourPrimary': '230'},\r\n  'procedure_blocks': {'colourPrimary': '290'},\r\n  'text_blocks': {'colourPrimary': '160'},\r\n  'variable_blocks': {'colourPrimary': '330'},\r\n  'variable_dynamic_blocks': {'colourPrimary': '310'},\r\n  'hat_blocks': {'colourPrimary': '330', 'hat': 'cap'},\r\n};\r\n\r\nconst categoryStyles = {\r\n  'colour_category': {'colour': '20'},\r\n  'list_category': {'colour': '260'},\r\n  'logic_category': {'colour': '210'},\r\n  'loop_category': {'colour': '120'},\r\n  'math_category': {'colour': '230'},\r\n  'procedure_category': {'colour': '290'},\r\n  'text_category': {'colour': '160'},\r\n  'variable_category': {'colour': '330'},\r\n  'variable_dynamic_category': {'colour': '310'},\r\n};\r\n\r\n/**\r\n * Classic theme.\r\n * Contains multi-coloured border to create shadow effect.\r\n */\r\nexport const Classic = new Theme('classic', defaultBlockStyles, categoryStyles);\r\n","/**\r\n * @license\r\n * Copyright 2016 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Object that controls settings for the workspace.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.Options\r\n\r\nimport type {BlocklyOptions} from './blockly_options.js';\r\nimport * as deprecation from './utils/deprecation.js';\r\nimport * as registry from './registry.js';\r\nimport {Theme} from './theme.js';\r\nimport {Classic} from './theme/classic.js';\r\nimport * as idGenerator from './utils/idgenerator.js';\r\nimport type {Metrics} from './utils/metrics.js';\r\nimport * as toolbox from './utils/toolbox.js';\r\nimport type {WorkspaceSvg} from './workspace_svg.js';\r\n\r\n/**\r\n * Parse the user-specified options, using reasonable defaults where behaviour\r\n * is unspecified.\r\n */\r\nexport class Options {\r\n  RTL: boolean;\r\n  oneBasedIndex: boolean;\r\n  collapse: boolean;\r\n  comments: boolean;\r\n  disable: boolean;\r\n  readOnly: boolean;\r\n  maxBlocks: number;\r\n  maxInstances: {[key: string]: number} | null;\r\n  modalInputs: boolean;\r\n  pathToMedia: string;\r\n  hasCategories: boolean;\r\n  moveOptions: MoveOptions;\r\n  hasScrollbars: boolean;\r\n  hasTrashcan: boolean;\r\n  maxTrashcanContents: number;\r\n  hasSounds: boolean;\r\n  hasCss: boolean;\r\n  horizontalLayout: boolean;\r\n  languageTree: toolbox.ToolboxInfo | null;\r\n  gridOptions: GridOptions;\r\n  zoomOptions: ZoomOptions;\r\n  toolboxPosition: toolbox.Position;\r\n  theme: Theme;\r\n  renderer: string;\r\n  rendererOverrides: {[rendererConstant: string]: any} | null;\r\n\r\n  /**\r\n   * The SVG element for the grid pattern.\r\n   * Created during injection.\r\n   */\r\n  gridPattern: SVGElement | null = null;\r\n  parentWorkspace: WorkspaceSvg | null;\r\n  plugins: {[key: string]: (new (...p1: any[]) => any) | string};\r\n\r\n  /**\r\n   * If set, sets the translation of the workspace to match the scrollbars.\r\n   * A function that\r\n   *     sets the translation of the workspace to match the scrollbars. The\r\n   *     argument Contains an x and/or y property which is a float between 0\r\n   *     and 1 specifying the degree of scrolling.\r\n   */\r\n  setMetrics?: (p1: {x?: number; y?: number}) => void = undefined;\r\n\r\n  /**\r\n   * A function that returns a metrics\r\n   *     object that describes the current workspace.\r\n   */\r\n  getMetrics?: () => Metrics = undefined;\r\n\r\n  /**\r\n   * @param options Dictionary of options.\r\n   *     Specification:\r\n   * https://developers.google.com/blockly/guides/get-started/web#configuration\r\n   */\r\n  constructor(options: BlocklyOptions) {\r\n    let toolboxJsonDef = null;\r\n    let hasCategories = false;\r\n    let hasTrashcan = false;\r\n    let hasCollapse = false;\r\n    let hasComments = false;\r\n    let hasDisable = false;\r\n    let hasSounds = false;\r\n    const readOnly = !!options['readOnly'];\r\n    if (!readOnly) {\r\n      toolboxJsonDef = toolbox.convertToolboxDefToJson(\r\n        options['toolbox'] ?? null,\r\n      );\r\n      hasCategories = toolbox.hasCategories(toolboxJsonDef);\r\n      const rawHasTrashcan = options['trashcan'];\r\n      hasTrashcan =\r\n        rawHasTrashcan === undefined ? hasCategories : rawHasTrashcan;\r\n      const rawHasCollapse = options['collapse'];\r\n      hasCollapse =\r\n        rawHasCollapse === undefined ? hasCategories : rawHasCollapse;\r\n      const rawHasComments = options['comments'];\r\n      hasComments =\r\n        rawHasComments === undefined ? hasCategories : rawHasComments;\r\n      const rawHasDisable = options['disable'];\r\n      hasDisable = rawHasDisable === undefined ? hasCategories : rawHasDisable;\r\n      const rawHasSounds = options['sounds'];\r\n      hasSounds = rawHasSounds === undefined ? true : rawHasSounds;\r\n    }\r\n\r\n    let maxTrashcanContents = options['maxTrashcanContents'];\r\n    if (hasTrashcan) {\r\n      if (maxTrashcanContents === undefined) {\r\n        maxTrashcanContents = 32;\r\n      }\r\n    } else {\r\n      maxTrashcanContents = 0;\r\n    }\r\n    const rtl = !!options['rtl'];\r\n    let horizontalLayout = options['horizontalLayout'];\r\n    if (horizontalLayout === undefined) {\r\n      horizontalLayout = false;\r\n    }\r\n    const toolboxAtStart = options['toolboxPosition'] !== 'end';\r\n\r\n    let toolboxPosition: toolbox.Position;\r\n    if (horizontalLayout) {\r\n      toolboxPosition = toolboxAtStart\r\n        ? toolbox.Position.TOP\r\n        : toolbox.Position.BOTTOM;\r\n    } else {\r\n      toolboxPosition =\r\n        toolboxAtStart === rtl ? toolbox.Position.RIGHT : toolbox.Position.LEFT;\r\n    }\r\n\r\n    let hasCss = options['css'];\r\n    if (hasCss === undefined) {\r\n      hasCss = true;\r\n    }\r\n    let pathToMedia = 'https://blockly-demo.appspot.com/static/media/';\r\n    if (options['media']) {\r\n      pathToMedia = options['media'].endsWith('/')\r\n        ? options['media']\r\n        : options['media'] + '/';\r\n    } else if ('path' in options) {\r\n      // 'path' is a deprecated option which has been replaced by 'media'.\r\n      deprecation.warn('path', 'Nov 2014', 'Jul 2023', 'media');\r\n      pathToMedia = (options as any)['path'] + 'media/';\r\n    }\r\n    const rawOneBasedIndex = options['oneBasedIndex'];\r\n    const oneBasedIndex =\r\n      rawOneBasedIndex === undefined ? true : rawOneBasedIndex;\r\n    const renderer = options['renderer'] || 'geras';\r\n\r\n    const plugins = options['plugins'] || {};\r\n\r\n    let modalInputs = options['modalInputs'];\r\n    if (modalInputs === undefined) {\r\n      modalInputs = true;\r\n    }\r\n\r\n    this.RTL = rtl;\r\n    this.oneBasedIndex = oneBasedIndex;\r\n    this.collapse = hasCollapse;\r\n    this.comments = hasComments;\r\n    this.disable = hasDisable;\r\n    this.readOnly = readOnly;\r\n    this.maxBlocks = options['maxBlocks'] || Infinity;\r\n    this.maxInstances = options['maxInstances'] ?? null;\r\n    this.modalInputs = modalInputs;\r\n    this.pathToMedia = pathToMedia;\r\n    this.hasCategories = hasCategories;\r\n    this.moveOptions = Options.parseMoveOptions_(options, hasCategories);\r\n    /** @deprecated  January 2019 */\r\n    this.hasScrollbars = !!this.moveOptions.scrollbars;\r\n    this.hasTrashcan = hasTrashcan;\r\n    this.maxTrashcanContents = maxTrashcanContents;\r\n    this.hasSounds = hasSounds;\r\n    this.hasCss = hasCss;\r\n    this.horizontalLayout = horizontalLayout;\r\n    this.languageTree = toolboxJsonDef;\r\n    this.gridOptions = Options.parseGridOptions_(options);\r\n    this.zoomOptions = Options.parseZoomOptions_(options);\r\n    this.toolboxPosition = toolboxPosition;\r\n    this.theme = Options.parseThemeOptions_(options);\r\n    this.renderer = renderer;\r\n    this.rendererOverrides = options['rendererOverrides'] ?? null;\r\n\r\n    /**\r\n     * The parent of the current workspace, or null if there is no parent\r\n     * workspace.  We can assert that this is of type WorkspaceSvg as opposed to\r\n     * Workspace as this is only used in a rendered workspace.\r\n     */\r\n    this.parentWorkspace = options['parentWorkspace'] ?? null;\r\n\r\n    /** Map of plugin type to name of registered plugin or plugin class. */\r\n    this.plugins = plugins;\r\n  }\r\n\r\n  /**\r\n   * Parse the user-specified move options, using reasonable defaults where\r\n   *    behaviour is unspecified.\r\n   *\r\n   * @param options Dictionary of options.\r\n   * @param hasCategories Whether the workspace has categories or not.\r\n   * @returns Normalized move options.\r\n   */\r\n  private static parseMoveOptions_(\r\n    options: BlocklyOptions,\r\n    hasCategories: boolean,\r\n  ): MoveOptions {\r\n    const move = options['move'] || {};\r\n    const moveOptions = {} as MoveOptions;\r\n    if (\r\n      move['scrollbars'] === undefined &&\r\n      options['scrollbars'] === undefined\r\n    ) {\r\n      moveOptions.scrollbars = hasCategories;\r\n    } else if (typeof move['scrollbars'] === 'object') {\r\n      moveOptions.scrollbars = {\r\n        'horizontal': !!move['scrollbars']['horizontal'],\r\n        'vertical': !!move['scrollbars']['vertical'],\r\n      };\r\n      // Convert scrollbars object to boolean if they have the same value.\r\n      // This allows us to easily check for whether any scrollbars exist using\r\n      // !!moveOptions.scrollbars.\r\n      if (\r\n        moveOptions.scrollbars.horizontal &&\r\n        moveOptions.scrollbars.vertical\r\n      ) {\r\n        moveOptions.scrollbars = true;\r\n      } else if (\r\n        !moveOptions.scrollbars.horizontal &&\r\n        !moveOptions.scrollbars.vertical\r\n      ) {\r\n        moveOptions.scrollbars = false;\r\n      }\r\n    } else {\r\n      moveOptions.scrollbars = !!move['scrollbars'] || !!options['scrollbars'];\r\n    }\r\n\r\n    if (!moveOptions.scrollbars || move['wheel'] === undefined) {\r\n      // Defaults to true if single-direction scroll is enabled.\r\n      moveOptions.wheel = typeof moveOptions.scrollbars === 'object';\r\n    } else {\r\n      moveOptions.wheel = !!move['wheel'];\r\n    }\r\n    if (!moveOptions.scrollbars) {\r\n      moveOptions.drag = false;\r\n    } else if (move['drag'] === undefined) {\r\n      // Defaults to true if scrollbars is true.\r\n      moveOptions.drag = true;\r\n    } else {\r\n      moveOptions.drag = !!move['drag'];\r\n    }\r\n    return moveOptions;\r\n  }\r\n\r\n  /**\r\n   * Parse the user-specified zoom options, using reasonable defaults where\r\n   * behaviour is unspecified.  See zoom documentation:\r\n   *   https://developers.google.com/blockly/guides/configure/web/zoom\r\n   *\r\n   * @param options Dictionary of options.\r\n   * @returns Normalized zoom options.\r\n   */\r\n  private static parseZoomOptions_(options: BlocklyOptions): ZoomOptions {\r\n    const zoom = options['zoom'] || {};\r\n    const zoomOptions = {} as ZoomOptions;\r\n    if (zoom['controls'] === undefined) {\r\n      zoomOptions.controls = false;\r\n    } else {\r\n      zoomOptions.controls = !!zoom['controls'];\r\n    }\r\n    if (zoom['wheel'] === undefined) {\r\n      zoomOptions.wheel = false;\r\n    } else {\r\n      zoomOptions.wheel = !!zoom['wheel'];\r\n    }\r\n    if (zoom['startScale'] === undefined) {\r\n      zoomOptions.startScale = 1;\r\n    } else {\r\n      zoomOptions.startScale = Number(zoom['startScale']);\r\n    }\r\n    if (zoom['maxScale'] === undefined) {\r\n      zoomOptions.maxScale = 3;\r\n    } else {\r\n      zoomOptions.maxScale = Number(zoom['maxScale']);\r\n    }\r\n    if (zoom['minScale'] === undefined) {\r\n      zoomOptions.minScale = 0.3;\r\n    } else {\r\n      zoomOptions.minScale = Number(zoom['minScale']);\r\n    }\r\n    if (zoom['scaleSpeed'] === undefined) {\r\n      zoomOptions.scaleSpeed = 1.2;\r\n    } else {\r\n      zoomOptions.scaleSpeed = Number(zoom['scaleSpeed']);\r\n    }\r\n    if (zoom['pinch'] === undefined) {\r\n      zoomOptions.pinch = zoomOptions.wheel || zoomOptions.controls;\r\n    } else {\r\n      zoomOptions.pinch = !!zoom['pinch'];\r\n    }\r\n    return zoomOptions;\r\n  }\r\n\r\n  /**\r\n   * Parse the user-specified grid options, using reasonable defaults where\r\n   * behaviour is unspecified. See grid documentation:\r\n   *   https://developers.google.com/blockly/guides/configure/web/grid\r\n   *\r\n   * @param options Dictionary of options.\r\n   * @returns Normalized grid options.\r\n   */\r\n  private static parseGridOptions_(options: BlocklyOptions): GridOptions {\r\n    const grid = options['grid'] || {};\r\n    const gridOptions = {} as GridOptions;\r\n    gridOptions.spacing = Number(grid['spacing']) || 0;\r\n    gridOptions.colour = grid['colour'] || '#888';\r\n    gridOptions.length =\r\n      grid['length'] === undefined ? 1 : Number(grid['length']);\r\n    gridOptions.snap = gridOptions.spacing > 0 && !!grid['snap'];\r\n    return gridOptions;\r\n  }\r\n\r\n  /**\r\n   * Parse the user-specified theme options, using the classic theme as a\r\n   * default. https://developers.google.com/blockly/guides/configure/web/themes\r\n   *\r\n   * @param options Dictionary of options.\r\n   * @returns A Blockly Theme.\r\n   */\r\n  private static parseThemeOptions_(options: BlocklyOptions): Theme {\r\n    const theme = options['theme'] || Classic;\r\n    if (typeof theme === 'string') {\r\n      return registry.getObject(registry.Type.THEME, theme) as Theme;\r\n    } else if (theme instanceof Theme) {\r\n      return theme;\r\n    }\r\n    return Theme.defineTheme(\r\n      theme.name || 'builtin' + idGenerator.getNextUniqueId(),\r\n      theme,\r\n    );\r\n  }\r\n}\r\n\r\nexport namespace Options {\r\n  export interface GridOptions {\r\n    colour: string;\r\n    length: number;\r\n    snap: boolean;\r\n    spacing: number;\r\n  }\r\n\r\n  export interface MoveOptions {\r\n    drag: boolean;\r\n    scrollbars: boolean | ScrollbarOptions;\r\n    wheel: boolean;\r\n  }\r\n\r\n  export interface ScrollbarOptions {\r\n    horizontal: boolean;\r\n    vertical: boolean;\r\n  }\r\n\r\n  export interface ZoomOptions {\r\n    controls: boolean;\r\n    maxScale: number;\r\n    minScale: number;\r\n    pinch: boolean;\r\n    scaleSpeed: number;\r\n    startScale: number;\r\n    wheel: boolean;\r\n  }\r\n}\r\n\r\nexport type GridOptions = Options.GridOptions;\r\nexport type MoveOptions = Options.MoveOptions;\r\nexport type ScrollbarOptions = Options.ScrollbarOptions;\r\nexport type ZoomOptions = Options.ZoomOptions;\r\n","/**\r\n * @license\r\n * Copyright 2018 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Class for a block change event.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.Events.BlockChange\r\n\r\nimport type {Block} from '../block.js';\r\nimport type {BlockSvg} from '../block_svg.js';\r\nimport {IconType} from '../icons/icon_types.js';\r\nimport {hasBubble} from '../interfaces/i_has_bubble.js';\r\nimport * as registry from '../registry.js';\r\nimport * as utilsXml from '../utils/xml.js';\r\nimport {Workspace} from '../workspace.js';\r\nimport * as Xml from '../xml.js';\r\n\r\nimport {BlockBase, BlockBaseJson} from './events_block_base.js';\r\nimport * as eventUtils from './utils.js';\r\n\r\n/**\r\n * Notifies listeners when some element of a block has changed (e.g.\r\n * field values, comments, etc).\r\n */\r\nexport class BlockChange extends BlockBase {\r\n  override type = eventUtils.BLOCK_CHANGE;\r\n  /**\r\n   * The element that changed; one of 'field', 'comment', 'collapsed',\r\n   * 'disabled', 'inline', or 'mutation'\r\n   */\r\n  element?: string;\r\n\r\n  /** The name of the field that changed, if this is a change to a field. */\r\n  name?: string;\r\n\r\n  /** The original value of the element. */\r\n  oldValue: unknown;\r\n\r\n  /** The new value of the element. */\r\n  newValue: unknown;\r\n\r\n  /**\r\n   * @param opt_block The changed block.  Undefined for a blank event.\r\n   * @param opt_element One of 'field', 'comment', 'disabled', etc.\r\n   * @param opt_name Name of input or field affected, or null.\r\n   * @param opt_oldValue Previous value of element.\r\n   * @param opt_newValue New value of element.\r\n   */\r\n  constructor(\r\n    opt_block?: Block,\r\n    opt_element?: string,\r\n    opt_name?: string | null,\r\n    opt_oldValue?: unknown,\r\n    opt_newValue?: unknown,\r\n  ) {\r\n    super(opt_block);\r\n\r\n    if (!opt_block) {\r\n      return; // Blank event to be populated by fromJson.\r\n    }\r\n    this.element = opt_element;\r\n    this.name = opt_name || undefined;\r\n    this.oldValue = opt_oldValue;\r\n    this.newValue = opt_newValue;\r\n  }\r\n\r\n  /**\r\n   * Encode the event as JSON.\r\n   *\r\n   * @returns JSON representation.\r\n   */\r\n  override toJson(): BlockChangeJson {\r\n    const json = super.toJson() as BlockChangeJson;\r\n    if (!this.element) {\r\n      throw new Error(\r\n        'The changed element is undefined. Either pass an ' +\r\n          'element to the constructor, or call fromJson',\r\n      );\r\n    }\r\n    json['element'] = this.element;\r\n    json['name'] = this.name;\r\n    json['oldValue'] = this.oldValue;\r\n    json['newValue'] = this.newValue;\r\n    return json;\r\n  }\r\n\r\n  /**\r\n   * Deserializes the JSON event.\r\n   *\r\n   * @param event The event to append new properties to. Should be a subclass\r\n   *     of BlockChange, but we can't specify that due to the fact that\r\n   *     parameters to static methods in subclasses must be supertypes of\r\n   *     parameters to static methods in superclasses.\r\n   * @internal\r\n   */\r\n  static fromJson(\r\n    json: BlockChangeJson,\r\n    workspace: Workspace,\r\n    event?: any,\r\n  ): BlockChange {\r\n    const newEvent = super.fromJson(\r\n      json,\r\n      workspace,\r\n      event ?? new BlockChange(),\r\n    ) as BlockChange;\r\n    newEvent.element = json['element'];\r\n    newEvent.name = json['name'];\r\n    newEvent.oldValue = json['oldValue'];\r\n    newEvent.newValue = json['newValue'];\r\n    return newEvent;\r\n  }\r\n\r\n  /**\r\n   * Does this event record any change of state?\r\n   *\r\n   * @returns False if something changed.\r\n   */\r\n  override isNull(): boolean {\r\n    return this.oldValue === this.newValue;\r\n  }\r\n\r\n  /**\r\n   * Run a change event.\r\n   *\r\n   * @param forward True if run forward, false if run backward (undo).\r\n   */\r\n  override run(forward: boolean) {\r\n    const workspace = this.getEventWorkspace_();\r\n    if (!this.blockId) {\r\n      throw new Error(\r\n        'The block ID is undefined. Either pass a block to ' +\r\n          'the constructor, or call fromJson',\r\n      );\r\n    }\r\n    const block = workspace.getBlockById(this.blockId);\r\n    if (!block) {\r\n      throw new Error(\r\n        'The associated block is undefined. Either pass a ' +\r\n          'block to the constructor, or call fromJson',\r\n      );\r\n    }\r\n    // Assume the block is rendered so that then we can check.\r\n    const icon = block.getIcon(IconType.MUTATOR);\r\n    if (icon && hasBubble(icon) && icon.bubbleIsVisible()) {\r\n      // Close the mutator (if open) since we don't want to update it.\r\n      icon.setBubbleVisible(false);\r\n    }\r\n    const value = forward ? this.newValue : this.oldValue;\r\n    switch (this.element) {\r\n      case 'field': {\r\n        const field = block.getField(this.name!);\r\n        if (field) {\r\n          field.setValue(value);\r\n        } else {\r\n          console.warn(\"Can't set non-existent field: \" + this.name);\r\n        }\r\n        break;\r\n      }\r\n      case 'comment':\r\n        block.setCommentText((value as string) || null);\r\n        break;\r\n      case 'collapsed':\r\n        block.setCollapsed(!!value);\r\n        break;\r\n      case 'disabled':\r\n        block.setEnabled(!value);\r\n        break;\r\n      case 'inline':\r\n        block.setInputsInline(!!value);\r\n        break;\r\n      case 'mutation': {\r\n        const oldState = BlockChange.getExtraBlockState_(block as BlockSvg);\r\n        if (block.loadExtraState) {\r\n          block.loadExtraState(JSON.parse((value as string) || '{}'));\r\n        } else if (block.domToMutation) {\r\n          block.domToMutation(\r\n            utilsXml.textToDom((value as string) || '<mutation/>'),\r\n          );\r\n        }\r\n        eventUtils.fire(\r\n          new BlockChange(block, 'mutation', null, oldState, value),\r\n        );\r\n        break;\r\n      }\r\n      default:\r\n        console.warn('Unknown change type: ' + this.element);\r\n    }\r\n  }\r\n\r\n  // TODO (#5397): Encapsulate this in the BlocklyMutationChange event when\r\n  //    refactoring change events.\r\n  /**\r\n   * Returns the extra state of the given block (either as XML or a JSO,\r\n   * depending on the block's definition).\r\n   *\r\n   * @param block The block to get the extra state of.\r\n   * @returns A stringified version of the extra state of the given block.\r\n   * @internal\r\n   */\r\n  static getExtraBlockState_(block: BlockSvg): string {\r\n    if (block.saveExtraState) {\r\n      const state = block.saveExtraState(true);\r\n      return state ? JSON.stringify(state) : '';\r\n    } else if (block.mutationToDom) {\r\n      const state = block.mutationToDom();\r\n      return state ? Xml.domToText(state) : '';\r\n    }\r\n    return '';\r\n  }\r\n}\r\n\r\nexport interface BlockChangeJson extends BlockBaseJson {\r\n  element: string;\r\n  name?: string;\r\n  newValue: unknown;\r\n  oldValue: unknown;\r\n}\r\n\r\nregistry.register(registry.Type.EVENT, eventUtils.CHANGE, BlockChange);\r\n","/**\r\n * @license\r\n * Copyright 2012 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Field.  Used for editable titles, variables, etc.\r\n * This is an abstract class that defines the UI on the block.  Actual\r\n * instances would be FieldTextInput, FieldDropdown, etc.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.Field\r\n\r\n// Unused import preserved for side-effects. Remove if unneeded.\r\nimport './events/events_block_change.js';\r\n\r\nimport type {Block} from './block.js';\r\nimport type {BlockSvg} from './block_svg.js';\r\nimport * as browserEvents from './browser_events.js';\r\nimport * as dropDownDiv from './dropdowndiv.js';\r\nimport * as eventUtils from './events/utils.js';\r\nimport type {Input} from './inputs/input.js';\r\nimport type {IASTNodeLocationSvg} from './interfaces/i_ast_node_location_svg.js';\r\nimport type {IASTNodeLocationWithBlock} from './interfaces/i_ast_node_location_with_block.js';\r\nimport type {IKeyboardAccessible} from './interfaces/i_keyboard_accessible.js';\r\nimport type {IRegistrable} from './interfaces/i_registrable.js';\r\nimport {MarkerManager} from './marker_manager.js';\r\nimport type {ConstantProvider} from './renderers/common/constants.js';\r\nimport type {KeyboardShortcut} from './shortcut_registry.js';\r\nimport * as Tooltip from './tooltip.js';\r\nimport type {Coordinate} from './utils/coordinate.js';\r\nimport * as dom from './utils/dom.js';\r\nimport * as parsing from './utils/parsing.js';\r\nimport {Rect} from './utils/rect.js';\r\nimport {Size} from './utils/size.js';\r\nimport * as style from './utils/style.js';\r\nimport {Svg} from './utils/svg.js';\r\nimport * as userAgent from './utils/useragent.js';\r\nimport * as utilsXml from './utils/xml.js';\r\nimport * as WidgetDiv from './widgetdiv.js';\r\nimport type {WorkspaceSvg} from './workspace_svg.js';\r\nimport {ISerializable} from './interfaces/i_serializable.js';\r\n\r\n/**\r\n * A function that is called to validate changes to the field's value before\r\n * they are set.\r\n *\r\n * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/fields/validators#return_values}\r\n * @param newValue The value to be validated.\r\n * @returns One of three instructions for setting the new value: `T`, `null`,\r\n * or `undefined`.\r\n *\r\n * - `T` to set this function's returned value instead of `newValue`.\r\n *\r\n * - `null` to invoke `doValueInvalid_` and not set a value.\r\n *\r\n * - `undefined` to set `newValue` as is.\r\n */\r\nexport type FieldValidator<T = any> = (newValue: T) => T | null | undefined;\r\n\r\n/**\r\n * Abstract class for an editable field.\r\n *\r\n * @typeParam T - The value stored on the field.\r\n */\r\nexport abstract class Field<T = any>\r\n  implements\r\n    IASTNodeLocationSvg,\r\n    IASTNodeLocationWithBlock,\r\n    IKeyboardAccessible,\r\n    IRegistrable,\r\n    ISerializable\r\n{\r\n  /**\r\n   * To overwrite the default value which is set in **Field**, directly update\r\n   * the prototype.\r\n   *\r\n   * Example:\r\n   * `FieldImage.prototype.DEFAULT_VALUE = null;`\r\n   */\r\n  DEFAULT_VALUE: T | null = null;\r\n\r\n  /** Non-breaking space. */\r\n  static readonly NBSP = '\\u00A0';\r\n\r\n  /**\r\n   * A value used to signal when a field's constructor should *not* set the\r\n   * field's value or run configure_, and should allow a subclass to do that\r\n   * instead.\r\n   */\r\n  static readonly SKIP_SETUP = Symbol('SKIP_SETUP');\r\n\r\n  /**\r\n   * Name of field.  Unique within each block.\r\n   * Static labels are usually unnamed.\r\n   */\r\n  name?: string = undefined;\r\n  protected value_: T | null;\r\n\r\n  /** Validation function called when user edits an editable field. */\r\n  protected validator_: FieldValidator<T> | null = null;\r\n\r\n  /**\r\n   * Used to cache the field's tooltip value if setTooltip is called when the\r\n   * field is not yet initialized. Is *not* guaranteed to be accurate.\r\n   */\r\n  private tooltip_: Tooltip.TipInfo | null = null;\r\n  protected size_: Size;\r\n\r\n  /**\r\n   * Holds the cursors svg element when the cursor is attached to the field.\r\n   * This is null if there is no cursor on the field.\r\n   */\r\n  private cursorSvg_: SVGElement | null = null;\r\n\r\n  /**\r\n   * Holds the markers svg element when the marker is attached to the field.\r\n   * This is null if there is no marker on the field.\r\n   */\r\n  private markerSvg_: SVGElement | null = null;\r\n\r\n  /** The rendered field's SVG group element. */\r\n  protected fieldGroup_: SVGGElement | null = null;\r\n\r\n  /** The rendered field's SVG border element. */\r\n  protected borderRect_: SVGRectElement | null = null;\r\n\r\n  /** The rendered field's SVG text element. */\r\n  protected textElement_: SVGTextElement | null = null;\r\n\r\n  /** The rendered field's text content element. */\r\n  protected textContent_: Text | null = null;\r\n\r\n  /** Mouse down event listener data. */\r\n  private mouseDownWrapper_: browserEvents.Data | null = null;\r\n\r\n  /** Constants associated with the source block's renderer. */\r\n  protected constants_: ConstantProvider | null = null;\r\n\r\n  /**\r\n   * Has this field been disposed of?\r\n   *\r\n   * @internal\r\n   */\r\n  disposed = false;\r\n\r\n  /** Maximum characters of text to display before adding an ellipsis. */\r\n  maxDisplayLength = 50;\r\n\r\n  /** Block this field is attached to.  Starts as null, then set in init. */\r\n  protected sourceBlock_: Block | null = null;\r\n\r\n  /** Does this block need to be re-rendered? */\r\n  protected isDirty_ = true;\r\n\r\n  /** Is the field visible, or hidden due to the block being collapsed? */\r\n  protected visible_ = true;\r\n\r\n  /**\r\n   * Can the field value be changed using the editor on an editable block?\r\n   */\r\n  protected enabled_ = true;\r\n\r\n  /** The element the click handler is bound to. */\r\n  protected clickTarget_: Element | null = null;\r\n\r\n  /**\r\n   * The prefix field.\r\n   *\r\n   * @internal\r\n   */\r\n  prefixField: string | null = null;\r\n\r\n  /**\r\n   * The suffix field.\r\n   *\r\n   * @internal\r\n   */\r\n  suffixField: string | null = null;\r\n\r\n  /**\r\n   * Editable fields usually show some sort of UI indicating they are\r\n   * editable. They will also be saved by the serializer.\r\n   */\r\n  EDITABLE = true;\r\n\r\n  /**\r\n   * Serializable fields are saved by the serializer, non-serializable fields\r\n   * are not. Editable fields should also be serializable. This is not the\r\n   * case by default so that SERIALIZABLE is backwards compatible.\r\n   */\r\n  SERIALIZABLE = false;\r\n\r\n  /** Mouse cursor style when over the hotspot that initiates the editor. */\r\n  CURSOR = '';\r\n\r\n  /**\r\n   * @param value The initial value of the field.\r\n   *     Also accepts Field.SKIP_SETUP if you wish to skip setup (only used by\r\n   * subclasses that want to handle configuration and setting the field value\r\n   * after their own constructors have run).\r\n   * @param validator  A function that is called to validate changes to the\r\n   *     field's value. Takes in a value & returns a validated value, or null to\r\n   *     abort the change.\r\n   * @param config A map of options used to configure the field.\r\n   *    Refer to the individual field's documentation for a list of properties\r\n   * this parameter supports.\r\n   */\r\n  constructor(\r\n    value: T | typeof Field.SKIP_SETUP,\r\n    validator?: FieldValidator<T> | null,\r\n    config?: FieldConfig,\r\n  ) {\r\n    /**\r\n     * A generic value possessed by the field.\r\n     * Should generally be non-null, only null when the field is created.\r\n     */\r\n    this.value_ =\r\n      'DEFAULT_VALUE' in new.target.prototype\r\n        ? new.target.prototype.DEFAULT_VALUE\r\n        : this.DEFAULT_VALUE;\r\n\r\n    /** The size of the area rendered by the field. */\r\n    this.size_ = new Size(0, 0);\r\n\r\n    if (value === Field.SKIP_SETUP) return;\r\n    if (config) {\r\n      this.configure_(config);\r\n    }\r\n    this.setValue(value);\r\n    if (validator) {\r\n      this.setValidator(validator);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Process the configuration map passed to the field.\r\n   *\r\n   * @param config A map of options used to configure the field. See the\r\n   *     individual field's documentation for a list of properties this\r\n   *     parameter supports.\r\n   */\r\n  protected configure_(config: FieldConfig) {\r\n    // TODO (#2884): Possibly add CSS class config option.\r\n    // TODO (#2885): Possibly add cursor config option.\r\n    if (config.tooltip) {\r\n      this.setTooltip(parsing.replaceMessageReferences(config.tooltip));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Attach this field to a block.\r\n   *\r\n   * @param block The block containing this field.\r\n   */\r\n  setSourceBlock(block: Block) {\r\n    if (this.sourceBlock_) {\r\n      throw Error('Field already bound to a block');\r\n    }\r\n    this.sourceBlock_ = block;\r\n  }\r\n\r\n  /**\r\n   * Get the renderer constant provider.\r\n   *\r\n   * @returns The renderer constant provider.\r\n   */\r\n  getConstants(): ConstantProvider | null {\r\n    if (\r\n      !this.constants_ &&\r\n      this.sourceBlock_ &&\r\n      !this.sourceBlock_.isDeadOrDying() &&\r\n      this.sourceBlock_.workspace.rendered\r\n    ) {\r\n      this.constants_ = (this.sourceBlock_.workspace as WorkspaceSvg)\r\n        .getRenderer()\r\n        .getConstants();\r\n    }\r\n    return this.constants_;\r\n  }\r\n\r\n  /**\r\n   * Get the block this field is attached to.\r\n   *\r\n   * @returns The block containing this field.\r\n   * @throws An error if the source block is not defined.\r\n   */\r\n  getSourceBlock(): Block | null {\r\n    return this.sourceBlock_;\r\n  }\r\n\r\n  /**\r\n   * Initialize everything to render this field. Override\r\n   * methods initModel and initView rather than this method.\r\n   *\r\n   * @sealed\r\n   * @internal\r\n   */\r\n  init() {\r\n    if (this.fieldGroup_) {\r\n      // Field has already been initialized once.\r\n      return;\r\n    }\r\n    this.fieldGroup_ = dom.createSvgElement(Svg.G, {});\r\n    if (!this.isVisible()) {\r\n      this.fieldGroup_.style.display = 'none';\r\n    }\r\n    const sourceBlockSvg = this.sourceBlock_ as BlockSvg;\r\n    sourceBlockSvg.getSvgRoot().appendChild(this.fieldGroup_);\r\n    this.initView();\r\n    this.updateEditable();\r\n    this.setTooltip(this.tooltip_);\r\n    this.bindEvents_();\r\n    this.initModel();\r\n  }\r\n\r\n  /**\r\n   * Create the block UI for this field.\r\n   */\r\n  protected initView() {\r\n    this.createBorderRect_();\r\n    this.createTextElement_();\r\n  }\r\n\r\n  /**\r\n   * Initializes the model of the field after it has been installed on a block.\r\n   * No-op by default.\r\n   */\r\n  initModel() {}\r\n\r\n  /**\r\n   * Defines whether this field should take up the full block or not.\r\n   *\r\n   * Be cautious when overriding this function. It may not work as you expect /\r\n   * intend because the behavior was kind of hacked in. If you are thinking\r\n   * about overriding this function, post on the forum with your intended\r\n   * behavior to see if there's another approach.\r\n   */\r\n  protected isFullBlockField(): boolean {\r\n    return !this.borderRect_;\r\n  }\r\n\r\n  /**\r\n   * Create a field border rect element. Not to be overridden by subclasses.\r\n   * Instead modify the result of the function inside initView, or create a\r\n   * separate function to call.\r\n   */\r\n  protected createBorderRect_() {\r\n    this.borderRect_ = dom.createSvgElement(\r\n      Svg.RECT,\r\n      {\r\n        'rx': this.getConstants()!.FIELD_BORDER_RECT_RADIUS,\r\n        'ry': this.getConstants()!.FIELD_BORDER_RECT_RADIUS,\r\n        'x': 0,\r\n        'y': 0,\r\n        'height': this.size_.height,\r\n        'width': this.size_.width,\r\n        'class': 'blocklyFieldRect',\r\n      },\r\n      this.fieldGroup_,\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Create a field text element. Not to be overridden by subclasses. Instead\r\n   * modify the result of the function inside initView, or create a separate\r\n   * function to call.\r\n   */\r\n  protected createTextElement_() {\r\n    this.textElement_ = dom.createSvgElement(\r\n      Svg.TEXT,\r\n      {\r\n        'class': 'blocklyText',\r\n      },\r\n      this.fieldGroup_,\r\n    );\r\n    if (this.getConstants()!.FIELD_TEXT_BASELINE_CENTER) {\r\n      this.textElement_.setAttribute('dominant-baseline', 'central');\r\n    }\r\n    this.textContent_ = document.createTextNode('');\r\n    this.textElement_.appendChild(this.textContent_);\r\n  }\r\n\r\n  /**\r\n   * Bind events to the field. Can be overridden by subclasses if they need to\r\n   * do custom input handling.\r\n   */\r\n  protected bindEvents_() {\r\n    const clickTarget = this.getClickTarget_();\r\n    if (!clickTarget) throw new Error('A click target has not been set.');\r\n    Tooltip.bindMouseEvents(clickTarget);\r\n    this.mouseDownWrapper_ = browserEvents.conditionalBind(\r\n      clickTarget,\r\n      'pointerdown',\r\n      this,\r\n      this.onMouseDown_,\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Sets the field's value based on the given XML element. Should only be\r\n   * called by Blockly.Xml.\r\n   *\r\n   * @param fieldElement The element containing info about the field's state.\r\n   * @internal\r\n   */\r\n  fromXml(fieldElement: Element) {\r\n    // Any because gremlins live here. No touchie!\r\n    this.setValue(fieldElement.textContent as any);\r\n  }\r\n\r\n  /**\r\n   * Serializes this field's value to XML. Should only be called by Blockly.Xml.\r\n   *\r\n   * @param fieldElement The element to populate with info about the field's\r\n   *     state.\r\n   * @returns The element containing info about the field's state.\r\n   * @internal\r\n   */\r\n  toXml(fieldElement: Element): Element {\r\n    // Any because gremlins live here. No touchie!\r\n    fieldElement.textContent = this.getValue() as any;\r\n    return fieldElement;\r\n  }\r\n\r\n  /**\r\n   * Saves this fields value as something which can be serialized to JSON.\r\n   * Should only be called by the serialization system.\r\n   *\r\n   * @param _doFullSerialization If true, this signals to the field that if it\r\n   *     normally just saves a reference to some state (eg variable fields) it\r\n   *     should instead serialize the full state of the thing being referenced.\r\n   *     See the\r\n   *     {@link https://developers.devsite.google.com/blockly/guides/create-custom-blocks/fields/customizing-fields/creating#full_serialization_and_backing_data | field serialization docs}\r\n   *     for more information.\r\n   * @returns JSON serializable state.\r\n   * @internal\r\n   */\r\n  saveState(_doFullSerialization?: boolean): AnyDuringMigration {\r\n    const legacyState = this.saveLegacyState(Field);\r\n    if (legacyState !== null) {\r\n      return legacyState;\r\n    }\r\n    return this.getValue();\r\n  }\r\n\r\n  /**\r\n   * Sets the field's state based on the given state value. Should only be\r\n   * called by the serialization system.\r\n   *\r\n   * @param state The state we want to apply to the field.\r\n   * @internal\r\n   */\r\n  loadState(state: AnyDuringMigration) {\r\n    if (this.loadLegacyState(Field, state)) {\r\n      return;\r\n    }\r\n    this.setValue(state);\r\n  }\r\n\r\n  /**\r\n   * Returns a stringified version of the XML state, if it should be used.\r\n   * Otherwise this returns null, to signal the field should use its own\r\n   * serialization.\r\n   *\r\n   * @param callingClass The class calling this method.\r\n   *     Used to see if `this` has overridden any relevant hooks.\r\n   * @returns The stringified version of the XML state, or null.\r\n   */\r\n  protected saveLegacyState(callingClass: FieldProto): string | null {\r\n    if (\r\n      callingClass.prototype.saveState === this.saveState &&\r\n      callingClass.prototype.toXml !== this.toXml\r\n    ) {\r\n      const elem = utilsXml.createElement('field');\r\n      elem.setAttribute('name', this.name || '');\r\n      const text = utilsXml.domToText(this.toXml(elem));\r\n      return text.replace(\r\n        ' xmlns=\"https://developers.google.com/blockly/xml\"',\r\n        '',\r\n      );\r\n    }\r\n    // Either they called this on purpose from their saveState, or they have\r\n    // no implementations of either hook. Just do our thing.\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Loads the given state using either the old XML hooks, if they should be\r\n   * used. Returns true to indicate loading has been handled, false otherwise.\r\n   *\r\n   * @param callingClass The class calling this method.\r\n   *     Used to see if `this` has overridden any relevant hooks.\r\n   * @param state The state to apply to the field.\r\n   * @returns Whether the state was applied or not.\r\n   */\r\n  loadLegacyState(\r\n    callingClass: FieldProto,\r\n    state: AnyDuringMigration,\r\n  ): boolean {\r\n    if (\r\n      callingClass.prototype.loadState === this.loadState &&\r\n      callingClass.prototype.fromXml !== this.fromXml\r\n    ) {\r\n      this.fromXml(utilsXml.textToDom(state as string));\r\n      return true;\r\n    }\r\n    // Either they called this on purpose from their loadState, or they have\r\n    // no implementations of either hook. Just do our thing.\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Dispose of all DOM objects and events belonging to this editable field.\r\n   *\r\n   * @internal\r\n   */\r\n  dispose() {\r\n    dropDownDiv.hideIfOwner(this);\r\n    WidgetDiv.hideIfOwner(this);\r\n\r\n    if (!this.getSourceBlock()?.isDeadOrDying()) {\r\n      dom.removeNode(this.fieldGroup_);\r\n    }\r\n\r\n    this.disposed = true;\r\n  }\r\n\r\n  /** Add or remove the UI indicating if this field is editable or not. */\r\n  updateEditable() {\r\n    const group = this.fieldGroup_;\r\n    const block = this.getSourceBlock();\r\n    if (!this.EDITABLE || !group || !block) {\r\n      return;\r\n    }\r\n    if (this.enabled_ && block.isEditable()) {\r\n      dom.addClass(group, 'blocklyEditableText');\r\n      dom.removeClass(group, 'blocklyNonEditableText');\r\n      group.style.cursor = this.CURSOR;\r\n    } else {\r\n      dom.addClass(group, 'blocklyNonEditableText');\r\n      dom.removeClass(group, 'blocklyEditableText');\r\n      group.style.cursor = '';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set whether this field's value can be changed using the editor when the\r\n   *     source block is editable.\r\n   *\r\n   * @param enabled True if enabled.\r\n   */\r\n  setEnabled(enabled: boolean) {\r\n    this.enabled_ = enabled;\r\n    this.updateEditable();\r\n  }\r\n\r\n  /**\r\n   * Check whether this field's value can be changed using the editor when the\r\n   *     source block is editable.\r\n   *\r\n   * @returns Whether this field is enabled.\r\n   */\r\n  isEnabled(): boolean {\r\n    return this.enabled_;\r\n  }\r\n\r\n  /**\r\n   * Check whether this field defines the showEditor_ function.\r\n   *\r\n   * @returns Whether this field is clickable.\r\n   */\r\n  isClickable(): boolean {\r\n    return (\r\n      this.enabled_ &&\r\n      !!this.sourceBlock_ &&\r\n      this.sourceBlock_.isEditable() &&\r\n      this.showEditor_ !== Field.prototype.showEditor_\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Check whether the field should be clickable while the block is in a flyout.\r\n   * The default is that fields are clickable in always-open flyouts such as the\r\n   * simple toolbox, but not in autoclosing flyouts such as the category toolbox.\r\n   * Subclasses may override this function to change this behavior. Note that\r\n   * `isClickable` must also return true for this to have any effect.\r\n   *\r\n   * @param autoClosingFlyout true if the containing flyout is an auto-closing one.\r\n   * @returns Whether the field should be clickable while the block is in a flyout.\r\n   */\r\n  isClickableInFlyout(autoClosingFlyout: boolean): boolean {\r\n    return !autoClosingFlyout;\r\n  }\r\n\r\n  /**\r\n   * Check whether this field is currently editable.  Some fields are never\r\n   * EDITABLE (e.g. text labels). Other fields may be EDITABLE but may exist on\r\n   * non-editable blocks or be currently disabled.\r\n   *\r\n   * @returns Whether this field is currently enabled, editable and on an\r\n   *     editable block.\r\n   */\r\n  isCurrentlyEditable(): boolean {\r\n    return (\r\n      this.enabled_ &&\r\n      this.EDITABLE &&\r\n      !!this.sourceBlock_ &&\r\n      this.sourceBlock_.isEditable()\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Check whether this field should be serialized by the XML renderer.\r\n   * Handles the logic for backwards compatibility and incongruous states.\r\n   *\r\n   * @returns Whether this field should be serialized or not.\r\n   */\r\n  isSerializable(): boolean {\r\n    let isSerializable = false;\r\n    if (this.name) {\r\n      if (this.SERIALIZABLE) {\r\n        isSerializable = true;\r\n      } else if (this.EDITABLE) {\r\n        console.warn(\r\n          'Detected an editable field that was not serializable.' +\r\n            ' Please define SERIALIZABLE property as true on all editable custom' +\r\n            ' fields. Proceeding with serialization.',\r\n        );\r\n        isSerializable = true;\r\n      }\r\n    }\r\n    return isSerializable;\r\n  }\r\n\r\n  /**\r\n   * Gets whether this editable field is visible or not.\r\n   *\r\n   * @returns True if visible.\r\n   */\r\n  isVisible(): boolean {\r\n    return this.visible_;\r\n  }\r\n\r\n  /**\r\n   * Sets whether this editable field is visible or not. Should only be called\r\n   * by input.setVisible.\r\n   *\r\n   * @param visible True if visible.\r\n   * @internal\r\n   */\r\n  setVisible(visible: boolean) {\r\n    if (this.visible_ === visible) {\r\n      return;\r\n    }\r\n    this.visible_ = visible;\r\n    const root = this.fieldGroup_;\r\n    if (root) {\r\n      root.style.display = visible ? 'block' : 'none';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Sets a new validation function for editable fields, or clears a previously\r\n   * set validator.\r\n   *\r\n   * The validator function takes in the new field value, and returns\r\n   * validated value. The validated value could be the input value, a modified\r\n   * version of the input value, or null to abort the change.\r\n   *\r\n   * If the function does not return anything (or returns undefined) the new\r\n   * value is accepted as valid. This is to allow for fields using the\r\n   * validated function as a field-level change event notification.\r\n   *\r\n   * @param handler The validator function or null to clear a previous\r\n   *     validator.\r\n   */\r\n  setValidator(handler: FieldValidator<T>) {\r\n    this.validator_ = handler;\r\n  }\r\n\r\n  /**\r\n   * Gets the validation function for editable fields, or null if not set.\r\n   *\r\n   * @returns Validation function, or null.\r\n   */\r\n  getValidator(): FieldValidator<T> | null {\r\n    return this.validator_;\r\n  }\r\n\r\n  /**\r\n   * Gets the group element for this editable field.\r\n   * Used for measuring the size and for positioning.\r\n   *\r\n   * @returns The group element.\r\n   */\r\n  getSvgRoot(): SVGGElement | null {\r\n    return this.fieldGroup_;\r\n  }\r\n\r\n  /**\r\n   * Gets the border rectangle element.\r\n   *\r\n   * @returns The border rectangle element.\r\n   * @throws An error if the border rectangle element is not defined.\r\n   */\r\n  protected getBorderRect(): SVGRectElement {\r\n    if (!this.borderRect_) {\r\n      throw new Error(`The border rectangle is ${this.borderRect_}.`);\r\n    }\r\n    return this.borderRect_;\r\n  }\r\n\r\n  /**\r\n   * Gets the text element.\r\n   *\r\n   * @returns The text element.\r\n   * @throws An error if the text element is not defined.\r\n   */\r\n  protected getTextElement(): SVGTextElement {\r\n    if (!this.textElement_) {\r\n      throw new Error(`The text element is ${this.textElement_}.`);\r\n    }\r\n    return this.textElement_;\r\n  }\r\n\r\n  /**\r\n   * Gets the text content.\r\n   *\r\n   * @returns The text content.\r\n   * @throws An error if the text content is not defined.\r\n   */\r\n  protected getTextContent(): Text {\r\n    if (!this.textContent_) {\r\n      throw new Error(`The text content is ${this.textContent_}.`);\r\n    }\r\n    return this.textContent_;\r\n  }\r\n\r\n  /**\r\n   * Updates the field to match the colour/style of the block.\r\n   *\r\n   * Non-abstract sub-classes may wish to implement this if the colour of the\r\n   * field depends on the colour of the block. It will automatically be called\r\n   * at relevant times, such as when the parent block or renderer changes.\r\n   *\r\n   * See {@link\r\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/customizing-fields/creating#matching_block_colours\r\n   * | the field documentation} for more information, or FieldDropdown for an\r\n   * example.\r\n   */\r\n  applyColour() {}\r\n\r\n  /**\r\n   * Used by getSize() to move/resize any DOM elements, and get the new size.\r\n   *\r\n   * All rendering that has an effect on the size/shape of the block should be\r\n   * done here, and should be triggered by getSize().\r\n   */\r\n  protected render_() {\r\n    if (this.textContent_) {\r\n      this.textContent_.nodeValue = this.getDisplayText_();\r\n    }\r\n    this.updateSize_();\r\n  }\r\n\r\n  /**\r\n   * Calls showEditor_ when the field is clicked if the field is clickable.\r\n   * Do not override.\r\n   *\r\n   * @param e Optional mouse event that triggered the field to open, or\r\n   *     undefined if triggered programmatically.\r\n   * @sealed\r\n   * @internal\r\n   */\r\n  showEditor(e?: Event) {\r\n    if (this.isClickable()) {\r\n      this.showEditor_(e);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * A developer hook to create an editor for the field. This is no-op by\r\n   * default, and must be overriden to create an editor.\r\n   *\r\n   * @param _e Optional mouse event that triggered the field to open, or\r\n   *     undefined if triggered programmatically.\r\n   */\r\n  protected showEditor_(_e?: Event): void {}\r\n  // NOP\r\n\r\n  /**\r\n   * A developer hook to reposition the WidgetDiv during a window resize. You\r\n   * need to define this hook if your field has a WidgetDiv that needs to\r\n   * reposition itself when the window is resized. For example, text input\r\n   * fields define this hook so that the input WidgetDiv can reposition itself\r\n   * on a window resize event. This is especially important when modal inputs\r\n   * have been disabled, as Android devices will fire a window resize event when\r\n   * the soft keyboard opens.\r\n   *\r\n   * If you want the WidgetDiv to hide itself instead of repositioning, return\r\n   * false. This is the default behavior.\r\n   *\r\n   * DropdownDivs already handle their own positioning logic, so you do not need\r\n   * to override this function if your field only has a DropdownDiv.\r\n   *\r\n   * @returns True if the field should be repositioned,\r\n   *    false if the WidgetDiv should hide itself instead.\r\n   */\r\n  repositionForWindowResize(): boolean {\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Updates the size of the field based on the text.\r\n   *\r\n   * @param margin margin to use when positioning the text element.\r\n   */\r\n  protected updateSize_(margin?: number) {\r\n    const constants = this.getConstants();\r\n    const xOffset =\r\n      margin !== undefined\r\n        ? margin\r\n        : !this.isFullBlockField()\r\n          ? this.getConstants()!.FIELD_BORDER_RECT_X_PADDING\r\n          : 0;\r\n    let totalWidth = xOffset * 2;\r\n    let totalHeight = constants!.FIELD_TEXT_HEIGHT;\r\n\r\n    let contentWidth = 0;\r\n    if (this.textElement_) {\r\n      contentWidth = dom.getFastTextWidth(\r\n        this.textElement_,\r\n        constants!.FIELD_TEXT_FONTSIZE,\r\n        constants!.FIELD_TEXT_FONTWEIGHT,\r\n        constants!.FIELD_TEXT_FONTFAMILY,\r\n      );\r\n      totalWidth += contentWidth;\r\n    }\r\n    if (!this.isFullBlockField()) {\r\n      totalHeight = Math.max(totalHeight, constants!.FIELD_BORDER_RECT_HEIGHT);\r\n    }\r\n\r\n    this.size_.height = totalHeight;\r\n    this.size_.width = totalWidth;\r\n\r\n    this.positionTextElement_(xOffset, contentWidth);\r\n    this.positionBorderRect_();\r\n  }\r\n\r\n  /**\r\n   * Position a field's text element after a size change.  This handles both LTR\r\n   * and RTL positioning.\r\n   *\r\n   * @param xOffset x offset to use when positioning the text element.\r\n   * @param contentWidth The content width.\r\n   */\r\n  protected positionTextElement_(xOffset: number, contentWidth: number) {\r\n    if (!this.textElement_) {\r\n      return;\r\n    }\r\n    const constants = this.getConstants();\r\n    const halfHeight = this.size_.height / 2;\r\n\r\n    this.textElement_.setAttribute(\r\n      'x',\r\n      String(\r\n        this.getSourceBlock()?.RTL\r\n          ? this.size_.width - contentWidth - xOffset\r\n          : xOffset,\r\n      ),\r\n    );\r\n    this.textElement_.setAttribute(\r\n      'y',\r\n      String(\r\n        constants!.FIELD_TEXT_BASELINE_CENTER\r\n          ? halfHeight\r\n          : halfHeight -\r\n              constants!.FIELD_TEXT_HEIGHT / 2 +\r\n              constants!.FIELD_TEXT_BASELINE,\r\n      ),\r\n    );\r\n  }\r\n\r\n  /** Position a field's border rect after a size change. */\r\n  protected positionBorderRect_() {\r\n    if (!this.borderRect_) {\r\n      return;\r\n    }\r\n    this.borderRect_.setAttribute('width', String(this.size_.width));\r\n    this.borderRect_.setAttribute('height', String(this.size_.height));\r\n    this.borderRect_.setAttribute(\r\n      'rx',\r\n      String(this.getConstants()!.FIELD_BORDER_RECT_RADIUS),\r\n    );\r\n    this.borderRect_.setAttribute(\r\n      'ry',\r\n      String(this.getConstants()!.FIELD_BORDER_RECT_RADIUS),\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Returns the height and width of the field.\r\n   *\r\n   * This should *in general* be the only place render_ gets called from.\r\n   *\r\n   * @returns Height and width.\r\n   */\r\n  getSize(): Size {\r\n    if (!this.isVisible()) {\r\n      return new Size(0, 0);\r\n    }\r\n\r\n    if (this.isDirty_) {\r\n      this.render_();\r\n      this.isDirty_ = false;\r\n    } else if (this.visible_ && this.size_.width === 0) {\r\n      // If the field is not visible the width will be 0 as well, one of the\r\n      // problems with the old system.\r\n      this.render_();\r\n      // Don't issue a warning if the field is actually zero width.\r\n      if (this.size_.width !== 0) {\r\n        console.warn(\r\n          'Deprecated use of setting size_.width to 0 to rerender a' +\r\n            ' field. Set field.isDirty_ to true instead.',\r\n        );\r\n      }\r\n    }\r\n    return this.size_;\r\n  }\r\n\r\n  /**\r\n   * Returns the bounding box of the rendered field, accounting for workspace\r\n   * scaling.\r\n   *\r\n   * @returns An object with top, bottom, left, and right in pixels relative to\r\n   *     the top left corner of the page (window coordinates).\r\n   * @internal\r\n   */\r\n  getScaledBBox(): Rect {\r\n    let scaledWidth;\r\n    let scaledHeight;\r\n    let xy;\r\n    const block = this.getSourceBlock();\r\n    if (!block) {\r\n      throw new UnattachedFieldError();\r\n    }\r\n\r\n    if (this.isFullBlockField()) {\r\n      // Browsers are inconsistent in what they return for a bounding box.\r\n      // - Webkit / Blink: fill-box / object bounding box\r\n      // - Gecko: stroke-box\r\n      const bBox = (this.sourceBlock_ as BlockSvg).getHeightWidth();\r\n      const scale = (block.workspace as WorkspaceSvg).scale;\r\n      xy = this.getAbsoluteXY_();\r\n      scaledWidth = (bBox.width + 1) * scale;\r\n      scaledHeight = (bBox.height + 1) * scale;\r\n\r\n      if (userAgent.GECKO) {\r\n        xy.x += 1.5 * scale;\r\n        xy.y += 1.5 * scale;\r\n      } else {\r\n        xy.x -= 0.5 * scale;\r\n        xy.y -= 0.5 * scale;\r\n      }\r\n    } else {\r\n      const bBox = this.borderRect_!.getBoundingClientRect();\r\n      xy = style.getPageOffset(this.borderRect_!);\r\n      scaledWidth = bBox.width;\r\n      scaledHeight = bBox.height;\r\n    }\r\n    return new Rect(xy.y, xy.y + scaledHeight, xy.x, xy.x + scaledWidth);\r\n  }\r\n\r\n  /**\r\n   * Notifies the field that it has changed locations.\r\n   *\r\n   * @param _ The location of this field's block's top-start corner\r\n   *     in workspace coordinates.\r\n   */\r\n  onLocationChange(_: Coordinate) {}\r\n\r\n  /**\r\n   * Get the text from this field to display on the block. May differ from\r\n   * `getText` due to ellipsis, and other formatting.\r\n   *\r\n   * @returns Text to display.\r\n   */\r\n  protected getDisplayText_(): string {\r\n    let text = this.getText();\r\n    if (!text) {\r\n      // Prevent the field from disappearing if empty.\r\n      return Field.NBSP;\r\n    }\r\n    if (text.length > this.maxDisplayLength) {\r\n      // Truncate displayed string and add an ellipsis ('...').\r\n      text = text.substring(0, this.maxDisplayLength - 2) + '';\r\n    }\r\n    // Replace whitespace with non-breaking spaces so the text doesn't collapse.\r\n    text = text.replace(/\\s/g, Field.NBSP);\r\n    if (this.sourceBlock_ && this.sourceBlock_.RTL) {\r\n      // The SVG is LTR, force text to be RTL by adding an RLM.\r\n      text += '\\u200F';\r\n    }\r\n    return text;\r\n  }\r\n\r\n  /**\r\n   * Get the text from this field.\r\n   * Override getText_ to provide a different behavior than simply casting the\r\n   * value to a string.\r\n   *\r\n   * @returns Current text.\r\n   * @sealed\r\n   */\r\n  getText(): string {\r\n    // this.getText_ was intended so that devs don't have to remember to call\r\n    // super when overriding how the text of the field is generated. (#2910)\r\n    const text = this.getText_();\r\n    if (text !== null) {\r\n      return String(text);\r\n    }\r\n    return String(this.getValue());\r\n  }\r\n\r\n  /**\r\n   * A developer hook to override the returned text of this field.\r\n   * Override if the text representation of the value of this field\r\n   * is not just a string cast of its value.\r\n   * Return null to resort to a string cast.\r\n   *\r\n   * @returns Current text or null.\r\n   */\r\n  protected getText_(): string | null {\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Force a rerender of the block that this field is installed on, which will\r\n   * rerender this field and adjust for any sizing changes.\r\n   * Other fields on the same block will not rerender, because their sizes have\r\n   * already been recorded.\r\n   *\r\n   * @internal\r\n   */\r\n  markDirty() {\r\n    this.isDirty_ = true;\r\n    this.constants_ = null;\r\n  }\r\n\r\n  /**\r\n   * Force a rerender of the block that this field is installed on, which will\r\n   * rerender this field and adjust for any sizing changes.\r\n   * Other fields on the same block will not rerender, because their sizes have\r\n   * already been recorded.\r\n   *\r\n   * @internal\r\n   */\r\n  forceRerender() {\r\n    this.isDirty_ = true;\r\n    if (this.sourceBlock_ && this.sourceBlock_.rendered) {\r\n      (this.sourceBlock_ as BlockSvg).queueRender();\r\n      (this.sourceBlock_ as BlockSvg).bumpNeighbours();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Used to change the value of the field. Handles validation and events.\r\n   * Subclasses should override doClassValidation_ and doValueUpdate_ rather\r\n   * than this method.\r\n   *\r\n   * @param newValue New value.\r\n   * @param fireChangeEvent Whether to fire a change event. Defaults to true.\r\n   *     Should usually be true unless the change will be reported some other\r\n   *     way, e.g. an intermediate field change event.\r\n   * @sealed\r\n   */\r\n  setValue(newValue: AnyDuringMigration, fireChangeEvent = true) {\r\n    const doLogging = false;\r\n    if (newValue === null) {\r\n      doLogging && console.log('null, return');\r\n      // Not a valid value to check.\r\n      return;\r\n    }\r\n\r\n    const classValidation = this.doClassValidation_(newValue);\r\n    const classValue = this.processValidation_(newValue, classValidation);\r\n    if (classValue instanceof Error) {\r\n      doLogging && console.log('invalid class validation, return');\r\n      return;\r\n    }\r\n\r\n    const localValidation = this.getValidator()?.call(this, classValue);\r\n    const localValue = this.processValidation_(classValue, localValidation);\r\n    if (localValue instanceof Error) {\r\n      doLogging && console.log('invalid local validation, return');\r\n      return;\r\n    }\r\n\r\n    const source = this.sourceBlock_;\r\n    if (source && source.disposed) {\r\n      doLogging && console.log('source disposed, return');\r\n      return;\r\n    }\r\n\r\n    const oldValue = this.getValue();\r\n    if (oldValue === localValue) {\r\n      doLogging && console.log('same, doValueUpdate_, return');\r\n      this.doValueUpdate_(localValue);\r\n      return;\r\n    }\r\n\r\n    this.doValueUpdate_(localValue);\r\n    if (fireChangeEvent && source && eventUtils.isEnabled()) {\r\n      eventUtils.fire(\r\n        new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\r\n          source,\r\n          'field',\r\n          this.name || null,\r\n          oldValue,\r\n          localValue,\r\n        ),\r\n      );\r\n    }\r\n    if (this.isDirty_) {\r\n      this.forceRerender();\r\n    }\r\n    doLogging && console.log(this.value_);\r\n  }\r\n\r\n  /**\r\n   * Process the result of validation.\r\n   *\r\n   * @param newValue New value.\r\n   * @param validatedValue Validated value.\r\n   * @returns New value, or an Error object.\r\n   */\r\n  private processValidation_(\r\n    newValue: AnyDuringMigration,\r\n    validatedValue: T | null | undefined,\r\n  ): T | Error {\r\n    if (validatedValue === null) {\r\n      this.doValueInvalid_(newValue);\r\n      if (this.isDirty_) {\r\n        this.forceRerender();\r\n      }\r\n      return Error();\r\n    }\r\n    return validatedValue === undefined ? (newValue as T) : validatedValue;\r\n  }\r\n\r\n  /**\r\n   * Get the current value of the field.\r\n   *\r\n   * @returns Current value.\r\n   */\r\n  getValue(): T | null {\r\n    return this.value_;\r\n  }\r\n\r\n  /**\r\n   * Validate the changes to a field's value before they are set. See\r\n   * **FieldDropdown** for an example of subclass implementation.\r\n   *\r\n   * **NOTE:** Validation returns one option between `T`, `null`, and\r\n   * `undefined`. **Field**'s implementation will never return `undefined`, but\r\n   * it is valid for a subclass to return `undefined` if the new value is\r\n   * compatible with `T`.\r\n   *\r\n   * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/fields/validators#return_values}\r\n   * @param newValue - The value to be validated.\r\n   * @returns One of three instructions for setting the new value: `T`, `null`,\r\n   * or `undefined`.\r\n   *\r\n   * - `T` to set this function's returned value instead of `newValue`.\r\n   *\r\n   * - `null` to invoke `doValueInvalid_` and not set a value.\r\n   *\r\n   * - `undefined` to set `newValue` as is.\r\n   */\r\n  protected doClassValidation_(newValue: T): T | null | undefined;\r\n  protected doClassValidation_(newValue?: AnyDuringMigration): T | null;\r\n  protected doClassValidation_(\r\n    newValue?: T | AnyDuringMigration,\r\n  ): T | null | undefined {\r\n    if (newValue === null || newValue === undefined) {\r\n      return null;\r\n    }\r\n\r\n    return newValue as T;\r\n  }\r\n\r\n  /**\r\n   * Used to update the value of a field. Can be overridden by subclasses to do\r\n   * custom storage of values/updating of external things.\r\n   *\r\n   * @param newValue The value to be saved.\r\n   */\r\n  protected doValueUpdate_(newValue: T) {\r\n    this.value_ = newValue;\r\n    this.isDirty_ = true;\r\n  }\r\n\r\n  /**\r\n   * Used to notify the field an invalid value was input. Can be overridden by\r\n   * subclasses, see FieldTextInput.\r\n   * No-op by default.\r\n   *\r\n   * @param _invalidValue The input value that was determined to be invalid.\r\n   */\r\n  protected doValueInvalid_(_invalidValue: AnyDuringMigration) {}\r\n  // NOP\r\n\r\n  /**\r\n   * Handle a pointerdown event on a field.\r\n   *\r\n   * @param e Pointer down event.\r\n   */\r\n  protected onMouseDown_(e: PointerEvent) {\r\n    if (!this.sourceBlock_ || this.sourceBlock_.isDeadOrDying()) {\r\n      return;\r\n    }\r\n    const gesture = (this.sourceBlock_.workspace as WorkspaceSvg).getGesture(e);\r\n    if (gesture) {\r\n      gesture.setStartField(this);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Sets the tooltip for this field.\r\n   *\r\n   * @param newTip The text for the tooltip, a function that returns the text\r\n   *     for the tooltip, a parent object whose tooltip will be used, or null to\r\n   *     display the tooltip of the parent block. To not display a tooltip pass\r\n   *     the empty string.\r\n   */\r\n  setTooltip(newTip: Tooltip.TipInfo | null) {\r\n    if (!newTip && newTip !== '') {\r\n      // If null or undefined.\r\n      newTip = this.sourceBlock_;\r\n    }\r\n    const clickTarget = this.getClickTarget_();\r\n    if (clickTarget) {\r\n      (clickTarget as AnyDuringMigration).tooltip = newTip;\r\n    } else {\r\n      // Field has not been initialized yet.\r\n      this.tooltip_ = newTip;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns the tooltip text for this field.\r\n   *\r\n   * @returns The tooltip text for this field.\r\n   */\r\n  getTooltip(): string {\r\n    const clickTarget = this.getClickTarget_();\r\n    if (clickTarget) {\r\n      return Tooltip.getTooltipOfObject(clickTarget);\r\n    }\r\n    // Field has not been initialized yet. Return stashed this.tooltip_ value.\r\n    return Tooltip.getTooltipOfObject({tooltip: this.tooltip_});\r\n  }\r\n\r\n  /**\r\n   * The element to bind the click handler to. If not set explicitly, defaults\r\n   * to the SVG root of the field. When this element is\r\n   * clicked on an editable field, the editor will open.\r\n   *\r\n   * @returns Element to bind click handler to.\r\n   */\r\n  protected getClickTarget_(): Element | null {\r\n    return this.clickTarget_ || this.getSvgRoot();\r\n  }\r\n\r\n  /**\r\n   * Return the absolute coordinates of the top-left corner of this field.\r\n   * The origin (0,0) is the top-left corner of the page body.\r\n   *\r\n   * @returns Object with .x and .y properties.\r\n   */\r\n  protected getAbsoluteXY_(): Coordinate {\r\n    return style.getPageOffset(this.getClickTarget_() as SVGRectElement);\r\n  }\r\n\r\n  /**\r\n   * Whether this field references any Blockly variables.  If true it may need\r\n   * to be handled differently during serialization and deserialization.\r\n   * Subclasses may override this.\r\n   *\r\n   * @returns True if this field has any variable references.\r\n   * @internal\r\n   */\r\n  referencesVariables(): boolean {\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Refresh the variable name referenced by this field if this field references\r\n   * variables.\r\n   *\r\n   * @internal\r\n   */\r\n  refreshVariableName() {}\r\n  // NOP\r\n\r\n  /**\r\n   * Search through the list of inputs and their fields in order to find the\r\n   * parent input of a field.\r\n   *\r\n   * @returns The input that the field belongs to.\r\n   * @internal\r\n   */\r\n  getParentInput(): Input {\r\n    let parentInput = null;\r\n    const block = this.getSourceBlock();\r\n    if (!block) {\r\n      throw new UnattachedFieldError();\r\n    }\r\n    const inputs = block.inputList;\r\n\r\n    for (let idx = 0; idx < block.inputList.length; idx++) {\r\n      const input = inputs[idx];\r\n      const fieldRows = input.fieldRow;\r\n      for (let j = 0; j < fieldRows.length; j++) {\r\n        if (fieldRows[j] === this) {\r\n          parentInput = input;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    return parentInput!;\r\n  }\r\n\r\n  /**\r\n   * Returns whether or not we should flip the field in RTL.\r\n   *\r\n   * @returns True if we should flip in RTL.\r\n   */\r\n  getFlipRtl(): boolean {\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Returns whether or not the field is tab navigable.\r\n   *\r\n   * @returns True if the field is tab navigable.\r\n   */\r\n  isTabNavigable(): boolean {\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Handles the given keyboard shortcut.\r\n   *\r\n   * @param _shortcut The shortcut to be handled.\r\n   * @returns True if the shortcut has been handled, false otherwise.\r\n   */\r\n  onShortcut(_shortcut: KeyboardShortcut): boolean {\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Add the cursor SVG to this fields SVG group.\r\n   *\r\n   * @param cursorSvg The SVG root of the cursor to be added to the field group.\r\n   * @internal\r\n   */\r\n  setCursorSvg(cursorSvg: SVGElement) {\r\n    if (!cursorSvg) {\r\n      this.cursorSvg_ = null;\r\n      return;\r\n    }\r\n\r\n    if (!this.fieldGroup_) {\r\n      throw new Error(`The field group is ${this.fieldGroup_}.`);\r\n    }\r\n    this.fieldGroup_.appendChild(cursorSvg);\r\n    this.cursorSvg_ = cursorSvg;\r\n  }\r\n\r\n  /**\r\n   * Add the marker SVG to this fields SVG group.\r\n   *\r\n   * @param markerSvg The SVG root of the marker to be added to the field group.\r\n   * @internal\r\n   */\r\n  setMarkerSvg(markerSvg: SVGElement) {\r\n    if (!markerSvg) {\r\n      this.markerSvg_ = null;\r\n      return;\r\n    }\r\n\r\n    if (!this.fieldGroup_) {\r\n      throw new Error(`The field group is ${this.fieldGroup_}.`);\r\n    }\r\n    this.fieldGroup_.appendChild(markerSvg);\r\n    this.markerSvg_ = markerSvg;\r\n  }\r\n\r\n  /**\r\n   * Redraw any attached marker or cursor svgs if needed.\r\n   *\r\n   * @internal\r\n   */\r\n  updateMarkers_() {\r\n    const block = this.getSourceBlock();\r\n    if (!block) {\r\n      throw new UnattachedFieldError();\r\n    }\r\n    const workspace = block.workspace as WorkspaceSvg;\r\n    if (workspace.keyboardAccessibilityMode && this.cursorSvg_) {\r\n      workspace.getCursor()!.draw();\r\n    }\r\n    if (workspace.keyboardAccessibilityMode && this.markerSvg_) {\r\n      // TODO(#4592): Update all markers on the field.\r\n      workspace.getMarker(MarkerManager.LOCAL_MARKER)!.draw();\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Extra configuration options for the base field.\r\n */\r\nexport interface FieldConfig {\r\n  tooltip?: string;\r\n}\r\n\r\n/**\r\n * For use by Field and descendants of Field. Constructors can change\r\n * in descendants, though they should contain all of Field's prototype methods.\r\n *\r\n * @internal\r\n */\r\nexport type FieldProto = Pick<typeof Field, 'prototype'>;\r\n\r\n/**\r\n * Represents an error where the field is trying to access its block or\r\n * information about its block before it has actually been attached to said\r\n * block.\r\n */\r\nexport class UnattachedFieldError extends Error {\r\n  /** @internal */\r\n  constructor() {\r\n    super(\r\n      'The field has not yet been attached to its input. ' +\r\n        'Call appendField to attach it.',\r\n    );\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2012 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Utility functions for handling variable and procedure names.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.Names\r\n\r\nimport {Msg} from './msg.js';\r\n// import * as Procedures from './procedures.js';\r\nimport type {VariableMap} from './variable_map.js';\r\nimport * as Variables from './variables.js';\r\nimport type {Workspace} from './workspace.js';\r\n\r\n/**\r\n * Class for a database of entity names (variables, procedures, etc).\r\n */\r\nexport class Names {\r\n  static DEVELOPER_VARIABLE_TYPE: NameType;\r\n  private readonly variablePrefix: string;\r\n\r\n  /** A set of reserved words. */\r\n  private readonly reservedWords: Set<string>;\r\n\r\n  /**\r\n   * A map from type (e.g. name, procedure) to maps from names to generated\r\n   * names.\r\n   */\r\n  private readonly db = new Map<string, Map<string, string>>();\r\n\r\n  /** A set of used names to avoid collisions. */\r\n  private readonly dbReverse = new Set<string>();\r\n\r\n  /**\r\n   * The variable map from the workspace, containing Blockly variable models.\r\n   */\r\n  private variableMap: VariableMap | null = null;\r\n\r\n  /**\r\n   * @param reservedWordsList A comma-separated string of words that are illegal\r\n   *     for use as names in a language (e.g. 'new,if,this,...').\r\n   * @param opt_variablePrefix Some languages need a '$' or a namespace before\r\n   *     all variable names (but not procedure names).\r\n   */\r\n  constructor(reservedWordsList: string, opt_variablePrefix?: string) {\r\n    /** The prefix to attach to variable names in generated code. */\r\n    this.variablePrefix = opt_variablePrefix || '';\r\n\r\n    this.reservedWords = new Set<string>(\r\n      reservedWordsList ? reservedWordsList.split(',') : [],\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Empty the database and start from scratch.  The reserved words are kept.\r\n   */\r\n  reset() {\r\n    this.db.clear();\r\n    this.dbReverse.clear();\r\n    this.variableMap = null;\r\n  }\r\n\r\n  /**\r\n   * Set the variable map that maps from variable name to variable object.\r\n   *\r\n   * @param map The map to track.\r\n   */\r\n  setVariableMap(map: VariableMap) {\r\n    this.variableMap = map;\r\n  }\r\n\r\n  /**\r\n   * Get the name for a user-defined variable, based on its ID.\r\n   * This should only be used for variables of NameType VARIABLE.\r\n   *\r\n   * @param id The ID to look up in the variable map.\r\n   * @returns The name of the referenced variable, or null if there was no\r\n   *     variable map or the variable was not found in the map.\r\n   */\r\n  private getNameForUserVariable(id: string): string | null {\r\n    if (!this.variableMap) {\r\n      console.warn(\r\n        'Deprecated call to Names.prototype.getName without ' +\r\n          'defining a variable map. To fix, add the following code in your ' +\r\n          \"generator's init() function:\\n\" +\r\n          'Blockly.YourGeneratorName.nameDB_.setVariableMap(' +\r\n          'workspace.getVariableMap());',\r\n      );\r\n      return null;\r\n    }\r\n    const variable = this.variableMap.getVariableById(id);\r\n    if (variable) {\r\n      return variable.name;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Generate names for user variables, but only ones that are being used.\r\n   *\r\n   * @param workspace Workspace to generate variables from.\r\n   */\r\n  populateVariables(workspace: Workspace) {\r\n    const variables = Variables.allUsedVarModels(workspace);\r\n    for (let i = 0; i < variables.length; i++) {\r\n      this.getName(variables[i].getId(), NameType.VARIABLE);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Generate names for procedures.\r\n   *\r\n   * @param workspace Workspace to generate procedures from.\r\n   */\r\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n  populateProcedures(workspace: Workspace) {\r\n    throw new Error(\r\n      'The implementation of populateProcedures should be ' +\r\n        'monkey-patched in by blockly.ts',\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Convert a Blockly entity name to a legal exportable entity name.\r\n   *\r\n   * @param nameOrId The Blockly entity name (no constraints) or variable ID.\r\n   * @param type The type of the name in Blockly ('VARIABLE', 'PROCEDURE',\r\n   *     'DEVELOPER_VARIABLE', etc...).\r\n   * @returns An entity name that is legal in the exported language.\r\n   */\r\n  getName(nameOrId: string, type: NameType | string): string {\r\n    let name = nameOrId;\r\n    if (type === NameType.VARIABLE) {\r\n      const varName = this.getNameForUserVariable(nameOrId);\r\n      if (varName) {\r\n        // Successful ID lookup.\r\n        name = varName;\r\n      }\r\n    }\r\n    const normalizedName = name.toLowerCase();\r\n\r\n    const isVar =\r\n      type === NameType.VARIABLE || type === NameType.DEVELOPER_VARIABLE;\r\n\r\n    const prefix = isVar ? this.variablePrefix : '';\r\n    if (!this.db.has(type)) {\r\n      this.db.set(type, new Map<string, string>());\r\n    }\r\n    const typeDb = this.db.get(type);\r\n    if (typeDb!.has(normalizedName)) {\r\n      return prefix + typeDb!.get(normalizedName);\r\n    }\r\n    const safeName = this.getDistinctName(name, type);\r\n    typeDb!.set(normalizedName, safeName.substr(prefix.length));\r\n    return safeName;\r\n  }\r\n\r\n  /**\r\n   * Return a list of all known user-created names of a specified name type.\r\n   *\r\n   * @param type The type of entity in Blockly ('VARIABLE', 'PROCEDURE',\r\n   *     'DEVELOPER_VARIABLE', etc...).\r\n   * @returns A list of Blockly entity names (no constraints).\r\n   */\r\n  getUserNames(type: NameType | string): string[] {\r\n    const userNames = this.db.get(type)?.keys();\r\n    return userNames ? Array.from(userNames) : [];\r\n  }\r\n\r\n  /**\r\n   * Convert a Blockly entity name to a legal exportable entity name.\r\n   * Ensure that this is a new name not overlapping any previously defined name.\r\n   * Also check against list of reserved words for the current language and\r\n   * ensure name doesn't collide.\r\n   *\r\n   * @param name The Blockly entity name (no constraints).\r\n   * @param type The type of entity in Blockly ('VARIABLE', 'PROCEDURE',\r\n   *     'DEVELOPER_VARIABLE', etc...).\r\n   * @returns An entity name that is legal in the exported language.\r\n   */\r\n  getDistinctName(name: string, type: NameType | string): string {\r\n    let safeName = this.safeName(name);\r\n    let i: number | null = null;\r\n    while (\r\n      this.dbReverse.has(safeName + (i ?? '')) ||\r\n      this.reservedWords.has(safeName + (i ?? ''))\r\n    ) {\r\n      // Collision with existing name.  Create a unique name.\r\n      i = i ? i + 1 : 2;\r\n    }\r\n    safeName += i ?? '';\r\n    this.dbReverse.add(safeName);\r\n    const isVar =\r\n      type === NameType.VARIABLE || type === NameType.DEVELOPER_VARIABLE;\r\n    const prefix = isVar ? this.variablePrefix : '';\r\n    return prefix + safeName;\r\n  }\r\n\r\n  /**\r\n   * Given a proposed entity name, generate a name that conforms to the\r\n   * [_A-Za-z][_A-Za-z0-9]* format that most languages consider legal for\r\n   * variable and function names.\r\n   *\r\n   * @param name Potentially illegal entity name.\r\n   * @returns Safe entity name.\r\n   */\r\n  private safeName(name: string): string {\r\n    if (!name) {\r\n      name = Msg['UNNAMED_KEY'] || 'unnamed';\r\n    } else {\r\n      // Unfortunately names in non-latin characters will look like\r\n      // _E9_9F_B3_E4_B9_90 which is pretty meaningless.\r\n      // https://github.com/google/blockly/issues/1654\r\n      name = encodeURI(name.replace(/ /g, '_')).replace(/[^\\w]/g, '_');\r\n      // Most languages don't allow names with leading numbers.\r\n      if ('0123456789'.indexOf(name[0]) !== -1) {\r\n        name = 'my_' + name;\r\n      }\r\n    }\r\n    return name;\r\n  }\r\n\r\n  /**\r\n   * Do the given two entity names refer to the same entity?\r\n   * Blockly names are case-insensitive.\r\n   *\r\n   * @param name1 First name.\r\n   * @param name2 Second name.\r\n   * @returns True if names are the same.\r\n   */\r\n  static equals(name1: string, name2: string): boolean {\r\n    // name1.localeCompare(name2) is slower.\r\n    return name1.toLowerCase() === name2.toLowerCase();\r\n  }\r\n}\r\n\r\nexport namespace Names {\r\n  /**\r\n   * Enum for the type of a name. Different name types may have different rules\r\n   * about collisions.\r\n   * When JavaScript (or most other languages) is generated, variable 'foo' and\r\n   * procedure 'foo' would collide.  However, Blockly has no such problems since\r\n   * variable get 'foo' and procedure call 'foo' are unambiguous.\r\n   * Therefore, Blockly keeps a separate name type to disambiguate.\r\n   * getName('foo', 'VARIABLE') = 'foo'\r\n   * getName('foo', 'PROCEDURE') = 'foo2'\r\n   *\r\n   */\r\n  export enum NameType {\r\n    DEVELOPER_VARIABLE = 'DEVELOPER_VARIABLE',\r\n    VARIABLE = 'VARIABLE',\r\n    PROCEDURE = 'PROCEDURE',\r\n  }\r\n}\r\n\r\nexport type NameType = Names.NameType;\r\nexport const NameType = Names.NameType;\r\n\r\n/**\r\n * Constant to separate developer variable names from user-defined variable\r\n * names when running generators.\r\n * A developer variable will be declared as a global in the generated code, but\r\n * will never be shown to the user in the workspace or stored in the variable\r\n * map.\r\n */\r\nNames.DEVELOPER_VARIABLE_TYPE = NameType.DEVELOPER_VARIABLE;\r\n","/**\r\n * @license\r\n * Copyright 2022 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport {IProcedureMap} from './interfaces/i_procedure_map.js';\r\nimport type {IProcedureModel} from './interfaces/i_procedure_model.js';\r\nimport {isObservable} from './interfaces/i_observable.js';\r\n\r\nexport class ObservableProcedureMap\r\n  extends Map<string, IProcedureModel>\r\n  implements IProcedureMap\r\n{\r\n  /** @internal */\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  /**\r\n   * Adds the given procedure model to the procedure map.\r\n   */\r\n  override set(id: string, proc: IProcedureModel): this {\r\n    if (this.get(id) === proc) return this;\r\n    super.set(id, proc);\r\n    if (isObservable(proc)) proc.startPublishing();\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Deletes the ProcedureModel with the given ID from the procedure map (if it\r\n   * exists).\r\n   */\r\n  override delete(id: string): boolean {\r\n    const proc = this.get(id);\r\n    const existed = super.delete(id);\r\n    if (!existed) return existed;\r\n    if (isObservable(proc)) proc.stopPublishing();\r\n    return existed;\r\n  }\r\n\r\n  /**\r\n   * Removes all ProcedureModels from the procedure map.\r\n   */\r\n  override clear() {\r\n    if (!this.size) return;\r\n    for (const id of this.keys()) {\r\n      this.delete(id);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds the given ProcedureModel to the map of procedure models, so that\r\n   * blocks can find it.\r\n   */\r\n  add(proc: IProcedureModel): this {\r\n    return this.set(proc.getId(), proc);\r\n  }\r\n\r\n  /**\r\n   * Returns all of the procedures stored in this map.\r\n   */\r\n  getProcedures(): IProcedureModel[] {\r\n    return [...this.values()];\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2023 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport type {Block} from '../block.js';\r\nimport type {BlockSvg} from '../block_svg.js';\r\nimport * as browserEvents from '../browser_events.js';\r\nimport {hasBubble} from '../interfaces/i_has_bubble.js';\r\nimport type {IIcon} from '../interfaces/i_icon.js';\r\nimport {Coordinate} from '../utils/coordinate.js';\r\nimport * as dom from '../utils/dom.js';\r\nimport {Size} from '../utils/size.js';\r\nimport {Svg} from '../utils/svg.js';\r\nimport type {IconType} from './icon_types.js';\r\nimport * as deprecation from '../utils/deprecation.js';\r\nimport * as tooltip from '../tooltip.js';\r\n\r\n/**\r\n * The abstract icon class. Icons are visual elements that live in the top-start\r\n * corner of the block. Usually they provide more \"meta\" information about a\r\n * block (such as warnings or comments) as opposed to fields, which provide\r\n * \"actual\" information, related to how a block functions.\r\n */\r\nexport abstract class Icon implements IIcon {\r\n  /**\r\n   * The position of this icon relative to its blocks top-start,\r\n   * in workspace units.\r\n   */\r\n  protected offsetInBlock: Coordinate = new Coordinate(0, 0);\r\n\r\n  /** The position of this icon in workspace coordinates. */\r\n  protected workspaceLocation: Coordinate = new Coordinate(0, 0);\r\n\r\n  /** The root svg element visually representing this icon. */\r\n  protected svgRoot: SVGGElement | null = null;\r\n\r\n  /** The tooltip for this icon. */\r\n  protected tooltip: tooltip.TipInfo;\r\n\r\n  constructor(protected sourceBlock: Block) {\r\n    this.tooltip = sourceBlock;\r\n  }\r\n\r\n  getType(): IconType<IIcon> {\r\n    throw new Error('Icons must implement getType');\r\n  }\r\n\r\n  initView(pointerdownListener: (e: PointerEvent) => void): void {\r\n    if (this.svgRoot) return; // The icon has already been initialized.\r\n\r\n    const svgBlock = this.sourceBlock as BlockSvg;\r\n    this.svgRoot = dom.createSvgElement(Svg.G, {'class': 'blocklyIconGroup'});\r\n    svgBlock.getSvgRoot().appendChild(this.svgRoot);\r\n    this.updateSvgRootOffset();\r\n    browserEvents.conditionalBind(\r\n      this.svgRoot,\r\n      'pointerdown',\r\n      this,\r\n      pointerdownListener,\r\n    );\r\n    (this.svgRoot as any).tooltip = this;\r\n    tooltip.bindMouseEvents(this.svgRoot);\r\n  }\r\n\r\n  dispose(): void {\r\n    tooltip.unbindMouseEvents(this.svgRoot);\r\n    dom.removeNode(this.svgRoot);\r\n  }\r\n\r\n  getWeight(): number {\r\n    return -1;\r\n  }\r\n\r\n  getSize(): Size {\r\n    return new Size(0, 0);\r\n  }\r\n\r\n  /**\r\n   * Sets the tooltip for this icon to the given value. Null to show the\r\n   * tooltip of the block.\r\n   */\r\n  setTooltip(tip: tooltip.TipInfo | null) {\r\n    this.tooltip = tip ?? this.sourceBlock;\r\n  }\r\n\r\n  /** Returns the tooltip for this icon. */\r\n  getTooltip(): tooltip.TipInfo {\r\n    return this.tooltip;\r\n  }\r\n\r\n  applyColour(): void {}\r\n\r\n  updateEditable(): void {}\r\n\r\n  updateCollapsed(): void {\r\n    if (!this.svgRoot) return;\r\n    if (this.sourceBlock.isCollapsed()) {\r\n      this.svgRoot.style.display = 'none';\r\n    } else {\r\n      this.svgRoot.style.display = 'block';\r\n    }\r\n    if (hasBubble(this)) {\r\n      this.setBubbleVisible(false);\r\n    }\r\n  }\r\n\r\n  hideForInsertionMarker(): void {\r\n    if (!this.svgRoot) return;\r\n    this.svgRoot.style.display = 'none';\r\n  }\r\n\r\n  isShownWhenCollapsed(): boolean {\r\n    return false;\r\n  }\r\n\r\n  setOffsetInBlock(offset: Coordinate): void {\r\n    this.offsetInBlock = offset;\r\n    this.updateSvgRootOffset();\r\n  }\r\n\r\n  private updateSvgRootOffset(): void {\r\n    this.svgRoot?.setAttribute(\r\n      'transform',\r\n      `translate(${this.offsetInBlock.x}, ${this.offsetInBlock.y})`,\r\n    );\r\n  }\r\n\r\n  onLocationChange(blockOrigin: Coordinate): void {\r\n    this.workspaceLocation = Coordinate.sum(blockOrigin, this.offsetInBlock);\r\n  }\r\n\r\n  onClick(): void {}\r\n\r\n  /**\r\n   * Check whether the icon should be clickable while the block is in a flyout.\r\n   * The default is that icons are clickable in all flyouts (auto-closing or not).\r\n   * Subclasses may override this function to change this behavior.\r\n   *\r\n   * @param autoClosingFlyout true if the containing flyout is an auto-closing one.\r\n   * @returns Whether the icon should be clickable while the block is in a flyout.\r\n   */\r\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n  isClickableInFlyout(autoClosingFlyout: boolean): boolean {\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Sets the visibility of the icon's bubble if one exists.\r\n   *\r\n   * @deprecated Use `setBubbleVisible` instead. To be removed in v11.\r\n   */\r\n  setVisible(visibility: boolean): void {\r\n    deprecation.warn('setVisible', 'v10', 'v11', 'setBubbleVisible');\r\n    if (hasBubble(this)) this.setBubbleVisible(visibility);\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2023 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport * as browserEvents from '../browser_events.js';\r\nimport {IBubble} from '../interfaces/i_bubble.js';\r\nimport {ContainerRegion} from '../metrics_manager.js';\r\nimport {Scrollbar} from '../scrollbar.js';\r\nimport {Coordinate} from '../utils/coordinate.js';\r\nimport * as dom from '../utils/dom.js';\r\nimport * as math from '../utils/math.js';\r\nimport {Rect} from '../utils/rect.js';\r\nimport {Size} from '../utils/size.js';\r\nimport {Svg} from '../utils/svg.js';\r\nimport {WorkspaceSvg} from '../workspace_svg.js';\r\n\r\n/**\r\n * The abstract pop-up bubble class. This creates a UI that looks like a speech\r\n * bubble, where it has a \"tail\" that points to the block, and a \"head\" that\r\n * displays arbitrary svg elements.\r\n */\r\nexport abstract class Bubble implements IBubble {\r\n  /** The width of the border around the bubble. */\r\n  static readonly BORDER_WIDTH = 6; // ORG\r\n\r\n  /** Double the width of the border around the bubble. */\r\n  static readonly DOUBLE_BORDER = this.BORDER_WIDTH * 2;\r\n\r\n  /** The minimum size the bubble can have. */\r\n  static readonly MIN_SIZE = this.DOUBLE_BORDER;\r\n\r\n  /**\r\n   * The thickness of the base of the tail in relation to the size of the\r\n   * bubble. Higher numbers result in thinner tails.\r\n   */\r\n  //static readonly TAIL_THICKNESS = 1; // ORG\r\n  static readonly TAIL_THICKNESS = 90; // CASS\r\n\r\n  /** The number of degrees that the tail bends counter-clockwise. */\r\n  static readonly TAIL_ANGLE = 20;\r\n\r\n  /**\r\n   * The sharpness of the tail's bend. Higher numbers result in smoother\r\n   * tails.\r\n   */\r\n  //static readonly TAIL_BEND = 4; // ORG\r\n  static readonly TAIL_BEND = 100; // CASS\r\n\r\n  /** Distance between arrow point and anchor point. */\r\n  static readonly ANCHOR_RADIUS = 8;\r\n\r\n  /** The SVG group containing all parts of the bubble. */\r\n  protected svgRoot: SVGGElement;\r\n\r\n  /** The SVG path for the arrow from the anchor to the bubble. */\r\n  private tail: SVGPathElement;\r\n\r\n  /** The SVG background rect for the main body of the bubble. */\r\n  private background: SVGRectElement;\r\n\r\n  /** The SVG group containing the contents of the bubble. */\r\n  protected contentContainer: SVGGElement;\r\n\r\n  /**\r\n   * The size of the bubble (including background and contents but not tail).\r\n   */\r\n  private size = new Size(0, 0);\r\n\r\n  /** The colour of the background of the bubble. */\r\n  private colour = '#ffffff';\r\n\r\n  /** True if the bubble has been disposed, false otherwise. */\r\n  public disposed = false;\r\n\r\n  /** The position of the top of the bubble relative to its anchor. */\r\n  private relativeTop = 0;\r\n\r\n  /** The position of the left of the bubble realtive to its anchor. */\r\n  private relativeLeft = 0;\r\n\r\n  /**\r\n   * @param workspace The workspace this bubble belongs to.\r\n   * @param anchor The anchor location of the thing this bubble is attached to.\r\n   *     The tail of the bubble will point to this location.\r\n   * @param ownerRect An optional rect we don't want the bubble to overlap with\r\n   *     when automatically positioning.\r\n   */\r\n  constructor(\r\n    protected readonly workspace: WorkspaceSvg,\r\n    protected anchor: Coordinate,\r\n    protected ownerRect?: Rect,\r\n  ) {\r\n    this.svgRoot = dom.createSvgElement(Svg.G, {}, workspace.getBubbleCanvas());\r\n    const embossGroup = dom.createSvgElement(\r\n      Svg.G,\r\n      {\r\n        'filter': `url(#${\r\n          this.workspace.getRenderer().getConstants().embossFilterId\r\n        })`,\r\n      },\r\n      this.svgRoot,\r\n    );\r\n    this.tail = dom.createSvgElement(Svg.PATH, {}, embossGroup);\r\n    this.background = dom.createSvgElement(\r\n      Svg.RECT,\r\n      {\r\n        'class': 'blocklyDraggable',\r\n        'x': 0,\r\n        'y': 0,\r\n        'rx': Bubble.BORDER_WIDTH,\r\n        'ry': Bubble.BORDER_WIDTH,\r\n      },\r\n      embossGroup,\r\n    );\r\n    this.contentContainer = dom.createSvgElement(Svg.G, {}, this.svgRoot);\r\n\r\n    browserEvents.conditionalBind(\r\n      this.background,\r\n      'pointerdown',\r\n      this,\r\n      this.onMouseDown,\r\n    );\r\n  }\r\n\r\n  /** Dispose of this bubble. */\r\n  dispose() {\r\n    dom.removeNode(this.svgRoot);\r\n    this.disposed = true;\r\n  }\r\n\r\n  /**\r\n   * Set the location the tail of this bubble points to.\r\n   *\r\n   * @param anchor The location the tail of this bubble points to.\r\n   * @param relayout If true, reposition the bubble from scratch so that it is\r\n   *     optimally visible. If false, reposition it so it maintains the same\r\n   *     position relative to the anchor.\r\n   */\r\n  setAnchorLocation(anchor: Coordinate, relayout = false) {\r\n    this.anchor = anchor;\r\n    if (relayout) {\r\n      this.positionByRect(this.ownerRect);\r\n    } else {\r\n      this.positionRelativeToAnchor();\r\n    }\r\n    this.renderTail();\r\n  }\r\n\r\n  /** Sets the position of this bubble relative to its anchor. */\r\n  setPositionRelativeToAnchor(left: number, top: number) {\r\n    this.relativeLeft = left;\r\n    this.relativeTop = top;\r\n    this.positionRelativeToAnchor();\r\n    this.renderTail();\r\n  }\r\n\r\n  /** @returns the size of this bubble. */\r\n  protected getSize() {\r\n    return this.size;\r\n  }\r\n\r\n  /**\r\n   * Sets the size of this bubble, including the border.\r\n   *\r\n   * @param size Sets the size of this bubble, including the border.\r\n   * @param relayout If true, reposition the bubble from scratch so that it is\r\n   *     optimally visible. If false, reposition it so it maintains the same\r\n   *     position relative to the anchor.\r\n   */\r\n  protected setSize(size: Size, relayout = false) {\r\n    size.width = Math.max(size.width, Bubble.MIN_SIZE);\r\n    size.height = Math.max(size.height, Bubble.MIN_SIZE);\r\n    this.size = size;\r\n\r\n    this.background.setAttribute('width', `${size.width}`);\r\n    this.background.setAttribute('height', `${size.height}`);\r\n\r\n    if (relayout) {\r\n      this.positionByRect(this.ownerRect);\r\n    } else {\r\n      this.positionRelativeToAnchor();\r\n    }\r\n    this.renderTail();\r\n  }\r\n\r\n  /** Returns the colour of the background and tail of this bubble. */\r\n  protected getColour(): string {\r\n    return this.colour;\r\n  }\r\n\r\n  /** Sets the colour of the background and tail of this bubble. */\r\n  public setColour(colour: string) {\r\n    this.colour = colour;\r\n    this.tail.setAttribute('fill', colour);\r\n    this.background.setAttribute('fill', colour);\r\n  }\r\n\r\n  /** Passes the pointer event off to the gesture system. */\r\n  private onMouseDown(e: PointerEvent) {\r\n    this.workspace.getGesture(e)?.handleBubbleStart(e, this);\r\n  }\r\n\r\n  /** Positions the bubble relative to its anchor. Does not render its tail. */\r\n  protected positionRelativeToAnchor() {\r\n    let left = this.anchor.x;\r\n    if (this.workspace.RTL) {\r\n      left -= this.relativeLeft + this.size.width;\r\n    } else {\r\n      left += this.relativeLeft;\r\n    }\r\n    const top = this.relativeTop + this.anchor.y;\r\n    this.moveTo(left, top);\r\n  }\r\n\r\n  /**\r\n   * Moves the bubble to the given coordinates.\r\n   *\r\n   * @internal\r\n   */\r\n  moveTo(x: number, y: number) {\r\n    this.svgRoot.setAttribute('transform', `translate(${x}, ${y})`);\r\n  }\r\n\r\n  /**\r\n   * Positions the bubble \"optimally\" so that the most of it is visible and\r\n   * it does not overlap the rect (if provided).\r\n   */\r\n  protected positionByRect(rect = new Rect(0, 0, 0, 0)) {\r\n    const viewMetrics = this.workspace.getMetricsManager().getViewMetrics(true);\r\n\r\n    const optimalLeft = this.getOptimalRelativeLeft(viewMetrics);\r\n    const optimalTop = this.getOptimalRelativeTop(viewMetrics);\r\n\r\n    const topPosition = {\r\n      x: optimalLeft,\r\n      y: (-this.size.height -\r\n        this.workspace.getRenderer().getConstants().MIN_BLOCK_HEIGHT) as number,\r\n    };\r\n    const startPosition = {x: -this.size.width - 30, y: optimalTop};\r\n    const endPosition = {x: rect.getWidth(), y: optimalTop};\r\n    const bottomPosition = {x: optimalLeft, y: rect.getHeight()};\r\n\r\n    const closerPosition =\r\n      rect.getWidth() < rect.getHeight() ? endPosition : bottomPosition;\r\n    const fartherPosition =\r\n      rect.getWidth() < rect.getHeight() ? bottomPosition : endPosition;\r\n\r\n    const topPositionOverlap = this.getOverlap(topPosition, viewMetrics);\r\n    const startPositionOverlap = this.getOverlap(startPosition, viewMetrics);\r\n    const closerPositionOverlap = this.getOverlap(closerPosition, viewMetrics);\r\n    const fartherPositionOverlap = this.getOverlap(\r\n      fartherPosition,\r\n      viewMetrics,\r\n    );\r\n\r\n    // Set the position to whichever position shows the most of the bubble,\r\n    // with tiebreaks going in the order: top > start > close > far.\r\n    const mostOverlap = Math.max(\r\n      topPositionOverlap,\r\n      startPositionOverlap,\r\n      closerPositionOverlap,\r\n      fartherPositionOverlap,\r\n    );\r\n    if (topPositionOverlap === mostOverlap) {\r\n      this.relativeLeft = topPosition.x;\r\n      this.relativeTop = topPosition.y;\r\n      this.positionRelativeToAnchor();\r\n      return;\r\n    }\r\n    if (startPositionOverlap === mostOverlap) {\r\n      this.relativeLeft = startPosition.x;\r\n      this.relativeTop = startPosition.y;\r\n      this.positionRelativeToAnchor();\r\n      return;\r\n    }\r\n    if (closerPositionOverlap === mostOverlap) {\r\n      this.relativeLeft = closerPosition.x;\r\n      this.relativeTop = closerPosition.y;\r\n      this.positionRelativeToAnchor();\r\n      return;\r\n    }\r\n    // TODO: I believe relativeLeft_ should actually be called relativeStart_\r\n    //  and then the math should be fixed to reflect this. (hopefully it'll\r\n    //  make it look simpler)\r\n    this.relativeLeft = fartherPosition.x;\r\n    this.relativeTop = fartherPosition.y;\r\n    this.positionRelativeToAnchor();\r\n  }\r\n\r\n  /**\r\n   * Calculate the what percentage of the bubble overlaps with the visible\r\n   * workspace (what percentage of the bubble is visible).\r\n   *\r\n   * @param relativeMin The position of the top-left corner of the bubble\r\n   *     relative to the anchor point.\r\n   * @param viewMetrics The view metrics of the workspace the bubble will appear\r\n   *     in.\r\n   * @returns The percentage of the bubble that is visible.\r\n   */\r\n  private getOverlap(\r\n    relativeMin: {x: number; y: number},\r\n    viewMetrics: ContainerRegion,\r\n  ): number {\r\n    // The position of the top-left corner of the bubble in workspace units.\r\n    const bubbleMin = {\r\n      x: this.workspace.RTL\r\n        ? this.anchor.x - relativeMin.x - this.size.width\r\n        : relativeMin.x + this.anchor.x,\r\n      y: relativeMin.y + this.anchor.y,\r\n    };\r\n    // The position of the bottom-right corner of the bubble in workspace units.\r\n    const bubbleMax = {\r\n      x: bubbleMin.x + this.size.width,\r\n      y: bubbleMin.y + this.size.height,\r\n    };\r\n\r\n    // We could adjust these values to account for the scrollbars, but the\r\n    // bubbles should have been adjusted to not collide with them anyway, so\r\n    // giving the workspace a slightly larger \"bounding box\" shouldn't affect\r\n    // the calculation.\r\n\r\n    // The position of the top-left corner of the workspace.\r\n    const workspaceMin = {x: viewMetrics.left, y: viewMetrics.top};\r\n    // The position of the bottom-right corner of the workspace.\r\n    const workspaceMax = {\r\n      x: viewMetrics.left + viewMetrics.width,\r\n      y: viewMetrics.top + viewMetrics.height,\r\n    };\r\n\r\n    const overlapWidth =\r\n      Math.min(bubbleMax.x, workspaceMax.x) -\r\n      Math.max(bubbleMin.x, workspaceMin.x);\r\n    const overlapHeight =\r\n      Math.min(bubbleMax.y, workspaceMax.y) -\r\n      Math.max(bubbleMin.y, workspaceMin.y);\r\n    return Math.max(\r\n      0,\r\n      Math.min(\r\n        1,\r\n        (overlapWidth * overlapHeight) / (this.size.width * this.size.height),\r\n      ),\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Calculate what the optimal horizontal position of the top-left corner of\r\n   * the bubble is (relative to the anchor point) so that the most area of the\r\n   * bubble is shown.\r\n   *\r\n   * @param viewMetrics The view metrics of the workspace the bubble will appear\r\n   *     in.\r\n   * @returns The optimal horizontal position of the top-left corner of the\r\n   *     bubble.\r\n   */\r\n  private getOptimalRelativeLeft(viewMetrics: ContainerRegion): number {\r\n    // By default, show the bubble just a bit to the left of the anchor.\r\n    let relativeLeft = -this.size.width / 4;\r\n\r\n    // No amount of sliding left or right will give us better overlap.\r\n    if (this.size.width > viewMetrics.width) return relativeLeft;\r\n\r\n    const workspaceRect = this.getWorkspaceViewRect(viewMetrics);\r\n\r\n    if (this.workspace.RTL) {\r\n      // Bubble coordinates are flipped in RTL.\r\n      const bubbleRight = this.anchor.x - relativeLeft;\r\n      const bubbleLeft = bubbleRight - this.size.width;\r\n\r\n      if (bubbleLeft < workspaceRect.left) {\r\n        // Slide the bubble right until it is onscreen.\r\n        relativeLeft = -(workspaceRect.left - this.anchor.x + this.size.width);\r\n      } else if (bubbleRight > workspaceRect.right) {\r\n        // Slide the bubble left until it is onscreen.\r\n        relativeLeft = -(workspaceRect.right - this.anchor.x);\r\n      }\r\n    } else {\r\n      const bubbleLeft = relativeLeft + this.anchor.x;\r\n      const bubbleRight = bubbleLeft + this.size.width;\r\n\r\n      if (bubbleLeft < workspaceRect.left) {\r\n        // Slide the bubble right until it is onscreen.\r\n        relativeLeft = workspaceRect.left - this.anchor.x;\r\n      } else if (bubbleRight > workspaceRect.right) {\r\n        // Slide the bubble left until it is onscreen.\r\n        relativeLeft = workspaceRect.right - this.anchor.x - this.size.width;\r\n      }\r\n    }\r\n\r\n    return relativeLeft;\r\n  }\r\n\r\n  /**\r\n   * Calculate what the optimal vertical position of the top-left corner of\r\n   * the bubble is (relative to the anchor point) so that the most area of the\r\n   * bubble is shown.\r\n   *\r\n   * @param viewMetrics The view metrics of the workspace the bubble will appear\r\n   *     in.\r\n   * @returns The optimal vertical position of the top-left corner of the\r\n   *     bubble.\r\n   */\r\n  private getOptimalRelativeTop(viewMetrics: ContainerRegion): number {\r\n    // By default, show the bubble just a bit higher than the anchor.\r\n    let relativeTop = -this.size.height / 4;\r\n\r\n    // No amount of sliding up or down will give us better overlap.\r\n    if (this.size.height > viewMetrics.height) return relativeTop;\r\n\r\n    const top = this.anchor.y + relativeTop;\r\n    const bottom = top + this.size.height;\r\n    const workspaceRect = this.getWorkspaceViewRect(viewMetrics);\r\n\r\n    if (top < workspaceRect.top) {\r\n      // Slide the bubble down until it is onscreen.\r\n      relativeTop = workspaceRect.top - this.anchor.y;\r\n    } else if (bottom > workspaceRect.bottom) {\r\n      // Slide the bubble up until it is onscreen.\r\n      relativeTop = workspaceRect.bottom - this.anchor.y - this.size.height;\r\n    }\r\n\r\n    return relativeTop;\r\n  }\r\n\r\n  /**\r\n   * @returns a rect defining the bounds of the workspace's view in workspace\r\n   * coordinates.\r\n   */\r\n  private getWorkspaceViewRect(viewMetrics: ContainerRegion): Rect {\r\n    const top = viewMetrics.top;\r\n    let bottom = viewMetrics.top + viewMetrics.height;\r\n    let left = viewMetrics.left;\r\n    let right = viewMetrics.left + viewMetrics.width;\r\n\r\n    bottom -= this.getScrollbarThickness();\r\n    if (this.workspace.RTL) {\r\n      left -= this.getScrollbarThickness();\r\n    } else {\r\n      right -= this.getScrollbarThickness();\r\n    }\r\n\r\n    return new Rect(top, bottom, left, right);\r\n  }\r\n\r\n  /** @returns the scrollbar thickness in workspace units. */\r\n  private getScrollbarThickness() {\r\n    return Scrollbar.scrollbarThickness / this.workspace.scale;\r\n  }\r\n\r\n  /** Draws the tail of the bubble. */\r\n  private renderTail() {\r\n    const steps = [];\r\n    // Find the relative coordinates of the center of the bubble.\r\n    const relBubbleX = this.size.width / 2;\r\n    const relBubbleY = this.size.height / 2;\r\n    // Find the relative coordinates of the center of the anchor.\r\n    let relAnchorX = -this.relativeLeft;\r\n    let relAnchorY = -this.relativeTop;\r\n    if (relBubbleX === relAnchorX && relBubbleY === relAnchorY) {\r\n      // Null case.  Bubble is directly on top of the anchor.\r\n      // Short circuit this rather than wade through divide by zeros.\r\n      steps.push('M ' + relBubbleX + ',' + relBubbleY);\r\n    } else {\r\n      // Compute the angle of the tail's line.\r\n      const rise = relAnchorY - relBubbleY;\r\n      let run = relAnchorX - relBubbleX;\r\n      if (this.workspace.RTL) {\r\n        run *= -1;\r\n      }\r\n      const hypotenuse = Math.sqrt(rise * rise + run * run);\r\n      let angle = Math.acos(run / hypotenuse);\r\n      if (rise < 0) {\r\n        angle = 2 * Math.PI - angle;\r\n      }\r\n      // Compute a line perpendicular to the tail.\r\n      let rightAngle = angle + Math.PI / 2;\r\n      if (rightAngle > Math.PI * 2) {\r\n        rightAngle -= Math.PI * 2;\r\n      }\r\n      const rightRise = Math.sin(rightAngle);\r\n      const rightRun = Math.cos(rightAngle);\r\n\r\n      // Calculate the thickness of the base of the tail.\r\n      let thickness =\r\n        (this.size.width + this.size.height) / Bubble.TAIL_THICKNESS;\r\n      thickness = Math.min(thickness, this.size.width, this.size.height) / 4;\r\n\r\n      // Back the tip of the tail off of the anchor.\r\n      const backoffRatio = 1 - Bubble.ANCHOR_RADIUS / hypotenuse;\r\n      relAnchorX = relBubbleX + backoffRatio * run;\r\n      relAnchorY = relBubbleY + backoffRatio * rise;\r\n\r\n      // Coordinates for the base of the tail.\r\n      const baseX1 = relBubbleX + thickness * rightRun;\r\n      const baseY1 = relBubbleY + thickness * rightRise;\r\n      const baseX2 = relBubbleX - thickness * rightRun;\r\n      const baseY2 = relBubbleY - thickness * rightRise;\r\n\r\n      // Distortion to curve the tail.\r\n      const radians = math.toRadians(\r\n        this.workspace.RTL ? -Bubble.TAIL_ANGLE : Bubble.TAIL_ANGLE,\r\n      );\r\n      let swirlAngle = angle + radians;\r\n      if (swirlAngle > Math.PI * 2) {\r\n        swirlAngle -= Math.PI * 2;\r\n      }\r\n      const swirlRise = (Math.sin(swirlAngle) * hypotenuse) / Bubble.TAIL_BEND;\r\n      const swirlRun = (Math.cos(swirlAngle) * hypotenuse) / Bubble.TAIL_BEND;\r\n\r\n      steps.push('M' + baseX1 + ',' + baseY1);\r\n      steps.push(\r\n        'C' +\r\n          (baseX1 + swirlRun) +\r\n          ',' +\r\n          (baseY1 + swirlRise) +\r\n          ' ' +\r\n          relAnchorX +\r\n          ',' +\r\n          relAnchorY +\r\n          ' ' +\r\n          relAnchorX +\r\n          ',' +\r\n          relAnchorY,\r\n      );\r\n      steps.push(\r\n        'C' +\r\n          relAnchorX +\r\n          ',' +\r\n          relAnchorY +\r\n          ' ' +\r\n          (baseX2 + swirlRun) +\r\n          ',' +\r\n          (baseY2 + swirlRise) +\r\n          ' ' +\r\n          baseX2 +\r\n          ',' +\r\n          baseY2,\r\n      );\r\n    }\r\n    steps.push('z');\r\n    this.tail?.setAttribute('d', steps.join(' '));\r\n  }\r\n  /**\r\n   * Move this bubble to the front of the visible workspace.\r\n   *\r\n   * @returns Whether or not the bubble has been moved.\r\n   * @internal\r\n   */\r\n  bringToFront(): boolean {\r\n    const svgGroup = this.svgRoot?.parentNode;\r\n    if (this.svgRoot && svgGroup?.lastChild !== this.svgRoot) {\r\n      svgGroup?.appendChild(this.svgRoot);\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /** @internal */\r\n  getRelativeToSurfaceXY(): Coordinate {\r\n    return new Coordinate(\r\n      this.workspace.RTL\r\n        ? -this.relativeLeft + this.anchor.x - this.size.width\r\n        : this.anchor.x + this.relativeLeft,\r\n      this.anchor.y + this.relativeTop,\r\n    );\r\n  }\r\n\r\n  /** @internal */\r\n  getSvgRoot(): SVGElement {\r\n    return this.svgRoot;\r\n  }\r\n\r\n  /**\r\n   * Move this bubble during a drag.\r\n   *\r\n   * @param newLoc The location to translate to, in workspace coordinates.\r\n   * @internal\r\n   */\r\n  moveDuringDrag(newLoc: Coordinate) {\r\n    this.moveTo(newLoc.x, newLoc.y);\r\n    if (this.workspace.RTL) {\r\n      this.relativeLeft = this.anchor.x - newLoc.x - this.size.width;\r\n    } else {\r\n      this.relativeLeft = newLoc.x - this.anchor.x;\r\n    }\r\n    this.relativeTop = newLoc.y - this.anchor.y;\r\n    this.renderTail();\r\n  }\r\n\r\n  setDragging(_start: boolean) {\r\n    // NOOP in base class.\r\n  }\r\n\r\n  /** @internal */\r\n  setDeleteStyle(_enable: boolean) {\r\n    // NOOP in base class.\r\n  }\r\n\r\n  /** @internal */\r\n  isDeletable(): boolean {\r\n    return false;\r\n  }\r\n\r\n  /** @internal */\r\n  showContextMenu(_e: Event) {\r\n    // NOOP in base class.\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2023 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport {Abstract as AbstractEvent} from '../events/events_abstract.js';\r\nimport type {BlocklyOptions} from '../blockly_options.js';\r\nimport {Bubble} from './bubble.js';\r\nimport {Coordinate} from '../utils/coordinate.js';\r\nimport * as dom from '../utils/dom.js';\r\nimport {Options} from '../options.js';\r\nimport {Svg} from '../utils/svg.js';\r\nimport type {Rect} from '../utils/rect.js';\r\nimport {Size} from '../utils/size.js';\r\nimport type {WorkspaceSvg} from '../workspace_svg.js';\r\n\r\n/**\r\n * A bubble that contains a mini-workspace which can hold arbitrary blocks.\r\n * Used by the mutator icon.\r\n */\r\nexport class MiniWorkspaceBubble extends Bubble {\r\n  /**\r\n   * The minimum amount of change to the mini workspace view to trigger\r\n   * resizing the bubble.\r\n   */\r\n  private static readonly MINIMUM_VIEW_CHANGE = 10;\r\n\r\n  /**\r\n   * An arbitrary margin of whitespace to put around the blocks in the\r\n   * workspace.\r\n   */\r\n  private static readonly MARGIN = Bubble.DOUBLE_BORDER * 3;\r\n\r\n  /** The root svg element containing the workspace. */\r\n  private svgDialog: SVGElement;\r\n\r\n  /** The workspace that gets shown within this bubble. */\r\n  private miniWorkspace: WorkspaceSvg;\r\n\r\n  /**\r\n   * Should this bubble automatically reposition itself when it resizes?\r\n   * Becomes false after this bubble is first dragged.\r\n   */\r\n  private autoLayout = true;\r\n\r\n  /** @internal */\r\n  constructor(\r\n    workspaceOptions: BlocklyOptions,\r\n    protected readonly workspace: WorkspaceSvg,\r\n    protected anchor: Coordinate,\r\n    protected ownerRect?: Rect,\r\n  ) {\r\n    super(workspace, anchor, ownerRect);\r\n    const options = new Options(workspaceOptions);\r\n    this.validateWorkspaceOptions(options);\r\n\r\n    this.svgDialog = dom.createSvgElement(\r\n      Svg.SVG,\r\n      {\r\n        'x': Bubble.BORDER_WIDTH,\r\n        'y': Bubble.BORDER_WIDTH,\r\n      },\r\n      this.contentContainer,\r\n    );\r\n    workspaceOptions.parentWorkspace = this.workspace;\r\n    this.miniWorkspace = this.newWorkspaceSvg(new Options(workspaceOptions));\r\n    // TODO (#7422): Change this to `internalIsMiniWorkspace` or something. Not\r\n    //   all mini workspaces are necessarily mutators.\r\n    this.miniWorkspace.internalIsMutator = true;\r\n    const background = this.miniWorkspace.createDom('blocklyMutatorBackground');\r\n    this.svgDialog.appendChild(background);\r\n    if (options.languageTree) {\r\n      background.insertBefore(\r\n        this.miniWorkspace.addFlyout(Svg.G),\r\n        this.miniWorkspace.getCanvas(),\r\n      );\r\n      const flyout = this.miniWorkspace.getFlyout();\r\n      flyout?.init(this.miniWorkspace);\r\n      flyout?.show(options.languageTree);\r\n    }\r\n\r\n    this.miniWorkspace.addChangeListener(this.onWorkspaceChange.bind(this));\r\n    this.miniWorkspace\r\n      .getFlyout()\r\n      ?.getWorkspace()\r\n      ?.addChangeListener(this.onWorkspaceChange.bind(this));\r\n    this.updateBubbleSize();\r\n  }\r\n\r\n  dispose() {\r\n    this.miniWorkspace.dispose();\r\n    super.dispose();\r\n  }\r\n\r\n  /** @internal */\r\n  getWorkspace(): WorkspaceSvg {\r\n    return this.miniWorkspace;\r\n  }\r\n\r\n  /** Adds a change listener to the mini workspace. */\r\n  addWorkspaceChangeListener(listener: (e: AbstractEvent) => void) {\r\n    this.miniWorkspace.addChangeListener(listener);\r\n  }\r\n\r\n  /**\r\n   * Validates the workspace options to make sure folks aren't trying to\r\n   * enable things the miniworkspace doesn't support.\r\n   */\r\n  private validateWorkspaceOptions(options: Options) {\r\n    if (options.hasCategories) {\r\n      throw new Error(\r\n        'The miniworkspace bubble does not support toolboxes with categories',\r\n      );\r\n    }\r\n    if (options.hasTrashcan) {\r\n      throw new Error('The miniworkspace bubble does not support trashcans');\r\n    }\r\n    if (\r\n      options.zoomOptions.controls ||\r\n      options.zoomOptions.wheel ||\r\n      options.zoomOptions.pinch\r\n    ) {\r\n      throw new Error('The miniworkspace bubble does not support zooming');\r\n    }\r\n    if (\r\n      options.moveOptions.scrollbars ||\r\n      options.moveOptions.wheel ||\r\n      options.moveOptions.drag\r\n    ) {\r\n      throw new Error(\r\n        'The miniworkspace bubble does not scrolling/moving the workspace',\r\n      );\r\n    }\r\n    if (options.horizontalLayout) {\r\n      throw new Error(\r\n        'The miniworkspace bubble does not support horizontal layouts',\r\n      );\r\n    }\r\n  }\r\n\r\n  private onWorkspaceChange() {\r\n    this.bumpBlocksIntoBounds();\r\n    this.updateBubbleSize();\r\n  }\r\n\r\n  /**\r\n   * Bumps blocks that are above the top or outside the start-side of the\r\n   * workspace back within the workspace.\r\n   *\r\n   * Blocks that are below the bottom or outside the end-side of the workspace\r\n   * are dealt with by resizing the workspace to show them.\r\n   */\r\n  private bumpBlocksIntoBounds() {\r\n    if (this.miniWorkspace.isDragging()) return;\r\n\r\n    const MARGIN = 20;\r\n\r\n    for (const block of this.miniWorkspace.getTopBlocks(false)) {\r\n      const blockXY = block.getRelativeToSurfaceXY();\r\n\r\n      // Bump any block that's above the top back inside.\r\n      if (blockXY.y < MARGIN) {\r\n        block.moveBy(0, MARGIN - blockXY.y);\r\n      }\r\n      // Bump any block overlapping the flyout back inside.\r\n      if (block.RTL) {\r\n        let right = -MARGIN;\r\n        const flyout = this.miniWorkspace.getFlyout();\r\n        if (flyout) {\r\n          right -= flyout.getWidth();\r\n        }\r\n        if (blockXY.x > right) {\r\n          block.moveBy(right - blockXY.x, 0);\r\n        }\r\n      } else if (blockXY.x < MARGIN) {\r\n        block.moveBy(MARGIN - blockXY.x, 0);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Updates the size of this bubble to account for the size of the\r\n   * mini workspace.\r\n   */\r\n  private updateBubbleSize() {\r\n    if (this.miniWorkspace.isDragging()) return;\r\n\r\n    const currSize = this.getSize();\r\n    const newSize = this.calculateWorkspaceSize();\r\n    if (\r\n      Math.abs(currSize.width - newSize.width) <\r\n        MiniWorkspaceBubble.MINIMUM_VIEW_CHANGE &&\r\n      Math.abs(currSize.height - newSize.height) <\r\n        MiniWorkspaceBubble.MINIMUM_VIEW_CHANGE\r\n    ) {\r\n      // Only resize if the size has noticeably changed.\r\n      return;\r\n    }\r\n    this.svgDialog.setAttribute('width', `${newSize.width}px`);\r\n    this.svgDialog.setAttribute('height', `${newSize.height}px`);\r\n    this.miniWorkspace.setCachedParentSvgSize(newSize.width, newSize.height);\r\n    if (this.miniWorkspace.RTL) {\r\n      // Scroll the workspace to always left-align.\r\n      this.miniWorkspace\r\n        .getCanvas()\r\n        .setAttribute('transform', `translate(${newSize.width}, 0)`);\r\n    }\r\n    this.setSize(\r\n      new Size(\r\n        newSize.width + Bubble.DOUBLE_BORDER,\r\n        newSize.height + Bubble.DOUBLE_BORDER,\r\n      ),\r\n      this.autoLayout,\r\n    );\r\n    this.miniWorkspace.resize();\r\n    this.miniWorkspace.recordDragTargets();\r\n  }\r\n\r\n  /**\r\n   * Calculates the size of the mini workspace for use in resizing the bubble.\r\n   */\r\n  private calculateWorkspaceSize(): Size {\r\n    const workspaceSize = this.miniWorkspace.getCanvas().getBBox();\r\n    let width = workspaceSize.width + MiniWorkspaceBubble.MARGIN;\r\n    let height = workspaceSize.height + MiniWorkspaceBubble.MARGIN;\r\n\r\n    const flyout = this.miniWorkspace.getFlyout();\r\n    if (flyout) {\r\n      const flyoutScrollMetrics = flyout\r\n        .getWorkspace()\r\n        .getMetricsManager()\r\n        .getScrollMetrics();\r\n      height = Math.max(height, flyoutScrollMetrics.height + 20);\r\n      width += flyout.getWidth();\r\n    }\r\n    return new Size(width, height);\r\n  }\r\n\r\n  /** Reapplies styles to all of the blocks in the mini workspace. */\r\n  updateBlockStyles() {\r\n    for (const block of this.miniWorkspace.getAllBlocks(false)) {\r\n      block.setStyle(block.getStyleName());\r\n    }\r\n\r\n    const flyoutWs = this.miniWorkspace.getFlyout()?.getWorkspace();\r\n    if (flyoutWs) {\r\n      for (const block of flyoutWs.getAllBlocks(false)) {\r\n        block.setStyle(block.getStyleName());\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Move this bubble during a drag.\r\n   *\r\n   * @param newLoc The location to translate to, in workspace coordinates.\r\n   * @internal\r\n   */\r\n  moveDuringDrag(newLoc: Coordinate): void {\r\n    super.moveDuringDrag(newLoc);\r\n    this.autoLayout = false;\r\n  }\r\n\r\n  /** @internal */\r\n  moveTo(x: number, y: number): void {\r\n    super.moveTo(x, y);\r\n    this.miniWorkspace.recordDragTargets();\r\n  }\r\n\r\n  /** @internal */\r\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n  newWorkspaceSvg(options: Options): WorkspaceSvg {\r\n    throw new Error(\r\n      'The implementation of newWorkspaceSvg should be ' +\r\n        'monkey-patched in by blockly.ts',\r\n    );\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2023 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.Mutator\r\n\r\nimport type {Abstract} from '../events/events_abstract.js';\r\nimport type {Block} from '../block.js';\r\nimport {BlockChange} from '../events/events_block_change.js';\r\nimport type {BlocklyOptions} from '../blockly_options.js';\r\nimport type {BlockSvg} from '../block_svg.js';\r\nimport type {Connection} from '../connection.js';\r\nimport {Coordinate} from '../utils/coordinate.js';\r\nimport * as dom from '../utils/dom.js';\r\nimport * as eventUtils from '../events/utils.js';\r\nimport type {IHasBubble} from '../interfaces/i_has_bubble.js';\r\nimport {Icon} from './icon.js';\r\nimport {MiniWorkspaceBubble} from '../bubbles/mini_workspace_bubble.js';\r\nimport {Rect} from '../utils/rect.js';\r\nimport {Size} from '../utils/size.js';\r\nimport {Svg} from '../utils/svg.js';\r\nimport type {WorkspaceSvg} from '../workspace_svg.js';\r\nimport * as deprecation from '../utils/deprecation.js';\r\nimport {IconType} from './icon_types.js';\r\n\r\n/** The size of the mutator icon in workspace-scale units. */\r\nconst SIZE = 17;\r\n\r\n/**\r\n * The distance between the root block in the mini workspace and that\r\n * workspace's edges.\r\n */\r\nconst WORKSPACE_MARGIN = 16;\r\n\r\n/**\r\n * An icon that allows the user to change the shape of the block.\r\n *\r\n * For example, it could be used to add additional fields or inputs to\r\n * the block.\r\n */\r\nexport class MutatorIcon extends Icon implements IHasBubble {\r\n  /** The type string used to identify this icon. */\r\n  static readonly TYPE = IconType.MUTATOR;\r\n\r\n  /**\r\n   * The weight this icon has relative to other icons. Icons with more positive\r\n   * weight values are rendered farther toward the end of the block.\r\n   */\r\n  static readonly WEIGHT = 1;\r\n\r\n  /** The bubble used to show the mini workspace to the user. */\r\n  private miniWorkspaceBubble: MiniWorkspaceBubble | null = null;\r\n\r\n  /** The root block in the mini workspace. */\r\n  private rootBlock: BlockSvg | null = null;\r\n\r\n  /** The PID tracking updating the workkspace in response to user events. */\r\n  private updateWorkspacePid: ReturnType<typeof setTimeout> | null = null;\r\n\r\n  /**\r\n   * The change listener in the main workspace that triggers the saveConnections\r\n   * method when anything in the main workspace changes.\r\n   *\r\n   * Only actually registered to listen for events while the mutator bubble is\r\n   * open.\r\n   */\r\n  private saveConnectionsListener: (() => void) | null = null;\r\n\r\n  constructor(\r\n    private readonly flyoutBlockTypes: string[],\r\n    protected readonly sourceBlock: BlockSvg,\r\n  ) {\r\n    super(sourceBlock);\r\n  }\r\n\r\n  override getType(): IconType<MutatorIcon> {\r\n    return MutatorIcon.TYPE;\r\n  }\r\n\r\n  override initView(pointerdownListener: (e: PointerEvent) => void): void {\r\n    if (this.svgRoot) return; // Already initialized.\r\n\r\n    super.initView(pointerdownListener);\r\n\r\n    // Square with rounded corners.\r\n    dom.createSvgElement(\r\n      Svg.RECT,\r\n      {\r\n        'class': 'blocklyIconShape',\r\n        'rx': '4',\r\n        'ry': '4',\r\n        'height': '16',\r\n        'width': '16',\r\n      },\r\n      this.svgRoot,\r\n    );\r\n    // Gear teeth.\r\n    dom.createSvgElement(\r\n      Svg.PATH,\r\n      {\r\n        'class': 'blocklyIconSymbol',\r\n        'd':\r\n          'm4.203,7.296 0,1.368 -0.92,0.677 -0.11,0.41 0.9,1.559 0.41,' +\r\n          '0.11 1.043,-0.457 1.187,0.683 0.127,1.134 0.3,0.3 1.8,0 0.3,' +\r\n          '-0.299 0.127,-1.138 1.185,-0.682 1.046,0.458 0.409,-0.11 0.9,' +\r\n          '-1.559 -0.11,-0.41 -0.92,-0.677 0,-1.366 0.92,-0.677 0.11,' +\r\n          '-0.41 -0.9,-1.559 -0.409,-0.109 -1.046,0.458 -1.185,-0.682 ' +\r\n          '-0.127,-1.138 -0.3,-0.299 -1.8,0 -0.3,0.3 -0.126,1.135 -1.187,' +\r\n          '0.682 -1.043,-0.457 -0.41,0.11 -0.899,1.559 0.108,0.409z',\r\n      },\r\n      this.svgRoot,\r\n    );\r\n    // Axle hole.\r\n    dom.createSvgElement(\r\n      Svg.CIRCLE,\r\n      {'class': 'blocklyIconShape', 'r': '2.7', 'cx': '8', 'cy': '8'},\r\n      this.svgRoot,\r\n    );\r\n    dom.addClass(this.svgRoot!, 'blockly-icon-mutator');\r\n  }\r\n\r\n  override dispose(): void {\r\n    super.dispose();\r\n    this.miniWorkspaceBubble?.dispose();\r\n  }\r\n\r\n  override getWeight(): number {\r\n    return MutatorIcon.WEIGHT;\r\n  }\r\n\r\n  override getSize(): Size {\r\n    return new Size(SIZE, SIZE);\r\n  }\r\n\r\n  override applyColour(): void {\r\n    super.applyColour();\r\n    this.miniWorkspaceBubble?.setColour(this.sourceBlock.style.colourPrimary);\r\n    this.miniWorkspaceBubble?.updateBlockStyles();\r\n  }\r\n\r\n  override updateCollapsed(): void {\r\n    super.updateCollapsed();\r\n    if (this.sourceBlock.isCollapsed()) this.setBubbleVisible(false);\r\n  }\r\n\r\n  override onLocationChange(blockOrigin: Coordinate): void {\r\n    super.onLocationChange(blockOrigin);\r\n    this.miniWorkspaceBubble?.setAnchorLocation(this.getAnchorLocation());\r\n  }\r\n\r\n  override onClick(): void {\r\n    super.onClick();\r\n    if (this.sourceBlock.isEditable()) {\r\n      this.setBubbleVisible(!this.bubbleIsVisible());\r\n    }\r\n  }\r\n\r\n  override isClickableInFlyout(): boolean {\r\n    return false;\r\n  }\r\n\r\n  bubbleIsVisible(): boolean {\r\n    return !!this.miniWorkspaceBubble;\r\n  }\r\n\r\n  setBubbleVisible(visible: boolean): void {\r\n    if (this.bubbleIsVisible() === visible) return;\r\n\r\n    if (visible) {\r\n      this.miniWorkspaceBubble = new MiniWorkspaceBubble(\r\n        this.getMiniWorkspaceConfig(),\r\n        this.sourceBlock.workspace,\r\n        this.getAnchorLocation(),\r\n        this.getBubbleOwnerRect(),\r\n      );\r\n      this.applyColour();\r\n      this.createRootBlock();\r\n      this.addSaveConnectionsListener();\r\n      this.miniWorkspaceBubble?.addWorkspaceChangeListener(\r\n        this.createMiniWorkspaceChangeListener(),\r\n      );\r\n    } else {\r\n      this.miniWorkspaceBubble?.dispose();\r\n      this.miniWorkspaceBubble = null;\r\n      if (this.saveConnectionsListener) {\r\n        this.sourceBlock.workspace.removeChangeListener(\r\n          this.saveConnectionsListener,\r\n        );\r\n      }\r\n      this.saveConnectionsListener = null;\r\n    }\r\n\r\n    eventUtils.fire(\r\n      new (eventUtils.get(eventUtils.BUBBLE_OPEN))(\r\n        this.sourceBlock,\r\n        visible,\r\n        'mutator',\r\n      ),\r\n    );\r\n  }\r\n\r\n  /** @returns the configuration the mini workspace should have. */\r\n  private getMiniWorkspaceConfig() {\r\n    const options: BlocklyOptions = {\r\n      'disable': false,\r\n      'media': this.sourceBlock.workspace.options.pathToMedia,\r\n      'rtl': this.sourceBlock.RTL,\r\n      'renderer': this.sourceBlock.workspace.options.renderer,\r\n      'rendererOverrides':\r\n        this.sourceBlock.workspace.options.rendererOverrides ?? undefined,\r\n    };\r\n\r\n    if (this.flyoutBlockTypes.length) {\r\n      options.toolbox = {\r\n        'kind': 'flyoutToolbox',\r\n        'contents': this.flyoutBlockTypes.map((type) => ({\r\n          'kind': 'block',\r\n          'type': type,\r\n        })),\r\n      };\r\n    }\r\n\r\n    return options;\r\n  }\r\n\r\n  /**\r\n   * @returns the location the bubble should be anchored to.\r\n   *     I.E. the middle of this icon.\r\n   */\r\n  private getAnchorLocation(): Coordinate {\r\n    const midIcon = SIZE / 2;\r\n    return Coordinate.sum(\r\n      this.workspaceLocation,\r\n      new Coordinate(midIcon, midIcon),\r\n    );\r\n  }\r\n\r\n  /**\r\n   * @returns the rect the bubble should avoid overlapping.\r\n   *     I.E. the block that owns this icon.\r\n   */\r\n  private getBubbleOwnerRect(): Rect {\r\n    const bbox = this.sourceBlock.getSvgRoot().getBBox();\r\n    return new Rect(bbox.y, bbox.y + bbox.height, bbox.x, bbox.x + bbox.width);\r\n  }\r\n\r\n  /** Decomposes the source block to create blocks in the mini workspace. */\r\n  private createRootBlock() {\r\n    if (!this.sourceBlock.decompose) {\r\n      throw new Error(\r\n        'Blocks with mutator icons must include a decompose method',\r\n      );\r\n    }\r\n    this.rootBlock = this.sourceBlock.decompose(\r\n      this.miniWorkspaceBubble!.getWorkspace(),\r\n    )!;\r\n\r\n    for (const child of this.rootBlock.getDescendants(false)) {\r\n      child.queueRender();\r\n    }\r\n\r\n    this.rootBlock.setMovable(false);\r\n    this.rootBlock.setDeletable(false);\r\n\r\n    const flyoutWidth =\r\n      this.miniWorkspaceBubble?.getWorkspace()?.getFlyout()?.getWidth() ?? 0;\r\n    this.rootBlock.moveBy(\r\n      this.rootBlock.RTL ? -(flyoutWidth + WORKSPACE_MARGIN) : WORKSPACE_MARGIN,\r\n      WORKSPACE_MARGIN,\r\n    );\r\n  }\r\n\r\n  /** Adds a listen to the source block that triggers saving connections. */\r\n  private addSaveConnectionsListener() {\r\n    if (!this.sourceBlock.saveConnections || !this.rootBlock) return;\r\n    this.saveConnectionsListener = () => {\r\n      if (!this.sourceBlock.saveConnections || !this.rootBlock) return;\r\n      this.sourceBlock.saveConnections(this.rootBlock);\r\n    };\r\n    this.saveConnectionsListener();\r\n    this.sourceBlock.workspace.addChangeListener(this.saveConnectionsListener);\r\n  }\r\n\r\n  /**\r\n   * Creates a change listener to add to the mini workspace which recomposes\r\n   * the block.\r\n   */\r\n  private createMiniWorkspaceChangeListener() {\r\n    return (e: Abstract) => {\r\n      if (!MutatorIcon.isIgnorableMutatorEvent(e) && !this.updateWorkspacePid) {\r\n        this.updateWorkspacePid = setTimeout(() => {\r\n          this.updateWorkspacePid = null;\r\n          this.recomposeSourceBlock();\r\n        }, 0);\r\n      }\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Returns true if the given event is not one the mutator needs to\r\n   * care about.\r\n   *\r\n   * @internal\r\n   */\r\n  static isIgnorableMutatorEvent(e: Abstract) {\r\n    return (\r\n      e.isUiEvent ||\r\n      e.type === eventUtils.CREATE ||\r\n      (e.type === eventUtils.CHANGE &&\r\n        (e as BlockChange).element === 'disabled')\r\n    );\r\n  }\r\n\r\n  /** Recomposes the source block based on changes to the mini workspace. */\r\n  private recomposeSourceBlock() {\r\n    if (!this.rootBlock) return;\r\n    if (!this.sourceBlock.compose) {\r\n      throw new Error(\r\n        'Blocks with mutator icons must include a compose method',\r\n      );\r\n    }\r\n\r\n    const existingGroup = eventUtils.getGroup();\r\n    if (!existingGroup) eventUtils.setGroup(true);\r\n\r\n    const oldExtraState = BlockChange.getExtraBlockState_(this.sourceBlock);\r\n    this.sourceBlock.compose(this.rootBlock);\r\n    const newExtraState = BlockChange.getExtraBlockState_(this.sourceBlock);\r\n\r\n    if (oldExtraState !== newExtraState) {\r\n      eventUtils.fire(\r\n        new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\r\n          this.sourceBlock,\r\n          'mutation',\r\n          null,\r\n          oldExtraState,\r\n          newExtraState,\r\n        ),\r\n      );\r\n    }\r\n\r\n    eventUtils.setGroup(existingGroup);\r\n  }\r\n\r\n  /**\r\n   * @returns The workspace of the mini workspace bubble, if the bubble is\r\n   *     currently open.\r\n   */\r\n  getWorkspace(): WorkspaceSvg | undefined {\r\n    return this.miniWorkspaceBubble?.getWorkspace();\r\n  }\r\n\r\n  /**\r\n   * Reconnects the given connection to the mutated input on the given block.\r\n   *\r\n   * @deprecated Use connection.reconnect instead. To be removed in v11.\r\n   */\r\n  static reconnect(\r\n    connectionChild: Connection | null,\r\n    block: Block,\r\n    inputName: string,\r\n  ): boolean {\r\n    deprecation.warn(\r\n      'MutatorIcon.reconnect',\r\n      'v10',\r\n      'v11',\r\n      'connection.reconnect',\r\n    );\r\n    if (!connectionChild) return false;\r\n    return connectionChild.reconnect(block, inputName);\r\n  }\r\n\r\n  /**\r\n   * Returns the parent workspace of a workspace that is inside a mini workspace\r\n   * bubble, taking into account whether the workspace is a flyout.\r\n   *\r\n   * @deprecated Use workspace.getRootWorkspace. To be removed in v11.\r\n   */\r\n  static findParentWs(workspace: WorkspaceSvg): WorkspaceSvg | null {\r\n    deprecation.warn(\r\n      'MutatorIcon.findParentWs',\r\n      'v10',\r\n      'v11',\r\n      'workspace.getRootWorkspace',\r\n    );\r\n    return workspace.getRootWorkspace();\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.utils.KeyCodes\r\n\r\n/* eslint-disable @typescript-eslint/no-duplicate-enum-values */\r\n\r\n/**\r\n * Key codes for common characters.\r\n *\r\n * Copied from Closure's goog.events.KeyCodes\r\n *\r\n * This list is not localized and therefore some of the key codes are not\r\n * correct for non US keyboard layouts. See comments below.\r\n */\r\nexport enum KeyCodes {\r\n  WIN_KEY_FF_LINUX = 0,\r\n  MAC_ENTER = 3,\r\n  BACKSPACE = 8,\r\n  TAB = 9,\r\n  NUM_CENTER = 12, // NUMLOCK on FF/Safari Mac\r\n  ENTER = 13,\r\n  SHIFT = 16,\r\n  CTRL = 17,\r\n  ALT = 18,\r\n  PAUSE = 19,\r\n  CAPS_LOCK = 20,\r\n  ESC = 27,\r\n  SPACE = 32,\r\n  PAGE_UP = 33, // also NUM_NORTH_EAST\r\n  PAGE_DOWN = 34, // also NUM_SOUTH_EAST\r\n  END = 35, // also NUM_SOUTH_WEST\r\n  HOME = 36, // also NUM_NORTH_WEST\r\n  LEFT = 37, // also NUM_WEST\r\n  UP = 38, // also NUM_NORTH\r\n  RIGHT = 39, // also NUM_EAST\r\n  DOWN = 40, // also NUM_SOUTH\r\n  PLUS_SIGN = 43, // NOT numpad plus\r\n  PRINT_SCREEN = 44,\r\n  INSERT = 45, // also NUM_INSERT\r\n  DELETE = 46, // also NUM_DELETE\r\n  ZERO = 48,\r\n  ONE = 49,\r\n  TWO = 50,\r\n  THREE = 51,\r\n  FOUR = 52,\r\n  FIVE = 53,\r\n  SIX = 54,\r\n  SEVEN = 55,\r\n  EIGHT = 56,\r\n  NINE = 57,\r\n  FF_SEMICOLON = 59, // Firefox (Gecko) fires this for semicolon instead of 186\r\n  FF_EQUALS = 61, // Firefox (Gecko) fires this for equals instead of 187\r\n  FF_DASH = 173, // Firefox (Gecko) fires this for dash instead of 189\r\n  // Firefox (Gecko) fires this for # on UK keyboards, rather than\r\n  // Shift+SINGLE_QUOTE.\r\n  FF_HASH = 163,\r\n  QUESTION_MARK = 63, // needs localization\r\n  AT_SIGN = 64,\r\n  A = 65,\r\n  B = 66,\r\n  C = 67,\r\n  D = 68,\r\n  E = 69,\r\n  F = 70,\r\n  G = 71,\r\n  H = 72,\r\n  I = 73,\r\n  J = 74,\r\n  K = 75,\r\n  L = 76,\r\n  M = 77,\r\n  N = 78,\r\n  O = 79,\r\n  P = 80,\r\n  Q = 81,\r\n  R = 82,\r\n  S = 83,\r\n  T = 84,\r\n  U = 85,\r\n  V = 86,\r\n  W = 87,\r\n  X = 88,\r\n  Y = 89,\r\n  Z = 90,\r\n  META = 91, // WIN_KEY_LEFT\r\n  WIN_KEY_RIGHT = 92,\r\n  CONTEXT_MENU = 93,\r\n  NUM_ZERO = 96,\r\n  NUM_ONE = 97,\r\n  NUM_TWO = 98,\r\n  NUM_THREE = 99,\r\n  NUM_FOUR = 100,\r\n  NUM_FIVE = 101,\r\n  NUM_SIX = 102,\r\n  NUM_SEVEN = 103,\r\n  NUM_EIGHT = 104,\r\n  NUM_NINE = 105,\r\n  NUM_MULTIPLY = 106,\r\n  NUM_PLUS = 107,\r\n  NUM_MINUS = 109,\r\n  NUM_PERIOD = 110,\r\n  NUM_DIVISION = 111,\r\n  F1 = 112,\r\n  F2 = 113,\r\n  F3 = 114,\r\n  F4 = 115,\r\n  F5 = 116,\r\n  F6 = 117,\r\n  F7 = 118,\r\n  F8 = 119,\r\n  F9 = 120,\r\n  F10 = 121,\r\n  F11 = 122,\r\n  F12 = 123,\r\n  NUMLOCK = 144,\r\n  SCROLL_LOCK = 145,\r\n\r\n  // OS-specific media keys like volume controls and browser controls.\r\n  FIRST_MEDIA_KEY = 166,\r\n  LAST_MEDIA_KEY = 183,\r\n\r\n  SEMICOLON = 186, // needs localization\r\n  DASH = 189, // needs localization\r\n  EQUALS = 187, // needs localization\r\n  COMMA = 188, // needs localization\r\n  PERIOD = 190, // needs localization\r\n  SLASH = 191, // needs localization\r\n  APOSTROPHE = 192, // needs localization\r\n  TILDE = 192, // needs localization\r\n  SINGLE_QUOTE = 222, // needs localization\r\n  OPEN_SQUARE_BRACKET = 219, // needs localization\r\n  BACKSLASH = 220, // needs localization\r\n  CLOSE_SQUARE_BRACKET = 221, // needs localization\r\n  WIN_KEY = 224,\r\n  MAC_FF_META = 224, // Firefox (Gecko) fires this for the meta key instead of 91\r\n  MAC_WK_CMD_LEFT = 91, // WebKit Left Command key fired, same as META\r\n  MAC_WK_CMD_RIGHT = 93, // WebKit Right Command key fired, different from META\r\n  WIN_IME = 229,\r\n\r\n  // \"Reserved for future use\". Some programs (e.g. the SlingPlayer 2.4 ActiveX\r\n  // control) fire this as a hacky way to disable screensavers.\r\n  VK_NONAME = 252,\r\n\r\n  // We've seen users whose machines fire this keycode at regular one\r\n  // second intervals. The common thread among these users is that\r\n  // they're all using Dell Inspiron laptops, so we suspect that this\r\n  // indicates a hardware/bios problem.\r\n  // http://en.community.dell.com/support-forums/laptop/f/3518/p/19285957/19523128.aspx\r\n  PHANTOM = 255,\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2012 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.utils\r\n\r\nimport * as browserEvents from './browser_events.js';\r\nimport * as extensions from './extensions.js';\r\nimport * as aria from './utils/aria.js';\r\nimport * as arrayUtils from './utils/array.js';\r\nimport * as colour from './utils/colour.js';\r\nimport {Coordinate} from './utils/coordinate.js';\r\nimport * as deprecation from './utils/deprecation.js';\r\nimport * as dom from './utils/dom.js';\r\nimport * as idGenerator from './utils/idgenerator.js';\r\nimport {KeyCodes} from './utils/keycodes.js';\r\nimport * as math from './utils/math.js';\r\nimport type {Metrics} from './utils/metrics.js';\r\nimport * as object from './utils/object.js';\r\nimport * as parsing from './utils/parsing.js';\r\nimport {Rect} from './utils/rect.js';\r\nimport {Size} from './utils/size.js';\r\nimport * as stringUtils from './utils/string.js';\r\nimport * as style from './utils/style.js';\r\nimport {Svg} from './utils/svg.js';\r\nimport * as svgMath from './utils/svg_math.js';\r\nimport * as svgPaths from './utils/svg_paths.js';\r\nimport * as toolbox from './utils/toolbox.js';\r\nimport * as userAgent from './utils/useragent.js';\r\nimport * as xml from './utils/xml.js';\r\n\r\nexport {\r\n  aria,\r\n  arrayUtils as array,\r\n  browserEvents,\r\n  colour,\r\n  Coordinate,\r\n  deprecation,\r\n  dom,\r\n  extensions,\r\n  idGenerator,\r\n  KeyCodes,\r\n  math,\r\n  Metrics,\r\n  object,\r\n  parsing,\r\n  Rect,\r\n  Size,\r\n  stringUtils as string,\r\n  style,\r\n  Svg,\r\n  svgMath,\r\n  svgPaths,\r\n  toolbox,\r\n  userAgent,\r\n  xml,\r\n};\r\n","/**\r\n * @license\r\n * Copyright 2023 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport {Bubble} from './bubble.js';\r\nimport {Coordinate} from '../utils/coordinate.js';\r\nimport * as dom from '../utils/dom.js';\r\nimport {Rect} from '../utils/rect.js';\r\nimport {Size} from '../utils/size.js';\r\nimport {Svg} from '../utils/svg.js';\r\nimport {WorkspaceSvg} from '../workspace_svg.js';\r\n\r\n/**\r\n * A bubble that displays non-editable text. Used by the warning icon.\r\n */\r\nexport class TextBubble extends Bubble {\r\n  private paragraph: SVGTextElement;\r\n\r\n  constructor(\r\n    private text: string,\r\n    protected readonly workspace: WorkspaceSvg,\r\n    protected anchor: Coordinate,\r\n    protected ownerRect?: Rect,\r\n  ) {\r\n    super(workspace, anchor, ownerRect);\r\n    this.paragraph = this.stringToSvg(text, this.contentContainer);\r\n    this.updateBubbleSize();\r\n  }\r\n\r\n  /** @returns the current text of this text bubble. */\r\n  getText(): string {\r\n    return this.text;\r\n  }\r\n\r\n  /** Sets the current text of this text bubble, and updates the display. */\r\n  setText(text: string) {\r\n    this.text = text;\r\n    dom.removeNode(this.paragraph);\r\n    this.paragraph = this.stringToSvg(text, this.contentContainer);\r\n    this.updateBubbleSize();\r\n  }\r\n\r\n  /**\r\n   * Converts the given string into an svg containing that string,\r\n   * broken up by newlines.\r\n   */\r\n  private stringToSvg(text: string, container: SVGGElement) {\r\n    const paragraph = this.createParagraph(container);\r\n    const spans = this.createSpans(paragraph, text);\r\n    if (this.workspace.RTL)\r\n      this.rightAlignSpans(paragraph.getBBox().width, spans);\r\n    return paragraph;\r\n  }\r\n\r\n  /** Creates the paragraph container for this bubble's view's spans. */\r\n  private createParagraph(container: SVGGElement): SVGTextElement {\r\n    return dom.createSvgElement(\r\n      Svg.TEXT,\r\n      {\r\n        'class': 'blocklyText blocklyBubbleText blocklyNoPointerEvents',\r\n        'y': Bubble.BORDER_WIDTH,\r\n      },\r\n      container,\r\n    );\r\n  }\r\n\r\n  /** Creates the spans visualizing the text of this bubble. */\r\n  private createSpans(parent: SVGTextElement, text: string): SVGTSpanElement[] {\r\n    return text.split('\\n').map((line) => {\r\n      const tspan = dom.createSvgElement(\r\n        Svg.TSPAN,\r\n        {'dy': '1em', 'x': Bubble.BORDER_WIDTH},\r\n        parent,\r\n      );\r\n      const textNode = document.createTextNode(line);\r\n      tspan.appendChild(textNode);\r\n      return tspan;\r\n    });\r\n  }\r\n\r\n  /** Right aligns the given spans. */\r\n  private rightAlignSpans(maxWidth: number, spans: SVGTSpanElement[]) {\r\n    for (const span of spans) {\r\n      span.setAttribute('text-anchor', 'end');\r\n      span.setAttribute('x', `${maxWidth + Bubble.BORDER_WIDTH}`);\r\n    }\r\n  }\r\n\r\n  /** Updates the size of this bubble to account for the size of the text. */\r\n  private updateBubbleSize() {\r\n    const bbox = this.paragraph.getBBox();\r\n    this.setSize(\r\n      new Size(\r\n        bbox.width + Bubble.BORDER_WIDTH * 2,\r\n        bbox.height + Bubble.BORDER_WIDTH * 2,\r\n      ),\r\n      true,\r\n    );\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2023 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport {Bubble} from './bubble.js';\r\nimport {Coordinate} from '../utils/coordinate.js';\r\nimport * as Css from '../css.js';\r\nimport * as dom from '../utils/dom.js';\r\nimport {Rect} from '../utils/rect.js';\r\nimport {Size} from '../utils/size.js';\r\nimport {Svg} from '../utils/svg.js';\r\nimport * as touch from '../touch.js';\r\nimport {WorkspaceSvg} from '../workspace_svg.js';\r\nimport {browserEvents} from '../utils.js';\r\n\r\n/**\r\n * A bubble that displays editable text. It can also be resized by the user.\r\n * Used by the comment icon.\r\n */\r\nexport class TextInputBubble extends Bubble {\r\n  /** The root of the elements specific to the text element. */\r\n  private inputRoot: SVGForeignObjectElement;\r\n\r\n  /** The text input area element. */\r\n  private textArea: HTMLTextAreaElement;\r\n\r\n  /** The group containing the lines indicating the bubble is resizable. */\r\n  private resizeGroup: SVGGElement;\r\n\r\n  /**\r\n   * Event data associated with the listener for pointer up events on the\r\n   * resize group.\r\n   */\r\n  private resizePointerUpListener: browserEvents.Data | null = null;\r\n\r\n  /**\r\n   * Event data associated with the listener for pointer move events on the\r\n   * resize group.\r\n   */\r\n  private resizePointerMoveListener: browserEvents.Data | null = null;\r\n\r\n  /** Functions listening for changes to the text of this bubble. */\r\n  private textChangeListeners: (() => void)[] = [];\r\n\r\n  /** Functions listening for changes to the size of this bubble. */\r\n  private sizeChangeListeners: (() => void)[] = [];\r\n\r\n  /** The text of this bubble. */\r\n  private text = '';\r\n\r\n  /** The default size of this bubble, including borders. */\r\n  private readonly DEFAULT_SIZE = new Size(\r\n    160 + Bubble.DOUBLE_BORDER,\r\n    80 + Bubble.DOUBLE_BORDER,\r\n  );\r\n\r\n  /** The minimum size of this bubble, including borders. */\r\n  private readonly MIN_SIZE = new Size(\r\n    45 + Bubble.DOUBLE_BORDER,\r\n    20 + Bubble.DOUBLE_BORDER,\r\n  );\r\n\r\n  /**\r\n   * @param workspace The workspace this bubble belongs to.\r\n   * @param anchor The anchor location of the thing this bubble is attached to.\r\n   *     The tail of the bubble will point to this location.\r\n   * @param ownerRect An optional rect we don't want the bubble to overlap with\r\n   *     when automatically positioning.\r\n   */\r\n  constructor(\r\n    protected readonly workspace: WorkspaceSvg,\r\n    protected anchor: Coordinate,\r\n    protected ownerRect?: Rect,\r\n  ) {\r\n    super(workspace, anchor, ownerRect);\r\n    ({inputRoot: this.inputRoot, textArea: this.textArea} = this.createEditor(\r\n      this.contentContainer,\r\n    ));\r\n    this.resizeGroup = this.createResizeHandle(this.svgRoot);\r\n    this.setSize(this.DEFAULT_SIZE, true);\r\n  }\r\n\r\n  /** @returns the text of this bubble. */\r\n  getText(): string {\r\n    return this.text;\r\n  }\r\n\r\n  /** Sets the text of this bubble. Calls change listeners. */\r\n  setText(text: string) {\r\n    this.text = text;\r\n    this.textArea.value = text;\r\n    this.onTextChange();\r\n  }\r\n\r\n  /** Adds a change listener to be notified when this bubble's text changes. */\r\n  addTextChangeListener(listener: () => void) {\r\n    this.textChangeListeners.push(listener);\r\n  }\r\n\r\n  /** Adds a change listener to be notified when this bubble's size changes. */\r\n  addSizeChangeListener(listener: () => void) {\r\n    this.sizeChangeListeners.push(listener);\r\n  }\r\n\r\n  /** Creates the editor UI for this bubble. */\r\n  private createEditor(container: SVGGElement): {\r\n    inputRoot: SVGForeignObjectElement;\r\n    textArea: HTMLTextAreaElement;\r\n  } {\r\n    const inputRoot = dom.createSvgElement(\r\n      Svg.FOREIGNOBJECT,\r\n      {\r\n        // ORG\r\n        //'x': Bubble.BORDER_WIDTH + 2,\r\n        //'y': Bubble.BORDER_WIDTH + 2,\r\n        // CASS\r\n        'x': Bubble.BORDER_WIDTH + 2,\r\n        'y': Bubble.BORDER_WIDTH + 2,\r\n      },\r\n      container,\r\n    );\r\n\r\n    const body = document.createElementNS(dom.HTML_NS, 'body');\r\n    body.setAttribute('xmlns', dom.HTML_NS);\r\n    body.className = 'blocklyMinimalBody';\r\n\r\n    const textArea = document.createElementNS(\r\n      dom.HTML_NS,\r\n      'textarea',\r\n    ) as HTMLTextAreaElement;\r\n    textArea.className = 'blocklyCommentTextarea';\r\n    textArea.setAttribute('dir', this.workspace.RTL ? 'RTL' : 'LTR');\r\n\r\n    body.appendChild(textArea);\r\n    inputRoot.appendChild(body);\r\n\r\n    this.bindTextAreaEvents(textArea);\r\n    setTimeout(() => {\r\n      textArea.focus();\r\n    }, 0);\r\n\r\n    return {inputRoot, textArea};\r\n  }\r\n\r\n  /** Binds events to the text area element. */\r\n  private bindTextAreaEvents(textArea: HTMLTextAreaElement) {\r\n    // Don't zoom with mousewheel.\r\n    browserEvents.conditionalBind(textArea, 'wheel', this, (e: Event) => {\r\n      e.stopPropagation();\r\n    });\r\n\r\n    browserEvents.conditionalBind(\r\n      textArea,\r\n      'focus',\r\n      this,\r\n      this.onStartEdit,\r\n      true,\r\n    );\r\n    browserEvents.conditionalBind(textArea, 'change', this, this.onTextChange);\r\n  }\r\n\r\n  /** Creates the resize handler elements and binds events to them. */\r\n  private createResizeHandle(container: SVGGElement): SVGGElement {\r\n    const resizeGroup = dom.createSvgElement(\r\n      Svg.G,\r\n      {\r\n        'class': this.workspace.RTL ? 'blocklyResizeSW' : 'blocklyResizeSE',\r\n      },\r\n      container,\r\n    );\r\n    const size = 2 * Bubble.BORDER_WIDTH;\r\n    dom.createSvgElement(\r\n      Svg.POLYGON,\r\n      {'points': `0,${size} ${size},${size} ${size},0`},\r\n      resizeGroup,\r\n    );\r\n    dom.createSvgElement(\r\n      Svg.LINE,\r\n      {\r\n        'class': 'blocklyResizeLine',\r\n        'x1': size / 3,\r\n        'y1': size - 1,\r\n        'x2': size - 1,\r\n        'y2': size / 3,\r\n      },\r\n      resizeGroup,\r\n    );\r\n    dom.createSvgElement(\r\n      Svg.LINE,\r\n      {\r\n        'class': 'blocklyResizeLine',\r\n        'x1': (size * 2) / 3,\r\n        'y1': size - 1,\r\n        'x2': size - 1,\r\n        'y2': (size * 2) / 3,\r\n      },\r\n      resizeGroup,\r\n    );\r\n\r\n    browserEvents.conditionalBind(\r\n      resizeGroup,\r\n      'pointerdown',\r\n      this,\r\n      this.onResizePointerDown,\r\n    );\r\n\r\n    return resizeGroup;\r\n  }\r\n\r\n  /**\r\n   * Sets the size of this bubble, including the border.\r\n   *\r\n   * @param size Sets the size of this bubble, including the border.\r\n   * @param relayout If true, reposition the bubble from scratch so that it is\r\n   *     optimally visible. If false, reposition it so it maintains the same\r\n   *     position relative to the anchor.\r\n   */\r\n  setSize(size: Size, relayout = false) {\r\n    size.width = Math.max(size.width, this.MIN_SIZE.width);\r\n    size.height = Math.max(size.height, this.MIN_SIZE.height);\r\n\r\n    const widthMinusBorder = size.width - Bubble.DOUBLE_BORDER;\r\n    const heightMinusBorder = size.height - Bubble.DOUBLE_BORDER;\r\n    this.inputRoot.setAttribute('width', `${widthMinusBorder}`);\r\n    this.inputRoot.setAttribute('height', `${heightMinusBorder}`);\r\n    this.textArea.style.width = `${widthMinusBorder - 4}px`;\r\n    this.textArea.style.height = `${heightMinusBorder - 4}px`;\r\n\r\n    if (this.workspace.RTL) {\r\n      this.resizeGroup.setAttribute(\r\n        'transform',\r\n        `translate(${Bubble.DOUBLE_BORDER}, ${heightMinusBorder}) scale(-1 1)`,\r\n      );\r\n    } else {\r\n      this.resizeGroup.setAttribute(\r\n        'transform',\r\n        `translate(${widthMinusBorder}, ${heightMinusBorder})`,\r\n      );\r\n    }\r\n\r\n    super.setSize(size, relayout);\r\n    this.onSizeChange();\r\n  }\r\n\r\n  /** @returns the size of this bubble. */\r\n  getSize(): Size {\r\n    // Overriden to be public.\r\n    return super.getSize();\r\n  }\r\n\r\n  /** Handles mouse down events on the resize target. */\r\n  private onResizePointerDown(e: PointerEvent) {\r\n    this.bringToFront();\r\n    if (browserEvents.isRightButton(e)) {\r\n      e.stopPropagation();\r\n      return;\r\n    }\r\n\r\n    this.workspace.startDrag(\r\n      e,\r\n      new Coordinate(\r\n        this.workspace.RTL ? -this.getSize().width : this.getSize().width,\r\n        this.getSize().height,\r\n      ),\r\n    );\r\n\r\n    this.resizePointerUpListener = browserEvents.conditionalBind(\r\n      document,\r\n      'pointerup',\r\n      this,\r\n      this.onResizePointerUp,\r\n    );\r\n    this.resizePointerMoveListener = browserEvents.conditionalBind(\r\n      document,\r\n      'pointermove',\r\n      this,\r\n      this.onResizePointerMove,\r\n    );\r\n    this.workspace.hideChaff();\r\n    // This event has been handled.  No need to bubble up to the document.\r\n    e.stopPropagation();\r\n  }\r\n\r\n  /** Handles pointer up events on the resize target. */\r\n  private onResizePointerUp(_e: PointerEvent) {\r\n    touch.clearTouchIdentifier();\r\n    if (this.resizePointerUpListener) {\r\n      browserEvents.unbind(this.resizePointerUpListener);\r\n      this.resizePointerUpListener = null;\r\n    }\r\n    if (this.resizePointerMoveListener) {\r\n      browserEvents.unbind(this.resizePointerMoveListener);\r\n      this.resizePointerMoveListener = null;\r\n    }\r\n  }\r\n\r\n  /** Handles pointer move events on the resize target. */\r\n  private onResizePointerMove(e: PointerEvent) {\r\n    const delta = this.workspace.moveDrag(e);\r\n    this.setSize(\r\n      new Size(this.workspace.RTL ? -delta.x : delta.x, delta.y),\r\n      false,\r\n    );\r\n    this.onSizeChange();\r\n  }\r\n\r\n  /**\r\n   * Handles starting an edit of the text area. Brings the bubble to the front.\r\n   */\r\n  private onStartEdit() {\r\n    if (this.bringToFront()) {\r\n      // Since the act of moving this node within the DOM causes a loss of\r\n      // focus, we need to reapply the focus.\r\n      this.textArea.focus();\r\n    }\r\n  }\r\n\r\n  /** Handles a text change event for the text area. Calls event listeners. */\r\n  private onTextChange() {\r\n    this.text = this.textArea.value;\r\n    for (const listener of this.textChangeListeners) {\r\n      listener();\r\n    }\r\n  }\r\n\r\n  /** Handles a size change event for the text area. Calls event listeners. */\r\n  private onSizeChange() {\r\n    for (const listener of this.sizeChangeListeners) {\r\n      listener();\r\n    }\r\n  }\r\n}\r\n\r\nCss.register(`\r\n.blocklyCommentTextarea {\r\n  background-color: #fef49c;\r\n  border: 0;\r\n  display: block;\r\n  margin: 0;\r\n  outline: 0;\r\n  padding: 3px;\r\n  resize: none;\r\n  text-overflow: hidden;\r\n}\r\n`);\r\n","/**\r\n * @license\r\n * Copyright 2023 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.Comment\r\n\r\nimport type {Block} from '../block.js';\r\nimport type {BlockSvg} from '../block_svg.js';\r\nimport {IconType} from './icon_types.js';\r\nimport {Coordinate} from '../utils.js';\r\nimport * as dom from '../utils/dom.js';\r\nimport * as eventUtils from '../events/utils.js';\r\nimport {Icon} from './icon.js';\r\nimport type {IHasBubble} from '../interfaces/i_has_bubble.js';\r\nimport type {ISerializable} from '../interfaces/i_serializable.js';\r\nimport {Rect} from '../utils/rect.js';\r\nimport * as registry from './registry.js';\r\nimport {Size} from '../utils/size.js';\r\nimport {Svg} from '../utils/svg.js';\r\nimport {TextBubble} from '../bubbles/text_bubble.js';\r\nimport {TextInputBubble} from '../bubbles/textinput_bubble.js';\r\nimport type {WorkspaceSvg} from '../workspace_svg.js';\r\n\r\n/** The size of the comment icon in workspace-scale units. */\r\nconst SIZE = 17;\r\n\r\n/** The default width in workspace-scale units of the text input bubble. */\r\nconst DEFAULT_BUBBLE_WIDTH = 160;\r\n\r\n/** The default height in workspace-scale units of the text input bubble. */\r\nconst DEFAULT_BUBBLE_HEIGHT = 80;\r\n\r\n/**\r\n * An icon which allows the user to add comment text to a block.\r\n */\r\nexport class CommentIcon extends Icon implements IHasBubble, ISerializable {\r\n  /** The type string used to identify this icon. */\r\n  static readonly TYPE = IconType.COMMENT;\r\n\r\n  /**\r\n   * The weight this icon has relative to other icons. Icons with more positive\r\n   * weight values are rendered farther toward the end of the block.\r\n   */\r\n  static readonly WEIGHT = 3;\r\n\r\n  /** The bubble used to show editable text to the user. */\r\n  private textInputBubble: TextInputBubble | null = null;\r\n\r\n  /** The bubble used to show non-editable text to the user. */\r\n  private textBubble: TextBubble | null = null;\r\n\r\n  /** The text of this comment. */\r\n  private text = '';\r\n\r\n  /** The size of this comment (which is applied to the editable bubble). */\r\n  private bubbleSize = new Size(DEFAULT_BUBBLE_WIDTH, DEFAULT_BUBBLE_HEIGHT);\r\n\r\n  /**\r\n   * The visibility of the bubble for this comment.\r\n   *\r\n   * This is used to track what the visibile state /should/ be, not necessarily\r\n   * what it currently /is/. E.g. sometimes this will be true, but the block\r\n   * hasn't been rendered yet, so the bubble will not currently be visible.\r\n   */\r\n  private bubbleVisiblity = false;\r\n\r\n  constructor(protected readonly sourceBlock: Block) {\r\n    super(sourceBlock);\r\n  }\r\n\r\n  override getType(): IconType<CommentIcon> {\r\n    return CommentIcon.TYPE;\r\n  }\r\n\r\n  override initView(pointerdownListener: (e: PointerEvent) => void): void {\r\n    if (this.svgRoot) return; // Already initialized.\r\n\r\n    super.initView(pointerdownListener);\r\n\r\n    // Circle.\r\n    dom.createSvgElement(\r\n      Svg.CIRCLE,\r\n      {'class': 'blocklyIconShape', 'r': '8', 'cx': '8', 'cy': '8'},\r\n      this.svgRoot,\r\n    );\r\n    // Can't use a real '?' text character since different browsers and\r\n    // operating systems render it differently. Body of question mark.\r\n    dom.createSvgElement(\r\n      Svg.PATH,\r\n      {\r\n        'class': 'blocklyIconSymbol',\r\n        'd':\r\n          'm6.8,10h2c0.003,-0.617 0.271,-0.962 0.633,-1.266 2.875,-2.405' +\r\n          '0.607,-5.534 -3.765,-3.874v1.7c3.12,-1.657 3.698,0.118 2.336,1.25' +\r\n          '-1.201,0.998 -1.201,1.528 -1.204,2.19z',\r\n      },\r\n      this.svgRoot,\r\n    );\r\n    // Dot of question mark.\r\n    dom.createSvgElement(\r\n      Svg.RECT,\r\n      {\r\n        'class': 'blocklyIconSymbol',\r\n        'x': '6.8',\r\n        'y': '10.78',\r\n        'height': '2',\r\n        'width': '2',\r\n      },\r\n      this.svgRoot,\r\n    );\r\n    dom.addClass(this.svgRoot!, 'blockly-icon-comment');\r\n  }\r\n\r\n  override dispose() {\r\n    super.dispose();\r\n    this.textInputBubble?.dispose();\r\n    this.textBubble?.dispose();\r\n  }\r\n\r\n  override getWeight(): number {\r\n    return CommentIcon.WEIGHT;\r\n  }\r\n\r\n  override getSize(): Size {\r\n    return new Size(SIZE, SIZE);\r\n  }\r\n\r\n  override applyColour(): void {\r\n    super.applyColour();\r\n    const colour = (this.sourceBlock as BlockSvg).style.colourPrimary;\r\n    this.textInputBubble?.setColour(colour);\r\n    this.textBubble?.setColour(colour);\r\n  }\r\n\r\n  /**\r\n   * Updates the state of the bubble (editable / noneditable) to reflect the\r\n   * state of the bubble if the bubble is currently shown.\r\n   */\r\n  override updateEditable(): void {\r\n    super.updateEditable();\r\n    if (this.bubbleIsVisible()) {\r\n      // Close and reopen the bubble to display the correct UI.\r\n      this.setBubbleVisible(false);\r\n      this.setBubbleVisible(true);\r\n    }\r\n  }\r\n\r\n  override onLocationChange(blockOrigin: Coordinate): void {\r\n    super.onLocationChange(blockOrigin);\r\n    const anchorLocation = this.getAnchorLocation();\r\n    this.textInputBubble?.setAnchorLocation(anchorLocation);\r\n    this.textBubble?.setAnchorLocation(anchorLocation);\r\n  }\r\n\r\n  /** Sets the text of this comment. Updates any bubbles if they are visible. */\r\n  setText(text: string) {\r\n    const oldText = this.text;\r\n    eventUtils.fire(\r\n      new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\r\n        this.sourceBlock,\r\n        'comment',\r\n        null,\r\n        oldText,\r\n        text,\r\n      ),\r\n    );\r\n    this.text = text;\r\n    this.textInputBubble?.setText(this.text);\r\n    this.textBubble?.setText(this.text);\r\n  }\r\n\r\n  /** Returns the text of this comment. */\r\n  getText(): string {\r\n    return this.text;\r\n  }\r\n\r\n  /**\r\n   * Sets the size of the editable bubble for this comment. Resizes the\r\n   * bubble if it is visible.\r\n   */\r\n  setBubbleSize(size: Size) {\r\n    this.bubbleSize = size;\r\n    this.textInputBubble?.setSize(this.bubbleSize, true);\r\n  }\r\n\r\n  /** @returns the size of the editable bubble for this comment. */\r\n  getBubbleSize(): Size {\r\n    return this.bubbleSize;\r\n  }\r\n\r\n  /**\r\n   * @returns the state of the comment as a JSON serializable value if the\r\n   * comment has text. Otherwise returns null.\r\n   */\r\n  saveState(): CommentState | null {\r\n    if (this.text) {\r\n      return {\r\n        'text': this.text,\r\n        'pinned': this.bubbleIsVisible(),\r\n        'height': this.bubbleSize.height,\r\n        'width': this.bubbleSize.width,\r\n      };\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /** Applies the given state to this comment. */\r\n  loadState(state: CommentState) {\r\n    this.text = state['text'] ?? '';\r\n    this.bubbleSize = new Size(\r\n      state['width'] ?? DEFAULT_BUBBLE_WIDTH,\r\n      state['height'] ?? DEFAULT_BUBBLE_HEIGHT,\r\n    );\r\n    this.bubbleVisiblity = state['pinned'] ?? false;\r\n    // Give the block a chance to be positioned and rendered before showing.\r\n    setTimeout(() => this.setBubbleVisible(this.bubbleVisiblity), 1);\r\n  }\r\n\r\n  override onClick(): void {\r\n    super.onClick();\r\n    this.setBubbleVisible(!this.bubbleIsVisible());\r\n  }\r\n\r\n  override isClickableInFlyout(): boolean {\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Updates the text of this comment in response to changes in the text of\r\n   * the input bubble.\r\n   */\r\n  onTextChange(): void {\r\n    if (!this.textInputBubble) return;\r\n\r\n    const newText = this.textInputBubble.getText();\r\n    if (this.text === newText) return;\r\n\r\n    eventUtils.fire(\r\n      new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\r\n        this.sourceBlock,\r\n        'comment',\r\n        null,\r\n        this.text,\r\n        newText,\r\n      ),\r\n    );\r\n    this.text = newText;\r\n  }\r\n\r\n  /**\r\n   * Updates the size of this icon in response to changes in the size of the\r\n   * input bubble.\r\n   */\r\n  onSizeChange(): void {\r\n    if (this.textInputBubble) {\r\n      this.bubbleSize = this.textInputBubble.getSize();\r\n    }\r\n  }\r\n\r\n  bubbleIsVisible(): boolean {\r\n    return this.bubbleVisiblity;\r\n  }\r\n\r\n  setBubbleVisible(visible: boolean): void {\r\n    if (visible && (this.textBubble || this.textInputBubble)) return;\r\n    if (!visible && !(this.textBubble || this.textInputBubble)) return;\r\n\r\n    this.bubbleVisiblity = visible;\r\n\r\n    if (!this.sourceBlock.rendered || this.sourceBlock.isInFlyout) return;\r\n\r\n    if (visible) {\r\n      if (this.sourceBlock.isEditable()) {\r\n        this.showEditableBubble();\r\n      } else {\r\n        this.showNonEditableBubble();\r\n      }\r\n      this.applyColour();\r\n    } else {\r\n      this.hideBubble();\r\n    }\r\n\r\n    eventUtils.fire(\r\n      new (eventUtils.get(eventUtils.BUBBLE_OPEN))(\r\n        this.sourceBlock,\r\n        visible,\r\n        'comment',\r\n      ),\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Shows the editable text bubble for this comment, and adds change listeners\r\n   * to update the state of this icon in response to changes in the bubble.\r\n   */\r\n  private showEditableBubble() {\r\n    this.textInputBubble = new TextInputBubble(\r\n      this.sourceBlock.workspace as WorkspaceSvg,\r\n      this.getAnchorLocation(),\r\n      this.getBubbleOwnerRect(),\r\n    );\r\n    this.textInputBubble.setText(this.getText());\r\n    this.textInputBubble.setSize(this.bubbleSize, true);\r\n    this.textInputBubble.addTextChangeListener(() => this.onTextChange());\r\n    this.textInputBubble.addSizeChangeListener(() => this.onSizeChange());\r\n  }\r\n\r\n  /** Shows the non editable text bubble for this comment. */\r\n  private showNonEditableBubble() {\r\n    this.textBubble = new TextBubble(\r\n      this.getText(),\r\n      this.sourceBlock.workspace as WorkspaceSvg,\r\n      this.getAnchorLocation(),\r\n      this.getBubbleOwnerRect(),\r\n    );\r\n  }\r\n\r\n  /** Hides any open bubbles owned by this comment. */\r\n  private hideBubble() {\r\n    this.textInputBubble?.dispose();\r\n    this.textInputBubble = null;\r\n    this.textBubble?.dispose();\r\n    this.textBubble = null;\r\n  }\r\n\r\n  /**\r\n   * @returns the location the bubble should be anchored to.\r\n   *     I.E. the middle of this icon.\r\n   */\r\n  private getAnchorLocation(): Coordinate {\r\n    const midIcon = SIZE / 2;\r\n    return Coordinate.sum(\r\n      this.workspaceLocation,\r\n      new Coordinate(midIcon, midIcon),\r\n    );\r\n  }\r\n\r\n  /**\r\n   * @returns the rect the bubble should avoid overlapping.\r\n   *     I.E. the block that owns this icon.\r\n   */\r\n  private getBubbleOwnerRect(): Rect {\r\n    const bbox = (this.sourceBlock as BlockSvg).getSvgRoot().getBBox();\r\n    return new Rect(bbox.y, bbox.y + bbox.height, bbox.x, bbox.x + bbox.width);\r\n  }\r\n}\r\n\r\nexport interface CommentState {\r\n  text?: string;\r\n  pinned?: boolean;\r\n  height?: number;\r\n  width?: number;\r\n}\r\n\r\nregistry.register(CommentIcon.TYPE, CommentIcon);\r\n","/**\r\n * @license\r\n * Copyright 2023 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.Warning\r\n\r\nimport type {BlockSvg} from '../block_svg.js';\r\nimport {Coordinate} from '../utils/coordinate.js';\r\nimport * as dom from '../utils/dom.js';\r\nimport * as eventUtils from '../events/utils.js';\r\nimport {Icon} from './icon.js';\r\nimport type {IHasBubble} from '../interfaces/i_has_bubble.js';\r\nimport {Rect} from '../utils/rect.js';\r\nimport {Size} from '../utils.js';\r\nimport {Svg} from '../utils/svg.js';\r\nimport {TextBubble} from '../bubbles/text_bubble.js';\r\nimport {IconType} from './icon_types.js';\r\n\r\n/** The size of the warning icon in workspace-scale units. */\r\nconst SIZE = 17;\r\n\r\n/**\r\n * An icon that warns the user that something is wrong with their block.\r\n *\r\n * For example, this could be used to warn them about incorrect field values,\r\n * or incorrect placement of the block (putting it somewhere it doesn't belong).\r\n */\r\nexport class WarningIcon extends Icon implements IHasBubble {\r\n  /** The type string used to identify this icon. */\r\n  static readonly TYPE = IconType.WARNING;\r\n\r\n  /**\r\n   * The weight this icon has relative to other icons. Icons with more positive\r\n   * weight values are rendered farther toward the end of the block.\r\n   */\r\n  static readonly WEIGHT = 2;\r\n\r\n  /** A map of warning IDs to warning text. */\r\n  private textMap: Map<string, string> = new Map();\r\n\r\n  /** The bubble used to display the warnings to the user. */\r\n  private textBubble: TextBubble | null = null;\r\n\r\n  /** @internal */\r\n  constructor(protected readonly sourceBlock: BlockSvg) {\r\n    super(sourceBlock);\r\n  }\r\n\r\n  override getType(): IconType<WarningIcon> {\r\n    return WarningIcon.TYPE;\r\n  }\r\n\r\n  override initView(pointerdownListener: (e: PointerEvent) => void): void {\r\n    if (this.svgRoot) return; // Already initialized.\r\n\r\n    super.initView(pointerdownListener);\r\n\r\n    // Triangle with rounded corners.\r\n    dom.createSvgElement(\r\n      Svg.PATH,\r\n      {\r\n        'class': 'blocklyIconShape',\r\n        'd': 'M2,15Q-1,15 0.5,12L6.5,1.7Q8,-1 9.5,1.7L15.5,12Q17,15 14,15z',\r\n      },\r\n      this.svgRoot,\r\n    );\r\n    // Can't use a real '!' text character since different browsers and\r\n    // operating systems render it differently. Body of exclamation point.\r\n    dom.createSvgElement(\r\n      Svg.PATH,\r\n      {\r\n        'class': 'blocklyIconSymbol',\r\n        'd': 'm7,4.8v3.16l0.27,2.27h1.46l0.27,-2.27v-3.16z',\r\n      },\r\n      this.svgRoot,\r\n    );\r\n    // Dot of exclamation point.\r\n    dom.createSvgElement(\r\n      Svg.RECT,\r\n      {\r\n        'class': 'blocklyIconSymbol',\r\n        'x': '7',\r\n        'y': '11',\r\n        'height': '2',\r\n        'width': '2',\r\n      },\r\n      this.svgRoot,\r\n    );\r\n    dom.addClass(this.svgRoot!, 'blockly-icon-warning');\r\n  }\r\n\r\n  override dispose() {\r\n    super.dispose();\r\n    this.textBubble?.dispose();\r\n  }\r\n\r\n  override getWeight(): number {\r\n    return WarningIcon.WEIGHT;\r\n  }\r\n\r\n  override getSize(): Size {\r\n    return new Size(SIZE, SIZE);\r\n  }\r\n\r\n  override applyColour(): void {\r\n    super.applyColour();\r\n    this.textBubble?.setColour(this.sourceBlock.style.colourPrimary);\r\n  }\r\n\r\n  override updateCollapsed(): void {\r\n    // We are shown when collapsed, so do nothing! I.e. skip the default\r\n    // behavior of hiding.\r\n  }\r\n\r\n  /** Tells blockly that this icon is shown when the block is collapsed. */\r\n  override isShownWhenCollapsed(): boolean {\r\n    return true;\r\n  }\r\n\r\n  /** Updates the location of the icon's bubble if it is open. */\r\n  override onLocationChange(blockOrigin: Coordinate): void {\r\n    super.onLocationChange(blockOrigin);\r\n    this.textBubble?.setAnchorLocation(this.getAnchorLocation());\r\n  }\r\n\r\n  /**\r\n   * Adds a warning message to this warning icon.\r\n   *\r\n   * @param text The text of the message to add.\r\n   * @param id The id of the message to add.\r\n   * @internal\r\n   */\r\n  addMessage(text: string, id: string): this {\r\n    if (this.textMap.get(id) === text) return this;\r\n\r\n    if (text) {\r\n      this.textMap.set(id, text);\r\n    } else {\r\n      this.textMap.delete(id);\r\n    }\r\n\r\n    this.textBubble?.setText(this.getText());\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * @returns the display text for this icon. Includes all warning messages\r\n   *     concatenated together with newlines.\r\n   * @internal\r\n   */\r\n  getText(): string {\r\n    return [...this.textMap.values()].join('\\n');\r\n  }\r\n\r\n  /** Toggles the visibility of the bubble. */\r\n  override onClick(): void {\r\n    super.onClick();\r\n    this.setBubbleVisible(!this.bubbleIsVisible());\r\n  }\r\n\r\n  override isClickableInFlyout(): boolean {\r\n    return false;\r\n  }\r\n\r\n  bubbleIsVisible(): boolean {\r\n    return !!this.textBubble;\r\n  }\r\n\r\n  setBubbleVisible(visible: boolean): void {\r\n    if (this.bubbleIsVisible() === visible) return;\r\n\r\n    if (visible) {\r\n      this.textBubble = new TextBubble(\r\n        this.getText(),\r\n        this.sourceBlock.workspace,\r\n        this.getAnchorLocation(),\r\n        this.getBubbleOwnerRect(),\r\n      );\r\n      this.applyColour();\r\n    } else {\r\n      this.textBubble?.dispose();\r\n      this.textBubble = null;\r\n    }\r\n\r\n    eventUtils.fire(\r\n      new (eventUtils.get(eventUtils.BUBBLE_OPEN))(\r\n        this.sourceBlock,\r\n        visible,\r\n        'warning',\r\n      ),\r\n    );\r\n  }\r\n\r\n  /**\r\n   * @returns the location the bubble should be anchored to.\r\n   *     I.E. the middle of this icon.\r\n   */\r\n  private getAnchorLocation(): Coordinate {\r\n    const midIcon = SIZE / 2;\r\n    return Coordinate.sum(\r\n      this.workspaceLocation,\r\n      new Coordinate(midIcon, midIcon),\r\n    );\r\n  }\r\n\r\n  /**\r\n   * @returns the rect the bubble should avoid overlapping.\r\n   *     I.E. the block that owns this icon.\r\n   */\r\n  private getBubbleOwnerRect(): Rect {\r\n    const bbox = this.sourceBlock.getSvgRoot().getBBox();\r\n    return new Rect(bbox.y, bbox.y + bbox.height, bbox.x, bbox.x + bbox.width);\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2023 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport type {IIcon} from '../interfaces/i_icon.js';\r\n\r\n/**\r\n * Thrown when you add more than one icon of the same type to a block.\r\n */\r\nexport class DuplicateIconType extends Error {\r\n  /**\r\n   * @internal\r\n   */\r\n  constructor(public icon: IIcon) {\r\n    super(\r\n      `Tried to append an icon of type ${icon.getType()} when an icon of ` +\r\n        `that type already exists on the block. ` +\r\n        `Use getIcon to access the existing icon.`,\r\n    );\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2023 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport {Icon} from './icons/icon.js';\r\nimport {CommentIcon, CommentState} from './icons/comment_icon.js';\r\nimport {MutatorIcon} from './icons/mutator_icon.js';\r\nimport {WarningIcon} from './icons/warning_icon.js';\r\nimport {IconType} from './icons/icon_types.js';\r\nimport * as exceptions from './icons/exceptions.js';\r\nimport * as registry from './icons/registry.js';\r\n\r\nexport {\r\n  Icon,\r\n  CommentIcon,\r\n  CommentState,\r\n  MutatorIcon,\r\n  WarningIcon,\r\n  IconType,\r\n  exceptions,\r\n  registry,\r\n};\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.blockRendering.Types\r\n\r\nimport type {Measurable} from './base.js';\r\nimport type {Row} from './row.js';\r\n\r\n/**\r\n * Types of rendering elements.\r\n */\r\nclass TypesContainer {\r\n  [index: string]: number | Function;\r\n\r\n  NONE = 0; // None\r\n  FIELD = 1 << 0; // Field.\r\n  HAT = 1 << 1; // Hat.\r\n  ICON = 1 << 2; // Icon.\r\n  SPACER = 1 << 3; // Spacer.\r\n  BETWEEN_ROW_SPACER = 1 << 4; // Between Row Spacer.\r\n  IN_ROW_SPACER = 1 << 5; // In Row Spacer.\r\n  EXTERNAL_VALUE_INPUT = 1 << 6; // External Value Input.\r\n  INPUT = 1 << 7; // Input.\r\n  INLINE_INPUT = 1 << 8; // Inline Input.\r\n  STATEMENT_INPUT = 1 << 9; // Statement Input.\r\n  CONNECTION = 1 << 10; // Connection.\r\n  PREVIOUS_CONNECTION = 1 << 11; // Previous Connection.\r\n  NEXT_CONNECTION = 1 << 12; // Next Connection.\r\n  OUTPUT_CONNECTION = 1 << 13; // Output Connection.\r\n  CORNER = 1 << 14; // Corner.\r\n  LEFT_SQUARE_CORNER = 1 << 15; // Square Corner.\r\n  LEFT_ROUND_CORNER = 1 << 16; // Round Corner.\r\n  RIGHT_SQUARE_CORNER = 1 << 17; // Right Square Corner.\r\n  RIGHT_ROUND_CORNER = 1 << 18; // Right Round Corner.\r\n  JAGGED_EDGE = 1 << 19; // Jagged Edge.\r\n  ROW = 1 << 20; // Row.\r\n  TOP_ROW = 1 << 21; // Top Row.\r\n  BOTTOM_ROW = 1 << 22; // Bottom Row.\r\n  INPUT_ROW = 1 << 23; // Input Row.\r\n\r\n  /**\r\n   * A Left Corner Union Type.\r\n   */\r\n  LEFT_CORNER = this.LEFT_SQUARE_CORNER | this.LEFT_ROUND_CORNER;\r\n\r\n  /**\r\n   * A Right Corner Union Type.\r\n   */\r\n  RIGHT_CORNER = this.RIGHT_SQUARE_CORNER | this.RIGHT_ROUND_CORNER;\r\n\r\n  /**\r\n   * Next flag value to use for custom rendering element types.\r\n   * This must be updated to reflect the next enum flag value\r\n   * to use if additional elements are added to\r\n   * `Types`.\r\n   */\r\n  nextTypeValue_ = 1 << 24;\r\n\r\n  /**\r\n   * Get the enum flag value of an existing type or register a new type.\r\n   *\r\n   * @param type The name of the type.\r\n   * @returns The enum flag value associated with that type.\r\n   */\r\n  getType(type: string): number {\r\n    if (!Object.prototype.hasOwnProperty.call(this, type)) {\r\n      this[type] = this.nextTypeValue_;\r\n      this.nextTypeValue_ <<= 1;\r\n    }\r\n    return this[type] as number;\r\n  }\r\n\r\n  /**\r\n   * Whether a measurable stores information about a field.\r\n   *\r\n   * @param elem The element to check.\r\n   * @returns 1 if the object stores information about a field.\r\n   */\r\n  isField(elem: Measurable): number {\r\n    return elem.type & this.FIELD;\r\n  }\r\n\r\n  /**\r\n   * Whether a measurable stores information about a hat.\r\n   *\r\n   * @param elem The element to check.\r\n   * @returns 1 if the object stores information about a hat.\r\n   */\r\n  isHat(elem: Measurable): number {\r\n    return elem.type & this.HAT;\r\n  }\r\n\r\n  /**\r\n   * Whether a measurable stores information about an icon.\r\n   *\r\n   * @param elem The element to check.\r\n   * @returns 1 if the object stores information about an icon.\r\n   */\r\n  isIcon(elem: Measurable): number {\r\n    return elem.type & this.ICON;\r\n  }\r\n\r\n  /**\r\n   * Whether a measurable stores information about a spacer.\r\n   *\r\n   * @param elem The element to check.\r\n   * @returns 1 if the object stores information about a spacer.\r\n   */\r\n  isSpacer(elem: Measurable | Row): number {\r\n    return elem.type & this.SPACER;\r\n  }\r\n\r\n  /**\r\n   * Whether a measurable stores information about an in-row spacer.\r\n   *\r\n   * @param elem The element to check.\r\n   * @returns 1 if the object stores information about an in-row spacer.\r\n   */\r\n  isInRowSpacer(elem: Measurable): number {\r\n    return elem.type & this.IN_ROW_SPACER;\r\n  }\r\n\r\n  /**\r\n   * Whether a measurable stores information about an input.\r\n   *\r\n   * @param elem The element to check.\r\n   * @returns 1 if the object stores information about an input.\r\n   */\r\n  isInput(elem: Measurable): number {\r\n    return elem.type & this.INPUT;\r\n  }\r\n\r\n  /**\r\n   * Whether a measurable stores information about an external input.\r\n   *\r\n   * @param elem The element to check.\r\n   * @returns 1 if the object stores information about an external input.\r\n   */\r\n  isExternalInput(elem: Measurable): number {\r\n    return elem.type & this.EXTERNAL_VALUE_INPUT;\r\n  }\r\n\r\n  /**\r\n   * Whether a measurable stores information about an inline input.\r\n   *\r\n   * @param elem The element to check.\r\n   * @returns 1 if the object stores information about an inline input.\r\n   */\r\n  isInlineInput(elem: Measurable): number {\r\n    return elem.type & this.INLINE_INPUT;\r\n  }\r\n\r\n  /**\r\n   * Whether a measurable stores information about a statement input.\r\n   *\r\n   * @param elem The element to check.\r\n   * @returns 1 if the object stores information about a statement input.\r\n   */\r\n  isStatementInput(elem: Measurable): number {\r\n    return elem.type & this.STATEMENT_INPUT;\r\n  }\r\n\r\n  /**\r\n   * Whether a measurable stores information about a previous connection.\r\n   *\r\n   * @param elem The element to check.\r\n   * @returns 1 if the object stores information about a previous connection.\r\n   */\r\n  isPreviousConnection(elem: Measurable): number {\r\n    return elem.type & this.PREVIOUS_CONNECTION;\r\n  }\r\n\r\n  /**\r\n   * Whether a measurable stores information about a next connection.\r\n   *\r\n   * @param elem The element to check.\r\n   * @returns 1 if the object stores information about a next connection.\r\n   */\r\n  isNextConnection(elem: Measurable): number {\r\n    return elem.type & this.NEXT_CONNECTION;\r\n  }\r\n\r\n  /**\r\n   * Whether a measurable stores information about a previous or next\r\n   * connection.\r\n   *\r\n   * @param elem The element to check.\r\n   * @returns 1 if the object stores information about a previous or next\r\n   *     connection.\r\n   */\r\n  isPreviousOrNextConnection(elem: Measurable): number {\r\n    return elem.type & (this.PREVIOUS_CONNECTION | this.NEXT_CONNECTION);\r\n  }\r\n\r\n  /**\r\n   * Whether a measurable stores information about a left round corner.\r\n   *\r\n   * @param elem The element to check.\r\n   * @returns 1 if the object stores information about a left round corner.\r\n   */\r\n  isLeftRoundedCorner(elem: Measurable): number {\r\n    return elem.type & this.LEFT_ROUND_CORNER;\r\n  }\r\n\r\n  /**\r\n   * Whether a measurable stores information about a right round corner.\r\n   *\r\n   * @param elem The element to check.\r\n   * @returns 1 if the object stores information about a right round corner.\r\n   */\r\n  isRightRoundedCorner(elem: Measurable): number {\r\n    return elem.type & this.RIGHT_ROUND_CORNER;\r\n  }\r\n\r\n  /**\r\n   * Whether a measurable stores information about a left square corner.\r\n   *\r\n   * @param elem The element to check.\r\n   * @returns 1 if the object stores information about a left square corner.\r\n   */\r\n  isLeftSquareCorner(elem: Measurable): number {\r\n    return elem.type & this.LEFT_SQUARE_CORNER;\r\n  }\r\n\r\n  /**\r\n   * Whether a measurable stores information about a right square corner.\r\n   *\r\n   * @param elem The element to check.\r\n   * @returns 1 if the object stores information about a right square corner.\r\n   */\r\n  isRightSquareCorner(elem: Measurable): number {\r\n    return elem.type & this.RIGHT_SQUARE_CORNER;\r\n  }\r\n\r\n  /**\r\n   * Whether a measurable stores information about a corner.\r\n   *\r\n   * @param elem The element to check.\r\n   * @returns 1 if the object stores information about a corner.\r\n   */\r\n  isCorner(elem: Measurable): number {\r\n    return elem.type & this.CORNER;\r\n  }\r\n\r\n  /**\r\n   * Whether a measurable stores information about a jagged edge.\r\n   *\r\n   * @param elem The element to check.\r\n   * @returns 1 if the object stores information about a jagged edge.\r\n   */\r\n  isJaggedEdge(elem: Measurable): number {\r\n    return elem.type & this.JAGGED_EDGE;\r\n  }\r\n\r\n  /**\r\n   * Whether a measurable stores information about a row.\r\n   *\r\n   * @param row The row to check.\r\n   * @returns 1 if the object stores information about a row.\r\n   */\r\n  isRow(row: Row): number {\r\n    return row.type & this.ROW;\r\n  }\r\n\r\n  /**\r\n   * Whether a measurable stores information about a between-row spacer.\r\n   *\r\n   * @param row The row to check.\r\n   * @returns 1 if the object stores information about a between-row spacer.\r\n   */\r\n  isBetweenRowSpacer(row: Row): number {\r\n    return row.type & this.BETWEEN_ROW_SPACER;\r\n  }\r\n\r\n  /**\r\n   * Whether a measurable stores information about a top row.\r\n   *\r\n   * @param row The row to check.\r\n   * @returns 1 if the object stores information about a top row.\r\n   */\r\n  isTopRow(row: Row): number {\r\n    return row.type & this.TOP_ROW;\r\n  }\r\n\r\n  /**\r\n   * Whether a measurable stores information about a bottom row.\r\n   *\r\n   * @param row The row to check.\r\n   * @returns 1 if the object stores information about a bottom row.\r\n   */\r\n  isBottomRow(row: Row): number {\r\n    return row.type & this.BOTTOM_ROW;\r\n  }\r\n\r\n  /**\r\n   * Whether a measurable stores information about a top or bottom row.\r\n   *\r\n   * @param row The row to check.\r\n   * @returns 1 if the object stores information about a top or bottom row.\r\n   */\r\n  isTopOrBottomRow(row: Row): number {\r\n    return row.type & (this.TOP_ROW | this.BOTTOM_ROW);\r\n  }\r\n\r\n  /**\r\n   * Whether a measurable stores information about an input row.\r\n   *\r\n   * @param row The row to check.\r\n   * @returns 1 if the object stores information about an input row.\r\n   */\r\n  isInputRow(row: Row): number {\r\n    return row.type & this.INPUT_ROW;\r\n  }\r\n}\r\n\r\nexport const Types = new TypesContainer();\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.blockRendering.Measurable\r\n\r\nimport type {ConstantProvider} from '../common/constants.js';\r\n\r\nimport {Types} from './types.js';\r\n\r\n/**\r\n * The base class to represent a part of a block that takes up space during\r\n * rendering.  The constructor for each non-spacer Measurable records the size\r\n * of the block element (e.g. field, statement input).\r\n */\r\nexport class Measurable {\r\n  width = 0;\r\n\r\n  height = 0;\r\n  type: number;\r\n  xPos = 0;\r\n\r\n  centerline = 0;\r\n  notchOffset: number;\r\n\r\n  /** The renderer's constant provider. */\r\n  protected readonly constants_: ConstantProvider;\r\n\r\n  /**\r\n   * @param constants The rendering constants provider.\r\n   */\r\n  constructor(constants: ConstantProvider) {\r\n    this.constants_ = constants;\r\n\r\n    this.type = Types.NONE;\r\n\r\n    this.notchOffset = this.constants_.NOTCH_OFFSET_LEFT;\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.blockRendering.Row\r\n\r\nimport type {ConstantProvider} from '../common/constants.js';\r\n\r\nimport type {Measurable} from './base.js';\r\nimport type {InRowSpacer} from './in_row_spacer.js';\r\nimport type {InputConnection} from './input_connection.js';\r\nimport {Types} from './types.js';\r\n\r\n/**\r\n * An object representing a single row on a rendered block and all of its\r\n * subcomponents.\r\n */\r\nexport class Row {\r\n  type: number;\r\n\r\n  /**\r\n   * An array of elements contained in this row.\r\n   */\r\n  elements: Measurable[] = [];\r\n\r\n  /**\r\n   * The height of the row.\r\n   */\r\n  height = 0;\r\n\r\n  /**\r\n   * The width of the row, from the left edge of the block to the right.\r\n   * Does not include child blocks unless they are inline.\r\n   */\r\n  width = 0;\r\n\r\n  /**\r\n   * The minimum height of the row.\r\n   */\r\n  minHeight = 0;\r\n\r\n  /**\r\n   * The minimum width of the row, from the left edge of the block to the\r\n   * right. Does not include child blocks unless they are inline.\r\n   */\r\n  minWidth = 0;\r\n\r\n  /**\r\n   * The width of the row, from the left edge of the block to the edge of the\r\n   * block or any connected child blocks.\r\n   */\r\n  widthWithConnectedBlocks = 0;\r\n\r\n  /**\r\n   * The Y position of the row relative to the origin of the block's svg\r\n   * group.\r\n   */\r\n  yPos = 0;\r\n\r\n  /**\r\n   * The X position of the row relative to the origin of the block's svg\r\n   * group.\r\n   */\r\n  xPos = 0;\r\n\r\n  /**\r\n   * Whether the row has any external inputs.\r\n   */\r\n  hasExternalInput = false;\r\n\r\n  /**\r\n   * Whether the row has any statement inputs.\r\n   */\r\n  hasStatement = false;\r\n\r\n  /**\r\n   * Where the left edge of all of the statement inputs on the block should\r\n   * be. This makes sure that statement inputs which are proceded by fields\r\n   * of varius widths are all aligned.\r\n   */\r\n  statementEdge = 0;\r\n\r\n  /**\r\n   * Whether the row has any inline inputs.\r\n   */\r\n  hasInlineInput = false;\r\n\r\n  /**\r\n   * Whether the row has any dummy inputs or end-row inputs.\r\n   */\r\n  hasDummyInput = false;\r\n\r\n  /**\r\n   * Whether the row has a jagged edge.\r\n   */\r\n  hasJaggedEdge = false;\r\n  notchOffset: number;\r\n\r\n  /**\r\n   * Alignment of the row.\r\n   */\r\n  align: number | null = null;\r\n\r\n  protected readonly constants_: ConstantProvider;\r\n\r\n  /**\r\n   * @param constants The rendering constants provider.\r\n   */\r\n  constructor(constants: ConstantProvider) {\r\n    /** The renderer's constant provider. */\r\n    this.constants_ = constants;\r\n\r\n    /** The type of this rendering object. */\r\n    this.type = Types.ROW;\r\n\r\n    this.notchOffset = this.constants_.NOTCH_OFFSET_LEFT;\r\n  }\r\n\r\n  /**\r\n   * Get the last input on this row, if it has one.\r\n   *\r\n   * @returns The last input on the row, or null.\r\n   */\r\n  getLastInput(): InputConnection | null {\r\n    // TODO: Consider moving this to InputRow, if possible.\r\n    for (let i = this.elements.length - 1; i >= 0; i--) {\r\n      const elem = this.elements[i];\r\n      if (Types.isInput(elem)) {\r\n        return elem as InputConnection;\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Inspect all subcomponents and populate all size properties on the row.\r\n   */\r\n  measure() {\r\n    throw Error('Unexpected attempt to measure a base Row.');\r\n  }\r\n\r\n  /**\r\n   * Determines whether this row should start with an element spacer.\r\n   *\r\n   * @returns Whether the row should start with a spacer.\r\n   */\r\n  startsWithElemSpacer(): boolean {\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Determines whether this row should end with an element spacer.\r\n   *\r\n   * @returns Whether the row should end with a spacer.\r\n   */\r\n  endsWithElemSpacer(): boolean {\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Convenience method to get the first spacer element on this row.\r\n   *\r\n   * @returns The first spacer element on this row.\r\n   */\r\n  getFirstSpacer(): InRowSpacer | null {\r\n    for (let i = 0; i < this.elements.length; i++) {\r\n      const elem = this.elements[i];\r\n      if (Types.isSpacer(elem)) {\r\n        return elem as InRowSpacer;\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Convenience method to get the last spacer element on this row.\r\n   *\r\n   * @returns The last spacer element on this row.\r\n   */\r\n  getLastSpacer(): InRowSpacer | null {\r\n    for (let i = this.elements.length - 1; i >= 0; i--) {\r\n      const elem = this.elements[i];\r\n      if (Types.isSpacer(elem)) {\r\n        return elem as InRowSpacer;\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.blockRendering.BottomRow\r\n\r\nimport type {BlockSvg} from '../../block_svg.js';\r\nimport type {ConstantProvider} from '../common/constants.js';\r\n\r\nimport type {NextConnection} from './next_connection.js';\r\nimport {Row} from './row.js';\r\nimport {Types} from './types.js';\r\n\r\n/**\r\n * An object containing information about what elements are in the bottom row of\r\n * a block as well as spacing information for the bottom row.\r\n * Elements in a bottom row can consist of corners, spacers and next\r\n * connections.\r\n */\r\nexport class BottomRow extends Row {\r\n  /**\r\n   * Whether this row has a next connection.\r\n   */\r\n  hasNextConnection = false;\r\n\r\n  /**\r\n   * The next connection on the row, if any.\r\n   */\r\n  connection: NextConnection | null = null;\r\n\r\n  /**\r\n   * The amount that the bottom of the block extends below the horizontal\r\n   * edge, e.g. because of a next connection.  Must be non-negative (see\r\n   * #2820).\r\n   */\r\n  descenderHeight = 0;\r\n\r\n  /**\r\n   * The Y position of the bottom edge of the block, relative to the origin\r\n   * of the block rendering.\r\n   */\r\n  baseline = 0;\r\n\r\n  /**\r\n   * @param constants The rendering constants provider.\r\n   */\r\n  constructor(constants: ConstantProvider) {\r\n    super(constants);\r\n    this.type |= Types.BOTTOM_ROW;\r\n  }\r\n\r\n  /**\r\n   * Returns whether or not the bottom row has a left square corner.\r\n   *\r\n   * @param block The block whose bottom row this represents.\r\n   * @returns Whether or not the bottom row has a left square corner.\r\n   */\r\n  hasLeftSquareCorner(block: BlockSvg): boolean {\r\n    return !!block.outputConnection || !!block.getNextBlock();\r\n  }\r\n\r\n  /**\r\n   * Returns whether or not the bottom row has a right square corner.\r\n   *\r\n   * @param _block The block whose bottom row this represents.\r\n   * @returns Whether or not the bottom row has a right square corner.\r\n   */\r\n  hasRightSquareCorner(_block: BlockSvg): boolean {\r\n    return true;\r\n  }\r\n\r\n  override measure() {\r\n    let height = 0;\r\n    let width = 0;\r\n    let descenderHeight = 0;\r\n    for (let i = 0; i < this.elements.length; i++) {\r\n      const elem = this.elements[i];\r\n      width += elem.width;\r\n      if (!Types.isSpacer(elem)) {\r\n        // Note: this assumes that next connections have *only* descenderHeight,\r\n        // with no height above the baseline.\r\n        if (Types.isNextConnection(elem)) {\r\n          descenderHeight = Math.max(descenderHeight, elem.height);\r\n        } else {\r\n          height = Math.max(height, elem.height);\r\n        }\r\n      }\r\n    }\r\n    this.width = Math.max(this.minWidth, width);\r\n    this.height = Math.max(this.minHeight, height) + descenderHeight;\r\n    this.descenderHeight = descenderHeight;\r\n    this.widthWithConnectedBlocks = this.width;\r\n  }\r\n\r\n  override startsWithElemSpacer() {\r\n    return false;\r\n  }\r\n\r\n  override endsWithElemSpacer() {\r\n    return false;\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.blockRendering.Connection\r\n\r\n/* eslint-disable-next-line no-unused-vars */\r\nimport type {RenderedConnection} from '../../rendered_connection.js';\r\nimport type {ConstantProvider, Shape} from '../common/constants.js';\r\n\r\nimport {Measurable} from './base.js';\r\nimport {Types} from './types.js';\r\n\r\n/**\r\n * The base class to represent a connection and the space that it takes up on\r\n * the block.\r\n */\r\nexport class Connection extends Measurable {\r\n  shape: Shape;\r\n  isDynamicShape: boolean;\r\n  highlighted: boolean;\r\n\r\n  /**\r\n   * @param constants The rendering constants provider.\r\n   * @param connectionModel The connection object on the block that this\r\n   *     represents.\r\n   */\r\n  constructor(\r\n    constants: ConstantProvider,\r\n    public connectionModel: RenderedConnection,\r\n  ) {\r\n    super(constants);\r\n\r\n    this.type |= Types.CONNECTION;\r\n\r\n    this.shape = this.constants_.shapeFor(connectionModel);\r\n    this.isDynamicShape = 'isDynamic' in this.shape && this.shape.isDynamic;\r\n\r\n    this.highlighted = connectionModel.isHighlighted();\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.blockRendering.InputConnection\r\n\r\nimport type {BlockSvg} from '../../block_svg.js';\r\nimport type {Input} from '../../inputs/input.js';\r\nimport type {RenderedConnection} from '../../rendered_connection.js';\r\nimport type {ConstantProvider} from '../common/constants.js';\r\n\r\nimport {Connection} from './connection.js';\r\nimport {Types} from './types.js';\r\n\r\n/**\r\n * The base class to represent an input that takes up space on a block\r\n * during rendering.\r\n */\r\nexport class InputConnection extends Connection {\r\n  align: number;\r\n  connectedBlock: BlockSvg | null;\r\n  connectedBlockWidth: number;\r\n  connectedBlockHeight: number;\r\n  connectionOffsetX = 0;\r\n  connectionOffsetY = 0;\r\n\r\n  /**\r\n   * @param constants The rendering constants provider.\r\n   * @param input The input to measure and store information for.\r\n   */\r\n  constructor(\r\n    constants: ConstantProvider,\r\n    public input: Input,\r\n  ) {\r\n    super(constants, input.connection as RenderedConnection);\r\n\r\n    this.type |= Types.INPUT;\r\n\r\n    this.align = input.align;\r\n\r\n    this.connectedBlock =\r\n      input.connection && input.connection.targetBlock()\r\n        ? (input.connection.targetBlock() as BlockSvg)\r\n        : null;\r\n\r\n    if (this.connectedBlock) {\r\n      const bBox = this.connectedBlock.getHeightWidth();\r\n      this.connectedBlockWidth = bBox.width;\r\n      this.connectedBlockHeight = bBox.height;\r\n    } else {\r\n      this.connectedBlockWidth = 0;\r\n      this.connectedBlockHeight = 0;\r\n    }\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.blockRendering.ExternalValueInput\r\n\r\n/* eslint-disable-next-line no-unused-vars */\r\nimport type {Input} from '../../inputs/input.js';\r\nimport type {ConstantProvider} from '../common/constants.js';\r\n\r\nimport {InputConnection} from './input_connection.js';\r\nimport {Types} from './types.js';\r\n\r\n/**\r\n * An object containing information about the space an external value input\r\n * takes up during rendering\r\n */\r\nexport class ExternalValueInput extends InputConnection {\r\n  override height = 0;\r\n  override width: number;\r\n  override connectionOffsetY: number;\r\n  connectionHeight: number;\r\n  connectionWidth: number;\r\n\r\n  /**\r\n   * @param constants The rendering constants provider.\r\n   * @param input The external value input to measure and store information for.\r\n   */\r\n  constructor(constants: ConstantProvider, input: Input) {\r\n    super(constants, input);\r\n    this.type |= Types.EXTERNAL_VALUE_INPUT;\r\n    if (!this.connectedBlock) {\r\n      this.height = this.shape.height as number;\r\n    } else {\r\n      this.height =\r\n        this.connectedBlockHeight -\r\n        this.constants_.TAB_OFFSET_FROM_TOP -\r\n        this.constants_.MEDIUM_PADDING;\r\n    }\r\n\r\n    this.width =\r\n      (this.shape.width as number) +\r\n      this.constants_.EXTERNAL_VALUE_INPUT_PADDING;\r\n\r\n    this.connectionOffsetY = this.constants_.TAB_OFFSET_FROM_TOP;\r\n\r\n    this.connectionHeight = this.shape.height as number;\r\n\r\n    this.connectionWidth = this.shape.width as number;\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.blockRendering.Field\r\n\r\n/* eslint-disable-next-line no-unused-vars */\r\nimport type {Field as BlocklyField} from '../../field.js';\r\nimport type {Input} from '../../inputs/input.js';\r\nimport type {ConstantProvider} from '../common/constants.js';\r\n\r\nimport {Measurable} from './base.js';\r\nimport {Types} from './types.js';\r\n\r\n/**\r\n * An object containing information about the space a field takes up during\r\n * rendering\r\n */\r\nexport class Field extends Measurable {\r\n  isEditable: boolean;\r\n  flipRtl: boolean;\r\n  override height: number;\r\n  override width: number;\r\n\r\n  /**\r\n   * @param constants The rendering constants provider.\r\n   * @param field The field to measure and store information for.\r\n   * @param parentInput The parent input for the field.\r\n   */\r\n  constructor(\r\n    constants: ConstantProvider,\r\n    public field: BlocklyField,\r\n    public parentInput: Input,\r\n  ) {\r\n    super(constants);\r\n\r\n    this.isEditable = field.EDITABLE;\r\n\r\n    this.flipRtl = field.getFlipRtl();\r\n    this.type |= Types.FIELD;\r\n\r\n    const size = this.field.getSize();\r\n\r\n    this.height = size.height;\r\n\r\n    this.width = size.width;\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.blockRendering.Hat\r\n\r\nimport type {ConstantProvider} from '../common/constants.js';\r\n\r\nimport {Measurable} from './base.js';\r\nimport {Types} from './types.js';\r\n\r\n/**\r\n * An object containing information about the space a hat takes up during\r\n * rendering.\r\n */\r\nexport class Hat extends Measurable {\r\n  ascenderHeight: number;\r\n\r\n  /**\r\n   * @param constants The rendering constants provider.\r\n   */\r\n  constructor(constants: ConstantProvider) {\r\n    super(constants);\r\n    this.type |= Types.HAT;\r\n\r\n    this.height = this.constants_.START_HAT.height;\r\n    this.width = this.constants_.START_HAT.width;\r\n\r\n    this.ascenderHeight = this.height;\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.blockRendering.Icon\r\n\r\n/* eslint-disable-next-line no-unused-vars */\r\nimport type {IIcon as BlocklyIcon} from '../../interfaces/i_icon.js';\r\nimport type {ConstantProvider} from '../common/constants.js';\r\n\r\nimport {Measurable} from './base.js';\r\nimport {Types} from './types.js';\r\nimport {hasBubble} from '../../interfaces/i_has_bubble.js';\r\n\r\n/**\r\n * An object containing information about the space an icon takes up during\r\n * rendering.\r\n */\r\nexport class Icon extends Measurable {\r\n  /**\r\n   * @deprecated Will be removed in v11. Create a subclass of the Icon\r\n   *     measurable if this data is necessary for you.\r\n   */\r\n  isVisible: boolean;\r\n  flipRtl = false;\r\n\r\n  /**\r\n   * An object containing information about the space an icon takes up during\r\n   * rendering.\r\n   *\r\n   * @param constants The rendering constants provider.\r\n   * @param icon The icon to measure and store information for.\r\n   */\r\n  constructor(\r\n    constants: ConstantProvider,\r\n    public icon: BlocklyIcon,\r\n  ) {\r\n    super(constants);\r\n\r\n    this.isVisible = hasBubble(icon) && icon.bubbleIsVisible();\r\n    this.type |= Types.ICON;\r\n\r\n    const size = icon.getSize();\r\n    this.height = size.height;\r\n    this.width = size.width;\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.blockRendering.InRowSpacer\r\n\r\nimport type {ConstantProvider} from '../common/constants.js';\r\n\r\nimport {Measurable} from './base.js';\r\nimport {Types} from './types.js';\r\n\r\n/**\r\n * An object containing information about a spacer between two elements on a\r\n * row.\r\n */\r\nexport class InRowSpacer extends Measurable {\r\n  /**\r\n   * @param constants The rendering constants provider.\r\n   * @param width The width of the spacer.\r\n   */\r\n  constructor(constants: ConstantProvider, width: number) {\r\n    super(constants);\r\n    this.type |= Types.SPACER | Types.IN_ROW_SPACER;\r\n    this.width = width;\r\n    this.height = this.constants_.SPACER_DEFAULT_HEIGHT;\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.blockRendering.InlineInput\r\n\r\n/* eslint-disable-next-line no-unused-vars */\r\nimport type {Input} from '../../inputs/input.js';\r\nimport type {ConstantProvider} from '../common/constants.js';\r\n\r\nimport {InputConnection} from './input_connection.js';\r\nimport {Types} from './types.js';\r\n\r\n/**\r\n * An object containing information about the space an inline input takes up\r\n * during rendering.\r\n */\r\nexport class InlineInput extends InputConnection {\r\n  connectionHeight: number;\r\n  connectionWidth: number;\r\n\r\n  /**\r\n   * @param constants The rendering constants provider.\r\n   * @param input The inline input to measure and store information for.\r\n   */\r\n  constructor(constants: ConstantProvider, input: Input) {\r\n    super(constants, input);\r\n    this.type |= Types.INLINE_INPUT;\r\n\r\n    if (!this.connectedBlock) {\r\n      this.height = this.constants_.EMPTY_INLINE_INPUT_HEIGHT;\r\n      this.width = this.constants_.EMPTY_INLINE_INPUT_PADDING;\r\n    } else {\r\n      // We allow the dark path to show on the parent block so that the child\r\n      // block looks embossed.  This takes up an extra pixel in both x and y.\r\n      this.width = this.connectedBlockWidth;\r\n      this.height = this.connectedBlockHeight;\r\n    }\r\n\r\n    this.connectionHeight = !this.isDynamicShape\r\n      ? (this.shape.height as number)\r\n      : (this.shape.height as (p1: number) => number)(this.height);\r\n\r\n    this.connectionWidth = !this.isDynamicShape\r\n      ? (this.shape.width as number)\r\n      : (this.shape.width as (p1: number) => number)(this.height);\r\n    if (!this.connectedBlock) {\r\n      this.width += this.connectionWidth * (this.isDynamicShape ? 2 : 1);\r\n    }\r\n\r\n    this.connectionOffsetY =\r\n      'connectionOffsetY' in this.shape\r\n        ? this.shape.connectionOffsetY(this.connectionHeight)\r\n        : this.constants_.TAB_OFFSET_FROM_TOP;\r\n\r\n    this.connectionOffsetX =\r\n      'connectionOffsetX' in this.shape\r\n        ? this.shape.connectionOffsetX(this.connectionWidth)\r\n        : 0;\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.blockRendering.StatementInput\r\n\r\n/* eslint-disable-next-line no-unused-vars */\r\nimport type {Input} from '../../inputs/input.js';\r\nimport type {ConstantProvider} from '../common/constants.js';\r\n\r\nimport {InputConnection} from './input_connection.js';\r\nimport {Types} from './types.js';\r\n\r\n/**\r\n * An object containing information about the space a statement input takes up\r\n * during rendering\r\n */\r\nexport class StatementInput extends InputConnection {\r\n  /**\r\n   * @param constants The rendering constants provider.\r\n   * @param input The statement input to measure and store information for.\r\n   */\r\n  constructor(constants: ConstantProvider, input: Input) {\r\n    super(constants, input);\r\n    this.type |= Types.STATEMENT_INPUT;\r\n\r\n    if (!this.connectedBlock) {\r\n      this.height = this.constants_.EMPTY_STATEMENT_INPUT_HEIGHT;\r\n    } else {\r\n      // We allow the dark path to show on the parent block so that the child\r\n      // block looks embossed.  This takes up an extra pixel in both x and y.\r\n      this.height =\r\n        this.connectedBlockHeight + this.constants_.STATEMENT_BOTTOM_SPACER;\r\n    }\r\n    this.width =\r\n      this.constants_.STATEMENT_INPUT_NOTCH_OFFSET +\r\n      (this.shape.width as number);\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.blockRendering.InputRow\r\n\r\nimport type {ConstantProvider} from '../common/constants.js';\r\n\r\nimport {ExternalValueInput} from './external_value_input.js';\r\nimport {InputConnection} from './input_connection.js';\r\nimport {Row} from './row.js';\r\nimport {StatementInput} from './statement_input.js';\r\nimport {Types} from './types.js';\r\n\r\n/**\r\n * An object containing information about a row that holds one or more inputs.\r\n */\r\nexport class InputRow extends Row {\r\n  /**\r\n   * The total width of all blocks connected to this row.\r\n   */\r\n  connectedBlockWidths = 0;\r\n\r\n  /**\r\n   * @param constants The rendering constants provider.\r\n   */\r\n  constructor(constants: ConstantProvider) {\r\n    super(constants);\r\n    this.type |= Types.INPUT_ROW;\r\n  }\r\n\r\n  /**\r\n   * Inspect all subcomponents and populate all size properties on the row.\r\n   */\r\n  override measure() {\r\n    this.width = this.minWidth;\r\n    this.height = this.minHeight;\r\n    let connectedBlockWidths = 0;\r\n    for (let i = 0; i < this.elements.length; i++) {\r\n      const elem = this.elements[i];\r\n      this.width += elem.width;\r\n      if (Types.isInput(elem) && elem instanceof InputConnection) {\r\n        if (Types.isStatementInput(elem) && elem instanceof StatementInput) {\r\n          connectedBlockWidths += elem.connectedBlockWidth;\r\n        } else if (\r\n          Types.isExternalInput(elem) &&\r\n          elem instanceof ExternalValueInput &&\r\n          elem.connectedBlockWidth !== 0\r\n        ) {\r\n          connectedBlockWidths +=\r\n            elem.connectedBlockWidth - elem.connectionWidth;\r\n        }\r\n      }\r\n      if (!Types.isSpacer(elem)) {\r\n        this.height = Math.max(this.height, elem.height);\r\n      }\r\n    }\r\n    this.connectedBlockWidths = connectedBlockWidths;\r\n    this.widthWithConnectedBlocks = this.width + connectedBlockWidths;\r\n  }\r\n\r\n  override endsWithElemSpacer() {\r\n    return !this.hasExternalInput && !this.hasStatement;\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.blockRendering.JaggedEdge\r\n\r\nimport type {ConstantProvider} from '../common/constants.js';\r\n\r\nimport {Measurable} from './base.js';\r\nimport {Types} from './types.js';\r\n\r\n/**\r\n * An object containing information about the space the jagged edge of a\r\n * collapsed block takes up during rendering.\r\n */\r\nexport class JaggedEdge extends Measurable {\r\n  /**\r\n   * @param constants The rendering constants provider.\r\n   */\r\n  constructor(constants: ConstantProvider) {\r\n    super(constants);\r\n    this.type |= Types.JAGGED_EDGE;\r\n    this.height = this.constants_.JAGGED_TEETH.height;\r\n    this.width = this.constants_.JAGGED_TEETH.width;\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.blockRendering.NextConnection\r\n\r\nimport type {RenderedConnection} from '../../rendered_connection.js';\r\nimport type {ConstantProvider} from '../common/constants.js';\r\n\r\nimport {Connection} from './connection.js';\r\nimport {Types} from './types.js';\r\n\r\n/**\r\n * An object containing information about the space a next connection takes\r\n * up during rendering.\r\n */\r\nexport class NextConnection extends Connection {\r\n  /**\r\n   * @param constants The rendering constants provider.\r\n   * @param connectionModel The connection object on the block that this\r\n   *     represents.\r\n   */\r\n  constructor(\r\n    constants: ConstantProvider,\r\n    connectionModel: RenderedConnection,\r\n  ) {\r\n    super(constants, connectionModel);\r\n    this.type |= Types.NEXT_CONNECTION;\r\n    this.height = this.shape.height as number;\r\n    this.width = this.shape.width as number;\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.blockRendering.OutputConnection\r\n\r\nimport type {RenderedConnection} from '../../rendered_connection.js';\r\nimport type {ConstantProvider} from '../common/constants.js';\r\n\r\nimport {Connection} from './connection.js';\r\nimport {Types} from './types.js';\r\n\r\n/**\r\n * An object containing information about the space an output connection takes\r\n * up during rendering.\r\n */\r\nexport class OutputConnection extends Connection {\r\n  startX: number;\r\n  connectionOffsetY: number;\r\n  connectionOffsetX = 0;\r\n\r\n  /**\r\n   * @param constants The rendering constants provider.\r\n   * @param connectionModel The connection object on the block that this\r\n   *     represents.\r\n   */\r\n  constructor(\r\n    constants: ConstantProvider,\r\n    connectionModel: RenderedConnection,\r\n  ) {\r\n    super(constants, connectionModel);\r\n    this.type |= Types.OUTPUT_CONNECTION;\r\n\r\n    this.height = !this.isDynamicShape ? (this.shape.height as number) : 0;\r\n    this.width = !this.isDynamicShape ? (this.shape.width as number) : 0;\r\n\r\n    this.startX = this.width;\r\n\r\n    this.connectionOffsetY = this.constants_.TAB_OFFSET_FROM_TOP;\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.blockRendering.PreviousConnection\r\n\r\nimport type {RenderedConnection} from '../../rendered_connection.js';\r\nimport type {ConstantProvider} from '../common/constants.js';\r\n\r\nimport {Connection} from './connection.js';\r\nimport {Types} from './types.js';\r\n\r\n/**\r\n * An object containing information about the space a previous connection takes\r\n * up during rendering.\r\n */\r\nexport class PreviousConnection extends Connection {\r\n  /**\r\n   * @param constants The rendering constants provider.\r\n   * @param connectionModel The connection object on the block that this\r\n   *     represents.\r\n   */\r\n  constructor(\r\n    constants: ConstantProvider,\r\n    connectionModel: RenderedConnection,\r\n  ) {\r\n    super(constants, connectionModel);\r\n    this.type |= Types.PREVIOUS_CONNECTION;\r\n    this.height = this.shape.height as number;\r\n    this.width = this.shape.width as number;\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.blockRendering.RoundCorner\r\n\r\nimport type {ConstantProvider} from '../common/constants.js';\r\n\r\nimport {Measurable} from './base.js';\r\nimport {Types} from './types.js';\r\n\r\n/**\r\n * An object containing information about the space a rounded corner takes up\r\n * during rendering.\r\n */\r\nexport class RoundCorner extends Measurable {\r\n  /**\r\n   * @param constants The rendering constants provider.\r\n   * @param opt_position The position of this corner.\r\n   */\r\n  constructor(constants: ConstantProvider, opt_position?: string) {\r\n    super(constants);\r\n    this.type =\r\n      (!opt_position || opt_position === 'left'\r\n        ? Types.LEFT_ROUND_CORNER\r\n        : Types.RIGHT_ROUND_CORNER) | Types.CORNER;\r\n    this.width = this.constants_.CORNER_RADIUS;\r\n    // The rounded corner extends into the next row by 4 so we only take the\r\n    // height that is aligned with this row.\r\n    this.height = this.constants_.CORNER_RADIUS / 2;\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.blockRendering.SpacerRow\r\n\r\nimport type {ConstantProvider} from '../common/constants.js';\r\n\r\nimport {InRowSpacer} from './in_row_spacer.js';\r\nimport {Row} from './row.js';\r\nimport {Types} from './types.js';\r\n\r\n/**\r\n * An object containing information about a spacer between two rows.\r\n */\r\nexport class SpacerRow extends Row {\r\n  followsStatement = false;\r\n\r\n  precedesStatement = false;\r\n\r\n  override widthWithConnectedBlocks = 0;\r\n  override elements: InRowSpacer[];\r\n\r\n  /**\r\n   * @param constants The rendering constants provider.\r\n   * @param height The height of the spacer.\r\n   * @param width The width of the spacer.\r\n   */\r\n  constructor(\r\n    constants: ConstantProvider,\r\n    public override height: number,\r\n    public override width: number,\r\n  ) {\r\n    super(constants);\r\n    this.type |= Types.SPACER | Types.BETWEEN_ROW_SPACER;\r\n\r\n    this.elements = [new InRowSpacer(this.constants_, width)];\r\n  }\r\n\r\n  override measure() {}\r\n}\r\n// NOP.  Width and height were set at creation.\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.blockRendering.SquareCorner\r\n\r\nimport type {ConstantProvider} from '../common/constants.js';\r\n\r\nimport {Measurable} from './base.js';\r\nimport {Types} from './types.js';\r\n\r\n/**\r\n * An object containing information about the space a square corner takes up\r\n * during rendering.\r\n */\r\nexport class SquareCorner extends Measurable {\r\n  /**\r\n   * @param constants The rendering constants provider.\r\n   * @param opt_position The position of this corner.\r\n   */\r\n  constructor(constants: ConstantProvider, opt_position?: string) {\r\n    super(constants);\r\n    this.type =\r\n      (!opt_position || opt_position === 'left'\r\n        ? Types.LEFT_SQUARE_CORNER\r\n        : Types.RIGHT_SQUARE_CORNER) | Types.CORNER;\r\n    this.height = this.constants_.NO_PADDING;\r\n    this.width = this.constants_.NO_PADDING;\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.blockRendering.TopRow\r\n\r\nimport type {BlockSvg} from '../../block_svg.js';\r\nimport type {ConstantProvider} from '../common/constants.js';\r\n\r\nimport {Hat} from './hat.js';\r\nimport type {PreviousConnection} from './previous_connection.js';\r\nimport {Row} from './row.js';\r\nimport {Types} from './types.js';\r\n\r\n/**\r\n * An object containing information about what elements are in the top row of a\r\n * block as well as sizing information for the top row.\r\n * Elements in a top row can consist of corners, hats, spacers, and previous\r\n * connections.\r\n * After this constructor is called, the row will contain all non-spacer\r\n * elements it needs.\r\n */\r\nexport class TopRow extends Row {\r\n  /**\r\n   * The starting point for drawing the row, in the y direction.\r\n   * This allows us to draw hats and similar shapes that don't start at the\r\n   * origin. Must be non-negative (see #2820).\r\n   */\r\n  capline = 0;\r\n\r\n  /** How much the row extends up above its capline. */\r\n  ascenderHeight = 0;\r\n\r\n  /** Whether the block has a previous connection. */\r\n  hasPreviousConnection = false;\r\n\r\n  /** The previous connection on the block, if any. */\r\n  connection: PreviousConnection | null = null;\r\n\r\n  /**\r\n   * @param constants The rendering constants provider.\r\n   */\r\n  constructor(constants: ConstantProvider) {\r\n    super(constants);\r\n\r\n    this.type |= Types.TOP_ROW;\r\n  }\r\n\r\n  /**\r\n   * Returns whether or not the top row has a left square corner.\r\n   *\r\n   * @param block The block whose top row this represents.\r\n   * @returns Whether or not the top row has a left square corner.\r\n   */\r\n  hasLeftSquareCorner(block: BlockSvg): boolean {\r\n    const hasHat =\r\n      (block.hat ? block.hat === 'cap' : this.constants_.ADD_START_HATS) &&\r\n      !block.outputConnection &&\r\n      !block.previousConnection;\r\n    const prevBlock = block.getPreviousBlock();\r\n\r\n    return (\r\n      !!block.outputConnection ||\r\n      hasHat ||\r\n      (prevBlock ? prevBlock.getNextBlock() === block : false)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Returns whether or not the top row has a right square corner.\r\n   *\r\n   * @param _block The block whose top row this represents.\r\n   * @returns Whether or not the top row has a right square corner.\r\n   */\r\n  hasRightSquareCorner(_block: BlockSvg): boolean {\r\n    return true;\r\n  }\r\n\r\n  override measure() {\r\n    let height = 0;\r\n    let width = 0;\r\n    let ascenderHeight = 0;\r\n    for (let i = 0; i < this.elements.length; i++) {\r\n      const elem = this.elements[i];\r\n      width += elem.width;\r\n      if (!Types.isSpacer(elem)) {\r\n        if (Types.isHat(elem) && elem instanceof Hat) {\r\n          ascenderHeight = Math.max(ascenderHeight, elem.ascenderHeight);\r\n        } else {\r\n          height = Math.max(height, elem.height);\r\n        }\r\n      }\r\n    }\r\n    this.width = Math.max(this.minWidth, width);\r\n    this.height = Math.max(this.minHeight, height) + ascenderHeight;\r\n    this.ascenderHeight = ascenderHeight;\r\n    this.capline = this.ascenderHeight;\r\n    this.widthWithConnectedBlocks = this.width;\r\n  }\r\n\r\n  override startsWithElemSpacer() {\r\n    return false;\r\n  }\r\n\r\n  override endsWithElemSpacer() {\r\n    return false;\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.blockRendering.Drawer\r\n\r\nimport type {BlockSvg} from '../../block_svg.js';\r\nimport {Coordinate} from '../../utils.js';\r\nimport * as svgPaths from '../../utils/svg_paths.js';\r\nimport {Connection} from '../measurables/connection.js';\r\nimport type {ExternalValueInput} from '../measurables/external_value_input.js';\r\nimport type {Field} from '../measurables/field.js';\r\nimport type {Icon} from '../measurables/icon.js';\r\nimport type {InlineInput} from '../measurables/inline_input.js';\r\nimport type {PreviousConnection} from '../measurables/previous_connection.js';\r\nimport type {Row} from '../measurables/row.js';\r\nimport {Types} from '../measurables/types.js';\r\n\r\nimport {isDynamicShape, isNotch, isPuzzleTab} from './constants.js';\r\nimport type {ConstantProvider, Notch, PuzzleTab} from './constants.js';\r\nimport type {RenderInfo} from './info.js';\r\nimport * as deprecation from '../../utils/deprecation.js';\r\nimport {ConnectionType} from '../../connection_type.js';\r\n\r\n/**\r\n * An object that draws a block based on the given rendering information.\r\n */\r\nexport class Drawer {\r\n  block_: BlockSvg;\r\n  info_: RenderInfo;\r\n  topLeft_: Coordinate;\r\n  outlinePath_ = '';\r\n  inlinePath_ = '';\r\n  protected constants_: ConstantProvider;\r\n\r\n  /**\r\n   * @param block The block to render.\r\n   * @param info An object containing all information needed to render this\r\n   *     block.\r\n   */\r\n  constructor(block: BlockSvg, info: RenderInfo) {\r\n    this.block_ = block;\r\n    this.info_ = info;\r\n    this.topLeft_ = block.getRelativeToSurfaceXY();\r\n\r\n    /** The renderer's constant provider. */\r\n    this.constants_ = info.getRenderer().getConstants();\r\n  }\r\n\r\n  /**\r\n   * Draw the block to the workspace. Here \"drawing\" means setting SVG path\r\n   * elements and moving fields, icons, and connections on the screen.\r\n   *\r\n   * The pieces of the paths are pushed into arrays of \"steps\", which are then\r\n   * joined with spaces and set directly on the block.  This guarantees that\r\n   * the steps are separated by spaces for improved readability, but isn't\r\n   * required.\r\n   */\r\n  draw() {\r\n    this.drawOutline_();\r\n    this.drawInternals_();\r\n    this.updateConnectionHighlights();\r\n\r\n    this.block_.pathObject.setPath(this.outlinePath_ + '\\n' + this.inlinePath_);\r\n    if (this.info_.RTL) {\r\n      this.block_.pathObject.flipRTL();\r\n    }\r\n    this.recordSizeOnBlock_();\r\n  }\r\n\r\n  /**\r\n   * Hide icons that were marked as hidden.\r\n   *\r\n   * @deprecated Manually hiding icons is no longer necessary. To be removed\r\n   *     in v11.\r\n   */\r\n  protected hideHiddenIcons_() {\r\n    deprecation.warn('hideHiddenIcons_', 'v10', 'v11');\r\n  }\r\n\r\n  /**\r\n   * Save sizing information back to the block\r\n   * Most of the rendering information can be thrown away at the end of the\r\n   * render. Anything that needs to be kept around should be set in this\r\n   * function.\r\n   */\r\n  protected recordSizeOnBlock_() {\r\n    // This is used when the block is reporting its size to anyone else.\r\n    // The dark path adds to the size of the block in both X and Y.\r\n    this.block_.height = this.info_.height;\r\n    this.block_.width = this.info_.widthWithChildren;\r\n  }\r\n\r\n  /** Create the outline of the block.  This is a single continuous path. */\r\n  protected drawOutline_() {\r\n    this.drawTop_();\r\n    for (let r = 1; r < this.info_.rows.length - 1; r++) {\r\n      const row = this.info_.rows[r];\r\n      if (row.hasJaggedEdge) {\r\n        this.drawJaggedEdge_(row);\r\n      } else if (row.hasStatement) {\r\n        this.drawStatementInput_(row);\r\n      } else if (row.hasExternalInput) {\r\n        this.drawValueInput_(row);\r\n      } else {\r\n        this.drawRightSideRow_(row);\r\n      }\r\n    }\r\n    this.drawBottom_();\r\n    this.drawLeft_();\r\n  }\r\n\r\n  /**\r\n   * Add steps for the top corner of the block, taking into account\r\n   * details such as hats and rounded corners.\r\n   */\r\n  protected drawTop_() {\r\n    const topRow = this.info_.topRow;\r\n    const elements = topRow.elements;\r\n\r\n    this.positionPreviousConnection_();\r\n    this.outlinePath_ += svgPaths.moveBy(topRow.xPos, this.info_.startY);\r\n    for (let i = 0, elem; (elem = elements[i]); i++) {\r\n      if (Types.isLeftRoundedCorner(elem)) {\r\n        this.outlinePath_ += this.constants_.OUTSIDE_CORNERS.topLeft;\r\n      } else if (Types.isRightRoundedCorner(elem)) {\r\n        this.outlinePath_ += this.constants_.OUTSIDE_CORNERS.topRight;\r\n      } else if (\r\n        Types.isPreviousConnection(elem) &&\r\n        elem instanceof Connection\r\n      ) {\r\n        this.outlinePath_ += (\r\n          (elem as PreviousConnection).shape as Notch\r\n        ).pathLeft;\r\n      } else if (Types.isHat(elem)) {\r\n        this.outlinePath_ += this.constants_.START_HAT.path;\r\n      } else if (Types.isSpacer(elem)) {\r\n        this.outlinePath_ += svgPaths.lineOnAxis('h', elem.width);\r\n      }\r\n    }\r\n    // No branch for a square corner, because it's a no-op.\r\n    this.outlinePath_ += svgPaths.lineOnAxis('v', topRow.height);\r\n  }\r\n\r\n  /**\r\n   * Add steps for the jagged edge of a row on a collapsed block.\r\n   *\r\n   * @param row The row to draw the side of.\r\n   */\r\n  protected drawJaggedEdge_(row: Row) {\r\n    const remainder = row.height - this.constants_.JAGGED_TEETH.height;\r\n    this.outlinePath_ +=\r\n      this.constants_.JAGGED_TEETH.path + svgPaths.lineOnAxis('v', remainder);\r\n  }\r\n\r\n  /**\r\n   * Add steps for an external value input, rendered as a notch in the side\r\n   * of the block.\r\n   *\r\n   * @param row The row that this input belongs to.\r\n   */\r\n  protected drawValueInput_(row: Row) {\r\n    const input = row.getLastInput() as ExternalValueInput | InlineInput;\r\n    this.positionExternalValueConnection_(row);\r\n\r\n    const pathDown = isDynamicShape(input.shape)\r\n      ? input.shape.pathDown(input.height)\r\n      : (input.shape as PuzzleTab).pathDown;\r\n\r\n    this.outlinePath_ +=\r\n      svgPaths.lineOnAxis('H', input.xPos + input.width) +\r\n      pathDown +\r\n      svgPaths.lineOnAxis('v', row.height - input.connectionHeight);\r\n  }\r\n\r\n  /**\r\n   * Add steps for a statement input.\r\n   *\r\n   * @param row The row that this input belongs to.\r\n   */\r\n  protected drawStatementInput_(row: Row) {\r\n    const input = row.getLastInput();\r\n    if (!input) return;\r\n    // Where to start drawing the notch, which is on the right side in LTR.\r\n    const x = input.xPos + input.notchOffset + (input.shape as Notch).width;\r\n\r\n    const innerTopLeftCorner =\r\n      (input.shape as Notch).pathRight +\r\n      svgPaths.lineOnAxis(\r\n        'h',\r\n        -(input.notchOffset - this.constants_.INSIDE_CORNERS.width),\r\n      ) +\r\n      this.constants_.INSIDE_CORNERS.pathTop;\r\n\r\n    const innerHeight = row.height - 2 * this.constants_.INSIDE_CORNERS.height;\r\n\r\n    this.outlinePath_ +=\r\n      svgPaths.lineOnAxis('H', x) +\r\n      innerTopLeftCorner +\r\n      svgPaths.lineOnAxis('v', innerHeight) +\r\n      this.constants_.INSIDE_CORNERS.pathBottom +\r\n      svgPaths.lineOnAxis('H', row.xPos + row.width);\r\n\r\n    this.positionStatementInputConnection_(row);\r\n  }\r\n\r\n  /**\r\n   * Add steps for the right side of a row that does not have value or\r\n   * statement input connections.\r\n   *\r\n   * @param row The row to draw the side of.\r\n   */\r\n  protected drawRightSideRow_(row: Row) {\r\n    this.outlinePath_ += svgPaths.lineOnAxis('V', row.yPos + row.height);\r\n  }\r\n\r\n  /**\r\n   * Add steps for the bottom edge of a block, possibly including a notch\r\n   * for the next connection.\r\n   */\r\n  protected drawBottom_() {\r\n    const bottomRow = this.info_.bottomRow;\r\n    const elems = bottomRow.elements;\r\n    this.positionNextConnection_();\r\n\r\n    let rightCornerYOffset = 0;\r\n    let outlinePath = '';\r\n    for (let i = elems.length - 1, elem; (elem = elems[i]); i--) {\r\n      if (Types.isNextConnection(elem) && elem instanceof Connection) {\r\n        outlinePath += (elem.shape as Notch).pathRight;\r\n      } else if (Types.isLeftSquareCorner(elem)) {\r\n        outlinePath += svgPaths.lineOnAxis('H', bottomRow.xPos);\r\n      } else if (Types.isLeftRoundedCorner(elem)) {\r\n        outlinePath += this.constants_.OUTSIDE_CORNERS.bottomLeft;\r\n      } else if (Types.isRightRoundedCorner(elem)) {\r\n        outlinePath += this.constants_.OUTSIDE_CORNERS.bottomRight;\r\n        rightCornerYOffset = this.constants_.OUTSIDE_CORNERS.rightHeight;\r\n      } else if (Types.isSpacer(elem)) {\r\n        outlinePath += svgPaths.lineOnAxis('h', elem.width * -1);\r\n      }\r\n    }\r\n\r\n    this.outlinePath_ += svgPaths.lineOnAxis(\r\n      'V',\r\n      bottomRow.baseline - rightCornerYOffset,\r\n    );\r\n    this.outlinePath_ += outlinePath;\r\n  }\r\n\r\n  /**\r\n   * Add steps for the left side of the block, which may include an output\r\n   * connection\r\n   */\r\n  protected drawLeft_() {\r\n    const outputConnection = this.info_.outputConnection;\r\n    this.positionOutputConnection_();\r\n\r\n    if (outputConnection) {\r\n      const tabBottom =\r\n        outputConnection.connectionOffsetY + outputConnection.height;\r\n      const pathUp = isDynamicShape(outputConnection.shape)\r\n        ? outputConnection.shape.pathUp(outputConnection.height)\r\n        : (outputConnection.shape as PuzzleTab).pathUp;\r\n\r\n      // Draw a line up to the bottom of the tab.\r\n      this.outlinePath_ += svgPaths.lineOnAxis('V', tabBottom) + pathUp;\r\n    }\r\n    // Close off the path.  This draws a vertical line up to the start of the\r\n    // block's path, which may be either a rounded or a sharp corner.\r\n    this.outlinePath_ += 'z';\r\n  }\r\n\r\n  /**\r\n   * Draw the internals of the block: inline inputs, fields, and icons.  These\r\n   * do not depend on the outer path for placement.\r\n   */\r\n  protected drawInternals_() {\r\n    for (let i = 0, row; (row = this.info_.rows[i]); i++) {\r\n      for (let j = 0, elem; (elem = row.elements[j]); j++) {\r\n        if (Types.isInlineInput(elem)) {\r\n          this.drawInlineInput_(elem as InlineInput);\r\n        } else if (Types.isIcon(elem) || Types.isField(elem)) {\r\n          this.layoutField_(elem as Field | Icon);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Push a field or icon's new position to its SVG root.\r\n   *\r\n   * @param fieldInfo The rendering information for the field or icon.\r\n   */\r\n  protected layoutField_(fieldInfo: Icon | Field) {\r\n    const yPos = fieldInfo.centerline - fieldInfo.height / 2;\r\n    let xPos = fieldInfo.xPos;\r\n    let scale = '';\r\n    if (this.info_.RTL) {\r\n      xPos = -(xPos + fieldInfo.width);\r\n      if (fieldInfo.flipRtl) {\r\n        xPos += fieldInfo.width;\r\n        scale = 'scale(-1 1)';\r\n      }\r\n    }\r\n\r\n    if (Types.isIcon(fieldInfo)) {\r\n      const icon = (fieldInfo as Icon).icon;\r\n      icon.setOffsetInBlock(new Coordinate(xPos, yPos));\r\n      if (this.info_.isInsertionMarker) {\r\n        icon.hideForInsertionMarker();\r\n      }\r\n    } else {\r\n      const svgGroup = (fieldInfo as Field).field.getSvgRoot()!;\r\n      svgGroup.setAttribute(\r\n        'transform',\r\n        'translate(' + xPos + ',' + yPos + ')' + scale,\r\n      );\r\n      if (this.info_.isInsertionMarker) {\r\n        svgGroup.setAttribute('display', 'none');\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add steps for an inline input.\r\n   *\r\n   * @param input The information about the input to render.\r\n   */\r\n  protected drawInlineInput_(input: InlineInput) {\r\n    const width = input.width;\r\n    const height = input.height;\r\n    const yPos = input.centerline - height / 2;\r\n\r\n    const connectionTop = input.connectionOffsetY;\r\n    const connectionBottom = input.connectionHeight + connectionTop;\r\n    const connectionRight = input.xPos + input.connectionWidth;\r\n\r\n    this.inlinePath_ +=\r\n      svgPaths.moveTo(connectionRight, yPos) +\r\n      svgPaths.lineOnAxis('v', connectionTop) +\r\n      (input.shape as PuzzleTab).pathDown +\r\n      svgPaths.lineOnAxis('v', height - connectionBottom) +\r\n      svgPaths.lineOnAxis('h', width - input.connectionWidth) +\r\n      svgPaths.lineOnAxis('v', -height) +\r\n      'z';\r\n\r\n    this.positionInlineInputConnection_(input);\r\n  }\r\n\r\n  /**\r\n   * Position the connection on an inline value input, taking into account\r\n   * RTL and the small gap between the parent block and child block which lets\r\n   * the parent block's dark path show through.\r\n   *\r\n   * @param input The information about the input that the connection is on.\r\n   */\r\n  protected positionInlineInputConnection_(input: InlineInput) {\r\n    const yPos = input.centerline - input.height / 2;\r\n    // Move the connection.\r\n    if (input.connectionModel) {\r\n      // xPos already contains info about startX\r\n      let connX = input.xPos + input.connectionWidth + input.connectionOffsetX;\r\n      if (this.info_.RTL) {\r\n        connX *= -1;\r\n      }\r\n      input.connectionModel.setOffsetInBlock(\r\n        connX,\r\n        yPos + input.connectionOffsetY,\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Position the connection on a statement input, taking into account\r\n   * RTL and the small gap between the parent block and child block which lets\r\n   * the parent block's dark path show through.\r\n   *\r\n   * @param row The row that the connection is on.\r\n   */\r\n  protected positionStatementInputConnection_(row: Row) {\r\n    const input = row.getLastInput();\r\n    if (input?.connectionModel) {\r\n      let connX = row.xPos + row.statementEdge + input.notchOffset;\r\n      if (this.info_.RTL) {\r\n        connX *= -1;\r\n      }\r\n      input.connectionModel.setOffsetInBlock(connX, row.yPos);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Position the connection on an external value input, taking into account\r\n   * RTL and the small gap between the parent block and child block which lets\r\n   * the parent block's dark path show through.\r\n   *\r\n   * @param row The row that the connection is on.\r\n   */\r\n  protected positionExternalValueConnection_(row: Row) {\r\n    const input = row.getLastInput();\r\n    if (input && input.connectionModel) {\r\n      let connX = row.xPos + row.width;\r\n      if (this.info_.RTL) {\r\n        connX *= -1;\r\n      }\r\n      input.connectionModel.setOffsetInBlock(connX, row.yPos);\r\n    }\r\n  }\r\n\r\n  /** Position the previous connection on a block. */\r\n  protected positionPreviousConnection_() {\r\n    const topRow = this.info_.topRow;\r\n    if (topRow.connection) {\r\n      const x = topRow.xPos + topRow.notchOffset;\r\n      const connX = this.info_.RTL ? -x : x;\r\n      topRow.connection.connectionModel.setOffsetInBlock(connX, 0);\r\n    }\r\n  }\r\n\r\n  /** Position the next connection on a block. */\r\n  protected positionNextConnection_() {\r\n    const bottomRow = this.info_.bottomRow;\r\n\r\n    if (bottomRow.connection) {\r\n      const connInfo = bottomRow.connection;\r\n      const x = connInfo.xPos; // Already contains info about startX.\r\n      const connX = this.info_.RTL ? -x : x;\r\n      connInfo.connectionModel.setOffsetInBlock(connX, bottomRow.baseline);\r\n    }\r\n  }\r\n\r\n  /** Position the output connection on a block. */\r\n  protected positionOutputConnection_() {\r\n    if (this.info_.outputConnection) {\r\n      const x =\r\n        this.info_.startX + this.info_.outputConnection.connectionOffsetX;\r\n      const connX = this.info_.RTL ? -x : x;\r\n      this.block_.outputConnection.setOffsetInBlock(\r\n        connX,\r\n        this.info_.outputConnection.connectionOffsetY,\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Updates the path object to reflect which connections on the block are\r\n   * highlighted.\r\n   */\r\n  protected updateConnectionHighlights() {\r\n    for (const row of this.info_.rows) {\r\n      for (const elem of row.elements) {\r\n        if (!(elem instanceof Connection)) continue;\r\n\r\n        if (elem.highlighted) {\r\n          this.drawConnectionHighlightPath(elem);\r\n        } else {\r\n          this.block_.pathObject.removeConnectionHighlight?.(\r\n            elem.connectionModel,\r\n          );\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /** Returns a path to highlight the given connection. */\r\n  drawConnectionHighlightPath(measurable: Connection) {\r\n    const conn = measurable.connectionModel;\r\n    let path = '';\r\n    if (\r\n      conn.type === ConnectionType.INPUT_VALUE ||\r\n      conn.type === ConnectionType.OUTPUT_VALUE\r\n    ) {\r\n      path = this.getExpressionConnectionHighlightPath(measurable);\r\n    } else {\r\n      path = this.getStatementConnectionHighlightPath(measurable);\r\n    }\r\n    const block = conn.getSourceBlock();\r\n    block.pathObject.addConnectionHighlight?.(\r\n      conn,\r\n      path,\r\n      conn.getOffsetInBlock(),\r\n      block.RTL,\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Returns a path to highlight the given conneciton, assuming it is an\r\n   * input or output connection.\r\n   */\r\n  private getExpressionConnectionHighlightPath(connection: Connection): string {\r\n    let connPath = '';\r\n    if (isDynamicShape(connection.shape)) {\r\n      connPath = connection.shape.pathDown(connection.height);\r\n    } else if (isPuzzleTab(connection.shape)) {\r\n      connPath = connection.shape.pathDown;\r\n    }\r\n\r\n    // We are assuming that there is room for the tab offset above and below\r\n    // the tab.\r\n    const yLen = this.constants_.TAB_OFFSET_FROM_TOP;\r\n    return (\r\n      svgPaths.moveBy(0, -yLen) +\r\n      svgPaths.lineOnAxis('v', yLen) +\r\n      connPath +\r\n      svgPaths.lineOnAxis('v', yLen)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Returns a path to highlight the given conneciton, assuming it is a\r\n   * next or previous connection.\r\n   */\r\n  private getStatementConnectionHighlightPath(connection: Connection): string {\r\n    if (!isNotch(connection.shape)) {\r\n      throw new Error('Statement connections should have notch shapes');\r\n    }\r\n\r\n    const xLen =\r\n      this.constants_.NOTCH_OFFSET_LEFT - this.constants_.CORNER_RADIUS;\r\n    return (\r\n      svgPaths.moveBy(-xLen, 0) +\r\n      svgPaths.lineOnAxis('h', xLen) +\r\n      connection.shape.pathLeft +\r\n      svgPaths.lineOnAxis('h', xLen)\r\n    );\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2012 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Enum for alignment of inputs.\r\n */\r\nexport enum Align {\r\n  LEFT = -1,\r\n  CENTRE = 0,\r\n  RIGHT = 1,\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2012 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Non-editable, non-serializable text field.  Used for titles,\r\n *    labels, etc.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.FieldLabel\r\n\r\nimport * as dom from './utils/dom.js';\r\nimport {Field, FieldConfig} from './field.js';\r\nimport * as fieldRegistry from './field_registry.js';\r\nimport * as parsing from './utils/parsing.js';\r\n\r\n/**\r\n * Class for a non-editable, non-serializable text field.\r\n */\r\nexport class FieldLabel extends Field<string> {\r\n  /** The HTML class name to use for this field. */\r\n  private class: string | null = null;\r\n\r\n  /**\r\n   * Editable fields usually show some sort of UI indicating they are\r\n   * editable. This field should not.\r\n   */\r\n  override EDITABLE = false;\r\n\r\n  /** Text labels should not truncate. */\r\n  override maxDisplayLength = Infinity;\r\n\r\n  /**\r\n   * @param value The initial value of the field. Should cast to a string.\r\n   *     Defaults to an empty string if null or undefined. Also accepts\r\n   *     Field.SKIP_SETUP if you wish to skip setup (only used by subclasses\r\n   *     that want to handle configuration and setting the field value after\r\n   *     their own constructors have run).\r\n   * @param textClass Optional CSS class for the field's text.\r\n   * @param config A map of options used to configure the field.\r\n   *    See the [field creation documentation]{@link\r\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/label#creation}\r\n   * for a list of properties this parameter supports.\r\n   */\r\n  constructor(\r\n    value?: string | typeof Field.SKIP_SETUP,\r\n    textClass?: string,\r\n    config?: FieldLabelConfig,\r\n  ) {\r\n    super(Field.SKIP_SETUP);\r\n\r\n    if (value === Field.SKIP_SETUP) return;\r\n    if (config) {\r\n      this.configure_(config);\r\n    } else {\r\n      this.class = textClass || null;\r\n    }\r\n    this.setValue(value);\r\n  }\r\n\r\n  protected override configure_(config: FieldLabelConfig) {\r\n    super.configure_(config);\r\n    if (config.class) this.class = config.class;\r\n  }\r\n\r\n  /**\r\n   * Create block UI for this label.\r\n   */\r\n  override initView() {\r\n    this.createTextElement_();\r\n    if (this.class) {\r\n      dom.addClass(this.getTextElement(), this.class);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Ensure that the input value casts to a valid string.\r\n   *\r\n   * @param newValue The input value.\r\n   * @returns A valid string, or null if invalid.\r\n   */\r\n  protected override doClassValidation_(\r\n    newValue?: AnyDuringMigration,\r\n  ): string | null {\r\n    if (newValue === null || newValue === undefined) {\r\n      return null;\r\n    }\r\n    return `${newValue}`;\r\n  }\r\n\r\n  /**\r\n   * Set the CSS class applied to the field's textElement_.\r\n   *\r\n   * @param cssClass The new CSS class name, or null to remove.\r\n   */\r\n  setClass(cssClass: string | null) {\r\n    if (this.textElement_) {\r\n      if (this.class) {\r\n        dom.removeClass(this.textElement_, this.class);\r\n      }\r\n      if (cssClass) {\r\n        dom.addClass(this.textElement_, cssClass);\r\n      }\r\n    }\r\n    this.class = cssClass;\r\n  }\r\n\r\n  /**\r\n   * Construct a FieldLabel from a JSON arg object,\r\n   * dereferencing any string table references.\r\n   *\r\n   * @param options A JSON object with options (text, and class).\r\n   * @returns The new field instance.\r\n   * @nocollapse\r\n   * @internal\r\n   */\r\n  static fromJson(options: FieldLabelFromJsonConfig): FieldLabel {\r\n    const text = parsing.replaceMessageReferences(options.text);\r\n    // `this` might be a subclass of FieldLabel if that class doesn't override\r\n    // the static fromJson method.\r\n    return new this(text, undefined, options);\r\n  }\r\n}\r\n\r\nfieldRegistry.register('field_label', FieldLabel);\r\n\r\nFieldLabel.prototype.DEFAULT_VALUE = '';\r\n\r\n// clang-format off\r\n// Clang does not like the 'class' keyword being used as a property.\r\n/**\r\n * Config options for the label field.\r\n */\r\nexport interface FieldLabelConfig extends FieldConfig {\r\n  class?: string;\r\n}\r\n// clang-format on\r\n\r\n/**\r\n * fromJson config options for the label field.\r\n */\r\nexport interface FieldLabelFromJsonConfig extends FieldLabelConfig {\r\n  text?: string;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2012 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Object representing an input (value, statement, or dummy).\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.Input\r\n\r\n// Unused import preserved for side-effects. Remove if unneeded.\r\nimport '../field_label.js';\r\n\r\nimport type {Block} from '../block.js';\r\nimport type {BlockSvg} from '../block_svg.js';\r\nimport type {Connection} from '../connection.js';\r\nimport type {ConnectionType} from '../connection_type.js';\r\nimport type {Field} from '../field.js';\r\nimport * as fieldRegistry from '../field_registry.js';\r\nimport type {RenderedConnection} from '../rendered_connection.js';\r\nimport {inputTypes} from './input_types.js';\r\n\r\n/** Class for an input with optional fields. */\r\nexport class Input {\r\n  fieldRow: Field[] = [];\r\n  /** Alignment of input's fields (left, right or centre). */\r\n  align = Align.LEFT;\r\n\r\n  /** Is the input visible? */\r\n  private visible = true;\r\n\r\n  public readonly type: inputTypes = inputTypes.CUSTOM;\r\n\r\n  public connection: Connection | null = null;\r\n\r\n  /**\r\n   * @param name Language-neutral identifier which may used to find this input\r\n   *     again.\r\n   * @param sourceBlock The block containing this input.\r\n   */\r\n  constructor(\r\n    public name: string,\r\n    private sourceBlock: Block,\r\n  ) {}\r\n\r\n  /**\r\n   * Get the source block for this input.\r\n   *\r\n   * @returns The block this input is part of.\r\n   */\r\n  getSourceBlock(): Block {\r\n    return this.sourceBlock;\r\n  }\r\n\r\n  /**\r\n   * Add a field (or label from string), and all prefix and suffix fields, to\r\n   * the end of the input's field row.\r\n   *\r\n   * @param field Something to add as a field.\r\n   * @param opt_name Language-neutral identifier which may used to find this\r\n   *     field again.  Should be unique to the host block.\r\n   * @returns The input being append to (to allow chaining).\r\n   */\r\n  appendField<T>(field: string | Field<T>, opt_name?: string): Input {\r\n    this.insertFieldAt(this.fieldRow.length, field, opt_name);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Inserts a field (or label from string), and all prefix and suffix fields,\r\n   * at the location of the input's field row.\r\n   *\r\n   * @param index The index at which to insert field.\r\n   * @param field Something to add as a field.\r\n   * @param opt_name Language-neutral identifier which may used to find this\r\n   *     field again.  Should be unique to the host block.\r\n   * @returns The index following the last inserted field.\r\n   */\r\n  insertFieldAt<T>(\r\n    index: number,\r\n    field: string | Field<T>,\r\n    opt_name?: string,\r\n  ): number {\r\n    if (index < 0 || index > this.fieldRow.length) {\r\n      throw Error('index ' + index + ' out of bounds.');\r\n    }\r\n    // Falsy field values don't generate a field, unless the field is an empty\r\n    // string and named.\r\n    if (!field && !(field === '' && opt_name)) {\r\n      return index;\r\n    }\r\n\r\n    // Generate a FieldLabel when given a plain text field.\r\n    if (typeof field === 'string') {\r\n      field = fieldRegistry.fromJson({\r\n        type: 'field_label',\r\n        text: field,\r\n      })!;\r\n    }\r\n\r\n    field.setSourceBlock(this.sourceBlock);\r\n    if (this.sourceBlock.rendered) {\r\n      field.init();\r\n      field.applyColour();\r\n    }\r\n    field.name = opt_name;\r\n    field.setVisible(this.isVisible());\r\n\r\n    if (field.prefixField) {\r\n      // Add any prefix.\r\n      index = this.insertFieldAt(index, field.prefixField);\r\n    }\r\n    // Add the field to the field row.\r\n    this.fieldRow.splice(index, 0, field as Field);\r\n    index++;\r\n    if (field.suffixField) {\r\n      // Add any suffix.\r\n      index = this.insertFieldAt(index, field.suffixField);\r\n    }\r\n\r\n    if (this.sourceBlock.rendered) {\r\n      (this.sourceBlock as BlockSvg).queueRender();\r\n      // Adding a field will cause the block to change shape.\r\n      this.sourceBlock.bumpNeighbours();\r\n    }\r\n    return index;\r\n  }\r\n\r\n  /**\r\n   * Remove a field from this input.\r\n   *\r\n   * @param name The name of the field.\r\n   * @param opt_quiet True to prevent an error if field is not present.\r\n   * @returns True if operation succeeds, false if field is not present and\r\n   *     opt_quiet is true.\r\n   * @throws {Error} if the field is not present and opt_quiet is false.\r\n   */\r\n  removeField(name: string, opt_quiet?: boolean): boolean {\r\n    for (let i = 0, field; (field = this.fieldRow[i]); i++) {\r\n      if (field.name === name) {\r\n        field.dispose();\r\n        this.fieldRow.splice(i, 1);\r\n        if (this.sourceBlock.rendered) {\r\n          (this.sourceBlock as BlockSvg).queueRender();\r\n          // Removing a field will cause the block to change shape.\r\n          this.sourceBlock.bumpNeighbours();\r\n        }\r\n        return true;\r\n      }\r\n    }\r\n    if (opt_quiet) {\r\n      return false;\r\n    }\r\n    throw Error('Field \"' + name + '\" not found.');\r\n  }\r\n\r\n  /**\r\n   * Gets whether this input is visible or not.\r\n   *\r\n   * @returns True if visible.\r\n   */\r\n  isVisible(): boolean {\r\n    return this.visible;\r\n  }\r\n\r\n  /**\r\n   * Sets whether this input is visible or not.\r\n   * Should only be used to collapse/uncollapse a block.\r\n   *\r\n   * @param visible True if visible.\r\n   * @returns List of blocks to render.\r\n   * @internal\r\n   */\r\n  setVisible(visible: boolean): BlockSvg[] {\r\n    // Note: Currently there are only unit tests for block.setCollapsed()\r\n    // because this function is package. If this function goes back to being a\r\n    // public API tests (lots of tests) should be added.\r\n    let renderList: AnyDuringMigration[] = [];\r\n    if (this.visible === visible) {\r\n      return renderList;\r\n    }\r\n    this.visible = visible;\r\n\r\n    for (let y = 0, field; (field = this.fieldRow[y]); y++) {\r\n      field.setVisible(visible);\r\n    }\r\n    if (this.connection) {\r\n      const renderedConnection = this.connection as RenderedConnection;\r\n      // Has a connection.\r\n      if (visible) {\r\n        renderList = renderedConnection.startTrackingAll();\r\n      } else {\r\n        renderedConnection.stopTrackingAll();\r\n      }\r\n      const child = renderedConnection.targetBlock();\r\n      if (child) {\r\n        child.getSvgRoot().style.display = visible ? 'block' : 'none';\r\n      }\r\n    }\r\n    return renderList;\r\n  }\r\n\r\n  /**\r\n   * Mark all fields on this input as dirty.\r\n   *\r\n   * @internal\r\n   */\r\n  markDirty() {\r\n    for (let y = 0, field; (field = this.fieldRow[y]); y++) {\r\n      field.markDirty();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Change a connection's compatibility.\r\n   *\r\n   * @param check Compatible value type or list of value types.  Null if all\r\n   *     types are compatible.\r\n   * @returns The input being modified (to allow chaining).\r\n   */\r\n  setCheck(check: string | string[] | null): Input {\r\n    if (!this.connection) {\r\n      throw Error('This input does not have a connection.');\r\n    }\r\n    this.connection.setCheck(check);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Change the alignment of the connection's field(s).\r\n   *\r\n   * @param align One of the values of Align.  In RTL mode directions\r\n   *     are reversed, and Align.RIGHT aligns to the left.\r\n   * @returns The input being modified (to allow chaining).\r\n   */\r\n  setAlign(align: Align): Input {\r\n    this.align = align;\r\n    if (this.sourceBlock.rendered) {\r\n      const sourceBlock = this.sourceBlock as BlockSvg;\r\n      sourceBlock.queueRender();\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Changes the connection's shadow block.\r\n   *\r\n   * @param shadow DOM representation of a block or null.\r\n   * @returns The input being modified (to allow chaining).\r\n   */\r\n  setShadowDom(shadow: Element | null): Input {\r\n    if (!this.connection) {\r\n      throw Error('This input does not have a connection.');\r\n    }\r\n    this.connection.setShadowDom(shadow);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Returns the XML representation of the connection's shadow block.\r\n   *\r\n   * @returns Shadow DOM representation of a block or null.\r\n   */\r\n  getShadowDom(): Element | null {\r\n    if (!this.connection) {\r\n      throw Error('This input does not have a connection.');\r\n    }\r\n    return this.connection.getShadowDom();\r\n  }\r\n\r\n  /** Initialize the fields on this input. */\r\n  init() {\r\n    if (!this.sourceBlock.workspace.rendered) {\r\n      return; // Headless blocks don't need fields initialized.\r\n    }\r\n    for (let i = 0; i < this.fieldRow.length; i++) {\r\n      this.fieldRow[i].init();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Sever all links to this input.\r\n   */\r\n  dispose() {\r\n    for (let i = 0, field; (field = this.fieldRow[i]); i++) {\r\n      field.dispose();\r\n    }\r\n    if (this.connection) {\r\n      this.connection.dispose();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Constructs a connection based on the type of this input's source block.\r\n   * Properly handles constructing headless connections for headless blocks\r\n   * and rendered connections for rendered blocks.\r\n   *\r\n   * @returns a connection of the given type, which is either a headless\r\n   *     or rendered connection, based on the type of this input's source block.\r\n   */\r\n  protected makeConnection(type: ConnectionType): Connection {\r\n    return this.sourceBlock.makeConnection_(type);\r\n  }\r\n}\r\n\r\nexport namespace Input {\r\n  // TODO(v11): When this is removed in v11, also re-enable errors on access\r\n  //     of deprecated things (in build_tasks.js).\r\n  /**\r\n   * Enum for alignment of inputs.\r\n   *\r\n   * @deprecated Use Blockly.inputs.Align. To be removed in v11.\r\n   */\r\n  export enum Align {\r\n    LEFT = -1,\r\n    CENTRE = 0,\r\n    RIGHT = 1,\r\n  }\r\n}\r\n\r\n/** @deprecated Use Blockly.inputs.Align. To be removed in v11. */\r\n/** @suppress {deprecated} */\r\nexport type Align = Input.Align;\r\n/** @deprecated Use Blockly.inputs.Align. To be removed in v11. */\r\n/** @suppress {deprecated} */\r\nexport const Align = Input.Align;\r\n","/**\r\n * @license\r\n * Copyright 2023 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport type {Block} from '../block.js';\r\nimport {Input} from './input.js';\r\nimport {inputTypes} from './input_types.js';\r\n\r\n/** Represents an input on a block with no connection. */\r\nexport class DummyInput extends Input {\r\n  readonly type = inputTypes.DUMMY;\r\n\r\n  /**\r\n   * @param name Language-neutral identifier which may used to find this input\r\n   *     again.\r\n   * @param block The block containing this input.\r\n   */\r\n  constructor(\r\n    public name: string,\r\n    block: Block,\r\n  ) {\r\n    super(name, block);\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2023 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport type {Block} from '../block.js';\r\nimport {Input} from './input.js';\r\nimport {inputTypes} from './input_types.js';\r\n\r\n/**\r\n * Represents an input on a block that is always the last input in the row. Any\r\n * following input will be rendered on the next row even if the block has inline\r\n * inputs. Any newline character in a JSON block definition's message will\r\n * automatically be parsed as an end-row input.\r\n */\r\nexport class EndRowInput extends Input {\r\n  readonly type = inputTypes.END_ROW;\r\n\r\n  /**\r\n   * @param name Language-neutral identifier which may used to find this input\r\n   *     again.\r\n   * @param block The block containing this input.\r\n   */\r\n  constructor(\r\n    public name: string,\r\n    block: Block,\r\n  ) {\r\n    super(name, block);\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2023 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport type {Block} from '../block.js';\r\nimport type {Connection} from '../connection.js';\r\nimport {ConnectionType} from '../connection_type.js';\r\nimport {Input} from './input.js';\r\nimport {inputTypes} from './input_types.js';\r\n\r\n/** Represents an input on a block with a statement connection. */\r\nexport class StatementInput extends Input {\r\n  readonly type = inputTypes.STATEMENT;\r\n\r\n  public connection: Connection;\r\n\r\n  /**\r\n   * @param name Language-neutral identifier which may used to find this input\r\n   *     again.\r\n   * @param block The block containing this input.\r\n   */\r\n  constructor(\r\n    public name: string,\r\n    block: Block,\r\n  ) {\r\n    // Errors are maintained for people not using typescript.\r\n    if (!name) throw new Error('Statement inputs must have a non-empty name');\r\n\r\n    super(name, block);\r\n    this.connection = this.makeConnection(ConnectionType.NEXT_STATEMENT);\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2023 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport type {Block} from '../block.js';\r\nimport {ConnectionType} from '../connection_type.js';\r\nimport {Input} from './input.js';\r\nimport {inputTypes} from './input_types.js';\r\n\r\n/** Represents an input on a block with a value connection. */\r\nexport class ValueInput extends Input {\r\n  readonly type = inputTypes.VALUE;\r\n\r\n  /**\r\n   * @param name Language-neutral identifier which may used to find this input\r\n   *     again.\r\n   * @param block The block containing this input.\r\n   */\r\n  constructor(\r\n    public name: string,\r\n    block: Block,\r\n  ) {\r\n    // Errors are maintained for people not using typescript.\r\n    if (!name) throw new Error('Value inputs must have a non-empty name');\r\n    super(name, block);\r\n    this.connection = this.makeConnection(ConnectionType.INPUT_VALUE);\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.blockRendering.RenderInfo\r\n\r\nimport type {BlockSvg} from '../../block_svg.js';\r\nimport {Input} from '../../inputs/input.js';\r\nimport {Align} from '../../inputs/align.js';\r\nimport type {RenderedConnection} from '../../rendered_connection.js';\r\nimport type {Measurable} from '../measurables/base.js';\r\nimport {BottomRow} from '../measurables/bottom_row.js';\r\nimport {DummyInput} from '../../inputs/dummy_input.js';\r\nimport {EndRowInput} from '../../inputs/end_row_input.js';\r\nimport {ExternalValueInput} from '../measurables/external_value_input.js';\r\nimport {Field} from '../measurables/field.js';\r\nimport {Hat} from '../measurables/hat.js';\r\nimport {Icon} from '../measurables/icon.js';\r\nimport {InRowSpacer} from '../measurables/in_row_spacer.js';\r\nimport {InlineInput} from '../measurables/inline_input.js';\r\nimport {InputRow} from '../measurables/input_row.js';\r\nimport {JaggedEdge} from '../measurables/jagged_edge.js';\r\nimport {NextConnection} from '../measurables/next_connection.js';\r\nimport {OutputConnection} from '../measurables/output_connection.js';\r\nimport {PreviousConnection} from '../measurables/previous_connection.js';\r\nimport {RoundCorner} from '../measurables/round_corner.js';\r\nimport type {Row} from '../measurables/row.js';\r\nimport {SpacerRow} from '../measurables/spacer_row.js';\r\nimport {SquareCorner} from '../measurables/square_corner.js';\r\nimport {StatementInput as StatementInputMeasurable} from '../measurables/statement_input.js';\r\nimport {StatementInput} from '../../inputs/statement_input.js';\r\nimport {TopRow} from '../measurables/top_row.js';\r\nimport {Types} from '../measurables/types.js';\r\nimport {ValueInput} from '../../inputs/value_input.js';\r\n\r\nimport type {ConstantProvider} from './constants.js';\r\nimport type {Renderer} from './renderer.js';\r\nimport {Connection} from '../measurables/connection.js';\r\n\r\n/**\r\n * An object containing all sizing information needed to draw this block.\r\n *\r\n * This measure pass does not propagate changes to the block (although fields\r\n * may choose to rerender when getSize() is called).  However, calling it\r\n * repeatedly may be expensive.\r\n */\r\nexport class RenderInfo {\r\n  block_: BlockSvg;\r\n  protected constants_: ConstantProvider;\r\n  outputConnection: OutputConnection | null;\r\n  isInline: boolean;\r\n  isCollapsed: boolean;\r\n  isInsertionMarker: boolean;\r\n  RTL: boolean;\r\n\r\n  /** The block renderer in use. */\r\n  protected readonly renderer_!: Renderer;\r\n\r\n  /** The height of the rendered block, including child blocks. */\r\n  height = 0;\r\n\r\n  /** The width of the rendered block, including child blocks. */\r\n  widthWithChildren = 0;\r\n\r\n  /**\r\n   * The width of the rendered block, excluding child blocks.  This is the\r\n   * right edge of the block when rendered LTR.\r\n   */\r\n  width = 0;\r\n  statementEdge = 0;\r\n\r\n  /** An array of Row objects containing sizing information. */\r\n  rows: Row[] = [];\r\n\r\n  /** An array of input rows on the block. */\r\n  inputRows: InputRow[] = [];\r\n\r\n  topRow: TopRow;\r\n  bottomRow: BottomRow;\r\n\r\n  // The position of the start point for drawing, relative to the block's\r\n  // location.\r\n  startX = 0;\r\n  startY = 0;\r\n\r\n  /**\r\n   * @param renderer The renderer in use.\r\n   * @param block The block to measure.\r\n   */\r\n  constructor(renderer: Renderer, block: BlockSvg) {\r\n    this.renderer_ = renderer;\r\n\r\n    this.block_ = block;\r\n\r\n    /** The renderer's constant provider. */\r\n    this.constants_ = this.renderer_.getConstants();\r\n\r\n    /**\r\n     * A measurable representing the output connection if the block has one.\r\n     * Otherwise null.\r\n     */\r\n    this.outputConnection = block.outputConnection\r\n      ? new OutputConnection(this.constants_, block.outputConnection)\r\n      : null;\r\n\r\n    /**\r\n     * Whether the block should be rendered as a single line, either because\r\n     * it's inline or because it has been collapsed.\r\n     */\r\n    this.isInline = block.getInputsInline() && !block.isCollapsed();\r\n\r\n    /** Whether the block is collapsed. */\r\n    this.isCollapsed = block.isCollapsed();\r\n\r\n    /**\r\n     * Whether the block is an insertion marker.  Insertion markers are the same\r\n     * shape as normal blocks, but don't show fields.\r\n     */\r\n    this.isInsertionMarker = block.isInsertionMarker();\r\n\r\n    /** True if the block should be rendered right-to-left. */\r\n    this.RTL = block.RTL;\r\n\r\n    /**\r\n     * An object with rendering information about the top row of the block.\r\n     */\r\n    this.topRow = new TopRow(this.constants_);\r\n\r\n    /**\r\n     * An object with rendering information about the bottom row of the block.\r\n     */\r\n    this.bottomRow = new BottomRow(this.constants_);\r\n  }\r\n\r\n  /**\r\n   * Get the block renderer in use.\r\n   *\r\n   * @returns The block renderer in use.\r\n   */\r\n  getRenderer(): Renderer {\r\n    return this.renderer_;\r\n  }\r\n\r\n  /**\r\n   * Populate this object with all sizing information needed to draw the block.\r\n   *\r\n   * This measure pass does not propagate changes to the block (although fields\r\n   * may choose to rerender when getSize() is called).  However, calling it\r\n   * repeatedly may be expensive.\r\n   */\r\n  measure() {\r\n    this.createRows_();\r\n    this.addElemSpacing_();\r\n    this.addRowSpacing_();\r\n    this.computeBounds_();\r\n    this.alignRowElements_();\r\n    this.finalize_();\r\n  }\r\n\r\n  /**\r\n   * Create rows of Measurable objects representing all renderable parts of the\r\n   * block.\r\n   */\r\n  protected createRows_() {\r\n    this.populateTopRow_();\r\n    this.rows.push(this.topRow);\r\n    let activeRow = new InputRow(this.constants_);\r\n    this.inputRows.push(activeRow);\r\n\r\n    // Icons always go on the first row, before anything else.\r\n    const icons = this.block_.getIcons();\r\n    for (let i = 0, icon; (icon = icons[i]); i++) {\r\n      const iconInfo = new Icon(this.constants_, icon);\r\n      if (!this.isCollapsed || icon.isShownWhenCollapsed()) {\r\n        activeRow.elements.push(iconInfo);\r\n      }\r\n    }\r\n\r\n    let lastInput = undefined;\r\n    // Loop across all of the inputs on the block, creating objects for anything\r\n    // that needs to be rendered and breaking the block up into visual rows.\r\n    for (let i = 0, input; (input = this.block_.inputList[i]); i++) {\r\n      if (!input.isVisible()) {\r\n        continue;\r\n      }\r\n      if (this.shouldStartNewRow_(input, lastInput)) {\r\n        // Finish this row and create a new one.\r\n        this.rows.push(activeRow);\r\n        activeRow = new InputRow(this.constants_);\r\n        this.inputRows.push(activeRow);\r\n      }\r\n\r\n      // All of the fields in an input go on the same row.\r\n      for (let j = 0, field; (field = input.fieldRow[j]); j++) {\r\n        activeRow.elements.push(new Field(this.constants_, field, input));\r\n      }\r\n      this.addInput_(input, activeRow);\r\n      lastInput = input;\r\n    }\r\n\r\n    if (this.isCollapsed) {\r\n      activeRow.hasJaggedEdge = true;\r\n      activeRow.elements.push(new JaggedEdge(this.constants_));\r\n    }\r\n\r\n    if (activeRow.elements.length || activeRow.hasDummyInput) {\r\n      this.rows.push(activeRow);\r\n    }\r\n    this.populateBottomRow_();\r\n    this.rows.push(this.bottomRow);\r\n  }\r\n\r\n  /**\r\n   * Create all non-spacer elements that belong on the top row.\r\n   */\r\n  protected populateTopRow_() {\r\n    const hasPrevious = !!this.block_.previousConnection;\r\n    const hasHat =\r\n      (this.block_.hat\r\n        ? this.block_.hat === 'cap'\r\n        : this.constants_.ADD_START_HATS) &&\r\n      !this.outputConnection &&\r\n      !hasPrevious;\r\n\r\n    let cornerClass = this.topRow.hasLeftSquareCorner(this.block_)\r\n      ? SquareCorner\r\n      : RoundCorner;\r\n    this.topRow.elements.push(new cornerClass(this.constants_));\r\n\r\n    if (hasHat) {\r\n      const hat = new Hat(this.constants_);\r\n      this.topRow.elements.push(hat);\r\n      this.topRow.capline = hat.ascenderHeight;\r\n    } else if (hasPrevious) {\r\n      this.topRow.hasPreviousConnection = true;\r\n      this.topRow.connection = new PreviousConnection(\r\n        this.constants_,\r\n        this.block_.previousConnection as RenderedConnection,\r\n      );\r\n      this.topRow.elements.push(this.topRow.connection);\r\n    }\r\n\r\n    const precedesStatement =\r\n      this.block_.inputList.length &&\r\n      this.block_.inputList[0] instanceof StatementInput;\r\n\r\n    // This is the minimum height for the row. If one of its elements has a\r\n    // greater height it will be overwritten in the compute pass.\r\n    if (precedesStatement && !this.block_.isCollapsed()) {\r\n      this.topRow.minHeight =\r\n        this.constants_.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT;\r\n    } else {\r\n      this.topRow.minHeight = this.constants_.TOP_ROW_MIN_HEIGHT;\r\n    }\r\n\r\n    cornerClass = this.topRow.hasRightSquareCorner(this.block_)\r\n      ? SquareCorner\r\n      : RoundCorner;\r\n    this.topRow.elements.push(new cornerClass(this.constants_, 'right'));\r\n  }\r\n\r\n  /**\r\n   * Create all non-spacer elements that belong on the bottom row.\r\n   */\r\n  protected populateBottomRow_() {\r\n    this.bottomRow.hasNextConnection = !!this.block_.nextConnection;\r\n\r\n    const followsStatement =\r\n      this.block_.inputList.length &&\r\n      this.block_.inputList[this.block_.inputList.length - 1] instanceof\r\n        StatementInput;\r\n\r\n    // This is the minimum height for the row. If one of its elements has a\r\n    // greater height it will be overwritten in the compute pass.\r\n    if (followsStatement) {\r\n      this.bottomRow.minHeight =\r\n        this.constants_.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT;\r\n    } else {\r\n      this.bottomRow.minHeight = this.constants_.BOTTOM_ROW_MIN_HEIGHT;\r\n    }\r\n\r\n    const leftSquareCorner = this.bottomRow.hasLeftSquareCorner(this.block_);\r\n\r\n    if (leftSquareCorner) {\r\n      this.bottomRow.elements.push(new SquareCorner(this.constants_));\r\n    } else {\r\n      this.bottomRow.elements.push(new RoundCorner(this.constants_));\r\n    }\r\n\r\n    if (this.bottomRow.hasNextConnection) {\r\n      this.bottomRow.connection = new NextConnection(\r\n        this.constants_,\r\n        this.block_.nextConnection as RenderedConnection,\r\n      );\r\n      this.bottomRow.elements.push(this.bottomRow.connection);\r\n    }\r\n\r\n    const rightSquareCorner = this.bottomRow.hasRightSquareCorner(this.block_);\r\n\r\n    if (rightSquareCorner) {\r\n      this.bottomRow.elements.push(new SquareCorner(this.constants_, 'right'));\r\n    } else {\r\n      this.bottomRow.elements.push(new RoundCorner(this.constants_, 'right'));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add an input element to the active row, if needed, and record the type of\r\n   * the input on the row.\r\n   *\r\n   * @param input The input to record information about.\r\n   * @param activeRow The row that is currently being populated.\r\n   */\r\n  protected addInput_(input: Input, activeRow: Row) {\r\n    // Non-dummy inputs have visual representations onscreen.\r\n    if (this.isInline && input instanceof ValueInput) {\r\n      activeRow.elements.push(new InlineInput(this.constants_, input));\r\n      activeRow.hasInlineInput = true;\r\n    } else if (input instanceof StatementInput) {\r\n      activeRow.elements.push(\r\n        new StatementInputMeasurable(this.constants_, input),\r\n      );\r\n      activeRow.hasStatement = true;\r\n    } else if (input instanceof ValueInput) {\r\n      activeRow.elements.push(new ExternalValueInput(this.constants_, input));\r\n      activeRow.hasExternalInput = true;\r\n    } else if (input instanceof DummyInput || input instanceof EndRowInput) {\r\n      // Dummy and end-row inputs have no visual representation, but the\r\n      // information is still important.\r\n      activeRow.minHeight = Math.max(\r\n        activeRow.minHeight,\r\n        input.getSourceBlock() && input.getSourceBlock()!.isShadow()\r\n          ? this.constants_.DUMMY_INPUT_SHADOW_MIN_HEIGHT\r\n          : this.constants_.DUMMY_INPUT_MIN_HEIGHT,\r\n      );\r\n      activeRow.hasDummyInput = true;\r\n    }\r\n    if (activeRow.align === null) {\r\n      activeRow.align = input.align;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Decide whether to start a new row between the two Blockly.Inputs.\r\n   *\r\n   * @param currInput The current input.\r\n   * @param prevInput The previous input.\r\n   * @returns True if the current input should be rendered on a new row.\r\n   */\r\n  protected shouldStartNewRow_(currInput: Input, prevInput?: Input): boolean {\r\n    // If this is the first input, just add to the existing row.\r\n    // That row is either empty or has some icons in it.\r\n    if (!prevInput) {\r\n      return false;\r\n    }\r\n    // If the previous input was an end-row input, then any following input\r\n    // should always be rendered on the next row.\r\n    if (prevInput instanceof EndRowInput) {\r\n      return true;\r\n    }\r\n    // A statement input or an input following one always gets a new row.\r\n    if (\r\n      currInput instanceof StatementInput ||\r\n      prevInput instanceof StatementInput\r\n    ) {\r\n      return true;\r\n    }\r\n    // Value inputs, dummy inputs, and any input following an external value\r\n    // input get a new row if inputs are not inlined.\r\n    if (\r\n      currInput instanceof ValueInput ||\r\n      currInput instanceof DummyInput ||\r\n      prevInput instanceof ValueInput\r\n    ) {\r\n      return !this.isInline;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /** Add horizontal spacing between and around elements within each row. */\r\n  protected addElemSpacing_() {\r\n    for (let i = 0, row; (row = this.rows[i]); i++) {\r\n      const oldElems = row.elements;\r\n      row.elements = [];\r\n      // No spacing needed before the corner on the top row or the bottom row.\r\n      if (row.startsWithElemSpacer()) {\r\n        // There's a spacer before the first element in the row.\r\n        row.elements.push(\r\n          new InRowSpacer(\r\n            this.constants_,\r\n            this.getInRowSpacing_(null, oldElems[0]),\r\n          ),\r\n        );\r\n      }\r\n      if (!oldElems.length) {\r\n        continue;\r\n      }\r\n      for (let e = 0; e < oldElems.length - 1; e++) {\r\n        row.elements.push(oldElems[e]);\r\n        const spacing = this.getInRowSpacing_(oldElems[e], oldElems[e + 1]);\r\n        row.elements.push(new InRowSpacer(this.constants_, spacing));\r\n      }\r\n      row.elements.push(oldElems[oldElems.length - 1]);\r\n      if (row.endsWithElemSpacer()) {\r\n        // There's a spacer after the last element in the row.\r\n        row.elements.push(\r\n          new InRowSpacer(\r\n            this.constants_,\r\n            this.getInRowSpacing_(oldElems[oldElems.length - 1], null),\r\n          ),\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Calculate the width of a spacer element in a row based on the previous and\r\n   * next elements in that row.  For instance, extra padding is added between\r\n   * two editable fields.\r\n   *\r\n   * @param prev The element before the spacer.\r\n   * @param next The element after the spacer.\r\n   * @returns The size of the spacing between the two elements.\r\n   */\r\n  protected getInRowSpacing_(\r\n    prev: Measurable | null,\r\n    next: Measurable | null,\r\n  ): number {\r\n    if (!prev) {\r\n      // Statement input padding.\r\n      if (next && Types.isStatementInput(next)) {\r\n        return this.constants_.STATEMENT_INPUT_PADDING_LEFT;\r\n      }\r\n    }\r\n    // Between inputs and the end of the row.\r\n    if (prev && Types.isInput(prev) && !next) {\r\n      if (Types.isExternalInput(prev)) {\r\n        return this.constants_.NO_PADDING;\r\n      } else if (Types.isInlineInput(prev)) {\r\n        return this.constants_.LARGE_PADDING;\r\n      } else if (Types.isStatementInput(prev)) {\r\n        return this.constants_.NO_PADDING;\r\n      }\r\n    }\r\n\r\n    // Spacing between a square corner and a previous or next connection\r\n    if (prev && Types.isLeftSquareCorner(prev) && next) {\r\n      if (Types.isPreviousConnection(next) || Types.isNextConnection(next)) {\r\n        return next.notchOffset;\r\n      }\r\n    }\r\n\r\n    // Spacing between a rounded corner and a previous or next connection.\r\n    if (prev && Types.isLeftRoundedCorner(prev) && next) {\r\n      if (Types.isPreviousConnection(next) || Types.isNextConnection(next)) {\r\n        return next.notchOffset - this.constants_.CORNER_RADIUS;\r\n      }\r\n    }\r\n\r\n    return this.constants_.MEDIUM_PADDING;\r\n  }\r\n\r\n  /**\r\n   * Figure out where the right edge of the block and right edge of statement\r\n   * inputs should be placed.\r\n   */\r\n  protected computeBounds_() {\r\n    let widestStatementRowFields = 0;\r\n    let blockWidth = 0;\r\n    let widestRowWithConnectedBlocks = 0;\r\n    for (let i = 0, row; (row = this.rows[i]); i++) {\r\n      row.measure();\r\n      blockWidth = Math.max(blockWidth, row.width);\r\n      if (row.hasStatement) {\r\n        const statementInput = row.getLastInput();\r\n        const innerWidth = row.width - (statementInput?.width ?? 0);\r\n        widestStatementRowFields = Math.max(\r\n          widestStatementRowFields,\r\n          innerWidth,\r\n        );\r\n      }\r\n      widestRowWithConnectedBlocks = Math.max(\r\n        widestRowWithConnectedBlocks,\r\n        row.widthWithConnectedBlocks,\r\n      );\r\n    }\r\n\r\n    this.statementEdge = widestStatementRowFields;\r\n    this.width = blockWidth;\r\n\r\n    for (let i = 0, row; (row = this.rows[i]); i++) {\r\n      if (row.hasStatement) {\r\n        row.statementEdge = this.statementEdge;\r\n      }\r\n    }\r\n\r\n    this.widthWithChildren = Math.max(blockWidth, widestRowWithConnectedBlocks);\r\n\r\n    if (this.outputConnection) {\r\n      this.startX = this.outputConnection.width;\r\n      this.width += this.outputConnection.width;\r\n      this.widthWithChildren += this.outputConnection.width;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Extra spacing may be necessary to make sure that the right sides of all\r\n   * rows line up.  This can only be calculated after a first pass to calculate\r\n   * the sizes of all rows.\r\n   */\r\n  protected alignRowElements_() {\r\n    for (let i = 0, row; (row = this.rows[i]); i++) {\r\n      if (row.hasStatement) {\r\n        this.alignStatementRow_(row as InputRow);\r\n      } else {\r\n        const currentWidth = row.width;\r\n        const desiredWidth = this.getDesiredRowWidth_(row);\r\n        const missingSpace = desiredWidth - currentWidth;\r\n        if (missingSpace > 0) {\r\n          this.addAlignmentPadding_(row, missingSpace);\r\n        }\r\n        if (Types.isTopOrBottomRow(row)) {\r\n          row.widthWithConnectedBlocks = row.width;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Calculate the desired width of an input row.\r\n   *\r\n   * @param _row The input row.\r\n   * @returns The desired width of the input row.\r\n   */\r\n  protected getDesiredRowWidth_(_row: Row): number {\r\n    return this.width - this.startX;\r\n  }\r\n\r\n  /**\r\n   * Modify the given row to add the given amount of padding around its fields.\r\n   * The exact location of the padding is based on the alignment property of the\r\n   * last input in the field.\r\n   *\r\n   * @param row The row to add padding to.\r\n   * @param missingSpace How much padding to add.\r\n   */\r\n  protected addAlignmentPadding_(row: Row, missingSpace: number) {\r\n    const firstSpacer = row.getFirstSpacer();\r\n    const lastSpacer = row.getLastSpacer();\r\n    if (row.hasExternalInput || row.hasStatement) {\r\n      row.widthWithConnectedBlocks += missingSpace;\r\n    }\r\n\r\n    // Decide where the extra padding goes.\r\n    if (row.align === Align.LEFT && lastSpacer) {\r\n      // Add padding to the end of the row.\r\n      lastSpacer.width += missingSpace;\r\n    } else if (row.align === Align.CENTRE && firstSpacer && lastSpacer) {\r\n      // Split the padding between the beginning and end of the row.\r\n      firstSpacer.width += missingSpace / 2;\r\n      lastSpacer.width += missingSpace / 2;\r\n    } else if (row.align === Align.RIGHT && firstSpacer) {\r\n      // Add padding at the beginning of the row.\r\n      firstSpacer.width += missingSpace;\r\n    } else if (lastSpacer) {\r\n      // Default to left-aligning.\r\n      lastSpacer.width += missingSpace;\r\n    } else {\r\n      return;\r\n    }\r\n    row.width += missingSpace;\r\n  }\r\n\r\n  /**\r\n   * Align the elements of a statement row based on computed bounds.\r\n   * Unlike other types of rows, statement rows add space in multiple places.\r\n   *\r\n   * @param row The statement row to resize.\r\n   */\r\n  protected alignStatementRow_(row: InputRow) {\r\n    const statementInput = row.getLastInput();\r\n    if (!statementInput) return;\r\n    let currentWidth = row.width - statementInput.width;\r\n    let desiredWidth = this.statementEdge;\r\n    // Add padding before the statement input.\r\n    const missingSpace = desiredWidth - currentWidth;\r\n    if (missingSpace > 0) {\r\n      this.addAlignmentPadding_(row, missingSpace);\r\n    }\r\n    // Also widen the statement input to reach to the right side of the\r\n    // block. Note that this does not add padding.\r\n    currentWidth = row.width;\r\n    desiredWidth = this.getDesiredRowWidth_(row);\r\n    statementInput.width += desiredWidth - currentWidth;\r\n    statementInput.height = Math.max(statementInput.height, row.height);\r\n    row.width += desiredWidth - currentWidth;\r\n    row.widthWithConnectedBlocks = Math.max(\r\n      row.width,\r\n      this.statementEdge + row.connectedBlockWidths,\r\n    );\r\n  }\r\n\r\n  /** Add spacers between rows and set their sizes. */\r\n  protected addRowSpacing_() {\r\n    const oldRows = this.rows;\r\n    this.rows = [];\r\n\r\n    for (let r = 0; r < oldRows.length; r++) {\r\n      this.rows.push(oldRows[r]);\r\n      if (r !== oldRows.length - 1) {\r\n        this.rows.push(this.makeSpacerRow_(oldRows[r], oldRows[r + 1]));\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create a spacer row to go between prev and next, and set its size.\r\n   *\r\n   * @param prev The previous row.\r\n   * @param next The next row.\r\n   * @returns The newly created spacer row.\r\n   */\r\n  protected makeSpacerRow_(prev: Row, next: Row): SpacerRow {\r\n    const height = this.getSpacerRowHeight_(prev, next);\r\n    const width = this.getSpacerRowWidth_(prev, next);\r\n    const spacer = new SpacerRow(this.constants_, height, width);\r\n    if (prev.hasStatement) {\r\n      spacer.followsStatement = true;\r\n    }\r\n    if (next.hasStatement) {\r\n      spacer.precedesStatement = true;\r\n    }\r\n    return spacer;\r\n  }\r\n\r\n  /**\r\n   * Calculate the width of a spacer row.\r\n   *\r\n   * @param _prev The row before the spacer.\r\n   * @param _next The row after the spacer.\r\n   * @returns The desired width of the spacer row between these two rows.\r\n   */\r\n  protected getSpacerRowWidth_(_prev: Row, _next: Row): number {\r\n    return this.width - this.startX;\r\n  }\r\n\r\n  /**\r\n   * Calculate the height of a spacer row.\r\n   *\r\n   * @param _prev The row before the spacer.\r\n   * @param _next The row after the spacer.\r\n   * @returns The desired height of the spacer row between these two rows.\r\n   */\r\n  protected getSpacerRowHeight_(_prev: Row, _next: Row): number {\r\n    return this.constants_.MEDIUM_PADDING;\r\n  }\r\n\r\n  /**\r\n   * Calculate the centerline of an element in a rendered row.\r\n   * This base implementation puts the centerline at the middle of the row\r\n   * vertically, with no special cases.  You will likely need extra logic to\r\n   * handle (at minimum) top and bottom rows.\r\n   *\r\n   * @param row The row containing the element.\r\n   * @param elem The element to place.\r\n   * @returns The desired centerline of the given element, as an offset from the\r\n   *     top left of the block.\r\n   */\r\n  protected getElemCenterline_(row: Row, elem: Measurable): number {\r\n    if (Types.isSpacer(elem)) {\r\n      return row.yPos + elem.height / 2;\r\n    }\r\n    if (Types.isBottomRow(row)) {\r\n      const bottomRow = row as BottomRow;\r\n      const baseline =\r\n        bottomRow.yPos + bottomRow.height - bottomRow.descenderHeight;\r\n      if (Types.isNextConnection(elem)) {\r\n        return baseline + elem.height / 2;\r\n      }\r\n      return baseline - elem.height / 2;\r\n    }\r\n    if (Types.isTopRow(row)) {\r\n      const topRow = row as TopRow;\r\n      if (Types.isHat(elem)) {\r\n        return topRow.capline - elem.height / 2;\r\n      }\r\n      return topRow.capline + elem.height / 2;\r\n    }\r\n    return row.yPos + row.height / 2;\r\n  }\r\n\r\n  /**\r\n   * Record final position information on elements on the given row, for use in\r\n   * drawing.  At minimum this records xPos and centerline on each element.\r\n   *\r\n   * @param row The row containing the elements.\r\n   */\r\n  protected recordElemPositions_(row: Row) {\r\n    let xCursor = row.xPos;\r\n    for (let j = 0, elem; (elem = row.elements[j]); j++) {\r\n      // Now that row heights are finalized, make spacers use the row height.\r\n      if (Types.isSpacer(elem)) {\r\n        elem.height = row.height;\r\n      }\r\n      elem.xPos = xCursor;\r\n      elem.centerline = this.getElemCenterline_(row, elem);\r\n      xCursor += elem.width;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Make any final changes to the rendering information object.  In particular,\r\n   * store the y position of each row, and record the height of the full block.\r\n   */\r\n  protected finalize_() {\r\n    // Performance note: this could be combined with the draw pass, if the time\r\n    // that this takes is excessive.  But it shouldn't be, because it only\r\n    // accesses and sets properties that already exist on the objects.\r\n    let widestRowWithConnectedBlocks = 0;\r\n    let yCursor = 0;\r\n    for (let i = 0, row; (row = this.rows[i]); i++) {\r\n      row.yPos = yCursor;\r\n      row.xPos = this.startX;\r\n      yCursor += row.height;\r\n\r\n      widestRowWithConnectedBlocks = Math.max(\r\n        widestRowWithConnectedBlocks,\r\n        row.widthWithConnectedBlocks,\r\n      );\r\n      this.recordElemPositions_(row);\r\n    }\r\n    if (this.outputConnection && this.block_.nextConnection) {\r\n      const target = this.block_.nextConnection.targetBlock();\r\n      if (target) {\r\n        // Include width of connected block in value to stack width measurement.\r\n        widestRowWithConnectedBlocks = Math.max(\r\n          widestRowWithConnectedBlocks,\r\n          target.getHeightWidth().width,\r\n        );\r\n      }\r\n    }\r\n\r\n    this.widthWithChildren = widestRowWithConnectedBlocks + this.startX;\r\n\r\n    this.height = yCursor;\r\n    this.startY = this.topRow.capline;\r\n    this.bottomRow.baseline = yCursor - this.bottomRow.descenderHeight;\r\n  }\r\n\r\n  /** Returns the connection measurable associated with the given connection. */\r\n  getMeasureableForConnection(conn: RenderedConnection): Connection | null {\r\n    if (this.outputConnection?.connectionModel === conn) {\r\n      return this.outputConnection;\r\n    }\r\n\r\n    for (const row of this.rows) {\r\n      for (const elem of row.elements) {\r\n        if (elem instanceof Connection && elem.connectionModel === conn) {\r\n          return elem;\r\n        }\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Events fired as a result of a marker move.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.Events.MarkerMove\r\n\r\nimport type {Block} from '../block.js';\r\nimport {ASTNode} from '../keyboard_nav/ast_node.js';\r\nimport * as registry from '../registry.js';\r\nimport type {Workspace} from '../workspace.js';\r\nimport {AbstractEventJson} from './events_abstract.js';\r\n\r\nimport {UiBase} from './events_ui_base.js';\r\nimport * as eventUtils from './utils.js';\r\n\r\n/**\r\n * Notifies listeners that a marker (used for keyboard navigation) has\r\n * moved.\r\n */\r\nexport class MarkerMove extends UiBase {\r\n  /** The ID of the block the marker is now on, if any. */\r\n  blockId?: string;\r\n\r\n  /** The old node the marker used to be on, if any. */\r\n  oldNode?: ASTNode;\r\n\r\n  /** The new node the marker is now on. */\r\n  newNode?: ASTNode;\r\n\r\n  /**\r\n   * True if this is a cursor event, false otherwise.\r\n   * For information about cursors vs markers see {@link\r\n   * https://blocklycodelabs.dev/codelabs/keyboard-navigation/index.html?index=..%2F..index#1}.\r\n   */\r\n  isCursor?: boolean;\r\n\r\n  override type = eventUtils.MARKER_MOVE;\r\n\r\n  /**\r\n   * @param opt_block The affected block. Null if current node is of type\r\n   *     workspace. Undefined for a blank event.\r\n   * @param isCursor Whether this is a cursor event. Undefined for a blank\r\n   *     event.\r\n   * @param opt_oldNode The old node the marker used to be on.\r\n   *    Undefined for a blank event.\r\n   * @param opt_newNode The new node the marker is now on.\r\n   *    Undefined for a blank event.\r\n   */\r\n  constructor(\r\n    opt_block?: Block | null,\r\n    isCursor?: boolean,\r\n    opt_oldNode?: ASTNode | null,\r\n    opt_newNode?: ASTNode,\r\n  ) {\r\n    let workspaceId = opt_block ? opt_block.workspace.id : undefined;\r\n    if (opt_newNode && opt_newNode.getType() === ASTNode.types.WORKSPACE) {\r\n      workspaceId = (opt_newNode.getLocation() as Workspace).id;\r\n    }\r\n    super(workspaceId);\r\n\r\n    this.blockId = opt_block?.id;\r\n    this.oldNode = opt_oldNode || undefined;\r\n    this.newNode = opt_newNode;\r\n    this.isCursor = isCursor;\r\n  }\r\n\r\n  /**\r\n   * Encode the event as JSON.\r\n   *\r\n   * @returns JSON representation.\r\n   */\r\n  override toJson(): MarkerMoveJson {\r\n    const json = super.toJson() as MarkerMoveJson;\r\n    if (this.isCursor === undefined) {\r\n      throw new Error(\r\n        'Whether this is a cursor event or not is undefined. Either pass ' +\r\n          'a value to the constructor, or call fromJson',\r\n      );\r\n    }\r\n    if (!this.newNode) {\r\n      throw new Error(\r\n        'The new node is undefined. Either pass a node to ' +\r\n          'the constructor, or call fromJson',\r\n      );\r\n    }\r\n    json['isCursor'] = this.isCursor;\r\n    json['blockId'] = this.blockId;\r\n    json['oldNode'] = this.oldNode;\r\n    json['newNode'] = this.newNode;\r\n    return json;\r\n  }\r\n\r\n  /**\r\n   * Deserializes the JSON event.\r\n   *\r\n   * @param event The event to append new properties to. Should be a subclass\r\n   *     of MarkerMove, but we can't specify that due to the fact that\r\n   *     parameters to static methods in subclasses must be supertypes of\r\n   *     parameters to static methods in superclasses.\r\n   * @internal\r\n   */\r\n  static fromJson(\r\n    json: MarkerMoveJson,\r\n    workspace: Workspace,\r\n    event?: any,\r\n  ): MarkerMove {\r\n    const newEvent = super.fromJson(\r\n      json,\r\n      workspace,\r\n      event ?? new MarkerMove(),\r\n    ) as MarkerMove;\r\n    newEvent.isCursor = json['isCursor'];\r\n    newEvent.blockId = json['blockId'];\r\n    newEvent.oldNode = json['oldNode'];\r\n    newEvent.newNode = json['newNode'];\r\n    return newEvent;\r\n  }\r\n}\r\n\r\nexport interface MarkerMoveJson extends AbstractEventJson {\r\n  isCursor: boolean;\r\n  blockId?: string;\r\n  oldNode?: ASTNode;\r\n  newNode: ASTNode;\r\n}\r\n\r\nregistry.register(registry.Type.EVENT, eventUtils.MARKER_MOVE, MarkerMove);\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.blockRendering.MarkerSvg\r\n\r\n// Unused import preserved for side-effects. Remove if unneeded.\r\nimport '../../events/events_marker_move.js';\r\n\r\nimport type {BlockSvg} from '../../block_svg.js';\r\nimport type {Connection} from '../../connection.js';\r\nimport {ConnectionType} from '../../connection_type.js';\r\nimport * as eventUtils from '../../events/utils.js';\r\nimport type {Field} from '../../field.js';\r\nimport type {IASTNodeLocationSvg} from '../../interfaces/i_ast_node_location_svg.js';\r\nimport {ASTNode} from '../../keyboard_nav/ast_node.js';\r\nimport type {Marker} from '../../keyboard_nav/marker.js';\r\nimport type {RenderedConnection} from '../../rendered_connection.js';\r\nimport * as dom from '../../utils/dom.js';\r\nimport {Svg} from '../../utils/svg.js';\r\nimport * as svgPaths from '../../utils/svg_paths.js';\r\nimport type {WorkspaceSvg} from '../../workspace_svg.js';\r\n\r\nimport type {ConstantProvider, Notch, PuzzleTab} from './constants.js';\r\n\r\n/** The name of the CSS class for a cursor. */\r\nconst CURSOR_CLASS = 'blocklyCursor';\r\n\r\n/** The name of the CSS class for a marker. */\r\nconst MARKER_CLASS = 'blocklyMarker';\r\n\r\n/**\r\n * What we multiply the height by to get the height of the marker.\r\n * Only used for the block and block connections.\r\n */\r\nconst HEIGHT_MULTIPLIER = 3 / 4;\r\n\r\n/**\r\n * Class for a marker, containing methods for graphically rendering a marker as\r\n * SVG.\r\n */\r\nexport class MarkerSvg {\r\n  /**\r\n   * The workspace, field, or block that the marker SVG element should be\r\n   * attached to.\r\n   */\r\n  private parent: IASTNodeLocationSvg | null = null;\r\n\r\n  /** The current SVG element for the marker. */\r\n  currentMarkerSvg: SVGElement | null = null;\r\n  colour_: string;\r\n\r\n  /** The root SVG group containing the marker. */\r\n  protected markerSvg_: SVGGElement | null = null;\r\n  protected svgGroup_: SVGGElement | null = null;\r\n\r\n  protected markerBlock_: SVGPathElement | null = null;\r\n\r\n  protected markerInput_: SVGPathElement | null = null;\r\n  protected markerSvgLine_: SVGRectElement | null = null;\r\n\r\n  protected markerSvgRect_: SVGRectElement | null = null;\r\n\r\n  /** The constants necessary to draw the marker. */\r\n  protected constants_: ConstantProvider;\r\n\r\n  /**\r\n   * @param workspace The workspace the marker belongs to.\r\n   * @param constants The constants for the renderer.\r\n   * @param marker The marker to draw.\r\n   */\r\n  constructor(\r\n    private readonly workspace: WorkspaceSvg,\r\n    constants: ConstantProvider,\r\n    private readonly marker: Marker,\r\n  ) {\r\n    this.constants_ = constants;\r\n\r\n    const defaultColour = this.isCursor()\r\n      ? this.constants_.CURSOR_COLOUR\r\n      : this.constants_.MARKER_COLOUR;\r\n\r\n    /** The colour of the marker. */\r\n    this.colour_ = marker.colour || defaultColour;\r\n  }\r\n\r\n  /**\r\n   * Return the root node of the SVG or null if none exists.\r\n   *\r\n   * @returns The root SVG node.\r\n   */\r\n  getSvgRoot(): SVGElement | null {\r\n    return this.svgGroup_;\r\n  }\r\n\r\n  /**\r\n   * Get the marker.\r\n   *\r\n   * @returns The marker to draw for.\r\n   */\r\n  getMarker(): Marker {\r\n    return this.marker;\r\n  }\r\n\r\n  /**\r\n   * True if the marker should be drawn as a cursor, false otherwise.\r\n   * A cursor is drawn as a flashing line. A marker is drawn as a solid line.\r\n   *\r\n   * @returns True if the marker is a cursor, false otherwise.\r\n   */\r\n  isCursor(): boolean {\r\n    return this.marker.type === 'cursor';\r\n  }\r\n\r\n  /**\r\n   * Create the DOM element for the marker.\r\n   *\r\n   * @returns The marker controls SVG group.\r\n   */\r\n  createDom(): SVGElement {\r\n    const className = this.isCursor() ? CURSOR_CLASS : MARKER_CLASS;\r\n\r\n    this.svgGroup_ = dom.createSvgElement(Svg.G, {'class': className});\r\n\r\n    this.createDomInternal_();\r\n    return this.svgGroup_;\r\n  }\r\n\r\n  /**\r\n   * Attaches the SVG root of the marker to the SVG group of the parent.\r\n   *\r\n   * @param newParent The workspace, field, or block that the marker SVG element\r\n   *     should be attached to.\r\n   */\r\n  protected setParent_(newParent: IASTNodeLocationSvg) {\r\n    if (!this.isCursor()) {\r\n      if (this.parent) {\r\n        this.parent.setMarkerSvg(null);\r\n      }\r\n      newParent.setMarkerSvg(this.getSvgRoot());\r\n    } else {\r\n      if (this.parent) {\r\n        this.parent.setCursorSvg(null);\r\n      }\r\n      newParent.setCursorSvg(this.getSvgRoot());\r\n    }\r\n    this.parent = newParent;\r\n  }\r\n\r\n  /**\r\n   * Update the marker.\r\n   *\r\n   * @param oldNode The previous node the marker was on or null.\r\n   * @param curNode The node that we want to draw the marker for.\r\n   */\r\n  draw(oldNode: ASTNode, curNode: ASTNode) {\r\n    if (!curNode) {\r\n      this.hide();\r\n      return;\r\n    }\r\n\r\n    this.constants_ = this.workspace.getRenderer().getConstants();\r\n\r\n    const defaultColour = this.isCursor()\r\n      ? this.constants_.CURSOR_COLOUR\r\n      : this.constants_.MARKER_COLOUR;\r\n    this.colour_ = this.marker.colour || defaultColour;\r\n    this.applyColour_(curNode);\r\n\r\n    this.showAtLocation_(curNode);\r\n\r\n    this.fireMarkerEvent(oldNode, curNode);\r\n\r\n    // Ensures the marker will be visible immediately after the move.\r\n    const animate = this.currentMarkerSvg!.childNodes[0];\r\n    if (animate !== undefined) {\r\n      (animate as SVGAnimationElement).beginElement &&\r\n        (animate as SVGAnimationElement).beginElement();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update the marker's visible state based on the type of curNode..\r\n   *\r\n   * @param curNode The node that we want to draw the marker for.\r\n   */\r\n  protected showAtLocation_(curNode: ASTNode) {\r\n    const curNodeAsConnection = curNode.getLocation() as Connection;\r\n    const connectionType = curNodeAsConnection.type;\r\n    if (curNode.getType() === ASTNode.types.BLOCK) {\r\n      this.showWithBlock_(curNode);\r\n    } else if (curNode.getType() === ASTNode.types.OUTPUT) {\r\n      this.showWithOutput_(curNode);\r\n    } else if (connectionType === ConnectionType.INPUT_VALUE) {\r\n      this.showWithInput_(curNode);\r\n    } else if (connectionType === ConnectionType.NEXT_STATEMENT) {\r\n      this.showWithNext_(curNode);\r\n    } else if (curNode.getType() === ASTNode.types.PREVIOUS) {\r\n      this.showWithPrevious_(curNode);\r\n    } else if (curNode.getType() === ASTNode.types.FIELD) {\r\n      this.showWithField_(curNode);\r\n    } else if (curNode.getType() === ASTNode.types.WORKSPACE) {\r\n      this.showWithCoordinates_(curNode);\r\n    } else if (curNode.getType() === ASTNode.types.STACK) {\r\n      this.showWithStack_(curNode);\r\n    }\r\n  }\r\n\r\n  /**************************\r\n   * Display\r\n   **************************/\r\n\r\n  /**\r\n   * Show the marker as a combination of the previous connection and block,\r\n   * the output connection and block, or just the block.\r\n   *\r\n   * @param curNode The node to draw the marker for.\r\n   */\r\n  private showWithBlockPrevOutput(curNode: ASTNode) {\r\n    const block = curNode.getSourceBlock() as BlockSvg;\r\n    const width = block.width;\r\n    const height = block.height;\r\n    const markerHeight = height * HEIGHT_MULTIPLIER;\r\n    const markerOffset = this.constants_.CURSOR_BLOCK_PADDING;\r\n\r\n    if (block.previousConnection) {\r\n      const connectionShape = this.constants_.shapeFor(\r\n        block.previousConnection,\r\n      ) as Notch;\r\n      this.positionPrevious_(\r\n        width,\r\n        markerOffset,\r\n        markerHeight,\r\n        connectionShape,\r\n      );\r\n    } else if (block.outputConnection) {\r\n      const connectionShape = this.constants_.shapeFor(\r\n        block.outputConnection,\r\n      ) as PuzzleTab;\r\n      this.positionOutput_(width, height, connectionShape);\r\n    } else {\r\n      this.positionBlock_(width, markerOffset, markerHeight);\r\n    }\r\n    this.setParent_(block);\r\n    this.showCurrent_();\r\n  }\r\n\r\n  /**\r\n   * Position and display the marker for a block.\r\n   *\r\n   * @param curNode The node to draw the marker for.\r\n   */\r\n  protected showWithBlock_(curNode: ASTNode) {\r\n    this.showWithBlockPrevOutput(curNode);\r\n  }\r\n\r\n  /**\r\n   * Position and display the marker for a previous connection.\r\n   *\r\n   * @param curNode The node to draw the marker for.\r\n   */\r\n  protected showWithPrevious_(curNode: ASTNode) {\r\n    this.showWithBlockPrevOutput(curNode);\r\n  }\r\n\r\n  /**\r\n   * Position and display the marker for an output connection.\r\n   *\r\n   * @param curNode The node to draw the marker for.\r\n   */\r\n  protected showWithOutput_(curNode: ASTNode) {\r\n    this.showWithBlockPrevOutput(curNode);\r\n  }\r\n\r\n  /**\r\n   * Position and display the marker for a workspace coordinate.\r\n   * This is a horizontal line.\r\n   *\r\n   * @param curNode The node to draw the marker for.\r\n   */\r\n  protected showWithCoordinates_(curNode: ASTNode) {\r\n    const wsCoordinate = curNode.getWsCoordinate();\r\n    let x = wsCoordinate.x;\r\n    const y = wsCoordinate.y;\r\n\r\n    if (this.workspace.RTL) {\r\n      x -= this.constants_.CURSOR_WS_WIDTH;\r\n    }\r\n\r\n    this.positionLine_(x, y, this.constants_.CURSOR_WS_WIDTH);\r\n    this.setParent_(this.workspace);\r\n    this.showCurrent_();\r\n  }\r\n\r\n  /**\r\n   * Position and display the marker for a field.\r\n   * This is a box around the field.\r\n   *\r\n   * @param curNode The node to draw the marker for.\r\n   */\r\n  protected showWithField_(curNode: ASTNode) {\r\n    const field = curNode.getLocation() as Field;\r\n    const width = field.getSize().width;\r\n    const height = field.getSize().height;\r\n\r\n    this.positionRect_(0, 0, width, height);\r\n    this.setParent_(field);\r\n    this.showCurrent_();\r\n  }\r\n\r\n  /**\r\n   * Position and display the marker for an input.\r\n   * This is a puzzle piece.\r\n   *\r\n   * @param curNode The node to draw the marker for.\r\n   */\r\n  protected showWithInput_(curNode: ASTNode) {\r\n    const connection = curNode.getLocation() as RenderedConnection;\r\n    const sourceBlock = connection.getSourceBlock();\r\n\r\n    this.positionInput_(connection);\r\n    this.setParent_(sourceBlock);\r\n    this.showCurrent_();\r\n  }\r\n\r\n  /**\r\n   * Position and display the marker for a next connection.\r\n   * This is a horizontal line.\r\n   *\r\n   * @param curNode The node to draw the marker for.\r\n   */\r\n  protected showWithNext_(curNode: ASTNode) {\r\n    const connection = curNode.getLocation() as RenderedConnection;\r\n    const targetBlock = connection.getSourceBlock();\r\n    let x = 0;\r\n    const y = connection.getOffsetInBlock().y;\r\n    const width = targetBlock.getHeightWidth().width;\r\n    if (this.workspace.RTL) {\r\n      x = -width;\r\n    }\r\n    this.positionLine_(x, y, width);\r\n    this.setParent_(targetBlock);\r\n    this.showCurrent_();\r\n  }\r\n\r\n  /**\r\n   * Position and display the marker for a stack.\r\n   * This is a box with extra padding around the entire stack of blocks.\r\n   *\r\n   * @param curNode The node to draw the marker for.\r\n   */\r\n  protected showWithStack_(curNode: ASTNode) {\r\n    const block = curNode.getLocation() as BlockSvg;\r\n\r\n    // Gets the height and width of entire stack.\r\n    const heightWidth = block.getHeightWidth();\r\n\r\n    // Add padding so that being on a stack looks different than being on a\r\n    // block.\r\n    const width = heightWidth.width + this.constants_.CURSOR_STACK_PADDING;\r\n    const height = heightWidth.height + this.constants_.CURSOR_STACK_PADDING;\r\n\r\n    // Shift the rectangle slightly to upper left so padding is equal on all\r\n    // sides.\r\n    const xPadding = -this.constants_.CURSOR_STACK_PADDING / 2;\r\n    const yPadding = -this.constants_.CURSOR_STACK_PADDING / 2;\r\n\r\n    let x = xPadding;\r\n    const y = yPadding;\r\n\r\n    if (this.workspace.RTL) {\r\n      x = -(width + xPadding);\r\n    }\r\n    this.positionRect_(x, y, width, height);\r\n    this.setParent_(block);\r\n    this.showCurrent_();\r\n  }\r\n\r\n  /** Show the current marker. */\r\n  protected showCurrent_() {\r\n    this.hide();\r\n    if (this.currentMarkerSvg) {\r\n      this.currentMarkerSvg.style.display = '';\r\n    }\r\n  }\r\n\r\n  /**************************\r\n   * Position\r\n   **************************/\r\n\r\n  /**\r\n   * Position the marker for a block.\r\n   * Displays an outline of the top half of a rectangle around a block.\r\n   *\r\n   * @param width The width of the block.\r\n   * @param markerOffset The extra padding for around the block.\r\n   * @param markerHeight The height of the marker.\r\n   */\r\n  protected positionBlock_(\r\n    width: number,\r\n    markerOffset: number,\r\n    markerHeight: number,\r\n  ) {\r\n    const markerPath =\r\n      svgPaths.moveBy(-markerOffset, markerHeight) +\r\n      svgPaths.lineOnAxis('V', -markerOffset) +\r\n      svgPaths.lineOnAxis('H', width + markerOffset * 2) +\r\n      svgPaths.lineOnAxis('V', markerHeight);\r\n    if (!this.markerBlock_) {\r\n      throw new Error(\r\n        'createDom should be called before positioning the marker',\r\n      );\r\n    }\r\n    this.markerBlock_.setAttribute('d', markerPath);\r\n    if (this.workspace.RTL) {\r\n      this.flipRtl(this.markerBlock_);\r\n    }\r\n    this.currentMarkerSvg = this.markerBlock_;\r\n  }\r\n\r\n  /**\r\n   * Position the marker for an input connection.\r\n   * Displays a filled in puzzle piece.\r\n   *\r\n   * @param connection The connection to position marker around.\r\n   */\r\n  protected positionInput_(connection: RenderedConnection) {\r\n    const x = connection.getOffsetInBlock().x;\r\n    const y = connection.getOffsetInBlock().y;\r\n\r\n    const path =\r\n      svgPaths.moveTo(0, 0) +\r\n      (this.constants_.shapeFor(connection) as PuzzleTab).pathDown;\r\n\r\n    this.markerInput_!.setAttribute('d', path);\r\n    this.markerInput_!.setAttribute(\r\n      'transform',\r\n      'translate(' +\r\n        x +\r\n        ',' +\r\n        y +\r\n        ')' +\r\n        (this.workspace.RTL ? ' scale(-1 1)' : ''),\r\n    );\r\n    this.currentMarkerSvg = this.markerInput_;\r\n  }\r\n\r\n  /**\r\n   * Move and show the marker at the specified coordinate in workspace units.\r\n   * Displays a horizontal line.\r\n   *\r\n   * @param x The new x, in workspace units.\r\n   * @param y The new y, in workspace units.\r\n   * @param width The new width, in workspace units.\r\n   */\r\n  protected positionLine_(x: number, y: number, width: number) {\r\n    if (!this.markerSvgLine_) {\r\n      throw new Error('createDom should be called before positioning the line');\r\n    }\r\n    this.markerSvgLine_.setAttribute('x', `${x}`);\r\n    this.markerSvgLine_.setAttribute('y', `${y}`);\r\n    this.markerSvgLine_.setAttribute('width', `${width}`);\r\n    this.currentMarkerSvg = this.markerSvgLine_;\r\n  }\r\n\r\n  /**\r\n   * Position the marker for an output connection.\r\n   * Displays a puzzle outline and the top and bottom path.\r\n   *\r\n   * @param width The width of the block.\r\n   * @param height The height of the block.\r\n   * @param connectionShape The shape object for the connection.\r\n   */\r\n  protected positionOutput_(\r\n    width: number,\r\n    height: number,\r\n    connectionShape: PuzzleTab,\r\n  ) {\r\n    if (!this.markerBlock_) {\r\n      throw new Error(\r\n        'createDom should be called before positioning the output',\r\n      );\r\n    }\r\n    const markerPath =\r\n      svgPaths.moveBy(width, 0) +\r\n      svgPaths.lineOnAxis('h', -(width - connectionShape.width)) +\r\n      svgPaths.lineOnAxis('v', this.constants_.TAB_OFFSET_FROM_TOP) +\r\n      connectionShape.pathDown +\r\n      svgPaths.lineOnAxis('V', height) +\r\n      svgPaths.lineOnAxis('H', width);\r\n    this.markerBlock_.setAttribute('d', markerPath);\r\n    if (this.workspace.RTL) {\r\n      this.flipRtl(this.markerBlock_);\r\n    }\r\n    this.currentMarkerSvg = this.markerBlock_;\r\n  }\r\n\r\n  /**\r\n   * Position the marker for a previous connection.\r\n   * Displays a half rectangle with a notch in the top to represent the previous\r\n   * connection.\r\n   *\r\n   * @param width The width of the block.\r\n   * @param markerOffset The offset of the marker from around the block.\r\n   * @param markerHeight The height of the marker.\r\n   * @param connectionShape The shape object for the connection.\r\n   */\r\n  protected positionPrevious_(\r\n    width: number,\r\n    markerOffset: number,\r\n    markerHeight: number,\r\n    connectionShape: Notch,\r\n  ) {\r\n    if (!this.markerBlock_) {\r\n      throw new Error(\r\n        'createDom should be called before positioning the previous connection marker',\r\n      );\r\n    }\r\n    const markerPath =\r\n      svgPaths.moveBy(-markerOffset, markerHeight) +\r\n      svgPaths.lineOnAxis('V', -markerOffset) +\r\n      svgPaths.lineOnAxis('H', this.constants_.NOTCH_OFFSET_LEFT) +\r\n      connectionShape.pathLeft +\r\n      svgPaths.lineOnAxis('H', width + markerOffset * 2) +\r\n      svgPaths.lineOnAxis('V', markerHeight);\r\n    this.markerBlock_.setAttribute('d', markerPath);\r\n    if (this.workspace.RTL) {\r\n      this.flipRtl(this.markerBlock_);\r\n    }\r\n    this.currentMarkerSvg = this.markerBlock_;\r\n  }\r\n\r\n  /**\r\n   * Move and show the marker at the specified coordinate in workspace units.\r\n   * Displays a filled in rectangle.\r\n   *\r\n   * @param x The new x, in workspace units.\r\n   * @param y The new y, in workspace units.\r\n   * @param width The new width, in workspace units.\r\n   * @param height The new height, in workspace units.\r\n   */\r\n  protected positionRect_(x: number, y: number, width: number, height: number) {\r\n    if (!this.markerSvgRect_) {\r\n      throw new Error('createDom should be called before positioning the rect');\r\n    }\r\n    this.markerSvgRect_.setAttribute('x', `${x}`);\r\n    this.markerSvgRect_.setAttribute('y', `${y}`);\r\n    this.markerSvgRect_.setAttribute('width', `${width}`);\r\n    this.markerSvgRect_.setAttribute('height', `${height}`);\r\n    this.currentMarkerSvg = this.markerSvgRect_;\r\n  }\r\n\r\n  /**\r\n   * Flip the SVG paths in RTL.\r\n   *\r\n   * @param markerSvg The marker that we want to flip.\r\n   */\r\n  private flipRtl(markerSvg: SVGElement) {\r\n    markerSvg.setAttribute('transform', 'scale(-1 1)');\r\n  }\r\n\r\n  /** Hide the marker. */\r\n  hide() {\r\n    if (\r\n      !this.markerSvgLine_ ||\r\n      !this.markerSvgRect_ ||\r\n      !this.markerInput_ ||\r\n      !this.markerBlock_\r\n    ) {\r\n      throw new Error('createDom should be called before hiding the marker');\r\n    }\r\n    this.markerSvgLine_.style.display = 'none';\r\n    this.markerSvgRect_.style.display = 'none';\r\n    this.markerInput_.style.display = 'none';\r\n    this.markerBlock_.style.display = 'none';\r\n  }\r\n\r\n  /**\r\n   * Fire event for the marker or marker.\r\n   *\r\n   * @param oldNode The old node the marker used to be on.\r\n   * @param curNode The new node the marker is currently on.\r\n   */\r\n  private fireMarkerEvent(oldNode: ASTNode, curNode: ASTNode) {\r\n    const curBlock = curNode.getSourceBlock();\r\n    const event = new (eventUtils.get(eventUtils.MARKER_MOVE))(\r\n      curBlock,\r\n      this.isCursor(),\r\n      oldNode,\r\n      curNode,\r\n    );\r\n    eventUtils.fire(event);\r\n  }\r\n\r\n  /**\r\n   * Get the properties to make a marker blink.\r\n   *\r\n   * @returns The object holding attributes to make the marker blink.\r\n   */\r\n  protected getBlinkProperties_(): {[key: string]: string} {\r\n    return {\r\n      'attributeType': 'XML',\r\n      'attributeName': 'fill',\r\n      'dur': '1s',\r\n      'values': this.colour_ + ';transparent;transparent;',\r\n      'repeatCount': 'indefinite',\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Create the marker SVG.\r\n   *\r\n   * @returns The SVG node created.\r\n   */\r\n  protected createDomInternal_(): Element {\r\n    /* This markup will be generated and added to the .svgGroup_:\r\n        <g>\r\n          <rect width=\"100\" height=\"5\">\r\n            <animate attributeType=\"XML\" attributeName=\"fill\" dur=\"1s\"\r\n              values=\"transparent;transparent;#fff;transparent\"\r\n        repeatCount=\"indefinite\" />\r\n          </rect>\r\n        </g>\r\n        */\r\n\r\n    this.markerSvg_ = dom.createSvgElement(\r\n      Svg.G,\r\n      {\r\n        'width': this.constants_.CURSOR_WS_WIDTH,\r\n        'height': this.constants_.WS_CURSOR_HEIGHT,\r\n      },\r\n      this.svgGroup_,\r\n    );\r\n\r\n    // A horizontal line used to represent a workspace coordinate or next\r\n    // connection.\r\n    this.markerSvgLine_ = dom.createSvgElement(\r\n      Svg.RECT,\r\n      {\r\n        'width': this.constants_.CURSOR_WS_WIDTH,\r\n        'height': this.constants_.WS_CURSOR_HEIGHT,\r\n      },\r\n      this.markerSvg_,\r\n    );\r\n\r\n    // A filled in rectangle used to represent a stack.\r\n    this.markerSvgRect_ = dom.createSvgElement(\r\n      Svg.RECT,\r\n      {\r\n        'class': 'blocklyVerticalMarker',\r\n        'rx': 10,\r\n        'ry': 10,\r\n      },\r\n      this.markerSvg_,\r\n    );\r\n\r\n    // A filled in puzzle piece used to represent an input value.\r\n    this.markerInput_ = dom.createSvgElement(\r\n      Svg.PATH,\r\n      {'transform': ''},\r\n      this.markerSvg_,\r\n    );\r\n\r\n    // A path used to represent a previous connection and a block, an output\r\n    // connection and a block, or a block.\r\n    this.markerBlock_ = dom.createSvgElement(\r\n      Svg.PATH,\r\n      {\r\n        'transform': '',\r\n        'fill': 'none',\r\n        'stroke-width': this.constants_.CURSOR_STROKE_WIDTH,\r\n      },\r\n      this.markerSvg_,\r\n    );\r\n\r\n    this.hide();\r\n\r\n    // Markers and stack markers don't blink.\r\n    if (this.isCursor()) {\r\n      const blinkProperties = this.getBlinkProperties_();\r\n      dom.createSvgElement(Svg.ANIMATE, blinkProperties, this.markerSvgLine_);\r\n      dom.createSvgElement(Svg.ANIMATE, blinkProperties, this.markerInput_);\r\n      dom.createSvgElement(\r\n        Svg.ANIMATE,\r\n        {...blinkProperties, attributeName: 'stroke'},\r\n        this.markerBlock_,\r\n      );\r\n    }\r\n\r\n    return this.markerSvg_;\r\n  }\r\n\r\n  /**\r\n   * Apply the marker's colour.\r\n   *\r\n   * @param _curNode The node that we want to draw the marker for.\r\n   */\r\n  protected applyColour_(_curNode: ASTNode) {\r\n    if (\r\n      !this.markerSvgLine_ ||\r\n      !this.markerSvgRect_ ||\r\n      !this.markerInput_ ||\r\n      !this.markerBlock_\r\n    ) {\r\n      throw new Error(\r\n        'createDom should be called before applying color to the markerj',\r\n      );\r\n    }\r\n    this.markerSvgLine_.setAttribute('fill', this.colour_);\r\n    this.markerSvgRect_.setAttribute('stroke', this.colour_);\r\n    this.markerInput_.setAttribute('fill', this.colour_);\r\n    this.markerBlock_.setAttribute('stroke', this.colour_);\r\n\r\n    if (this.isCursor()) {\r\n      const values = this.colour_ + ';transparent;transparent;';\r\n      this.markerSvgLine_.firstElementChild!.setAttribute('values', values);\r\n      this.markerInput_.firstElementChild!.setAttribute('values', values);\r\n      this.markerBlock_.firstElementChild!.setAttribute('values', values);\r\n    }\r\n  }\r\n\r\n  /** Dispose of this marker. */\r\n  dispose() {\r\n    if (this.svgGroup_) {\r\n      dom.removeNode(this.svgGroup_);\r\n    }\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.blockRendering.PathObject\r\n\r\nimport type {BlockSvg} from '../../block_svg.js';\r\nimport type {Connection} from '../../connection.js';\r\nimport {RenderedConnection} from '../../rendered_connection.js';\r\nimport type {BlockStyle} from '../../theme.js';\r\nimport {Coordinate} from '../../utils/coordinate.js';\r\nimport * as dom from '../../utils/dom.js';\r\nimport {Svg} from '../../utils/svg.js';\r\n\r\nimport type {ConstantProvider} from './constants.js';\r\nimport type {IPathObject} from './i_path_object.js';\r\n\r\n/**\r\n * An object that handles creating and setting each of the SVG elements\r\n * used by the renderer.\r\n */\r\nexport class PathObject implements IPathObject {\r\n  svgRoot: SVGElement;\r\n  svgPath: SVGElement;\r\n\r\n  /**\r\n   * Holds the cursors svg element when the cursor is attached to the block.\r\n   * This is null if there is no cursor on the block.\r\n   */\r\n  cursorSvg: SVGElement | null = null;\r\n\r\n  /**\r\n   * Holds the markers svg element when the marker is attached to the block.\r\n   * This is null if there is no marker on the block.\r\n   */\r\n  markerSvg: SVGElement | null = null;\r\n\r\n  constants: ConstantProvider;\r\n  style: BlockStyle;\r\n\r\n  /** Highlight paths associated with connections. */\r\n  private connectionHighlights = new WeakMap<RenderedConnection, SVGElement>();\r\n\r\n  /** Locations of connection highlights. */\r\n  private highlightOffsets = new WeakMap<RenderedConnection, Coordinate>();\r\n\r\n  /**\r\n   * @param root The root SVG element.\r\n   * @param style The style object to use for colouring.\r\n   * @param constants The renderer's constants.\r\n   */\r\n  constructor(\r\n    root: SVGElement,\r\n    style: BlockStyle,\r\n    constants: ConstantProvider,\r\n  ) {\r\n    this.constants = constants;\r\n    this.style = style;\r\n    this.svgRoot = root;\r\n\r\n    /** The primary path of the block. */\r\n    this.svgPath = dom.createSvgElement(\r\n      Svg.PATH,\r\n      {'class': 'blocklyPath'},\r\n      this.svgRoot,\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Set the path generated by the renderer onto the respective SVG element.\r\n   *\r\n   * @param pathString The path.\r\n   */\r\n  setPath(pathString: string) {\r\n    this.svgPath.setAttribute('d', pathString);\r\n  }\r\n\r\n  /**\r\n   * Flip the SVG paths in RTL.\r\n   */\r\n  flipRTL() {\r\n    // Mirror the block's path.\r\n    this.svgPath.setAttribute('transform', 'scale(-1 1)');\r\n  }\r\n\r\n  /**\r\n   * Add the cursor SVG to this block's SVG group.\r\n   *\r\n   * @param cursorSvg The SVG root of the cursor to be added to the block SVG\r\n   *     group.\r\n   */\r\n  setCursorSvg(cursorSvg: SVGElement) {\r\n    if (!cursorSvg) {\r\n      this.cursorSvg = null;\r\n      return;\r\n    }\r\n\r\n    this.svgRoot.appendChild(cursorSvg);\r\n    this.cursorSvg = cursorSvg;\r\n  }\r\n\r\n  /**\r\n   * Add the marker SVG to this block's SVG group.\r\n   *\r\n   * @param markerSvg The SVG root of the marker to be added to the block SVG\r\n   *     group.\r\n   */\r\n  setMarkerSvg(markerSvg: SVGElement) {\r\n    if (!markerSvg) {\r\n      this.markerSvg = null;\r\n      return;\r\n    }\r\n\r\n    if (this.cursorSvg) {\r\n      this.svgRoot.insertBefore(markerSvg, this.cursorSvg);\r\n    } else {\r\n      this.svgRoot.appendChild(markerSvg);\r\n    }\r\n    this.markerSvg = markerSvg;\r\n  }\r\n\r\n  /**\r\n   * Apply the stored colours to the block's path, taking into account whether\r\n   * the paths belong to a shadow block.\r\n   *\r\n   * @param block The source block.\r\n   */\r\n  applyColour(block: BlockSvg) {\r\n    this.svgPath.setAttribute('stroke', this.style.colourTertiary);\r\n    this.svgPath.setAttribute('fill', this.style.colourPrimary);\r\n\r\n    this.updateShadow_(block.isShadow());\r\n    this.updateDisabled_(!block.isEnabled() || block.getInheritedDisabled());\r\n  }\r\n\r\n  /**\r\n   * Set the style.\r\n   *\r\n   * @param blockStyle The block style to use.\r\n   */\r\n  setStyle(blockStyle: BlockStyle) {\r\n    this.style = blockStyle;\r\n  }\r\n\r\n  /**\r\n   * Add or remove the given CSS class on the path object's root SVG element.\r\n   *\r\n   * @param className The name of the class to add or remove\r\n   * @param add True if the class should be added.  False if it should be\r\n   *     removed.\r\n   */\r\n  protected setClass_(className: string, add: boolean) {\r\n    if (!className) {\r\n      return;\r\n    }\r\n    if (add) {\r\n      dom.addClass(this.svgRoot, className);\r\n    } else {\r\n      dom.removeClass(this.svgRoot, className);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set whether the block shows a highlight or not.  Block highlighting is\r\n   * often used to visually mark blocks currently being executed.\r\n   *\r\n   * @param enable True if highlighted.\r\n   */\r\n  updateHighlighted(enable: boolean) {\r\n    if (enable) {\r\n      this.svgPath.setAttribute(\r\n        'filter',\r\n        'url(#' + this.constants.embossFilterId + ')',\r\n      );\r\n    } else {\r\n      this.svgPath.setAttribute('filter', 'none');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Updates the look of the block to reflect a shadow state.\r\n   *\r\n   * @param shadow True if the block is a shadow block.\r\n   */\r\n  protected updateShadow_(shadow: boolean) {\r\n    if (shadow) {\r\n      this.svgPath.setAttribute('stroke', 'none');\r\n      this.svgPath.setAttribute('fill', this.style.colourSecondary);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Updates the look of the block to reflect a disabled state.\r\n   *\r\n   * @param disabled True if disabled.\r\n   */\r\n  protected updateDisabled_(disabled: boolean) {\r\n    this.setClass_('blocklyDisabled', disabled);\r\n    if (disabled) {\r\n      this.svgPath.setAttribute(\r\n        'fill',\r\n        'url(#' + this.constants.disabledPatternId + ')',\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add or remove styling showing that a block is selected.\r\n   *\r\n   * @param enable True if selection is enabled, false otherwise.\r\n   */\r\n  updateSelected(enable: boolean) {\r\n    this.setClass_('blocklySelected', enable);\r\n  }\r\n\r\n  /**\r\n   * Add or remove styling showing that a block is dragged over a delete area.\r\n   *\r\n   * @param enable True if the block is being dragged over a delete area, false\r\n   *     otherwise.\r\n   */\r\n  updateDraggingDelete(enable: boolean) {\r\n    this.setClass_('blocklyDraggingDelete', enable);\r\n  }\r\n\r\n  /**\r\n   * Add or remove styling showing that a block is an insertion marker.\r\n   *\r\n   * @param enable True if the block is an insertion marker, false otherwise.\r\n   */\r\n  updateInsertionMarker(enable: boolean) {\r\n    this.setClass_('blocklyInsertionMarker', enable);\r\n  }\r\n\r\n  /**\r\n   * Add or remove styling showing that a block is movable.\r\n   *\r\n   * @param enable True if the block is movable, false otherwise.\r\n   */\r\n  updateMovable(enable: boolean) {\r\n    this.setClass_('blocklyDraggable', enable);\r\n  }\r\n\r\n  /**\r\n   * Add or remove styling that shows that if the dragging block is dropped,\r\n   * this block will be replaced.  If a shadow block, it will disappear.\r\n   * Otherwise it will bump.\r\n   *\r\n   * @param enable True if styling should be added.\r\n   */\r\n  updateReplacementFade(enable: boolean) {\r\n    this.setClass_('blocklyReplaceable', enable);\r\n  }\r\n\r\n  /**\r\n   * Add or remove styling that shows that if the dragging block is dropped,\r\n   * this block will be connected to the input.\r\n   *\r\n   * @param _conn The connection on the input to highlight.\r\n   * @param _enable True if styling should be added.\r\n   */\r\n  updateShapeForInputHighlight(_conn: Connection, _enable: boolean) {\r\n    // NOOP\r\n  }\r\n\r\n  /** Adds the given path as a connection highlight for the given connection. */\r\n  addConnectionHighlight(\r\n    connection: RenderedConnection,\r\n    connectionPath: string,\r\n    offset: Coordinate,\r\n    rtl: boolean,\r\n  ) {\r\n    if (this.connectionHighlights.has(connection)) {\r\n      if (this.currentHighlightMatchesNew(connection, connectionPath, offset)) {\r\n        return;\r\n      }\r\n      this.removeConnectionHighlight(connection);\r\n    }\r\n\r\n    const highlight = dom.createSvgElement(\r\n      Svg.PATH,\r\n      {\r\n        'class': 'blocklyHighlightedConnectionPath',\r\n        'd': connectionPath,\r\n        'transform':\r\n          `translate(${offset.x}, ${offset.y})` + (rtl ? ' scale(-1 1)' : ''),\r\n      },\r\n      this.svgRoot,\r\n    );\r\n    this.connectionHighlights.set(connection, highlight);\r\n  }\r\n\r\n  private currentHighlightMatchesNew(\r\n    connection: RenderedConnection,\r\n    newPath: string,\r\n    newOffset: Coordinate,\r\n  ): boolean {\r\n    const currPath = this.connectionHighlights\r\n      .get(connection)\r\n      ?.getAttribute('d');\r\n    const currOffset = this.highlightOffsets.get(connection);\r\n    return currPath === newPath && Coordinate.equals(currOffset, newOffset);\r\n  }\r\n\r\n  /**\r\n   * Removes any highlight associated with the given connection, if it exists.\r\n   */\r\n  removeConnectionHighlight(connection: RenderedConnection) {\r\n    const highlight = this.connectionHighlights.get(connection);\r\n    if (!highlight) return;\r\n    dom.removeNode(highlight);\r\n    this.connectionHighlights.delete(connection);\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2016 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.constants\r\n\r\n/**\r\n * The language-neutral ID given to the collapsed input.\r\n */\r\nexport const COLLAPSED_INPUT_NAME = '_TEMP_COLLAPSED_INPUT';\r\n\r\n/**\r\n * The language-neutral ID given to the collapsed field.\r\n */\r\nexport const COLLAPSED_FIELD_NAME = '_TEMP_COLLAPSED_FIELD';\r\n","/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Class that controls updates to connections during drags.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.InsertionMarkerManager\r\n\r\nimport {finishQueuedRenders} from './render_management.js';\r\nimport * as blockAnimations from './block_animations.js';\r\nimport type {BlockSvg} from './block_svg.js';\r\nimport * as common from './common.js';\r\nimport {ComponentManager} from './component_manager.js';\r\nimport {config} from './config.js';\r\nimport * as constants from './constants.js';\r\nimport * as eventUtils from './events/utils.js';\r\nimport type {IDeleteArea} from './interfaces/i_delete_area.js';\r\nimport type {IDragTarget} from './interfaces/i_drag_target.js';\r\nimport type {RenderedConnection} from './rendered_connection.js';\r\nimport type {Coordinate} from './utils/coordinate.js';\r\nimport type {WorkspaceSvg} from './workspace_svg.js';\r\nimport * as renderManagement from './render_management.js';\r\n\r\n/** Represents a nearby valid connection. */\r\ninterface CandidateConnection {\r\n  /**\r\n   * A nearby valid connection that is compatible with local.\r\n   * This is not on any of the blocks that are being dragged.\r\n   */\r\n  closest: RenderedConnection;\r\n  /**\r\n   * A connection on the dragging stack that is compatible with closest. This is\r\n   * on the top block that is being dragged or the last block in the dragging\r\n   * stack.\r\n   */\r\n  local: RenderedConnection;\r\n  radius: number;\r\n}\r\n\r\n/**\r\n * An error message to throw if the block created by createMarkerBlock_ is\r\n * missing any components.\r\n */\r\nconst DUPLICATE_BLOCK_ERROR =\r\n  'The insertion marker ' +\r\n  'manager tried to create a marker but the result is missing %1. If ' +\r\n  'you are using a mutator, make sure your domToMutation method is ' +\r\n  'properly defined.';\r\n\r\n/**\r\n * Class that controls updates to connections during drags.  It is primarily\r\n * responsible for finding the closest eligible connection and highlighting or\r\n * unhighlighting it as needed during a drag.\r\n *\r\n * @deprecated v10 - Use an IConnectionPreviewer instead.\r\n */\r\nexport class InsertionMarkerManager {\r\n  /**\r\n   * The top block in the stack being dragged.\r\n   * Does not change during a drag.\r\n   */\r\n  private readonly topBlock: BlockSvg;\r\n\r\n  /**\r\n   * The workspace on which these connections are being dragged.\r\n   * Does not change during a drag.\r\n   */\r\n  private readonly workspace: WorkspaceSvg;\r\n\r\n  /**\r\n   * The last connection on the stack, if it's not the last connection on the\r\n   * first block.\r\n   * Set in initAvailableConnections, if at all.\r\n   */\r\n  private lastOnStack: RenderedConnection | null = null;\r\n\r\n  /**\r\n   * The insertion marker corresponding to the last block in the stack, if\r\n   * that's not the same as the first block in the stack.\r\n   * Set in initAvailableConnections, if at all\r\n   */\r\n  private lastMarker: BlockSvg | null = null;\r\n\r\n  /**\r\n   * The insertion marker that shows up between blocks to show where a block\r\n   * would go if dropped immediately.\r\n   */\r\n  private firstMarker: BlockSvg;\r\n\r\n  /**\r\n   * Information about the connection that would be made if the dragging block\r\n   * were released immediately. Updated on every mouse move.\r\n   */\r\n  private activeCandidate: CandidateConnection | null = null;\r\n\r\n  /**\r\n   * Whether the block would be deleted if it were dropped immediately.\r\n   * Updated on every mouse move.\r\n   *\r\n   * @internal\r\n   */\r\n  public wouldDeleteBlock = false;\r\n\r\n  /**\r\n   * Connection on the insertion marker block that corresponds to\r\n   * the active candidate's local connection on the currently dragged block.\r\n   */\r\n  private markerConnection: RenderedConnection | null = null;\r\n\r\n  /** The block that currently has an input being highlighted, or null. */\r\n  private highlightedBlock: BlockSvg | null = null;\r\n\r\n  /** The block being faded to indicate replacement, or null. */\r\n  private fadedBlock: BlockSvg | null = null;\r\n\r\n  /**\r\n   * The connections on the dragging blocks that are available to connect to\r\n   * other blocks.  This includes all open connections on the top block, as\r\n   * well as the last connection on the block stack.\r\n   */\r\n  private availableConnections: RenderedConnection[];\r\n\r\n  /** @param block The top block in the stack being dragged. */\r\n  constructor(block: BlockSvg) {\r\n    common.setSelected(block);\r\n    this.topBlock = block;\r\n\r\n    this.workspace = block.workspace;\r\n\r\n    this.firstMarker = this.createMarkerBlock(this.topBlock);\r\n\r\n    this.availableConnections = this.initAvailableConnections();\r\n\r\n    if (this.lastOnStack) {\r\n      this.lastMarker = this.createMarkerBlock(\r\n        this.lastOnStack.getSourceBlock(),\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Sever all links from this object.\r\n   *\r\n   * @internal\r\n   */\r\n  dispose() {\r\n    this.availableConnections.length = 0;\r\n    this.disposeInsertionMarker(this.firstMarker);\r\n    this.disposeInsertionMarker(this.lastMarker);\r\n  }\r\n\r\n  /**\r\n   * Update the available connections for the top block. These connections can\r\n   * change if a block is unplugged and the stack is healed.\r\n   *\r\n   * @internal\r\n   */\r\n  updateAvailableConnections() {\r\n    this.availableConnections = this.initAvailableConnections();\r\n  }\r\n\r\n  /**\r\n   * Return whether the block would be connected if dropped immediately, based\r\n   * on information from the most recent move event.\r\n   *\r\n   * @returns True if the block would be connected if dropped immediately.\r\n   * @internal\r\n   */\r\n  wouldConnectBlock(): boolean {\r\n    return !!this.activeCandidate;\r\n  }\r\n\r\n  /**\r\n   * Connect to the closest connection and render the results.\r\n   * This should be called at the end of a drag.\r\n   *\r\n   * @internal\r\n   */\r\n  applyConnections() {\r\n    if (!this.activeCandidate) return;\r\n    eventUtils.disable();\r\n    this.hidePreview();\r\n    eventUtils.enable();\r\n    const {local, closest} = this.activeCandidate;\r\n    local.connect(closest);\r\n    if (this.topBlock.rendered) {\r\n      const inferiorConnection = local.isSuperior() ? closest : local;\r\n      const rootBlock = this.topBlock.getRootBlock();\r\n\r\n      finishQueuedRenders().then(() => {\r\n        blockAnimations.connectionUiEffect(inferiorConnection.getSourceBlock());\r\n        // bringToFront is incredibly expensive. Delay until the next frame.\r\n        setTimeout(() => {\r\n          rootBlock.bringToFront();\r\n        }, 0);\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update connections based on the most recent move location.\r\n   *\r\n   * @param dxy Position relative to drag start, in workspace units.\r\n   * @param dragTarget The drag target that the block is currently over.\r\n   * @internal\r\n   */\r\n  update(dxy: Coordinate, dragTarget: IDragTarget | null) {\r\n    const newCandidate = this.getCandidate(dxy);\r\n\r\n    this.wouldDeleteBlock = this.shouldDelete(!!newCandidate, dragTarget);\r\n\r\n    const shouldUpdate =\r\n      this.wouldDeleteBlock || this.shouldUpdatePreviews(newCandidate, dxy);\r\n\r\n    if (shouldUpdate) {\r\n      // Don't fire events for insertion marker creation or movement.\r\n      eventUtils.disable();\r\n      this.maybeHidePreview(newCandidate);\r\n      this.maybeShowPreview(newCandidate);\r\n      eventUtils.enable();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create an insertion marker that represents the given block.\r\n   *\r\n   * @param sourceBlock The block that the insertion marker will represent.\r\n   * @returns The insertion marker that represents the given block.\r\n   */\r\n  private createMarkerBlock(sourceBlock: BlockSvg): BlockSvg {\r\n    const imType = sourceBlock.type;\r\n\r\n    eventUtils.disable();\r\n    let result: BlockSvg;\r\n    try {\r\n      result = this.workspace.newBlock(imType);\r\n      result.setInsertionMarker(true);\r\n      if (sourceBlock.saveExtraState) {\r\n        const state = sourceBlock.saveExtraState(true);\r\n        if (state && result.loadExtraState) {\r\n          result.loadExtraState(state);\r\n        }\r\n      } else if (sourceBlock.mutationToDom) {\r\n        const oldMutationDom = sourceBlock.mutationToDom();\r\n        if (oldMutationDom && result.domToMutation) {\r\n          result.domToMutation(oldMutationDom);\r\n        }\r\n      }\r\n      // Copy field values from the other block.  These values may impact the\r\n      // rendered size of the insertion marker.  Note that we do not care about\r\n      // child blocks here.\r\n      for (let i = 0; i < sourceBlock.inputList.length; i++) {\r\n        const sourceInput = sourceBlock.inputList[i];\r\n        if (sourceInput.name === constants.COLLAPSED_INPUT_NAME) {\r\n          continue; // Ignore the collapsed input.\r\n        }\r\n        const resultInput = result.inputList[i];\r\n        if (!resultInput) {\r\n          throw new Error(DUPLICATE_BLOCK_ERROR.replace('%1', 'an input'));\r\n        }\r\n        for (let j = 0; j < sourceInput.fieldRow.length; j++) {\r\n          const sourceField = sourceInput.fieldRow[j];\r\n          const resultField = resultInput.fieldRow[j];\r\n          if (!resultField) {\r\n            throw new Error(DUPLICATE_BLOCK_ERROR.replace('%1', 'a field'));\r\n          }\r\n          resultField.setValue(sourceField.getValue());\r\n        }\r\n      }\r\n\r\n      for (const block of result.getDescendants(false)) {\r\n        block.setInsertionMarker(true);\r\n      }\r\n\r\n      result.setCollapsed(sourceBlock.isCollapsed());\r\n      result.setInputsInline(sourceBlock.getInputsInline());\r\n\r\n      result.initSvg();\r\n      result.getSvgRoot().setAttribute('visibility', 'hidden');\r\n    } finally {\r\n      eventUtils.enable();\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Populate the list of available connections on this block stack. If the\r\n   * stack has more than one block, this function will also update lastOnStack.\r\n   *\r\n   * @returns A list of available connections.\r\n   */\r\n  private initAvailableConnections(): RenderedConnection[] {\r\n    const available = this.topBlock.getConnections_(false);\r\n    // Also check the last connection on this stack\r\n    const lastOnStack = this.topBlock.lastConnectionInStack(true);\r\n    if (lastOnStack && lastOnStack !== this.topBlock.nextConnection) {\r\n      available.push(lastOnStack);\r\n      this.lastOnStack = lastOnStack;\r\n    }\r\n    return available;\r\n  }\r\n\r\n  /**\r\n   * Whether the previews (insertion marker and replacement marker) should be\r\n   * updated based on the closest candidate and the current drag distance.\r\n   *\r\n   * @param newCandidate A new candidate connection that may replace the current\r\n   *     best candidate.\r\n   * @param dxy Position relative to drag start, in workspace units.\r\n   * @returns Whether the preview should be updated.\r\n   */\r\n  private shouldUpdatePreviews(\r\n    newCandidate: CandidateConnection | null,\r\n    dxy: Coordinate,\r\n  ): boolean {\r\n    // Only need to update if we were showing a preview before.\r\n    if (!newCandidate) return !!this.activeCandidate;\r\n\r\n    // We weren't showing a preview before, but we should now.\r\n    if (!this.activeCandidate) return true;\r\n\r\n    // We're already showing an insertion marker.\r\n    // Decide whether the new connection has higher priority.\r\n    const {local: activeLocal, closest: activeClosest} = this.activeCandidate;\r\n    if (\r\n      activeClosest === newCandidate.closest &&\r\n      activeLocal === newCandidate.local\r\n    ) {\r\n      // The connection was the same as the current connection.\r\n      return false;\r\n    }\r\n\r\n    const xDiff = activeLocal.x + dxy.x - activeClosest.x;\r\n    const yDiff = activeLocal.y + dxy.y - activeClosest.y;\r\n    const curDistance = Math.sqrt(xDiff * xDiff + yDiff * yDiff);\r\n    // Slightly prefer the existing preview over a new preview.\r\n    return (\r\n      newCandidate.radius < curDistance - config.currentConnectionPreference\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Find the nearest valid connection, which may be the same as the current\r\n   * closest connection.\r\n   *\r\n   * @param dxy Position relative to drag start, in workspace units.\r\n   * @returns An object containing a local connection, a closest connection, and\r\n   *     a radius.\r\n   */\r\n  private getCandidate(dxy: Coordinate): CandidateConnection | null {\r\n    // It's possible that a block has added or removed connections during a\r\n    // drag, (e.g. in a drag/move event handler), so let's update the available\r\n    // connections. Note that this will be called on every move while dragging,\r\n    // so it might cause slowness, especially if the block stack is large.  If\r\n    // so, maybe it could be made more efficient. Also note that we won't update\r\n    // the connections if we've already connected the insertion marker to a\r\n    // block.\r\n    if (!this.markerConnection || !this.markerConnection.isConnected()) {\r\n      this.updateAvailableConnections();\r\n    }\r\n\r\n    let radius = this.getStartRadius();\r\n    let candidate = null;\r\n    for (let i = 0; i < this.availableConnections.length; i++) {\r\n      const myConnection = this.availableConnections[i];\r\n      const neighbour = myConnection.closest(radius, dxy);\r\n      if (neighbour.connection) {\r\n        candidate = {\r\n          closest: neighbour.connection,\r\n          local: myConnection,\r\n          radius: neighbour.radius,\r\n        };\r\n        radius = neighbour.radius;\r\n      }\r\n    }\r\n    return candidate;\r\n  }\r\n\r\n  /**\r\n   * Decide the radius at which to start searching for the closest connection.\r\n   *\r\n   * @returns The radius at which to start the search for the closest\r\n   *     connection.\r\n   */\r\n  private getStartRadius(): number {\r\n    // If there is already a connection highlighted,\r\n    // increase the radius we check for making new connections.\r\n    // When a connection is highlighted, blocks move around when the\r\n    // insertion marker is created, which could cause the connection became out\r\n    // of range. By increasing radiusConnection when a connection already\r\n    // exists, we never \"lose\" the connection from the offset.\r\n    return this.activeCandidate\r\n      ? config.connectingSnapRadius\r\n      : config.snapRadius;\r\n  }\r\n\r\n  /**\r\n   * Whether ending the drag would delete the block.\r\n   *\r\n   * @param newCandidate Whether there is a candidate connection that the\r\n   *     block could connect to if the drag ended immediately.\r\n   * @param dragTarget The drag target that the block is currently over.\r\n   * @returns Whether dropping the block immediately would delete the block.\r\n   */\r\n  private shouldDelete(\r\n    newCandidate: boolean,\r\n    dragTarget: IDragTarget | null,\r\n  ): boolean {\r\n    if (dragTarget) {\r\n      const componentManager = this.workspace.getComponentManager();\r\n      const isDeleteArea = componentManager.hasCapability(\r\n        dragTarget.id,\r\n        ComponentManager.Capability.DELETE_AREA,\r\n      );\r\n      if (isDeleteArea) {\r\n        return (dragTarget as IDeleteArea).wouldDelete(\r\n          this.topBlock,\r\n          newCandidate,\r\n        );\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Show an insertion marker or replacement highlighting during a drag, if\r\n   * needed.\r\n   * At the beginning of this function, this.activeConnection should be null.\r\n   *\r\n   * @param newCandidate A new candidate connection that may replace the current\r\n   *     best candidate.\r\n   */\r\n  private maybeShowPreview(newCandidate: CandidateConnection | null) {\r\n    if (this.wouldDeleteBlock) return; // Nope, don't add a marker.\r\n    if (!newCandidate) return; // Nothing to connect to.\r\n\r\n    const closest = newCandidate.closest;\r\n\r\n    // Something went wrong and we're trying to connect to an invalid\r\n    // connection.\r\n    if (\r\n      closest === this.activeCandidate?.closest ||\r\n      closest.getSourceBlock().isInsertionMarker()\r\n    ) {\r\n      console.log('Trying to connect to an insertion marker');\r\n      return;\r\n    }\r\n    this.activeCandidate = newCandidate;\r\n    // Add an insertion marker or replacement marker.\r\n    this.showPreview(this.activeCandidate);\r\n  }\r\n\r\n  /**\r\n   * A preview should be shown.  This function figures out if it should be a\r\n   * block highlight or an insertion marker, and shows the appropriate one.\r\n   *\r\n   * @param activeCandidate The connection that will be made if the drag ends\r\n   *     immediately.\r\n   */\r\n  private showPreview(activeCandidate: CandidateConnection) {\r\n    const renderer = this.workspace.getRenderer();\r\n    const method = renderer.getConnectionPreviewMethod(\r\n      activeCandidate.closest,\r\n      activeCandidate.local,\r\n      this.topBlock,\r\n    );\r\n\r\n    switch (method) {\r\n      case InsertionMarkerManager.PREVIEW_TYPE.INPUT_OUTLINE:\r\n        this.showInsertionInputOutline(activeCandidate);\r\n        break;\r\n      case InsertionMarkerManager.PREVIEW_TYPE.INSERTION_MARKER:\r\n        this.showInsertionMarker(activeCandidate);\r\n        break;\r\n      case InsertionMarkerManager.PREVIEW_TYPE.REPLACEMENT_FADE:\r\n        this.showReplacementFade(activeCandidate);\r\n        break;\r\n    }\r\n\r\n    // Optionally highlight the actual connection, as a nod to previous\r\n    // behaviour.\r\n    if (renderer.shouldHighlightConnection(activeCandidate.closest)) {\r\n      activeCandidate.closest.highlight();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Hide an insertion marker or replacement highlighting during a drag, if\r\n   * needed.\r\n   * At the end of this function, this.activeCandidate will be null.\r\n   *\r\n   * @param newCandidate A new candidate connection that may replace the current\r\n   *     best candidate.\r\n   */\r\n  private maybeHidePreview(newCandidate: CandidateConnection | null) {\r\n    // If there's no new preview, remove the old one but don't bother deleting\r\n    // it. We might need it later, and this saves disposing of it and recreating\r\n    // it.\r\n    if (!newCandidate) {\r\n      this.hidePreview();\r\n    } else {\r\n      if (this.activeCandidate) {\r\n        const closestChanged =\r\n          this.activeCandidate.closest !== newCandidate.closest;\r\n        const localChanged = this.activeCandidate.local !== newCandidate.local;\r\n\r\n        // If there's a new preview and there was a preview before, and either\r\n        // connection has changed, remove the old preview.\r\n        // Also hide if we had a preview before but now we're going to delete\r\n        // instead.\r\n        if (closestChanged || localChanged || this.wouldDeleteBlock) {\r\n          this.hidePreview();\r\n        }\r\n      }\r\n    }\r\n\r\n    // Either way, clear out old state.\r\n    this.markerConnection = null;\r\n    this.activeCandidate = null;\r\n  }\r\n\r\n  /**\r\n   * A preview should be hidden. Loop through all possible preview modes\r\n   * and hide everything.\r\n   */\r\n  private hidePreview() {\r\n    const closest = this.activeCandidate?.closest;\r\n    if (\r\n      closest &&\r\n      closest.targetBlock() &&\r\n      this.workspace.getRenderer().shouldHighlightConnection(closest)\r\n    ) {\r\n      closest.unhighlight();\r\n    }\r\n    this.hideReplacementFade();\r\n    this.hideInsertionInputOutline();\r\n    this.hideInsertionMarker();\r\n  }\r\n\r\n  /**\r\n   * Shows an insertion marker connected to the appropriate blocks (based on\r\n   * manager state).\r\n   *\r\n   * @param activeCandidate The connection that will be made if the drag ends\r\n   *     immediately.\r\n   */\r\n  private showInsertionMarker(activeCandidate: CandidateConnection) {\r\n    const {local, closest} = activeCandidate;\r\n\r\n    const isLastInStack = this.lastOnStack && local === this.lastOnStack;\r\n    let insertionMarker = isLastInStack ? this.lastMarker : this.firstMarker;\r\n    if (!insertionMarker) {\r\n      throw new Error(\r\n        'Cannot show the insertion marker because there is no insertion ' +\r\n          'marker block',\r\n      );\r\n    }\r\n    let imConn;\r\n    try {\r\n      imConn = insertionMarker.getMatchingConnection(\r\n        local.getSourceBlock(),\r\n        local,\r\n      );\r\n    } catch (e) {\r\n      // It's possible that the number of connections on the local block has\r\n      // changed since the insertion marker was originally created.  Let's\r\n      // recreate the insertion marker and try again. In theory we could\r\n      // probably recreate the marker block (e.g. in getCandidate_), which is\r\n      // called more often during the drag, but creating a block that often\r\n      // might be too slow, so we only do it if necessary.\r\n      if (isLastInStack && this.lastOnStack) {\r\n        this.disposeInsertionMarker(this.lastMarker);\r\n        this.lastMarker = this.createMarkerBlock(\r\n          this.lastOnStack.getSourceBlock(),\r\n        );\r\n        insertionMarker = this.lastMarker;\r\n      } else {\r\n        this.disposeInsertionMarker(this.firstMarker);\r\n        this.firstMarker = this.createMarkerBlock(this.topBlock);\r\n        insertionMarker = this.firstMarker;\r\n      }\r\n\r\n      if (!insertionMarker) {\r\n        throw new Error(\r\n          'Cannot show the insertion marker because there is no insertion ' +\r\n            'marker block',\r\n        );\r\n      }\r\n      imConn = insertionMarker.getMatchingConnection(\r\n        local.getSourceBlock(),\r\n        local,\r\n      );\r\n    }\r\n\r\n    if (!imConn) {\r\n      throw new Error(\r\n        'Cannot show the insertion marker because there is no ' +\r\n          'associated connection',\r\n      );\r\n    }\r\n\r\n    if (imConn === this.markerConnection) {\r\n      throw new Error(\r\n        \"Made it to showInsertionMarker_ even though the marker isn't \" +\r\n          'changing',\r\n      );\r\n    }\r\n\r\n    // Render disconnected from everything else so that we have a valid\r\n    // connection location.\r\n    insertionMarker.queueRender();\r\n    renderManagement.triggerQueuedRenders();\r\n\r\n    // Connect() also renders the insertion marker.\r\n    imConn.connect(closest);\r\n\r\n    const originalOffsetToTarget = {\r\n      x: closest.x - imConn.x,\r\n      y: closest.y - imConn.y,\r\n    };\r\n    const originalOffsetInBlock = imConn.getOffsetInBlock().clone();\r\n    const imConnConst = imConn;\r\n    renderManagement.finishQueuedRenders().then(() => {\r\n      // Position so that the existing block doesn't move.\r\n      insertionMarker?.positionNearConnection(\r\n        imConnConst,\r\n        originalOffsetToTarget,\r\n        originalOffsetInBlock,\r\n      );\r\n      insertionMarker?.getSvgRoot().setAttribute('visibility', 'visible');\r\n    });\r\n\r\n    this.markerConnection = imConn;\r\n  }\r\n\r\n  /**\r\n   * Disconnects and hides the current insertion marker. Should return the\r\n   * blocks to their original state.\r\n   */\r\n  private hideInsertionMarker() {\r\n    if (!this.markerConnection) return;\r\n\r\n    const markerConn = this.markerConnection;\r\n    const imBlock = markerConn.getSourceBlock();\r\n    const markerPrev = imBlock.previousConnection;\r\n    const markerOutput = imBlock.outputConnection;\r\n\r\n    if (!markerPrev?.targetConnection && !markerOutput?.targetConnection) {\r\n      // If we are the top block, unplugging doesn't do anything.\r\n      // The marker connection may not have a target block if we are hiding\r\n      // as part of applying connections.\r\n      markerConn.targetBlock()?.unplug(false);\r\n    } else {\r\n      imBlock.unplug(true);\r\n    }\r\n\r\n    if (markerConn.targetConnection) {\r\n      throw Error(\r\n        'markerConnection still connected at the end of ' +\r\n          'disconnectInsertionMarker',\r\n      );\r\n    }\r\n\r\n    this.markerConnection = null;\r\n    const svg = imBlock.getSvgRoot();\r\n    if (svg) {\r\n      svg.setAttribute('visibility', 'hidden');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Shows an outline around the input the closest connection belongs to.\r\n   *\r\n   * @param activeCandidate The connection that will be made if the drag ends\r\n   *     immediately.\r\n   */\r\n  private showInsertionInputOutline(activeCandidate: CandidateConnection) {\r\n    const closest = activeCandidate.closest;\r\n    this.highlightedBlock = closest.getSourceBlock();\r\n    this.highlightedBlock.highlightShapeForInput(closest, true);\r\n  }\r\n\r\n  /** Hides any visible input outlines. */\r\n  private hideInsertionInputOutline() {\r\n    if (!this.highlightedBlock) return;\r\n\r\n    if (!this.activeCandidate) {\r\n      throw new Error(\r\n        'Cannot hide the insertion marker outline because ' +\r\n          'there is no active candidate',\r\n      );\r\n    }\r\n    this.highlightedBlock.highlightShapeForInput(\r\n      this.activeCandidate.closest,\r\n      false,\r\n    );\r\n    this.highlightedBlock = null;\r\n  }\r\n\r\n  /**\r\n   * Shows a replacement fade affect on the closest connection's target block\r\n   * (the block that is currently connected to it).\r\n   *\r\n   * @param activeCandidate The connection that will be made if the drag ends\r\n   *     immediately.\r\n   */\r\n  private showReplacementFade(activeCandidate: CandidateConnection) {\r\n    this.fadedBlock = activeCandidate.closest.targetBlock();\r\n    if (!this.fadedBlock) {\r\n      throw new Error(\r\n        'Cannot show the replacement fade because the ' +\r\n          'closest connection does not have a target block',\r\n      );\r\n    }\r\n    this.fadedBlock.fadeForReplacement(true);\r\n  }\r\n\r\n  /**\r\n   * Hides/Removes any visible fade affects.\r\n   */\r\n  private hideReplacementFade() {\r\n    if (!this.fadedBlock) return;\r\n\r\n    this.fadedBlock.fadeForReplacement(false);\r\n    this.fadedBlock = null;\r\n  }\r\n\r\n  /**\r\n   * Get a list of the insertion markers that currently exist.  Drags have 0, 1,\r\n   * or 2 insertion markers.\r\n   *\r\n   * @returns A possibly empty list of insertion marker blocks.\r\n   * @internal\r\n   */\r\n  getInsertionMarkers(): BlockSvg[] {\r\n    const result = [];\r\n    if (this.firstMarker) {\r\n      result.push(this.firstMarker);\r\n    }\r\n    if (this.lastMarker) {\r\n      result.push(this.lastMarker);\r\n    }\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Safely disposes of an insertion marker.\r\n   */\r\n  private disposeInsertionMarker(marker: BlockSvg | null) {\r\n    if (marker) {\r\n      eventUtils.disable();\r\n      try {\r\n        marker.dispose();\r\n      } finally {\r\n        eventUtils.enable();\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport namespace InsertionMarkerManager {\r\n  /**\r\n   * An enum describing different kinds of previews the InsertionMarkerManager\r\n   * could display.\r\n   */\r\n  export enum PREVIEW_TYPE {\r\n    INSERTION_MARKER = 0,\r\n    INPUT_OUTLINE = 1,\r\n    REPLACEMENT_FADE = 2,\r\n  }\r\n}\r\n\r\nexport type PreviewType = InsertionMarkerManager.PREVIEW_TYPE;\r\nexport const PreviewType = InsertionMarkerManager.PREVIEW_TYPE;\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.blockRendering.Renderer\r\n\r\nimport type {Block} from '../../block.js';\r\nimport type {BlockSvg} from '../../block_svg.js';\r\nimport {Connection} from '../../connection.js';\r\nimport {ConnectionType} from '../../connection_type.js';\r\nimport {\r\n  InsertionMarkerManager,\r\n  PreviewType,\r\n} from '../../insertion_marker_manager.js';\r\nimport type {IRegistrable} from '../../interfaces/i_registrable.js';\r\nimport type {Marker} from '../../keyboard_nav/marker.js';\r\nimport type {RenderedConnection} from '../../rendered_connection.js';\r\nimport type {BlockStyle, Theme} from '../../theme.js';\r\nimport type {WorkspaceSvg} from '../../workspace_svg.js';\r\n\r\nimport {ConstantProvider} from './constants.js';\r\nimport {Drawer} from './drawer.js';\r\nimport type {IPathObject} from './i_path_object.js';\r\nimport {RenderInfo} from './info.js';\r\nimport {MarkerSvg} from './marker_svg.js';\r\nimport {PathObject} from './path_object.js';\r\nimport * as deprecation from '../../utils/deprecation.js';\r\n\r\n/**\r\n * The base class for a block renderer.\r\n */\r\nexport class Renderer implements IRegistrable {\r\n  /** The renderer's constant provider. */\r\n  protected constants_!: ConstantProvider;\r\n\r\n  protected name: string;\r\n\r\n  /**\r\n   * Rendering constant overrides, passed in through options.\r\n   */\r\n  protected overrides: object | null = null;\r\n\r\n  /**\r\n   * @param name The renderer name.\r\n   */\r\n  constructor(name: string) {\r\n    this.name = name;\r\n  }\r\n\r\n  /**\r\n   * Gets the class name that identifies this renderer.\r\n   *\r\n   * @returns The CSS class name.\r\n   */\r\n  getClassName(): string {\r\n    return this.name + '-renderer';\r\n  }\r\n\r\n  /**\r\n   * Initialize the renderer.\r\n   *\r\n   * @param theme The workspace theme object.\r\n   * @param opt_rendererOverrides Rendering constant overrides.\r\n   */\r\n  init(\r\n    theme: Theme,\r\n    opt_rendererOverrides?: {[rendererConstant: string]: any},\r\n  ) {\r\n    this.constants_ = this.makeConstants_();\r\n    if (opt_rendererOverrides) {\r\n      this.overrides = opt_rendererOverrides;\r\n      Object.assign(this.constants_, opt_rendererOverrides);\r\n    }\r\n    this.constants_.setTheme(theme);\r\n    this.constants_.init();\r\n  }\r\n\r\n  /**\r\n   * Create any DOM elements that this renderer needs.\r\n   * If you need to create additional DOM elements, override the\r\n   * {@link ConstantProvider#createDom} method instead.\r\n   *\r\n   * @param svg The root of the workspace's SVG.\r\n   * @param theme The workspace theme object.\r\n   * @internal\r\n   */\r\n  createDom(svg: SVGElement, theme: Theme) {\r\n    this.constants_.createDom(\r\n      svg,\r\n      this.name + '-' + theme.name,\r\n      '.' + this.getClassName() + '.' + theme.getClassName(),\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Refresh the renderer after a theme change.\r\n   *\r\n   * @param svg The root of the workspace's SVG.\r\n   * @param theme The workspace theme object.\r\n   */\r\n  refreshDom(svg: SVGElement, theme: Theme) {\r\n    const previousConstants = this.getConstants();\r\n    previousConstants.dispose();\r\n    this.constants_ = this.makeConstants_();\r\n    if (this.overrides) {\r\n      Object.assign(this.constants_, this.overrides);\r\n    }\r\n    // Ensure the constant provider's random identifier does not change.\r\n    this.constants_.randomIdentifier = previousConstants.randomIdentifier;\r\n    this.constants_.setTheme(theme);\r\n    this.constants_.init();\r\n    this.createDom(svg, theme);\r\n  }\r\n\r\n  /**\r\n   * Dispose of this renderer.\r\n   * Delete all DOM elements that this renderer and its constants created.\r\n   */\r\n  dispose() {\r\n    if (this.constants_) {\r\n      this.constants_.dispose();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create a new instance of the renderer's constant provider.\r\n   *\r\n   * @returns The constant provider.\r\n   */\r\n  protected makeConstants_(): ConstantProvider {\r\n    return new ConstantProvider();\r\n  }\r\n\r\n  /**\r\n   * Create a new instance of the renderer's render info object.\r\n   *\r\n   * @param block The block to measure.\r\n   * @returns The render info object.\r\n   */\r\n  protected makeRenderInfo_(block: BlockSvg): RenderInfo {\r\n    return new RenderInfo(this, block);\r\n  }\r\n\r\n  /**\r\n   * Create a new instance of the renderer's drawer.\r\n   *\r\n   * @param block The block to render.\r\n   * @param info An object containing all information needed to render this\r\n   *     block.\r\n   * @returns The drawer.\r\n   */\r\n  protected makeDrawer_(block: BlockSvg, info: RenderInfo): Drawer {\r\n    return new Drawer(block, info);\r\n  }\r\n\r\n  /**\r\n   * Create a new instance of the renderer's marker drawer.\r\n   *\r\n   * @param workspace The workspace the marker belongs to.\r\n   * @param marker The marker.\r\n   * @returns The object in charge of drawing the marker.\r\n   */\r\n  makeMarkerDrawer(workspace: WorkspaceSvg, marker: Marker): MarkerSvg {\r\n    return new MarkerSvg(workspace, this.getConstants(), marker);\r\n  }\r\n\r\n  /**\r\n   * Create a new instance of a renderer path object.\r\n   *\r\n   * @param root The root SVG element.\r\n   * @param style The style object to use for colouring.\r\n   * @returns The renderer path object.\r\n   */\r\n  makePathObject(root: SVGElement, style: BlockStyle): IPathObject {\r\n    return new PathObject(root, style, this.constants_);\r\n  }\r\n\r\n  /**\r\n   * Get the current renderer's constant provider.  We assume that when this is\r\n   * called, the renderer has already been initialized.\r\n   *\r\n   * @returns The constant provider.\r\n   */\r\n  getConstants(): ConstantProvider {\r\n    return this.constants_;\r\n  }\r\n\r\n  /**\r\n   * Determine whether or not to highlight a connection.\r\n   *\r\n   * @param _conn The connection to determine whether or not to highlight.\r\n   * @returns True if we should highlight the connection.\r\n   */\r\n  shouldHighlightConnection(_conn: Connection): boolean {\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Checks if an orphaned block can connect to the \"end\" of the topBlock's\r\n   * block-clump. If the clump is a row the end is the last input. If the clump\r\n   * is a stack, the end is the last next connection. If the clump is neither,\r\n   * then this returns false.\r\n   *\r\n   * @param topBlock The top block of the block clump we want to try and connect\r\n   *     to.\r\n   * @param orphanBlock The orphan block that wants to find a home.\r\n   * @param localType The type of the connection being dragged.\r\n   * @returns Whether there is a home for the orphan or not.\r\n   */\r\n  protected orphanCanConnectAtEnd(\r\n    topBlock: BlockSvg,\r\n    orphanBlock: BlockSvg,\r\n    localType: number,\r\n  ): boolean {\r\n    const orphanConnection =\r\n      localType === ConnectionType.OUTPUT_VALUE\r\n        ? orphanBlock.outputConnection\r\n        : orphanBlock.previousConnection;\r\n    return !!Connection.getConnectionForOrphanedConnection(\r\n      topBlock as Block,\r\n      orphanConnection as Connection,\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Chooses a connection preview method based on the available connection, the\r\n   * current dragged connection, and the block being dragged.\r\n   *\r\n   * @param closest The available connection.\r\n   * @param local The connection currently being dragged.\r\n   * @param topBlock The block currently being dragged.\r\n   * @returns The preview type to display.\r\n   *\r\n   * @deprecated v10 - This function is no longer respected. A custom\r\n   *    IConnectionPreviewer may be able to fulfill the functionality.\r\n   */\r\n  getConnectionPreviewMethod(\r\n    closest: RenderedConnection,\r\n    local: RenderedConnection,\r\n    topBlock: BlockSvg,\r\n  ): PreviewType {\r\n    deprecation.warn(\r\n      'getConnectionPreviewMethod',\r\n      'v10',\r\n      'v12',\r\n      'an IConnectionPreviewer, if it fulfills your use case.',\r\n    );\r\n    if (\r\n      local.type === ConnectionType.OUTPUT_VALUE ||\r\n      local.type === ConnectionType.PREVIOUS_STATEMENT\r\n    ) {\r\n      if (\r\n        !closest.isConnected() ||\r\n        this.orphanCanConnectAtEnd(\r\n          topBlock,\r\n          closest.targetBlock() as BlockSvg,\r\n          local.type,\r\n        )\r\n      ) {\r\n        return InsertionMarkerManager.PREVIEW_TYPE.INSERTION_MARKER;\r\n      }\r\n      return InsertionMarkerManager.PREVIEW_TYPE.REPLACEMENT_FADE;\r\n    }\r\n\r\n    return InsertionMarkerManager.PREVIEW_TYPE.INSERTION_MARKER;\r\n  }\r\n\r\n  /**\r\n   * Render the block.\r\n   *\r\n   * @param block The block to render.\r\n   * @internal\r\n   */\r\n  render(block: BlockSvg) {\r\n    const info = this.makeRenderInfo_(block);\r\n    info.measure();\r\n    this.makeDrawer_(block, info).draw();\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Object in charge of storing and updating a workspace theme\r\n *     and UI components.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.ThemeManager\r\n\r\nimport type {Theme} from './theme.js';\r\nimport * as arrayUtils from './utils/array.js';\r\nimport * as dom from './utils/dom.js';\r\nimport type {Workspace} from './workspace.js';\r\nimport type {WorkspaceSvg} from './workspace_svg.js';\r\n\r\n/**\r\n * Class for storing and updating a workspace's theme and UI components.\r\n */\r\nexport class ThemeManager {\r\n  /** A list of workspaces that are subscribed to this theme. */\r\n  private subscribedWorkspaces_: Workspace[] = [];\r\n  private componentDB = new Map<string, Component[]>();\r\n\r\n  /**\r\n   * @param workspace The main workspace.\r\n   * @param theme The workspace theme.\r\n   * @internal\r\n   */\r\n  constructor(\r\n    private readonly workspace: WorkspaceSvg,\r\n    private theme: Theme,\r\n  ) {}\r\n\r\n  /**\r\n   * Get the workspace theme.\r\n   *\r\n   * @returns The workspace theme.\r\n   * @internal\r\n   */\r\n  getTheme(): Theme {\r\n    return this.theme;\r\n  }\r\n\r\n  /**\r\n   * Set the workspace theme, and refresh the workspace and all components.\r\n   *\r\n   * @param theme The workspace theme.\r\n   * @internal\r\n   */\r\n  setTheme(theme: Theme) {\r\n    const prevTheme = this.theme;\r\n    this.theme = theme;\r\n    // Set the theme name onto the injection div.\r\n    const injectionDiv = this.workspace.getInjectionDiv();\r\n    if (injectionDiv) {\r\n      if (prevTheme) {\r\n        const oldClassName = prevTheme.getClassName();\r\n        if (oldClassName) {\r\n          dom.removeClass(injectionDiv, oldClassName);\r\n        }\r\n      }\r\n      const newClassName = this.theme.getClassName();\r\n      if (newClassName) {\r\n        dom.addClass(injectionDiv, newClassName);\r\n      }\r\n    }\r\n\r\n    // Refresh all subscribed workspaces.\r\n    for (\r\n      let i = 0, workspace;\r\n      (workspace = this.subscribedWorkspaces_[i]);\r\n      i++\r\n    ) {\r\n      (workspace as WorkspaceSvg).refreshTheme();\r\n    }\r\n\r\n    // Refresh all registered Blockly UI components.\r\n    for (const [key, componentList] of this.componentDB) {\r\n      for (const component of componentList) {\r\n        const element = component.element;\r\n        const propertyName = component.propertyName;\r\n        const style = this.theme && this.theme.getComponentStyle(key);\r\n        element.style.setProperty(propertyName, style || '');\r\n      }\r\n    }\r\n\r\n    for (const workspace of this.subscribedWorkspaces_) {\r\n      (workspace as WorkspaceSvg).hideChaff();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Subscribe a workspace to changes to the selected theme.  If a new theme is\r\n   * set, the workspace is called to refresh its blocks.\r\n   *\r\n   * @param workspace The workspace to subscribe.\r\n   * @internal\r\n   */\r\n  subscribeWorkspace(workspace: Workspace) {\r\n    this.subscribedWorkspaces_.push(workspace);\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe a workspace to changes to the selected theme.\r\n   *\r\n   * @param workspace The workspace to unsubscribe.\r\n   * @internal\r\n   */\r\n  unsubscribeWorkspace(workspace: Workspace) {\r\n    if (!arrayUtils.removeElem(this.subscribedWorkspaces_, workspace)) {\r\n      throw Error(\r\n        \"Cannot unsubscribe a workspace that hasn't been subscribed.\",\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Subscribe an element to changes to the selected theme.  If a new theme is\r\n   * selected, the element's style is refreshed with the new theme's style.\r\n   *\r\n   * @param element The element to subscribe.\r\n   * @param componentName The name used to identify the component. This must be\r\n   *     the same name used to configure the style in the Theme object.\r\n   * @param propertyName The inline style property name to update.\r\n   * @internal\r\n   */\r\n  subscribe(\r\n    element: HTMLElement | SVGElement,\r\n    componentName: string,\r\n    propertyName: string,\r\n  ) {\r\n    if (!this.componentDB.has(componentName)) {\r\n      this.componentDB.set(componentName, []);\r\n    }\r\n\r\n    // Add the element to our component map.\r\n    this.componentDB.get(componentName)!.push({element, propertyName});\r\n\r\n    // Initialize the element with its corresponding theme style.\r\n    const style = this.theme && this.theme.getComponentStyle(componentName);\r\n    element.style.setProperty(propertyName, style || '');\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe an element to changes to the selected theme.\r\n   *\r\n   * @param element The element to unsubscribe.\r\n   * @internal\r\n   */\r\n  unsubscribe(element: HTMLElement | SVGElement) {\r\n    if (!element) {\r\n      return;\r\n    }\r\n    // Go through all component, and remove any references to this element.\r\n    for (const [componentName, elements] of this.componentDB) {\r\n      for (let i = elements.length - 1; i >= 0; i--) {\r\n        if (elements[i].element === element) {\r\n          elements.splice(i, 1);\r\n        }\r\n      }\r\n      // Clean up the component map entry if the list is empty.\r\n      if (!elements.length) {\r\n        this.componentDB.delete(componentName);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Dispose of this theme manager.\r\n   *\r\n   * @internal\r\n   */\r\n  dispose() {\r\n    this.subscribedWorkspaces_.length = 0;\r\n    this.componentDB.clear();\r\n  }\r\n}\r\n\r\nexport namespace ThemeManager {\r\n  /** The type for a Blockly UI Component. */\r\n  export interface Component {\r\n    element: HTMLElement | SVGElement;\r\n    propertyName: string;\r\n  }\r\n}\r\n\r\nexport type Component = ThemeManager.Component;\r\n","/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * An object that encapsulates logic for checking whether a\r\n * potential connection is safe and valid.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.ConnectionChecker\r\n\r\nimport * as common from './common.js';\r\nimport {Connection} from './connection.js';\r\nimport {ConnectionType} from './connection_type.js';\r\nimport type {IConnectionChecker} from './interfaces/i_connection_checker.js';\r\nimport * as internalConstants from './internal_constants.js';\r\nimport * as registry from './registry.js';\r\nimport type {RenderedConnection} from './rendered_connection.js';\r\n\r\n/**\r\n * Class for connection type checking logic.\r\n */\r\nexport class ConnectionChecker implements IConnectionChecker {\r\n  /**\r\n   * Check whether the current connection can connect with the target\r\n   * connection.\r\n   *\r\n   * @param a Connection to check compatibility with.\r\n   * @param b Connection to check compatibility with.\r\n   * @param isDragging True if the connection is being made by dragging a block.\r\n   * @param opt_distance The max allowable distance between the connections for\r\n   *     drag checks.\r\n   * @returns Whether the connection is legal.\r\n   */\r\n  canConnect(\r\n    a: Connection | null,\r\n    b: Connection | null,\r\n    isDragging: boolean,\r\n    opt_distance?: number,\r\n  ): boolean {\r\n    return (\r\n      this.canConnectWithReason(a, b, isDragging, opt_distance) ===\r\n      Connection.CAN_CONNECT\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Checks whether the current connection can connect with the target\r\n   * connection, and return an error code if there are problems.\r\n   *\r\n   * @param a Connection to check compatibility with.\r\n   * @param b Connection to check compatibility with.\r\n   * @param isDragging True if the connection is being made by dragging a block.\r\n   * @param opt_distance The max allowable distance between the connections for\r\n   *     drag checks.\r\n   * @returns Connection.CAN_CONNECT if the connection is legal, an error code\r\n   *     otherwise.\r\n   */\r\n  canConnectWithReason(\r\n    a: Connection | null,\r\n    b: Connection | null,\r\n    isDragging: boolean,\r\n    opt_distance?: number,\r\n  ): number {\r\n    const safety = this.doSafetyChecks(a, b);\r\n    if (safety !== Connection.CAN_CONNECT) {\r\n      return safety;\r\n    }\r\n\r\n    // If the safety checks passed, both connections are non-null.\r\n    const connOne = a!;\r\n    const connTwo = b!;\r\n    if (!this.doTypeChecks(connOne, connTwo)) {\r\n      return Connection.REASON_CHECKS_FAILED;\r\n    }\r\n\r\n    if (\r\n      isDragging &&\r\n      !this.doDragChecks(\r\n        a as RenderedConnection,\r\n        b as RenderedConnection,\r\n        opt_distance || 0,\r\n      )\r\n    ) {\r\n      return Connection.REASON_DRAG_CHECKS_FAILED;\r\n    }\r\n\r\n    return Connection.CAN_CONNECT;\r\n  }\r\n\r\n  /**\r\n   * Helper method that translates a connection error code into a string.\r\n   *\r\n   * @param errorCode The error code.\r\n   * @param a One of the two connections being checked.\r\n   * @param b The second of the two connections being checked.\r\n   * @returns A developer-readable error string.\r\n   */\r\n  getErrorMessage(\r\n    errorCode: number,\r\n    a: Connection | null,\r\n    b: Connection | null,\r\n  ): string {\r\n    switch (errorCode) {\r\n      case Connection.REASON_SELF_CONNECTION:\r\n        return 'Attempted to connect a block to itself.';\r\n      case Connection.REASON_DIFFERENT_WORKSPACES:\r\n        // Usually this means one block has been deleted.\r\n        return 'Blocks not on same workspace.';\r\n      case Connection.REASON_WRONG_TYPE:\r\n        return 'Attempt to connect incompatible types.';\r\n      case Connection.REASON_TARGET_NULL:\r\n        return 'Target connection is null.';\r\n      case Connection.REASON_CHECKS_FAILED: {\r\n        const connOne = a!;\r\n        const connTwo = b!;\r\n        let msg = 'Connection checks failed. ';\r\n        msg +=\r\n          connOne +\r\n          ' expected ' +\r\n          connOne.getCheck() +\r\n          ', found ' +\r\n          connTwo.getCheck();\r\n        return msg;\r\n      }\r\n      case Connection.REASON_SHADOW_PARENT:\r\n        return 'Connecting non-shadow to shadow block.';\r\n      case Connection.REASON_DRAG_CHECKS_FAILED:\r\n        return 'Drag checks failed.';\r\n      case Connection.REASON_PREVIOUS_AND_OUTPUT:\r\n        return 'Block would have an output and a previous connection.';\r\n      default:\r\n        return 'Unknown connection failure: this should never happen!';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check that connecting the given connections is safe, meaning that it would\r\n   * not break any of Blockly's basic assumptions (e.g. no self connections).\r\n   *\r\n   * @param a The first of the connections to check.\r\n   * @param b The second of the connections to check.\r\n   * @returns An enum with the reason this connection is safe or unsafe.\r\n   */\r\n  doSafetyChecks(a: Connection | null, b: Connection | null): number {\r\n    if (!a || !b) {\r\n      return Connection.REASON_TARGET_NULL;\r\n    }\r\n    let superiorBlock;\r\n    let inferiorBlock;\r\n    let superiorConnection;\r\n    let inferiorConnection;\r\n    if (a.isSuperior()) {\r\n      superiorBlock = a.getSourceBlock();\r\n      inferiorBlock = b.getSourceBlock();\r\n      superiorConnection = a;\r\n      inferiorConnection = b;\r\n    } else {\r\n      inferiorBlock = a.getSourceBlock();\r\n      superiorBlock = b.getSourceBlock();\r\n      inferiorConnection = a;\r\n      superiorConnection = b;\r\n    }\r\n    if (superiorBlock === inferiorBlock) {\r\n      return Connection.REASON_SELF_CONNECTION;\r\n    } else if (\r\n      inferiorConnection.type !==\r\n      internalConstants.OPPOSITE_TYPE[superiorConnection.type]\r\n    ) {\r\n      return Connection.REASON_WRONG_TYPE;\r\n    } else if (superiorBlock.workspace !== inferiorBlock.workspace) {\r\n      return Connection.REASON_DIFFERENT_WORKSPACES;\r\n    } else if (superiorBlock.isShadow() && !inferiorBlock.isShadow()) {\r\n      return Connection.REASON_SHADOW_PARENT;\r\n    } else if (\r\n      inferiorConnection.type === ConnectionType.OUTPUT_VALUE &&\r\n      inferiorBlock.previousConnection &&\r\n      inferiorBlock.previousConnection.isConnected()\r\n    ) {\r\n      return Connection.REASON_PREVIOUS_AND_OUTPUT;\r\n    } else if (\r\n      inferiorConnection.type === ConnectionType.PREVIOUS_STATEMENT &&\r\n      inferiorBlock.outputConnection &&\r\n      inferiorBlock.outputConnection.isConnected()\r\n    ) {\r\n      return Connection.REASON_PREVIOUS_AND_OUTPUT;\r\n    }\r\n    return Connection.CAN_CONNECT;\r\n  }\r\n\r\n  /**\r\n   * Check whether this connection is compatible with another connection with\r\n   * respect to the value type system.  E.g. square_root(\"Hello\") is not\r\n   * compatible.\r\n   *\r\n   * @param a Connection to compare.\r\n   * @param b Connection to compare against.\r\n   * @returns True if the connections share a type.\r\n   */\r\n  doTypeChecks(a: Connection, b: Connection): boolean {\r\n    const checkArrayOne = a.getCheck();\r\n    const checkArrayTwo = b.getCheck();\r\n\r\n    if (!checkArrayOne || !checkArrayTwo) {\r\n      // One or both sides are promiscuous enough that anything will fit.\r\n      return true;\r\n    }\r\n    // Find any intersection in the check lists.\r\n    for (let i = 0; i < checkArrayOne.length; i++) {\r\n      if (checkArrayTwo.indexOf(checkArrayOne[i]) !== -1) {\r\n        return true;\r\n      }\r\n    }\r\n    // No intersection.\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Check whether this connection can be made by dragging.\r\n   *\r\n   * @param a Connection to compare (on the block that's being dragged).\r\n   * @param b Connection to compare against.\r\n   * @param distance The maximum allowable distance between connections.\r\n   * @returns True if the connection is allowed during a drag.\r\n   */\r\n  doDragChecks(\r\n    a: RenderedConnection,\r\n    b: RenderedConnection,\r\n    distance: number,\r\n  ): boolean {\r\n    if (a.distanceFrom(b) > distance) {\r\n      return false;\r\n    }\r\n\r\n    // Don't consider insertion markers.\r\n    if (b.getSourceBlock().isInsertionMarker()) {\r\n      return false;\r\n    }\r\n\r\n    switch (b.type) {\r\n      case ConnectionType.PREVIOUS_STATEMENT:\r\n        return this.canConnectToPrevious_(a, b);\r\n      case ConnectionType.OUTPUT_VALUE: {\r\n        // Don't offer to connect an already connected left (male) value plug to\r\n        // an available right (female) value plug.\r\n        if (\r\n          (b.isConnected() && !b.targetBlock()!.isInsertionMarker()) ||\r\n          a.isConnected()\r\n        ) {\r\n          return false;\r\n        }\r\n        break;\r\n      }\r\n      case ConnectionType.INPUT_VALUE: {\r\n        // Offering to connect the left (male) of a value block to an already\r\n        // connected value pair is ok, we'll splice it in.\r\n        // However, don't offer to splice into an immovable block.\r\n        if (\r\n          b.isConnected() &&\r\n          !b.targetBlock()!.isMovable() &&\r\n          !b.targetBlock()!.isShadow()\r\n        ) {\r\n          return false;\r\n        }\r\n        break;\r\n      }\r\n      case ConnectionType.NEXT_STATEMENT: {\r\n        // Don't let a block with no next connection bump other blocks out of\r\n        // the stack.  But covering up a shadow block or stack of shadow blocks\r\n        // is fine.  Similarly, replacing a terminal statement with another\r\n        // terminal statement is allowed.\r\n        if (\r\n          b.isConnected() &&\r\n          !a.getSourceBlock().nextConnection &&\r\n          !b.targetBlock()!.isShadow() &&\r\n          b.targetBlock()!.nextConnection\r\n        ) {\r\n          return false;\r\n        }\r\n\r\n        // Don't offer to splice into a stack where the connected block is\r\n        // immovable, unless the block is a shadow block.\r\n        if (\r\n          b.targetBlock() &&\r\n          !b.targetBlock()!.isMovable() &&\r\n          !b.targetBlock()!.isShadow()\r\n        ) {\r\n          return false;\r\n        }\r\n        break;\r\n      }\r\n      default:\r\n        // Unexpected connection type.\r\n        return false;\r\n    }\r\n\r\n    // Don't let blocks try to connect to themselves or ones they nest.\r\n    if (common.draggingConnections.indexOf(b) !== -1) {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Helper function for drag checking.\r\n   *\r\n   * @param a The connection to check, which must be a statement input or next\r\n   *     connection.\r\n   * @param b A nearby connection to check, which must be a previous connection.\r\n   * @returns True if the connection is allowed, false otherwise.\r\n   */\r\n  protected canConnectToPrevious_(a: Connection, b: Connection): boolean {\r\n    if (a.targetConnection) {\r\n      // This connection is already occupied.\r\n      // A next connection will never disconnect itself mid-drag.\r\n      return false;\r\n    }\r\n\r\n    // Don't let blocks try to connect to themselves or ones they nest.\r\n    if (common.draggingConnections.indexOf(b) !== -1) {\r\n      return false;\r\n    }\r\n\r\n    if (!b.targetConnection) {\r\n      return true;\r\n    }\r\n\r\n    const targetBlock = b.targetBlock();\r\n    // If it is connected to a real block, game over.\r\n    if (!targetBlock!.isInsertionMarker()) {\r\n      return false;\r\n    }\r\n    // If it's connected to an insertion marker but that insertion marker\r\n    // is the first block in a stack, it's still fine.  If that insertion\r\n    // marker is in the middle of a stack, it won't work.\r\n    return !targetBlock!.getPreviousBlock();\r\n  }\r\n}\r\n\r\nregistry.register(\r\n  registry.Type.CONNECTION_CHECKER,\r\n  registry.DEFAULT,\r\n  ConnectionChecker,\r\n);\r\n","/**\r\n * @license\r\n * Copyright 2018 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.Events.VarDelete\r\n\r\nimport * as registry from '../registry.js';\r\nimport type {VariableModel} from '../variable_model.js';\r\n\r\nimport {VarBase, VarBaseJson} from './events_var_base.js';\r\nimport * as eventUtils from './utils.js';\r\nimport type {Workspace} from '../workspace.js';\r\n\r\n/**\r\n * Notifies listeners that a variable model has been deleted.\r\n *\r\n * @class\r\n */\r\nexport class VarDelete extends VarBase {\r\n  override type = eventUtils.VAR_DELETE;\r\n  /** The type of the variable that was deleted. */\r\n  varType?: string;\r\n  /** The name of the variable that was deleted. */\r\n  varName?: string;\r\n\r\n  /**\r\n   * @param opt_variable The deleted variable. Undefined for a blank event.\r\n   */\r\n  constructor(opt_variable?: VariableModel) {\r\n    super(opt_variable);\r\n\r\n    if (!opt_variable) {\r\n      return; // Blank event to be populated by fromJson.\r\n    }\r\n    this.varType = opt_variable.type;\r\n    this.varName = opt_variable.name;\r\n  }\r\n\r\n  /**\r\n   * Encode the event as JSON.\r\n   *\r\n   * @returns JSON representation.\r\n   */\r\n  override toJson(): VarDeleteJson {\r\n    const json = super.toJson() as VarDeleteJson;\r\n    if (this.varType === undefined) {\r\n      throw new Error(\r\n        'The var type is undefined. Either pass a variable to ' +\r\n          'the constructor, or call fromJson',\r\n      );\r\n    }\r\n    if (!this.varName) {\r\n      throw new Error(\r\n        'The var name is undefined. Either pass a variable to ' +\r\n          'the constructor, or call fromJson',\r\n      );\r\n    }\r\n    json['varType'] = this.varType;\r\n    json['varName'] = this.varName;\r\n    return json;\r\n  }\r\n\r\n  /**\r\n   * Deserializes the JSON event.\r\n   *\r\n   * @param event The event to append new properties to. Should be a subclass\r\n   *     of VarDelete, but we can't specify that due to the fact that parameters\r\n   *     to static methods in subclasses must be supertypes of parameters to\r\n   *     static methods in superclasses.\r\n   * @internal\r\n   */\r\n  static fromJson(\r\n    json: VarDeleteJson,\r\n    workspace: Workspace,\r\n    event?: any,\r\n  ): VarDelete {\r\n    const newEvent = super.fromJson(\r\n      json,\r\n      workspace,\r\n      event ?? new VarDelete(),\r\n    ) as VarDelete;\r\n    newEvent.varType = json['varType'];\r\n    newEvent.varName = json['varName'];\r\n    return newEvent;\r\n  }\r\n\r\n  /**\r\n   * Run a variable deletion event.\r\n   *\r\n   * @param forward True if run forward, false if run backward (undo).\r\n   */\r\n  override run(forward: boolean) {\r\n    const workspace = this.getEventWorkspace_();\r\n    if (!this.varId) {\r\n      throw new Error(\r\n        'The var ID is undefined. Either pass a variable to ' +\r\n          'the constructor, or call fromJson',\r\n      );\r\n    }\r\n    if (!this.varName) {\r\n      throw new Error(\r\n        'The var name is undefined. Either pass a variable to ' +\r\n          'the constructor, or call fromJson',\r\n      );\r\n    }\r\n    if (forward) {\r\n      workspace.deleteVariableById(this.varId);\r\n    } else {\r\n      workspace.createVariable(this.varName, this.varType, this.varId);\r\n    }\r\n  }\r\n}\r\n\r\nexport interface VarDeleteJson extends VarBaseJson {\r\n  varType: string;\r\n  varName: string;\r\n}\r\n\r\nregistry.register(registry.Type.EVENT, eventUtils.VAR_DELETE, VarDelete);\r\n","/**\r\n * @license\r\n * Copyright 2018 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.Events.VarRename\r\n\r\nimport * as registry from '../registry.js';\r\nimport type {VariableModel} from '../variable_model.js';\r\n\r\nimport {VarBase, VarBaseJson} from './events_var_base.js';\r\nimport * as eventUtils from './utils.js';\r\nimport type {Workspace} from '../workspace.js';\r\n\r\n/**\r\n * Notifies listeners that a variable model was renamed.\r\n *\r\n * @class\r\n */\r\nexport class VarRename extends VarBase {\r\n  override type = eventUtils.VAR_RENAME;\r\n\r\n  /** The previous name of the variable. */\r\n  oldName?: string;\r\n\r\n  /** The new name of the variable. */\r\n  newName?: string;\r\n\r\n  /**\r\n   * @param opt_variable The renamed variable. Undefined for a blank event.\r\n   * @param newName The new name the variable will be changed to.\r\n   */\r\n  constructor(opt_variable?: VariableModel, newName?: string) {\r\n    super(opt_variable);\r\n\r\n    if (!opt_variable) {\r\n      return; // Blank event to be populated by fromJson.\r\n    }\r\n    this.oldName = opt_variable.name;\r\n    this.newName = typeof newName === 'undefined' ? '' : newName;\r\n  }\r\n\r\n  /**\r\n   * Encode the event as JSON.\r\n   *\r\n   * @returns JSON representation.\r\n   */\r\n  override toJson(): VarRenameJson {\r\n    const json = super.toJson() as VarRenameJson;\r\n    if (!this.oldName) {\r\n      throw new Error(\r\n        'The old var name is undefined. Either pass a variable to ' +\r\n          'the constructor, or call fromJson',\r\n      );\r\n    }\r\n    if (!this.newName) {\r\n      throw new Error(\r\n        'The new var name is undefined. Either pass a value to ' +\r\n          'the constructor, or call fromJson',\r\n      );\r\n    }\r\n    json['oldName'] = this.oldName;\r\n    json['newName'] = this.newName;\r\n    return json;\r\n  }\r\n\r\n  /**\r\n   * Deserializes the JSON event.\r\n   *\r\n   * @param event The event to append new properties to. Should be a subclass\r\n   *     of VarRename, but we can't specify that due to the fact that parameters\r\n   *     to static methods in subclasses must be supertypes of parameters to\r\n   *     static methods in superclasses.\r\n   * @internal\r\n   */\r\n  static fromJson(\r\n    json: VarRenameJson,\r\n    workspace: Workspace,\r\n    event?: any,\r\n  ): VarRename {\r\n    const newEvent = super.fromJson(\r\n      json,\r\n      workspace,\r\n      event ?? new VarRename(),\r\n    ) as VarRename;\r\n    newEvent.oldName = json['oldName'];\r\n    newEvent.newName = json['newName'];\r\n    return newEvent;\r\n  }\r\n\r\n  /**\r\n   * Run a variable rename event.\r\n   *\r\n   * @param forward True if run forward, false if run backward (undo).\r\n   */\r\n  override run(forward: boolean) {\r\n    const workspace = this.getEventWorkspace_();\r\n    if (!this.varId) {\r\n      throw new Error(\r\n        'The var ID is undefined. Either pass a variable to ' +\r\n          'the constructor, or call fromJson',\r\n      );\r\n    }\r\n    if (!this.oldName) {\r\n      throw new Error(\r\n        'The old var name is undefined. Either pass a variable to ' +\r\n          'the constructor, or call fromJson',\r\n      );\r\n    }\r\n    if (!this.newName) {\r\n      throw new Error(\r\n        'The new var name is undefined. Either pass a value to ' +\r\n          'the constructor, or call fromJson',\r\n      );\r\n    }\r\n    if (forward) {\r\n      workspace.renameVariableById(this.varId, this.newName);\r\n    } else {\r\n      workspace.renameVariableById(this.varId, this.oldName);\r\n    }\r\n  }\r\n}\r\n\r\nexport interface VarRenameJson extends VarBaseJson {\r\n  oldName: string;\r\n  newName: string;\r\n}\r\n\r\nregistry.register(registry.Type.EVENT, eventUtils.VAR_RENAME, VarRename);\r\n","/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Object representing a map of variables and their types.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.VariableMap\r\n\r\n// Unused import preserved for side-effects. Remove if unneeded.\r\nimport './events/events_var_delete.js';\r\n// Unused import preserved for side-effects. Remove if unneeded.\r\nimport './events/events_var_rename.js';\r\n\r\nimport type {Block} from './block.js';\r\nimport * as dialog from './dialog.js';\r\nimport * as eventUtils from './events/utils.js';\r\nimport {Msg} from './msg.js';\r\nimport {Names} from './names.js';\r\nimport * as arrayUtils from './utils/array.js';\r\nimport * as idGenerator from './utils/idgenerator.js';\r\nimport {VariableModel} from './variable_model.js';\r\nimport type {Workspace} from './workspace.js';\r\n\r\n/**\r\n * Class for a variable map.  This contains a dictionary data structure with\r\n * variable types as keys and lists of variables as values.  The list of\r\n * variables are the type indicated by the key.\r\n */\r\nexport class VariableMap {\r\n  /**\r\n   * A map from variable type to list of variable names.  The lists contain\r\n   * all of the named variables in the workspace, including variables that are\r\n   * not currently in use.\r\n   */\r\n  private variableMap = new Map<string, VariableModel[]>();\r\n\r\n  /** @param workspace The workspace this map belongs to. */\r\n  constructor(public workspace: Workspace) {}\r\n\r\n  /** Clear the variable map.  Fires events for every deletion. */\r\n  clear() {\r\n    for (const variables of this.variableMap.values()) {\r\n      while (variables.length > 0) {\r\n        this.deleteVariable(variables[0]);\r\n      }\r\n    }\r\n    if (this.variableMap.size !== 0) {\r\n      throw Error('Non-empty variable map');\r\n    }\r\n  }\r\n\r\n  /* Begin functions for renaming variables. */\r\n  /**\r\n   * Rename the given variable by updating its name in the variable map.\r\n   *\r\n   * @param variable Variable to rename.\r\n   * @param newName New variable name.\r\n   * @internal\r\n   */\r\n  renameVariable(variable: VariableModel, newName: string) {\r\n    if (variable.name === newName) return;\r\n    const type = variable.type;\r\n    const conflictVar = this.getVariable(newName, type);\r\n    const blocks = this.workspace.getAllBlocks(false);\r\n    const existingGroup = eventUtils.getGroup();\r\n    if (!existingGroup) {\r\n      eventUtils.setGroup(true);\r\n    }\r\n    try {\r\n      // The IDs may match if the rename is a simple case change (name1 ->\r\n      // Name1).\r\n      if (!conflictVar || conflictVar.getId() === variable.getId()) {\r\n        this.renameVariableAndUses_(variable, newName, blocks);\r\n      } else {\r\n        this.renameVariableWithConflict_(\r\n          variable,\r\n          newName,\r\n          conflictVar,\r\n          blocks,\r\n        );\r\n      }\r\n    } finally {\r\n      eventUtils.setGroup(existingGroup);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Rename a variable by updating its name in the variable map. Identify the\r\n   * variable to rename with the given ID.\r\n   *\r\n   * @param id ID of the variable to rename.\r\n   * @param newName New variable name.\r\n   */\r\n  renameVariableById(id: string, newName: string) {\r\n    const variable = this.getVariableById(id);\r\n    if (!variable) {\r\n      throw Error(\"Tried to rename a variable that didn't exist. ID: \" + id);\r\n    }\r\n\r\n    this.renameVariable(variable, newName);\r\n  }\r\n\r\n  /**\r\n   * Update the name of the given variable and refresh all references to it.\r\n   * The new name must not conflict with any existing variable names.\r\n   *\r\n   * @param variable Variable to rename.\r\n   * @param newName New variable name.\r\n   * @param blocks The list of all blocks in the workspace.\r\n   */\r\n  private renameVariableAndUses_(\r\n    variable: VariableModel,\r\n    newName: string,\r\n    blocks: Block[],\r\n  ) {\r\n    eventUtils.fire(\r\n      new (eventUtils.get(eventUtils.VAR_RENAME))(variable, newName),\r\n    );\r\n    variable.name = newName;\r\n    for (let i = 0; i < blocks.length; i++) {\r\n      blocks[i].updateVarName(variable);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update the name of the given variable to the same name as an existing\r\n   * variable.  The two variables are coalesced into a single variable with the\r\n   * ID of the existing variable that was already using newName. Refresh all\r\n   * references to the variable.\r\n   *\r\n   * @param variable Variable to rename.\r\n   * @param newName New variable name.\r\n   * @param conflictVar The variable that was already using newName.\r\n   * @param blocks The list of all blocks in the workspace.\r\n   */\r\n  private renameVariableWithConflict_(\r\n    variable: VariableModel,\r\n    newName: string,\r\n    conflictVar: VariableModel,\r\n    blocks: Block[],\r\n  ) {\r\n    const type = variable.type;\r\n    const oldCase = conflictVar.name;\r\n\r\n    if (newName !== oldCase) {\r\n      // Simple rename to change the case and update references.\r\n      this.renameVariableAndUses_(conflictVar, newName, blocks);\r\n    }\r\n\r\n    // These blocks now refer to a different variable.\r\n    // These will fire change events.\r\n    for (let i = 0; i < blocks.length; i++) {\r\n      blocks[i].renameVarById(variable.getId(), conflictVar.getId());\r\n    }\r\n    // Finally delete the original variable, which is now unreferenced.\r\n    eventUtils.fire(new (eventUtils.get(eventUtils.VAR_DELETE))(variable));\r\n    // And remove it from the list.\r\n    arrayUtils.removeElem(this.variableMap.get(type)!, variable);\r\n  }\r\n\r\n  /* End functions for renaming variables. */\r\n  /**\r\n   * Create a variable with a given name, optional type, and optional ID.\r\n   *\r\n   * @param name The name of the variable. This must be unique across variables\r\n   *     and procedures.\r\n   * @param opt_type The type of the variable like 'int' or 'string'.\r\n   *     Does not need to be unique. Field_variable can filter variables based\r\n   * on their type. This will default to '' which is a specific type.\r\n   * @param opt_id The unique ID of the variable. This will default to a UUID.\r\n   * @returns The newly created variable.\r\n   */\r\n  createVariable(\r\n    name: string,\r\n    opt_type?: string | null,\r\n    opt_id?: string | null,\r\n  ): VariableModel {\r\n    let variable = this.getVariable(name, opt_type);\r\n    if (variable) {\r\n      if (opt_id && variable.getId() !== opt_id) {\r\n        throw Error(\r\n          'Variable \"' +\r\n            name +\r\n            '\" is already in use and its id is \"' +\r\n            variable.getId() +\r\n            '\" which conflicts with the passed in ' +\r\n            'id, \"' +\r\n            opt_id +\r\n            '\".',\r\n        );\r\n      }\r\n      // The variable already exists and has the same ID.\r\n      return variable;\r\n    }\r\n    if (opt_id && this.getVariableById(opt_id)) {\r\n      throw Error('Variable id, \"' + opt_id + '\", is already in use.');\r\n    }\r\n    const id = opt_id || idGenerator.genUid();\r\n    const type = opt_type || '';\r\n    variable = new VariableModel(this.workspace, name, type, id);\r\n\r\n    const variables = this.variableMap.get(type) || [];\r\n    variables.push(variable);\r\n    // Delete the list of variables of this type, and re-add it so that\r\n    // the most recent addition is at the end.\r\n    // This is used so the toolbox's set block is set to the most recent\r\n    // variable.\r\n    this.variableMap.delete(type);\r\n    this.variableMap.set(type, variables);\r\n\r\n    eventUtils.fire(new (eventUtils.get(eventUtils.VAR_CREATE))(variable));\r\n\r\n    return variable;\r\n  }\r\n\r\n  /* Begin functions for variable deletion. */\r\n  /**\r\n   * Delete a variable.\r\n   *\r\n   * @param variable Variable to delete.\r\n   */\r\n  deleteVariable(variable: VariableModel) {\r\n    const variableId = variable.getId();\r\n    const variableList = this.variableMap.get(variable.type);\r\n    if (variableList) {\r\n      for (let i = 0; i < variableList.length; i++) {\r\n        const tempVar = variableList[i];\r\n        if (tempVar.getId() === variableId) {\r\n          variableList.splice(i, 1);\r\n          eventUtils.fire(\r\n            new (eventUtils.get(eventUtils.VAR_DELETE))(variable),\r\n          );\r\n          if (variableList.length === 0) {\r\n            this.variableMap.delete(variable.type);\r\n          }\r\n          return;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Delete a variables by the passed in ID and all of its uses from this\r\n   * workspace. May prompt the user for confirmation.\r\n   *\r\n   * @param id ID of variable to delete.\r\n   */\r\n  deleteVariableById(id: string) {\r\n    const variable = this.getVariableById(id);\r\n    if (variable) {\r\n      // Check whether this variable is a function parameter before deleting.\r\n      const variableName = variable.name;\r\n      const uses = this.getVariableUsesById(id);\r\n      for (let i = 0, block; (block = uses[i]); i++) {\r\n        if (\r\n          block.type === 'procedures_defnoreturn' ||\r\n          block.type === 'procedures_defreturn'\r\n        ) {\r\n          const procedureName = String(block.getFieldValue('NAME'));\r\n          const deleteText = Msg['CANNOT_DELETE_VARIABLE_PROCEDURE']\r\n            .replace('%1', variableName)\r\n            .replace('%2', procedureName);\r\n          dialog.alert(deleteText);\r\n          return;\r\n        }\r\n      }\r\n\r\n      if (uses.length > 1) {\r\n        // Confirm before deleting multiple blocks.\r\n        const confirmText = Msg['DELETE_VARIABLE_CONFIRMATION']\r\n          .replace('%1', String(uses.length))\r\n          .replace('%2', variableName);\r\n        dialog.confirm(confirmText, (ok) => {\r\n          if (ok && variable) {\r\n            this.deleteVariableInternal(variable, uses);\r\n          }\r\n        });\r\n      } else {\r\n        // No confirmation necessary for a single block.\r\n        this.deleteVariableInternal(variable, uses);\r\n      }\r\n    } else {\r\n      console.warn(\"Can't delete non-existent variable: \" + id);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Deletes a variable and all of its uses from this workspace without asking\r\n   * the user for confirmation.\r\n   *\r\n   * @param variable Variable to delete.\r\n   * @param uses An array of uses of the variable.\r\n   * @internal\r\n   */\r\n  deleteVariableInternal(variable: VariableModel, uses: Block[]) {\r\n    const existingGroup = eventUtils.getGroup();\r\n    if (!existingGroup) {\r\n      eventUtils.setGroup(true);\r\n    }\r\n    try {\r\n      for (let i = 0; i < uses.length; i++) {\r\n        uses[i].dispose(true);\r\n      }\r\n      this.deleteVariable(variable);\r\n    } finally {\r\n      eventUtils.setGroup(existingGroup);\r\n    }\r\n  }\r\n  /* End functions for variable deletion. */\r\n  /**\r\n   * Find the variable by the given name and type and return it.  Return null if\r\n   *     it is not found.\r\n   *\r\n   * @param name The name to check for.\r\n   * @param opt_type The type of the variable.  If not provided it defaults to\r\n   *     the empty string, which is a specific type.\r\n   * @returns The variable with the given name, or null if it was not found.\r\n   */\r\n  getVariable(name: string, opt_type?: string | null): VariableModel | null {\r\n    const type = opt_type || '';\r\n    const list = this.variableMap.get(type);\r\n    if (list) {\r\n      for (let j = 0, variable; (variable = list[j]); j++) {\r\n        if (Names.equals(variable.name, name)) {\r\n          return variable;\r\n        }\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Find the variable by the given ID and return it.  Return null if not found.\r\n   *\r\n   * @param id The ID to check for.\r\n   * @returns The variable with the given ID.\r\n   */\r\n  getVariableById(id: string): VariableModel | null {\r\n    for (const variables of this.variableMap.values()) {\r\n      for (const variable of variables) {\r\n        if (variable.getId() === id) {\r\n          return variable;\r\n        }\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Get a list containing all of the variables of a specified type. If type is\r\n   *     null, return list of variables with empty string type.\r\n   *\r\n   * @param type Type of the variables to find.\r\n   * @returns The sought after variables of the passed in type. An empty array\r\n   *     if none are found.\r\n   */\r\n  getVariablesOfType(type: string | null): VariableModel[] {\r\n    type = type || '';\r\n    const variableList = this.variableMap.get(type);\r\n    if (variableList) {\r\n      return variableList.slice();\r\n    }\r\n    return [];\r\n  }\r\n\r\n  /**\r\n   * Return all variable and potential variable types.  This list always\r\n   * contains the empty string.\r\n   *\r\n   * @param ws The workspace used to look for potential variables. This can be\r\n   *     different than the workspace stored on this object if the passed in ws\r\n   *     is a flyout workspace.\r\n   * @returns List of variable types.\r\n   * @internal\r\n   */\r\n  getVariableTypes(ws: Workspace | null): string[] {\r\n    const variableTypes = new Set<string>(this.variableMap.keys());\r\n    if (ws && ws.getPotentialVariableMap()) {\r\n      for (const key of ws.getPotentialVariableMap()!.variableMap.keys()) {\r\n        variableTypes.add(key);\r\n      }\r\n    }\r\n    if (!variableTypes.has('')) {\r\n      variableTypes.add('');\r\n    }\r\n    return Array.from(variableTypes.values());\r\n  }\r\n\r\n  /**\r\n   * Return all variables of all types.\r\n   *\r\n   * @returns List of variable models.\r\n   */\r\n  getAllVariables(): VariableModel[] {\r\n    let allVariables: VariableModel[] = [];\r\n    for (const variables of this.variableMap.values()) {\r\n      allVariables = allVariables.concat(variables);\r\n    }\r\n    return allVariables;\r\n  }\r\n\r\n  /**\r\n   * Returns all of the variable names of all types.\r\n   *\r\n   * @returns All of the variable names of all types.\r\n   */\r\n  getAllVariableNames(): string[] {\r\n    return Array.from(this.variableMap.values())\r\n      .flat()\r\n      .map((variable) => variable.name);\r\n  }\r\n\r\n  /**\r\n   * Find all the uses of a named variable.\r\n   *\r\n   * @param id ID of the variable to find.\r\n   * @returns Array of block usages.\r\n   */\r\n  getVariableUsesById(id: string): Block[] {\r\n    const uses = [];\r\n    const blocks = this.workspace.getAllBlocks(false);\r\n    // Iterate through every block and check the name.\r\n    for (let i = 0; i < blocks.length; i++) {\r\n      const blockVariables = blocks[i].getVarModels();\r\n      if (blockVariables) {\r\n        for (let j = 0; j < blockVariables.length; j++) {\r\n          if (blockVariables[j].getId() === id) {\r\n            uses.push(blocks[i]);\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return uses;\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2012 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Object representing a workspace.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.Workspace\r\n\r\n// Unused import preserved for side-effects. Remove if unneeded.\r\nimport './connection_checker.js';\r\n\r\nimport type {Block} from './block.js';\r\nimport type {BlocklyOptions} from './blockly_options.js';\r\nimport type {ConnectionDB} from './connection_db.js';\r\nimport type {Abstract} from './events/events_abstract.js';\r\nimport * as common from './common.js';\r\nimport * as eventUtils from './events/utils.js';\r\nimport type {IASTNodeLocation} from './interfaces/i_ast_node_location.js';\r\nimport type {IConnectionChecker} from './interfaces/i_connection_checker.js';\r\nimport {Options} from './options.js';\r\nimport * as registry from './registry.js';\r\nimport * as arrayUtils from './utils/array.js';\r\nimport * as idGenerator from './utils/idgenerator.js';\r\nimport * as math from './utils/math.js';\r\nimport type * as toolbox from './utils/toolbox.js';\r\nimport {VariableMap} from './variable_map.js';\r\nimport type {VariableModel} from './variable_model.js';\r\nimport type {WorkspaceComment} from './workspace_comment.js';\r\nimport {IProcedureMap} from './interfaces/i_procedure_map.js';\r\nimport {ObservableProcedureMap} from './observable_procedure_map.js';\r\n\r\n/**\r\n * Class for a workspace.  This is a data structure that contains blocks.\r\n * There is no UI, and can be created headlessly.\r\n */\r\nexport class Workspace implements IASTNodeLocation {\r\n  /**\r\n   * Angle away from the horizontal to sweep for blocks.  Order of execution is\r\n   * generally top to bottom, but a small angle changes the scan to give a bit\r\n   * of a left to right bias (reversed in RTL).  Units are in degrees. See:\r\n   * https://tvtropes.org/pmwiki/pmwiki.php/Main/DiagonalBilling\r\n   */\r\n  static SCAN_ANGLE = 3;\r\n  id: string;\r\n  options: Options;\r\n  RTL: boolean;\r\n  horizontalLayout: boolean;\r\n  toolboxPosition: toolbox.Position;\r\n\r\n  /**\r\n   * Returns `true` if the workspace is visible and `false` if it's headless.\r\n   */\r\n  rendered = false;\r\n\r\n  /**\r\n   * Is this workspace the surface for a flyout?\r\n   *\r\n   * @internal\r\n   */\r\n  internalIsFlyout = false;\r\n\r\n  /** Is this workspace the surface for a flyout? */\r\n  get isFlyout(): boolean {\r\n    return this.internalIsFlyout;\r\n  }\r\n\r\n  /**\r\n   * Is this workspace the surface for a mutator?\r\n   *\r\n   * @internal\r\n   */\r\n  internalIsMutator = false;\r\n\r\n  /** Is this workspace the surface for a mutator? */\r\n  get isMutator(): boolean {\r\n    return this.internalIsMutator;\r\n  }\r\n\r\n  /**\r\n   * Returns `true` if the workspace is currently in the process of a bulk\r\n   * clear.\r\n   *\r\n   * @internal\r\n   */\r\n  isClearing = false;\r\n\r\n  /**\r\n   * Maximum number of undo events in stack. `0` turns off undo, `Infinity`\r\n   * sets it to unlimited.\r\n   */\r\n  MAX_UNDO = 1024;\r\n\r\n  /** Set of databases for rapid lookup of connection locations. */\r\n  connectionDBList: ConnectionDB[] = [];\r\n  connectionChecker: IConnectionChecker;\r\n\r\n  private readonly topBlocks: Block[] = [];\r\n  private readonly topComments: WorkspaceComment[] = [];\r\n  private readonly commentDB = new Map<string, WorkspaceComment>();\r\n  private readonly listeners: Function[] = [];\r\n  protected undoStack_: Abstract[] = [];\r\n  protected redoStack_: Abstract[] = [];\r\n  private readonly blockDB = new Map<string, Block>();\r\n  private readonly typedBlocksDB = new Map<string, Block[]>();\r\n  private variableMap: VariableMap;\r\n  private procedureMap: IProcedureMap = new ObservableProcedureMap();\r\n\r\n  /**\r\n   * Blocks in the flyout can refer to variables that don't exist in the main\r\n   * workspace.  For instance, the \"get item in list\" block refers to an\r\n   * \"item\" variable regardless of whether the variable has been created yet.\r\n   * A FieldVariable must always refer to a VariableModel.  We reconcile\r\n   * these by tracking \"potential\" variables in the flyout.  These variables\r\n   * become real when references to them are dragged into the main workspace.\r\n   */\r\n  private potentialVariableMap: VariableMap | null = null;\r\n\r\n  /** @param opt_options Dictionary of options. */\r\n  constructor(opt_options?: Options) {\r\n    this.id = idGenerator.genUid();\r\n    common.registerWorkspace(this);\r\n    this.options = opt_options || new Options({} as BlocklyOptions);\r\n    this.RTL = !!this.options.RTL;\r\n    this.horizontalLayout = !!this.options.horizontalLayout;\r\n    this.toolboxPosition = this.options.toolboxPosition;\r\n\r\n    const connectionCheckerClass = registry.getClassFromOptions(\r\n      registry.Type.CONNECTION_CHECKER,\r\n      this.options,\r\n      true,\r\n    );\r\n    /**\r\n     * An object that encapsulates logic for safety, type, and dragging checks.\r\n     */\r\n    this.connectionChecker = new connectionCheckerClass!(this);\r\n\r\n    /**\r\n     * A map from variable type to list of variable names.  The lists contain\r\n     * all of the named variables in the workspace, including variables that are\r\n     * not currently in use.\r\n     */\r\n    this.variableMap = new VariableMap(this);\r\n  }\r\n\r\n  /**\r\n   * Dispose of this workspace.\r\n   * Unlink from all DOM elements to prevent memory leaks.\r\n   */\r\n  dispose() {\r\n    this.listeners.length = 0;\r\n    this.clear();\r\n    // Remove from workspace database.\r\n    common.unregisterWorkpace(this);\r\n  }\r\n\r\n  /**\r\n   * Compare function for sorting objects (blocks, comments, etc) by position;\r\n   *    top to bottom (with slight LTR or RTL bias).\r\n   *\r\n   * @param a The first object to compare.\r\n   * @param b The second object to compare.\r\n   * @returns The comparison value. This tells Array.sort() how to change object\r\n   *     a's index.\r\n   */\r\n  private sortObjects_(\r\n    a: Block | WorkspaceComment,\r\n    b: Block | WorkspaceComment,\r\n  ): number {\r\n    const offset =\r\n      Math.sin(math.toRadians(Workspace.SCAN_ANGLE)) * (this.RTL ? -1 : 1);\r\n    const aXY = a.getRelativeToSurfaceXY();\r\n    const bXY = b.getRelativeToSurfaceXY();\r\n    return aXY.y + offset * aXY.x - (bXY.y + offset * bXY.x);\r\n  }\r\n\r\n  /**\r\n   * Adds a block to the list of top blocks.\r\n   *\r\n   * @param block Block to add.\r\n   */\r\n  addTopBlock(block: Block) {\r\n    this.topBlocks.push(block);\r\n  }\r\n\r\n  /**\r\n   * Removes a block from the list of top blocks.\r\n   *\r\n   * @param block Block to remove.\r\n   */\r\n  removeTopBlock(block: Block) {\r\n    if (!arrayUtils.removeElem(this.topBlocks, block)) {\r\n      throw Error(\"Block not present in workspace's list of top-most blocks.\");\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Finds the top-level blocks and returns them.  Blocks are optionally sorted\r\n   * by position; top to bottom (with slight LTR or RTL bias).\r\n   *\r\n   * @param ordered Sort the list if true.\r\n   * @returns The top-level block objects.\r\n   */\r\n  getTopBlocks(ordered = false): Block[] {\r\n    // Copy the topBlocks list.\r\n    const blocks = new Array<Block>().concat(this.topBlocks);\r\n    if (ordered && blocks.length > 1) {\r\n      blocks.sort(this.sortObjects_.bind(this));\r\n    }\r\n    return blocks;\r\n  }\r\n\r\n  /**\r\n   * Add a block to the list of blocks keyed by type.\r\n   *\r\n   * @param block Block to add.\r\n   */\r\n  addTypedBlock(block: Block) {\r\n    if (!this.typedBlocksDB.has(block.type)) {\r\n      this.typedBlocksDB.set(block.type, []);\r\n    }\r\n    this.typedBlocksDB.get(block.type)!.push(block);\r\n  }\r\n\r\n  /**\r\n   * Remove a block from the list of blocks keyed by type.\r\n   *\r\n   * @param block Block to remove.\r\n   */\r\n  removeTypedBlock(block: Block) {\r\n    arrayUtils.removeElem(this.typedBlocksDB.get(block.type)!, block);\r\n    if (!this.typedBlocksDB.get(block.type)!.length) {\r\n      this.typedBlocksDB.delete(block.type);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Finds the blocks with the associated type and returns them. Blocks are\r\n   * optionally sorted by position; top to bottom (with slight LTR or RTL bias).\r\n   *\r\n   * @param type The type of block to search for.\r\n   * @param ordered Sort the list if true.\r\n   * @returns The blocks of the given type.\r\n   */\r\n  getBlocksByType(type: string, ordered = false): Block[] {\r\n    if (!this.typedBlocksDB.has(type)) {\r\n      return [];\r\n    }\r\n    const blocks = this.typedBlocksDB.get(type)!.slice(0);\r\n    if (ordered && blocks && blocks.length > 1) {\r\n      blocks.sort(this.sortObjects_.bind(this));\r\n    }\r\n\r\n    return blocks.filter(function (block: Block) {\r\n      return !block.isInsertionMarker();\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Adds a comment to the list of top comments.\r\n   *\r\n   * @param comment comment to add.\r\n   * @internal\r\n   */\r\n  addTopComment(comment: WorkspaceComment) {\r\n    this.topComments.push(comment);\r\n\r\n    // Note: If the comment database starts to hold block comments, this may\r\n    // need to move to a separate function.\r\n    if (this.commentDB.has(comment.id)) {\r\n      console.warn(\r\n        'Overriding an existing comment on this workspace, with id \"' +\r\n          comment.id +\r\n          '\"',\r\n      );\r\n    }\r\n    this.commentDB.set(comment.id, comment);\r\n  }\r\n\r\n  /**\r\n   * Removes a comment from the list of top comments.\r\n   *\r\n   * @param comment comment to remove.\r\n   * @internal\r\n   */\r\n  removeTopComment(comment: WorkspaceComment) {\r\n    if (!arrayUtils.removeElem(this.topComments, comment)) {\r\n      throw Error(\r\n        \"Comment not present in workspace's list of top-most \" + 'comments.',\r\n      );\r\n    }\r\n    // Note: If the comment database starts to hold block comments, this may\r\n    // need to move to a separate function.\r\n    this.commentDB.delete(comment.id);\r\n  }\r\n\r\n  /**\r\n   * Finds the top-level comments and returns them.  Comments are optionally\r\n   * sorted by position; top to bottom (with slight LTR or RTL bias).\r\n   *\r\n   * @param ordered Sort the list if true.\r\n   * @returns The top-level comment objects.\r\n   * @internal\r\n   */\r\n  getTopComments(ordered = false): WorkspaceComment[] {\r\n    // Copy the topComments list.\r\n    const comments = new Array<WorkspaceComment>().concat(this.topComments);\r\n    if (ordered && comments.length > 1) {\r\n      comments.sort(this.sortObjects_.bind(this));\r\n    }\r\n    return comments;\r\n  }\r\n\r\n  /**\r\n   * Find all blocks in workspace.  Blocks are optionally sorted\r\n   * by position; top to bottom (with slight LTR or RTL bias).\r\n   *\r\n   * @param ordered Sort the list if true.\r\n   * @returns Array of blocks.\r\n   */\r\n  getAllBlocks(ordered = false): Block[] {\r\n    let blocks: Block[];\r\n    if (ordered) {\r\n      // Slow, but ordered.\r\n      const topBlocks = this.getTopBlocks(true);\r\n      blocks = [];\r\n      for (let i = 0; i < topBlocks.length; i++) {\r\n        blocks.push(...topBlocks[i].getDescendants(true));\r\n      }\r\n    } else {\r\n      // Fast, but in no particular order.\r\n      blocks = this.getTopBlocks(false);\r\n      for (let i = 0; i < blocks.length; i++) {\r\n        blocks.push(...blocks[i].getChildren(false));\r\n      }\r\n    }\r\n\r\n    // Insertion markers exist on the workspace for rendering reasons, but\r\n    // aren't \"real\" blocks from a developer perspective.\r\n    const filtered = blocks.filter(function (block) {\r\n      return !block.isInsertionMarker();\r\n    });\r\n\r\n    return filtered;\r\n  }\r\n\r\n  /** Dispose of all blocks and comments in workspace. */\r\n  clear() {\r\n    this.isClearing = true;\r\n    try {\r\n      const existingGroup = eventUtils.getGroup();\r\n      if (!existingGroup) {\r\n        eventUtils.setGroup(true);\r\n      }\r\n      while (this.topBlocks.length) {\r\n        this.topBlocks[0].dispose(false);\r\n      }\r\n      while (this.topComments.length) {\r\n        this.topComments[this.topComments.length - 1].dispose();\r\n      }\r\n      eventUtils.setGroup(existingGroup);\r\n      this.variableMap.clear();\r\n      if (this.potentialVariableMap) {\r\n        this.potentialVariableMap.clear();\r\n      }\r\n    } finally {\r\n      this.isClearing = false;\r\n    }\r\n  }\r\n\r\n  /* Begin functions that are just pass-throughs to the variable map. */\r\n  /**\r\n   * Rename a variable by updating its name in the variable map. Identify the\r\n   * variable to rename with the given ID.\r\n   *\r\n   * @param id ID of the variable to rename.\r\n   * @param newName New variable name.\r\n   */\r\n  renameVariableById(id: string, newName: string) {\r\n    this.variableMap.renameVariableById(id, newName);\r\n  }\r\n\r\n  /**\r\n   * Create a variable with a given name, optional type, and optional ID.\r\n   *\r\n   * @param name The name of the variable. This must be unique across variables\r\n   *     and procedures.\r\n   * @param opt_type The type of the variable like 'int' or 'string'.\r\n   *     Does not need to be unique. Field_variable can filter variables based\r\n   * on their type. This will default to '' which is a specific type.\r\n   * @param opt_id The unique ID of the variable. This will default to a UUID.\r\n   * @returns The newly created variable.\r\n   */\r\n  createVariable(\r\n    name: string,\r\n    opt_type?: string | null,\r\n    opt_id?: string | null,\r\n  ): VariableModel {\r\n    return this.variableMap.createVariable(name, opt_type, opt_id);\r\n  }\r\n\r\n  /**\r\n   * Find all the uses of the given variable, which is identified by ID.\r\n   *\r\n   * @param id ID of the variable to find.\r\n   * @returns Array of block usages.\r\n   */\r\n  getVariableUsesById(id: string): Block[] {\r\n    return this.variableMap.getVariableUsesById(id);\r\n  }\r\n\r\n  /**\r\n   * Delete a variables by the passed in ID and all of its uses from this\r\n   * workspace. May prompt the user for confirmation.\r\n   *\r\n   * @param id ID of variable to delete.\r\n   */\r\n  deleteVariableById(id: string) {\r\n    this.variableMap.deleteVariableById(id);\r\n  }\r\n\r\n  /**\r\n   * Find the variable by the given name and return it. Return null if not\r\n   * found.\r\n   *\r\n   * @param name The name to check for.\r\n   * @param opt_type The type of the variable.  If not provided it defaults to\r\n   *     the empty string, which is a specific type.\r\n   * @returns The variable with the given name.\r\n   */\r\n  getVariable(name: string, opt_type?: string): VariableModel | null {\r\n    // TODO (#1559): Possibly delete this function after resolving #1559.\r\n    return this.variableMap.getVariable(name, opt_type);\r\n  }\r\n\r\n  /**\r\n   * Find the variable by the given ID and return it. Return null if not found.\r\n   *\r\n   * @param id The ID to check for.\r\n   * @returns The variable with the given ID.\r\n   */\r\n  getVariableById(id: string): VariableModel | null {\r\n    return this.variableMap.getVariableById(id);\r\n  }\r\n\r\n  /**\r\n   * Find the variable with the specified type. If type is null, return list of\r\n   *     variables with empty string type.\r\n   *\r\n   * @param type Type of the variables to find.\r\n   * @returns The sought after variables of the passed in type. An empty array\r\n   *     if none are found.\r\n   */\r\n  getVariablesOfType(type: string | null): VariableModel[] {\r\n    return this.variableMap.getVariablesOfType(type);\r\n  }\r\n\r\n  /**\r\n   * Return all variable types.\r\n   *\r\n   * @returns List of variable types.\r\n   * @internal\r\n   */\r\n  getVariableTypes(): string[] {\r\n    return this.variableMap.getVariableTypes(this);\r\n  }\r\n\r\n  /**\r\n   * Return all variables of all types.\r\n   *\r\n   * @returns List of variable models.\r\n   */\r\n  getAllVariables(): VariableModel[] {\r\n    return this.variableMap.getAllVariables();\r\n  }\r\n\r\n  /**\r\n   * Returns all variable names of all types.\r\n   *\r\n   * @returns List of all variable names of all types.\r\n   */\r\n  getAllVariableNames(): string[] {\r\n    return this.variableMap.getAllVariableNames();\r\n  }\r\n  /* End functions that are just pass-throughs to the variable map. */\r\n  /**\r\n   * Returns the horizontal offset of the workspace.\r\n   * Intended for LTR/RTL compatibility in XML.\r\n   * Not relevant for a headless workspace.\r\n   *\r\n   * @returns Width.\r\n   */\r\n  getWidth(): number {\r\n    return 0;\r\n  }\r\n\r\n  /* eslint-disable jsdoc/require-returns-check */\r\n  /* eslint-disable @typescript-eslint/no-unused-vars */\r\n  /**\r\n   * Obtain a newly created block.\r\n   *\r\n   * @param prototypeName Name of the language object containing type-specific\r\n   *     functions for this block.\r\n   * @param opt_id Optional ID.  Use this ID if provided, otherwise create a new\r\n   *     ID.\r\n   * @returns The created block.\r\n   */\r\n  newBlock(prototypeName: string, opt_id?: string): Block {\r\n    throw new Error(\r\n      'The implementation of newBlock should be ' +\r\n        'monkey-patched in by blockly.ts',\r\n    );\r\n  }\r\n  /* eslint-enable */\r\n\r\n  /**\r\n   * The number of blocks that may be added to the workspace before reaching\r\n   *     the maxBlocks.\r\n   *\r\n   * @returns Number of blocks left.\r\n   */\r\n  remainingCapacity(): number {\r\n    if (isNaN(this.options.maxBlocks)) {\r\n      return Infinity;\r\n    }\r\n\r\n    return this.options.maxBlocks - this.getAllBlocks(false).length;\r\n  }\r\n\r\n  /**\r\n   * The number of blocks of the given type that may be added to the workspace\r\n   *    before reaching the maxInstances allowed for that type.\r\n   *\r\n   * @param type Type of block to return capacity for.\r\n   * @returns Number of blocks of type left.\r\n   */\r\n  remainingCapacityOfType(type: string): number {\r\n    if (!this.options.maxInstances) {\r\n      return Infinity;\r\n    }\r\n\r\n    const maxInstanceOfType =\r\n      this.options.maxInstances[type] !== undefined\r\n        ? this.options.maxInstances[type]\r\n        : Infinity;\r\n\r\n    return maxInstanceOfType - this.getBlocksByType(type, false).length;\r\n  }\r\n\r\n  /**\r\n   * Check if there is remaining capacity for blocks of the given counts to be\r\n   *    created. If the total number of blocks represented by the map is more\r\n   * than the total remaining capacity, it returns false. If a type count is\r\n   * more than the remaining capacity for that type, it returns false.\r\n   *\r\n   * @param typeCountsMap A map of types to counts (usually representing blocks\r\n   *     to be created).\r\n   * @returns True if there is capacity for the given map, false otherwise.\r\n   */\r\n  isCapacityAvailable(typeCountsMap: {[key: string]: number}): boolean {\r\n    if (!this.hasBlockLimits()) {\r\n      return true;\r\n    }\r\n    let copyableBlocksCount = 0;\r\n    for (const type in typeCountsMap) {\r\n      if (typeCountsMap[type] > this.remainingCapacityOfType(type)) {\r\n        return false;\r\n      }\r\n      copyableBlocksCount += typeCountsMap[type];\r\n    }\r\n    if (copyableBlocksCount > this.remainingCapacity()) {\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Checks if the workspace has any limits on the maximum number of blocks,\r\n   *    or the maximum number of blocks of specific types.\r\n   *\r\n   * @returns True if it has block limits, false otherwise.\r\n   */\r\n  hasBlockLimits(): boolean {\r\n    return this.options.maxBlocks !== Infinity || !!this.options.maxInstances;\r\n  }\r\n\r\n  /**\r\n   * Gets the undo stack for workplace.\r\n   *\r\n   * @returns undo stack\r\n   * @internal\r\n   */\r\n  getUndoStack(): Abstract[] {\r\n    return this.undoStack_;\r\n  }\r\n\r\n  /**\r\n   * Gets the redo stack for workplace.\r\n   *\r\n   * @returns redo stack\r\n   * @internal\r\n   */\r\n  getRedoStack(): Abstract[] {\r\n    return this.redoStack_;\r\n  }\r\n\r\n  /**\r\n   * Undo or redo the previous action.\r\n   *\r\n   * @param redo False if undo, true if redo.\r\n   */\r\n  undo(redo: boolean) {\r\n    const inputStack = redo ? this.redoStack_ : this.undoStack_;\r\n    const outputStack = redo ? this.undoStack_ : this.redoStack_;\r\n    const inputEvent = inputStack.pop();\r\n    if (!inputEvent) {\r\n      return;\r\n    }\r\n    let events = [inputEvent];\r\n    // Do another undo/redo if the next one is of the same group.\r\n    while (\r\n      inputStack.length &&\r\n      inputEvent.group &&\r\n      inputEvent.group === inputStack[inputStack.length - 1].group\r\n    ) {\r\n      const event = inputStack.pop();\r\n      if (!event) continue;\r\n      events.push(event);\r\n    }\r\n    // Push these popped events on the opposite stack.\r\n    for (let i = 0; i < events.length; i++) {\r\n      const event = events[i];\r\n      outputStack.push(event);\r\n    }\r\n    events = eventUtils.filter(events, redo);\r\n    eventUtils.setRecordUndo(false);\r\n    try {\r\n      for (let i = 0; i < events.length; i++) {\r\n        const event = events[i];\r\n        event.run(redo);\r\n      }\r\n    } finally {\r\n      eventUtils.setRecordUndo(true);\r\n    }\r\n  }\r\n\r\n  /** Clear the undo/redo stacks. */\r\n  clearUndo() {\r\n    this.undoStack_.length = 0;\r\n    this.redoStack_.length = 0;\r\n    // Stop any events already in the firing queue from being undoable.\r\n    eventUtils.clearPendingUndo();\r\n  }\r\n\r\n  /**\r\n   * When something in this workspace changes, call a function.\r\n   * Note that there may be a few recent events already on the stack.  Thus the\r\n   * new change listener might be called with events that occurred a few\r\n   * milliseconds before the change listener was added.\r\n   *\r\n   * @param func Function to call.\r\n   * @returns Obsolete return value, ignore.\r\n   */\r\n  addChangeListener(func: (e: Abstract) => void): Function {\r\n    this.listeners.push(func);\r\n    return func;\r\n  }\r\n\r\n  /**\r\n   * Stop listening for this workspace's changes.\r\n   *\r\n   * @param func Function to stop calling.\r\n   */\r\n  removeChangeListener(func: Function) {\r\n    arrayUtils.removeElem(this.listeners, func);\r\n  }\r\n\r\n  /**\r\n   * Fire a change event.\r\n   *\r\n   * @param event Event to fire.\r\n   */\r\n  fireChangeListener(event: Abstract) {\r\n    if (event.recordUndo) {\r\n      this.undoStack_.push(event);\r\n      this.redoStack_.length = 0;\r\n      while (this.undoStack_.length > this.MAX_UNDO && this.MAX_UNDO >= 0) {\r\n        this.undoStack_.shift();\r\n      }\r\n    }\r\n    for (let i = 0; i < this.listeners.length; i++) {\r\n      const func = this.listeners[i];\r\n      func(event);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Find the block on this workspace with the specified ID.\r\n   *\r\n   * @param id ID of block to find.\r\n   * @returns The sought after block, or null if not found.\r\n   */\r\n  getBlockById(id: string): Block | null {\r\n    return this.blockDB.get(id) || null;\r\n  }\r\n\r\n  /**\r\n   * Set a block on this workspace with the specified ID.\r\n   *\r\n   * @param id ID of block to set.\r\n   * @param block The block to set.\r\n   * @internal\r\n   */\r\n  setBlockById(id: string, block: Block) {\r\n    this.blockDB.set(id, block);\r\n  }\r\n\r\n  /**\r\n   * Delete a block off this workspace with the specified ID.\r\n   *\r\n   * @param id ID of block to delete.\r\n   * @internal\r\n   */\r\n  removeBlockById(id: string) {\r\n    this.blockDB.delete(id);\r\n  }\r\n\r\n  /**\r\n   * Find the comment on this workspace with the specified ID.\r\n   *\r\n   * @param id ID of comment to find.\r\n   * @returns The sought after comment, or null if not found.\r\n   * @internal\r\n   */\r\n  getCommentById(id: string): WorkspaceComment | null {\r\n    return this.commentDB.get(id) ?? null;\r\n  }\r\n\r\n  /**\r\n   * Checks whether all value and statement inputs in the workspace are filled\r\n   * with blocks.\r\n   *\r\n   * @param opt_shadowBlocksAreFilled An optional argument controlling whether\r\n   *     shadow blocks are counted as filled. Defaults to true.\r\n   * @returns True if all inputs are filled, false otherwise.\r\n   */\r\n  allInputsFilled(opt_shadowBlocksAreFilled?: boolean): boolean {\r\n    const blocks = this.getTopBlocks(false);\r\n    for (let i = 0; i < blocks.length; i++) {\r\n      const block = blocks[i];\r\n      if (!block.allInputsFilled(opt_shadowBlocksAreFilled)) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Return the variable map that contains \"potential\" variables.\r\n   * These exist in the flyout but not in the workspace.\r\n   *\r\n   * @returns The potential variable map.\r\n   * @internal\r\n   */\r\n  getPotentialVariableMap(): VariableMap | null {\r\n    return this.potentialVariableMap;\r\n  }\r\n\r\n  /**\r\n   * Create and store the potential variable map for this workspace.\r\n   *\r\n   * @internal\r\n   */\r\n  createPotentialVariableMap() {\r\n    this.potentialVariableMap = new VariableMap(this);\r\n  }\r\n\r\n  /**\r\n   * Return the map of all variables on the workspace.\r\n   *\r\n   * @returns The variable map.\r\n   */\r\n  getVariableMap(): VariableMap {\r\n    return this.variableMap;\r\n  }\r\n\r\n  /**\r\n   * Set the map of all variables on the workspace.\r\n   *\r\n   * @param variableMap The variable map.\r\n   * @internal\r\n   */\r\n  setVariableMap(variableMap: VariableMap) {\r\n    this.variableMap = variableMap;\r\n  }\r\n\r\n  /** Returns the map of all procedures on the workpace. */\r\n  getProcedureMap(): IProcedureMap {\r\n    return this.procedureMap;\r\n  }\r\n\r\n  /**\r\n   * Returns the root workspace of this workspace if the workspace has\r\n   * parent(s).\r\n   *\r\n   * E.g. workspaces in flyouts and mini workspace bubbles have parent\r\n   * workspaces.\r\n   */\r\n  getRootWorkspace(): Workspace | null {\r\n    let outerWs = null;\r\n    const parent = this.options.parentWorkspace;\r\n    // If we were in a flyout in a mutator, need to go up two levels to find\r\n    // the actual parent.\r\n    if (this.isFlyout) {\r\n      if (parent && parent.options) {\r\n        outerWs = parent.options.parentWorkspace;\r\n      }\r\n    } else if (parent) {\r\n      outerWs = parent;\r\n    }\r\n    return outerWs;\r\n  }\r\n\r\n  /**\r\n   * Find the workspace with the specified ID.\r\n   *\r\n   * @param id ID of workspace to find.\r\n   * @returns The sought after workspace or null if not found.\r\n   */\r\n  static getById(id: string): Workspace | null {\r\n    return common.getWorkspaceById(id);\r\n  }\r\n\r\n  /**\r\n   * Find all workspaces.\r\n   *\r\n   * @returns Array of workspaces.\r\n   */\r\n  static getAll(): Workspace[] {\r\n    return common.getAllWorkspaces();\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Object in charge of loading, storing, and playing audio for a\r\n *     workspace.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.WorkspaceAudio\r\n\r\nimport * as userAgent from './utils/useragent.js';\r\nimport type {WorkspaceSvg} from './workspace_svg.js';\r\n\r\n/**\r\n * Prevent a sound from playing if another sound preceded it within this many\r\n * milliseconds.\r\n */\r\nconst SOUND_LIMIT = 100;\r\n\r\n/**\r\n * Class for loading, storing, and playing audio for a workspace.\r\n */\r\nexport class WorkspaceAudio {\r\n  /** Database of pre-loaded sounds. */\r\n  private sounds = new Map<string, HTMLAudioElement>();\r\n\r\n  /** Time that the last sound was played. */\r\n  private lastSound_: Date | null = null;\r\n\r\n  /** Whether the audio is muted or not. */\r\n  private muted: boolean = false;\r\n\r\n  /**\r\n   * @param parentWorkspace The parent of the workspace this audio object\r\n   *     belongs to, or null.\r\n   */\r\n  constructor(private parentWorkspace: WorkspaceSvg) {}\r\n\r\n  /**\r\n   * Dispose of this audio manager.\r\n   *\r\n   * @internal\r\n   */\r\n  dispose() {\r\n    this.sounds.clear();\r\n  }\r\n\r\n  /**\r\n   * Load an audio file.  Cache it, ready for instantaneous playing.\r\n   *\r\n   * @param filenames List of file types in decreasing order of preference (i.e.\r\n   *     increasing size).  E.g. ['media/go.mp3', 'media/go.wav'] Filenames\r\n   *     include path from Blockly's root.  File extensions matter.\r\n   * @param name Name of sound.\r\n   */\r\n  load(filenames: string[], name: string) {\r\n    if (!filenames.length) {\r\n      return;\r\n    }\r\n    let audioTest;\r\n    try {\r\n      audioTest = new globalThis['Audio']();\r\n    } catch (e) {\r\n      // No browser support for Audio.\r\n      // IE can throw an error even if the Audio object exists.\r\n      return;\r\n    }\r\n    let sound;\r\n    for (let i = 0; i < filenames.length; i++) {\r\n      const filename = filenames[i];\r\n      const ext = filename.match(/\\.(\\w+)$/);\r\n      if (ext && audioTest.canPlayType('audio/' + ext[1])) {\r\n        // Found an audio format we can play.\r\n        sound = new globalThis['Audio'](filename);\r\n        break;\r\n      }\r\n    }\r\n    if (sound) {\r\n      this.sounds.set(name, sound);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Preload all the audio files so that they play quickly when asked for.\r\n   *\r\n   * @internal\r\n   */\r\n  preload() {\r\n    for (const sound of this.sounds.values()) {\r\n      sound.volume = 0.01;\r\n      const playPromise = sound.play();\r\n      // Edge does not return a promise, so we need to check.\r\n      if (playPromise !== undefined) {\r\n        // If we don't wait for the play request to complete before calling\r\n        // pause() we will get an exception: (DOMException: The play() request\r\n        // was interrupted) See more:\r\n        // https://developers.google.com/web/updates/2017/06/play-request-was-interrupted\r\n        playPromise.then(sound.pause).catch(\r\n          // Play without user interaction was prevented.\r\n          function () {},\r\n        );\r\n      } else {\r\n        sound.pause();\r\n      }\r\n\r\n      // iOS can only process one sound at a time.  Trying to load more than one\r\n      // corrupts the earlier ones.  Just load one and leave the others\r\n      // uncached.\r\n      if (userAgent.IPAD || userAgent.IPHONE) {\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Play a named sound at specified volume.  If volume is not specified,\r\n   * use full volume (1).\r\n   *\r\n   * @param name Name of sound.\r\n   * @param opt_volume Volume of sound (0-1).\r\n   */\r\n  play(name: string, opt_volume?: number) {\r\n    if (this.muted) {\r\n      return;\r\n    }\r\n    const sound = this.sounds.get(name);\r\n    if (sound) {\r\n      // Don't play one sound on top of another.\r\n      const now = new Date();\r\n      if (\r\n        this.lastSound_ !== null &&\r\n        now.getTime() - this.lastSound_.getTime() < SOUND_LIMIT\r\n      ) {\r\n        return;\r\n      }\r\n      this.lastSound_ = now;\r\n      let mySound;\r\n      if (userAgent.IPAD || userAgent.ANDROID) {\r\n        // Creating a new audio node causes lag in Android and iPad.  Android\r\n        // refetches the file from the server, iPad uses a singleton audio\r\n        // node which must be deleted and recreated for each new audio tag.\r\n        mySound = sound;\r\n      } else {\r\n        mySound = sound.cloneNode() as HTMLAudioElement;\r\n      }\r\n      mySound.volume = opt_volume === undefined ? 1 : opt_volume;\r\n      mySound.play();\r\n    } else if (this.parentWorkspace) {\r\n      // Maybe a workspace on a lower level knows about this sound.\r\n      this.parentWorkspace.getAudioManager().play(name, opt_volume);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @param muted If true, mute sounds. Otherwise, play them.\r\n   */\r\n  setMuted(muted: boolean) {\r\n    this.muted = muted;\r\n  }\r\n\r\n  /**\r\n   * @returns Whether the audio is currently muted or not.\r\n   */\r\n  getMuted(): boolean {\r\n    return this.muted;\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2023 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport {WorkspaceSvg} from './workspace_svg.js';\r\nimport * as dom from './utils/dom.js';\r\nimport {Svg} from './utils/svg.js';\r\nimport {IRenderedElement} from './interfaces/i_rendered_element.js';\r\nimport * as layerNums from './layers.js';\r\nimport {Coordinate} from './utils/coordinate.js';\r\n\r\n/** @internal */\r\nexport class LayerManager {\r\n  /** The layer elements being dragged are appended to. */\r\n  private dragLayer: SVGGElement | undefined;\r\n  /** The layers elements not being dragged are appended to.  */\r\n  private layers = new Map<number, SVGGElement>();\r\n\r\n  /** @internal */\r\n  constructor(private workspace: WorkspaceSvg) {\r\n    const injectionDiv = workspace.getInjectionDiv();\r\n    // `getInjectionDiv` is actually nullable. We hit this if the workspace\r\n    // is part of a flyout and the workspace the flyout is attached to hasn't\r\n    // been appended yet.\r\n    if (injectionDiv) {\r\n      this.dragLayer = this.createDragLayer(injectionDiv);\r\n    }\r\n\r\n    // We construct these manually so we can add the css class for backwards\r\n    // compatibility.\r\n    const blockLayer = this.createLayer(layerNums.BLOCK);\r\n    dom.addClass(blockLayer, 'blocklyBlockCanvas');\r\n    const bubbleLayer = this.createLayer(layerNums.BUBBLE);\r\n    dom.addClass(bubbleLayer, 'blocklyBubbleCanvas');\r\n  }\r\n\r\n  private createDragLayer(injectionDiv: Element) {\r\n    const svg = dom.createSvgElement(Svg.SVG, {\r\n      'class': 'blocklyBlockDragSurface',\r\n      'xmlns': dom.SVG_NS,\r\n      'xmlns:html': dom.HTML_NS,\r\n      'xmlns:xlink': dom.XLINK_NS,\r\n      'version': '1.1',\r\n    });\r\n    injectionDiv.append(svg);\r\n    return dom.createSvgElement(Svg.G, {}, svg);\r\n  }\r\n\r\n  /**\r\n   * Translates layers when the workspace is dragged or zoomed.\r\n   *\r\n   * @internal\r\n   */\r\n  translateLayers(newCoord: Coordinate, newScale: number) {\r\n    const translation = `translate(${newCoord.x}, ${newCoord.y}) scale(${newScale})`;\r\n    this.dragLayer?.setAttribute('transform', translation);\r\n    for (const [_, layer] of this.layers) {\r\n      layer.setAttribute('transform', translation);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Moves the given element to the drag layer, which exists on top of all other\r\n   * layers, and the drag surface.\r\n   *\r\n   * @internal\r\n   */\r\n  moveToDragLayer(elem: IRenderedElement) {\r\n    this.dragLayer?.appendChild(elem.getSvgRoot());\r\n  }\r\n\r\n  /**\r\n   * Moves the given element off of the drag layer.\r\n   *\r\n   * @internal\r\n   */\r\n  moveOffDragLayer(elem: IRenderedElement, layerNum: number) {\r\n    this.append(elem, layerNum);\r\n  }\r\n\r\n  /**\r\n   * Appends the given element to a layer. If the layer does not exist, it is\r\n   * created.\r\n   *\r\n   * @internal\r\n   */\r\n  append(elem: IRenderedElement, layerNum: number) {\r\n    if (!this.layers.has(layerNum)) {\r\n      this.createLayer(layerNum);\r\n    }\r\n    this.layers.get(layerNum)?.appendChild(elem.getSvgRoot());\r\n  }\r\n\r\n  /**\r\n   * Creates a layer and inserts it at the proper place given the layer number.\r\n   *\r\n   * More positive layers exist later in the dom and are rendered ontop of\r\n   * less positive layers. Layers are added to the layer map as a side effect.\r\n   */\r\n  private createLayer(layerNum: number): SVGGElement {\r\n    const parent = this.workspace.getSvgGroup();\r\n    const layer = dom.createSvgElement(Svg.G, {});\r\n\r\n    let inserted = false;\r\n    const sortedLayers = [...this.layers].sort((a, b) => a[0] - b[0]);\r\n    for (const [num, sib] of sortedLayers) {\r\n      if (layerNum < num) {\r\n        parent.insertBefore(layer, sib);\r\n        inserted = true;\r\n        break;\r\n      }\r\n    }\r\n    if (!inserted) {\r\n      parent.appendChild(layer);\r\n    }\r\n    this.layers.set(layerNum, layer);\r\n    return layer;\r\n  }\r\n\r\n  /**\r\n   * Returns true if the given element is a layer managed by the layer manager.\r\n   * False otherwise.\r\n   *\r\n   * @internal\r\n   */\r\n  hasLayer(elem: SVGElement) {\r\n    return (\r\n      elem === this.dragLayer ||\r\n      new Set(this.layers.values()).has(elem as SVGGElement)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * We need to be able to access this layer explicitly for backwards\r\n   * compatibility.\r\n   *\r\n   * @internal\r\n   */\r\n  getBlockLayer(): SVGGElement {\r\n    return this.layers.get(layerNums.BLOCK)!;\r\n  }\r\n\r\n  /**\r\n   * We need to be able to access this layer explicitly for backwards\r\n   * compatibility.\r\n   *\r\n   * @internal\r\n   */\r\n  getBubbleLayer(): SVGGElement {\r\n    return this.layers.get(layerNums.BUBBLE)!;\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2018 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Events fired as a result of trashcan flyout open and close.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.Events.TrashcanOpen\r\n\r\nimport * as registry from '../registry.js';\r\nimport {AbstractEventJson} from './events_abstract.js';\r\n\r\nimport {UiBase} from './events_ui_base.js';\r\nimport * as eventUtils from './utils.js';\r\nimport type {Workspace} from '../workspace.js';\r\n\r\n/**\r\n * Notifies listeners when the trashcan is opening or closing.\r\n */\r\nexport class TrashcanOpen extends UiBase {\r\n  /**\r\n   * True if the trashcan is currently opening (previously closed).\r\n   * False if it is currently closing (previously open).\r\n   */\r\n  isOpen?: boolean;\r\n  override type = eventUtils.TRASHCAN_OPEN;\r\n\r\n  /**\r\n   * @param opt_isOpen Whether the trashcan flyout is opening (false if\r\n   *     opening). Undefined for a blank event.\r\n   * @param opt_workspaceId The workspace identifier for this event.\r\n   *    Undefined for a blank event.\r\n   */\r\n  constructor(opt_isOpen?: boolean, opt_workspaceId?: string) {\r\n    super(opt_workspaceId);\r\n    this.isOpen = opt_isOpen;\r\n  }\r\n\r\n  /**\r\n   * Encode the event as JSON.\r\n   *\r\n   * @returns JSON representation.\r\n   */\r\n  override toJson(): TrashcanOpenJson {\r\n    const json = super.toJson() as TrashcanOpenJson;\r\n    if (this.isOpen === undefined) {\r\n      throw new Error(\r\n        'Whether this is already open or not is undefined. Either pass ' +\r\n          'a value to the constructor, or call fromJson',\r\n      );\r\n    }\r\n    json['isOpen'] = this.isOpen;\r\n    return json;\r\n  }\r\n\r\n  /**\r\n   * Deserializes the JSON event.\r\n   *\r\n   * @param event The event to append new properties to. Should be a subclass\r\n   *     of TrashcanOpen, but we can't specify that due to the fact that\r\n   *     parameters to static methods in subclasses must be supertypes of\r\n   *     parameters to static methods in superclasses.\r\n   * @internal\r\n   */\r\n  static fromJson(\r\n    json: TrashcanOpenJson,\r\n    workspace: Workspace,\r\n    event?: any,\r\n  ): TrashcanOpen {\r\n    const newEvent = super.fromJson(\r\n      json,\r\n      workspace,\r\n      event ?? new TrashcanOpen(),\r\n    ) as TrashcanOpen;\r\n    newEvent.isOpen = json['isOpen'];\r\n    return newEvent;\r\n  }\r\n}\r\n\r\nexport interface TrashcanOpenJson extends AbstractEventJson {\r\n  isOpen: boolean;\r\n}\r\n\r\nregistry.register(registry.Type.EVENT, eventUtils.TRASHCAN_OPEN, TrashcanOpen);\r\n","/**\r\n * @license\r\n * Copyright 2018 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Class for a block delete event.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.Events.BlockDelete\r\n\r\nimport type {Block} from '../block.js';\r\nimport * as registry from '../registry.js';\r\nimport * as blocks from '../serialization/blocks.js';\r\nimport * as utilsXml from '../utils/xml.js';\r\nimport * as Xml from '../xml.js';\r\n\r\nimport {BlockBase, BlockBaseJson} from './events_block_base.js';\r\nimport * as eventUtils from './utils.js';\r\nimport {Workspace} from '../workspace.js';\r\n\r\n/**\r\n * Notifies listeners when a block (or connected stack of blocks) is\r\n * deleted.\r\n */\r\nexport class BlockDelete extends BlockBase {\r\n  /** The XML representation of the deleted block(s). */\r\n  oldXml?: Element | DocumentFragment;\r\n\r\n  /** The JSON respresentation of the deleted block(s). */\r\n  oldJson?: blocks.State;\r\n\r\n  /** All of the IDs of deleted blocks. */\r\n  ids?: string[];\r\n\r\n  /** True if the deleted block was a shadow block, false otherwise. */\r\n  wasShadow?: boolean;\r\n\r\n  override type = eventUtils.BLOCK_DELETE;\r\n\r\n  /** @param opt_block The deleted block.  Undefined for a blank event. */\r\n  constructor(opt_block?: Block) {\r\n    super(opt_block);\r\n\r\n    if (!opt_block) {\r\n      return; // Blank event to be populated by fromJson.\r\n    }\r\n\r\n    if (opt_block.getParent()) {\r\n      throw Error('Connected blocks cannot be deleted.');\r\n    }\r\n    if (opt_block.isShadow()) {\r\n      // Respawning shadow blocks is handled via disconnection.\r\n      this.recordUndo = false;\r\n    }\r\n\r\n    this.oldXml = Xml.blockToDomWithXY(opt_block);\r\n    this.ids = eventUtils.getDescendantIds(opt_block);\r\n    this.wasShadow = opt_block.isShadow();\r\n    this.oldJson = blocks.save(opt_block, {\r\n      addCoordinates: true,\r\n    }) as blocks.State;\r\n  }\r\n\r\n  /**\r\n   * Encode the event as JSON.\r\n   *\r\n   * @returns JSON representation.\r\n   */\r\n  override toJson(): BlockDeleteJson {\r\n    const json = super.toJson() as BlockDeleteJson;\r\n    if (!this.oldXml) {\r\n      throw new Error(\r\n        'The old block XML is undefined. Either pass a block ' +\r\n          'to the constructor, or call fromJson',\r\n      );\r\n    }\r\n    if (!this.ids) {\r\n      throw new Error(\r\n        'The block IDs are undefined. Either pass a block to ' +\r\n          'the constructor, or call fromJson',\r\n      );\r\n    }\r\n    if (this.wasShadow === undefined) {\r\n      throw new Error(\r\n        'Whether the block was a shadow is undefined. Either ' +\r\n          'pass a block to the constructor, or call fromJson',\r\n      );\r\n    }\r\n    if (!this.oldJson) {\r\n      throw new Error(\r\n        'The old block JSON is undefined. Either pass a block ' +\r\n          'to the constructor, or call fromJson',\r\n      );\r\n    }\r\n    json['oldXml'] = Xml.domToText(this.oldXml);\r\n    json['ids'] = this.ids;\r\n    json['wasShadow'] = this.wasShadow;\r\n    json['oldJson'] = this.oldJson;\r\n    if (!this.recordUndo) {\r\n      json['recordUndo'] = this.recordUndo;\r\n    }\r\n    return json;\r\n  }\r\n\r\n  /**\r\n   * Deserializes the JSON event.\r\n   *\r\n   * @param event The event to append new properties to. Should be a subclass\r\n   *     of BlockDelete, but we can't specify that due to the fact that\r\n   *     parameters to static methods in subclasses must be supertypes of\r\n   *     parameters to static methods in superclasses.\r\n   * @internal\r\n   */\r\n  static fromJson(\r\n    json: BlockDeleteJson,\r\n    workspace: Workspace,\r\n    event?: any,\r\n  ): BlockDelete {\r\n    const newEvent = super.fromJson(\r\n      json,\r\n      workspace,\r\n      event ?? new BlockDelete(),\r\n    ) as BlockDelete;\r\n    newEvent.oldXml = utilsXml.textToDom(json['oldXml']);\r\n    newEvent.ids = json['ids'];\r\n    newEvent.wasShadow =\r\n      json['wasShadow'] || newEvent.oldXml.tagName.toLowerCase() === 'shadow';\r\n    newEvent.oldJson = json['oldJson'];\r\n    if (json['recordUndo'] !== undefined) {\r\n      newEvent.recordUndo = json['recordUndo'];\r\n    }\r\n    return newEvent;\r\n  }\r\n\r\n  /**\r\n   * Run a deletion event.\r\n   *\r\n   * @param forward True if run forward, false if run backward (undo).\r\n   */\r\n  override run(forward: boolean) {\r\n    const workspace = this.getEventWorkspace_();\r\n    if (!this.ids) {\r\n      throw new Error(\r\n        'The block IDs are undefined. Either pass a block to ' +\r\n          'the constructor, or call fromJson',\r\n      );\r\n    }\r\n    if (!this.oldJson) {\r\n      throw new Error(\r\n        'The old block JSON is undefined. Either pass a block ' +\r\n          'to the constructor, or call fromJson',\r\n      );\r\n    }\r\n    if (forward) {\r\n      for (let i = 0; i < this.ids.length; i++) {\r\n        const id = this.ids[i];\r\n        const block = workspace.getBlockById(id);\r\n        if (block) {\r\n          block.dispose(false);\r\n        } else if (id === this.blockId) {\r\n          // Only complain about root-level block.\r\n          console.warn(\"Can't delete non-existent block: \" + id);\r\n        }\r\n      }\r\n    } else {\r\n      blocks.append(this.oldJson, workspace);\r\n    }\r\n  }\r\n}\r\n\r\nexport interface BlockDeleteJson extends BlockBaseJson {\r\n  oldXml: string;\r\n  ids: string[];\r\n  wasShadow: boolean;\r\n  oldJson: blocks.State;\r\n  recordUndo?: boolean;\r\n}\r\n\r\nregistry.register(registry.Type.EVENT, eventUtils.DELETE, BlockDelete);\r\n","/**\r\n * @license\r\n * Copyright 2011 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * The class representing one block.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.Block\r\n\r\n// Unused import preserved for side-effects. Remove if unneeded.\r\nimport './events/events_block_change.js';\r\n// Unused import preserved for side-effects. Remove if unneeded.\r\nimport './events/events_block_create.js';\r\n// Unused import preserved for side-effects. Remove if unneeded.\r\nimport './events/events_block_delete.js';\r\n\r\nimport {Blocks} from './blocks.js';\r\nimport * as common from './common.js';\r\nimport {Connection} from './connection.js';\r\nimport {ConnectionType} from './connection_type.js';\r\nimport * as constants from './constants.js';\r\nimport {DuplicateIconType} from './icons/exceptions.js';\r\nimport type {Abstract} from './events/events_abstract.js';\r\nimport type {BlockMove} from './events/events_block_move.js';\r\nimport * as eventUtils from './events/utils.js';\r\nimport * as Extensions from './extensions.js';\r\nimport type {Field} from './field.js';\r\nimport * as fieldRegistry from './field_registry.js';\r\nimport {Input} from './inputs/input.js';\r\nimport {Align} from './inputs/align.js';\r\nimport type {IASTNodeLocation} from './interfaces/i_ast_node_location.js';\r\nimport type {IDeletable} from './interfaces/i_deletable.js';\r\nimport type {IIcon} from './interfaces/i_icon.js';\r\nimport {CommentIcon} from './icons/comment_icon.js';\r\nimport type {MutatorIcon} from './icons/mutator_icon.js';\r\nimport * as Tooltip from './tooltip.js';\r\nimport * as arrayUtils from './utils/array.js';\r\nimport {Coordinate} from './utils/coordinate.js';\r\nimport * as idGenerator from './utils/idgenerator.js';\r\nimport * as parsing from './utils/parsing.js';\r\nimport * as registry from './registry.js';\r\nimport {Size} from './utils/size.js';\r\nimport type {VariableModel} from './variable_model.js';\r\nimport type {Workspace} from './workspace.js';\r\nimport {DummyInput} from './inputs/dummy_input.js';\r\nimport {EndRowInput} from './inputs/end_row_input.js';\r\nimport {ValueInput} from './inputs/value_input.js';\r\nimport {StatementInput} from './inputs/statement_input.js';\r\nimport {IconType} from './icons/icon_types.js';\r\n\r\n/**\r\n * Class for one block.\r\n * Not normally called directly, workspace.newBlock() is preferred.\r\n */\r\nexport class Block implements IASTNodeLocation, IDeletable {\r\n  /**\r\n   * An optional callback method to use whenever the block's parent workspace\r\n   * changes. This is usually only called from the constructor, the block type\r\n   * initializer function, or an extension initializer function.\r\n   */\r\n  onchange?: ((p1: Abstract) => void) | null;\r\n\r\n  /** The language-neutral ID given to the collapsed input. */\r\n  static readonly COLLAPSED_INPUT_NAME: string = constants.COLLAPSED_INPUT_NAME;\r\n\r\n  /** The language-neutral ID given to the collapsed field. */\r\n  static readonly COLLAPSED_FIELD_NAME: string = constants.COLLAPSED_FIELD_NAME;\r\n\r\n  /**\r\n   * Optional text data that round-trips between blocks and XML.\r\n   * Has no effect. May be used by 3rd parties for meta information.\r\n   */\r\n  data: string | null = null;\r\n\r\n  /**\r\n   * Has this block been disposed of?\r\n   *\r\n   * @internal\r\n   */\r\n  disposed = false;\r\n\r\n  /**\r\n   * Colour of the block as HSV hue value (0-360)\r\n   * This may be null if the block colour was not set via a hue number.\r\n   */\r\n  private hue_: number | null = null;\r\n\r\n  /** Colour of the block in '#RRGGBB' format. */\r\n  protected colour_ = '#000000';\r\n\r\n  /** Name of the block style. */\r\n  protected styleName_ = '';\r\n\r\n  /** An optional method called during initialization. */\r\n  init?: () => void;\r\n\r\n  /** An optional method called during disposal. */\r\n  destroy?: () => void;\r\n\r\n  /**\r\n   * An optional serialization method for defining how to serialize the\r\n   * mutation state to XML. This must be coupled with defining\r\n   * `domToMutation`.\r\n   */\r\n  mutationToDom?: (...p1: AnyDuringMigration[]) => Element;\r\n\r\n  /**\r\n   * An optional deserialization method for defining how to deserialize the\r\n   * mutation state from XML. This must be coupled with defining\r\n   * `mutationToDom`.\r\n   */\r\n  domToMutation?: (p1: Element) => void;\r\n\r\n  /**\r\n   * An optional serialization method for defining how to serialize the\r\n   * block's extra state (eg mutation state) to something JSON compatible.\r\n   * This must be coupled with defining `loadExtraState`.\r\n   *\r\n   * @param doFullSerialization Whether or not to serialize the full state of\r\n   *     the extra state (rather than possibly saving a reference to some\r\n   *     state). This is used during copy-paste. See the\r\n   *     {@link https://developers.devsite.google.com/blockly/guides/create-custom-blocks/extensions#full_serialization_and_backing_data | block serialization docs}\r\n   *     for more information.\r\n   */\r\n  saveExtraState?: (doFullSerialization?: boolean) => AnyDuringMigration;\r\n\r\n  /**\r\n   * An optional serialization method for defining how to deserialize the\r\n   * block's extra state (eg mutation state) from something JSON compatible.\r\n   * This must be coupled with defining `saveExtraState`.\r\n   */\r\n  loadExtraState?: (p1: AnyDuringMigration) => void;\r\n\r\n  /**\r\n   * An optional property for suppressing adding STATEMENT_PREFIX and\r\n   * STATEMENT_SUFFIX to generated code.\r\n   */\r\n  suppressPrefixSuffix: boolean | null = false;\r\n\r\n  /**\r\n   * An optional property for declaring developer variables.  Return a list of\r\n   * variable names for use by generators.  Developer variables are never\r\n   * shown to the user, but are declared as global variables in the generated\r\n   * code.\r\n   */\r\n  getDeveloperVariables?: () => string[];\r\n\r\n  /**\r\n   * An optional function that reconfigures the block based on the contents of\r\n   * the mutator dialog.\r\n   */\r\n  compose?: (p1: Block) => void;\r\n\r\n  /**\r\n   * An optional function that populates the mutator's dialog with\r\n   * this block's components.\r\n   */\r\n  decompose?: (p1: Workspace) => Block;\r\n  id: string;\r\n  outputConnection: Connection | null = null;\r\n  nextConnection: Connection | null = null;\r\n  previousConnection: Connection | null = null;\r\n  inputList: Input[] = [];\r\n  inputsInline?: boolean;\r\n  icons: IIcon[] = [];\r\n  private disabled = false;\r\n  tooltip: Tooltip.TipInfo = '';\r\n  contextMenu = true;\r\n\r\n  protected parentBlock_: this | null = null;\r\n\r\n  protected childBlocks_: this[] = [];\r\n\r\n  private deletable_ = true;\r\n\r\n  private movable_ = true;\r\n\r\n  private editable_ = true;\r\n\r\n  private isShadow_ = false;\r\n\r\n  protected collapsed_ = false;\r\n  protected outputShape_: number | null = null;\r\n\r\n  /**\r\n   * Is the current block currently in the process of being disposed?\r\n   */\r\n  private disposing = false;\r\n\r\n  private readonly xy_: Coordinate;\r\n  isInFlyout: boolean;\r\n  isInMutator: boolean;\r\n  RTL: boolean;\r\n\r\n  /** True if this block is an insertion marker. */\r\n  protected isInsertionMarker_ = false;\r\n\r\n  /** Name of the type of hat. */\r\n  hat?: string;\r\n\r\n  rendered: boolean | null = null;\r\n\r\n  /**\r\n   * String for block help, or function that returns a URL. Null for no help.\r\n   */\r\n  helpUrl: string | Function | null = null;\r\n\r\n  /** A bound callback function to use when the parent workspace changes. */\r\n  private onchangeWrapper_: ((p1: Abstract) => void) | null = null;\r\n\r\n  /**\r\n   * A count of statement inputs on the block.\r\n   *\r\n   * @internal\r\n   */\r\n  statementInputCount = 0;\r\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\r\n  type!: string;\r\n  // Record initial inline state.\r\n  inputsInlineDefault?: boolean;\r\n  workspace: Workspace;\r\n\r\n  /**\r\n   * @param workspace The block's workspace.\r\n   * @param prototypeName Name of the language object containing type-specific\r\n   *     functions for this block.\r\n   * @param opt_id Optional ID.  Use this ID if provided, otherwise create a new\r\n   *     ID.\r\n   * @throws When the prototypeName is not valid or not allowed.\r\n   */\r\n  constructor(workspace: Workspace, prototypeName: string, opt_id?: string) {\r\n    this.workspace = workspace;\r\n\r\n    this.id =\r\n      opt_id && !workspace.getBlockById(opt_id) ? opt_id : idGenerator.genUid();\r\n    workspace.setBlockById(this.id, this);\r\n\r\n    /**\r\n     * The block's position in workspace units.  (0, 0) is at the workspace's\r\n     * origin; scale does not change this value.\r\n     */\r\n    this.xy_ = new Coordinate(0, 0);\r\n    this.isInFlyout = workspace.isFlyout;\r\n    this.isInMutator = workspace.isMutator;\r\n\r\n    this.RTL = workspace.RTL;\r\n\r\n    // Copy the type-specific functions and data from the prototype.\r\n    if (prototypeName) {\r\n      this.type = prototypeName;\r\n      const prototype = Blocks[prototypeName];\r\n      if (!prototype || typeof prototype !== 'object') {\r\n        throw TypeError('Invalid block definition for type: ' + prototypeName);\r\n      }\r\n      Object.assign(this, prototype);\r\n    }\r\n\r\n    workspace.addTopBlock(this);\r\n    workspace.addTypedBlock(this);\r\n\r\n    if (new.target === Block) {\r\n      this.doInit_();\r\n    }\r\n  }\r\n\r\n  /** Calls the init() function and handles associated event firing, etc. */\r\n  protected doInit_() {\r\n    // All events fired should be part of the same group.\r\n    // Any events fired during init should not be undoable,\r\n    // so that block creation is atomic.\r\n    const existingGroup = eventUtils.getGroup();\r\n    if (!existingGroup) {\r\n      eventUtils.setGroup(true);\r\n    }\r\n    const initialUndoFlag = eventUtils.getRecordUndo();\r\n\r\n    try {\r\n      // Call an initialization function, if it exists.\r\n      if (typeof this.init === 'function') {\r\n        eventUtils.setRecordUndo(false);\r\n        this.init();\r\n        eventUtils.setRecordUndo(initialUndoFlag);\r\n      }\r\n\r\n      // Fire a create event.\r\n      if (eventUtils.isEnabled()) {\r\n        eventUtils.fire(new (eventUtils.get(eventUtils.BLOCK_CREATE))(this));\r\n      }\r\n    } finally {\r\n      eventUtils.setGroup(existingGroup);\r\n      // In case init threw, recordUndo flag should still be reset.\r\n      eventUtils.setRecordUndo(initialUndoFlag);\r\n    }\r\n    this.inputsInlineDefault = this.inputsInline;\r\n\r\n    // Bind an onchange function, if it exists.\r\n    if (typeof this.onchange === 'function') {\r\n      this.setOnChange(this.onchange);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Dispose of this block.\r\n   *\r\n   * @param healStack If true, then try to heal any gap by connecting the next\r\n   *     statement with the previous statement.  Otherwise, dispose of all\r\n   *     children of this block.\r\n   */\r\n  dispose(healStack: boolean) {\r\n    if (this.isDeadOrDying()) return;\r\n\r\n    // Dispose of this change listener before unplugging.\r\n    // Technically not necessary due to the event firing delay.\r\n    // But future-proofing.\r\n    if (this.onchangeWrapper_) {\r\n      this.workspace.removeChangeListener(this.onchangeWrapper_);\r\n    }\r\n\r\n    this.unplug(healStack);\r\n    if (eventUtils.isEnabled()) {\r\n      // Constructing the delete event is costly. Only perform if necessary.\r\n      eventUtils.fire(new (eventUtils.get(eventUtils.BLOCK_DELETE))(this));\r\n    }\r\n    this.workspace.removeTopBlock(this);\r\n    this.disposeInternal();\r\n  }\r\n\r\n  /**\r\n   * Disposes of this block without doing things required by the top block.\r\n   * E.g. does not fire events, unplug the block, etc.\r\n   */\r\n  protected disposeInternal() {\r\n    if (this.isDeadOrDying()) return;\r\n\r\n    if (this.onchangeWrapper_) {\r\n      this.workspace.removeChangeListener(this.onchangeWrapper_);\r\n    }\r\n\r\n    this.workspace.removeTypedBlock(this);\r\n    this.workspace.removeBlockById(this.id);\r\n    this.disposing = true;\r\n\r\n    if (typeof this.destroy === 'function') this.destroy();\r\n\r\n    this.childBlocks_.forEach((c) => c.disposeInternal());\r\n    this.inputList.forEach((i) => i.dispose());\r\n    this.inputList.length = 0;\r\n    this.getConnections_(true).forEach((c) => c.dispose());\r\n    this.disposed = true;\r\n  }\r\n\r\n  /**\r\n   * Returns true if the block is either in the process of being disposed, or\r\n   * is disposed.\r\n   *\r\n   * @internal\r\n   */\r\n  isDeadOrDying(): boolean {\r\n    return this.disposing || this.disposed;\r\n  }\r\n\r\n  /**\r\n   * Call initModel on all fields on the block.\r\n   * May be called more than once.\r\n   * Either initModel or initSvg must be called after creating a block and\r\n   * before the first interaction with it.  Interactions include UI actions\r\n   * (e.g. clicking and dragging) and firing events (e.g. create, delete, and\r\n   * change).\r\n   */\r\n  initModel() {\r\n    for (const input of this.inputList) {\r\n      for (const field of input.fieldRow) {\r\n        if (field.initModel) {\r\n          field.initModel();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unplug this block from its superior block.  If this block is a statement,\r\n   * optionally reconnect the block underneath with the block on top.\r\n   *\r\n   * @param opt_healStack Disconnect child statement and reconnect stack.\r\n   *     Defaults to false.\r\n   */\r\n  unplug(opt_healStack?: boolean) {\r\n    if (this.outputConnection) {\r\n      this.unplugFromRow_(opt_healStack);\r\n    }\r\n    if (this.previousConnection) {\r\n      this.unplugFromStack_(opt_healStack);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unplug this block's output from an input on another block.  Optionally\r\n   * reconnect the block's parent to the only child block, if possible.\r\n   *\r\n   * @param opt_healStack Disconnect right-side block and connect to left-side\r\n   *     block.  Defaults to false.\r\n   */\r\n  private unplugFromRow_(opt_healStack?: boolean) {\r\n    let parentConnection = null;\r\n    if (this.outputConnection?.isConnected()) {\r\n      parentConnection = this.outputConnection.targetConnection;\r\n      // Disconnect from any superior block.\r\n      this.outputConnection.disconnect();\r\n    }\r\n\r\n    // Return early in obvious cases.\r\n    if (!parentConnection || !opt_healStack) {\r\n      return;\r\n    }\r\n\r\n    const thisConnection = this.getOnlyValueConnection_();\r\n    if (\r\n      !thisConnection ||\r\n      !thisConnection.isConnected() ||\r\n      thisConnection.targetBlock()!.isShadow()\r\n    ) {\r\n      // Too many or too few possible connections on this block, or there's\r\n      // nothing on the other side of this connection.\r\n      return;\r\n    }\r\n\r\n    const childConnection = thisConnection.targetConnection;\r\n    // Disconnect the child block.\r\n    childConnection?.disconnect();\r\n    // Connect child to the parent if possible, otherwise bump away.\r\n    if (\r\n      this.workspace.connectionChecker.canConnect(\r\n        childConnection,\r\n        parentConnection,\r\n        false,\r\n      )\r\n    ) {\r\n      parentConnection.connect(childConnection!);\r\n    } else {\r\n      childConnection?.onFailedConnect(parentConnection);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns the connection on the value input that is connected to another\r\n   * block. When an insertion marker is connected to a connection with a block\r\n   * already attached, the connected block is attached to the insertion marker.\r\n   * Since only one block can be displaced and attached to the insertion marker\r\n   * this should only ever return one connection.\r\n   *\r\n   * @returns The connection on the value input, or null.\r\n   */\r\n  private getOnlyValueConnection_(): Connection | null {\r\n    let connection = null;\r\n    for (let i = 0; i < this.inputList.length; i++) {\r\n      const thisConnection = this.inputList[i].connection;\r\n      if (\r\n        thisConnection &&\r\n        thisConnection.type === ConnectionType.INPUT_VALUE &&\r\n        thisConnection.targetConnection\r\n      ) {\r\n        if (connection) {\r\n          return null; // More than one value input found.\r\n        }\r\n        connection = thisConnection;\r\n      }\r\n    }\r\n    return connection;\r\n  }\r\n\r\n  /**\r\n   * Unplug this statement block from its superior block.  Optionally reconnect\r\n   * the block underneath with the block on top.\r\n   *\r\n   * @param opt_healStack Disconnect child statement and reconnect stack.\r\n   *     Defaults to false.\r\n   */\r\n  private unplugFromStack_(opt_healStack?: boolean) {\r\n    let previousTarget = null;\r\n    if (this.previousConnection?.isConnected()) {\r\n      // Remember the connection that any next statements need to connect to.\r\n      previousTarget = this.previousConnection.targetConnection;\r\n      // Detach this block from the parent's tree.\r\n      this.previousConnection.disconnect();\r\n    }\r\n    const nextBlock = this.getNextBlock();\r\n    if (opt_healStack && nextBlock && !nextBlock.isShadow()) {\r\n      // Disconnect the next statement.\r\n      const nextTarget = this.nextConnection?.targetConnection ?? null;\r\n      nextTarget?.disconnect();\r\n      if (\r\n        previousTarget &&\r\n        this.workspace.connectionChecker.canConnect(\r\n          previousTarget,\r\n          nextTarget,\r\n          false,\r\n        )\r\n      ) {\r\n        // Attach the next statement to the previous statement.\r\n        previousTarget.connect(nextTarget!);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns all connections originating from this block.\r\n   *\r\n   * @param _all If true, return all connections even hidden ones.\r\n   * @returns Array of connections.\r\n   * @internal\r\n   */\r\n  getConnections_(_all: boolean): Connection[] {\r\n    const myConnections = [];\r\n    if (this.outputConnection) {\r\n      myConnections.push(this.outputConnection);\r\n    }\r\n    if (this.previousConnection) {\r\n      myConnections.push(this.previousConnection);\r\n    }\r\n    if (this.nextConnection) {\r\n      myConnections.push(this.nextConnection);\r\n    }\r\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\r\n      if (input.connection) {\r\n        myConnections.push(input.connection);\r\n      }\r\n    }\r\n    return myConnections;\r\n  }\r\n\r\n  /**\r\n   * Walks down a stack of blocks and finds the last next connection on the\r\n   * stack.\r\n   *\r\n   * @param ignoreShadows If true,the last connection on a non-shadow block will\r\n   *     be returned. If false, this will follow shadows to find the last\r\n   *     connection.\r\n   * @returns The last next connection on the stack, or null.\r\n   * @internal\r\n   */\r\n  lastConnectionInStack(ignoreShadows: boolean): Connection | null {\r\n    let nextConnection = this.nextConnection;\r\n    while (nextConnection) {\r\n      const nextBlock = nextConnection.targetBlock();\r\n      if (!nextBlock || (ignoreShadows && nextBlock.isShadow())) {\r\n        return nextConnection;\r\n      }\r\n      nextConnection = nextBlock.nextConnection;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Bump unconnected blocks out of alignment.  Two blocks which aren't actually\r\n   * connected should not coincidentally line up on screen.\r\n   */\r\n  bumpNeighbours() {}\r\n  // noop.\r\n\r\n  /**\r\n   * Return the parent block or null if this block is at the top level. The\r\n   * parent block is either the block connected to the previous connection (for\r\n   * a statement block) or the block connected to the output connection (for a\r\n   * value block).\r\n   *\r\n   * @returns The block (if any) that holds the current block.\r\n   */\r\n  getParent(): this | null {\r\n    return this.parentBlock_;\r\n  }\r\n\r\n  /**\r\n   * Return the input that connects to the specified block.\r\n   *\r\n   * @param block A block connected to an input on this block.\r\n   * @returns The input (if any) that connects to the specified block.\r\n   */\r\n  getInputWithBlock(block: Block): Input | null {\r\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\r\n      if (input.connection && input.connection.targetBlock() === block) {\r\n        return input;\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Return the parent block that surrounds the current block, or null if this\r\n   * block has no surrounding block.  A parent block might just be the previous\r\n   * statement, whereas the surrounding block is an if statement, while loop,\r\n   * etc.\r\n   *\r\n   * @returns The block (if any) that surrounds the current block.\r\n   */\r\n  getSurroundParent(): this | null {\r\n    /* eslint-disable-next-line @typescript-eslint/no-this-alias */\r\n    let block: this | null = this;\r\n    let prevBlock;\r\n    do {\r\n      prevBlock = block;\r\n      block = block.getParent();\r\n      if (!block) {\r\n        // Ran off the top.\r\n        return null;\r\n      }\r\n    } while (block.getNextBlock() === prevBlock);\r\n    // This block is an enclosing parent, not just a statement in a stack.\r\n    return block;\r\n  }\r\n\r\n  /**\r\n   * Return the next statement block directly connected to this block.\r\n   *\r\n   * @returns The next statement block or null.\r\n   */\r\n  getNextBlock(): Block | null {\r\n    return this.nextConnection && this.nextConnection.targetBlock();\r\n  }\r\n\r\n  /**\r\n   * Returns the block connected to the previous connection.\r\n   *\r\n   * @returns The previous statement block or null.\r\n   */\r\n  getPreviousBlock(): Block | null {\r\n    return this.previousConnection && this.previousConnection.targetBlock();\r\n  }\r\n\r\n  /**\r\n   * Return the top-most block in this block's tree.\r\n   * This will return itself if this block is at the top level.\r\n   *\r\n   * @returns The root block.\r\n   */\r\n  getRootBlock(): this {\r\n    let rootBlock: this;\r\n    /* eslint-disable-next-line @typescript-eslint/no-this-alias */\r\n    let block: this | null = this;\r\n    do {\r\n      rootBlock = block;\r\n      block = rootBlock.parentBlock_;\r\n    } while (block);\r\n    return rootBlock;\r\n  }\r\n\r\n  /**\r\n   * Walk up from the given block up through the stack of blocks to find\r\n   * the top block of the sub stack. If we are nested in a statement input only\r\n   * find the top-most nested block. Do not go all the way to the root block.\r\n   *\r\n   * @returns The top block in a stack.\r\n   * @internal\r\n   */\r\n  getTopStackBlock(): this {\r\n    /* eslint-disable-next-line @typescript-eslint/no-this-alias */\r\n    let block = this;\r\n    let previous;\r\n    do {\r\n      previous = block.getPreviousBlock();\r\n      // AnyDuringMigration because:  Type 'Block' is not assignable to type\r\n      // 'this'.\r\n    } while (\r\n      previous &&\r\n      previous.getNextBlock() === block &&\r\n      (block = previous as AnyDuringMigration)\r\n    );\r\n    return block;\r\n  }\r\n\r\n  /**\r\n   * Find all the blocks that are directly nested inside this one.\r\n   * Includes value and statement inputs, as well as any following statement.\r\n   * Excludes any connection on an output tab or any preceding statement.\r\n   * Blocks are optionally sorted by position; top to bottom.\r\n   *\r\n   * @param ordered Sort the list if true.\r\n   * @returns Array of blocks.\r\n   */\r\n  getChildren(ordered: boolean): Block[] {\r\n    if (!ordered) {\r\n      return this.childBlocks_;\r\n    }\r\n    const blocks = [];\r\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\r\n      if (input.connection) {\r\n        const child = input.connection.targetBlock();\r\n        if (child) {\r\n          blocks.push(child);\r\n        }\r\n      }\r\n    }\r\n    const next = this.getNextBlock();\r\n    if (next) {\r\n      blocks.push(next);\r\n    }\r\n    return blocks;\r\n  }\r\n\r\n  /**\r\n   * Set parent of this block to be a new block or null.\r\n   *\r\n   * @param newParent New parent block.\r\n   * @internal\r\n   */\r\n  setParent(newParent: this | null) {\r\n    if (newParent === this.parentBlock_) {\r\n      return;\r\n    }\r\n\r\n    // Check that block is connected to new parent if new parent is not null and\r\n    //    that block is not connected to superior one if new parent is null.\r\n    const targetBlock =\r\n      (this.previousConnection && this.previousConnection.targetBlock()) ||\r\n      (this.outputConnection && this.outputConnection.targetBlock());\r\n    const isConnected = !!targetBlock;\r\n\r\n    if (isConnected && newParent && targetBlock !== newParent) {\r\n      throw Error('Block connected to superior one that is not new parent.');\r\n    } else if (!isConnected && newParent) {\r\n      throw Error('Block not connected to new parent.');\r\n    } else if (isConnected && !newParent) {\r\n      throw Error(\r\n        'Cannot set parent to null while block is still connected to' +\r\n          ' superior block.',\r\n      );\r\n    }\r\n\r\n    // This block hasn't actually moved on-screen, so there's no need to\r\n    // update\r\n    //     its connection locations.\r\n    if (this.parentBlock_) {\r\n      // Remove this block from the old parent's child list.\r\n      arrayUtils.removeElem(this.parentBlock_.childBlocks_, this);\r\n    } else {\r\n      // New parent must be non-null so remove this block from the workspace's\r\n      //     list of top-most blocks.\r\n      this.workspace.removeTopBlock(this);\r\n    }\r\n\r\n    this.parentBlock_ = newParent;\r\n    if (newParent) {\r\n      // Add this block to the new parent's child list.\r\n      newParent.childBlocks_.push(this);\r\n    } else {\r\n      this.workspace.addTopBlock(this);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Find all the blocks that are directly or indirectly nested inside this one.\r\n   * Includes this block in the list.\r\n   * Includes value and statement inputs, as well as any following statements.\r\n   * Excludes any connection on an output tab or any preceding statements.\r\n   * Blocks are optionally sorted by position; top to bottom.\r\n   *\r\n   * @param ordered Sort the list if true.\r\n   * @returns Flattened array of blocks.\r\n   */\r\n  getDescendants(ordered: boolean): this[] {\r\n    const blocks = [this];\r\n    const childBlocks = this.getChildren(ordered);\r\n    for (let child, i = 0; (child = childBlocks[i]); i++) {\r\n      // AnyDuringMigration because:  Argument of type 'Block[]' is not\r\n      // assignable to parameter of type 'this[]'.\r\n      blocks.push(...(child.getDescendants(ordered) as AnyDuringMigration));\r\n    }\r\n    return blocks;\r\n  }\r\n\r\n  /**\r\n   * Get whether this block is deletable or not.\r\n   *\r\n   * @returns True if deletable.\r\n   */\r\n  isDeletable(): boolean {\r\n    return (\r\n      this.deletable_ &&\r\n      !this.isShadow_ &&\r\n      !this.isDeadOrDying() &&\r\n      !this.workspace.options.readOnly\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Return whether this block's own deletable property is true or false.\r\n   *\r\n   * @returns True if the block's deletable property is true, false otherwise.\r\n   */\r\n  isOwnDeletable(): boolean {\r\n    return this.deletable_;\r\n  }\r\n\r\n  /**\r\n   * Set whether this block is deletable or not.\r\n   *\r\n   * @param deletable True if deletable.\r\n   */\r\n  setDeletable(deletable: boolean) {\r\n    this.deletable_ = deletable;\r\n  }\r\n\r\n  /**\r\n   * Get whether this block is movable or not.\r\n   *\r\n   * @returns True if movable.\r\n   * @internal\r\n   */\r\n  isMovable(): boolean {\r\n    return (\r\n      this.movable_ &&\r\n      !this.isShadow_ &&\r\n      !this.isDeadOrDying() &&\r\n      !this.workspace.options.readOnly\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Return whether this block's own movable property is true or false.\r\n   *\r\n   * @returns True if the block's movable property is true, false otherwise.\r\n   * @internal\r\n   */\r\n  isOwnMovable(): boolean {\r\n    return this.movable_;\r\n  }\r\n\r\n  /**\r\n   * Set whether this block is movable or not.\r\n   *\r\n   * @param movable True if movable.\r\n   */\r\n  setMovable(movable: boolean) {\r\n    this.movable_ = movable;\r\n  }\r\n\r\n  /**\r\n   * Get whether is block is duplicatable or not. If duplicating this block and\r\n   * descendants will put this block over the workspace's capacity this block is\r\n   * not duplicatable. If duplicating this block and descendants will put any\r\n   * type over their maxInstances this block is not duplicatable.\r\n   *\r\n   * @returns True if duplicatable.\r\n   */\r\n  isDuplicatable(): boolean {\r\n    if (!this.workspace.hasBlockLimits()) {\r\n      return true;\r\n    }\r\n    return this.workspace.isCapacityAvailable(\r\n      common.getBlockTypeCounts(this, true),\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get whether this block is a shadow block or not.\r\n   *\r\n   * @returns True if a shadow.\r\n   */\r\n  isShadow(): boolean {\r\n    return this.isShadow_;\r\n  }\r\n\r\n  /**\r\n   * Set whether this block is a shadow block or not.\r\n   * This method is internal and should not be called by users of Blockly. To\r\n   * create shadow blocks programmatically call connection.setShadowState\r\n   *\r\n   * @param shadow True if a shadow.\r\n   * @internal\r\n   */\r\n  setShadow(shadow: boolean) {\r\n    this.isShadow_ = shadow;\r\n  }\r\n\r\n  /**\r\n   * Get whether this block is an insertion marker block or not.\r\n   *\r\n   * @returns True if an insertion marker.\r\n   */\r\n  isInsertionMarker(): boolean {\r\n    return this.isInsertionMarker_;\r\n  }\r\n\r\n  /**\r\n   * Set whether this block is an insertion marker block or not.\r\n   * Once set this cannot be unset.\r\n   *\r\n   * @param insertionMarker True if an insertion marker.\r\n   * @internal\r\n   */\r\n  setInsertionMarker(insertionMarker: boolean) {\r\n    this.isInsertionMarker_ = insertionMarker;\r\n  }\r\n\r\n  /**\r\n   * Get whether this block is editable or not.\r\n   *\r\n   * @returns True if editable.\r\n   * @internal\r\n   */\r\n  isEditable(): boolean {\r\n    return (\r\n      this.editable_ &&\r\n      !this.isDeadOrDying() &&\r\n      !this.workspace.options.readOnly\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Return whether this block's own editable property is true or false.\r\n   *\r\n   * @returns True if the block's editable property is true, false otherwise.\r\n   */\r\n  isOwnEditable(): boolean {\r\n    return this.editable_;\r\n  }\r\n\r\n  /**\r\n   * Set whether this block is editable or not.\r\n   *\r\n   * @param editable True if editable.\r\n   */\r\n  setEditable(editable: boolean) {\r\n    this.editable_ = editable;\r\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\r\n      for (let j = 0, field; (field = input.fieldRow[j]); j++) {\r\n        field.updateEditable();\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns if this block has been disposed of / deleted.\r\n   *\r\n   * @returns True if this block has been disposed of / deleted.\r\n   */\r\n  isDisposed(): boolean {\r\n    return this.disposed;\r\n  }\r\n\r\n  /**\r\n   * @returns True if this block is a value block with a single editable field.\r\n   * @internal\r\n   */\r\n  isSimpleReporter(): boolean {\r\n    if (!this.outputConnection) return false;\r\n\r\n    for (const input of this.inputList) {\r\n      if (input.connection || input.fieldRow.length > 1) return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Find the connection on this block that corresponds to the given connection\r\n   * on the other block.\r\n   * Used to match connections between a block and its insertion marker.\r\n   *\r\n   * @param otherBlock The other block to match against.\r\n   * @param conn The other connection to match.\r\n   * @returns The matching connection on this block, or null.\r\n   * @internal\r\n   */\r\n  getMatchingConnection(\r\n    otherBlock: Block,\r\n    conn: Connection,\r\n  ): Connection | null {\r\n    const connections = this.getConnections_(true);\r\n    const otherConnections = otherBlock.getConnections_(true);\r\n    if (connections.length !== otherConnections.length) {\r\n      throw Error('Connection lists did not match in length.');\r\n    }\r\n    for (let i = 0; i < otherConnections.length; i++) {\r\n      if (otherConnections[i] === conn) {\r\n        return connections[i];\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Set the URL of this block's help page.\r\n   *\r\n   * @param url URL string for block help, or function that returns a URL.  Null\r\n   *     for no help.\r\n   */\r\n  setHelpUrl(url: string | Function) {\r\n    this.helpUrl = url;\r\n  }\r\n\r\n  /**\r\n   * Sets the tooltip for this block.\r\n   *\r\n   * @param newTip The text for the tooltip, a function that returns the text\r\n   *     for the tooltip, or a parent object whose tooltip will be used. To not\r\n   *     display a tooltip pass the empty string.\r\n   */\r\n  setTooltip(newTip: Tooltip.TipInfo) {\r\n    this.tooltip = newTip;\r\n  }\r\n\r\n  /**\r\n   * Returns the tooltip text for this block.\r\n   *\r\n   * @returns The tooltip text for this block.\r\n   */\r\n  getTooltip(): string {\r\n    return Tooltip.getTooltipOfObject(this);\r\n  }\r\n\r\n  /**\r\n   * Get the colour of a block.\r\n   *\r\n   * @returns #RRGGBB string.\r\n   */\r\n  getColour(): string {\r\n    return this.colour_;\r\n  }\r\n\r\n  /**\r\n   * Get the name of the block style.\r\n   *\r\n   * @returns Name of the block style.\r\n   */\r\n  getStyleName(): string {\r\n    return this.styleName_;\r\n  }\r\n\r\n  /**\r\n   * Get the HSV hue value of a block.  Null if hue not set.\r\n   *\r\n   * @returns Hue value (0-360).\r\n   */\r\n  getHue(): number | null {\r\n    return this.hue_;\r\n  }\r\n\r\n  /**\r\n   * Change the colour of a block.\r\n   *\r\n   * @param colour HSV hue value (0 to 360), #RRGGBB string, or a message\r\n   *     reference string pointing to one of those two values.\r\n   */\r\n  setColour(colour: number | string) {\r\n    const parsed = parsing.parseBlockColour(colour);\r\n    this.hue_ = parsed.hue;\r\n    this.colour_ = parsed.hex;\r\n  }\r\n\r\n  /**\r\n   * Set the style and colour values of a block.\r\n   *\r\n   * @param blockStyleName Name of the block style.\r\n   */\r\n  setStyle(blockStyleName: string) {\r\n    this.styleName_ = blockStyleName;\r\n  }\r\n\r\n  /**\r\n   * Sets a callback function to use whenever the block's parent workspace\r\n   * changes, replacing any prior onchange handler. This is usually only called\r\n   * from the constructor, the block type initializer function, or an extension\r\n   * initializer function.\r\n   *\r\n   * @param onchangeFn The callback to call when the block's workspace changes.\r\n   * @throws {Error} if onchangeFn is not falsey and not a function.\r\n   */\r\n  setOnChange(onchangeFn: (p1: Abstract) => void) {\r\n    if (onchangeFn && typeof onchangeFn !== 'function') {\r\n      throw Error('onchange must be a function.');\r\n    }\r\n    if (this.onchangeWrapper_) {\r\n      this.workspace.removeChangeListener(this.onchangeWrapper_);\r\n    }\r\n    this.onchange = onchangeFn;\r\n    this.onchangeWrapper_ = onchangeFn.bind(this);\r\n    this.workspace.addChangeListener(this.onchangeWrapper_);\r\n  }\r\n\r\n  /**\r\n   * Returns the named field from a block.\r\n   *\r\n   * @param name The name of the field.\r\n   * @returns Named field, or null if field does not exist.\r\n   */\r\n  getField(name: string): Field | null {\r\n    if (typeof name !== 'string') {\r\n      throw TypeError(\r\n        'Block.prototype.getField expects a string ' +\r\n          'with the field name but received ' +\r\n          (name === undefined ? 'nothing' : name + ' of type ' + typeof name) +\r\n          ' instead',\r\n      );\r\n    }\r\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\r\n      for (let j = 0, field; (field = input.fieldRow[j]); j++) {\r\n        if (field.name === name) {\r\n          return field;\r\n        }\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Return all variables referenced by this block.\r\n   *\r\n   * @returns List of variable ids.\r\n   */\r\n  getVars(): string[] {\r\n    const vars: string[] = [];\r\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\r\n      for (let j = 0, field; (field = input.fieldRow[j]); j++) {\r\n        if (field.referencesVariables()) {\r\n          // NOTE: This only applies to `FieldVariable`, a `Field<string>`\r\n          vars.push(field.getValue() as string);\r\n        }\r\n      }\r\n    }\r\n    return vars;\r\n  }\r\n\r\n  /**\r\n   * Return all variables referenced by this block.\r\n   *\r\n   * @returns List of variable models.\r\n   * @internal\r\n   */\r\n  getVarModels(): VariableModel[] {\r\n    const vars = [];\r\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\r\n      for (let j = 0, field; (field = input.fieldRow[j]); j++) {\r\n        if (field.referencesVariables()) {\r\n          const model = this.workspace.getVariableById(\r\n            field.getValue() as string,\r\n          );\r\n          // Check if the variable actually exists (and isn't just a potential\r\n          // variable).\r\n          if (model) {\r\n            vars.push(model);\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return vars;\r\n  }\r\n\r\n  /**\r\n   * Notification that a variable is renaming but keeping the same ID.  If the\r\n   * variable is in use on this block, rerender to show the new name.\r\n   *\r\n   * @param variable The variable being renamed.\r\n   * @internal\r\n   */\r\n  updateVarName(variable: VariableModel) {\r\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\r\n      for (let j = 0, field; (field = input.fieldRow[j]); j++) {\r\n        if (\r\n          field.referencesVariables() &&\r\n          variable.getId() === field.getValue()\r\n        ) {\r\n          field.refreshVariableName();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Notification that a variable is renaming.\r\n   * If the ID matches one of this block's variables, rename it.\r\n   *\r\n   * @param oldId ID of variable to rename.\r\n   * @param newId ID of new variable.  May be the same as oldId, but with an\r\n   *     updated name.\r\n   */\r\n  renameVarById(oldId: string, newId: string) {\r\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\r\n      for (let j = 0, field; (field = input.fieldRow[j]); j++) {\r\n        if (field.referencesVariables() && oldId === field.getValue()) {\r\n          field.setValue(newId);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns the language-neutral value of the given field.\r\n   *\r\n   * @param name The name of the field.\r\n   * @returns Value of the field or null if field does not exist.\r\n   */\r\n  getFieldValue(name: string): AnyDuringMigration {\r\n    const field = this.getField(name);\r\n    if (field) {\r\n      return field.getValue();\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Sets the value of the given field for this block.\r\n   *\r\n   * @param newValue The value to set.\r\n   * @param name The name of the field to set the value of.\r\n   */\r\n  setFieldValue(newValue: AnyDuringMigration, name: string) {\r\n    const field = this.getField(name);\r\n    if (!field) {\r\n      throw Error('Field \"' + name + '\" not found.');\r\n    }\r\n    field.setValue(newValue);\r\n  }\r\n\r\n  /**\r\n   * Set whether this block can chain onto the bottom of another block.\r\n   *\r\n   * @param newBoolean True if there can be a previous statement.\r\n   * @param opt_check Statement type or list of statement types.  Null/undefined\r\n   *     if any type could be connected.\r\n   */\r\n  setPreviousStatement(\r\n    newBoolean: boolean,\r\n    opt_check?: string | string[] | null,\r\n  ) {\r\n    if (newBoolean) {\r\n      if (opt_check === undefined) {\r\n        opt_check = null;\r\n      }\r\n      if (!this.previousConnection) {\r\n        this.previousConnection = this.makeConnection_(\r\n          ConnectionType.PREVIOUS_STATEMENT,\r\n        );\r\n      }\r\n      this.previousConnection.setCheck(opt_check);\r\n    } else {\r\n      if (this.previousConnection) {\r\n        if (this.previousConnection.isConnected()) {\r\n          throw Error(\r\n            'Must disconnect previous statement before removing ' +\r\n              'connection.',\r\n          );\r\n        }\r\n        this.previousConnection.dispose();\r\n        this.previousConnection = null;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set whether another block can chain onto the bottom of this block.\r\n   *\r\n   * @param newBoolean True if there can be a next statement.\r\n   * @param opt_check Statement type or list of statement types.  Null/undefined\r\n   *     if any type could be connected.\r\n   */\r\n  setNextStatement(newBoolean: boolean, opt_check?: string | string[] | null) {\r\n    if (newBoolean) {\r\n      if (opt_check === undefined) {\r\n        opt_check = null;\r\n      }\r\n      if (!this.nextConnection) {\r\n        this.nextConnection = this.makeConnection_(\r\n          ConnectionType.NEXT_STATEMENT,\r\n        );\r\n      }\r\n      this.nextConnection.setCheck(opt_check);\r\n    } else {\r\n      if (this.nextConnection) {\r\n        if (this.nextConnection.isConnected()) {\r\n          throw Error(\r\n            'Must disconnect next statement before removing ' + 'connection.',\r\n          );\r\n        }\r\n        this.nextConnection.dispose();\r\n        this.nextConnection = null;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set whether this block returns a value.\r\n   *\r\n   * @param newBoolean True if there is an output.\r\n   * @param opt_check Returned type or list of returned types.  Null or\r\n   *     undefined if any type could be returned (e.g. variable get).\r\n   */\r\n  setOutput(newBoolean: boolean, opt_check?: string | string[] | null) {\r\n    if (newBoolean) {\r\n      if (opt_check === undefined) {\r\n        opt_check = null;\r\n      }\r\n      if (!this.outputConnection) {\r\n        this.outputConnection = this.makeConnection_(\r\n          ConnectionType.OUTPUT_VALUE,\r\n        );\r\n      }\r\n      this.outputConnection.setCheck(opt_check);\r\n    } else {\r\n      if (this.outputConnection) {\r\n        if (this.outputConnection.isConnected()) {\r\n          throw Error(\r\n            'Must disconnect output value before removing connection.',\r\n          );\r\n        }\r\n        this.outputConnection.dispose();\r\n        this.outputConnection = null;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set whether value inputs are arranged horizontally or vertically.\r\n   *\r\n   * @param newBoolean True if inputs are horizontal.\r\n   */\r\n  setInputsInline(newBoolean: boolean) {\r\n    if (this.inputsInline !== newBoolean) {\r\n      eventUtils.fire(\r\n        new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\r\n          this,\r\n          'inline',\r\n          null,\r\n          this.inputsInline,\r\n          newBoolean,\r\n        ),\r\n      );\r\n      this.inputsInline = newBoolean;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get whether value inputs are arranged horizontally or vertically.\r\n   *\r\n   * @returns True if inputs are horizontal.\r\n   */\r\n  getInputsInline(): boolean {\r\n    if (this.inputsInline !== undefined) {\r\n      // Set explicitly.\r\n      return this.inputsInline;\r\n    }\r\n    // Not defined explicitly.  Figure out what would look best.\r\n    for (let i = 1; i < this.inputList.length; i++) {\r\n      if (\r\n        this.inputList[i - 1] instanceof DummyInput &&\r\n        this.inputList[i] instanceof DummyInput\r\n      ) {\r\n        // Two dummy inputs in a row.  Don't inline them.\r\n        return false;\r\n      }\r\n    }\r\n    for (let i = 1; i < this.inputList.length; i++) {\r\n      if (\r\n        this.inputList[i - 1] instanceof ValueInput &&\r\n        this.inputList[i] instanceof DummyInput\r\n      ) {\r\n        // Dummy input after a value input.  Inline them.\r\n        return true;\r\n      }\r\n    }\r\n    for (let i = 0; i < this.inputList.length; i++) {\r\n      if (this.inputList[i] instanceof EndRowInput) {\r\n        // A row-end input is present. Inline value inputs.\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Set the block's output shape.\r\n   *\r\n   * @param outputShape Value representing an output shape.\r\n   */\r\n  setOutputShape(outputShape: number | null) {\r\n    this.outputShape_ = outputShape;\r\n  }\r\n\r\n  /**\r\n   * Get the block's output shape.\r\n   *\r\n   * @returns Value representing output shape if one exists.\r\n   */\r\n  getOutputShape(): number | null {\r\n    return this.outputShape_;\r\n  }\r\n\r\n  /**\r\n   * Get whether this block is enabled or not.\r\n   *\r\n   * @returns True if enabled.\r\n   */\r\n  isEnabled(): boolean {\r\n    return !this.disabled;\r\n  }\r\n\r\n  /**\r\n   * Set whether the block is enabled or not.\r\n   *\r\n   * @param enabled True if enabled.\r\n   */\r\n  setEnabled(enabled: boolean) {\r\n    if (this.isEnabled() !== enabled) {\r\n      const oldValue = this.disabled;\r\n      this.disabled = !enabled;\r\n      eventUtils.fire(\r\n        new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\r\n          this,\r\n          'disabled',\r\n          null,\r\n          oldValue,\r\n          !enabled,\r\n        ),\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get whether the block is disabled or not due to parents.\r\n   * The block's own disabled property is not considered.\r\n   *\r\n   * @returns True if disabled.\r\n   */\r\n  getInheritedDisabled(): boolean {\r\n    let ancestor = this.getSurroundParent();\r\n    while (ancestor) {\r\n      if (ancestor.disabled) {\r\n        return true;\r\n      }\r\n      ancestor = ancestor.getSurroundParent();\r\n    }\r\n    // Ran off the top.\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Get whether the block is collapsed or not.\r\n   *\r\n   * @returns True if collapsed.\r\n   */\r\n  isCollapsed(): boolean {\r\n    return this.collapsed_;\r\n  }\r\n\r\n  /**\r\n   * Set whether the block is collapsed or not.\r\n   *\r\n   * @param collapsed True if collapsed.\r\n   */\r\n  setCollapsed(collapsed: boolean) {\r\n    if (this.collapsed_ !== collapsed) {\r\n      eventUtils.fire(\r\n        new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\r\n          this,\r\n          'collapsed',\r\n          null,\r\n          this.collapsed_,\r\n          collapsed,\r\n        ),\r\n      );\r\n      this.collapsed_ = collapsed;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create a human-readable text representation of this block and any children.\r\n   *\r\n   * @param opt_maxLength Truncate the string to this length.\r\n   * @param opt_emptyToken The placeholder string used to denote an empty input.\r\n   *     If not specified, '?' is used.\r\n   * @returns Text of block.\r\n   */\r\n  toString(opt_maxLength?: number, opt_emptyToken?: string): string {\r\n    const tokens = this.toTokens(opt_emptyToken);\r\n\r\n    // Run through our tokens array and simplify expression to remove\r\n    // parentheses around single field blocks.\r\n    // E.g. ['repeat', '(', '10', ')', 'times', 'do', '?']\r\n    for (let i = 2; i < tokens.length; i++) {\r\n      if (tokens[i - 2] === '(' && tokens[i] === ')') {\r\n        tokens[i - 2] = tokens[i - 1];\r\n        tokens.splice(i - 1, 2);\r\n      }\r\n    }\r\n\r\n    // Join the text array, removing the spaces around added parentheses.\r\n    let prev = '';\r\n    let text: string = tokens.reduce((acc, curr) => {\r\n      const val = acc + (prev === '(' || curr === ')' ? '' : ' ') + curr;\r\n      prev = curr[curr.length - 1];\r\n      return val;\r\n    }, '');\r\n\r\n    text = text.trim() || '???';\r\n    if (opt_maxLength) {\r\n      // TODO: Improve truncation so that text from this block is given\r\n      // priority. E.g. \"1+2+3+4+5+6+7+8+9=0\" should be \"...6+7+8+9=0\", not\r\n      // \"1+2+3+4+5...\". E.g. \"1+2+3+4+5=6+7+8+9+0\" should be \"...4+5=6+7...\".\r\n      if (text.length > opt_maxLength) {\r\n        text = text.substring(0, opt_maxLength - 3) + '...';\r\n      }\r\n    }\r\n    return text;\r\n  }\r\n\r\n  /**\r\n   * Converts this block into string tokens.\r\n   *\r\n   * @param emptyToken The token to use in place of an empty input.\r\n   *     Defaults to '?'.\r\n   * @returns The array of string tokens representing this block.\r\n   */\r\n  private toTokens(emptyToken = '?'): string[] {\r\n    const tokens = [];\r\n    /**\r\n     * Whether or not to add parentheses around an input.\r\n     *\r\n     * @param connection The connection.\r\n     * @returns True if we should add parentheses around the input.\r\n     */\r\n    function shouldAddParentheses(connection: Connection): boolean {\r\n      let checks = connection.getCheck();\r\n      if (!checks && connection.targetConnection) {\r\n        checks = connection.targetConnection.getCheck();\r\n      }\r\n      return (\r\n        !!checks &&\r\n        (checks.indexOf('Boolean') !== -1 || checks.indexOf('Number') !== -1)\r\n      );\r\n    }\r\n\r\n    for (const input of this.inputList) {\r\n      if (input.name == constants.COLLAPSED_INPUT_NAME) {\r\n        continue;\r\n      }\r\n      for (const field of input.fieldRow) {\r\n        tokens.push(field.getText());\r\n      }\r\n      if (input.connection) {\r\n        const child = input.connection.targetBlock();\r\n        if (child) {\r\n          const shouldAddParens = shouldAddParentheses(input.connection);\r\n          if (shouldAddParens) tokens.push('(');\r\n          tokens.push(...child.toTokens(emptyToken));\r\n          if (shouldAddParens) tokens.push(')');\r\n        } else {\r\n          tokens.push(emptyToken);\r\n        }\r\n      }\r\n    }\r\n    return tokens;\r\n  }\r\n\r\n  /**\r\n   * Appends a value input row.\r\n   *\r\n   * @param name Language-neutral identifier which may used to find this input\r\n   *     again.  Should be unique to this block.\r\n   * @returns The input object created.\r\n   */\r\n  appendValueInput(name: string): Input {\r\n    return this.appendInput(new ValueInput(name, this));\r\n  }\r\n\r\n  /**\r\n   * Appends a statement input row.\r\n   *\r\n   * @param name Language-neutral identifier which may used to find this input\r\n   *     again.  Should be unique to this block.\r\n   * @returns The input object created.\r\n   */\r\n  appendStatementInput(name: string): Input {\r\n    this.statementInputCount++;\r\n    return this.appendInput(new StatementInput(name, this));\r\n  }\r\n\r\n  /**\r\n   * Appends a dummy input row.\r\n   *\r\n   * @param name Optional language-neutral identifier which may used to find\r\n   *     this input again.  Should be unique to this block.\r\n   * @returns The input object created.\r\n   */\r\n  appendDummyInput(name = ''): Input {\r\n    return this.appendInput(new DummyInput(name, this));\r\n  }\r\n\r\n  /**\r\n   * Appends an input that ends the row.\r\n   *\r\n   * @param name Optional language-neutral identifier which may used to find\r\n   *     this input again.  Should be unique to this block.\r\n   * @returns The input object created.\r\n   */\r\n  appendEndRowInput(name = ''): Input {\r\n    return this.appendInput(new EndRowInput(name, this));\r\n  }\r\n\r\n  /**\r\n   * Appends the given input row.\r\n   *\r\n   * Allows for custom inputs to be appended to the block.\r\n   */\r\n  appendInput(input: Input): Input {\r\n    this.inputList.push(input);\r\n    return input;\r\n  }\r\n\r\n  /**\r\n   * Appends an input with the given input type and name to the block after\r\n   * constructing it from the registry.\r\n   *\r\n   * @param type The name the input is registered under in the registry.\r\n   * @param name The name the input will have within the block.\r\n   * @returns The constucted input, or null if there was no constructor\r\n   *     associated with the type.\r\n   */\r\n  private appendInputFromRegistry(type: string, name: string): Input | null {\r\n    const inputConstructor = registry.getClass(\r\n      registry.Type.INPUT,\r\n      type,\r\n      false,\r\n    );\r\n    if (!inputConstructor) return null;\r\n    return this.appendInput(new inputConstructor(name, this));\r\n  }\r\n\r\n  /**\r\n   * Initialize this block using a cross-platform, internationalization-friendly\r\n   * JSON description.\r\n   *\r\n   * @param json Structured data describing the block.\r\n   */\r\n  jsonInit(json: AnyDuringMigration) {\r\n    const warningPrefix = json['type'] ? 'Block \"' + json['type'] + '\": ' : '';\r\n\r\n    // Validate inputs.\r\n    if (json['output'] && json['previousStatement']) {\r\n      throw Error(\r\n        warningPrefix + 'Must not have both an output and a previousStatement.',\r\n      );\r\n    }\r\n\r\n    // Validate that each arg has a corresponding message\r\n    let n = 0;\r\n    while (json['args' + n]) {\r\n      if (json['message' + n] === undefined) {\r\n        throw Error(\r\n          warningPrefix +\r\n            `args${n} must have a corresponding message (message${n}).`,\r\n        );\r\n      }\r\n      n++;\r\n    }\r\n\r\n    // Set basic properties of block.\r\n    // Makes styles backward compatible with old way of defining hat style.\r\n    if (json['style'] && json['style'].hat) {\r\n      this.hat = json['style'].hat;\r\n      // Must set to null so it doesn't error when checking for style and\r\n      // colour.\r\n      json['style'] = null;\r\n    }\r\n\r\n    if (json['style'] && json['colour']) {\r\n      throw Error(warningPrefix + 'Must not have both a colour and a style.');\r\n    } else if (json['style']) {\r\n      this.jsonInitStyle_(json, warningPrefix);\r\n    } else {\r\n      this.jsonInitColour_(json, warningPrefix);\r\n    }\r\n\r\n    // Interpolate the message blocks.\r\n    let i = 0;\r\n    while (json['message' + i] !== undefined) {\r\n      this.interpolate_(\r\n        json['message' + i],\r\n        json['args' + i] || [],\r\n        // Backwards compatibility: lastDummyAlign aliases implicitAlign.\r\n        json['implicitAlign' + i] || json['lastDummyAlign' + i],\r\n        warningPrefix,\r\n      );\r\n      i++;\r\n    }\r\n\r\n    if (json['inputsInline'] !== undefined) {\r\n      eventUtils.disable();\r\n      this.setInputsInline(json['inputsInline']);\r\n      eventUtils.enable();\r\n    }\r\n\r\n    // Set output and previous/next connections.\r\n    if (json['output'] !== undefined) {\r\n      this.setOutput(true, json['output']);\r\n    }\r\n    if (json['outputShape'] !== undefined) {\r\n      this.setOutputShape(json['outputShape']);\r\n    }\r\n    if (json['previousStatement'] !== undefined) {\r\n      this.setPreviousStatement(true, json['previousStatement']);\r\n    }\r\n    if (json['nextStatement'] !== undefined) {\r\n      this.setNextStatement(true, json['nextStatement']);\r\n    }\r\n    if (json['tooltip'] !== undefined) {\r\n      const rawValue = json['tooltip'];\r\n      const localizedText = parsing.replaceMessageReferences(rawValue);\r\n      this.setTooltip(localizedText);\r\n    }\r\n    if (json['enableContextMenu'] !== undefined) {\r\n      this.contextMenu = !!json['enableContextMenu'];\r\n    }\r\n    if (json['suppressPrefixSuffix'] !== undefined) {\r\n      this.suppressPrefixSuffix = !!json['suppressPrefixSuffix'];\r\n    }\r\n    if (json['helpUrl'] !== undefined) {\r\n      const rawValue = json['helpUrl'];\r\n      const localizedValue = parsing.replaceMessageReferences(rawValue);\r\n      this.setHelpUrl(localizedValue);\r\n    }\r\n    if (typeof json['extensions'] === 'string') {\r\n      console.warn(\r\n        warningPrefix +\r\n          \"JSON attribute 'extensions' should be an array of\" +\r\n          \" strings. Found raw string in JSON for '\" +\r\n          json['type'] +\r\n          \"' block.\",\r\n      );\r\n      json['extensions'] = [json['extensions']]; // Correct and continue.\r\n    }\r\n\r\n    // Add the mutator to the block.\r\n    if (json['mutator'] !== undefined) {\r\n      Extensions.apply(json['mutator'], this, true);\r\n    }\r\n\r\n    const extensionNames = json['extensions'];\r\n    if (Array.isArray(extensionNames)) {\r\n      for (let j = 0; j < extensionNames.length; j++) {\r\n        Extensions.apply(extensionNames[j], this, false);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize the colour of this block from the JSON description.\r\n   *\r\n   * @param json Structured data describing the block.\r\n   * @param warningPrefix Warning prefix string identifying block.\r\n   */\r\n  private jsonInitColour_(json: AnyDuringMigration, warningPrefix: string) {\r\n    if ('colour' in json) {\r\n      if (json['colour'] === undefined) {\r\n        console.warn(warningPrefix + 'Undefined colour value.');\r\n      } else {\r\n        const rawValue = json['colour'];\r\n        try {\r\n          this.setColour(rawValue);\r\n        } catch (e) {\r\n          console.warn(warningPrefix + 'Illegal colour value: ', rawValue);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize the style of this block from the JSON description.\r\n   *\r\n   * @param json Structured data describing the block.\r\n   * @param warningPrefix Warning prefix string identifying block.\r\n   */\r\n  private jsonInitStyle_(json: AnyDuringMigration, warningPrefix: string) {\r\n    const blockStyleName = json['style'];\r\n    try {\r\n      this.setStyle(blockStyleName);\r\n    } catch (styleError) {\r\n      console.warn(warningPrefix + 'Style does not exist: ', blockStyleName);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add key/values from mixinObj to this block object. By default, this method\r\n   * will check that the keys in mixinObj will not overwrite existing values in\r\n   * the block, including prototype values. This provides some insurance against\r\n   * mixin / extension incompatibilities with future block features. This check\r\n   * can be disabled by passing true as the second argument.\r\n   *\r\n   * @param mixinObj The key/values pairs to add to this block object.\r\n   * @param opt_disableCheck Option flag to disable overwrite checks.\r\n   */\r\n  mixin(mixinObj: AnyDuringMigration, opt_disableCheck?: boolean) {\r\n    if (\r\n      opt_disableCheck !== undefined &&\r\n      typeof opt_disableCheck !== 'boolean'\r\n    ) {\r\n      throw Error('opt_disableCheck must be a boolean if provided');\r\n    }\r\n    if (!opt_disableCheck) {\r\n      const overwrites = [];\r\n      for (const key in mixinObj) {\r\n        if ((this as AnyDuringMigration)[key] !== undefined) {\r\n          overwrites.push(key);\r\n        }\r\n      }\r\n      if (overwrites.length) {\r\n        throw Error(\r\n          'Mixin will overwrite block members: ' + JSON.stringify(overwrites),\r\n        );\r\n      }\r\n    }\r\n    Object.assign(this, mixinObj);\r\n  }\r\n\r\n  /**\r\n   * Interpolate a message description onto the block.\r\n   *\r\n   * @param message Text contains interpolation tokens (%1, %2, ...) that match\r\n   *     with fields or inputs defined in the args array.\r\n   * @param args Array of arguments to be interpolated.\r\n   * @param implicitAlign If an implicit input is added at the end or in place\r\n   *     of newline tokens, how should it be aligned?\r\n   * @param warningPrefix Warning prefix string identifying block.\r\n   */\r\n  private interpolate_(\r\n    message: string,\r\n    args: AnyDuringMigration[],\r\n    implicitAlign: string | undefined,\r\n    warningPrefix: string,\r\n  ) {\r\n    const tokens = parsing.tokenizeInterpolation(message);\r\n    this.validateTokens_(tokens, args.length);\r\n    const elements = this.interpolateArguments_(tokens, args, implicitAlign);\r\n\r\n    // An array of [field, fieldName] tuples.\r\n    const fieldStack = [];\r\n    for (let i = 0, element; (element = elements[i]); i++) {\r\n      if (this.isInputKeyword_(element['type'])) {\r\n        const input = this.inputFromJson_(element, warningPrefix);\r\n        // Should never be null, but just in case.\r\n        if (input) {\r\n          for (let j = 0, tuple; (tuple = fieldStack[j]); j++) {\r\n            input.appendField(tuple[0], tuple[1]);\r\n          }\r\n          fieldStack.length = 0;\r\n        }\r\n      } else {\r\n        // All other types, including ones starting with 'input_' get routed\r\n        // here.\r\n        const field = this.fieldFromJson_(element);\r\n        if (field) {\r\n          fieldStack.push([field, element['name']]);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Validates that the tokens are within the correct bounds, with no\r\n   * duplicates, and that all of the arguments are referred to. Throws errors if\r\n   * any of these things are not true.\r\n   *\r\n   * @param tokens An array of tokens to validate\r\n   * @param argsCount The number of args that need to be referred to.\r\n   */\r\n  private validateTokens_(tokens: Array<string | number>, argsCount: number) {\r\n    const visitedArgsHash = [];\r\n    let visitedArgsCount = 0;\r\n    for (let i = 0; i < tokens.length; i++) {\r\n      const token = tokens[i];\r\n      if (typeof token !== 'number') {\r\n        continue;\r\n      }\r\n      if (token < 1 || token > argsCount) {\r\n        throw Error(\r\n          'Block \"' +\r\n            this.type +\r\n            '\": ' +\r\n            'Message index %' +\r\n            token +\r\n            ' out of range.',\r\n        );\r\n      }\r\n      if (visitedArgsHash[token]) {\r\n        throw Error(\r\n          'Block \"' +\r\n            this.type +\r\n            '\": ' +\r\n            'Message index %' +\r\n            token +\r\n            ' duplicated.',\r\n        );\r\n      }\r\n      visitedArgsHash[token] = true;\r\n      visitedArgsCount++;\r\n    }\r\n    if (visitedArgsCount !== argsCount) {\r\n      throw Error(\r\n        'Block \"' +\r\n          this.type +\r\n          '\": ' +\r\n          'Message does not reference all ' +\r\n          argsCount +\r\n          ' arg(s).',\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Inserts args in place of numerical tokens. String args are converted to\r\n   * JSON that defines a label field. Newline characters are converted to\r\n   * end-row inputs, and if necessary an extra dummy input is added to the end\r\n   * of the elements.\r\n   *\r\n   * @param tokens The tokens to interpolate\r\n   * @param args The arguments to insert.\r\n   * @param implicitAlign The alignment to use for any implicitly added end-row\r\n   *     or dummy inputs, if necessary.\r\n   * @returns The JSON definitions of field and inputs to add to the block.\r\n   */\r\n  private interpolateArguments_(\r\n    tokens: Array<string | number>,\r\n    args: Array<AnyDuringMigration | string>,\r\n    implicitAlign: string | undefined,\r\n  ): AnyDuringMigration[] {\r\n    const elements = [];\r\n    for (let i = 0; i < tokens.length; i++) {\r\n      let element = tokens[i];\r\n      if (typeof element === 'number') {\r\n        element = args[element - 1];\r\n      }\r\n      // Args can be strings, which is why this isn't elseif.\r\n      if (typeof element === 'string') {\r\n        if (element === '\\n') {\r\n          // Convert newline tokens to end-row inputs.\r\n          const newlineInput = {'type': 'input_end_row'};\r\n          if (implicitAlign) {\r\n            (newlineInput as AnyDuringMigration)['align'] = implicitAlign;\r\n          }\r\n          element = newlineInput as AnyDuringMigration;\r\n        } else {\r\n          // AnyDuringMigration because:  Type '{ text: string; type: string; }\r\n          // | null' is not assignable to type 'string | number'.\r\n          element = this.stringToFieldJson_(element) as AnyDuringMigration;\r\n          if (!element) {\r\n            continue;\r\n          }\r\n        }\r\n      }\r\n      elements.push(element);\r\n    }\r\n\r\n    const length = elements.length;\r\n    if (\r\n      length &&\r\n      !this.isInputKeyword_(\r\n        (elements as AnyDuringMigration)[length - 1]['type'],\r\n      )\r\n    ) {\r\n      const dummyInput = {'type': 'input_dummy'};\r\n      if (implicitAlign) {\r\n        (dummyInput as AnyDuringMigration)['align'] = implicitAlign;\r\n      }\r\n      elements.push(dummyInput);\r\n    }\r\n\r\n    return elements;\r\n  }\r\n\r\n  /**\r\n   * Creates a field from the JSON definition of a field. If a field with the\r\n   * given type cannot be found, this attempts to create a different field using\r\n   * the 'alt' property of the JSON definition (if it exists).\r\n   *\r\n   * @param element The element to try to turn into a field.\r\n   * @returns The field defined by the JSON, or null if one couldn't be created.\r\n   */\r\n  private fieldFromJson_(element: {\r\n    alt?: string;\r\n    type: string;\r\n    text?: string;\r\n  }): Field | null {\r\n    const field = fieldRegistry.fromJson(element);\r\n    if (!field && element['alt']) {\r\n      if (typeof element['alt'] === 'string') {\r\n        const json = this.stringToFieldJson_(element['alt']);\r\n        return json ? this.fieldFromJson_(json) : null;\r\n      }\r\n      return this.fieldFromJson_(element['alt']);\r\n    }\r\n    return field;\r\n  }\r\n\r\n  /**\r\n   * Creates an input from the JSON definition of an input. Sets the input's\r\n   * check and alignment if they are provided.\r\n   *\r\n   * @param element The JSON to turn into an input.\r\n   * @param warningPrefix The prefix to add to warnings to help the developer\r\n   *     debug.\r\n   * @returns The input that has been created, or null if one could not be\r\n   *     created for some reason (should never happen).\r\n   */\r\n  private inputFromJson_(\r\n    element: AnyDuringMigration,\r\n    warningPrefix: string,\r\n  ): Input | null {\r\n    const alignmentLookup = {\r\n      'LEFT': Align.LEFT,\r\n      'RIGHT': Align.RIGHT,\r\n      'CENTRE': Align.CENTRE,\r\n      'CENTER': Align.CENTRE,\r\n    };\r\n\r\n    let input = null;\r\n    switch (element['type']) {\r\n      case 'input_value':\r\n        input = this.appendValueInput(element['name']);\r\n        break;\r\n      case 'input_statement':\r\n        input = this.appendStatementInput(element['name']);\r\n        break;\r\n      case 'input_dummy':\r\n        input = this.appendDummyInput(element['name']);\r\n        break;\r\n      case 'input_end_row':\r\n        input = this.appendEndRowInput(element['name']);\r\n        break;\r\n      default: {\r\n        input = this.appendInputFromRegistry(element['type'], element['name']);\r\n        break;\r\n      }\r\n    }\r\n    // Should never be hit because of interpolate_'s checks, but just in case.\r\n    if (!input) {\r\n      return null;\r\n    }\r\n\r\n    if (element['check']) {\r\n      input.setCheck(element['check']);\r\n    }\r\n    if (element['align']) {\r\n      const alignment = (alignmentLookup as AnyDuringMigration)[\r\n        element['align'].toUpperCase()\r\n      ];\r\n      if (alignment === undefined) {\r\n        console.warn(warningPrefix + 'Illegal align value: ', element['align']);\r\n      } else {\r\n        input.setAlign(alignment);\r\n      }\r\n    }\r\n    return input;\r\n  }\r\n\r\n  /**\r\n   * Returns true if the given string matches one of the input keywords.\r\n   *\r\n   * @param str The string to check.\r\n   * @returns True if the given string matches one of the input keywords, false\r\n   *     otherwise.\r\n   */\r\n  private isInputKeyword_(str: string): boolean {\r\n    return (\r\n      str === 'input_value' ||\r\n      str === 'input_statement' ||\r\n      str === 'input_dummy' ||\r\n      str === 'input_end_row' ||\r\n      registry.hasItem(registry.Type.INPUT, str)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Turns a string into the JSON definition of a label field. If the string\r\n   * becomes an empty string when trimmed, this returns null.\r\n   *\r\n   * @param str String to turn into the JSON definition of a label field.\r\n   * @returns The JSON definition or null.\r\n   */\r\n  private stringToFieldJson_(str: string): {text: string; type: string} | null {\r\n    str = str.trim();\r\n    if (str) {\r\n      return {\r\n        'type': 'field_label',\r\n        'text': str,\r\n      };\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Move a named input to a different location on this block.\r\n   *\r\n   * @param name The name of the input to move.\r\n   * @param refName Name of input that should be after the moved input, or null\r\n   *     to be the input at the end.\r\n   */\r\n  moveInputBefore(name: string, refName: string | null) {\r\n    if (name === refName) {\r\n      return;\r\n    }\r\n    // Find both inputs.\r\n    let inputIndex = -1;\r\n    let refIndex = refName ? -1 : this.inputList.length;\r\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\r\n      if (input.name === name) {\r\n        inputIndex = i;\r\n        if (refIndex !== -1) {\r\n          break;\r\n        }\r\n      } else if (refName && input.name === refName) {\r\n        refIndex = i;\r\n        if (inputIndex !== -1) {\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    if (inputIndex === -1) {\r\n      throw Error('Named input \"' + name + '\" not found.');\r\n    }\r\n    if (refIndex === -1) {\r\n      throw Error('Reference input \"' + refName + '\" not found.');\r\n    }\r\n    this.moveNumberedInputBefore(inputIndex, refIndex);\r\n  }\r\n\r\n  /**\r\n   * Move a numbered input to a different location on this block.\r\n   *\r\n   * @param inputIndex Index of the input to move.\r\n   * @param refIndex Index of input that should be after the moved input.\r\n   */\r\n  moveNumberedInputBefore(inputIndex: number, refIndex: number) {\r\n    // Validate arguments.\r\n    if (inputIndex === refIndex) {\r\n      throw Error(\"Can't move input to itself.\");\r\n    }\r\n    if (inputIndex >= this.inputList.length) {\r\n      throw RangeError('Input index ' + inputIndex + ' out of bounds.');\r\n    }\r\n    if (refIndex > this.inputList.length) {\r\n      throw RangeError('Reference input ' + refIndex + ' out of bounds.');\r\n    }\r\n    // Remove input.\r\n    const input = this.inputList[inputIndex];\r\n    this.inputList.splice(inputIndex, 1);\r\n    if (inputIndex < refIndex) {\r\n      refIndex--;\r\n    }\r\n    // Reinsert input.\r\n    this.inputList.splice(refIndex, 0, input);\r\n  }\r\n\r\n  /**\r\n   * Remove an input from this block.\r\n   *\r\n   * @param name The name of the input.\r\n   * @param opt_quiet True to prevent an error if input is not present.\r\n   * @returns True if operation succeeds, false if input is not present and\r\n   *     opt_quiet is true.\r\n   * @throws {Error} if the input is not present and opt_quiet is not true.\r\n   */\r\n  removeInput(name: string, opt_quiet?: boolean): boolean {\r\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\r\n      if (input.name === name) {\r\n        if (input instanceof StatementInput) this.statementInputCount--;\r\n        input.dispose();\r\n        this.inputList.splice(i, 1);\r\n        return true;\r\n      }\r\n    }\r\n    if (opt_quiet) {\r\n      return false;\r\n    }\r\n    throw Error('Input not found: ' + name);\r\n  }\r\n\r\n  /**\r\n   * Fetches the named input object.\r\n   *\r\n   * @param name The name of the input.\r\n   * @returns The input object, or null if input does not exist.\r\n   */\r\n  getInput(name: string): Input | null {\r\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\r\n      if (input.name === name) {\r\n        return input;\r\n      }\r\n    }\r\n    // This input does not exist.\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Fetches the block attached to the named input.\r\n   *\r\n   * @param name The name of the input.\r\n   * @returns The attached value block, or null if the input is either\r\n   *     disconnected or if the input does not exist.\r\n   */\r\n  getInputTargetBlock(name: string): Block | null {\r\n    const input = this.getInput(name);\r\n    return input && input.connection && input.connection.targetBlock();\r\n  }\r\n\r\n  /**\r\n   * Returns the comment on this block (or null if there is no comment).\r\n   *\r\n   * @returns Block's comment.\r\n   */\r\n  getCommentText(): string | null {\r\n    const comment = this.getIcon(CommentIcon.TYPE) as CommentIcon | null;\r\n    return comment?.getText() ?? null;\r\n  }\r\n\r\n  /**\r\n   * Set this block's comment text.\r\n   *\r\n   * @param text The text, or null to delete.\r\n   */\r\n  setCommentText(text: string | null) {\r\n    const comment = this.getIcon(CommentIcon.TYPE) as CommentIcon | null;\r\n    const oldText = comment?.getText() ?? null;\r\n    if (oldText === text) return;\r\n    if (text !== null) {\r\n      let comment = this.getIcon(CommentIcon.TYPE) as CommentIcon | undefined;\r\n      if (!comment) {\r\n        comment = this.addIcon(new CommentIcon(this));\r\n      }\r\n      eventUtils.disable();\r\n      comment.setText(text);\r\n      eventUtils.enable();\r\n    } else {\r\n      this.removeIcon(CommentIcon.TYPE);\r\n    }\r\n\r\n    eventUtils.fire(\r\n      new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\r\n        this,\r\n        'comment',\r\n        null,\r\n        oldText,\r\n        text,\r\n      ),\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Set this block's warning text.\r\n   *\r\n   * @param _text The text, or null to delete.\r\n   * @param _opt_id An optional ID for the warning text to be able to maintain\r\n   *     multiple warnings.\r\n   */\r\n  setWarningText(_text: string | null, _opt_id?: string) {\r\n    // NOOP.\r\n  }\r\n\r\n  /**\r\n   * Give this block a mutator dialog.\r\n   *\r\n   * @param _mutator A mutator dialog instance or null to remove.\r\n   */\r\n  setMutator(_mutator: MutatorIcon) {\r\n    // NOOP.\r\n  }\r\n\r\n  /** Adds the given icon to the block. */\r\n  addIcon<T extends IIcon>(icon: T): T {\r\n    if (this.hasIcon(icon.getType())) throw new DuplicateIconType(icon);\r\n    this.icons.push(icon);\r\n    this.icons.sort((a, b) => a.getWeight() - b.getWeight());\r\n    return icon;\r\n  }\r\n\r\n  /**\r\n   * Removes the icon whose getType matches the given type iconType from the\r\n   * block.\r\n   *\r\n   * @param type The type of the icon to remove from the block.\r\n   * @returns True if an icon with the given type was found, false otherwise.\r\n   */\r\n  removeIcon(type: IconType<IIcon>): boolean {\r\n    if (!this.hasIcon(type)) return false;\r\n    this.getIcon(type)?.dispose();\r\n    this.icons = this.icons.filter((icon) => !icon.getType().equals(type));\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * @returns True if an icon with the given type exists on the block,\r\n   *     false otherwise.\r\n   */\r\n  hasIcon(type: IconType<IIcon>): boolean {\r\n    return this.icons.some((icon) => icon.getType().equals(type));\r\n  }\r\n\r\n  /**\r\n   * @param type The type of the icon to retrieve. Prefer passing an `IconType`\r\n   *     for proper type checking when using typescript.\r\n   * @returns The icon with the given type if it exists on the block, undefined\r\n   *     otherwise.\r\n   */\r\n  getIcon<T extends IIcon>(type: IconType<T> | string): T | undefined {\r\n    if (type instanceof IconType) {\r\n      return this.icons.find((icon) => icon.getType().equals(type)) as T;\r\n    } else {\r\n      return this.icons.find((icon) => icon.getType().toString() === type) as T;\r\n    }\r\n  }\r\n\r\n  /** @returns An array of the icons attached to this block. */\r\n  getIcons(): IIcon[] {\r\n    return [...this.icons];\r\n  }\r\n\r\n  /**\r\n   * Return the coordinates of the top-left corner of this block relative to the\r\n   * drawing surface's origin (0,0), in workspace units.\r\n   *\r\n   * @returns Object with .x and .y properties.\r\n   */\r\n  getRelativeToSurfaceXY(): Coordinate {\r\n    return this.xy_;\r\n  }\r\n\r\n  /**\r\n   * Move a block by a relative offset.\r\n   *\r\n   * @param dx Horizontal offset, in workspace units.\r\n   * @param dy Vertical offset, in workspace units.\r\n   * @param reason Why is this move happening?  'drag', 'bump', 'snap', ...\r\n   */\r\n  moveBy(dx: number, dy: number, reason?: string[]) {\r\n    if (this.parentBlock_) {\r\n      throw Error('Block has parent');\r\n    }\r\n    const event = new (eventUtils.get(eventUtils.BLOCK_MOVE))(\r\n      this,\r\n    ) as BlockMove;\r\n    reason && event.setReason(reason);\r\n    this.xy_.translate(dx, dy);\r\n    event.recordNew();\r\n    eventUtils.fire(event);\r\n  }\r\n\r\n  /**\r\n   * Create a connection of the specified type.\r\n   *\r\n   * @param type The type of the connection to create.\r\n   * @returns A new connection of the specified type.\r\n   * @internal\r\n   */\r\n  makeConnection_(type: ConnectionType): Connection {\r\n    return new Connection(this, type);\r\n  }\r\n\r\n  /**\r\n   * Recursively checks whether all statement and value inputs are filled with\r\n   * blocks. Also checks all following statement blocks in this stack.\r\n   *\r\n   * @param opt_shadowBlocksAreFilled An optional argument controlling whether\r\n   *     shadow blocks are counted as filled. Defaults to true.\r\n   * @returns True if all inputs are filled, false otherwise.\r\n   */\r\n  allInputsFilled(opt_shadowBlocksAreFilled?: boolean): boolean {\r\n    // Account for the shadow block filledness toggle.\r\n    if (opt_shadowBlocksAreFilled === undefined) {\r\n      opt_shadowBlocksAreFilled = true;\r\n    }\r\n    if (!opt_shadowBlocksAreFilled && this.isShadow()) {\r\n      return false;\r\n    }\r\n\r\n    // Recursively check each input block of the current block.\r\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\r\n      if (!input.connection) {\r\n        continue;\r\n      }\r\n      const target = input.connection.targetBlock();\r\n      if (!target || !target.allInputsFilled(opt_shadowBlocksAreFilled)) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    // Recursively check the next block after the current block.\r\n    const next = this.getNextBlock();\r\n    if (next) {\r\n      return next.allInputsFilled(opt_shadowBlocksAreFilled);\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * This method returns a string describing this Block in developer terms (type\r\n   * name and ID; English only).\r\n   *\r\n   * Intended to on be used in console logs and errors. If you need a string\r\n   * that uses the user's native language (including block text, field values,\r\n   * and child blocks), use [toString()]{@link Block#toString}.\r\n   *\r\n   * @returns The description.\r\n   */\r\n  toDevString(): string {\r\n    let msg = this.type ? '\"' + this.type + '\" block' : 'Block';\r\n    if (this.id) {\r\n      msg += ' (id=\"' + this.id + '\")';\r\n    }\r\n    return msg;\r\n  }\r\n}\r\n\r\nexport namespace Block {\r\n  export interface CommentModel {\r\n    text: string | null;\r\n    pinned: boolean;\r\n    size: Size;\r\n  }\r\n}\r\n\r\nexport type CommentModel = Block.CommentModel;\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * The class representing a marker.\r\n * Used primarily for keyboard navigation to show a marked location.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.Marker\r\n\r\n/* eslint-disable-next-line no-unused-vars */\r\nimport type {MarkerSvg} from '../renderers/common/marker_svg.js';\r\n\r\nimport type {ASTNode} from './ast_node.js';\r\n\r\n/**\r\n * Class for a marker.\r\n * This is used in keyboard navigation to save a location in the Blockly AST.\r\n */\r\nexport class Marker {\r\n  /** The colour of the marker. */\r\n  colour: string | null = null;\r\n\r\n  /** The current location of the marker. */\r\n  // AnyDuringMigration because:  Type 'null' is not assignable to type\r\n  // 'ASTNode'.\r\n  private curNode: ASTNode = null as AnyDuringMigration;\r\n\r\n  /**\r\n   * The object in charge of drawing the visual representation of the current\r\n   * node.\r\n   */\r\n  // AnyDuringMigration because:  Type 'null' is not assignable to type\r\n  // 'MarkerSvg'.\r\n  private drawer: MarkerSvg = null as AnyDuringMigration;\r\n\r\n  /** The type of the marker. */\r\n  type = 'marker';\r\n\r\n  /** Constructs a new Marker instance. */\r\n  constructor() {}\r\n\r\n  /**\r\n   * Sets the object in charge of drawing the marker.\r\n   *\r\n   * @param drawer The object in charge of drawing the marker.\r\n   */\r\n  setDrawer(drawer: MarkerSvg) {\r\n    this.drawer = drawer;\r\n  }\r\n\r\n  /**\r\n   * Get the current drawer for the marker.\r\n   *\r\n   * @returns The object in charge of drawing the marker.\r\n   */\r\n  getDrawer(): MarkerSvg {\r\n    return this.drawer;\r\n  }\r\n\r\n  /**\r\n   * Gets the current location of the marker.\r\n   *\r\n   * @returns The current field, connection, or block the marker is on.\r\n   */\r\n  getCurNode(): ASTNode {\r\n    return this.curNode;\r\n  }\r\n\r\n  /**\r\n   * Set the location of the marker and call the update method.\r\n   * Setting isStack to true will only work if the newLocation is the top most\r\n   * output or previous connection on a stack.\r\n   *\r\n   * @param newNode The new location of the marker.\r\n   */\r\n  setCurNode(newNode: ASTNode) {\r\n    const oldNode = this.curNode;\r\n    this.curNode = newNode;\r\n    if (this.drawer) {\r\n      this.drawer.draw(oldNode, this.curNode);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Redraw the current marker.\r\n   *\r\n   * @internal\r\n   */\r\n  draw() {\r\n    if (this.drawer) {\r\n      this.drawer.draw(this.curNode, this.curNode);\r\n    }\r\n  }\r\n\r\n  /** Hide the marker SVG. */\r\n  hide() {\r\n    if (this.drawer) {\r\n      this.drawer.hide();\r\n    }\r\n  }\r\n\r\n  /** Dispose of this marker. */\r\n  dispose() {\r\n    if (this.getDrawer()) {\r\n      this.getDrawer().dispose();\r\n    }\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * The class representing a cursor.\r\n * Used primarily for keyboard navigation.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.Cursor\r\n\r\nimport * as registry from '../registry.js';\r\n\r\nimport {ASTNode} from './ast_node.js';\r\nimport {Marker} from './marker.js';\r\n\r\n/**\r\n * Class for a cursor.\r\n * A cursor controls how a user navigates the Blockly AST.\r\n */\r\nexport class Cursor extends Marker {\r\n  override type = 'cursor';\r\n\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  /**\r\n   * Find the next connection, field, or block.\r\n   *\r\n   * @returns The next element, or null if the current node is not set or there\r\n   *     is no next value.\r\n   */\r\n  next(): ASTNode | null {\r\n    const curNode = this.getCurNode();\r\n    if (!curNode) {\r\n      return null;\r\n    }\r\n\r\n    let newNode = curNode.next();\r\n    while (\r\n      newNode &&\r\n      newNode.next() &&\r\n      (newNode.getType() === ASTNode.types.NEXT ||\r\n        newNode.getType() === ASTNode.types.BLOCK)\r\n    ) {\r\n      newNode = newNode.next();\r\n    }\r\n\r\n    if (newNode) {\r\n      this.setCurNode(newNode);\r\n    }\r\n    return newNode;\r\n  }\r\n\r\n  /**\r\n   * Find the in connection or field.\r\n   *\r\n   * @returns The in element, or null if the current node is not set or there is\r\n   *     no in value.\r\n   */\r\n  in(): ASTNode | null {\r\n    let curNode: ASTNode | null = this.getCurNode();\r\n    if (!curNode) {\r\n      return null;\r\n    }\r\n    // If we are on a previous or output connection, go to the block level\r\n    // before performing next operation.\r\n    if (\r\n      curNode.getType() === ASTNode.types.PREVIOUS ||\r\n      curNode.getType() === ASTNode.types.OUTPUT\r\n    ) {\r\n      curNode = curNode.next();\r\n    }\r\n    const newNode = curNode?.in() ?? null;\r\n\r\n    if (newNode) {\r\n      this.setCurNode(newNode);\r\n    }\r\n    return newNode;\r\n  }\r\n\r\n  /**\r\n   * Find the previous connection, field, or block.\r\n   *\r\n   * @returns The previous element, or null if the current node is not set or\r\n   *     there is no previous value.\r\n   */\r\n  prev(): ASTNode | null {\r\n    const curNode = this.getCurNode();\r\n    if (!curNode) {\r\n      return null;\r\n    }\r\n    let newNode = curNode.prev();\r\n\r\n    while (\r\n      newNode &&\r\n      newNode.prev() &&\r\n      (newNode.getType() === ASTNode.types.NEXT ||\r\n        newNode.getType() === ASTNode.types.BLOCK)\r\n    ) {\r\n      newNode = newNode.prev();\r\n    }\r\n\r\n    if (newNode) {\r\n      this.setCurNode(newNode);\r\n    }\r\n    return newNode;\r\n  }\r\n\r\n  /**\r\n   * Find the out connection, field, or block.\r\n   *\r\n   * @returns The out element, or null if the current node is not set or there\r\n   *     is no out value.\r\n   */\r\n  out(): ASTNode | null {\r\n    const curNode = this.getCurNode();\r\n    if (!curNode) {\r\n      return null;\r\n    }\r\n    let newNode = curNode.out();\r\n\r\n    if (newNode && newNode.getType() === ASTNode.types.BLOCK) {\r\n      newNode = newNode.prev() || newNode;\r\n    }\r\n\r\n    if (newNode) {\r\n      this.setCurNode(newNode);\r\n    }\r\n    return newNode;\r\n  }\r\n}\r\n\r\nregistry.register(registry.Type.CURSOR, registry.DEFAULT, Cursor);\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * The class representing a basic cursor.\r\n * Used to demo switching between different cursors.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.BasicCursor\r\n\r\nimport * as registry from '../registry.js';\r\n\r\nimport {ASTNode} from './ast_node.js';\r\nimport {Cursor} from './cursor.js';\r\n\r\n/**\r\n * Class for a basic cursor.\r\n * This will allow the user to get to all nodes in the AST by hitting next or\r\n * previous.\r\n */\r\nexport class BasicCursor extends Cursor {\r\n  /** Name used for registering a basic cursor. */\r\n  static readonly registrationName = 'basicCursor';\r\n\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  /**\r\n   * Find the next node in the pre order traversal.\r\n   *\r\n   * @returns The next node, or null if the current node is not set or there is\r\n   *     no next value.\r\n   */\r\n  override next(): ASTNode | null {\r\n    const curNode = this.getCurNode();\r\n    if (!curNode) {\r\n      return null;\r\n    }\r\n    const newNode = this.getNextNode_(curNode, this.validNode_);\r\n\r\n    if (newNode) {\r\n      this.setCurNode(newNode);\r\n    }\r\n    return newNode;\r\n  }\r\n\r\n  /**\r\n   * For a basic cursor we only have the ability to go next and previous, so\r\n   * in will also allow the user to get to the next node in the pre order\r\n   * traversal.\r\n   *\r\n   * @returns The next node, or null if the current node is not set or there is\r\n   *     no next value.\r\n   */\r\n  override in(): ASTNode | null {\r\n    return this.next();\r\n  }\r\n\r\n  /**\r\n   * Find the previous node in the pre order traversal.\r\n   *\r\n   * @returns The previous node, or null if the current node is not set or there\r\n   *     is no previous value.\r\n   */\r\n  override prev(): ASTNode | null {\r\n    const curNode = this.getCurNode();\r\n    if (!curNode) {\r\n      return null;\r\n    }\r\n    const newNode = this.getPreviousNode_(curNode, this.validNode_);\r\n\r\n    if (newNode) {\r\n      this.setCurNode(newNode);\r\n    }\r\n    return newNode;\r\n  }\r\n\r\n  /**\r\n   * For a basic cursor we only have the ability to go next and previous, so\r\n   * out will allow the user to get to the previous node in the pre order\r\n   * traversal.\r\n   *\r\n   * @returns The previous node, or null if the current node is not set or there\r\n   *     is no previous value.\r\n   */\r\n  override out(): ASTNode | null {\r\n    return this.prev();\r\n  }\r\n\r\n  /**\r\n   * Uses pre order traversal to navigate the Blockly AST. This will allow\r\n   * a user to easily navigate the entire Blockly AST without having to go in\r\n   * and out levels on the tree.\r\n   *\r\n   * @param node The current position in the AST.\r\n   * @param isValid A function true/false depending on whether the given node\r\n   *     should be traversed.\r\n   * @returns The next node in the traversal.\r\n   */\r\n  protected getNextNode_(\r\n    node: ASTNode | null,\r\n    isValid: (p1: ASTNode | null) => boolean,\r\n  ): ASTNode | null {\r\n    if (!node) {\r\n      return null;\r\n    }\r\n    const newNode = node.in() || node.next();\r\n    if (isValid(newNode)) {\r\n      return newNode;\r\n    } else if (newNode) {\r\n      return this.getNextNode_(newNode, isValid);\r\n    }\r\n    const siblingOrParent = this.findSiblingOrParent(node.out());\r\n    if (isValid(siblingOrParent)) {\r\n      return siblingOrParent;\r\n    } else if (siblingOrParent) {\r\n      return this.getNextNode_(siblingOrParent, isValid);\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Reverses the pre order traversal in order to find the previous node. This\r\n   * will allow a user to easily navigate the entire Blockly AST without having\r\n   * to go in and out levels on the tree.\r\n   *\r\n   * @param node The current position in the AST.\r\n   * @param isValid A function true/false depending on whether the given node\r\n   *     should be traversed.\r\n   * @returns The previous node in the traversal or null if no previous node\r\n   *     exists.\r\n   */\r\n  protected getPreviousNode_(\r\n    node: ASTNode | null,\r\n    isValid: (p1: ASTNode | null) => boolean,\r\n  ): ASTNode | null {\r\n    if (!node) {\r\n      return null;\r\n    }\r\n    let newNode: ASTNode | null = node.prev();\r\n\r\n    if (newNode) {\r\n      newNode = this.getRightMostChild(newNode);\r\n    } else {\r\n      newNode = node.out();\r\n    }\r\n    if (isValid(newNode)) {\r\n      return newNode;\r\n    } else if (newNode) {\r\n      return this.getPreviousNode_(newNode, isValid);\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Decides what nodes to traverse and which ones to skip. Currently, it\r\n   * skips output, stack and workspace nodes.\r\n   *\r\n   * @param node The AST node to check whether it is valid.\r\n   * @returns True if the node should be visited, false otherwise.\r\n   */\r\n  protected validNode_(node: ASTNode | null): boolean {\r\n    let isValid = false;\r\n    const type = node && node.getType();\r\n    if (\r\n      type === ASTNode.types.OUTPUT ||\r\n      type === ASTNode.types.INPUT ||\r\n      type === ASTNode.types.FIELD ||\r\n      type === ASTNode.types.NEXT ||\r\n      type === ASTNode.types.PREVIOUS ||\r\n      type === ASTNode.types.WORKSPACE\r\n    ) {\r\n      isValid = true;\r\n    }\r\n    return isValid;\r\n  }\r\n\r\n  /**\r\n   * From the given node find either the next valid sibling or parent.\r\n   *\r\n   * @param node The current position in the AST.\r\n   * @returns The parent AST node or null if there are no valid parents.\r\n   */\r\n  private findSiblingOrParent(node: ASTNode | null): ASTNode | null {\r\n    if (!node) {\r\n      return null;\r\n    }\r\n    const nextNode = node.next();\r\n    if (nextNode) {\r\n      return nextNode;\r\n    }\r\n    return this.findSiblingOrParent(node.out());\r\n  }\r\n\r\n  /**\r\n   * Get the right most child of a node.\r\n   *\r\n   * @param node The node to find the right most child of.\r\n   * @returns The right most child of the given node, or the node if no child\r\n   *     exists.\r\n   */\r\n  private getRightMostChild(node: ASTNode | null): ASTNode | null {\r\n    if (!node!.in()) {\r\n      return node;\r\n    }\r\n    let newNode = node!.in();\r\n    while (newNode && newNode.next()) {\r\n      newNode = newNode.next();\r\n    }\r\n    return this.getRightMostChild(newNode);\r\n  }\r\n}\r\n\r\nregistry.register(\r\n  registry.Type.CURSOR,\r\n  BasicCursor.registrationName,\r\n  BasicCursor,\r\n);\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * The class representing a cursor that is used to navigate\r\n * between tab navigable fields.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.TabNavigateCursor\r\n\r\nimport type {Field} from '../field.js';\r\n\r\nimport {ASTNode} from './ast_node.js';\r\nimport {BasicCursor} from './basic_cursor.js';\r\n\r\n/**\r\n * A cursor for navigating between tab navigable fields.\r\n */\r\nexport class TabNavigateCursor extends BasicCursor {\r\n  /**\r\n   * Skip all nodes except for tab navigable fields.\r\n   *\r\n   * @param node The AST node to check whether it is valid.\r\n   * @returns True if the node should be visited, false otherwise.\r\n   */\r\n  override validNode_(node: ASTNode | null): boolean {\r\n    let isValid = false;\r\n    const type = node && node.getType();\r\n    if (node) {\r\n      const location = node.getLocation() as Field;\r\n      if (\r\n        type === ASTNode.types.FIELD &&\r\n        location &&\r\n        location.isTabNavigable() &&\r\n        location.isClickable()\r\n      ) {\r\n        isValid = true;\r\n      }\r\n    }\r\n    return isValid;\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2016 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Components for creating connections between blocks.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.RenderedConnection\r\n\r\nimport type {Block} from './block.js';\r\nimport type {BlockSvg} from './block_svg.js';\r\nimport * as common from './common.js';\r\nimport {config} from './config.js';\r\nimport {Connection} from './connection.js';\r\nimport type {ConnectionDB} from './connection_db.js';\r\nimport {ConnectionType} from './connection_type.js';\r\nimport * as eventUtils from './events/utils.js';\r\nimport {hasBubble} from './interfaces/i_has_bubble.js';\r\nimport * as internalConstants from './internal_constants.js';\r\nimport {Coordinate} from './utils/coordinate.js';\r\n\r\n/** Maximum randomness in workspace units for bumping a block. */\r\nconst BUMP_RANDOMNESS = 10;\r\n\r\n/**\r\n * Class for a connection between blocks that may be rendered on screen.\r\n */\r\nexport class RenderedConnection extends Connection {\r\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\r\n  sourceBlock_!: BlockSvg;\r\n  private readonly db: ConnectionDB;\r\n  private readonly dbOpposite: ConnectionDB;\r\n  private readonly offsetInBlock: Coordinate;\r\n  private trackedState: TrackedState;\r\n  private highlighted: boolean = false;\r\n\r\n  /** Connection this connection connects to.  Null if not connected. */\r\n  override targetConnection: RenderedConnection | null = null;\r\n\r\n  /**\r\n   * @param source The block establishing this connection.\r\n   * @param type The type of the connection.\r\n   */\r\n  constructor(source: BlockSvg, type: number) {\r\n    super(source, type);\r\n\r\n    /**\r\n     * Connection database for connections of this type on the current\r\n     * workspace.\r\n     */\r\n    this.db = source.workspace.connectionDBList[type];\r\n\r\n    /**\r\n     * Connection database for connections compatible with this type on the\r\n     * current workspace.\r\n     */\r\n    this.dbOpposite =\r\n      source.workspace.connectionDBList[internalConstants.OPPOSITE_TYPE[type]];\r\n\r\n    /** Workspace units, (0, 0) is top left of block. */\r\n    this.offsetInBlock = new Coordinate(0, 0);\r\n\r\n    /** Describes the state of this connection's tracked-ness. */\r\n    this.trackedState = RenderedConnection.TrackedState.WILL_TRACK;\r\n  }\r\n\r\n  /**\r\n   * Dispose of this connection. Remove it from the database (if it is\r\n   * tracked) and call the super-function to deal with connected blocks.\r\n   *\r\n   * @internal\r\n   */\r\n  override dispose() {\r\n    super.dispose();\r\n    if (this.trackedState === RenderedConnection.TrackedState.TRACKED) {\r\n      this.db.removeConnection(this, this.y);\r\n    }\r\n    this.sourceBlock_.pathObject.removeConnectionHighlight?.(this);\r\n  }\r\n\r\n  /**\r\n   * Get the source block for this connection.\r\n   *\r\n   * @returns The source block.\r\n   */\r\n  override getSourceBlock(): BlockSvg {\r\n    return super.getSourceBlock() as BlockSvg;\r\n  }\r\n\r\n  /**\r\n   * Returns the block that this connection connects to.\r\n   *\r\n   * @returns The connected block or null if none is connected.\r\n   */\r\n  override targetBlock(): BlockSvg | null {\r\n    return super.targetBlock() as BlockSvg;\r\n  }\r\n\r\n  /**\r\n   * Returns the distance between this connection and another connection in\r\n   * workspace units.\r\n   *\r\n   * @param otherConnection The other connection to measure the distance to.\r\n   * @returns The distance between connections, in workspace units.\r\n   */\r\n  distanceFrom(otherConnection: Connection): number {\r\n    const xDiff = this.x - otherConnection.x;\r\n    const yDiff = this.y - otherConnection.y;\r\n    return Math.sqrt(xDiff * xDiff + yDiff * yDiff);\r\n  }\r\n\r\n  /**\r\n   * Move the block(s) belonging to the connection to a point where they don't\r\n   * visually interfere with the specified connection.\r\n   *\r\n   * @param staticConnection The connection to move away from.\r\n   * @internal\r\n   */\r\n  bumpAwayFrom(staticConnection: RenderedConnection) {\r\n    if (this.sourceBlock_.workspace.isDragging()) {\r\n      // Don't move blocks around while the user is doing the same.\r\n      return;\r\n    }\r\n    // Move the root block.\r\n    let rootBlock = this.sourceBlock_.getRootBlock();\r\n    if (rootBlock.isInFlyout) {\r\n      // Don't move blocks around in a flyout.\r\n      return;\r\n    }\r\n    let reverse = false;\r\n    if (!rootBlock.isMovable()) {\r\n      // Can't bump an uneditable block away.\r\n      // Check to see if the other block is movable.\r\n      rootBlock = staticConnection.getSourceBlock().getRootBlock();\r\n      if (!rootBlock.isMovable()) {\r\n        return;\r\n      }\r\n      // Swap the connections and move the 'static' connection instead.\r\n      /* eslint-disable-next-line @typescript-eslint/no-this-alias */\r\n      staticConnection = this;\r\n      reverse = true;\r\n    }\r\n    // Raise it to the top for extra visibility.\r\n    const selected = common.getSelected() == rootBlock;\r\n    selected || rootBlock.addSelect();\r\n    let dx =\r\n      staticConnection.x +\r\n      config.snapRadius +\r\n      Math.floor(Math.random() * BUMP_RANDOMNESS) -\r\n      this.x;\r\n    let dy =\r\n      staticConnection.y +\r\n      config.snapRadius +\r\n      Math.floor(Math.random() * BUMP_RANDOMNESS) -\r\n      this.y;\r\n    if (reverse) {\r\n      // When reversing a bump due to an uneditable block, bump up.\r\n      dy = -dy;\r\n    }\r\n    if (rootBlock.RTL) {\r\n      dx =\r\n        staticConnection.x -\r\n        config.snapRadius -\r\n        Math.floor(Math.random() * BUMP_RANDOMNESS) -\r\n        this.x;\r\n    }\r\n    rootBlock.moveBy(dx, dy, ['bump']);\r\n    selected || rootBlock.removeSelect();\r\n  }\r\n\r\n  /**\r\n   * Change the connection's coordinates.\r\n   *\r\n   * @param x New absolute x coordinate, in workspace coordinates.\r\n   * @param y New absolute y coordinate, in workspace coordinates.\r\n   * @returns True if the position of the connection in the connection db\r\n   *     was updated.\r\n   */\r\n  moveTo(x: number, y: number): boolean {\r\n    // TODO(#6922): Readd this optimization.\r\n    // const moved = this.x !== x || this.y !== y;\r\n    const moved = true;\r\n    let updated = false;\r\n\r\n    if (this.trackedState === RenderedConnection.TrackedState.WILL_TRACK) {\r\n      this.db.addConnection(this, y);\r\n      this.trackedState = RenderedConnection.TrackedState.TRACKED;\r\n      updated = true;\r\n    } else if (\r\n      this.trackedState === RenderedConnection.TrackedState.TRACKED &&\r\n      moved\r\n    ) {\r\n      this.db.removeConnection(this, this.y);\r\n      this.db.addConnection(this, y);\r\n      updated = true;\r\n    }\r\n\r\n    this.x = x;\r\n    this.y = y;\r\n\r\n    return updated;\r\n  }\r\n\r\n  /**\r\n   * Change the connection's coordinates.\r\n   *\r\n   * @param dx Change to x coordinate, in workspace units.\r\n   * @param dy Change to y coordinate, in workspace units.\r\n   * @returns True if the position of the connection in the connection db\r\n   *     was updated.\r\n   */\r\n  moveBy(dx: number, dy: number): boolean {\r\n    return this.moveTo(this.x + dx, this.y + dy);\r\n  }\r\n\r\n  /**\r\n   * Move this connection to the location given by its offset within the block\r\n   * and the location of the block's top left corner.\r\n   *\r\n   * @param blockTL The location of the top left corner of the block, in\r\n   *     workspace coordinates.\r\n   * @returns True if the position of the connection in the connection db\r\n   *     was updated.\r\n   */\r\n  moveToOffset(blockTL: Coordinate): boolean {\r\n    return this.moveTo(\r\n      blockTL.x + this.offsetInBlock.x,\r\n      blockTL.y + this.offsetInBlock.y,\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Set the offset of this connection relative to the top left of its block.\r\n   *\r\n   * @param x The new relative x, in workspace units.\r\n   * @param y The new relative y, in workspace units.\r\n   */\r\n  setOffsetInBlock(x: number, y: number) {\r\n    this.offsetInBlock.x = x;\r\n    this.offsetInBlock.y = y;\r\n  }\r\n\r\n  /**\r\n   * Get the offset of this connection relative to the top left of its block.\r\n   *\r\n   * @returns The offset of the connection.\r\n   */\r\n  getOffsetInBlock(): Coordinate {\r\n    return this.offsetInBlock;\r\n  }\r\n\r\n  /**\r\n   * Moves the blocks on either side of this connection right next to\r\n   * each other, based on their local offsets, not global positions.\r\n   *\r\n   * @internal\r\n   */\r\n  tightenEfficiently() {\r\n    const target = this.targetConnection;\r\n    const block = this.targetBlock();\r\n    if (!target || !block) return;\r\n    const offset = Coordinate.difference(\r\n      this.offsetInBlock,\r\n      target.offsetInBlock,\r\n    );\r\n    block.translate(offset.x, offset.y);\r\n  }\r\n\r\n  /**\r\n   * Find the closest compatible connection to this connection.\r\n   * All parameters are in workspace units.\r\n   *\r\n   * @param maxLimit The maximum radius to another connection.\r\n   * @param dxy Offset between this connection's location in the database and\r\n   *     the current location (as a result of dragging).\r\n   * @returns Contains two properties: 'connection' which is either another\r\n   *     connection or null, and 'radius' which is the distance.\r\n   */\r\n  closest(\r\n    maxLimit: number,\r\n    dxy: Coordinate,\r\n  ): {connection: RenderedConnection | null; radius: number} {\r\n    return this.dbOpposite.searchForClosest(this, maxLimit, dxy);\r\n  }\r\n\r\n  /** Add highlighting around this connection. */\r\n  highlight() {\r\n    this.highlighted = true;\r\n    this.getSourceBlock().queueRender();\r\n  }\r\n\r\n  /** Remove the highlighting around this connection. */\r\n  unhighlight() {\r\n    this.highlighted = false;\r\n    this.getSourceBlock().queueRender();\r\n  }\r\n\r\n  /** Returns true if this connection is highlighted, false otherwise. */\r\n  isHighlighted(): boolean {\r\n    return this.highlighted;\r\n  }\r\n\r\n  /**\r\n   * Set whether this connections is tracked in the database or not.\r\n   *\r\n   * @param doTracking If true, start tracking. If false, stop tracking.\r\n   * @internal\r\n   */\r\n  setTracking(doTracking: boolean) {\r\n    if (\r\n      (doTracking &&\r\n        this.trackedState === RenderedConnection.TrackedState.TRACKED) ||\r\n      (!doTracking &&\r\n        this.trackedState === RenderedConnection.TrackedState.UNTRACKED)\r\n    ) {\r\n      return;\r\n    }\r\n    if (this.sourceBlock_.isInFlyout) {\r\n      // Don't bother maintaining a database of connections in a flyout.\r\n      return;\r\n    }\r\n    if (doTracking) {\r\n      this.db.addConnection(this, this.y);\r\n      this.trackedState = RenderedConnection.TrackedState.TRACKED;\r\n      return;\r\n    }\r\n    if (this.trackedState === RenderedConnection.TrackedState.TRACKED) {\r\n      this.db.removeConnection(this, this.y);\r\n    }\r\n    this.trackedState = RenderedConnection.TrackedState.UNTRACKED;\r\n  }\r\n\r\n  /**\r\n   * Stop tracking this connection, as well as all down-stream connections on\r\n   * any block attached to this connection. This happens when a block is\r\n   * collapsed.\r\n   *\r\n   * Also closes down-stream icons/bubbles.\r\n   *\r\n   * @internal\r\n   */\r\n  stopTrackingAll() {\r\n    this.setTracking(false);\r\n    if (this.targetConnection) {\r\n      const blocks = this.targetBlock()!.getDescendants(false);\r\n      for (let i = 0; i < blocks.length; i++) {\r\n        const block = blocks[i];\r\n        // Stop tracking connections of all children.\r\n        const connections = block.getConnections_(true);\r\n        for (let j = 0; j < connections.length; j++) {\r\n          connections[j].setTracking(false);\r\n        }\r\n        // Close all bubbles of all children.\r\n        for (const icon of block.getIcons()) {\r\n          if (hasBubble(icon)) icon.setBubbleVisible(false);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Start tracking this connection, as well as all down-stream connections on\r\n   * any block attached to this connection. This happens when a block is\r\n   * expanded.\r\n   *\r\n   * @returns List of blocks to render.\r\n   */\r\n  startTrackingAll(): Block[] {\r\n    this.setTracking(true);\r\n    // All blocks that are not tracked must start tracking before any\r\n    // rendering takes place, since rendering requires knowing the dimensions\r\n    // of lower blocks. Also, since rendering a block renders all its parents,\r\n    // we only need to render the leaf nodes.\r\n    let renderList: Block[] = [];\r\n    if (\r\n      this.type !== ConnectionType.INPUT_VALUE &&\r\n      this.type !== ConnectionType.NEXT_STATEMENT\r\n    ) {\r\n      // Only spider down.\r\n      return renderList;\r\n    }\r\n    const block = this.targetBlock();\r\n    if (block) {\r\n      let connections;\r\n      if (block.isCollapsed()) {\r\n        // This block should only be partially revealed since it is collapsed.\r\n        connections = [];\r\n        block.outputConnection && connections.push(block.outputConnection);\r\n        block.nextConnection && connections.push(block.nextConnection);\r\n        block.previousConnection && connections.push(block.previousConnection);\r\n      } else {\r\n        // Show all connections of this block.\r\n        connections = block.getConnections_(true);\r\n      }\r\n      for (let i = 0; i < connections.length; i++) {\r\n        renderList.push(...connections[i].startTrackingAll());\r\n      }\r\n      if (!renderList.length) {\r\n        // Leaf block.\r\n        renderList = [block];\r\n      }\r\n    }\r\n    return renderList;\r\n  }\r\n\r\n  /**\r\n   * Behaviour after a connection attempt fails.\r\n   * Bumps this connection away from the other connection. Called when an\r\n   * attempted connection fails.\r\n   *\r\n   * @param otherConnection Connection that this connection failed to connect\r\n   *     to.\r\n   * @internal\r\n   */\r\n  override onFailedConnect(otherConnection: Connection) {\r\n    const block = this.getSourceBlock();\r\n    if (eventUtils.getRecordUndo()) {\r\n      const group = eventUtils.getGroup();\r\n      setTimeout(\r\n        function (this: RenderedConnection) {\r\n          if (!block.isDisposed() && !block.getParent()) {\r\n            eventUtils.setGroup(group);\r\n            this.bumpAwayFrom(otherConnection as RenderedConnection);\r\n            eventUtils.setGroup(false);\r\n          }\r\n        }.bind(this),\r\n        config.bumpDelay,\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Disconnect two blocks that are connected by this connection.\r\n   *\r\n   * @param setParent Whether to set the parent of the disconnected block or\r\n   *     not, defaults to true.\r\n   *     If you do not set the parent, ensure that a subsequent action does,\r\n   *     otherwise the view and model will be out of sync.\r\n   */\r\n  override disconnectInternal(setParent = true) {\r\n    const {parentConnection, childConnection} =\r\n      this.getParentAndChildConnections();\r\n    if (!parentConnection || !childConnection) return;\r\n    const parent = parentConnection.getSourceBlock() as BlockSvg;\r\n    const child = childConnection.getSourceBlock() as BlockSvg;\r\n    super.disconnectInternal(setParent);\r\n    // Rerender the parent so that it may reflow.\r\n    if (parent.rendered) {\r\n      parent.queueRender();\r\n    }\r\n    if (child.rendered) {\r\n      child.updateDisabled();\r\n      child.queueRender();\r\n      // Reset visibility, since the child is now a top block.\r\n      child.getSvgRoot().style.display = 'block';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Respawn the shadow block if there was one connected to the this connection.\r\n   * Render/rerender blocks as needed.\r\n   */\r\n  protected override respawnShadow_() {\r\n    super.respawnShadow_();\r\n    const blockShadow = this.targetBlock();\r\n    if (!blockShadow) {\r\n      return;\r\n    }\r\n    blockShadow.initSvg();\r\n    blockShadow.queueRender();\r\n  }\r\n\r\n  /**\r\n   * Find all nearby compatible connections to this connection.\r\n   * Type checking does not apply, since this function is used for bumping.\r\n   *\r\n   * @param maxLimit The maximum radius to another connection, in workspace\r\n   *     units.\r\n   * @returns List of connections.\r\n   * @internal\r\n   */\r\n  override neighbours(maxLimit: number): RenderedConnection[] {\r\n    return this.dbOpposite.getNeighbours(this, maxLimit);\r\n  }\r\n\r\n  /**\r\n   * Connect two connections together.  This is the connection on the superior\r\n   * block.  Rerender blocks as needed.\r\n   *\r\n   * @param childConnection Connection on inferior block.\r\n   */\r\n  protected override connect_(childConnection: Connection) {\r\n    super.connect_(childConnection);\r\n\r\n    const renderedChildConnection = childConnection as RenderedConnection;\r\n\r\n    const parentBlock = this.getSourceBlock();\r\n    const childBlock = renderedChildConnection.getSourceBlock();\r\n    const parentRendered = parentBlock.rendered;\r\n    const childRendered = childBlock.rendered;\r\n\r\n    if (parentRendered) {\r\n      parentBlock.updateDisabled();\r\n    }\r\n    if (childRendered) {\r\n      childBlock.updateDisabled();\r\n    }\r\n    if (parentRendered && childRendered) {\r\n      if (\r\n        this.type === ConnectionType.NEXT_STATEMENT ||\r\n        this.type === ConnectionType.PREVIOUS_STATEMENT\r\n      ) {\r\n        // Child block may need to square off its corners if it is in a stack.\r\n        // Rendering a child will render its parent.\r\n        childBlock.queueRender();\r\n      } else {\r\n        // Child block does not change shape.  Rendering the parent node will\r\n        // move its connected children into position.\r\n        parentBlock.queueRender();\r\n      }\r\n    }\r\n\r\n    // The input the child block is connected to (if any).\r\n    const parentInput = parentBlock.getInputWithBlock(childBlock);\r\n    if (parentInput) {\r\n      const visible = parentInput.isVisible();\r\n      childBlock.getSvgRoot().style.display = visible ? 'block' : 'none';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Function to be called when this connection's compatible types have changed.\r\n   */\r\n  protected override onCheckChanged_() {\r\n    // The new value type may not be compatible with the existing connection.\r\n    if (\r\n      this.isConnected() &&\r\n      (!this.targetConnection ||\r\n        !this.getConnectionChecker().canConnect(\r\n          this,\r\n          this.targetConnection,\r\n          false,\r\n        ))\r\n    ) {\r\n      const child = this.isSuperior() ? this.targetBlock() : this.sourceBlock_;\r\n      child!.unplug();\r\n      // Bump away.\r\n      this.sourceBlock_.bumpNeighbours();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Change a connection's compatibility.\r\n   * Rerender blocks as needed.\r\n   *\r\n   * @param check Compatible value type or list of value types. Null if all\r\n   *     types are compatible.\r\n   * @returns The connection being modified (to allow chaining).\r\n   */\r\n  override setCheck(check: string | string[] | null): RenderedConnection {\r\n    super.setCheck(check);\r\n    if (this.sourceBlock_.rendered) {\r\n      this.sourceBlock_.queueRender();\r\n    }\r\n    return this;\r\n  }\r\n}\r\n\r\nexport namespace RenderedConnection {\r\n  /**\r\n   * Enum for different kinds of tracked states.\r\n   *\r\n   * WILL_TRACK means that this connection will add itself to\r\n   * the db on the next moveTo call it receives.\r\n   *\r\n   * UNTRACKED means that this connection will not add\r\n   * itself to the database until setTracking(true) is explicitly called.\r\n   *\r\n   * TRACKED means that this connection is currently being tracked.\r\n   */\r\n  export enum TrackedState {\r\n    WILL_TRACK = -1,\r\n    UNTRACKED = 0,\r\n    TRACKED = 1,\r\n  }\r\n}\r\n\r\nexport type TrackedState = RenderedConnection.TrackedState;\r\nexport const TrackedState = RenderedConnection.TrackedState;\r\n","/**\r\n * @license\r\n * Copyright 2012 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Methods for graphically rendering a block as SVG.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.BlockSvg\r\n\r\n// Unused import preserved for side-effects. Remove if unneeded.\r\nimport './events/events_selected.js';\r\n\r\nimport {Block} from './block.js';\r\nimport * as blockAnimations from './block_animations.js';\r\nimport * as browserEvents from './browser_events.js';\r\nimport {CommentIcon} from './icons/comment_icon.js';\r\nimport * as common from './common.js';\r\nimport {config} from './config.js';\r\nimport type {Connection} from './connection.js';\r\nimport {ConnectionType} from './connection_type.js';\r\nimport * as constants from './constants.js';\r\nimport * as ContextMenu from './contextmenu.js';\r\nimport {\r\n  ContextMenuOption,\r\n  ContextMenuRegistry,\r\n  LegacyContextMenuOption,\r\n} from './contextmenu_registry.js';\r\nimport type {BlockMove} from './events/events_block_move.js';\r\nimport * as eventUtils from './events/utils.js';\r\nimport type {Field} from './field.js';\r\nimport {FieldLabel} from './field_label.js';\r\nimport type {Input} from './inputs/input.js';\r\nimport type {IASTNodeLocationSvg} from './interfaces/i_ast_node_location_svg.js';\r\nimport type {IBoundedElement} from './interfaces/i_bounded_element.js';\r\nimport type {ICopyable} from './interfaces/i_copyable.js';\r\nimport type {IDraggable} from './interfaces/i_draggable.js';\r\nimport {IIcon} from './interfaces/i_icon.js';\r\nimport * as internalConstants from './internal_constants.js';\r\nimport {ASTNode} from './keyboard_nav/ast_node.js';\r\nimport {TabNavigateCursor} from './keyboard_nav/tab_navigate_cursor.js';\r\nimport {MarkerManager} from './marker_manager.js';\r\nimport {Msg} from './msg.js';\r\nimport {MutatorIcon} from './icons/mutator_icon.js';\r\nimport {RenderedConnection} from './rendered_connection.js';\r\nimport type {IPathObject} from './renderers/common/i_path_object.js';\r\nimport * as blocks from './serialization/blocks.js';\r\nimport type {BlockStyle} from './theme.js';\r\nimport * as Tooltip from './tooltip.js';\r\nimport {Coordinate} from './utils/coordinate.js';\r\nimport * as dom from './utils/dom.js';\r\nimport {Rect} from './utils/rect.js';\r\nimport {Svg} from './utils/svg.js';\r\nimport * as svgMath from './utils/svg_math.js';\r\nimport {WarningIcon} from './icons/warning_icon.js';\r\nimport type {Workspace} from './workspace.js';\r\nimport type {WorkspaceSvg} from './workspace_svg.js';\r\nimport * as renderManagement from './render_management.js';\r\nimport * as deprecation from './utils/deprecation.js';\r\nimport {IconType} from './icons/icon_types.js';\r\nimport {BlockCopyData, BlockPaster} from './clipboard/block_paster.js';\r\n\r\n/**\r\n * Class for a block's SVG representation.\r\n * Not normally called directly, workspace.newBlock() is preferred.\r\n */\r\nexport class BlockSvg\r\n  extends Block\r\n  implements\r\n    IASTNodeLocationSvg,\r\n    IBoundedElement,\r\n    ICopyable<BlockCopyData>,\r\n    IDraggable\r\n{\r\n  /**\r\n   * Constant for identifying rows that are to be rendered inline.\r\n   * Don't collide with Blockly.inputTypes.\r\n   */\r\n  static readonly INLINE = -1;\r\n\r\n  /**\r\n   * ID to give the \"collapsed warnings\" warning. Allows us to remove the\r\n   * \"collapsed warnings\" warning without removing any warnings that belong to\r\n   * the block.\r\n   */\r\n  static readonly COLLAPSED_WARNING_ID = 'TEMP_COLLAPSED_WARNING_';\r\n  override decompose?: (p1: Workspace) => BlockSvg;\r\n  // override compose?: ((p1: BlockSvg) => void)|null;\r\n  saveConnections?: (p1: BlockSvg) => void;\r\n  customContextMenu?: (\r\n    p1: Array<ContextMenuOption | LegacyContextMenuOption>,\r\n  ) => void;\r\n\r\n  /**\r\n   * Height of this block, not including any statement blocks above or below.\r\n   * Height is in workspace units.\r\n   */\r\n  height = 0;\r\n\r\n  /**\r\n   * Width of this block, including any connected value blocks.\r\n   * Width is in workspace units.\r\n   */\r\n  width = 0;\r\n\r\n  /**\r\n   * Map from IDs for warnings text to PIDs of functions to apply them.\r\n   * Used to be able to maintain multiple warnings.\r\n   */\r\n  private warningTextDb = new Map<string, ReturnType<typeof setTimeout>>();\r\n\r\n  /** Block's mutator icon (if any). */\r\n  mutator: MutatorIcon | null = null;\r\n\r\n  /**\r\n   * Block's warning icon (if any).\r\n   *\r\n   * @deprecated Use `setWarningText` to modify warnings on this block.\r\n   */\r\n  warning: WarningIcon | null = null;\r\n\r\n  private svgGroup_: SVGGElement;\r\n  style: BlockStyle;\r\n  /** @internal */\r\n  pathObject: IPathObject;\r\n  override rendered = false;\r\n  private visuallyDisabled = false;\r\n\r\n  /**\r\n   * Is this block currently rendering? Used to stop recursive render calls\r\n   * from actually triggering a re-render.\r\n   */\r\n  private renderIsInProgress_ = false;\r\n\r\n  /** Whether mousedown events have been bound yet. */\r\n  private eventsInit_ = false;\r\n\r\n  override workspace: WorkspaceSvg;\r\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\r\n  override outputConnection!: RenderedConnection;\r\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\r\n  override nextConnection!: RenderedConnection;\r\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\r\n  override previousConnection!: RenderedConnection;\r\n\r\n  private translation = '';\r\n\r\n  /**\r\n   * The ID of the setTimeout callback for bumping neighbours, or 0 if no bump\r\n   * is currently scheduled.\r\n   */\r\n  private bumpNeighboursPid = 0;\r\n\r\n  /** Whether this block is currently being dragged. */\r\n  private dragging = false;\r\n\r\n  /**\r\n   * The location of the top left of this block (in workspace coordinates)\r\n   * relative to either its parent block, or the workspace origin if it has no\r\n   * parent.\r\n   *\r\n   * @internal\r\n   */\r\n  relativeCoords = new Coordinate(0, 0);\r\n\r\n  /**\r\n   * @param workspace The block's workspace.\r\n   * @param prototypeName Name of the language object containing type-specific\r\n   *     functions for this block.\r\n   * @param opt_id Optional ID.  Use this ID if provided, otherwise create a new\r\n   *     ID.\r\n   */\r\n  constructor(workspace: WorkspaceSvg, prototypeName: string, opt_id?: string) {\r\n    super(workspace, prototypeName, opt_id);\r\n    this.workspace = workspace;\r\n    this.svgGroup_ = dom.createSvgElement(Svg.G, {});\r\n\r\n    /** A block style object. */\r\n    this.style = workspace.getRenderer().getConstants().getBlockStyle(null);\r\n\r\n    /** The renderer's path object. */\r\n    this.pathObject = workspace\r\n      .getRenderer()\r\n      .makePathObject(this.svgGroup_, this.style);\r\n\r\n    const svgPath = this.pathObject.svgPath;\r\n    (svgPath as any).tooltip = this;\r\n    Tooltip.bindMouseEvents(svgPath);\r\n\r\n    // Expose this block's ID on its top-level SVG group.\r\n    this.svgGroup_.setAttribute('data-id', this.id);\r\n\r\n    this.doInit_();\r\n  }\r\n\r\n  /**\r\n   * Create and initialize the SVG representation of the block.\r\n   * May be called more than once.\r\n   */\r\n  initSvg() {\r\n    if (!this.workspace.rendered) {\r\n      throw TypeError('Workspace is headless.');\r\n    }\r\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\r\n      input.init();\r\n    }\r\n    for (const icon of this.getIcons()) {\r\n      icon.initView(this.createIconPointerDownListener(icon));\r\n      icon.updateEditable();\r\n    }\r\n    this.applyColour();\r\n    this.pathObject.updateMovable(this.isMovable());\r\n    const svg = this.getSvgRoot();\r\n    if (!this.workspace.options.readOnly && !this.eventsInit_ && svg) {\r\n      browserEvents.conditionalBind(\r\n        svg,\r\n        'pointerdown',\r\n        this,\r\n        this.onMouseDown_,\r\n      );\r\n    }\r\n    this.eventsInit_ = true;\r\n\r\n    if (!svg.parentNode) {\r\n      this.workspace.getCanvas().appendChild(svg);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the secondary colour of a block.\r\n   *\r\n   * @returns #RRGGBB string.\r\n   */\r\n  getColourSecondary(): string | undefined {\r\n    return this.style.colourSecondary;\r\n  }\r\n\r\n  /**\r\n   * Get the tertiary colour of a block.\r\n   *\r\n   * @returns #RRGGBB string.\r\n   */\r\n  getColourTertiary(): string | undefined {\r\n    return this.style.colourTertiary;\r\n  }\r\n\r\n  /**\r\n   * Selects this block. Highlights the block visually and fires a select event\r\n   * if the block is not already selected.\r\n   */\r\n  select() {\r\n    if (this.isShadow() && this.getParent()) {\r\n      // Shadow blocks should not be selected.\r\n      this.getParent()!.select();\r\n      return;\r\n    }\r\n    if (common.getSelected() === this) {\r\n      return;\r\n    }\r\n    let oldId = null;\r\n    if (common.getSelected()) {\r\n      oldId = common.getSelected()!.id;\r\n      // Unselect any previously selected block.\r\n      eventUtils.disable();\r\n      try {\r\n        common.getSelected()!.unselect();\r\n      } finally {\r\n        eventUtils.enable();\r\n      }\r\n    }\r\n    const event = new (eventUtils.get(eventUtils.SELECTED))(\r\n      oldId,\r\n      this.id,\r\n      this.workspace.id,\r\n    );\r\n    eventUtils.fire(event);\r\n    common.setSelected(this);\r\n    this.addSelect();\r\n  }\r\n\r\n  /**\r\n   * Unselects this block. Unhighlights the block and fires a select (false)\r\n   * event if the block is currently selected.\r\n   */\r\n  unselect() {\r\n    if (common.getSelected() !== this) {\r\n      return;\r\n    }\r\n    const event = new (eventUtils.get(eventUtils.SELECTED))(\r\n      this.id,\r\n      null,\r\n      this.workspace.id,\r\n    );\r\n    event.workspaceId = this.workspace.id;\r\n    eventUtils.fire(event);\r\n    common.setSelected(null);\r\n    this.removeSelect();\r\n  }\r\n\r\n  /**\r\n   * Sets the parent of this block to be a new block or null.\r\n   *\r\n   * @param newParent New parent block.\r\n   * @internal\r\n   */\r\n  override setParent(newParent: this | null) {\r\n    const oldParent = this.parentBlock_;\r\n    if (newParent === oldParent) {\r\n      return;\r\n    }\r\n\r\n    dom.startTextWidthCache();\r\n    super.setParent(newParent);\r\n    dom.stopTextWidthCache();\r\n\r\n    const svgRoot = this.getSvgRoot();\r\n\r\n    // Bail early if workspace is clearing, or we aren't rendered.\r\n    // We won't need to reattach ourselves anywhere.\r\n    if (this.workspace.isClearing || !svgRoot) {\r\n      return;\r\n    }\r\n\r\n    const oldXY = this.getRelativeToSurfaceXY();\r\n    if (newParent) {\r\n      (newParent as BlockSvg).getSvgRoot().appendChild(svgRoot);\r\n    } else if (oldParent) {\r\n      // If we are losing a parent, we want to move our DOM element to the\r\n      // root of the workspace.\r\n      const draggingBlock = this.workspace\r\n        .getCanvas()\r\n        .querySelector('.blocklyDragging');\r\n      if (draggingBlock) {\r\n        this.workspace.getCanvas().insertBefore(svgRoot, draggingBlock);\r\n      } else {\r\n        this.workspace.getCanvas().appendChild(svgRoot);\r\n      }\r\n      this.translate(oldXY.x, oldXY.y);\r\n    }\r\n\r\n    this.applyColour();\r\n  }\r\n\r\n  /**\r\n   * Return the coordinates of the top-left corner of this block relative to the\r\n   * drawing surface's origin (0,0), in workspace units.\r\n   * If the block is on the workspace, (0, 0) is the origin of the workspace\r\n   * coordinate system.\r\n   * This does not change with workspace scale.\r\n   *\r\n   * @returns Object with .x and .y properties in workspace coordinates.\r\n   */\r\n  override getRelativeToSurfaceXY(): Coordinate {\r\n    const layerManger = this.workspace.getLayerManager();\r\n    if (!layerManger) {\r\n      throw new Error(\r\n        'Cannot calculate position because the workspace has not been appended',\r\n      );\r\n    }\r\n    let x = 0;\r\n    let y = 0;\r\n\r\n    let element: SVGElement = this.getSvgRoot();\r\n    if (element) {\r\n      do {\r\n        // Loop through this block and every parent.\r\n        const xy = svgMath.getRelativeXY(element);\r\n        x += xy.x;\r\n        y += xy.y;\r\n        element = element.parentNode as SVGElement;\r\n      } while (element && !layerManger.hasLayer(element));\r\n    }\r\n    return new Coordinate(x, y);\r\n  }\r\n\r\n  /**\r\n   * Move a block by a relative offset.\r\n   *\r\n   * @param dx Horizontal offset in workspace units.\r\n   * @param dy Vertical offset in workspace units.\r\n   * @param reason Why is this move happening?  'drag', 'bump', 'snap', ...\r\n   */\r\n  override moveBy(dx: number, dy: number, reason?: string[]) {\r\n    if (this.parentBlock_) {\r\n      throw Error('Block has parent');\r\n    }\r\n    const eventsEnabled = eventUtils.isEnabled();\r\n    let event: BlockMove | null = null;\r\n    if (eventsEnabled) {\r\n      event = new (eventUtils.get(eventUtils.BLOCK_MOVE)!)(this) as BlockMove;\r\n      reason && event.setReason(reason);\r\n    }\r\n\r\n    const delta = new Coordinate(dx, dy);\r\n    const currLoc = this.getRelativeToSurfaceXY();\r\n    const newLoc = Coordinate.sum(currLoc, delta);\r\n    this.translate(newLoc.x, newLoc.y);\r\n    this.updateComponentLocations(newLoc);\r\n\r\n    if (eventsEnabled && event) {\r\n      event!.recordNew();\r\n      eventUtils.fire(event);\r\n    }\r\n    this.workspace.resizeContents();\r\n  }\r\n\r\n  /**\r\n   * Transforms a block by setting the translation on the transform attribute\r\n   * of the block's SVG.\r\n   *\r\n   * @param x The x coordinate of the translation in workspace units.\r\n   * @param y The y coordinate of the translation in workspace units.\r\n   */\r\n  translate(x: number, y: number) {\r\n    this.translation = `translate(${x}, ${y})`;\r\n    this.relativeCoords = new Coordinate(x, y);\r\n    this.getSvgRoot().setAttribute('transform', this.getTranslation());\r\n  }\r\n\r\n  /**\r\n   * Returns the SVG translation of this block.\r\n   *\r\n   * @internal\r\n   */\r\n  getTranslation(): string {\r\n    return this.translation;\r\n  }\r\n\r\n  /**\r\n   * Move a block to a position.\r\n   *\r\n   * @param xy The position to move to in workspace units.\r\n   * @param reason Why is this move happening?  'drag', 'bump', 'snap', ...\r\n   */\r\n  moveTo(xy: Coordinate, reason?: string[]) {\r\n    const curXY = this.getRelativeToSurfaceXY();\r\n    this.moveBy(xy.x - curXY.x, xy.y - curXY.y, reason);\r\n  }\r\n\r\n  /**\r\n   * Move this block during a drag.\r\n   * This block must be a top-level block.\r\n   *\r\n   * @param newLoc The location to translate to, in workspace coordinates.\r\n   * @internal\r\n   */\r\n  moveDuringDrag(newLoc: Coordinate) {\r\n    this.translate(newLoc.x, newLoc.y);\r\n    this.getSvgRoot().setAttribute('transform', this.getTranslation());\r\n    this.updateComponentLocations(newLoc);\r\n  }\r\n\r\n  /** Snap this block to the nearest grid point. */\r\n  snapToGrid() {\r\n    if (this.isDeadOrDying()) {\r\n      return; // Deleted block.\r\n    }\r\n    if (this.workspace.isDragging()) {\r\n      return; // Don't bump blocks during a drag.\r\n    }\r\n\r\n    if (this.getParent()) {\r\n      return; // Only snap top-level blocks.\r\n    }\r\n    if (this.isInFlyout) {\r\n      return; // Don't move blocks around in a flyout.\r\n    }\r\n    const grid = this.workspace.getGrid();\r\n    if (!grid || !grid.shouldSnap()) {\r\n      return; // Config says no snapping.\r\n    }\r\n    const spacing = grid.getSpacing();\r\n    const half = spacing / 2;\r\n    const xy = this.getRelativeToSurfaceXY();\r\n    const dx = Math.round(\r\n      Math.round((xy.x - half) / spacing) * spacing + half - xy.x,\r\n    );\r\n    const dy = Math.round(\r\n      Math.round((xy.y - half) / spacing) * spacing + half - xy.y,\r\n    );\r\n    if (dx || dy) {\r\n      this.moveBy(dx, dy, ['snap']);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns the coordinates of a bounding box describing the dimensions of this\r\n   * block and any blocks stacked below it.\r\n   * Coordinate system: workspace coordinates.\r\n   *\r\n   * @returns Object with coordinates of the bounding box.\r\n   */\r\n  getBoundingRectangle(): Rect {\r\n    const blockXY = this.getRelativeToSurfaceXY();\r\n    const blockBounds = this.getHeightWidth();\r\n    let left;\r\n    let right;\r\n    if (this.RTL) {\r\n      left = blockXY.x - blockBounds.width;\r\n      right = blockXY.x;\r\n    } else {\r\n      left = blockXY.x;\r\n      right = blockXY.x + blockBounds.width;\r\n    }\r\n    return new Rect(blockXY.y, blockXY.y + blockBounds.height, left, right);\r\n  }\r\n\r\n  /**\r\n   * Notify every input on this block to mark its fields as dirty.\r\n   * A dirty field is a field that needs to be re-rendered.\r\n   */\r\n  markDirty() {\r\n    this.pathObject.constants = this.workspace.getRenderer().getConstants();\r\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\r\n      input.markDirty();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set whether the block is collapsed or not.\r\n   *\r\n   * @param collapsed True if collapsed.\r\n   */\r\n  override setCollapsed(collapsed: boolean) {\r\n    if (this.collapsed_ === collapsed) {\r\n      return;\r\n    }\r\n    super.setCollapsed(collapsed);\r\n    this.updateCollapsed_();\r\n  }\r\n\r\n  /**\r\n   * Makes sure that when the block is collapsed, it is rendered correctly\r\n   * for that state.\r\n   */\r\n  private updateCollapsed_() {\r\n    const collapsed = this.isCollapsed();\r\n    const collapsedInputName = constants.COLLAPSED_INPUT_NAME;\r\n    const collapsedFieldName = constants.COLLAPSED_FIELD_NAME;\r\n\r\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\r\n      if (input.name !== collapsedInputName) {\r\n        input.setVisible(!collapsed);\r\n      }\r\n    }\r\n\r\n    for (const icon of this.getIcons()) {\r\n      icon.updateCollapsed();\r\n    }\r\n\r\n    if (!collapsed) {\r\n      this.updateDisabled();\r\n      this.removeInput(collapsedInputName);\r\n      return;\r\n    }\r\n\r\n    const text = this.toString(internalConstants.COLLAPSE_CHARS);\r\n    const field = this.getField(collapsedFieldName);\r\n    if (field) {\r\n      field.setValue(text);\r\n      return;\r\n    }\r\n    const input =\r\n      this.getInput(collapsedInputName) ||\r\n      this.appendDummyInput(collapsedInputName);\r\n    input.appendField(new FieldLabel(text), collapsedFieldName);\r\n  }\r\n\r\n  /**\r\n   * Open the next (or previous) FieldTextInput.\r\n   *\r\n   * @param start Current field.\r\n   * @param forward If true go forward, otherwise backward.\r\n   */\r\n  tab(start: Field, forward: boolean) {\r\n    const tabCursor = new TabNavigateCursor();\r\n    tabCursor.setCurNode(ASTNode.createFieldNode(start)!);\r\n    const currentNode = tabCursor.getCurNode();\r\n\r\n    if (forward) {\r\n      tabCursor.next();\r\n    } else {\r\n      tabCursor.prev();\r\n    }\r\n\r\n    const nextNode = tabCursor.getCurNode();\r\n    if (nextNode && nextNode !== currentNode) {\r\n      const nextField = nextNode.getLocation() as Field;\r\n      nextField.showEditor();\r\n\r\n      // Also move the cursor if we're in keyboard nav mode.\r\n      if (this.workspace.keyboardAccessibilityMode) {\r\n        this.workspace.getCursor()!.setCurNode(nextNode);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle a pointerdown on an SVG block.\r\n   *\r\n   * @param e Pointer down event.\r\n   */\r\n  private onMouseDown_(e: PointerEvent) {\r\n    const gesture = this.workspace.getGesture(e);\r\n    if (gesture) {\r\n      gesture.handleBlockStart(e, this);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Load the block's help page in a new window.\r\n   *\r\n   * @internal\r\n   */\r\n  showHelp() {\r\n    const url =\r\n      typeof this.helpUrl === 'function' ? this.helpUrl() : this.helpUrl;\r\n    if (url) {\r\n      window.open(url);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Generate the context menu for this block.\r\n   *\r\n   * @returns Context menu options or null if no menu.\r\n   */\r\n  protected generateContextMenu(): Array<\r\n    ContextMenuOption | LegacyContextMenuOption\r\n  > | null {\r\n    if (this.workspace.options.readOnly || !this.contextMenu) {\r\n      return null;\r\n    }\r\n    const menuOptions = ContextMenuRegistry.registry.getContextMenuOptions(\r\n      ContextMenuRegistry.ScopeType.BLOCK,\r\n      {block: this},\r\n    );\r\n\r\n    // Allow the block to add or modify menuOptions.\r\n    if (this.customContextMenu) {\r\n      this.customContextMenu(menuOptions);\r\n    }\r\n\r\n    return menuOptions;\r\n  }\r\n\r\n  /**\r\n   * Show the context menu for this block.\r\n   *\r\n   * @param e Mouse event.\r\n   * @internal\r\n   */\r\n  showContextMenu(e: Event) {\r\n    const menuOptions = this.generateContextMenu();\r\n\r\n    if (menuOptions && menuOptions.length) {\r\n      ContextMenu.show(e, menuOptions, this.RTL);\r\n      ContextMenu.setCurrentBlock(this);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Updates the locations of any parts of the block that need to know where\r\n   * they are (e.g. connections, icons).\r\n   *\r\n   * @param blockOrigin The top-left of this block in workspace coordinates.\r\n   * @internal\r\n   */\r\n  updateComponentLocations(blockOrigin: Coordinate) {\r\n    if (!this.rendered) {\r\n      // Rendering is required to lay out the blocks.\r\n      // This is probably an invisible block attached to a collapsed block.\r\n      return;\r\n    }\r\n\r\n    if (!this.dragging) this.updateConnectionLocations(blockOrigin);\r\n    this.updateIconLocations(blockOrigin);\r\n    this.updateFieldLocations(blockOrigin);\r\n\r\n    for (const child of this.getChildren(false)) {\r\n      child.updateComponentLocations(\r\n        Coordinate.sum(blockOrigin, child.relativeCoords),\r\n      );\r\n    }\r\n  }\r\n\r\n  private updateConnectionLocations(blockOrigin: Coordinate) {\r\n    for (const conn of this.getConnections_(false)) {\r\n      conn.moveToOffset(blockOrigin);\r\n    }\r\n  }\r\n\r\n  private updateIconLocations(blockOrigin: Coordinate) {\r\n    for (const icon of this.getIcons()) {\r\n      icon.onLocationChange(blockOrigin);\r\n    }\r\n  }\r\n\r\n  private updateFieldLocations(blockOrigin: Coordinate) {\r\n    for (const input of this.inputList) {\r\n      for (const field of input.fieldRow) {\r\n        field.onLocationChange(blockOrigin);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Recursively adds or removes the dragging class to this node and its\r\n   * children.\r\n   *\r\n   * @param adding True if adding, false if removing.\r\n   * @internal\r\n   */\r\n  setDragging(adding: boolean) {\r\n    this.dragging = adding;\r\n    if (adding) {\r\n      this.translation = '';\r\n      common.draggingConnections.push(...this.getConnections_(true));\r\n      dom.addClass(this.svgGroup_, 'blocklyDragging');\r\n    } else {\r\n      common.draggingConnections.length = 0;\r\n      dom.removeClass(this.svgGroup_, 'blocklyDragging');\r\n    }\r\n    // Recurse through all blocks attached under this one.\r\n    for (let i = 0; i < this.childBlocks_.length; i++) {\r\n      (this.childBlocks_[i] as BlockSvg).setDragging(adding);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set whether this block is movable or not.\r\n   *\r\n   * @param movable True if movable.\r\n   */\r\n  override setMovable(movable: boolean) {\r\n    super.setMovable(movable);\r\n    this.pathObject.updateMovable(movable);\r\n  }\r\n\r\n  /**\r\n   * Set whether this block is editable or not.\r\n   *\r\n   * @param editable True if editable.\r\n   */\r\n  override setEditable(editable: boolean) {\r\n    super.setEditable(editable);\r\n    const icons = this.getIcons();\r\n    for (let i = 0; i < icons.length; i++) {\r\n      icons[i].updateEditable();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Sets whether this block is a shadow block or not.\r\n   * This method is internal and should not be called by users of Blockly. To\r\n   * create shadow blocks programmatically call connection.setShadowState\r\n   *\r\n   * @param shadow True if a shadow.\r\n   * @internal\r\n   */\r\n  override setShadow(shadow: boolean) {\r\n    super.setShadow(shadow);\r\n    this.applyColour();\r\n  }\r\n\r\n  /**\r\n   * Set whether this block is an insertion marker block or not.\r\n   * Once set this cannot be unset.\r\n   *\r\n   * @param insertionMarker True if an insertion marker.\r\n   * @internal\r\n   */\r\n  override setInsertionMarker(insertionMarker: boolean) {\r\n    if (this.isInsertionMarker_ === insertionMarker) {\r\n      return; // No change.\r\n    }\r\n    this.isInsertionMarker_ = insertionMarker;\r\n    if (this.isInsertionMarker_) {\r\n      this.setColour(\r\n        this.workspace.getRenderer().getConstants().INSERTION_MARKER_COLOUR,\r\n      );\r\n      this.pathObject.updateInsertionMarker(true);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Return the root node of the SVG or null if none exists.\r\n   *\r\n   * @returns The root SVG node (probably a group).\r\n   */\r\n  getSvgRoot(): SVGGElement {\r\n    return this.svgGroup_;\r\n  }\r\n\r\n  /**\r\n   * Dispose of this block.\r\n   *\r\n   * @param healStack If true, then try to heal any gap by connecting the next\r\n   *     statement with the previous statement.  Otherwise, dispose of all\r\n   *     children of this block.\r\n   * @param animate If true, show a disposal animation and sound.\r\n   */\r\n  override dispose(healStack?: boolean, animate?: boolean) {\r\n    if (this.isDeadOrDying()) return;\r\n\r\n    Tooltip.dispose();\r\n    ContextMenu.hide();\r\n\r\n    if (animate && this.rendered) {\r\n      this.unplug(healStack);\r\n      blockAnimations.disposeUiEffect(this);\r\n    }\r\n\r\n    super.dispose(!!healStack);\r\n    dom.removeNode(this.svgGroup_);\r\n  }\r\n\r\n  /**\r\n   * Disposes of this block without doing things required by the top block.\r\n   * E.g. does trigger UI effects, remove nodes, etc.\r\n   */\r\n  override disposeInternal() {\r\n    if (this.isDeadOrDying()) return;\r\n    super.disposeInternal();\r\n\r\n    this.rendered = false;\r\n\r\n    if (common.getSelected() === this) {\r\n      this.unselect();\r\n      this.workspace.cancelCurrentGesture();\r\n    }\r\n\r\n    [...this.warningTextDb.values()].forEach((n) => clearTimeout(n));\r\n    this.warningTextDb.clear();\r\n\r\n    this.getIcons().forEach((i) => i.dispose());\r\n  }\r\n\r\n  /**\r\n   * Delete a block and hide chaff when doing so. The block will not be deleted\r\n   * if it's in a flyout. This is called from the context menu and keyboard\r\n   * shortcuts as the full delete action. If you are disposing of a block from\r\n   * the workspace and don't need to perform flyout checks, handle event\r\n   * grouping, or hide chaff, then use `block.dispose()` directly.\r\n   */\r\n  checkAndDelete() {\r\n    if (this.workspace.isFlyout) {\r\n      return;\r\n    }\r\n    eventUtils.setGroup(true);\r\n    this.workspace.hideChaff();\r\n    if (this.outputConnection) {\r\n      // Do not attempt to heal rows\r\n      // (https://github.com/google/blockly/issues/4832)\r\n      this.dispose(false, true);\r\n    } else {\r\n      this.dispose(/* heal */ true, true);\r\n    }\r\n    eventUtils.setGroup(false);\r\n  }\r\n\r\n  /**\r\n   * Encode a block for copying.\r\n   *\r\n   * @returns Copy metadata, or null if the block is an insertion marker.\r\n   */\r\n  toCopyData(): BlockCopyData | null {\r\n    if (this.isInsertionMarker_) {\r\n      return null;\r\n    }\r\n    return {\r\n      paster: BlockPaster.TYPE,\r\n      blockState: blocks.save(this, {\r\n        addCoordinates: true,\r\n        addNextBlocks: false,\r\n      }) as blocks.State,\r\n      typeCounts: common.getBlockTypeCounts(this, true),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Updates the colour of the block to match the block's state.\r\n   *\r\n   * @internal\r\n   */\r\n  applyColour() {\r\n    this.pathObject.applyColour(this);\r\n\r\n    const icons = this.getIcons();\r\n    for (let i = 0; i < icons.length; i++) {\r\n      icons[i].applyColour();\r\n    }\r\n\r\n    for (let x = 0, input; (input = this.inputList[x]); x++) {\r\n      for (let y = 0, field; (field = input.fieldRow[y]); y++) {\r\n        field.applyColour();\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Updates the colour of the block (and children) to match the current\r\n   * disabled state.\r\n   *\r\n   * @internal\r\n   */\r\n  updateDisabled() {\r\n    const disabled = !this.isEnabled() || this.getInheritedDisabled();\r\n\r\n    if (this.visuallyDisabled === disabled) {\r\n      this.getNextBlock()?.updateDisabled();\r\n      return;\r\n    }\r\n\r\n    this.applyColour();\r\n    this.visuallyDisabled = disabled;\r\n    for (const child of this.getChildren(false)) {\r\n      child.updateDisabled();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the comment icon attached to this block, or null if the block has no\r\n   * comment.\r\n   *\r\n   * @returns The comment icon attached to this block, or null.\r\n   * @deprecated Use getIcon. To be remove in v11.\r\n   */\r\n  getCommentIcon(): CommentIcon | null {\r\n    deprecation.warn('getCommentIcon', 'v10', 'v11', 'getIcon');\r\n    return (this.getIcon(CommentIcon.TYPE) ?? null) as CommentIcon | null;\r\n  }\r\n\r\n  /**\r\n   * Set this block's warning text.\r\n   *\r\n   * @param text The text, or null to delete.\r\n   * @param id An optional ID for the warning text to be able to maintain\r\n   *     multiple warnings.\r\n   */\r\n  override setWarningText(text: string | null, id: string = '') {\r\n    if (!id) {\r\n      // Kill all previous pending processes, this edit supersedes them all.\r\n      for (const timeout of this.warningTextDb.values()) {\r\n        clearTimeout(timeout);\r\n      }\r\n      this.warningTextDb.clear();\r\n    } else if (this.warningTextDb.has(id)) {\r\n      // Only queue up the latest change.  Kill any earlier pending process.\r\n      clearTimeout(this.warningTextDb.get(id)!);\r\n      this.warningTextDb.delete(id);\r\n    }\r\n    if (this.workspace.isDragging()) {\r\n      // Don't change the warning text during a drag.\r\n      // Wait until the drag finishes.\r\n      this.warningTextDb.set(\r\n        id,\r\n        setTimeout(() => {\r\n          if (!this.isDeadOrDying()) {\r\n            this.warningTextDb.delete(id);\r\n            this.setWarningText(text, id);\r\n          }\r\n        }, 100),\r\n      );\r\n      return;\r\n    }\r\n    if (this.isInFlyout) {\r\n      text = null;\r\n    }\r\n\r\n    const icon = this.getIcon(WarningIcon.TYPE) as WarningIcon | undefined;\r\n    if (text) {\r\n      // Bubble up to add a warning on top-most collapsed block.\r\n      // TODO(#6020): This warning is never removed.\r\n      let parent = this.getSurroundParent();\r\n      let collapsedParent = null;\r\n      while (parent) {\r\n        if (parent.isCollapsed()) {\r\n          collapsedParent = parent;\r\n        }\r\n        parent = parent.getSurroundParent();\r\n      }\r\n      if (collapsedParent) {\r\n        collapsedParent.setWarningText(\r\n          Msg['COLLAPSED_WARNINGS_WARNING'],\r\n          BlockSvg.COLLAPSED_WARNING_ID,\r\n        );\r\n      }\r\n\r\n      if (icon) {\r\n        (icon as WarningIcon).addMessage(text, id);\r\n      } else {\r\n        this.addIcon(new WarningIcon(this).addMessage(text, id));\r\n      }\r\n    } else if (icon) {\r\n      // Dispose all warnings if no ID is given.\r\n      if (!id) {\r\n        this.removeIcon(WarningIcon.TYPE);\r\n      } else {\r\n        // Remove just this warning id's message.\r\n        icon.addMessage('', id);\r\n        // Then remove the entire icon if there is no longer any text.\r\n        if (!icon.getText()) this.removeIcon(WarningIcon.TYPE);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Give this block a mutator dialog.\r\n   *\r\n   * @param mutator A mutator dialog instance or null to remove.\r\n   */\r\n  override setMutator(mutator: MutatorIcon | null) {\r\n    this.removeIcon(MutatorIcon.TYPE);\r\n    if (mutator) this.addIcon(mutator);\r\n  }\r\n\r\n  override addIcon<T extends IIcon>(icon: T): T {\r\n    super.addIcon(icon);\r\n\r\n    if (icon instanceof WarningIcon) this.warning = icon;\r\n    if (icon instanceof MutatorIcon) this.mutator = icon;\r\n\r\n    if (this.rendered) {\r\n      icon.initView(this.createIconPointerDownListener(icon));\r\n      icon.applyColour();\r\n      icon.updateEditable();\r\n      this.queueRender();\r\n      renderManagement.triggerQueuedRenders();\r\n      this.bumpNeighbours();\r\n    }\r\n\r\n    return icon;\r\n  }\r\n\r\n  /**\r\n   * Creates a pointer down event listener for the icon to append to its\r\n   * root svg.\r\n   */\r\n  private createIconPointerDownListener(icon: IIcon) {\r\n    return (e: PointerEvent) => {\r\n      if (this.isDeadOrDying()) return;\r\n      const gesture = this.workspace.getGesture(e);\r\n      if (gesture) {\r\n        gesture.setStartIcon(icon);\r\n      }\r\n    };\r\n  }\r\n\r\n  override removeIcon(type: IconType<IIcon>): boolean {\r\n    const removed = super.removeIcon(type);\r\n\r\n    if (type.equals(WarningIcon.TYPE)) this.warning = null;\r\n    if (type.equals(MutatorIcon.TYPE)) this.mutator = null;\r\n\r\n    if (this.rendered) {\r\n      this.queueRender();\r\n      renderManagement.triggerQueuedRenders();\r\n      this.bumpNeighbours();\r\n    }\r\n    return removed;\r\n  }\r\n\r\n  /**\r\n   * Set whether the block is enabled or not.\r\n   *\r\n   * @param enabled True if enabled.\r\n   */\r\n  override setEnabled(enabled: boolean) {\r\n    if (this.isEnabled() !== enabled) {\r\n      super.setEnabled(enabled);\r\n      if (this.rendered && !this.getInheritedDisabled()) {\r\n        this.updateDisabled();\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set whether the block is highlighted or not.  Block highlighting is\r\n   * often used to visually mark blocks currently being executed.\r\n   *\r\n   * @param highlighted True if highlighted.\r\n   */\r\n  setHighlighted(highlighted: boolean) {\r\n    if (!this.rendered) {\r\n      return;\r\n    }\r\n    this.pathObject.updateHighlighted(highlighted);\r\n  }\r\n\r\n  /**\r\n   * Adds the visual \"select\" effect to the block, but does not actually select\r\n   * it or fire an event.\r\n   *\r\n   * @see BlockSvg#select\r\n   */\r\n  addSelect() {\r\n    this.pathObject.updateSelected(true);\r\n  }\r\n\r\n  /**\r\n   * Removes the visual \"select\" effect from the block, but does not actually\r\n   * unselect it or fire an event.\r\n   *\r\n   * @see BlockSvg#unselect\r\n   */\r\n  removeSelect() {\r\n    this.pathObject.updateSelected(false);\r\n  }\r\n\r\n  /**\r\n   * Update the cursor over this block by adding or removing a class.\r\n   *\r\n   * @param enable True if the delete cursor should be shown, false otherwise.\r\n   * @internal\r\n   */\r\n  setDeleteStyle(enable: boolean) {\r\n    this.pathObject.updateDraggingDelete(enable);\r\n  }\r\n\r\n  // Overrides of functions on Blockly.Block that take into account whether the\r\n  // block has been rendered.\r\n\r\n  /**\r\n   * Get the colour of a block.\r\n   *\r\n   * @returns #RRGGBB string.\r\n   */\r\n  override getColour(): string {\r\n    return this.style.colourPrimary;\r\n  }\r\n\r\n  /**\r\n   * Change the colour of a block.\r\n   *\r\n   * @param colour HSV hue value, or #RRGGBB string.\r\n   */\r\n  override setColour(colour: number | string) {\r\n    super.setColour(colour);\r\n    const styleObj = this.workspace\r\n      .getRenderer()\r\n      .getConstants()\r\n      .getBlockStyleForColour(this.colour_);\r\n\r\n    this.pathObject.setStyle(styleObj.style);\r\n    this.style = styleObj.style;\r\n    this.styleName_ = styleObj.name;\r\n\r\n    this.applyColour();\r\n  }\r\n\r\n  /**\r\n   * Set the style and colour values of a block.\r\n   *\r\n   * @param blockStyleName Name of the block style.\r\n   * @throws {Error} if the block style does not exist.\r\n   */\r\n  override setStyle(blockStyleName: string) {\r\n    const blockStyle = this.workspace\r\n      .getRenderer()\r\n      .getConstants()\r\n      .getBlockStyle(blockStyleName);\r\n    this.styleName_ = blockStyleName;\r\n\r\n    if (blockStyle) {\r\n      this.hat = blockStyle.hat;\r\n      this.pathObject.setStyle(blockStyle);\r\n      // Set colour to match Block.\r\n      this.colour_ = blockStyle.colourPrimary;\r\n      this.style = blockStyle;\r\n\r\n      this.applyColour();\r\n    } else {\r\n      throw Error('Invalid style name: ' + blockStyleName);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Move this block to the front of the visible workspace.\r\n   * <g> tags do not respect z-index so SVG renders them in the\r\n   * order that they are in the DOM.  By placing this block first within the\r\n   * block group's <g>, it will render on top of any other blocks.\r\n   *\r\n   * @param blockOnly: True to only move this block to the front without\r\n   *     adjusting its parents.\r\n   * @internal\r\n   */\r\n  bringToFront(blockOnly = false) {\r\n    /* eslint-disable-next-line @typescript-eslint/no-this-alias */\r\n    let block: this | null = this;\r\n    if (block.isDeadOrDying()) {\r\n      return;\r\n    }\r\n    do {\r\n      const root = block.getSvgRoot();\r\n      const parent = root.parentNode;\r\n      const childNodes = parent!.childNodes;\r\n      // Avoid moving the block if it's already at the bottom.\r\n      if (childNodes[childNodes.length - 1] !== root) {\r\n        parent!.appendChild(root);\r\n      }\r\n      if (blockOnly) break;\r\n      block = block.getParent();\r\n    } while (block);\r\n  }\r\n\r\n  /**\r\n   * Set whether this block can chain onto the bottom of another block.\r\n   *\r\n   * @param newBoolean True if there can be a previous statement.\r\n   * @param opt_check Statement type or list of statement types.  Null/undefined\r\n   *     if any type could be connected.\r\n   */\r\n  override setPreviousStatement(\r\n    newBoolean: boolean,\r\n    opt_check?: string | string[] | null,\r\n  ) {\r\n    super.setPreviousStatement(newBoolean, opt_check);\r\n\r\n    if (this.rendered) {\r\n      this.queueRender();\r\n      this.bumpNeighbours();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set whether another block can chain onto the bottom of this block.\r\n   *\r\n   * @param newBoolean True if there can be a next statement.\r\n   * @param opt_check Statement type or list of statement types.  Null/undefined\r\n   *     if any type could be connected.\r\n   */\r\n  override setNextStatement(\r\n    newBoolean: boolean,\r\n    opt_check?: string | string[] | null,\r\n  ) {\r\n    super.setNextStatement(newBoolean, opt_check);\r\n\r\n    if (this.rendered) {\r\n      this.queueRender();\r\n      this.bumpNeighbours();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set whether this block returns a value.\r\n   *\r\n   * @param newBoolean True if there is an output.\r\n   * @param opt_check Returned type or list of returned types.  Null or\r\n   *     undefined if any type could be returned (e.g. variable get).\r\n   */\r\n  override setOutput(\r\n    newBoolean: boolean,\r\n    opt_check?: string | string[] | null,\r\n  ) {\r\n    super.setOutput(newBoolean, opt_check);\r\n\r\n    if (this.rendered) {\r\n      this.queueRender();\r\n      this.bumpNeighbours();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set whether value inputs are arranged horizontally or vertically.\r\n   *\r\n   * @param newBoolean True if inputs are horizontal.\r\n   */\r\n  override setInputsInline(newBoolean: boolean) {\r\n    super.setInputsInline(newBoolean);\r\n\r\n    if (this.rendered) {\r\n      this.queueRender();\r\n      this.bumpNeighbours();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove an input from this block.\r\n   *\r\n   * @param name The name of the input.\r\n   * @param opt_quiet True to prevent error if input is not present.\r\n   * @returns True if operation succeeds, false if input is not present and\r\n   *     opt_quiet is true\r\n   * @throws {Error} if the input is not present and opt_quiet is not true.\r\n   */\r\n  override removeInput(name: string, opt_quiet?: boolean): boolean {\r\n    const removed = super.removeInput(name, opt_quiet);\r\n\r\n    if (this.rendered) {\r\n      this.queueRender();\r\n      // Removing an input will cause the block to change shape.\r\n      this.bumpNeighbours();\r\n    }\r\n\r\n    return removed;\r\n  }\r\n\r\n  /**\r\n   * Move a numbered input to a different location on this block.\r\n   *\r\n   * @param inputIndex Index of the input to move.\r\n   * @param refIndex Index of input that should be after the moved input.\r\n   */\r\n  override moveNumberedInputBefore(inputIndex: number, refIndex: number) {\r\n    super.moveNumberedInputBefore(inputIndex, refIndex);\r\n\r\n    if (this.rendered) {\r\n      this.queueRender();\r\n      // Moving an input will cause the block to change shape.\r\n      this.bumpNeighbours();\r\n    }\r\n  }\r\n\r\n  /** @override */\r\n  override appendInput(input: Input): Input {\r\n    super.appendInput(input);\r\n\r\n    if (this.rendered) {\r\n      this.queueRender();\r\n      // Adding an input will cause the block to change shape.\r\n      this.bumpNeighbours();\r\n    }\r\n    return input;\r\n  }\r\n\r\n  /**\r\n   * Sets whether this block's connections are tracked in the database or not.\r\n   *\r\n   * Used by the deserializer to be more efficient. Setting a connection's\r\n   * tracked_ value to false keeps it from adding itself to the db when it\r\n   * gets its first moveTo call, saving expensive ops for later.\r\n   *\r\n   * @param track If true, start tracking. If false, stop tracking.\r\n   * @internal\r\n   */\r\n  setConnectionTracking(track: boolean) {\r\n    if (this.previousConnection) {\r\n      this.previousConnection.setTracking(track);\r\n    }\r\n    if (this.outputConnection) {\r\n      this.outputConnection.setTracking(track);\r\n    }\r\n    if (this.nextConnection) {\r\n      this.nextConnection.setTracking(track);\r\n      const child = this.nextConnection.targetBlock();\r\n      if (child) {\r\n        child.setConnectionTracking(track);\r\n      }\r\n    }\r\n\r\n    if (this.collapsed_) {\r\n      // When track is true, we don't want to start tracking collapsed\r\n      // connections. When track is false, we're already not tracking\r\n      // collapsed connections, so no need to update.\r\n      return;\r\n    }\r\n\r\n    for (let i = 0; i < this.inputList.length; i++) {\r\n      const conn = this.inputList[i].connection as RenderedConnection;\r\n      if (conn) {\r\n        conn.setTracking(track);\r\n\r\n        // Pass tracking on down the chain.\r\n        const block = conn.targetBlock();\r\n        if (block) {\r\n          block.setConnectionTracking(track);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns connections originating from this block.\r\n   *\r\n   * @param all If true, return all connections even hidden ones.\r\n   *     Otherwise, for a non-rendered block return an empty list, and for a\r\n   *     collapsed block don't return inputs connections.\r\n   * @returns Array of connections.\r\n   * @internal\r\n   */\r\n  override getConnections_(all: boolean): RenderedConnection[] {\r\n    const myConnections = [];\r\n    if (all || this.rendered) {\r\n      if (this.outputConnection) {\r\n        myConnections.push(this.outputConnection);\r\n      }\r\n      if (this.previousConnection) {\r\n        myConnections.push(this.previousConnection);\r\n      }\r\n      if (this.nextConnection) {\r\n        myConnections.push(this.nextConnection);\r\n      }\r\n      if (all || !this.collapsed_) {\r\n        for (let i = 0, input; (input = this.inputList[i]); i++) {\r\n          if (input.connection) {\r\n            myConnections.push(input.connection as RenderedConnection);\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return myConnections;\r\n  }\r\n\r\n  /**\r\n   * Walks down a stack of blocks and finds the last next connection on the\r\n   * stack.\r\n   *\r\n   * @param ignoreShadows If true,the last connection on a non-shadow block will\r\n   *     be returned. If false, this will follow shadows to find the last\r\n   *     connection.\r\n   * @returns The last next connection on the stack, or null.\r\n   * @internal\r\n   */\r\n  override lastConnectionInStack(\r\n    ignoreShadows: boolean,\r\n  ): RenderedConnection | null {\r\n    return super.lastConnectionInStack(ignoreShadows) as RenderedConnection;\r\n  }\r\n\r\n  /**\r\n   * Find the connection on this block that corresponds to the given connection\r\n   * on the other block.\r\n   * Used to match connections between a block and its insertion marker.\r\n   *\r\n   * @param otherBlock The other block to match against.\r\n   * @param conn The other connection to match.\r\n   * @returns The matching connection on this block, or null.\r\n   * @internal\r\n   */\r\n  override getMatchingConnection(\r\n    otherBlock: Block,\r\n    conn: Connection,\r\n  ): RenderedConnection | null {\r\n    return super.getMatchingConnection(otherBlock, conn) as RenderedConnection;\r\n  }\r\n\r\n  /**\r\n   * Create a connection of the specified type.\r\n   *\r\n   * @param type The type of the connection to create.\r\n   * @returns A new connection of the specified type.\r\n   * @internal\r\n   */\r\n  override makeConnection_(type: ConnectionType): RenderedConnection {\r\n    return new RenderedConnection(this, type);\r\n  }\r\n\r\n  /**\r\n   * Return the next statement block directly connected to this block.\r\n   *\r\n   * @returns The next statement block or null.\r\n   */\r\n  override getNextBlock(): BlockSvg | null {\r\n    return super.getNextBlock() as BlockSvg;\r\n  }\r\n\r\n  /**\r\n   * Returns the block connected to the previous connection.\r\n   *\r\n   * @returns The previous statement block or null.\r\n   */\r\n  override getPreviousBlock(): BlockSvg | null {\r\n    return super.getPreviousBlock() as BlockSvg;\r\n  }\r\n\r\n  /**\r\n   * Bumps unconnected blocks out of alignment.\r\n   *\r\n   * Two blocks which aren't actually connected should not coincidentally line\r\n   * up on screen, because that creates confusion for end-users.\r\n   */\r\n  override bumpNeighbours() {\r\n    if (this.bumpNeighboursPid) return;\r\n    const group = eventUtils.getGroup();\r\n\r\n    this.bumpNeighboursPid = setTimeout(() => {\r\n      const oldGroup = eventUtils.getGroup();\r\n      eventUtils.setGroup(group);\r\n      this.getRootBlock().bumpNeighboursInternal();\r\n      eventUtils.setGroup(oldGroup);\r\n      this.bumpNeighboursPid = 0;\r\n    }, config.bumpDelay);\r\n  }\r\n\r\n  /**\r\n   * Bumps unconnected blocks out of alignment.\r\n   */\r\n  private bumpNeighboursInternal() {\r\n    const root = this.getRootBlock();\r\n    if (\r\n      this.isDeadOrDying() ||\r\n      this.workspace.isDragging() ||\r\n      root.isInFlyout\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    function neighbourIsInStack(neighbour: RenderedConnection) {\r\n      return neighbour.getSourceBlock().getRootBlock() === root;\r\n    }\r\n\r\n    for (const conn of this.getConnections_(false)) {\r\n      if (conn.isSuperior()) {\r\n        // Recurse down the block stack.\r\n        conn.targetBlock()?.bumpNeighboursInternal();\r\n      }\r\n\r\n      for (const neighbour of conn.neighbours(config.snapRadius)) {\r\n        // Don't bump away from things that are in our stack.\r\n        if (neighbourIsInStack(neighbour)) continue;\r\n        // If both connections are connected, that's fine.\r\n        if (conn.isConnected() && neighbour.isConnected()) continue;\r\n\r\n        // Always bump the inferior connection.\r\n        if (conn.isSuperior()) {\r\n          neighbour.bumpAwayFrom(conn);\r\n        } else {\r\n          conn.bumpAwayFrom(neighbour);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Schedule snapping to grid and bumping neighbours to occur after a brief\r\n   * delay.\r\n   *\r\n   * @internal\r\n   */\r\n  scheduleSnapAndBump() {\r\n    // Ensure that any snap and bump are part of this move's event group.\r\n    const group = eventUtils.getGroup();\r\n\r\n    setTimeout(() => {\r\n      eventUtils.setGroup(group);\r\n      this.snapToGrid();\r\n      eventUtils.setGroup(false);\r\n    }, config.bumpDelay / 2);\r\n\r\n    this.bumpNeighbours();\r\n  }\r\n\r\n  /**\r\n   * Position a block so that it doesn't move the target block when connected.\r\n   * The block to position is usually either the first block in a dragged stack\r\n   * or an insertion marker.\r\n   *\r\n   * @param sourceConnection The connection on the moving block's stack.\r\n   * @param originalOffsetToTarget The connection original offset to the target connection\r\n   * @param originalOffsetInBlock The connection original offset in its block\r\n   * @internal\r\n   */\r\n  positionNearConnection(\r\n    sourceConnection: RenderedConnection,\r\n    originalOffsetToTarget: {x: number; y: number},\r\n    originalOffsetInBlock: Coordinate,\r\n  ) {\r\n    // We only need to position the new block if it's before the existing one,\r\n    // otherwise its position is set by the previous block.\r\n    if (\r\n      sourceConnection.type === ConnectionType.NEXT_STATEMENT ||\r\n      sourceConnection.type === ConnectionType.INPUT_VALUE\r\n    ) {\r\n      // First move the block to match the orginal target connection position\r\n      let dx = originalOffsetToTarget.x;\r\n      let dy = originalOffsetToTarget.y;\r\n      // Then adjust its position according to the connection resize\r\n      dx += originalOffsetInBlock.x - sourceConnection.getOffsetInBlock().x;\r\n      dy += originalOffsetInBlock.y - sourceConnection.getOffsetInBlock().y;\r\n\r\n      this.moveBy(dx, dy);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Find all the blocks that are directly nested inside this one.\r\n   * Includes value and statement inputs, as well as any following statement.\r\n   * Excludes any connection on an output tab or any preceding statement.\r\n   * Blocks are optionally sorted by position; top to bottom.\r\n   *\r\n   * @param ordered Sort the list if true.\r\n   * @returns Array of blocks.\r\n   */\r\n  override getChildren(ordered: boolean): BlockSvg[] {\r\n    return super.getChildren(ordered) as BlockSvg[];\r\n  }\r\n\r\n  /**\r\n   * Triggers a rerender after a delay to allow for batching.\r\n   *\r\n   * @returns A promise that resolves after the currently queued renders have\r\n   *     been completed. Used for triggering other behavior that relies on\r\n   *     updated size/position location for the block.\r\n   * @internal\r\n   */\r\n  queueRender(): Promise<void> {\r\n    return renderManagement.queueRender(this);\r\n  }\r\n\r\n  /**\r\n   * Immediately lays out and reflows a block based on its contents and\r\n   * settings.\r\n   */\r\n  render() {\r\n    this.queueRender();\r\n    renderManagement.triggerQueuedRenders();\r\n  }\r\n\r\n  /**\r\n   * Renders this block in a way that's compatible with the more efficient\r\n   * render management system.\r\n   *\r\n   * @internal\r\n   */\r\n  renderEfficiently() {\r\n    this.rendered = true;\r\n    dom.startTextWidthCache();\r\n\r\n    if (this.isCollapsed()) {\r\n      this.updateCollapsed_();\r\n    }\r\n\r\n    if (!this.isEnabled()) {\r\n      this.updateDisabled();\r\n    }\r\n\r\n    this.workspace.getRenderer().render(this);\r\n    this.tightenChildrenEfficiently();\r\n\r\n    dom.stopTextWidthCache();\r\n    this.updateMarkers_();\r\n  }\r\n\r\n  /**\r\n   * Tightens all children of this block so they are snuggly rendered against\r\n   * their parent connections.\r\n   *\r\n   * Does not update connection locations, so that they can be updated more\r\n   * efficiently by the render management system.\r\n   *\r\n   * @internal\r\n   */\r\n  tightenChildrenEfficiently() {\r\n    for (const input of this.inputList) {\r\n      const conn = input.connection as RenderedConnection;\r\n      if (conn) conn.tightenEfficiently();\r\n    }\r\n    if (this.nextConnection) this.nextConnection.tightenEfficiently();\r\n  }\r\n\r\n  /** Redraw any attached marker or cursor svgs if needed. */\r\n  protected updateMarkers_() {\r\n    if (this.workspace.keyboardAccessibilityMode && this.pathObject.cursorSvg) {\r\n      this.workspace.getCursor()!.draw();\r\n    }\r\n    if (this.workspace.keyboardAccessibilityMode && this.pathObject.markerSvg) {\r\n      // TODO(#4592): Update all markers on the block.\r\n      this.workspace.getMarker(MarkerManager.LOCAL_MARKER)!.draw();\r\n    }\r\n    for (const input of this.inputList) {\r\n      for (const field of input.fieldRow) {\r\n        field.updateMarkers_();\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add the cursor SVG to this block's SVG group.\r\n   *\r\n   * @param cursorSvg The SVG root of the cursor to be added to the block SVG\r\n   *     group.\r\n   * @internal\r\n   */\r\n  setCursorSvg(cursorSvg: SVGElement) {\r\n    this.pathObject.setCursorSvg(cursorSvg);\r\n  }\r\n\r\n  /**\r\n   * Add the marker SVG to this block's SVG group.\r\n   *\r\n   * @param markerSvg The SVG root of the marker to be added to the block SVG\r\n   *     group.\r\n   * @internal\r\n   */\r\n  setMarkerSvg(markerSvg: SVGElement) {\r\n    this.pathObject.setMarkerSvg(markerSvg);\r\n  }\r\n\r\n  /**\r\n   * Returns a bounding box describing the dimensions of this block\r\n   * and any blocks stacked below it.\r\n   *\r\n   * @returns Object with height and width properties in workspace units.\r\n   * @internal\r\n   */\r\n  getHeightWidth(): {height: number; width: number} {\r\n    let height = this.height;\r\n    let width = this.width;\r\n    // Recursively add size of subsequent blocks.\r\n    const nextBlock = this.getNextBlock();\r\n    if (nextBlock) {\r\n      const nextHeightWidth = nextBlock.getHeightWidth();\r\n      const tabHeight = this.workspace\r\n        .getRenderer()\r\n        .getConstants().NOTCH_HEIGHT;\r\n      height += nextHeightWidth.height - tabHeight;\r\n      width = Math.max(width, nextHeightWidth.width);\r\n    }\r\n    return {height, width};\r\n  }\r\n\r\n  /**\r\n   * Visual effect to show that if the dragging block is dropped, this block\r\n   * will be replaced.  If a shadow block, it will disappear.  Otherwise it will\r\n   * bump.\r\n   *\r\n   * @param add True if highlighting should be added.\r\n   * @internal\r\n   */\r\n  fadeForReplacement(add: boolean) {\r\n    // TODO (7204): Remove these internal methods.\r\n    (this.pathObject as AnyDuringMigration).updateReplacementFade(add);\r\n  }\r\n\r\n  /**\r\n   * Visual effect to show that if the dragging block is dropped it will connect\r\n   * to this input.\r\n   *\r\n   * @param conn The connection on the input to highlight.\r\n   * @param add True if highlighting should be added.\r\n   * @internal\r\n   */\r\n  highlightShapeForInput(conn: RenderedConnection, add: boolean) {\r\n    // TODO (7204): Remove these internal methods.\r\n    (this.pathObject as AnyDuringMigration).updateShapeForInputHighlight(\r\n      conn,\r\n      add,\r\n    );\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * The abstract class for a component with custom behaviour when a\r\n * block or bubble is dragged over or dropped on top of it.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.DragTarget\r\n\r\nimport type {IDragTarget} from './interfaces/i_drag_target.js';\r\nimport type {IDraggable} from './interfaces/i_draggable.js';\r\nimport type {Rect} from './utils/rect.js';\r\n\r\n/**\r\n * Abstract class for a component with custom behaviour when a block or bubble\r\n * is dragged over or dropped on top of it.\r\n */\r\nexport class DragTarget implements IDragTarget {\r\n  /**\r\n   * The unique id for this component that is used to register with the\r\n   * ComponentManager.\r\n   */\r\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\r\n  id!: string;\r\n\r\n  /**\r\n   * Constructor for DragTarget. It exists to add the id property and should not\r\n   * be called directly, only by a subclass.\r\n   */\r\n  constructor() {}\r\n\r\n  /**\r\n   * Handles when a cursor with a block or bubble enters this drag target.\r\n   *\r\n   * @param _dragElement The block or bubble currently being dragged.\r\n   */\r\n  onDragEnter(_dragElement: IDraggable) {}\r\n  // no-op\r\n\r\n  /**\r\n   * Handles when a cursor with a block or bubble is dragged over this drag\r\n   * target.\r\n   *\r\n   * @param _dragElement The block or bubble currently being dragged.\r\n   */\r\n  onDragOver(_dragElement: IDraggable) {}\r\n  // no-op\r\n\r\n  /**\r\n   * Handles when a cursor with a block or bubble exits this drag target.\r\n   *\r\n   * @param _dragElement The block or bubble currently being dragged.\r\n   */\r\n  onDragExit(_dragElement: IDraggable) {}\r\n  // no-op\r\n  /**\r\n   * Handles when a block or bubble is dropped on this component.\r\n   * Should not handle delete here.\r\n   *\r\n   * @param _dragElement The block or bubble currently being dragged.\r\n   */\r\n  onDrop(_dragElement: IDraggable) {}\r\n  // no-op\r\n\r\n  /**\r\n   * Returns the bounding rectangle of the drag target area in pixel units\r\n   * relative to the Blockly injection div.\r\n   *\r\n   * @returns The component's bounding box. Null if drag target area should be\r\n   *     ignored.\r\n   */\r\n  getClientRect(): Rect | null {\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Returns whether the provided block or bubble should not be moved after\r\n   * being dropped on this component. If true, the element will return to where\r\n   * it was when the drag started.\r\n   *\r\n   * @param _dragElement The block or bubble currently being dragged.\r\n   * @returns Whether the block or bubble provided should be returned to drag\r\n   *     start.\r\n   */\r\n  shouldPreventMove(_dragElement: IDraggable): boolean {\r\n    return false;\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * The abstract class for a component that can delete a block or\r\n * bubble that is dropped on top of it.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.DeleteArea\r\n\r\nimport {BlockSvg} from './block_svg.js';\r\nimport {DragTarget} from './drag_target.js';\r\nimport type {IDeleteArea} from './interfaces/i_delete_area.js';\r\nimport type {IDraggable} from './interfaces/i_draggable.js';\r\n\r\n/**\r\n * Abstract class for a component that can delete a block or bubble that is\r\n * dropped on top of it.\r\n */\r\nexport class DeleteArea extends DragTarget implements IDeleteArea {\r\n  /**\r\n   * Whether the last block or bubble dragged over this delete area would be\r\n   * deleted if dropped on this component.\r\n   * This property is not updated after the block or bubble is deleted.\r\n   */\r\n  protected wouldDelete_ = false;\r\n\r\n  /**\r\n   * The unique id for this component that is used to register with the\r\n   * ComponentManager.\r\n   */\r\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\r\n  override id!: string;\r\n\r\n  /**\r\n   * Constructor for DeleteArea. Should not be called directly, only by a\r\n   * subclass.\r\n   */\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  /**\r\n   * Returns whether the provided block or bubble would be deleted if dropped on\r\n   * this area.\r\n   * This method should check if the element is deletable and is always called\r\n   * before onDragEnter/onDragOver/onDragExit.\r\n   *\r\n   * @param element The block or bubble currently being dragged.\r\n   * @param couldConnect Whether the element could could connect to another.\r\n   * @returns Whether the element provided would be deleted if dropped on this\r\n   *     area.\r\n   */\r\n  wouldDelete(element: IDraggable, couldConnect: boolean): boolean {\r\n    if (element instanceof BlockSvg) {\r\n      const block = element;\r\n      const couldDeleteBlock = !block.getParent() && block.isDeletable();\r\n      this.updateWouldDelete_(couldDeleteBlock && !couldConnect);\r\n    } else {\r\n      this.updateWouldDelete_(element.isDeletable());\r\n    }\r\n    return this.wouldDelete_;\r\n  }\r\n\r\n  /**\r\n   * Updates the internal wouldDelete_ state.\r\n   *\r\n   * @param wouldDelete The new value for the wouldDelete state.\r\n   */\r\n  protected updateWouldDelete_(wouldDelete: boolean) {\r\n    this.wouldDelete_ = wouldDelete;\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2011 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Object representing a trash can icon.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.Trashcan\r\n\r\n// Unused import preserved for side-effects. Remove if unneeded.\r\nimport './events/events_trashcan_open.js';\r\n\r\nimport type {BlocklyOptions} from './blockly_options.js';\r\nimport * as browserEvents from './browser_events.js';\r\nimport {ComponentManager} from './component_manager.js';\r\nimport {DeleteArea} from './delete_area.js';\r\nimport type {Abstract} from './events/events_abstract.js';\r\nimport type {BlockDelete} from './events/events_block_delete.js';\r\nimport * as eventUtils from './events/utils.js';\r\nimport type {IAutoHideable} from './interfaces/i_autohideable.js';\r\nimport type {IDraggable} from './interfaces/i_draggable.js';\r\nimport type {IFlyout} from './interfaces/i_flyout.js';\r\nimport type {IPositionable} from './interfaces/i_positionable.js';\r\nimport type {UiMetrics} from './metrics_manager.js';\r\nimport {Options} from './options.js';\r\nimport * as uiPosition from './positionable_helpers.js';\r\nimport * as registry from './registry.js';\r\nimport type * as blocks from './serialization/blocks.js';\r\nimport {SPRITE} from './sprites.js';\r\nimport * as dom from './utils/dom.js';\r\nimport {Rect} from './utils/rect.js';\r\nimport {Size} from './utils/size.js';\r\nimport {Svg} from './utils/svg.js';\r\nimport {BlockInfo} from './utils/toolbox.js';\r\nimport * as toolbox from './utils/toolbox.js';\r\nimport type {WorkspaceSvg} from './workspace_svg.js';\r\n\r\n/**\r\n * Class for a trash can.\r\n */\r\nexport class Trashcan\r\n  extends DeleteArea\r\n  implements IAutoHideable, IPositionable\r\n{\r\n  /**\r\n   * The unique id for this component that is used to register with the\r\n   * ComponentManager.\r\n   */\r\n  override id = 'trashcan';\r\n\r\n  /**\r\n   * A list of JSON (stored as strings) representing blocks in the trashcan.\r\n   */\r\n  private readonly contents: string[] = [];\r\n\r\n  /**\r\n   * The trashcan flyout.\r\n   *\r\n   * @internal\r\n   */\r\n  flyout: IFlyout | null = null;\r\n\r\n  /** Current open/close state of the lid. */\r\n  isLidOpen = false;\r\n\r\n  /**\r\n   * The minimum openness of the lid. Used to indicate if the trashcan\r\n   * contains blocks.\r\n   */\r\n  private minOpenness = 0;\r\n\r\n  /** The SVG group containing the trash can. */\r\n  private svgGroup: SVGElement | null = null;\r\n\r\n  /** The SVG image element of the trash can lid. */\r\n  private svgLid: SVGElement | null = null;\r\n\r\n  /** Task ID of opening/closing animation. */\r\n  private lidTask: ReturnType<typeof setTimeout> | null = null;\r\n\r\n  /** Current state of lid opening (0.0 = closed, 1.0 = open). */\r\n  private lidOpen = 0;\r\n\r\n  /** Left coordinate of the trash can. */\r\n  private left = 0;\r\n\r\n  /** Top coordinate of the trash can. */\r\n  private top = 0;\r\n\r\n  /** Whether this trash can has been initialized. */\r\n  private initialized = false;\r\n\r\n  /** @param workspace The workspace to sit in. */\r\n  constructor(private workspace: WorkspaceSvg) {\r\n    super();\r\n\r\n    if (this.workspace.options.maxTrashcanContents <= 0) {\r\n      return;\r\n    }\r\n\r\n    // Create flyout options.\r\n    const flyoutWorkspaceOptions = new Options({\r\n      'scrollbars': true,\r\n      'parentWorkspace': this.workspace,\r\n      'rtl': this.workspace.RTL,\r\n      'oneBasedIndex': this.workspace.options.oneBasedIndex,\r\n      'renderer': this.workspace.options.renderer,\r\n      'rendererOverrides': this.workspace.options.rendererOverrides,\r\n      'move': {\r\n        'scrollbars': true,\r\n      },\r\n    } as BlocklyOptions);\r\n    // Create vertical or horizontal flyout.\r\n    if (this.workspace.horizontalLayout) {\r\n      flyoutWorkspaceOptions.toolboxPosition =\r\n        this.workspace.toolboxPosition === toolbox.Position.TOP\r\n          ? toolbox.Position.BOTTOM\r\n          : toolbox.Position.TOP;\r\n      const HorizontalFlyout = registry.getClassFromOptions(\r\n        registry.Type.FLYOUTS_HORIZONTAL_TOOLBOX,\r\n        this.workspace.options,\r\n        true,\r\n      );\r\n      this.flyout = new HorizontalFlyout!(flyoutWorkspaceOptions);\r\n    } else {\r\n      flyoutWorkspaceOptions.toolboxPosition =\r\n        this.workspace.toolboxPosition === toolbox.Position.RIGHT\r\n          ? toolbox.Position.LEFT\r\n          : toolbox.Position.RIGHT;\r\n      const VerticalFlyout = registry.getClassFromOptions(\r\n        registry.Type.FLYOUTS_VERTICAL_TOOLBOX,\r\n        this.workspace.options,\r\n        true,\r\n      );\r\n      this.flyout = new VerticalFlyout!(flyoutWorkspaceOptions);\r\n    }\r\n    this.workspace.addChangeListener(this.onDelete.bind(this));\r\n  }\r\n\r\n  /**\r\n   * Create the trash can elements.\r\n   *\r\n   * @returns The trash can's SVG group.\r\n   */\r\n  createDom(): SVGElement {\r\n    /* Here's the markup that will be generated:\r\n        <g class=\"blocklyTrash\">\r\n          <clippath id=\"blocklyTrashBodyClipPath837493\">\r\n            <rect width=\"47\" height=\"45\" y=\"15\"></rect>\r\n          </clippath>\r\n          <image width=\"64\" height=\"92\" y=\"-32\" xlink:href=\"media/sprites.png\"\r\n              clip-path=\"url(#blocklyTrashBodyClipPath837493)\"></image>\r\n          <clippath id=\"blocklyTrashLidClipPath837493\">\r\n            <rect width=\"47\" height=\"15\"></rect>\r\n          </clippath>\r\n          <image width=\"84\" height=\"92\" y=\"-32\" xlink:href=\"media/sprites.png\"\r\n              clip-path=\"url(#blocklyTrashLidClipPath837493)\"></image>\r\n        </g>\r\n        */\r\n    this.svgGroup = dom.createSvgElement(Svg.G, {'class': 'blocklyTrash'});\r\n    let clip;\r\n    const rnd = String(Math.random()).substring(2);\r\n    clip = dom.createSvgElement(\r\n      Svg.CLIPPATH,\r\n      {'id': 'blocklyTrashBodyClipPath' + rnd},\r\n      this.svgGroup,\r\n    );\r\n    dom.createSvgElement(\r\n      Svg.RECT,\r\n      {'width': WIDTH, 'height': BODY_HEIGHT, 'y': LID_HEIGHT},\r\n      clip,\r\n    );\r\n    const body = dom.createSvgElement(\r\n      Svg.IMAGE,\r\n      {\r\n        'width': SPRITE.width,\r\n        'x': -SPRITE_LEFT,\r\n        'height': SPRITE.height,\r\n        'y': -SPRITE_TOP,\r\n        'clip-path': 'url(#blocklyTrashBodyClipPath' + rnd + ')',\r\n      },\r\n      this.svgGroup,\r\n    );\r\n    body.setAttributeNS(\r\n      dom.XLINK_NS,\r\n      'xlink:href',\r\n      this.workspace.options.pathToMedia + SPRITE.url,\r\n    );\r\n\r\n    clip = dom.createSvgElement(\r\n      Svg.CLIPPATH,\r\n      {'id': 'blocklyTrashLidClipPath' + rnd},\r\n      this.svgGroup,\r\n    );\r\n    dom.createSvgElement(\r\n      Svg.RECT,\r\n      {'width': WIDTH, 'height': LID_HEIGHT},\r\n      clip,\r\n    );\r\n    this.svgLid = dom.createSvgElement(\r\n      Svg.IMAGE,\r\n      {\r\n        'width': SPRITE.width,\r\n        'x': -SPRITE_LEFT,\r\n        'height': SPRITE.height,\r\n        'y': -SPRITE_TOP,\r\n        'clip-path': 'url(#blocklyTrashLidClipPath' + rnd + ')',\r\n      },\r\n      this.svgGroup,\r\n    );\r\n    this.svgLid.setAttributeNS(\r\n      dom.XLINK_NS,\r\n      'xlink:href',\r\n      this.workspace.options.pathToMedia + SPRITE.url,\r\n    );\r\n\r\n    // bindEventWithChecks_ quashes events too aggressively. See:\r\n    // https://groups.google.com/forum/#!topic/blockly/QF4yB9Wx00s\r\n    // Using bindEventWithChecks_ for blocking mousedown causes issue in mobile.\r\n    // See #4303\r\n    browserEvents.bind(\r\n      this.svgGroup,\r\n      'pointerdown',\r\n      this,\r\n      this.blockMouseDownWhenOpenable,\r\n    );\r\n    browserEvents.bind(this.svgGroup, 'pointerup', this, this.click);\r\n    // Bind to body instead of this.svgGroup so that we don't get lid jitters\r\n    browserEvents.bind(body, 'pointerover', this, this.mouseOver);\r\n    browserEvents.bind(body, 'pointerout', this, this.mouseOut);\r\n    this.animateLid();\r\n    return this.svgGroup;\r\n  }\r\n\r\n  /** Initializes the trash can. */\r\n  init() {\r\n    if (this.workspace.options.maxTrashcanContents > 0) {\r\n      dom.insertAfter(\r\n        this.flyout!.createDom(Svg.SVG)!,\r\n        this.workspace.getParentSvg(),\r\n      );\r\n      this.flyout!.init(this.workspace);\r\n    }\r\n    this.workspace.getComponentManager().addComponent({\r\n      component: this,\r\n      weight: 1,\r\n      capabilities: [\r\n        ComponentManager.Capability.AUTOHIDEABLE,\r\n        ComponentManager.Capability.DELETE_AREA,\r\n        ComponentManager.Capability.DRAG_TARGET,\r\n        ComponentManager.Capability.POSITIONABLE,\r\n      ],\r\n    });\r\n    this.initialized = true;\r\n    this.setLidOpen(false);\r\n  }\r\n\r\n  /**\r\n   * Dispose of this trash can.\r\n   * Unlink from all DOM elements to prevent memory leaks.\r\n   */\r\n  dispose() {\r\n    this.workspace.getComponentManager().removeComponent('trashcan');\r\n    if (this.svgGroup) {\r\n      dom.removeNode(this.svgGroup);\r\n    }\r\n    if (this.lidTask) {\r\n      clearTimeout(this.lidTask);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Whether the trashcan has contents.\r\n   *\r\n   * @returns True if the trashcan has contents.\r\n   */\r\n  private hasContents(): boolean {\r\n    return !!this.contents.length;\r\n  }\r\n\r\n  /**\r\n   * Returns true if the trashcan contents-flyout is currently open.\r\n   *\r\n   * @returns True if the trashcan contents-flyout is currently open.\r\n   */\r\n  contentsIsOpen(): boolean {\r\n    return !!this.flyout && this.flyout.isVisible();\r\n  }\r\n\r\n  /** Opens the trashcan flyout. */\r\n  openFlyout() {\r\n    if (this.contentsIsOpen()) {\r\n      return;\r\n    }\r\n    const contents = this.contents.map(function (string) {\r\n      return JSON.parse(string);\r\n    });\r\n    // Trashcans with lots of blocks can take a second to render.\r\n    const blocklyStyle = this.workspace.getParentSvg().style;\r\n    blocklyStyle.cursor = 'wait';\r\n    setTimeout(() => {\r\n      this.flyout?.show(contents);\r\n      blocklyStyle.cursor = '';\r\n      this.workspace.scrollbar?.setVisible(false);\r\n    }, 10);\r\n    this.fireUiEvent(true);\r\n  }\r\n\r\n  /** Closes the trashcan flyout. */\r\n  closeFlyout() {\r\n    if (!this.contentsIsOpen()) {\r\n      return;\r\n    }\r\n    this.flyout?.hide();\r\n    this.workspace.scrollbar?.setVisible(true);\r\n    this.fireUiEvent(false);\r\n    this.workspace.recordDragTargets();\r\n  }\r\n\r\n  /**\r\n   * Hides the component. Called in WorkspaceSvg.hideChaff.\r\n   *\r\n   * @param onlyClosePopups Whether only popups should be closed.\r\n   *     Flyouts should not be closed if this is true.\r\n   */\r\n  autoHide(onlyClosePopups: boolean) {\r\n    // For now the trashcan flyout always autocloses because it overlays the\r\n    // trashcan UI (no trashcan to click to close it).\r\n    if (!onlyClosePopups && this.flyout) {\r\n      this.closeFlyout();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Empties the trashcan's contents. If the contents-flyout is currently open\r\n   * it will be closed.\r\n   */\r\n  emptyContents() {\r\n    if (!this.hasContents()) {\r\n      return;\r\n    }\r\n    this.contents.length = 0;\r\n    this.setMinOpenness(0);\r\n    this.closeFlyout();\r\n  }\r\n\r\n  /**\r\n   * Positions the trashcan.\r\n   * It is positioned in the opposite corner to the corner the\r\n   * categories/toolbox starts at.\r\n   *\r\n   * @param metrics The workspace metrics.\r\n   * @param savedPositions List of rectangles that are already on the workspace.\r\n   */\r\n  position(metrics: UiMetrics, savedPositions: Rect[]) {\r\n    // Not yet initialized.\r\n    if (!this.initialized) {\r\n      return;\r\n    }\r\n\r\n    const cornerPosition = uiPosition.getCornerOppositeToolbox(\r\n      this.workspace,\r\n      metrics,\r\n    );\r\n\r\n    const height = BODY_HEIGHT + LID_HEIGHT;\r\n    const startRect = uiPosition.getStartPositionRect(\r\n      cornerPosition,\r\n      new Size(WIDTH, height),\r\n      MARGIN_HORIZONTAL,\r\n      MARGIN_VERTICAL,\r\n      metrics,\r\n      this.workspace,\r\n    );\r\n\r\n    const verticalPosition = cornerPosition.vertical;\r\n    const bumpDirection =\r\n      verticalPosition === uiPosition.verticalPosition.TOP\r\n        ? uiPosition.bumpDirection.DOWN\r\n        : uiPosition.bumpDirection.UP;\r\n    const positionRect = uiPosition.bumpPositionRect(\r\n      startRect,\r\n      MARGIN_VERTICAL,\r\n      bumpDirection,\r\n      savedPositions,\r\n    );\r\n\r\n    this.top = positionRect.top;\r\n    this.left = positionRect.left;\r\n    this.svgGroup?.setAttribute(\r\n      'transform',\r\n      'translate(' + this.left + ',' + this.top + ')',\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Returns the bounding rectangle of the UI element in pixel units relative to\r\n   * the Blockly injection div.\r\n   *\r\n   * @returns The UI elements's bounding box. Null if bounding box should be\r\n   *     ignored by other UI elements.\r\n   */\r\n  getBoundingRectangle(): Rect | null {\r\n    const bottom = this.top + BODY_HEIGHT + LID_HEIGHT;\r\n    const right = this.left + WIDTH;\r\n    return new Rect(this.top, bottom, this.left, right);\r\n  }\r\n\r\n  /**\r\n   * Returns the bounding rectangle of the drag target area in pixel units\r\n   * relative to viewport.\r\n   *\r\n   * @returns The component's bounding box. Null if drag target area should be\r\n   *     ignored.\r\n   */\r\n  override getClientRect(): Rect | null {\r\n    if (!this.svgGroup) {\r\n      return null;\r\n    }\r\n\r\n    const trashRect = this.svgGroup.getBoundingClientRect();\r\n    const top = trashRect.top + SPRITE_TOP - MARGIN_HOTSPOT;\r\n    const bottom = top + LID_HEIGHT + BODY_HEIGHT + 2 * MARGIN_HOTSPOT;\r\n    const left = trashRect.left + SPRITE_LEFT - MARGIN_HOTSPOT;\r\n    const right = left + WIDTH + 2 * MARGIN_HOTSPOT;\r\n    return new Rect(top, bottom, left, right);\r\n  }\r\n\r\n  /**\r\n   * Handles when a cursor with a block or bubble is dragged over this drag\r\n   * target.\r\n   *\r\n   * @param _dragElement The block or bubble currently being dragged.\r\n   */\r\n  override onDragOver(_dragElement: IDraggable) {\r\n    this.setLidOpen(this.wouldDelete_);\r\n  }\r\n\r\n  /**\r\n   * Handles when a cursor with a block or bubble exits this drag target.\r\n   *\r\n   * @param _dragElement The block or bubble currently being dragged.\r\n   */\r\n  override onDragExit(_dragElement: IDraggable) {\r\n    this.setLidOpen(false);\r\n  }\r\n\r\n  /**\r\n   * Handles when a block or bubble is dropped on this component.\r\n   * Should not handle delete here.\r\n   *\r\n   * @param _dragElement The block or bubble currently being dragged.\r\n   */\r\n  override onDrop(_dragElement: IDraggable) {\r\n    setTimeout(this.setLidOpen.bind(this, false), 100);\r\n  }\r\n\r\n  /**\r\n   * Flip the lid open or shut.\r\n   *\r\n   * @param state True if open.\r\n   * @internal\r\n   */\r\n  setLidOpen(state: boolean) {\r\n    if (this.isLidOpen === state) {\r\n      return;\r\n    }\r\n    if (this.lidTask) {\r\n      clearTimeout(this.lidTask);\r\n    }\r\n    this.isLidOpen = state;\r\n    this.animateLid();\r\n  }\r\n\r\n  /** Rotate the lid open or closed by one step.  Then wait and recurse. */\r\n  private animateLid() {\r\n    const frames = ANIMATION_FRAMES;\r\n\r\n    const delta = 1 / (frames + 1);\r\n    this.lidOpen += this.isLidOpen ? delta : -delta;\r\n    this.lidOpen = Math.min(Math.max(this.lidOpen, this.minOpenness), 1);\r\n\r\n    this.setLidAngle(this.lidOpen * MAX_LID_ANGLE);\r\n\r\n    // Linear interpolation between min and max.\r\n    const opacity = OPACITY_MIN + this.lidOpen * (OPACITY_MAX - OPACITY_MIN);\r\n    if (this.svgGroup) {\r\n      this.svgGroup.style.opacity = `${opacity}`;\r\n    }\r\n\r\n    if (this.lidOpen > this.minOpenness && this.lidOpen < 1) {\r\n      this.lidTask = setTimeout(\r\n        this.animateLid.bind(this),\r\n        ANIMATION_LENGTH / frames,\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set the angle of the trashcan's lid.\r\n   *\r\n   * @param lidAngle The angle at which to set the lid.\r\n   */\r\n  private setLidAngle(lidAngle: number) {\r\n    const openAtRight =\r\n      this.workspace.toolboxPosition === toolbox.Position.RIGHT ||\r\n      (this.workspace.horizontalLayout && this.workspace.RTL);\r\n    this.svgLid?.setAttribute(\r\n      'transform',\r\n      'rotate(' +\r\n        (openAtRight ? -lidAngle : lidAngle) +\r\n        ',' +\r\n        (openAtRight ? 4 : WIDTH - 4) +\r\n        ',' +\r\n        (LID_HEIGHT - 2) +\r\n        ')',\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Sets the minimum openness of the trashcan lid. If the lid is currently\r\n   * closed, this will update lid's position.\r\n   *\r\n   * @param newMin The new minimum openness of the lid. Should be between 0\r\n   *     and 1.\r\n   */\r\n  private setMinOpenness(newMin: number) {\r\n    this.minOpenness = newMin;\r\n    if (!this.isLidOpen) {\r\n      this.setLidAngle(newMin * MAX_LID_ANGLE);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Flip the lid shut.\r\n   * Called externally after a drag.\r\n   */\r\n  closeLid() {\r\n    this.setLidOpen(false);\r\n  }\r\n\r\n  /** Inspect the contents of the trash. */\r\n  click() {\r\n    if (!this.hasContents() || this.workspace.isDragging()) {\r\n      return;\r\n    }\r\n    this.openFlyout();\r\n  }\r\n\r\n  /**\r\n   * Fires a UI event for trashcan flyout open or close.\r\n   *\r\n   * @param trashcanOpen Whether the flyout is opening.\r\n   */\r\n  private fireUiEvent(trashcanOpen: boolean) {\r\n    const uiEvent = new (eventUtils.get(eventUtils.TRASHCAN_OPEN))(\r\n      trashcanOpen,\r\n      this.workspace.id,\r\n    );\r\n    eventUtils.fire(uiEvent);\r\n  }\r\n\r\n  /**\r\n   * Prevents a workspace scroll and click event if the trashcan has blocks.\r\n   *\r\n   * @param e A mouse down event.\r\n   */\r\n  private blockMouseDownWhenOpenable(e: PointerEvent) {\r\n    if (!this.contentsIsOpen() && this.hasContents()) {\r\n      // Don't start a workspace scroll.\r\n      e.stopPropagation();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Indicate that the trashcan can be clicked (by opening it) if it has blocks.\r\n   */\r\n  private mouseOver() {\r\n    if (this.hasContents()) {\r\n      this.setLidOpen(true);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Close the lid of the trashcan if it was open (Vis. it was indicating it had\r\n   *    blocks).\r\n   */\r\n  private mouseOut() {\r\n    // No need to do a .hasBlocks check here because if it doesn't the trashcan\r\n    // won't be open in the first place, and setOpen won't run.\r\n    this.setLidOpen(false);\r\n  }\r\n\r\n  /**\r\n   * Handle a BLOCK_DELETE event. Adds deleted blocks oldXml to the content\r\n   * array.\r\n   *\r\n   * @param event Workspace event.\r\n   */\r\n  private onDelete(event: Abstract) {\r\n    if (\r\n      this.workspace.options.maxTrashcanContents <= 0 ||\r\n      event.type !== eventUtils.BLOCK_DELETE\r\n    ) {\r\n      return;\r\n    }\r\n    const deleteEvent = event as BlockDelete;\r\n    if (event.type === eventUtils.BLOCK_DELETE && !deleteEvent.wasShadow) {\r\n      if (!deleteEvent.oldJson) {\r\n        throw new Error('Encountered a delete event without proper oldJson');\r\n      }\r\n      const cleanedJson = JSON.stringify(\r\n        this.cleanBlockJson(deleteEvent.oldJson),\r\n      );\r\n      if (this.contents.indexOf(cleanedJson) !== -1) {\r\n        return;\r\n      }\r\n      this.contents.unshift(cleanedJson);\r\n      while (\r\n        this.contents.length > this.workspace.options.maxTrashcanContents\r\n      ) {\r\n        this.contents.pop();\r\n      }\r\n\r\n      this.setMinOpenness(HAS_BLOCKS_LID_ANGLE);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Converts JSON representing a block into text that can be stored in the\r\n   * content array.\r\n   *\r\n   * @param json A JSON representation of a block's state.\r\n   * @returns A BlockInfo object corresponding to the JSON, cleaned of all\r\n   *     unnecessary attributes.\r\n   */\r\n  private cleanBlockJson(json: blocks.State): BlockInfo {\r\n    // Create a deep copy.\r\n    json = JSON.parse(JSON.stringify(json)) as blocks.State;\r\n\r\n    /**\r\n     * Reshape JSON into a nicer format.\r\n     *\r\n     * @param json The JSON to clean.\r\n     */\r\n    function cleanRec(json: blocks.State) {\r\n      if (!json) {\r\n        return;\r\n      }\r\n\r\n      delete json['id'];\r\n      delete json['x'];\r\n      delete json['y'];\r\n      delete json['enabled'];\r\n\r\n      if (json['icons'] && json['icons']['comment']) {\r\n        const comment = json['icons']['comment'];\r\n        delete comment['height'];\r\n        delete comment['width'];\r\n        delete comment['pinned'];\r\n      }\r\n\r\n      const inputs = json['inputs'];\r\n      for (const name in inputs) {\r\n        const input = inputs[name];\r\n        const block = input['block'];\r\n        const shadow = input['shadow'];\r\n        if (block) {\r\n          cleanRec(block);\r\n        }\r\n        if (shadow) {\r\n          cleanRec(shadow);\r\n        }\r\n      }\r\n      if (json['next']) {\r\n        const next = json['next'];\r\n        const block = next['block'];\r\n        const shadow = next['shadow'];\r\n        if (block) {\r\n          cleanRec(block);\r\n        }\r\n        if (shadow) {\r\n          cleanRec(shadow);\r\n        }\r\n      }\r\n    }\r\n\r\n    cleanRec(json);\r\n\r\n    const blockInfo: BlockInfo = {\r\n      'kind': 'BLOCK',\r\n      ...json,\r\n    };\r\n    return blockInfo;\r\n  }\r\n}\r\n\r\n/** Width of both the trash can and lid images. */\r\nconst WIDTH = 47;\r\n\r\n/** Height of the trashcan image (minus lid). */\r\nconst BODY_HEIGHT = 44;\r\n\r\n/** Height of the lid image. */\r\nconst LID_HEIGHT = 16;\r\n\r\n/** Distance between trashcan and bottom or top edge of workspace. */\r\nconst MARGIN_VERTICAL = 20;\r\n\r\n/** Distance between trashcan and right or left edge of workspace. */\r\nconst MARGIN_HORIZONTAL = 20;\r\n\r\n/** Extent of hotspot on all sides beyond the size of the image. */\r\nconst MARGIN_HOTSPOT = 10;\r\n\r\n/** Location of trashcan in sprite image. */\r\nconst SPRITE_LEFT = 0;\r\n\r\n/** Location of trashcan in sprite image. */\r\nconst SPRITE_TOP = 32;\r\n\r\n/**\r\n * The openness of the lid when the trashcan contains blocks.\r\n *    (0.0 = closed, 1.0 = open)\r\n */\r\nconst HAS_BLOCKS_LID_ANGLE = 0.1;\r\n\r\n/** The length of the lid open/close animation in milliseconds. */\r\nconst ANIMATION_LENGTH = 80;\r\n\r\n/** The number of frames in the animation. */\r\nconst ANIMATION_FRAMES = 4;\r\n\r\n/** The minimum (resting) opacity of the trashcan and lid. */\r\nconst OPACITY_MIN = 0.4;\r\n\r\n/** The maximum (hovered) opacity of the trashcan and lid. */\r\nconst OPACITY_MAX = 0.8;\r\n\r\n/**\r\n * The maximum angle the trashcan lid can opens to. At the end of the open\r\n * animation the lid will be open to this angle.\r\n */\r\nconst MAX_LID_ANGLE = 45;\r\n","/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * The namespace used to keep track of keyboard shortcuts and the\r\n * key codes used to execute those shortcuts.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.ShortcutRegistry\r\n\r\nimport {KeyCodes} from './utils/keycodes.js';\r\nimport * as object from './utils/object.js';\r\nimport {WorkspaceSvg} from './workspace_svg.js';\r\n\r\n/**\r\n * Class for the registry of keyboard shortcuts. This is intended to be a\r\n * singleton. You should not create a new instance, and only access this class\r\n * from ShortcutRegistry.registry.\r\n */\r\nexport class ShortcutRegistry {\r\n  static readonly registry = new ShortcutRegistry();\r\n\r\n  /** Registry of all keyboard shortcuts, keyed by name of shortcut. */\r\n  private shortcuts = new Map<string, KeyboardShortcut>();\r\n\r\n  /** Map of key codes to an array of shortcut names. */\r\n  private keyMap = new Map<string, string[]>();\r\n\r\n  /** Resets the existing ShortcutRegistry singleton. */\r\n  private constructor() {\r\n    this.reset();\r\n  }\r\n\r\n  /** Clear and recreate the registry and keyMap. */\r\n  reset() {\r\n    this.shortcuts.clear();\r\n    this.keyMap.clear();\r\n  }\r\n\r\n  /**\r\n   * Registers a keyboard shortcut.\r\n   *\r\n   * @param shortcut The shortcut for this key code.\r\n   * @param opt_allowOverrides True to prevent a warning when overriding an\r\n   *     already registered item.\r\n   * @throws {Error} if a shortcut with the same name already exists.\r\n   */\r\n  register(shortcut: KeyboardShortcut, opt_allowOverrides?: boolean) {\r\n    const registeredShortcut = this.shortcuts.get(shortcut.name);\r\n    if (registeredShortcut && !opt_allowOverrides) {\r\n      throw new Error(`Shortcut named \"${shortcut.name}\" already exists.`);\r\n    }\r\n    this.shortcuts.set(shortcut.name, shortcut);\r\n\r\n    const keyCodes = shortcut.keyCodes;\r\n    if (keyCodes && keyCodes.length > 0) {\r\n      for (let i = 0; i < keyCodes.length; i++) {\r\n        this.addKeyMapping(\r\n          keyCodes[i],\r\n          shortcut.name,\r\n          !!shortcut.allowCollision,\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unregisters a keyboard shortcut registered with the given key code. This\r\n   * will also remove any key mappings that reference this shortcut.\r\n   *\r\n   * @param shortcutName The name of the shortcut to unregister.\r\n   * @returns True if an item was unregistered, false otherwise.\r\n   */\r\n  unregister(shortcutName: string): boolean {\r\n    const shortcut = this.shortcuts.get(shortcutName);\r\n\r\n    if (!shortcut) {\r\n      console.warn(`Keyboard shortcut named \"${shortcutName}\" not found.`);\r\n      return false;\r\n    }\r\n\r\n    this.removeAllKeyMappings(shortcutName);\r\n\r\n    this.shortcuts.delete(shortcutName);\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Adds a mapping between a keycode and a keyboard shortcut.\r\n   *\r\n   * @param keyCode The key code for the keyboard shortcut. If registering a key\r\n   *     code with a modifier (ex: ctrl+c) use\r\n   *     ShortcutRegistry.registry.createSerializedKey;\r\n   * @param shortcutName The name of the shortcut to execute when the given\r\n   *     keycode is pressed.\r\n   * @param opt_allowCollision True to prevent an error when adding a shortcut\r\n   *     to a key that is already mapped to a shortcut.\r\n   * @throws {Error} if the given key code is already mapped to a shortcut.\r\n   */\r\n  addKeyMapping(\r\n    keyCode: string | number | KeyCodes,\r\n    shortcutName: string,\r\n    opt_allowCollision?: boolean,\r\n  ) {\r\n    keyCode = `${keyCode}`;\r\n    const shortcutNames = this.keyMap.get(keyCode);\r\n    if (shortcutNames && !opt_allowCollision) {\r\n      throw new Error(\r\n        `Shortcut named \"${shortcutName}\" collides with shortcuts \"${shortcutNames}\"`,\r\n      );\r\n    } else if (shortcutNames && opt_allowCollision) {\r\n      shortcutNames.unshift(shortcutName);\r\n    } else {\r\n      this.keyMap.set(keyCode, [shortcutName]);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes a mapping between a keycode and a keyboard shortcut.\r\n   *\r\n   * @param keyCode The key code for the keyboard shortcut. If registering a key\r\n   *     code with a modifier (ex: ctrl+c) use\r\n   *     ShortcutRegistry.registry.createSerializedKey;\r\n   * @param shortcutName The name of the shortcut to execute when the given\r\n   *     keycode is pressed.\r\n   * @param opt_quiet True to not console warn when there is no shortcut to\r\n   *     remove.\r\n   * @returns True if a key mapping was removed, false otherwise.\r\n   */\r\n  removeKeyMapping(\r\n    keyCode: string,\r\n    shortcutName: string,\r\n    opt_quiet?: boolean,\r\n  ): boolean {\r\n    const shortcutNames = this.keyMap.get(keyCode);\r\n\r\n    if (!shortcutNames) {\r\n      if (!opt_quiet) {\r\n        console.warn(\r\n          `No keyboard shortcut named \"${shortcutName}\" registered with key code \"${keyCode}\"`,\r\n        );\r\n      }\r\n      return false;\r\n    }\r\n\r\n    const shortcutIdx = shortcutNames.indexOf(shortcutName);\r\n    if (shortcutIdx > -1) {\r\n      shortcutNames.splice(shortcutIdx, 1);\r\n      if (shortcutNames.length === 0) {\r\n        this.keyMap.delete(keyCode);\r\n      }\r\n      return true;\r\n    }\r\n    if (!opt_quiet) {\r\n      console.warn(\r\n        `No keyboard shortcut named \"${shortcutName}\" registered with key code \"${keyCode}\"`,\r\n      );\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Removes all the key mappings for a shortcut with the given name.\r\n   * Useful when changing the default key mappings and the key codes registered\r\n   * to the shortcut are unknown.\r\n   *\r\n   * @param shortcutName The name of the shortcut to remove from the key map.\r\n   */\r\n  removeAllKeyMappings(shortcutName: string) {\r\n    for (const keyCode of this.keyMap.keys()) {\r\n      this.removeKeyMapping(keyCode, shortcutName, true);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Sets the key map. Setting the key map will override any default key\r\n   * mappings.\r\n   *\r\n   * @param newKeyMap The object with key code to shortcut names.\r\n   */\r\n  setKeyMap(newKeyMap: {[key: string]: string[]}) {\r\n    this.keyMap.clear();\r\n    for (const key in newKeyMap) {\r\n      this.keyMap.set(key, newKeyMap[key]);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets the current key map.\r\n   *\r\n   * @returns The object holding key codes to ShortcutRegistry.KeyboardShortcut.\r\n   */\r\n  getKeyMap(): {[key: string]: string[]} {\r\n    const legacyKeyMap: {[key: string]: string[]} = Object.create(null);\r\n    for (const [key, value] of this.keyMap) {\r\n      legacyKeyMap[key] = value;\r\n    }\r\n    return legacyKeyMap;\r\n  }\r\n\r\n  /**\r\n   * Gets the registry of keyboard shortcuts.\r\n   *\r\n   * @returns The registry of keyboard shortcuts.\r\n   */\r\n  getRegistry(): {[key: string]: KeyboardShortcut} {\r\n    const legacyRegistry: {[key: string]: KeyboardShortcut} =\r\n      Object.create(null);\r\n    for (const [key, value] of this.shortcuts) {\r\n      legacyRegistry[key] = value;\r\n    }\r\n    return object.deepMerge(Object.create(null), legacyRegistry);\r\n  }\r\n\r\n  /**\r\n   * Handles key down events.\r\n   *\r\n   * @param workspace The main workspace where the event was captured.\r\n   * @param e The key down event.\r\n   * @returns True if the event was handled, false otherwise.\r\n   */\r\n  onKeyDown(workspace: WorkspaceSvg, e: KeyboardEvent): boolean {\r\n    const key = this.serializeKeyEvent_(e);\r\n    const shortcutNames = this.getShortcutNamesByKeyCode(key);\r\n    if (!shortcutNames) {\r\n      return false;\r\n    }\r\n    for (let i = 0, shortcutName; (shortcutName = shortcutNames[i]); i++) {\r\n      const shortcut = this.shortcuts.get(shortcutName);\r\n      if (!shortcut?.preconditionFn || shortcut?.preconditionFn(workspace)) {\r\n        // If the key has been handled, stop processing shortcuts.\r\n        if (shortcut?.callback && shortcut?.callback(workspace, e, shortcut)) {\r\n          return true;\r\n        }\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Gets the shortcuts registered to the given key code.\r\n   *\r\n   * @param keyCode The serialized key code.\r\n   * @returns The list of shortcuts to call when the given keyCode is used.\r\n   *     Undefined if no shortcuts exist.\r\n   */\r\n  getShortcutNamesByKeyCode(keyCode: string): string[] | undefined {\r\n    return this.keyMap.get(keyCode) || [];\r\n  }\r\n\r\n  /**\r\n   * Gets the serialized key codes that the shortcut with the given name is\r\n   * registered under.\r\n   *\r\n   * @param shortcutName The name of the shortcut.\r\n   * @returns An array with all the key codes the shortcut is registered under.\r\n   */\r\n  getKeyCodesByShortcutName(shortcutName: string): string[] {\r\n    const keys = [];\r\n    for (const [keyCode, shortcuts] of this.keyMap) {\r\n      const shortcutIdx = shortcuts.indexOf(shortcutName);\r\n      if (shortcutIdx > -1) {\r\n        keys.push(keyCode);\r\n      }\r\n    }\r\n    return keys;\r\n  }\r\n\r\n  /**\r\n   * Serializes a key event.\r\n   *\r\n   * @param e A key down event.\r\n   * @returns The serialized key code for the given event.\r\n   */\r\n  private serializeKeyEvent_(e: KeyboardEvent): string {\r\n    let serializedKey = '';\r\n    for (const modifier in ShortcutRegistry.modifierKeys) {\r\n      if (e.getModifierState(modifier)) {\r\n        if (serializedKey !== '') {\r\n          serializedKey += '+';\r\n        }\r\n        serializedKey += modifier;\r\n      }\r\n    }\r\n    if (serializedKey !== '' && e.keyCode) {\r\n      serializedKey = serializedKey + '+' + e.keyCode;\r\n    } else if (e.keyCode) {\r\n      serializedKey = String(e.keyCode);\r\n    }\r\n    return serializedKey;\r\n  }\r\n\r\n  /**\r\n   * Checks whether any of the given modifiers are not valid.\r\n   *\r\n   * @param modifiers List of modifiers to be used with the key.\r\n   * @throws {Error} if the modifier is not in the valid modifiers list.\r\n   */\r\n  private checkModifiers_(modifiers: KeyCodes[]) {\r\n    for (let i = 0, modifier; (modifier = modifiers[i]); i++) {\r\n      if (!(modifier in ShortcutRegistry.modifierKeys)) {\r\n        throw new Error(modifier + ' is not a valid modifier key.');\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Creates the serialized key code that will be used in the key map.\r\n   *\r\n   * @param keyCode Number code representing the key.\r\n   * @param modifiers List of modifier key codes to be used with the key. All\r\n   *     valid modifiers can be found in the ShortcutRegistry.modifierKeys.\r\n   * @returns The serialized key code for the given modifiers and key.\r\n   */\r\n  createSerializedKey(keyCode: number, modifiers: KeyCodes[] | null): string {\r\n    let serializedKey = '';\r\n\r\n    if (modifiers) {\r\n      this.checkModifiers_(modifiers);\r\n      for (const modifier in ShortcutRegistry.modifierKeys) {\r\n        const modifierKeyCode = (\r\n          ShortcutRegistry.modifierKeys as AnyDuringMigration\r\n        )[modifier];\r\n        if (modifiers.indexOf(modifierKeyCode) > -1) {\r\n          if (serializedKey !== '') {\r\n            serializedKey += '+';\r\n          }\r\n          serializedKey += modifier;\r\n        }\r\n      }\r\n    }\r\n\r\n    if (serializedKey !== '' && keyCode) {\r\n      serializedKey = serializedKey + '+' + keyCode;\r\n    } else if (keyCode) {\r\n      serializedKey = `${keyCode}`;\r\n    }\r\n    return serializedKey;\r\n  }\r\n}\r\n\r\nexport namespace ShortcutRegistry {\r\n  export interface KeyboardShortcut {\r\n    callback?: (p1: WorkspaceSvg, p2: Event, p3: KeyboardShortcut) => boolean;\r\n    name: string;\r\n    preconditionFn?: (p1: WorkspaceSvg) => boolean;\r\n    metadata?: object;\r\n    keyCodes?: (number | string)[];\r\n    allowCollision?: boolean;\r\n  }\r\n\r\n  /** Supported modifiers. */\r\n  export enum modifierKeys {\r\n    Shift = KeyCodes.SHIFT,\r\n    Control = KeyCodes.CTRL,\r\n    Alt = KeyCodes.ALT,\r\n    Meta = KeyCodes.META,\r\n  }\r\n}\r\n\r\nexport type KeyboardShortcut = ShortcutRegistry.KeyboardShortcut;\r\n// No need to export ShorcutRegistry.modifierKeys from the module at this time\r\n// because (1) it wasn't automatically converted by the automatic migration\r\n// script, (2) the name doesn't follow the styleguide.\r\n","/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.serialization.variables\r\n\r\nimport type {ISerializer} from '../interfaces/i_serializer.js';\r\nimport type {Workspace} from '../workspace.js';\r\n\r\nimport * as priorities from './priorities.js';\r\nimport * as serializationRegistry from './registry.js';\r\n\r\n/**\r\n * Represents the state of a given variable.\r\n */\r\nexport interface State {\r\n  name: string;\r\n  id: string;\r\n  type: string | undefined;\r\n}\r\n\r\n/**\r\n * Serializer for saving and loading variable state.\r\n */\r\nexport class VariableSerializer implements ISerializer {\r\n  priority: number;\r\n\r\n  /* eslint-disable-next-line require-jsdoc */\r\n  constructor() {\r\n    /** The priority for deserializing variables. */\r\n    this.priority = priorities.VARIABLES;\r\n  }\r\n\r\n  /**\r\n   * Serializes the variables of the given workspace.\r\n   *\r\n   * @param workspace The workspace to save the variables of.\r\n   * @returns The state of the workspace's variables, or null if there are no\r\n   *     variables.\r\n   */\r\n  save(workspace: Workspace): State[] | null {\r\n    const variableStates = [];\r\n    for (const variable of workspace.getAllVariables()) {\r\n      const state = {\r\n        'name': variable.name,\r\n        'id': variable.getId(),\r\n      };\r\n      if (variable.type) {\r\n        (state as AnyDuringMigration)['type'] = variable.type;\r\n      }\r\n      variableStates.push(state);\r\n    }\r\n    // AnyDuringMigration because:  Type '{ name: string; id: string; }[] |\r\n    // null' is not assignable to type 'State[] | null'.\r\n    return (\r\n      variableStates.length ? variableStates : null\r\n    ) as AnyDuringMigration;\r\n  }\r\n\r\n  /**\r\n   * Deserializes the variable defined by the given state into the given\r\n   * workspace.\r\n   *\r\n   * @param state The state of the variables to deserialize.\r\n   * @param workspace The workspace to deserialize into.\r\n   */\r\n  load(state: State[], workspace: Workspace) {\r\n    for (const varState of state) {\r\n      workspace.createVariable(\r\n        varState['name'],\r\n        varState['type'],\r\n        varState['id'],\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Disposes of any variables that exist on the workspace.\r\n   *\r\n   * @param workspace The workspace to clear the variables of.\r\n   */\r\n  clear(workspace: Workspace) {\r\n    workspace.getVariableMap().clear();\r\n  }\r\n}\r\n\r\nserializationRegistry.register('variables', new VariableSerializer());\r\n","/**\r\n * @license\r\n * Copyright 2022 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Serialization methods.\r\n */\r\n// Former goog.module ID: Blockly.serialization\r\n\r\nimport * as blocks from './serialization/blocks.js';\r\nimport * as exceptions from './serialization/exceptions.js';\r\nimport * as priorities from './serialization/priorities.js';\r\nimport * as procedures from './serialization/procedures.js';\r\nimport * as registry from './serialization/registry.js';\r\nimport * as variables from './serialization/variables.js';\r\nimport * as workspaces from './serialization/workspaces.js';\r\nimport {ISerializer} from './interfaces/i_serializer.js';\r\n\r\nexport {\r\n  blocks,\r\n  exceptions,\r\n  priorities,\r\n  procedures,\r\n  registry,\r\n  variables,\r\n  workspaces,\r\n  ISerializer,\r\n};\r\n","/**\r\n * @license\r\n * Copyright 2011 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Object representing a pair of scrollbars.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.ScrollbarPair\r\n\r\nimport * as eventUtils from './events/utils.js';\r\nimport {Scrollbar} from './scrollbar.js';\r\nimport * as dom from './utils/dom.js';\r\nimport type {Metrics} from './utils/metrics.js';\r\nimport {Svg} from './utils/svg.js';\r\nimport type {WorkspaceSvg} from './workspace_svg.js';\r\n\r\n/**\r\n * Class for a pair of scrollbars.  Horizontal and vertical.\r\n */\r\nexport class ScrollbarPair {\r\n  hScroll: Scrollbar | null = null;\r\n  vScroll: Scrollbar | null = null;\r\n  corner_: SVGRectElement | null = null;\r\n\r\n  /** Previously recorded metrics from the workspace. */\r\n  private oldHostMetrics_: Metrics | null = null;\r\n\r\n  /**\r\n   * @param workspace Workspace to bind the scrollbars to.\r\n   * @param addHorizontal Whether to add a horizontal scrollbar.\r\n   *    Defaults to true.\r\n   * @param addVertical Whether to add a vertical scrollbar. Defaults to true.\r\n   * @param opt_class A class to be applied to these scrollbars.\r\n   * @param opt_margin The margin to apply to these scrollbars.\r\n   */\r\n  constructor(\r\n    private workspace: WorkspaceSvg,\r\n    addHorizontal?: boolean,\r\n    addVertical?: boolean,\r\n    opt_class?: string,\r\n    opt_margin?: number,\r\n  ) {\r\n    addHorizontal = addHorizontal === undefined ? true : addHorizontal;\r\n    addVertical = addVertical === undefined ? true : addVertical;\r\n    const isPair = addHorizontal && addVertical;\r\n\r\n    if (addHorizontal) {\r\n      this.hScroll = new Scrollbar(\r\n        workspace,\r\n        true,\r\n        isPair,\r\n        opt_class,\r\n        opt_margin,\r\n      );\r\n    }\r\n    if (addVertical) {\r\n      this.vScroll = new Scrollbar(\r\n        workspace,\r\n        false,\r\n        isPair,\r\n        opt_class,\r\n        opt_margin,\r\n      );\r\n    }\r\n\r\n    if (isPair) {\r\n      this.corner_ = dom.createSvgElement(Svg.RECT, {\r\n        'height': Scrollbar.scrollbarThickness,\r\n        'width': Scrollbar.scrollbarThickness,\r\n        'class': 'blocklyScrollbarBackground',\r\n      });\r\n      dom.insertAfter(this.corner_, workspace.getBubbleCanvas());\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Dispose of this pair of scrollbars.\r\n   * Unlink from all DOM elements to prevent memory leaks.\r\n   */\r\n  dispose() {\r\n    dom.removeNode(this.corner_);\r\n    this.corner_ = null;\r\n    this.oldHostMetrics_ = null;\r\n    if (this.hScroll) {\r\n      this.hScroll.dispose();\r\n      this.hScroll = null;\r\n    }\r\n    if (this.vScroll) {\r\n      this.vScroll.dispose();\r\n      this.vScroll = null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Recalculate both of the scrollbars' locations and lengths.\r\n   * Also reposition the corner rectangle.\r\n   */\r\n  resize() {\r\n    // Look up the host metrics once, and use for both scrollbars.\r\n    const hostMetrics = this.workspace.getMetrics();\r\n    if (!hostMetrics) {\r\n      // Host element is likely not visible.\r\n      return;\r\n    }\r\n\r\n    // Only change the scrollbars if there has been a change in metrics.\r\n    let resizeH = false;\r\n    let resizeV = false;\r\n    if (\r\n      !this.oldHostMetrics_ ||\r\n      this.oldHostMetrics_.viewWidth !== hostMetrics.viewWidth ||\r\n      this.oldHostMetrics_.viewHeight !== hostMetrics.viewHeight ||\r\n      this.oldHostMetrics_.absoluteTop !== hostMetrics.absoluteTop ||\r\n      this.oldHostMetrics_.absoluteLeft !== hostMetrics.absoluteLeft\r\n    ) {\r\n      // The window has been resized or repositioned.\r\n      resizeH = true;\r\n      resizeV = true;\r\n    } else {\r\n      // Has the content been resized or moved?\r\n      if (\r\n        !this.oldHostMetrics_ ||\r\n        this.oldHostMetrics_.scrollWidth !== hostMetrics.scrollWidth ||\r\n        this.oldHostMetrics_.viewLeft !== hostMetrics.viewLeft ||\r\n        this.oldHostMetrics_.scrollLeft !== hostMetrics.scrollLeft\r\n      ) {\r\n        resizeH = true;\r\n      }\r\n      if (\r\n        !this.oldHostMetrics_ ||\r\n        this.oldHostMetrics_.scrollHeight !== hostMetrics.scrollHeight ||\r\n        this.oldHostMetrics_.viewTop !== hostMetrics.viewTop ||\r\n        this.oldHostMetrics_.scrollTop !== hostMetrics.scrollTop\r\n      ) {\r\n        resizeV = true;\r\n      }\r\n    }\r\n\r\n    if (resizeH || resizeV) {\r\n      try {\r\n        eventUtils.disable();\r\n        if (this.hScroll && resizeH) {\r\n          this.hScroll.resize(hostMetrics);\r\n        }\r\n        if (this.vScroll && resizeV) {\r\n          this.vScroll.resize(hostMetrics);\r\n        }\r\n      } finally {\r\n        eventUtils.enable();\r\n      }\r\n      this.workspace.maybeFireViewportChangeEvent();\r\n    }\r\n\r\n    if (this.hScroll && this.vScroll) {\r\n      // Reposition the corner square.\r\n      if (\r\n        !this.oldHostMetrics_ ||\r\n        this.oldHostMetrics_.viewWidth !== hostMetrics.viewWidth ||\r\n        this.oldHostMetrics_.absoluteLeft !== hostMetrics.absoluteLeft\r\n      ) {\r\n        this.corner_?.setAttribute('x', String(this.vScroll.position.x));\r\n      }\r\n      if (\r\n        !this.oldHostMetrics_ ||\r\n        this.oldHostMetrics_.viewHeight !== hostMetrics.viewHeight ||\r\n        this.oldHostMetrics_.absoluteTop !== hostMetrics.absoluteTop\r\n      ) {\r\n        this.corner_?.setAttribute('y', String(this.hScroll.position.y));\r\n      }\r\n    }\r\n\r\n    // Cache the current metrics to potentially short-cut the next resize event.\r\n    this.oldHostMetrics_ = hostMetrics;\r\n  }\r\n\r\n  /**\r\n   * Returns whether scrolling horizontally is enabled.\r\n   *\r\n   * @returns True if horizontal scroll is enabled.\r\n   */\r\n  canScrollHorizontally(): boolean {\r\n    return !!this.hScroll;\r\n  }\r\n\r\n  /**\r\n   * Returns whether scrolling vertically is enabled.\r\n   *\r\n   * @returns True if vertical scroll is enabled.\r\n   */\r\n  canScrollVertically(): boolean {\r\n    return !!this.vScroll;\r\n  }\r\n\r\n  /**\r\n   * Record the origin of the workspace that the scrollbar is in, in pixels\r\n   * relative to the injection div origin. This is for times when the scrollbar\r\n   * is used in an object whose origin isn't the same as the main workspace\r\n   * (e.g. in a flyout.)\r\n   *\r\n   * @param x The x coordinate of the scrollbar's origin, in CSS pixels.\r\n   * @param y The y coordinate of the scrollbar's origin, in CSS pixels.\r\n   * @internal\r\n   */\r\n  setOrigin(x: number, y: number) {\r\n    if (this.hScroll) {\r\n      this.hScroll.setOrigin(x, y);\r\n    }\r\n    if (this.vScroll) {\r\n      this.vScroll.setOrigin(x, y);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set the handles of both scrollbars.\r\n   *\r\n   * @param x The horizontal content displacement, relative to the view in\r\n   *     pixels.\r\n   * @param y The vertical content displacement, relative to the view in pixels.\r\n   * @param updateMetrics Whether to update metrics on this set call.\r\n   *    Defaults to true.\r\n   */\r\n  set(x: number, y: number, updateMetrics: boolean) {\r\n    // This function is equivalent to:\r\n    //   this.hScroll.set(x);\r\n    //   this.vScroll.set(y);\r\n    // However, that calls setMetrics twice which causes a chain of\r\n    // getAttribute->setAttribute->getAttribute resulting in an extra layout\r\n    // pass. Combining them speeds up rendering.\r\n    if (this.hScroll) {\r\n      this.hScroll.set(x, false);\r\n    }\r\n    if (this.vScroll) {\r\n      this.vScroll.set(y, false);\r\n    }\r\n\r\n    if (updateMetrics || updateMetrics === undefined) {\r\n      // Update metrics.\r\n      const xyRatio: {x?: number; y?: number} = {};\r\n      if (this.hScroll) {\r\n        xyRatio.x = this.hScroll.getRatio_();\r\n      }\r\n      if (this.vScroll) {\r\n        xyRatio.y = this.vScroll.getRatio_();\r\n      }\r\n      this.workspace.setMetrics(xyRatio);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set the handle of the horizontal scrollbar to be at a certain position in\r\n   *    CSS pixels relative to its parents.\r\n   *\r\n   * @param x Horizontal scroll value.\r\n   */\r\n  setX(x: number) {\r\n    if (this.hScroll) {\r\n      this.hScroll.set(x, true);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set the handle of the vertical scrollbar to be at a certain position in\r\n   *    CSS pixels relative to its parents.\r\n   *\r\n   * @param y Vertical scroll value.\r\n   */\r\n  setY(y: number) {\r\n    if (this.vScroll) {\r\n      this.vScroll.set(y, true);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set whether this scrollbar's container is visible.\r\n   *\r\n   * @param visible Whether the container is visible.\r\n   */\r\n  setContainerVisible(visible: boolean) {\r\n    if (this.hScroll) {\r\n      this.hScroll.setContainerVisible(visible);\r\n    }\r\n    if (this.vScroll) {\r\n      this.vScroll.setContainerVisible(visible);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * If any of the scrollbars are visible. Non-paired scrollbars may disappear\r\n   * when they aren't needed.\r\n   *\r\n   * @returns True if visible.\r\n   */\r\n  isVisible(): boolean {\r\n    let isVisible = false;\r\n    if (this.hScroll) {\r\n      isVisible = this.hScroll.isVisible();\r\n    }\r\n    if (this.vScroll) {\r\n      isVisible = isVisible || this.vScroll.isVisible();\r\n    }\r\n    return isVisible;\r\n  }\r\n\r\n  /**\r\n   * Sets the visibility of any existing scrollbars.\r\n   *\r\n   * @param visible True if visible.\r\n   */\r\n  setVisible(visible: boolean) {\r\n    if (this.hScroll) this.hScroll.setVisibleInternal(visible);\r\n    if (this.vScroll) this.vScroll.setVisibleInternal(visible);\r\n  }\r\n\r\n  /**\r\n   * Recalculates the scrollbars' locations within their path and length.\r\n   * This should be called when the contents of the workspace have changed.\r\n   *\r\n   * @param hostMetrics A data structure describing all the required dimensions,\r\n   *     possibly fetched from the host object.\r\n   */\r\n  resizeContent(hostMetrics: Metrics) {\r\n    if (this.hScroll) {\r\n      this.hScroll.resizeContentHorizontal(hostMetrics);\r\n    }\r\n    if (this.vScroll) {\r\n      this.vScroll.resizeContentVertical(hostMetrics);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Recalculates the scrollbars' locations on the screen and path length.\r\n   * This should be called when the layout or size of the window has changed.\r\n   *\r\n   * @param hostMetrics A data structure describing all the required dimensions,\r\n   *     possibly fetched from the host object.\r\n   */\r\n  resizeView(hostMetrics: Metrics) {\r\n    if (this.hScroll) {\r\n      this.hScroll.resizeViewHorizontal(hostMetrics);\r\n    }\r\n    if (this.vScroll) {\r\n      this.vScroll.resizeViewVertical(hostMetrics);\r\n    }\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Calculates and reports workspace metrics.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.MetricsManager\r\n\r\nimport type {IFlyout} from './interfaces/i_flyout.js';\r\nimport type {IMetricsManager} from './interfaces/i_metrics_manager.js';\r\nimport type {IToolbox} from './interfaces/i_toolbox.js';\r\nimport * as registry from './registry.js';\r\nimport type {Metrics} from './utils/metrics.js';\r\nimport {Size} from './utils/size.js';\r\nimport * as toolboxUtils from './utils/toolbox.js';\r\nimport type {WorkspaceSvg} from './workspace_svg.js';\r\n\r\n/**\r\n * The manager for all workspace metrics calculations.\r\n */\r\nexport class MetricsManager implements IMetricsManager {\r\n  /** The workspace to calculate metrics for. */\r\n  protected readonly workspace_: WorkspaceSvg;\r\n\r\n  /** @param workspace The workspace to calculate metrics for. */\r\n  constructor(workspace: WorkspaceSvg) {\r\n    this.workspace_ = workspace;\r\n  }\r\n\r\n  /**\r\n   * Gets the dimensions of the given workspace component, in pixel coordinates.\r\n   *\r\n   * @param elem The element to get the dimensions of, or null.  It should be a\r\n   *     toolbox or flyout, and should implement getWidth() and getHeight().\r\n   * @returns An object containing width and height attributes, which will both\r\n   *     be zero if elem did not exist.\r\n   */\r\n  protected getDimensionsPx_(elem: IToolbox | null | IFlyout): Size {\r\n    let width = 0;\r\n    let height = 0;\r\n    if (elem) {\r\n      width = elem.getWidth();\r\n      height = elem.getHeight();\r\n    }\r\n    return new Size(width, height);\r\n  }\r\n\r\n  /**\r\n   * Gets the width and the height of the flyout in pixel\r\n   * coordinates. By default, will get metrics for either a simple flyout (owned\r\n   * directly by the workspace) or for the flyout owned by the toolbox. If you\r\n   * pass `opt_own` as `true` then only metrics for the simple flyout will be\r\n   * returned, and it will return 0 for the width and height if the workspace\r\n   * has a category toolbox instead of a simple toolbox.\r\n   *\r\n   * @param opt_own Whether to only return the workspace's own flyout metrics.\r\n   * @returns The width and height of the flyout.\r\n   */\r\n  getFlyoutMetrics(opt_own?: boolean): ToolboxMetrics {\r\n    const flyoutDimensions = this.getDimensionsPx_(\r\n      this.workspace_.getFlyout(opt_own),\r\n    );\r\n    return {\r\n      width: flyoutDimensions.width,\r\n      height: flyoutDimensions.height,\r\n      position: this.workspace_.toolboxPosition,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Gets the width, height and position of the toolbox on the workspace in\r\n   * pixel coordinates. Returns 0 for the width and height if the workspace has\r\n   * a simple toolbox instead of a category toolbox. To get the width and height\r\n   * of a simple toolbox, see {@link MetricsManager#getFlyoutMetrics}.\r\n   *\r\n   * @returns The object with the width, height and position of the toolbox.\r\n   */\r\n  getToolboxMetrics(): ToolboxMetrics {\r\n    const toolboxDimensions = this.getDimensionsPx_(\r\n      this.workspace_.getToolbox(),\r\n    );\r\n\r\n    return {\r\n      width: toolboxDimensions.width,\r\n      height: toolboxDimensions.height,\r\n      position: this.workspace_.toolboxPosition,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Gets the width and height of the workspace's parent SVG element in pixel\r\n   * coordinates. This area includes the toolbox and the visible workspace area.\r\n   *\r\n   * @returns The width and height of the workspace's parent SVG element.\r\n   */\r\n  getSvgMetrics(): Size {\r\n    return this.workspace_.getCachedParentSvgSize();\r\n  }\r\n\r\n  /**\r\n   * Gets the absolute left and absolute top in pixel coordinates.\r\n   * This is where the visible workspace starts in relation to the SVG\r\n   * container.\r\n   *\r\n   * @returns The absolute metrics for the workspace.\r\n   */\r\n  getAbsoluteMetrics(): AbsoluteMetrics {\r\n    let absoluteLeft = 0;\r\n    let absoluteTop = 0;\r\n\r\n    const toolboxMetrics = this.getToolboxMetrics();\r\n    const flyoutMetrics = this.getFlyoutMetrics();\r\n    const respectToolbox = !!this.workspace_.getToolbox();\r\n    const respectFlyout = !this.workspace_.getFlyout()?.autoClose;\r\n    const toolboxPosition = respectToolbox\r\n      ? toolboxMetrics.position\r\n      : flyoutMetrics.position;\r\n\r\n    const atLeft = toolboxPosition === toolboxUtils.Position.LEFT;\r\n    const atTop = toolboxPosition === toolboxUtils.Position.TOP;\r\n    if (atLeft) {\r\n      if (respectToolbox) absoluteLeft += toolboxMetrics.width;\r\n      if (respectFlyout) absoluteLeft += flyoutMetrics.width;\r\n    }\r\n    if (atTop) {\r\n      if (respectToolbox) absoluteTop += toolboxMetrics.height;\r\n      if (respectFlyout) absoluteTop += flyoutMetrics.height;\r\n    }\r\n\r\n    return {\r\n      top: absoluteTop,\r\n      left: absoluteLeft,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Gets the metrics for the visible workspace in either pixel or workspace\r\n   * coordinates. The visible workspace does not include the toolbox or flyout.\r\n   *\r\n   * @param opt_getWorkspaceCoordinates True to get the view metrics in\r\n   *     workspace coordinates, false to get them in pixel coordinates.\r\n   * @returns The width, height, top and left of the viewport in either\r\n   *     workspace coordinates or pixel coordinates.\r\n   */\r\n  getViewMetrics(opt_getWorkspaceCoordinates?: boolean): ContainerRegion {\r\n    const scale = opt_getWorkspaceCoordinates ? this.workspace_.scale : 1;\r\n    const svgMetrics = this.getSvgMetrics();\r\n    const toolboxMetrics = this.getToolboxMetrics();\r\n    const flyoutMetrics = this.getFlyoutMetrics();\r\n    const respectToolbox = !!this.workspace_.getToolbox();\r\n    const respectFlyout = !this.workspace_.getFlyout()?.autoClose;\r\n    const toolboxPosition = respectToolbox\r\n      ? toolboxMetrics.position\r\n      : flyoutMetrics.position;\r\n\r\n    const horizToolbox =\r\n      toolboxPosition === toolboxUtils.Position.TOP ||\r\n      toolboxPosition === toolboxUtils.Position.BOTTOM;\r\n    const vertToolbox =\r\n      toolboxPosition === toolboxUtils.Position.LEFT ||\r\n      toolboxPosition === toolboxUtils.Position.RIGHT;\r\n    if (horizToolbox) {\r\n      if (respectToolbox) svgMetrics.height -= toolboxMetrics.height;\r\n      if (respectFlyout) svgMetrics.height -= flyoutMetrics.height;\r\n    }\r\n    if (vertToolbox) {\r\n      if (respectToolbox) svgMetrics.width -= toolboxMetrics.width;\r\n      if (respectFlyout) svgMetrics.width -= flyoutMetrics.width;\r\n    }\r\n    return {\r\n      height: svgMetrics.height / scale,\r\n      width: svgMetrics.width / scale,\r\n      top: -this.workspace_.scrollY / scale,\r\n      left: -this.workspace_.scrollX / scale,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Gets content metrics in either pixel or workspace coordinates.\r\n   * The content area is a rectangle around all the top bounded elements on the\r\n   * workspace (workspace comments and blocks).\r\n   *\r\n   * @param opt_getWorkspaceCoordinates True to get the content metrics in\r\n   *     workspace coordinates, false to get them in pixel coordinates.\r\n   * @returns The metrics for the content container.\r\n   */\r\n  getContentMetrics(opt_getWorkspaceCoordinates?: boolean): ContainerRegion {\r\n    const scale = opt_getWorkspaceCoordinates ? 1 : this.workspace_.scale;\r\n    // Block bounding box is in workspace coordinates.\r\n    const blockBox = this.workspace_.getBlocksBoundingBox();\r\n\r\n    return {\r\n      height: (blockBox.bottom - blockBox.top) * scale,\r\n      width: (blockBox.right - blockBox.left) * scale,\r\n      top: blockBox.top * scale,\r\n      left: blockBox.left * scale,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Returns whether the scroll area has fixed edges.\r\n   *\r\n   * @returns Whether the scroll area has fixed edges.\r\n   * @internal\r\n   */\r\n  hasFixedEdges(): boolean {\r\n    // This exists for optimization of bump logic.\r\n    return (\r\n      !this.workspace_.isMovableHorizontally() ||\r\n      !this.workspace_.isMovableVertically()\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Computes the fixed edges of the scroll area.\r\n   *\r\n   * @param opt_viewMetrics The view metrics if they have been previously\r\n   *     computed. Passing in null may cause the view metrics to be computed\r\n   *     again, if it is needed.\r\n   * @returns The fixed edges of the scroll area.\r\n   */\r\n  protected getComputedFixedEdges_(\r\n    opt_viewMetrics?: ContainerRegion,\r\n  ): FixedEdges {\r\n    if (!this.hasFixedEdges()) {\r\n      // Return early if there are no edges.\r\n      return {};\r\n    }\r\n\r\n    const hScrollEnabled = this.workspace_.isMovableHorizontally();\r\n    const vScrollEnabled = this.workspace_.isMovableVertically();\r\n\r\n    const viewMetrics = opt_viewMetrics || this.getViewMetrics(false);\r\n\r\n    const edges = {} as FixedEdges;\r\n    if (!vScrollEnabled) {\r\n      edges.top = viewMetrics.top;\r\n      edges.bottom = viewMetrics.top + viewMetrics.height;\r\n    }\r\n    if (!hScrollEnabled) {\r\n      edges.left = viewMetrics.left;\r\n      edges.right = viewMetrics.left + viewMetrics.width;\r\n    }\r\n    return edges;\r\n  }\r\n\r\n  /**\r\n   * Returns the content area with added padding.\r\n   *\r\n   * @param viewMetrics The view metrics.\r\n   * @param contentMetrics The content metrics.\r\n   * @returns The padded content area.\r\n   */\r\n  protected getPaddedContent_(\r\n    viewMetrics: ContainerRegion,\r\n    contentMetrics: ContainerRegion,\r\n  ): {top: number; bottom: number; left: number; right: number} {\r\n    const contentBottom = contentMetrics.top + contentMetrics.height;\r\n    const contentRight = contentMetrics.left + contentMetrics.width;\r\n\r\n    const viewWidth = viewMetrics.width;\r\n    const viewHeight = viewMetrics.height;\r\n    const halfWidth = viewWidth / 2;\r\n    const halfHeight = viewHeight / 2;\r\n\r\n    // Add a padding around the content that is at least half a screen wide.\r\n    // Ensure padding is wide enough that blocks can scroll over entire screen.\r\n    const top = Math.min(\r\n      contentMetrics.top - halfHeight,\r\n      contentBottom - viewHeight,\r\n    );\r\n    const left = Math.min(\r\n      contentMetrics.left - halfWidth,\r\n      contentRight - viewWidth,\r\n    );\r\n    const bottom = Math.max(\r\n      contentBottom + halfHeight,\r\n      contentMetrics.top + viewHeight,\r\n    );\r\n    const right = Math.max(\r\n      contentRight + halfWidth,\r\n      contentMetrics.left + viewWidth,\r\n    );\r\n\r\n    return {top, bottom, left, right};\r\n  }\r\n\r\n  /**\r\n   * Returns the metrics for the scroll area of the workspace.\r\n   *\r\n   * @param opt_getWorkspaceCoordinates True to get the scroll metrics in\r\n   *     workspace coordinates, false to get them in pixel coordinates.\r\n   * @param opt_viewMetrics The view metrics if they have been previously\r\n   *     computed. Passing in null may cause the view metrics to be computed\r\n   *     again, if it is needed.\r\n   * @param opt_contentMetrics The content metrics if they have been previously\r\n   *     computed. Passing in null may cause the content metrics to be computed\r\n   *     again, if it is needed.\r\n   * @returns The metrics for the scroll container.\r\n   */\r\n  getScrollMetrics(\r\n    opt_getWorkspaceCoordinates?: boolean,\r\n    opt_viewMetrics?: ContainerRegion,\r\n    opt_contentMetrics?: ContainerRegion,\r\n  ): ContainerRegion {\r\n    const scale = opt_getWorkspaceCoordinates ? this.workspace_.scale : 1;\r\n    const viewMetrics = opt_viewMetrics || this.getViewMetrics(false);\r\n    const contentMetrics = opt_contentMetrics || this.getContentMetrics();\r\n    const fixedEdges = this.getComputedFixedEdges_(viewMetrics);\r\n\r\n    // Add padding around content.\r\n    const paddedContent = this.getPaddedContent_(viewMetrics, contentMetrics);\r\n\r\n    // Use combination of fixed bounds and padded content to make scroll area.\r\n    const top =\r\n      fixedEdges.top !== undefined ? fixedEdges.top : paddedContent.top;\r\n    const left =\r\n      fixedEdges.left !== undefined ? fixedEdges.left : paddedContent.left;\r\n    const bottom =\r\n      fixedEdges.bottom !== undefined\r\n        ? fixedEdges.bottom\r\n        : paddedContent.bottom;\r\n    const right =\r\n      fixedEdges.right !== undefined ? fixedEdges.right : paddedContent.right;\r\n\r\n    return {\r\n      top: top / scale,\r\n      left: left / scale,\r\n      width: (right - left) / scale,\r\n      height: (bottom - top) / scale,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Returns common metrics used by UI elements.\r\n   *\r\n   * @returns The UI metrics.\r\n   */\r\n  getUiMetrics(): UiMetrics {\r\n    return {\r\n      viewMetrics: this.getViewMetrics(),\r\n      absoluteMetrics: this.getAbsoluteMetrics(),\r\n      toolboxMetrics: this.getToolboxMetrics(),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Returns an object with all the metrics required to size scrollbars for a\r\n   * top level workspace.  The following properties are computed:\r\n   * Coordinate system: pixel coordinates, -left, -up, +right, +down\r\n   * .viewHeight: Height of the visible portion of the workspace.\r\n   * .viewWidth: Width of the visible portion of the workspace.\r\n   * .contentHeight: Height of the content.\r\n   * .contentWidth: Width of the content.\r\n   * .scrollHeight: Height of the scroll area.\r\n   * .scrollWidth: Width of the scroll area.\r\n   * .svgHeight: Height of the Blockly div (the view + the toolbox,\r\n   *    simple or otherwise),\r\n   * .svgWidth: Width of the Blockly div (the view + the toolbox,\r\n   *    simple or otherwise),\r\n   * .viewTop: Top-edge of the visible portion of the workspace, relative to\r\n   *     the workspace origin.\r\n   * .viewLeft: Left-edge of the visible portion of the workspace, relative to\r\n   *     the workspace origin.\r\n   * .contentTop: Top-edge of the content, relative to the workspace origin.\r\n   * .contentLeft: Left-edge of the content relative to the workspace origin.\r\n   * .scrollTop: Top-edge of the scroll area, relative to the workspace origin.\r\n   * .scrollLeft: Left-edge of the scroll area relative to the workspace origin.\r\n   * .absoluteTop: Top-edge of the visible portion of the workspace, relative\r\n   *     to the blocklyDiv.\r\n   * .absoluteLeft: Left-edge of the visible portion of the workspace, relative\r\n   *     to the blocklyDiv.\r\n   * .toolboxWidth: Width of the toolbox, if it exists.  Otherwise zero.\r\n   * .toolboxHeight: Height of the toolbox, if it exists.  Otherwise zero.\r\n   * .flyoutWidth: Width of the flyout if it is always open.  Otherwise zero.\r\n   * .flyoutHeight: Height of the flyout if it is always open.  Otherwise zero.\r\n   * .toolboxPosition: Top, bottom, left or right. Use TOOLBOX_AT constants to\r\n   *     compare.\r\n   *\r\n   * @returns Contains size and position metrics of a top level workspace.\r\n   */\r\n  getMetrics(): Metrics {\r\n    const toolboxMetrics = this.getToolboxMetrics();\r\n    const flyoutMetrics = this.getFlyoutMetrics(true);\r\n    const svgMetrics = this.getSvgMetrics();\r\n    const absoluteMetrics = this.getAbsoluteMetrics();\r\n    const viewMetrics = this.getViewMetrics();\r\n    const contentMetrics = this.getContentMetrics();\r\n    const scrollMetrics = this.getScrollMetrics(\r\n      false,\r\n      viewMetrics,\r\n      contentMetrics,\r\n    );\r\n\r\n    return {\r\n      contentHeight: contentMetrics.height,\r\n      contentWidth: contentMetrics.width,\r\n      contentTop: contentMetrics.top,\r\n      contentLeft: contentMetrics.left,\r\n\r\n      scrollHeight: scrollMetrics.height,\r\n      scrollWidth: scrollMetrics.width,\r\n      scrollTop: scrollMetrics.top,\r\n      scrollLeft: scrollMetrics.left,\r\n\r\n      viewHeight: viewMetrics.height,\r\n      viewWidth: viewMetrics.width,\r\n      viewTop: viewMetrics.top,\r\n      viewLeft: viewMetrics.left,\r\n\r\n      absoluteTop: absoluteMetrics.top,\r\n      absoluteLeft: absoluteMetrics.left,\r\n\r\n      svgHeight: svgMetrics.height,\r\n      svgWidth: svgMetrics.width,\r\n\r\n      toolboxWidth: toolboxMetrics.width,\r\n      toolboxHeight: toolboxMetrics.height,\r\n      toolboxPosition: toolboxMetrics.position,\r\n\r\n      flyoutWidth: flyoutMetrics.width,\r\n      flyoutHeight: flyoutMetrics.height,\r\n    };\r\n  }\r\n}\r\n\r\nexport namespace MetricsManager {\r\n  /**\r\n   * Describes the width, height and location of the toolbox on the main\r\n   * workspace.\r\n   */\r\n  export interface ToolboxMetrics {\r\n    width: number;\r\n    height: number;\r\n    position: toolboxUtils.Position;\r\n  }\r\n\r\n  /** Describes where the viewport starts in relation to the workspace SVG. */\r\n  export interface AbsoluteMetrics {\r\n    left: number;\r\n    top: number;\r\n  }\r\n\r\n  /**\r\n   * All the measurements needed to describe the size and location of a\r\n   * container.\r\n   */\r\n  export interface ContainerRegion {\r\n    height: number;\r\n    width: number;\r\n    top: number;\r\n    left: number;\r\n  }\r\n\r\n  /** Describes fixed edges of the workspace. */\r\n  export interface FixedEdges {\r\n    top?: number;\r\n    bottom?: number;\r\n    left?: number;\r\n    right?: number;\r\n  }\r\n\r\n  /** Common metrics used for UI elements. */\r\n  export interface UiMetrics {\r\n    viewMetrics: ContainerRegion;\r\n    absoluteMetrics: AbsoluteMetrics;\r\n    toolboxMetrics: ToolboxMetrics;\r\n  }\r\n}\r\n\r\nexport type ToolboxMetrics = MetricsManager.ToolboxMetrics;\r\nexport type AbsoluteMetrics = MetricsManager.AbsoluteMetrics;\r\nexport type ContainerRegion = MetricsManager.ContainerRegion;\r\nexport type FixedEdges = MetricsManager.FixedEdges;\r\nexport type UiMetrics = MetricsManager.UiMetrics;\r\n\r\nregistry.register(\r\n  registry.Type.METRICS_MANAGER,\r\n  registry.DEFAULT,\r\n  MetricsManager,\r\n);\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Class for a finished loading workspace event.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.Events.FinishedLoading\r\n\r\nimport * as registry from '../registry.js';\r\nimport type {Workspace} from '../workspace.js';\r\nimport {Abstract as AbstractEvent} from './events_abstract.js';\r\nimport * as eventUtils from './utils.js';\r\n\r\n/**\r\n * Notifies listeners when the workspace has finished deserializing from\r\n * JSON/XML.\r\n */\r\nexport class FinishedLoading extends AbstractEvent {\r\n  override isBlank = true;\r\n  override recordUndo = false;\r\n  override type = eventUtils.FINISHED_LOADING;\r\n\r\n  /**\r\n   * @param opt_workspace The workspace that has finished loading.  Undefined\r\n   *     for a blank event.\r\n   */\r\n  constructor(opt_workspace?: Workspace) {\r\n    super();\r\n    this.isBlank = !!opt_workspace;\r\n\r\n    if (!opt_workspace) return;\r\n\r\n    this.workspaceId = opt_workspace.id;\r\n  }\r\n}\r\n\r\nregistry.register(\r\n  registry.Type.EVENT,\r\n  eventUtils.FINISHED_LOADING,\r\n  FinishedLoading,\r\n);\r\n","/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Events fired as a block drag.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.Events.BlockDrag\r\n\r\nimport type {Block} from '../block.js';\r\nimport * as registry from '../registry.js';\r\nimport {AbstractEventJson} from './events_abstract.js';\r\nimport {UiBase} from './events_ui_base.js';\r\nimport * as eventUtils from './utils.js';\r\nimport {Workspace} from '../workspace.js';\r\n\r\n/**\r\n * Notifies listeners when a block is being manually dragged/dropped.\r\n */\r\nexport class BlockDrag extends UiBase {\r\n  /** The ID of the top-level block being dragged. */\r\n  blockId?: string;\r\n\r\n  /** True if this is the start of a drag, false if this is the end of one. */\r\n  isStart?: boolean;\r\n\r\n  /**\r\n   * A list of all of the blocks (i.e. all descendants of the block associated\r\n   * with the block ID) being dragged.\r\n   */\r\n  blocks?: Block[];\r\n\r\n  override type = eventUtils.BLOCK_DRAG;\r\n\r\n  /**\r\n   * @param opt_block The top block in the stack that is being dragged.\r\n   *     Undefined for a blank event.\r\n   * @param opt_isStart Whether this is the start of a block drag.\r\n   *    Undefined for a blank event.\r\n   * @param opt_blocks The blocks affected by this drag. Undefined for a blank\r\n   *     event.\r\n   */\r\n  constructor(opt_block?: Block, opt_isStart?: boolean, opt_blocks?: Block[]) {\r\n    const workspaceId = opt_block ? opt_block.workspace.id : undefined;\r\n    super(workspaceId);\r\n    if (!opt_block) return;\r\n\r\n    this.blockId = opt_block.id;\r\n    this.isStart = opt_isStart;\r\n    this.blocks = opt_blocks;\r\n  }\r\n\r\n  /**\r\n   * Encode the event as JSON.\r\n   *\r\n   * @returns JSON representation.\r\n   */\r\n  override toJson(): BlockDragJson {\r\n    const json = super.toJson() as BlockDragJson;\r\n    if (this.isStart === undefined) {\r\n      throw new Error(\r\n        'Whether this event is the start of a drag is undefined. ' +\r\n          'Either pass the value to the constructor, or call fromJson',\r\n      );\r\n    }\r\n    if (this.blockId === undefined) {\r\n      throw new Error(\r\n        'The block ID is undefined. Either pass a block to ' +\r\n          'the constructor, or call fromJson',\r\n      );\r\n    }\r\n    json['isStart'] = this.isStart;\r\n    json['blockId'] = this.blockId;\r\n    // TODO: I don't think we should actually apply the blocks array to the JSON\r\n    //   object b/c they have functions and aren't actually serializable.\r\n    json['blocks'] = this.blocks;\r\n    return json;\r\n  }\r\n\r\n  /**\r\n   * Deserializes the JSON event.\r\n   *\r\n   * @param event The event to append new properties to. Should be a subclass\r\n   *     of BlockDrag, but we can't specify that due to the fact that parameters\r\n   *     to static methods in subclasses must be supertypes of parameters to\r\n   *     static methods in superclasses..\r\n   * @internal\r\n   */\r\n  static fromJson(\r\n    json: BlockDragJson,\r\n    workspace: Workspace,\r\n    event?: any,\r\n  ): BlockDrag {\r\n    const newEvent = super.fromJson(\r\n      json,\r\n      workspace,\r\n      event ?? new BlockDrag(),\r\n    ) as BlockDrag;\r\n    newEvent.isStart = json['isStart'];\r\n    newEvent.blockId = json['blockId'];\r\n    newEvent.blocks = json['blocks'];\r\n    return newEvent;\r\n  }\r\n}\r\n\r\nexport interface BlockDragJson extends AbstractEventJson {\r\n  isStart: boolean;\r\n  blockId: string;\r\n  blocks?: Block[];\r\n}\r\n\r\nregistry.register(registry.Type.EVENT, eventUtils.BLOCK_DRAG, BlockDrag);\r\n","/**\r\n * @license\r\n * Copyright 2023 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport {Bubble} from './bubbles/bubble.js';\r\nimport {TextBubble} from './bubbles/text_bubble.js';\r\nimport {TextInputBubble} from './bubbles/textinput_bubble.js';\r\nimport {MiniWorkspaceBubble} from './bubbles/mini_workspace_bubble.js';\r\n\r\nexport {Bubble, TextBubble, TextInputBubble, MiniWorkspaceBubble};\r\n","/**\r\n * @license\r\n * Copyright 2023 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Class for an event representing an intermediate change to a block's field's\r\n * value.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.Events.BlockFieldIntermediateChange\r\n\r\nimport type {Block} from '../block.js';\r\nimport * as registry from '../registry.js';\r\nimport {Workspace} from '../workspace.js';\r\n\r\nimport {BlockBase, BlockBaseJson} from './events_block_base.js';\r\nimport * as eventUtils from './utils.js';\r\n\r\n/**\r\n * Notifies listeners when the value of a block's field has changed but the\r\n * change is not yet complete, and is expected to be followed by a block change\r\n * event.\r\n */\r\nexport class BlockFieldIntermediateChange extends BlockBase {\r\n  override type = eventUtils.BLOCK_FIELD_INTERMEDIATE_CHANGE;\r\n\r\n  // Intermediate events do not undo or redo. They may be fired frequently while\r\n  // the field editor widget is open. A separate BLOCK_CHANGE event is fired\r\n  // when the editor is closed, which combines all of the field value changes\r\n  // into a single change that is recorded in the undo history instead. The\r\n  // intermediate changes are important for reacting to immediate changes, but\r\n  // some event handlers would prefer to handle the less frequent final events,\r\n  // like when triggering workspace serialization. Technically, this method of\r\n  // grouping changes can result in undo perfoming actions out of order if some\r\n  // other event occurs between opening and closing the field editor, but such\r\n  // events are unlikely to cause a broken state.\r\n  override recordUndo = false;\r\n\r\n  /** The name of the field that changed. */\r\n  name?: string;\r\n\r\n  /** The original value of the element. */\r\n  oldValue: unknown;\r\n\r\n  /** The new value of the element. */\r\n  newValue: unknown;\r\n\r\n  /**\r\n   * @param opt_block The changed block. Undefined for a blank event.\r\n   * @param opt_name Name of the field affected.\r\n   * @param opt_oldValue Previous value of element.\r\n   * @param opt_newValue New value of element.\r\n   */\r\n  constructor(\r\n    opt_block?: Block,\r\n    opt_name?: string,\r\n    opt_oldValue?: unknown,\r\n    opt_newValue?: unknown,\r\n  ) {\r\n    super(opt_block);\r\n    if (!opt_block) {\r\n      return; // Blank event to be populated by fromJson.\r\n    }\r\n\r\n    this.name = opt_name;\r\n    this.oldValue = opt_oldValue;\r\n    this.newValue = opt_newValue;\r\n  }\r\n\r\n  /**\r\n   * Encode the event as JSON.\r\n   *\r\n   * @returns JSON representation.\r\n   */\r\n  override toJson(): BlockFieldIntermediateChangeJson {\r\n    const json = super.toJson() as BlockFieldIntermediateChangeJson;\r\n    if (!this.name) {\r\n      throw new Error(\r\n        'The changed field name is undefined. Either pass a ' +\r\n          'name to the constructor, or call fromJson.',\r\n      );\r\n    }\r\n    json['name'] = this.name;\r\n    json['oldValue'] = this.oldValue;\r\n    json['newValue'] = this.newValue;\r\n    return json;\r\n  }\r\n\r\n  /**\r\n   * Deserializes the JSON event.\r\n   *\r\n   * @param event The event to append new properties to. Should be a subclass\r\n   *     of BlockFieldIntermediateChange, but we can't specify that due to the\r\n   *     fact that parameters to static methods in subclasses must be supertypes\r\n   *     of parameters to static methods in superclasses.\r\n   * @internal\r\n   */\r\n  static fromJson(\r\n    json: BlockFieldIntermediateChangeJson,\r\n    workspace: Workspace,\r\n    event?: any,\r\n  ): BlockFieldIntermediateChange {\r\n    const newEvent = super.fromJson(\r\n      json,\r\n      workspace,\r\n      event ?? new BlockFieldIntermediateChange(),\r\n    ) as BlockFieldIntermediateChange;\r\n    newEvent.name = json['name'];\r\n    newEvent.oldValue = json['oldValue'];\r\n    newEvent.newValue = json['newValue'];\r\n    return newEvent;\r\n  }\r\n\r\n  /**\r\n   * Does this event record any change of state?\r\n   *\r\n   * @returns False if something changed.\r\n   */\r\n  override isNull(): boolean {\r\n    return this.oldValue === this.newValue;\r\n  }\r\n\r\n  /**\r\n   * Run a change event.\r\n   *\r\n   * @param forward True if run forward, false if run backward (undo).\r\n   */\r\n  override run(forward: boolean) {\r\n    const workspace = this.getEventWorkspace_();\r\n    if (!this.blockId) {\r\n      throw new Error(\r\n        'The block ID is undefined. Either pass a block to ' +\r\n          'the constructor, or call fromJson',\r\n      );\r\n    }\r\n    const block = workspace.getBlockById(this.blockId);\r\n    if (!block) {\r\n      throw new Error(\r\n        'The associated block is undefined. Either pass a ' +\r\n          'block to the constructor, or call fromJson',\r\n      );\r\n    }\r\n\r\n    const value = forward ? this.newValue : this.oldValue;\r\n    const field = block.getField(this.name!);\r\n    if (field) {\r\n      field.setValue(value);\r\n    } else {\r\n      console.warn(\"Can't set non-existent field: \" + this.name);\r\n    }\r\n  }\r\n}\r\n\r\nexport interface BlockFieldIntermediateChangeJson extends BlockBaseJson {\r\n  name: string;\r\n  newValue: unknown;\r\n  oldValue: unknown;\r\n}\r\n\r\nregistry.register(\r\n  registry.Type.EVENT,\r\n  eventUtils.BLOCK_FIELD_INTERMEDIATE_CHANGE,\r\n  BlockFieldIntermediateChange,\r\n);\r\n","/**\r\n * @license\r\n * Copyright 2018 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Class for a block move event.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.Events.BlockMove\r\n\r\nimport type {Block} from '../block.js';\r\nimport {ConnectionType} from '../connection_type.js';\r\nimport * as registry from '../registry.js';\r\nimport {Coordinate} from '../utils/coordinate.js';\r\n\r\nimport {BlockBase, BlockBaseJson} from './events_block_base.js';\r\nimport * as eventUtils from './utils.js';\r\nimport type {Workspace} from '../workspace.js';\r\n\r\ninterface BlockLocation {\r\n  parentId?: string;\r\n  inputName?: string;\r\n  coordinate?: Coordinate;\r\n}\r\n\r\n/**\r\n * Notifies listeners when a block is moved. This could be from one\r\n * connection to another, or from one location on the workspace to another.\r\n */\r\nexport class BlockMove extends BlockBase {\r\n  override type = eventUtils.BLOCK_MOVE;\r\n\r\n  /** The ID of the old parent block. Undefined if it was a top-level block. */\r\n  oldParentId?: string;\r\n\r\n  /**\r\n   * The name of the old input. Undefined if it was a top-level block or the\r\n   * parent's next block.\r\n   */\r\n  oldInputName?: string;\r\n\r\n  /**\r\n   * The old X and Y workspace coordinates of the block if it was a top level\r\n   * block. Undefined if it was not a top level block.\r\n   */\r\n  oldCoordinate?: Coordinate;\r\n\r\n  /** The ID of the new parent block. Undefined if it is a top-level block. */\r\n  newParentId?: string;\r\n\r\n  /**\r\n   * The name of the new input. Undefined if it is a top-level block or the\r\n   * parent's next block.\r\n   */\r\n  newInputName?: string;\r\n\r\n  /**\r\n   * The new X and Y workspace coordinates of the block if it is a top-level\r\n   * block. Undefined if it is not a top level block.\r\n   */\r\n  newCoordinate?: Coordinate;\r\n\r\n  /**\r\n   * An explanation of what this move is for.  Known values include:\r\n   *  'drag' -- A drag operation completed.\r\n   *  'bump' -- Block got bumped away from an invalid connection.\r\n   *  'snap' -- Block got shifted to line up with the grid.\r\n   *  'inbounds' -- Block got pushed back into a non-scrolling workspace.\r\n   *  'connect' -- Block got connected to another block.\r\n   *  'disconnect' -- Block got disconnected from another block.\r\n   *  'create' -- Block created via XML.\r\n   *  'cleanup' -- Workspace aligned top-level blocks.\r\n   * Event merging may create multiple reasons: ['drag', 'bump', 'snap'].\r\n   */\r\n  reason?: string[];\r\n\r\n  /** @param opt_block The moved block.  Undefined for a blank event. */\r\n  constructor(opt_block?: Block) {\r\n    super(opt_block);\r\n\r\n    if (!opt_block) {\r\n      return;\r\n    }\r\n    // Blank event to be populated by fromJson.\r\n    if (opt_block.isShadow()) {\r\n      // Moving shadow blocks is handled via disconnection.\r\n      this.recordUndo = false;\r\n    }\r\n\r\n    const location = this.currentLocation_();\r\n    this.oldParentId = location.parentId;\r\n    this.oldInputName = location.inputName;\r\n    this.oldCoordinate = location.coordinate;\r\n  }\r\n\r\n  /**\r\n   * Encode the event as JSON.\r\n   *\r\n   * @returns JSON representation.\r\n   */\r\n  override toJson(): BlockMoveJson {\r\n    const json = super.toJson() as BlockMoveJson;\r\n    json['oldParentId'] = this.oldParentId;\r\n    json['oldInputName'] = this.oldInputName;\r\n    if (this.oldCoordinate) {\r\n      json['oldCoordinate'] =\r\n        `${Math.round(this.oldCoordinate.x)}, ` +\r\n        `${Math.round(this.oldCoordinate.y)}`;\r\n    }\r\n    json['newParentId'] = this.newParentId;\r\n    json['newInputName'] = this.newInputName;\r\n    if (this.newCoordinate) {\r\n      json['newCoordinate'] =\r\n        `${Math.round(this.newCoordinate.x)}, ` +\r\n        `${Math.round(this.newCoordinate.y)}`;\r\n    }\r\n    if (this.reason) {\r\n      json['reason'] = this.reason;\r\n    }\r\n    if (!this.recordUndo) {\r\n      json['recordUndo'] = this.recordUndo;\r\n    }\r\n    return json;\r\n  }\r\n\r\n  /**\r\n   * Deserializes the JSON event.\r\n   *\r\n   * @param event The event to append new properties to. Should be a subclass\r\n   *     of BlockMove, but we can't specify that due to the fact that parameters\r\n   *     to static methods in subclasses must be supertypes of parameters to\r\n   *     static methods in superclasses.\r\n   * @internal\r\n   */\r\n  static fromJson(\r\n    json: BlockMoveJson,\r\n    workspace: Workspace,\r\n    event?: any,\r\n  ): BlockMove {\r\n    const newEvent = super.fromJson(\r\n      json,\r\n      workspace,\r\n      event ?? new BlockMove(),\r\n    ) as BlockMove;\r\n    newEvent.oldParentId = json['oldParentId'];\r\n    newEvent.oldInputName = json['oldInputName'];\r\n    if (json['oldCoordinate']) {\r\n      const xy = json['oldCoordinate'].split(',');\r\n      newEvent.oldCoordinate = new Coordinate(Number(xy[0]), Number(xy[1]));\r\n    }\r\n    newEvent.newParentId = json['newParentId'];\r\n    newEvent.newInputName = json['newInputName'];\r\n    if (json['newCoordinate']) {\r\n      const xy = json['newCoordinate'].split(',');\r\n      newEvent.newCoordinate = new Coordinate(Number(xy[0]), Number(xy[1]));\r\n    }\r\n    if (json['reason'] !== undefined) {\r\n      newEvent.reason = json['reason'];\r\n    }\r\n    if (json['recordUndo'] !== undefined) {\r\n      newEvent.recordUndo = json['recordUndo'];\r\n    }\r\n    return newEvent;\r\n  }\r\n\r\n  /** Record the block's new location.  Called after the move. */\r\n  recordNew() {\r\n    const location = this.currentLocation_();\r\n    this.newParentId = location.parentId;\r\n    this.newInputName = location.inputName;\r\n    this.newCoordinate = location.coordinate;\r\n  }\r\n\r\n  /**\r\n   * Set the reason for a move event.\r\n   *\r\n   * @param reason Why is this move happening?  'drag', 'bump', 'snap', ...\r\n   */\r\n  setReason(reason: string[]) {\r\n    this.reason = reason;\r\n  }\r\n\r\n  /**\r\n   * Returns the parentId and input if the block is connected,\r\n   *   or the XY location if disconnected.\r\n   *\r\n   * @returns Collection of location info.\r\n   */\r\n  private currentLocation_(): BlockLocation {\r\n    const workspace = this.getEventWorkspace_();\r\n    if (!this.blockId) {\r\n      throw new Error(\r\n        'The block ID is undefined. Either pass a block to ' +\r\n          'the constructor, or call fromJson',\r\n      );\r\n    }\r\n    const block = workspace.getBlockById(this.blockId);\r\n    if (!block) {\r\n      throw new Error(\r\n        'The block associated with the block move event ' +\r\n          'could not be found',\r\n      );\r\n    }\r\n    const location = {} as BlockLocation;\r\n    const parent = block.getParent();\r\n    if (parent) {\r\n      location.parentId = parent.id;\r\n      const input = parent.getInputWithBlock(block);\r\n      if (input) {\r\n        location.inputName = input.name;\r\n      }\r\n    } else {\r\n      location.coordinate = block.getRelativeToSurfaceXY();\r\n    }\r\n    return location;\r\n  }\r\n\r\n  /**\r\n   * Does this event record any change of state?\r\n   *\r\n   * @returns False if something changed.\r\n   */\r\n  override isNull(): boolean {\r\n    return (\r\n      this.oldParentId === this.newParentId &&\r\n      this.oldInputName === this.newInputName &&\r\n      Coordinate.equals(this.oldCoordinate, this.newCoordinate)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Run a move event.\r\n   *\r\n   * @param forward True if run forward, false if run backward (undo).\r\n   */\r\n  override run(forward: boolean) {\r\n    const workspace = this.getEventWorkspace_();\r\n    if (!this.blockId) {\r\n      throw new Error(\r\n        'The block ID is undefined. Either pass a block to ' +\r\n          'the constructor, or call fromJson',\r\n      );\r\n    }\r\n    const block = workspace.getBlockById(this.blockId);\r\n    if (!block) {\r\n      console.warn(\"Can't move non-existent block: \" + this.blockId);\r\n      return;\r\n    }\r\n    const parentId = forward ? this.newParentId : this.oldParentId;\r\n    const inputName = forward ? this.newInputName : this.oldInputName;\r\n    const coordinate = forward ? this.newCoordinate : this.oldCoordinate;\r\n    let parentBlock: Block | null;\r\n    if (parentId) {\r\n      parentBlock = workspace.getBlockById(parentId);\r\n      if (!parentBlock) {\r\n        console.warn(\"Can't connect to non-existent block: \" + parentId);\r\n        return;\r\n      }\r\n    }\r\n    if (block.getParent()) {\r\n      block.unplug();\r\n    }\r\n    if (coordinate) {\r\n      const xy = block.getRelativeToSurfaceXY();\r\n      block.moveBy(coordinate.x - xy.x, coordinate.y - xy.y, this.reason);\r\n    } else {\r\n      let blockConnection = block.outputConnection;\r\n      if (\r\n        !blockConnection ||\r\n        (block.previousConnection && block.previousConnection.isConnected())\r\n      ) {\r\n        blockConnection = block.previousConnection;\r\n      }\r\n      let parentConnection;\r\n      const connectionType = blockConnection?.type;\r\n      if (inputName) {\r\n        const input = parentBlock!.getInput(inputName);\r\n        if (input) {\r\n          parentConnection = input.connection;\r\n        }\r\n      } else if (connectionType === ConnectionType.PREVIOUS_STATEMENT) {\r\n        parentConnection = parentBlock!.nextConnection;\r\n      }\r\n      if (parentConnection && blockConnection) {\r\n        blockConnection.connect(parentConnection);\r\n      } else {\r\n        console.warn(\"Can't connect to non-existent input: \" + inputName);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport interface BlockMoveJson extends BlockBaseJson {\r\n  oldParentId?: string;\r\n  oldInputName?: string;\r\n  oldCoordinate?: string;\r\n  newParentId?: string;\r\n  newInputName?: string;\r\n  newCoordinate?: string;\r\n  reason?: string[];\r\n  recordUndo?: boolean;\r\n}\r\n\r\nregistry.register(registry.Type.EVENT, eventUtils.MOVE, BlockMove);\r\n","/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Events fired as a result of bubble open.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.Events.BubbleOpen\r\n\r\nimport type {AbstractEventJson} from './events_abstract.js';\r\nimport type {BlockSvg} from '../block_svg.js';\r\nimport * as registry from '../registry.js';\r\nimport {UiBase} from './events_ui_base.js';\r\nimport * as eventUtils from './utils.js';\r\nimport type {Workspace} from '../workspace.js';\r\n\r\n/**\r\n * Class for a bubble open event.\r\n */\r\nexport class BubbleOpen extends UiBase {\r\n  /** The ID of the block the bubble is attached to. */\r\n  blockId?: string;\r\n\r\n  /** True if the bubble is opening, false if closing. */\r\n  isOpen?: boolean;\r\n\r\n  /** The type of bubble; one of 'mutator', 'comment', or 'warning'. */\r\n  bubbleType?: BubbleType;\r\n\r\n  override type = eventUtils.BUBBLE_OPEN;\r\n\r\n  /**\r\n   * @param opt_block The associated block. Undefined for a blank event.\r\n   * @param opt_isOpen Whether the bubble is opening (false if closing).\r\n   *     Undefined for a blank event.\r\n   * @param opt_bubbleType The type of bubble. One of 'mutator', 'comment' or\r\n   *     'warning'. Undefined for a blank event.\r\n   */\r\n  constructor(\r\n    opt_block?: BlockSvg,\r\n    opt_isOpen?: boolean,\r\n    opt_bubbleType?: BubbleType,\r\n  ) {\r\n    const workspaceId = opt_block ? opt_block.workspace.id : undefined;\r\n    super(workspaceId);\r\n    if (!opt_block) return;\r\n\r\n    this.blockId = opt_block.id;\r\n    this.isOpen = opt_isOpen;\r\n    this.bubbleType = opt_bubbleType;\r\n  }\r\n\r\n  /**\r\n   * Encode the event as JSON.\r\n   *\r\n   * @returns JSON representation.\r\n   */\r\n  override toJson(): BubbleOpenJson {\r\n    const json = super.toJson() as BubbleOpenJson;\r\n    if (this.isOpen === undefined) {\r\n      throw new Error(\r\n        'Whether this event is for opening the bubble is undefined. ' +\r\n          'Either pass the value to the constructor, or call fromJson',\r\n      );\r\n    }\r\n    if (!this.bubbleType) {\r\n      throw new Error(\r\n        'The type of bubble is undefined. Either pass the ' +\r\n          'value to the constructor, or call fromJson',\r\n      );\r\n    }\r\n    json['isOpen'] = this.isOpen;\r\n    json['bubbleType'] = this.bubbleType;\r\n    json['blockId'] = this.blockId || '';\r\n    return json;\r\n  }\r\n\r\n  /**\r\n   * Deserializes the JSON event.\r\n   *\r\n   * @param event The event to append new properties to. Should be a subclass\r\n   *     of BubbleOpen, but we can't specify that due to the fact that\r\n   *     parameters to static methods in subclasses must be supertypes of\r\n   *     parameters to static methods in superclasses.\r\n   * @internal\r\n   */\r\n  static fromJson(\r\n    json: BubbleOpenJson,\r\n    workspace: Workspace,\r\n    event?: any,\r\n  ): BubbleOpen {\r\n    const newEvent = super.fromJson(\r\n      json,\r\n      workspace,\r\n      event ?? new BubbleOpen(),\r\n    ) as BubbleOpen;\r\n    newEvent.isOpen = json['isOpen'];\r\n    newEvent.bubbleType = json['bubbleType'];\r\n    newEvent.blockId = json['blockId'];\r\n    return newEvent;\r\n  }\r\n}\r\n\r\nexport enum BubbleType {\r\n  MUTATOR = 'mutator',\r\n  COMMENT = 'comment',\r\n  WARNING = 'warning',\r\n}\r\n\r\nexport interface BubbleOpenJson extends AbstractEventJson {\r\n  isOpen: boolean;\r\n  bubbleType: BubbleType;\r\n  blockId: string;\r\n}\r\n\r\nregistry.register(registry.Type.EVENT, eventUtils.BUBBLE_OPEN, BubbleOpen);\r\n","/**\r\n * @license\r\n * Copyright 2018 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Base class for comment events.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.Events.CommentBase\r\n\r\nimport * as utilsXml from '../utils/xml.js';\r\nimport type {WorkspaceComment} from '../workspace_comment.js';\r\nimport * as Xml from '../xml.js';\r\n\r\nimport {\r\n  Abstract as AbstractEvent,\r\n  AbstractEventJson,\r\n} from './events_abstract.js';\r\nimport type {CommentCreate} from './events_comment_create.js';\r\nimport type {CommentDelete} from './events_comment_delete.js';\r\nimport * as eventUtils from './utils.js';\r\nimport type {Workspace} from '../workspace.js';\r\n\r\n/**\r\n * Abstract class for a comment event.\r\n */\r\nexport class CommentBase extends AbstractEvent {\r\n  override isBlank = true;\r\n\r\n  /** The ID of the comment that this event references. */\r\n  commentId?: string;\r\n\r\n  /**\r\n   * @param opt_comment The comment this event corresponds to.  Undefined for a\r\n   *     blank event.\r\n   */\r\n  constructor(opt_comment?: WorkspaceComment) {\r\n    super();\r\n    /** Whether or not an event is blank. */\r\n    this.isBlank = !opt_comment;\r\n\r\n    if (!opt_comment) return;\r\n\r\n    this.commentId = opt_comment.id;\r\n    this.workspaceId = opt_comment.workspace.id;\r\n    this.group = eventUtils.getGroup();\r\n    this.recordUndo = eventUtils.getRecordUndo();\r\n  }\r\n\r\n  /**\r\n   * Encode the event as JSON.\r\n   *\r\n   * @returns JSON representation.\r\n   */\r\n  override toJson(): CommentBaseJson {\r\n    const json = super.toJson() as CommentBaseJson;\r\n    if (!this.commentId) {\r\n      throw new Error(\r\n        'The comment ID is undefined. Either pass a comment to ' +\r\n          'the constructor, or call fromJson',\r\n      );\r\n    }\r\n    json['commentId'] = this.commentId;\r\n    return json;\r\n  }\r\n\r\n  /**\r\n   * Deserializes the JSON event.\r\n   *\r\n   * @param event The event to append new properties to. Should be a subclass\r\n   *     of CommentBase, but we can't specify that due to the fact that\r\n   *     parameters to static methods in subclasses must be supertypes of\r\n   *     parameters to static methods in superclasses.\r\n   * @internal\r\n   */\r\n  static fromJson(\r\n    json: CommentBaseJson,\r\n    workspace: Workspace,\r\n    event?: any,\r\n  ): CommentBase {\r\n    const newEvent = super.fromJson(\r\n      json,\r\n      workspace,\r\n      event ?? new CommentBase(),\r\n    ) as CommentBase;\r\n    newEvent.commentId = json['commentId'];\r\n    return newEvent;\r\n  }\r\n\r\n  /**\r\n   * Helper function for Comment[Create|Delete]\r\n   *\r\n   * @param event The event to run.\r\n   * @param create if True then Create, if False then Delete\r\n   */\r\n  static CommentCreateDeleteHelper(\r\n    event: CommentCreate | CommentDelete,\r\n    create: boolean,\r\n  ) {\r\n    const workspace = event.getEventWorkspace_();\r\n    if (create) {\r\n      const xmlElement = utilsXml.createElement('xml');\r\n      if (!event.xml) {\r\n        throw new Error('Ecountered a comment event without proper xml');\r\n      }\r\n      xmlElement.appendChild(event.xml);\r\n      Xml.domToWorkspace(xmlElement, workspace);\r\n    } else {\r\n      if (!event.commentId) {\r\n        throw new Error(\r\n          'The comment ID is undefined. Either pass a comment to ' +\r\n            'the constructor, or call fromJson',\r\n        );\r\n      }\r\n      const comment = workspace.getCommentById(event.commentId);\r\n      if (comment) {\r\n        comment.dispose();\r\n      } else {\r\n        // Only complain about root-level block.\r\n        console.warn(\"Can't uncreate non-existent comment: \" + event.commentId);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport interface CommentBaseJson extends AbstractEventJson {\r\n  commentId: string;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2018 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Class for comment change event.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.Events.CommentChange\r\n\r\nimport * as registry from '../registry.js';\r\nimport type {WorkspaceComment} from '../workspace_comment.js';\r\n\r\nimport {CommentBase, CommentBaseJson} from './events_comment_base.js';\r\nimport * as eventUtils from './utils.js';\r\nimport type {Workspace} from '../workspace.js';\r\n\r\n/**\r\n * Notifies listeners that the contents of a workspace comment has changed.\r\n */\r\nexport class CommentChange extends CommentBase {\r\n  override type = eventUtils.COMMENT_CHANGE;\r\n\r\n  // TODO(#6774): We should remove underscores.\r\n  /** The previous contents of the comment. */\r\n  oldContents_?: string;\r\n\r\n  /** The new contents of the comment. */\r\n  newContents_?: string;\r\n\r\n  /**\r\n   * @param opt_comment The comment that is being changed.  Undefined for a\r\n   *     blank event.\r\n   * @param opt_oldContents Previous contents of the comment.\r\n   * @param opt_newContents New contents of the comment.\r\n   */\r\n  constructor(\r\n    opt_comment?: WorkspaceComment,\r\n    opt_oldContents?: string,\r\n    opt_newContents?: string,\r\n  ) {\r\n    super(opt_comment);\r\n\r\n    if (!opt_comment) {\r\n      return; // Blank event to be populated by fromJson.\r\n    }\r\n\r\n    this.oldContents_ =\r\n      typeof opt_oldContents === 'undefined' ? '' : opt_oldContents;\r\n    this.newContents_ =\r\n      typeof opt_newContents === 'undefined' ? '' : opt_newContents;\r\n  }\r\n\r\n  /**\r\n   * Encode the event as JSON.\r\n   *\r\n   * @returns JSON representation.\r\n   */\r\n  override toJson(): CommentChangeJson {\r\n    const json = super.toJson() as CommentChangeJson;\r\n    if (!this.oldContents_) {\r\n      throw new Error(\r\n        'The old contents is undefined. Either pass a value to ' +\r\n          'the constructor, or call fromJson',\r\n      );\r\n    }\r\n    if (!this.newContents_) {\r\n      throw new Error(\r\n        'The new contents is undefined. Either pass a value to ' +\r\n          'the constructor, or call fromJson',\r\n      );\r\n    }\r\n    json['oldContents'] = this.oldContents_;\r\n    json['newContents'] = this.newContents_;\r\n    return json;\r\n  }\r\n\r\n  /**\r\n   * Deserializes the JSON event.\r\n   *\r\n   * @param event The event to append new properties to. Should be a subclass\r\n   *     of CommentChange, but we can't specify that due to the fact that\r\n   *     parameters to static methods in subclasses must be supertypes of\r\n   *     parameters to static methods in superclasses.\r\n   * @internal\r\n   */\r\n  static fromJson(\r\n    json: CommentChangeJson,\r\n    workspace: Workspace,\r\n    event?: any,\r\n  ): CommentChange {\r\n    const newEvent = super.fromJson(\r\n      json,\r\n      workspace,\r\n      event ?? new CommentChange(),\r\n    ) as CommentChange;\r\n    newEvent.oldContents_ = json['oldContents'];\r\n    newEvent.newContents_ = json['newContents'];\r\n    return newEvent;\r\n  }\r\n\r\n  /**\r\n   * Does this event record any change of state?\r\n   *\r\n   * @returns False if something changed.\r\n   */\r\n  override isNull(): boolean {\r\n    return this.oldContents_ === this.newContents_;\r\n  }\r\n\r\n  /**\r\n   * Run a change event.\r\n   *\r\n   * @param forward True if run forward, false if run backward (undo).\r\n   */\r\n  override run(forward: boolean) {\r\n    const workspace = this.getEventWorkspace_();\r\n    if (!this.commentId) {\r\n      throw new Error(\r\n        'The comment ID is undefined. Either pass a comment to ' +\r\n          'the constructor, or call fromJson',\r\n      );\r\n    }\r\n    const comment = workspace.getCommentById(this.commentId);\r\n    if (!comment) {\r\n      console.warn(\"Can't change non-existent comment: \" + this.commentId);\r\n      return;\r\n    }\r\n    const contents = forward ? this.newContents_ : this.oldContents_;\r\n    if (!contents) {\r\n      if (forward) {\r\n        throw new Error(\r\n          'The new contents is undefined. Either pass a value to ' +\r\n            'the constructor, or call fromJson',\r\n        );\r\n      }\r\n      throw new Error(\r\n        'The old contents is undefined. Either pass a value to ' +\r\n          'the constructor, or call fromJson',\r\n      );\r\n    }\r\n    comment.setContent(contents);\r\n  }\r\n}\r\n\r\nexport interface CommentChangeJson extends CommentBaseJson {\r\n  oldContents: string;\r\n  newContents: string;\r\n}\r\n\r\nregistry.register(\r\n  registry.Type.EVENT,\r\n  eventUtils.COMMENT_CHANGE,\r\n  CommentChange,\r\n);\r\n","/**\r\n * @license\r\n * Copyright 2018 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Class for comment creation event.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.Events.CommentCreate\r\n\r\nimport * as registry from '../registry.js';\r\nimport type {WorkspaceComment} from '../workspace_comment.js';\r\nimport * as utilsXml from '../utils/xml.js';\r\nimport * as Xml from '../xml.js';\r\n\r\nimport {CommentBase, CommentBaseJson} from './events_comment_base.js';\r\nimport * as eventUtils from './utils.js';\r\nimport type {Workspace} from '../workspace.js';\r\n\r\n/**\r\n * Notifies listeners that a workspace comment was created.\r\n */\r\nexport class CommentCreate extends CommentBase {\r\n  override type = eventUtils.COMMENT_CREATE;\r\n\r\n  /** The XML representation of the created workspace comment. */\r\n  xml?: Element | DocumentFragment;\r\n\r\n  /**\r\n   * @param opt_comment The created comment.\r\n   *     Undefined for a blank event.\r\n   */\r\n  constructor(opt_comment?: WorkspaceComment) {\r\n    super(opt_comment);\r\n\r\n    if (!opt_comment) {\r\n      return;\r\n    }\r\n    // Blank event to be populated by fromJson.\r\n    this.xml = opt_comment.toXmlWithXY();\r\n  }\r\n\r\n  // TODO (#1266): \"Full\" and \"minimal\" serialization.\r\n  /**\r\n   * Encode the event as JSON.\r\n   *\r\n   * @returns JSON representation.\r\n   */\r\n  override toJson(): CommentCreateJson {\r\n    const json = super.toJson() as CommentCreateJson;\r\n    if (!this.xml) {\r\n      throw new Error(\r\n        'The comment XML is undefined. Either pass a comment to ' +\r\n          'the constructor, or call fromJson',\r\n      );\r\n    }\r\n    json['xml'] = Xml.domToText(this.xml);\r\n    return json;\r\n  }\r\n\r\n  /**\r\n   * Deserializes the JSON event.\r\n   *\r\n   * @param event The event to append new properties to. Should be a subclass\r\n   *     of CommentCreate, but we can't specify that due to the fact that\r\n   *     parameters to static methods in subclasses must be supertypes of\r\n   *     parameters to static methods in superclasses.\r\n   * @internal\r\n   */\r\n  static fromJson(\r\n    json: CommentCreateJson,\r\n    workspace: Workspace,\r\n    event?: any,\r\n  ): CommentCreate {\r\n    const newEvent = super.fromJson(\r\n      json,\r\n      workspace,\r\n      event ?? new CommentCreate(),\r\n    ) as CommentCreate;\r\n    newEvent.xml = utilsXml.textToDom(json['xml']);\r\n    return newEvent;\r\n  }\r\n\r\n  /**\r\n   * Run a creation event.\r\n   *\r\n   * @param forward True if run forward, false if run backward (undo).\r\n   */\r\n  override run(forward: boolean) {\r\n    CommentBase.CommentCreateDeleteHelper(this, forward);\r\n  }\r\n}\r\n\r\nexport interface CommentCreateJson extends CommentBaseJson {\r\n  xml: string;\r\n}\r\n\r\nregistry.register(\r\n  registry.Type.EVENT,\r\n  eventUtils.COMMENT_CREATE,\r\n  CommentCreate,\r\n);\r\n","/**\r\n * @license\r\n * Copyright 2018 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Class for comment deletion event.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.Events.CommentDelete\r\n\r\nimport * as registry from '../registry.js';\r\nimport type {WorkspaceComment} from '../workspace_comment.js';\r\n\r\nimport {CommentBase, CommentBaseJson} from './events_comment_base.js';\r\nimport * as eventUtils from './utils.js';\r\nimport * as utilsXml from '../utils/xml.js';\r\nimport * as Xml from '../xml.js';\r\nimport type {Workspace} from '../workspace.js';\r\n\r\n/**\r\n * Notifies listeners that a workspace comment has been deleted.\r\n */\r\nexport class CommentDelete extends CommentBase {\r\n  override type = eventUtils.COMMENT_DELETE;\r\n\r\n  /** The XML representation of the deleted workspace comment. */\r\n  xml?: Element;\r\n\r\n  /**\r\n   * @param opt_comment The deleted comment.\r\n   *     Undefined for a blank event.\r\n   */\r\n  constructor(opt_comment?: WorkspaceComment) {\r\n    super(opt_comment);\r\n\r\n    if (!opt_comment) {\r\n      return; // Blank event to be populated by fromJson.\r\n    }\r\n\r\n    this.xml = opt_comment.toXmlWithXY();\r\n  }\r\n\r\n  /**\r\n   * Run a creation event.\r\n   *\r\n   * @param forward True if run forward, false if run backward (undo).\r\n   */\r\n  override run(forward: boolean) {\r\n    CommentBase.CommentCreateDeleteHelper(this, !forward);\r\n  }\r\n\r\n  /**\r\n   * Encode the event as JSON.\r\n   *\r\n   * @returns JSON representation.\r\n   */\r\n  override toJson(): CommentDeleteJson {\r\n    const json = super.toJson() as CommentDeleteJson;\r\n    if (!this.xml) {\r\n      throw new Error(\r\n        'The comment XML is undefined. Either pass a comment to ' +\r\n          'the constructor, or call fromJson',\r\n      );\r\n    }\r\n    json['xml'] = Xml.domToText(this.xml);\r\n    return json;\r\n  }\r\n\r\n  /**\r\n   * Deserializes the JSON event.\r\n   *\r\n   * @param event The event to append new properties to. Should be a subclass\r\n   *     of CommentDelete, but we can't specify that due to the fact that\r\n   *     parameters to static methods in subclasses must be supertypes of\r\n   *     parameters to static methods in superclasses.\r\n   * @internal\r\n   */\r\n  static fromJson(\r\n    json: CommentDeleteJson,\r\n    workspace: Workspace,\r\n    event?: any,\r\n  ): CommentDelete {\r\n    const newEvent = super.fromJson(\r\n      json,\r\n      workspace,\r\n      event ?? new CommentDelete(),\r\n    ) as CommentDelete;\r\n    newEvent.xml = utilsXml.textToDom(json['xml']);\r\n    return newEvent;\r\n  }\r\n}\r\n\r\nexport interface CommentDeleteJson extends CommentBaseJson {\r\n  xml: string;\r\n}\r\n\r\nregistry.register(\r\n  registry.Type.EVENT,\r\n  eventUtils.COMMENT_DELETE,\r\n  CommentDelete,\r\n);\r\n","/**\r\n * @license\r\n * Copyright 2018 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Class for comment move event.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.Events.CommentMove\r\n\r\nimport * as registry from '../registry.js';\r\nimport {Coordinate} from '../utils/coordinate.js';\r\nimport type {WorkspaceComment} from '../workspace_comment.js';\r\n\r\nimport {CommentBase, CommentBaseJson} from './events_comment_base.js';\r\nimport * as eventUtils from './utils.js';\r\nimport type {Workspace} from '../workspace.js';\r\n\r\n/**\r\n * Notifies listeners that a workspace comment has moved.\r\n */\r\nexport class CommentMove extends CommentBase {\r\n  override type = eventUtils.COMMENT_MOVE;\r\n\r\n  /** The comment that is being moved. */\r\n  comment_?: WorkspaceComment;\r\n\r\n  // TODO(#6774): We should remove underscores.\r\n  /** The location of the comment before the move, in workspace coordinates. */\r\n  oldCoordinate_?: Coordinate;\r\n\r\n  /** The location of the comment after the move, in workspace coordinates. */\r\n  newCoordinate_?: Coordinate;\r\n\r\n  /**\r\n   * @param opt_comment The comment that is being moved.  Undefined for a blank\r\n   *     event.\r\n   */\r\n  constructor(opt_comment?: WorkspaceComment) {\r\n    super(opt_comment);\r\n\r\n    if (!opt_comment) {\r\n      return; // Blank event to be populated by fromJson.\r\n    }\r\n\r\n    this.comment_ = opt_comment;\r\n    this.oldCoordinate_ = opt_comment.getRelativeToSurfaceXY();\r\n  }\r\n\r\n  /**\r\n   * Record the comment's new location.  Called after the move.  Can only be\r\n   * called once.\r\n   */\r\n  recordNew() {\r\n    if (this.newCoordinate_) {\r\n      throw Error(\r\n        'Tried to record the new position of a comment on the ' +\r\n          'same event twice.',\r\n      );\r\n    }\r\n    if (!this.comment_) {\r\n      throw new Error(\r\n        'The comment is undefined. Pass a comment to ' +\r\n          'the constructor if you want to use the record functionality',\r\n      );\r\n    }\r\n    this.newCoordinate_ = this.comment_.getRelativeToSurfaceXY();\r\n  }\r\n\r\n  /**\r\n   * Override the location before the move.  Use this if you don't create the\r\n   * event until the end of the move, but you know the original location.\r\n   *\r\n   * @param xy The location before the move, in workspace coordinates.\r\n   */\r\n  setOldCoordinate(xy: Coordinate) {\r\n    this.oldCoordinate_ = xy;\r\n  }\r\n\r\n  // TODO (#1266): \"Full\" and \"minimal\" serialization.\r\n  /**\r\n   * Encode the event as JSON.\r\n   *\r\n   * @returns JSON representation.\r\n   */\r\n  override toJson(): CommentMoveJson {\r\n    const json = super.toJson() as CommentMoveJson;\r\n    if (!this.oldCoordinate_) {\r\n      throw new Error(\r\n        'The old comment position is undefined. Either pass a comment to ' +\r\n          'the constructor, or call fromJson',\r\n      );\r\n    }\r\n    if (!this.newCoordinate_) {\r\n      throw new Error(\r\n        'The new comment position is undefined. Either call recordNew, or ' +\r\n          'call fromJson',\r\n      );\r\n    }\r\n    json['oldCoordinate'] =\r\n      `${Math.round(this.oldCoordinate_.x)}, ` +\r\n      `${Math.round(this.oldCoordinate_.y)}`;\r\n    json['newCoordinate'] =\r\n      Math.round(this.newCoordinate_.x) +\r\n      ',' +\r\n      Math.round(this.newCoordinate_.y);\r\n    return json;\r\n  }\r\n\r\n  /**\r\n   * Deserializes the JSON event.\r\n   *\r\n   * @param event The event to append new properties to. Should be a subclass\r\n   *     of CommentMove, but we can't specify that due to the fact that\r\n   *     parameters to static methods in subclasses must be supertypes of\r\n   *     parameters to static methods in superclasses.\r\n   * @internal\r\n   */\r\n  static fromJson(\r\n    json: CommentMoveJson,\r\n    workspace: Workspace,\r\n    event?: any,\r\n  ): CommentMove {\r\n    const newEvent = super.fromJson(\r\n      json,\r\n      workspace,\r\n      event ?? new CommentMove(),\r\n    ) as CommentMove;\r\n    let xy = json['oldCoordinate'].split(',');\r\n    newEvent.oldCoordinate_ = new Coordinate(Number(xy[0]), Number(xy[1]));\r\n    xy = json['newCoordinate'].split(',');\r\n    newEvent.newCoordinate_ = new Coordinate(Number(xy[0]), Number(xy[1]));\r\n    return newEvent;\r\n  }\r\n\r\n  /**\r\n   * Does this event record any change of state?\r\n   *\r\n   * @returns False if something changed.\r\n   */\r\n  override isNull(): boolean {\r\n    return Coordinate.equals(this.oldCoordinate_, this.newCoordinate_);\r\n  }\r\n\r\n  /**\r\n   * Run a move event.\r\n   *\r\n   * @param forward True if run forward, false if run backward (undo).\r\n   */\r\n  override run(forward: boolean) {\r\n    const workspace = this.getEventWorkspace_();\r\n    if (!this.commentId) {\r\n      throw new Error(\r\n        'The comment ID is undefined. Either pass a comment to ' +\r\n          'the constructor, or call fromJson',\r\n      );\r\n    }\r\n    const comment = workspace.getCommentById(this.commentId);\r\n    if (!comment) {\r\n      console.warn(\"Can't move non-existent comment: \" + this.commentId);\r\n      return;\r\n    }\r\n\r\n    const target = forward ? this.newCoordinate_ : this.oldCoordinate_;\r\n    if (!target) {\r\n      throw new Error(\r\n        'Either oldCoordinate_ or newCoordinate_ is undefined. ' +\r\n          'Either pass a comment to the constructor and call recordNew, ' +\r\n          'or call fromJson',\r\n      );\r\n    }\r\n    // TODO: Check if the comment is being dragged, and give up if so.\r\n    const current = comment.getRelativeToSurfaceXY();\r\n    comment.moveBy(target.x - current.x, target.y - current.y);\r\n  }\r\n}\r\n\r\nexport interface CommentMoveJson extends CommentBaseJson {\r\n  oldCoordinate: string;\r\n  newCoordinate: string;\r\n}\r\n\r\nregistry.register(registry.Type.EVENT, eventUtils.COMMENT_MOVE, CommentMove);\r\n","/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Events fired as a result of selecting an item on the toolbox.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.Events.ToolboxItemSelect\r\n\r\nimport * as registry from '../registry.js';\r\nimport {AbstractEventJson} from './events_abstract.js';\r\nimport {UiBase} from './events_ui_base.js';\r\nimport * as eventUtils from './utils.js';\r\nimport type {Workspace} from '../workspace.js';\r\n\r\n/**\r\n * Notifies listeners that a toolbox item has been selected.\r\n */\r\nexport class ToolboxItemSelect extends UiBase {\r\n  /** The previously selected toolbox item. */\r\n  oldItem?: string;\r\n\r\n  /** The newly selected toolbox item. */\r\n  newItem?: string;\r\n\r\n  override type = eventUtils.TOOLBOX_ITEM_SELECT;\r\n\r\n  /**\r\n   * @param opt_oldItem The previously selected toolbox item.\r\n   *     Undefined for a blank event.\r\n   * @param opt_newItem The newly selected toolbox item. Undefined for a blank\r\n   *     event.\r\n   * @param opt_workspaceId The workspace identifier for this event.\r\n   *    Undefined for a blank event.\r\n   */\r\n  constructor(\r\n    opt_oldItem?: string | null,\r\n    opt_newItem?: string | null,\r\n    opt_workspaceId?: string,\r\n  ) {\r\n    super(opt_workspaceId);\r\n    this.oldItem = opt_oldItem ?? undefined;\r\n    this.newItem = opt_newItem ?? undefined;\r\n  }\r\n\r\n  /**\r\n   * Encode the event as JSON.\r\n   *\r\n   * @returns JSON representation.\r\n   */\r\n  override toJson(): ToolboxItemSelectJson {\r\n    const json = super.toJson() as ToolboxItemSelectJson;\r\n    json['oldItem'] = this.oldItem;\r\n    json['newItem'] = this.newItem;\r\n    return json;\r\n  }\r\n\r\n  /**\r\n   * Deserializes the JSON event.\r\n   *\r\n   * @param event The event to append new properties to. Should be a subclass\r\n   *     of ToolboxItemSelect, but we can't specify that due to the fact that\r\n   *     parameters to static methods in subclasses must be supertypes of\r\n   *     parameters to static methods in superclasses.\r\n   * @internal\r\n   */\r\n  static fromJson(\r\n    json: ToolboxItemSelectJson,\r\n    workspace: Workspace,\r\n    event?: any,\r\n  ): ToolboxItemSelect {\r\n    const newEvent = super.fromJson(\r\n      json,\r\n      workspace,\r\n      event ?? new ToolboxItemSelect(),\r\n    ) as ToolboxItemSelect;\r\n    newEvent.oldItem = json['oldItem'];\r\n    newEvent.newItem = json['newItem'];\r\n    return newEvent;\r\n  }\r\n}\r\n\r\nexport interface ToolboxItemSelectJson extends AbstractEventJson {\r\n  oldItem?: string;\r\n  newItem?: string;\r\n}\r\n\r\nregistry.register(\r\n  registry.Type.EVENT,\r\n  eventUtils.TOOLBOX_ITEM_SELECT,\r\n  ToolboxItemSelect,\r\n);\r\n","/**\r\n * @license\r\n * Copyright 2016 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.Events\r\n\r\nimport {Abstract, AbstractEventJson} from './events_abstract.js';\r\nimport {BlockBase, BlockBaseJson} from './events_block_base.js';\r\nimport {BlockChange, BlockChangeJson} from './events_block_change.js';\r\nimport {BlockCreate, BlockCreateJson} from './events_block_create.js';\r\nimport {BlockDelete, BlockDeleteJson} from './events_block_delete.js';\r\nimport {BlockDrag, BlockDragJson} from './events_block_drag.js';\r\nimport {\r\n  BlockFieldIntermediateChange,\r\n  BlockFieldIntermediateChangeJson,\r\n} from './events_block_field_intermediate_change.js';\r\nimport {BlockMove, BlockMoveJson} from './events_block_move.js';\r\nimport {BubbleOpen, BubbleOpenJson, BubbleType} from './events_bubble_open.js';\r\nimport {Click, ClickJson, ClickTarget} from './events_click.js';\r\nimport {CommentBase, CommentBaseJson} from './events_comment_base.js';\r\nimport {CommentChange, CommentChangeJson} from './events_comment_change.js';\r\nimport {CommentCreate, CommentCreateJson} from './events_comment_create.js';\r\nimport {CommentDelete} from './events_comment_delete.js';\r\nimport {CommentMove, CommentMoveJson} from './events_comment_move.js';\r\nimport {MarkerMove, MarkerMoveJson} from './events_marker_move.js';\r\nimport {Selected, SelectedJson} from './events_selected.js';\r\nimport {ThemeChange, ThemeChangeJson} from './events_theme_change.js';\r\nimport {\r\n  ToolboxItemSelect,\r\n  ToolboxItemSelectJson,\r\n} from './events_toolbox_item_select.js';\r\nimport {TrashcanOpen, TrashcanOpenJson} from './events_trashcan_open.js';\r\nimport {UiBase} from './events_ui_base.js';\r\nimport {VarBase, VarBaseJson} from './events_var_base.js';\r\nimport {VarCreate, VarCreateJson} from './events_var_create.js';\r\nimport {VarDelete, VarDeleteJson} from './events_var_delete.js';\r\nimport {VarRename, VarRenameJson} from './events_var_rename.js';\r\nimport {ViewportChange, ViewportChangeJson} from './events_viewport.js';\r\nimport * as eventUtils from './utils.js';\r\nimport {FinishedLoading} from './workspace_events.js';\r\n\r\n// Events.\r\nexport {Abstract};\r\nexport {AbstractEventJson};\r\nexport {BubbleOpen};\r\nexport {BubbleOpenJson};\r\nexport {BubbleType};\r\nexport {BlockBase};\r\nexport {BlockBaseJson};\r\nexport {BlockChange};\r\nexport {BlockChangeJson};\r\nexport {BlockCreate};\r\nexport {BlockCreateJson};\r\nexport {BlockDelete};\r\nexport {BlockDeleteJson};\r\nexport {BlockDrag};\r\nexport {BlockDragJson};\r\nexport {BlockFieldIntermediateChange};\r\nexport {BlockFieldIntermediateChangeJson};\r\nexport {BlockMove};\r\nexport {BlockMoveJson};\r\nexport {Click};\r\nexport {ClickJson};\r\nexport {ClickTarget};\r\nexport {CommentBase};\r\nexport {CommentBaseJson};\r\nexport {CommentChange};\r\nexport {CommentChangeJson};\r\nexport {CommentCreate};\r\nexport {CommentCreateJson};\r\nexport {CommentDelete};\r\nexport {CommentMove};\r\nexport {CommentMoveJson};\r\nexport {FinishedLoading};\r\nexport {MarkerMove};\r\nexport {MarkerMoveJson};\r\nexport {Selected};\r\nexport {SelectedJson};\r\nexport {ThemeChange};\r\nexport {ThemeChangeJson};\r\nexport {ToolboxItemSelect};\r\nexport {ToolboxItemSelectJson};\r\nexport {TrashcanOpen};\r\nexport {TrashcanOpenJson};\r\nexport {UiBase};\r\nexport {VarBase};\r\nexport {VarBaseJson};\r\nexport {VarCreate};\r\nexport {VarCreateJson};\r\nexport {VarDelete};\r\nexport {VarDeleteJson};\r\nexport {VarRename};\r\nexport {VarRenameJson};\r\nexport {ViewportChange};\r\nexport {ViewportChangeJson};\r\n\r\n// Event types.\r\nexport const BLOCK_CHANGE = eventUtils.BLOCK_CHANGE;\r\nexport const BLOCK_CREATE = eventUtils.BLOCK_CREATE;\r\nexport const BLOCK_DELETE = eventUtils.BLOCK_DELETE;\r\nexport const BLOCK_DRAG = eventUtils.BLOCK_DRAG;\r\nexport const BLOCK_MOVE = eventUtils.BLOCK_MOVE;\r\nexport const BLOCK_FIELD_INTERMEDIATE_CHANGE =\r\n  eventUtils.BLOCK_FIELD_INTERMEDIATE_CHANGE;\r\nexport const BUBBLE_OPEN = eventUtils.BUBBLE_OPEN;\r\nexport type BumpEvent = eventUtils.BumpEvent;\r\nexport const BUMP_EVENTS = eventUtils.BUMP_EVENTS;\r\nexport const CHANGE = eventUtils.CHANGE;\r\nexport const CLICK = eventUtils.CLICK;\r\nexport const COMMENT_CHANGE = eventUtils.COMMENT_CHANGE;\r\nexport const COMMENT_CREATE = eventUtils.COMMENT_CREATE;\r\nexport const COMMENT_DELETE = eventUtils.COMMENT_DELETE;\r\nexport const COMMENT_MOVE = eventUtils.COMMENT_MOVE;\r\nexport const CREATE = eventUtils.CREATE;\r\nexport const DELETE = eventUtils.DELETE;\r\nexport const FINISHED_LOADING = eventUtils.FINISHED_LOADING;\r\nexport const MARKER_MOVE = eventUtils.MARKER_MOVE;\r\nexport const MOVE = eventUtils.MOVE;\r\nexport const SELECTED = eventUtils.SELECTED;\r\nexport const THEME_CHANGE = eventUtils.THEME_CHANGE;\r\nexport const TOOLBOX_ITEM_SELECT = eventUtils.TOOLBOX_ITEM_SELECT;\r\nexport const TRASHCAN_OPEN = eventUtils.TRASHCAN_OPEN;\r\nexport const UI = eventUtils.UI;\r\nexport const VAR_CREATE = eventUtils.VAR_CREATE;\r\nexport const VAR_DELETE = eventUtils.VAR_DELETE;\r\nexport const VAR_RENAME = eventUtils.VAR_RENAME;\r\nexport const VIEWPORT_CHANGE = eventUtils.VIEWPORT_CHANGE;\r\n\r\n// Event utils.\r\nexport const clearPendingUndo = eventUtils.clearPendingUndo;\r\nexport const disable = eventUtils.disable;\r\nexport const enable = eventUtils.enable;\r\nexport const filter = eventUtils.filter;\r\nexport const fire = eventUtils.fire;\r\nexport const fromJson = eventUtils.fromJson;\r\nexport const getDescendantIds = eventUtils.getDescendantIds;\r\nexport const get = eventUtils.get;\r\nexport const getGroup = eventUtils.getGroup;\r\nexport const getRecordUndo = eventUtils.getRecordUndo;\r\nexport const isEnabled = eventUtils.isEnabled;\r\nexport const setGroup = eventUtils.setGroup;\r\nexport const setRecordUndo = eventUtils.setRecordUndo;\r\nexport const disableOrphans = eventUtils.disableOrphans;\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.zelos.ConstantProvider\r\n\r\nimport {ConnectionType} from '../../connection_type.js';\r\nimport type {RenderedConnection} from '../../rendered_connection.js';\r\nimport type {Theme} from '../../theme.js';\r\nimport * as utilsColour from '../../utils/colour.js';\r\nimport * as dom from '../../utils/dom.js';\r\nimport {Svg} from '../../utils/svg.js';\r\nimport * as svgPaths from '../../utils/svg_paths.js';\r\nimport {ConstantProvider as BaseConstantProvider} from '../common/constants.js';\r\nimport type {Shape} from '../common/constants.js';\r\n\r\n/** An object containing sizing and path information about inside corners. */\r\nexport interface InsideCorners {\r\n  width: number;\r\n  height: number;\r\n  pathTop: string;\r\n  pathBottom: string;\r\n  rightWidth: number;\r\n  rightHeight: number;\r\n  pathTopRight: string;\r\n  pathBottomRight: string;\r\n}\r\n\r\n/**\r\n * An object that provides constants for rendering blocks in Zelos mode.\r\n */\r\nexport class ConstantProvider extends BaseConstantProvider {\r\n  GRID_UNIT = 4;\r\n  STATEMENT_INPUT_SPACER_MIN_WIDTH: number;\r\n\r\n  override CURSOR_COLOUR = '#ffa200';\r\n\r\n  /**\r\n   * Radius of the cursor for input and output connections.\r\n   */\r\n  CURSOR_RADIUS = 5;\r\n\r\n  override JAGGED_TEETH_HEIGHT = 0;\r\n\r\n  override JAGGED_TEETH_WIDTH = 0;\r\n  override START_HAT_HEIGHT = 22;\r\n\r\n  override START_HAT_WIDTH = 96;\r\n\r\n  override SHAPES = {HEXAGONAL: 1, ROUND: 2, SQUARE: 3, PUZZLE: 4, NOTCH: 5};\r\n\r\n  /**\r\n   * Map of output/input shapes and the amount they should cause a block to be\r\n   * padded. Outer key is the outer shape, inner key is the inner shape.\r\n   * When a block with the outer shape contains an input block with the inner\r\n   * shape on its left or right edge, the block elements are aligned such that\r\n   * the padding specified is reached.\r\n   */\r\n  SHAPE_IN_SHAPE_PADDING: {[key: number]: {[key: number]: number}} = {\r\n    1: {\r\n      // Outer shape: hexagon.\r\n      0: 5 * this.GRID_UNIT, // Field in hexagon.\r\n      1: 2 * this.GRID_UNIT, // Hexagon in hexagon.\r\n      2: 5 * this.GRID_UNIT, // Round in hexagon.\r\n      3: 5 * this.GRID_UNIT, // Square in hexagon.\r\n    },\r\n    2: {\r\n      // Outer shape: round.\r\n      0: 3 * this.GRID_UNIT, // Field in round.\r\n      1: 3 * this.GRID_UNIT, // Hexagon in round.\r\n      2: 1 * this.GRID_UNIT, // Round in round.\r\n      3: 2 * this.GRID_UNIT, // Square in round.\r\n    },\r\n    3: {\r\n      // Outer shape: square.\r\n      0: 2 * this.GRID_UNIT, // Field in square.\r\n      1: 2 * this.GRID_UNIT, // Hexagon in square.\r\n      2: 2 * this.GRID_UNIT, // Round in square.\r\n      3: 2 * this.GRID_UNIT, // Square in square.\r\n    },\r\n  };\r\n\r\n  override FULL_BLOCK_FIELDS = true;\r\n\r\n  override FIELD_TEXT_FONTWEIGHT = 'bold';\r\n\r\n  override FIELD_TEXT_FONTFAMILY =\r\n    '\"Helvetica Neue\", \"Segoe UI\", Helvetica, sans-serif';\r\n\r\n  override FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW = true;\r\n\r\n  override FIELD_DROPDOWN_COLOURED_DIV = true;\r\n\r\n  override FIELD_DROPDOWN_SVG_ARROW = true;\r\n  override FIELD_TEXTINPUT_BOX_SHADOW = true;\r\n\r\n  override FIELD_COLOUR_FULL_BLOCK = true;\r\n  MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH: number;\r\n\r\n  /** The selected glow colour. */\r\n  SELECTED_GLOW_COLOUR = '#fff200';\r\n\r\n  /** The size of the selected glow. */\r\n  SELECTED_GLOW_SIZE = 0.5;\r\n\r\n  /** The replacement glow colour. */\r\n  REPLACEMENT_GLOW_COLOUR = '#fff200';\r\n\r\n  /** The size of the selected glow. */\r\n  REPLACEMENT_GLOW_SIZE = 2;\r\n\r\n  /**\r\n   * The ID of the selected glow filter, or the empty string if no filter is\r\n   * set.\r\n   */\r\n  selectedGlowFilterId = '';\r\n\r\n  /**\r\n   * The <filter> element to use for a selected glow, or null if not set.\r\n   */\r\n  private selectedGlowFilter: SVGElement | null = null;\r\n\r\n  /**\r\n   * The ID of the replacement glow filter, or the empty string if no filter\r\n   * is set.\r\n   */\r\n  replacementGlowFilterId = '';\r\n\r\n  /**\r\n   * The <filter> element to use for a replacement glow, or null if not set.\r\n   */\r\n  private replacementGlowFilter: SVGElement | null = null;\r\n\r\n  /**\r\n   * The object containing information about the hexagon used for a boolean\r\n   * reporter block. Null before init is called.\r\n   */\r\n  HEXAGONAL: Shape | null = null;\r\n\r\n  /**\r\n   * The object containing information about the hexagon used for a number or\r\n   * string reporter block. Null before init is called.\r\n   */\r\n  ROUNDED: Shape | null = null;\r\n\r\n  /**\r\n   * The object containing information about the hexagon used for a\r\n   * rectangular reporter block. Null before init is called.\r\n   */\r\n  SQUARED: Shape | null = null;\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    this.SMALL_PADDING = this.GRID_UNIT;\r\n\r\n    this.MEDIUM_PADDING = 2 * this.GRID_UNIT;\r\n\r\n    this.MEDIUM_LARGE_PADDING = 3 * this.GRID_UNIT;\r\n\r\n    this.LARGE_PADDING = 4 * this.GRID_UNIT;\r\n\r\n    this.CORNER_RADIUS = 1 * this.GRID_UNIT;\r\n\r\n    this.NOTCH_WIDTH = 9 * this.GRID_UNIT;\r\n\r\n    this.NOTCH_HEIGHT = 2 * this.GRID_UNIT;\r\n\r\n    this.NOTCH_OFFSET_LEFT = 3 * this.GRID_UNIT;\r\n\r\n    this.STATEMENT_INPUT_NOTCH_OFFSET = this.NOTCH_OFFSET_LEFT;\r\n\r\n    this.MIN_BLOCK_WIDTH = 2 * this.GRID_UNIT;\r\n\r\n    this.MIN_BLOCK_HEIGHT = 12 * this.GRID_UNIT;\r\n\r\n    this.EMPTY_STATEMENT_INPUT_HEIGHT = 6 * this.GRID_UNIT;\r\n\r\n    this.TOP_ROW_MIN_HEIGHT = this.CORNER_RADIUS;\r\n\r\n    this.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT = this.LARGE_PADDING;\r\n\r\n    this.BOTTOM_ROW_MIN_HEIGHT = this.CORNER_RADIUS;\r\n\r\n    this.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT = 6 * this.GRID_UNIT;\r\n\r\n    this.STATEMENT_BOTTOM_SPACER = -this.NOTCH_HEIGHT;\r\n\r\n    /** Minimum statement input spacer width. */\r\n    this.STATEMENT_INPUT_SPACER_MIN_WIDTH = 40 * this.GRID_UNIT;\r\n\r\n    this.STATEMENT_INPUT_PADDING_LEFT = 4 * this.GRID_UNIT;\r\n\r\n    this.EMPTY_INLINE_INPUT_PADDING = 4 * this.GRID_UNIT;\r\n\r\n    this.EMPTY_INLINE_INPUT_HEIGHT = 8 * this.GRID_UNIT;\r\n\r\n    this.DUMMY_INPUT_MIN_HEIGHT = 8 * this.GRID_UNIT;\r\n\r\n    this.DUMMY_INPUT_SHADOW_MIN_HEIGHT = 6 * this.GRID_UNIT;\r\n\r\n    this.CURSOR_WS_WIDTH = 20 * this.GRID_UNIT;\r\n\r\n    this.FIELD_TEXT_FONTSIZE = 3 * this.GRID_UNIT;\r\n\r\n    this.FIELD_BORDER_RECT_RADIUS = this.CORNER_RADIUS;\r\n\r\n    this.FIELD_BORDER_RECT_X_PADDING = 2 * this.GRID_UNIT;\r\n\r\n    this.FIELD_BORDER_RECT_Y_PADDING = 1.625 * this.GRID_UNIT;\r\n\r\n    this.FIELD_BORDER_RECT_HEIGHT = 8 * this.GRID_UNIT;\r\n\r\n    this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT = 8 * this.GRID_UNIT;\r\n\r\n    this.FIELD_DROPDOWN_SVG_ARROW_PADDING = this.FIELD_BORDER_RECT_X_PADDING;\r\n\r\n    this.FIELD_COLOUR_DEFAULT_WIDTH = 6 * this.GRID_UNIT;\r\n\r\n    this.FIELD_COLOUR_DEFAULT_HEIGHT = 8 * this.GRID_UNIT;\r\n\r\n    this.FIELD_CHECKBOX_X_OFFSET = 1 * this.GRID_UNIT;\r\n\r\n    /** The maximum width of a dynamic connection shape. */\r\n    this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH = 12 * this.GRID_UNIT;\r\n  }\r\n\r\n  override setFontConstants_(theme: Theme) {\r\n    super.setFontConstants_(theme);\r\n\r\n    this.FIELD_BORDER_RECT_HEIGHT =\r\n      this.FIELD_TEXT_HEIGHT + this.FIELD_BORDER_RECT_Y_PADDING * 2;\r\n    this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT = this.FIELD_BORDER_RECT_HEIGHT;\r\n  }\r\n\r\n  override init() {\r\n    super.init();\r\n    this.HEXAGONAL = this.makeHexagonal();\r\n    this.ROUNDED = this.makeRounded();\r\n    this.SQUARED = this.makeSquared();\r\n\r\n    this.STATEMENT_INPUT_NOTCH_OFFSET =\r\n      this.NOTCH_OFFSET_LEFT +\r\n      (this.INSIDE_CORNERS as InsideCorners).rightWidth;\r\n  }\r\n\r\n  override setDynamicProperties_(theme: Theme) {\r\n    super.setDynamicProperties_(theme);\r\n\r\n    this.SELECTED_GLOW_COLOUR =\r\n      theme.getComponentStyle('selectedGlowColour') ||\r\n      this.SELECTED_GLOW_COLOUR;\r\n    const selectedGlowSize = Number(\r\n      theme.getComponentStyle('selectedGlowSize'),\r\n    );\r\n    this.SELECTED_GLOW_SIZE =\r\n      selectedGlowSize && !isNaN(selectedGlowSize)\r\n        ? selectedGlowSize\r\n        : this.SELECTED_GLOW_SIZE;\r\n    this.REPLACEMENT_GLOW_COLOUR =\r\n      theme.getComponentStyle('replacementGlowColour') ||\r\n      this.REPLACEMENT_GLOW_COLOUR;\r\n    const replacementGlowSize = Number(\r\n      theme.getComponentStyle('replacementGlowSize'),\r\n    );\r\n    this.REPLACEMENT_GLOW_SIZE =\r\n      replacementGlowSize && !isNaN(replacementGlowSize)\r\n        ? replacementGlowSize\r\n        : this.REPLACEMENT_GLOW_SIZE;\r\n  }\r\n\r\n  override dispose() {\r\n    super.dispose();\r\n    if (this.selectedGlowFilter) {\r\n      dom.removeNode(this.selectedGlowFilter);\r\n    }\r\n    if (this.replacementGlowFilter) {\r\n      dom.removeNode(this.replacementGlowFilter);\r\n    }\r\n  }\r\n\r\n  override makeStartHat() {\r\n    const height = this.START_HAT_HEIGHT;\r\n    const width = this.START_HAT_WIDTH;\r\n\r\n    const mainPath = svgPaths.curve('c', [\r\n      svgPaths.point(25, -height),\r\n      svgPaths.point(71, -height),\r\n      svgPaths.point(width, 0),\r\n    ]);\r\n    return {height, width, path: mainPath};\r\n  }\r\n\r\n  /**\r\n   * Create sizing and path information about a hexagonal shape.\r\n   *\r\n   * @returns An object containing sizing and path information about a hexagonal\r\n   *     shape for connections.\r\n   */\r\n  protected makeHexagonal(): Shape {\r\n    const maxWidth = this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH;\r\n\r\n    /**\r\n     * Make the main path for the hexagonal connection shape out of two lines.\r\n     * The lines are defined with relative positions and require the block\r\n     * height. The 'up' and 'down' versions of the paths are the same, but the Y\r\n     * sign flips.  The 'left' and 'right' versions of the path are also the\r\n     * same, but the X sign flips.\r\n     *\r\n     * @param height The height of the block the connection is on.\r\n     * @param up True if the path should be drawn from bottom to top, false\r\n     *     otherwise.\r\n     * @param right True if the path is for the right side of the block.\r\n     * @returns A path fragment describing a rounded connection.\r\n     */\r\n    function makeMainPath(height: number, up: boolean, right: boolean): string {\r\n      const halfHeight = height / 2;\r\n      const width = halfHeight > maxWidth ? maxWidth : halfHeight;\r\n      const forward = up ? -1 : 1;\r\n      const direction = right ? -1 : 1;\r\n      const dy = (forward * height) / 2;\r\n      return (\r\n        svgPaths.lineTo(-direction * width, dy) +\r\n        svgPaths.lineTo(direction * width, dy)\r\n      );\r\n    }\r\n\r\n    return {\r\n      type: this.SHAPES.HEXAGONAL,\r\n      isDynamic: true,\r\n      width(height: number): number {\r\n        const halfHeight = height / 2;\r\n        return halfHeight > maxWidth ? maxWidth : halfHeight;\r\n      },\r\n      height(height: number): number {\r\n        return height;\r\n      },\r\n      connectionOffsetY(connectionHeight: number): number {\r\n        return connectionHeight / 2;\r\n      },\r\n      connectionOffsetX(connectionWidth: number): number {\r\n        return -connectionWidth;\r\n      },\r\n      pathDown(height: number): string {\r\n        return makeMainPath(height, false, false);\r\n      },\r\n      pathUp(height: number): string {\r\n        return makeMainPath(height, true, false);\r\n      },\r\n      pathRightDown(height: number): string {\r\n        return makeMainPath(height, false, true);\r\n      },\r\n      pathRightUp(height: number): string {\r\n        return makeMainPath(height, false, true);\r\n      },\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Create sizing and path information about a rounded shape.\r\n   *\r\n   * @returns An object containing sizing and path information about a rounded\r\n   *     shape for connections.\r\n   */\r\n  protected makeRounded(): Shape {\r\n    const maxWidth = this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH;\r\n    const maxHeight = maxWidth * 2;\r\n\r\n    /**\r\n     * Make the main path for the rounded connection shape out of two arcs and\r\n     * a line that joins them.  The arcs are defined with relative positions.\r\n     * Usually, the height of the block is split between the two arcs. In the\r\n     * case where the height of the block exceeds the maximum height, a line is\r\n     * drawn in between the two arcs. The 'up' and 'down' versions of the paths\r\n     * are the same, but the Y sign flips.  The 'up' and 'right' versions of the\r\n     * path flip the sweep-flag which moves the arc at negative angles.\r\n     *\r\n     * @param blockHeight The height of the block the connection is on.\r\n     * @param up True if the path should be drawn from bottom to top, false\r\n     *     otherwise.\r\n     * @param right True if the path is for the right side of the block.\r\n     * @returns A path fragment describing a rounded connection.\r\n     */\r\n    function makeMainPath(\r\n      blockHeight: number,\r\n      up: boolean,\r\n      right: boolean,\r\n    ): string {\r\n      const remainingHeight =\r\n        blockHeight > maxHeight ? blockHeight - maxHeight : 0;\r\n      const height = blockHeight > maxHeight ? maxHeight : blockHeight;\r\n      const radius = height / 2;\r\n      const sweep = right === up ? '0' : '1';\r\n      return (\r\n        svgPaths.arc(\r\n          'a',\r\n          '0 0,' + sweep,\r\n          radius,\r\n          svgPaths.point((right ? 1 : -1) * radius, (up ? -1 : 1) * radius),\r\n        ) +\r\n        svgPaths.lineOnAxis('v', (up ? -1 : 1) * remainingHeight) +\r\n        svgPaths.arc(\r\n          'a',\r\n          '0 0,' + sweep,\r\n          radius,\r\n          svgPaths.point((right ? -1 : 1) * radius, (up ? -1 : 1) * radius),\r\n        )\r\n      );\r\n    }\r\n\r\n    return {\r\n      type: this.SHAPES.ROUND,\r\n      isDynamic: true,\r\n      width(height: number): number {\r\n        const halfHeight = height / 2;\r\n        return halfHeight > maxWidth ? maxWidth : halfHeight;\r\n      },\r\n      height(height: number): number {\r\n        return height;\r\n      },\r\n      connectionOffsetY(connectionHeight: number): number {\r\n        return connectionHeight / 2;\r\n      },\r\n      connectionOffsetX(connectionWidth: number): number {\r\n        return -connectionWidth;\r\n      },\r\n      pathDown(height: number): string {\r\n        return makeMainPath(height, false, false);\r\n      },\r\n      pathUp(height: number): string {\r\n        return makeMainPath(height, true, false);\r\n      },\r\n      pathRightDown(height: number): string {\r\n        return makeMainPath(height, false, true);\r\n      },\r\n      pathRightUp(height: number): string {\r\n        return makeMainPath(height, false, true);\r\n      },\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Create sizing and path information about a squared shape.\r\n   *\r\n   * @returns An object containing sizing and path information about a squared\r\n   *     shape for connections.\r\n   */\r\n  protected makeSquared(): Shape {\r\n    const radius = this.CORNER_RADIUS;\r\n\r\n    /**\r\n     * Make the main path for the squared connection shape out of two corners\r\n     * and a single line in-between (a and v). These are defined in relative\r\n     * positions and require the height of the block.\r\n     * The 'left' and 'right' versions of the paths are the same, but the Y sign\r\n     * flips.  The 'up' and 'down' versions of the path determine where the\r\n     * corner point is placed and in turn the direction of the corners.\r\n     *\r\n     * @param height The height of the block the connection is on.\r\n     * @param up True if the path should be drawn from bottom to top, false\r\n     *     otherwise.\r\n     * @param right True if the path is for the right side of the block.\r\n     * @returns A path fragment describing a squared connection.\r\n     */\r\n    function makeMainPath(height: number, up: boolean, right: boolean): string {\r\n      const innerHeight = height - radius * 2;\r\n      const sweep = right === up ? '0' : '1';\r\n      return (\r\n        svgPaths.arc(\r\n          'a',\r\n          '0 0,' + sweep,\r\n          radius,\r\n          svgPaths.point((right ? 1 : -1) * radius, (up ? -1 : 1) * radius),\r\n        ) +\r\n        svgPaths.lineOnAxis('v', (up ? -1 : 1) * innerHeight) +\r\n        svgPaths.arc(\r\n          'a',\r\n          '0 0,' + sweep,\r\n          radius,\r\n          svgPaths.point((right ? -1 : 1) * radius, (up ? -1 : 1) * radius),\r\n        )\r\n      );\r\n    }\r\n\r\n    return {\r\n      type: this.SHAPES.SQUARE,\r\n      isDynamic: true,\r\n      width(_height: number): number {\r\n        return radius;\r\n      },\r\n      height(height: number): number {\r\n        return height;\r\n      },\r\n      connectionOffsetY(connectionHeight: number): number {\r\n        return connectionHeight / 2;\r\n      },\r\n      connectionOffsetX(connectionWidth: number): number {\r\n        return -connectionWidth;\r\n      },\r\n      pathDown(height: number): string {\r\n        return makeMainPath(height, false, false);\r\n      },\r\n      pathUp(height: number): string {\r\n        return makeMainPath(height, true, false);\r\n      },\r\n      pathRightDown(height: number): string {\r\n        return makeMainPath(height, false, true);\r\n      },\r\n      pathRightUp(height: number): string {\r\n        return makeMainPath(height, false, true);\r\n      },\r\n    };\r\n  }\r\n\r\n  override shapeFor(connection: RenderedConnection): Shape {\r\n    let checks = connection.getCheck();\r\n    if (!checks && connection.targetConnection) {\r\n      checks = connection.targetConnection.getCheck();\r\n    }\r\n    let outputShape;\r\n    switch (connection.type) {\r\n      case ConnectionType.INPUT_VALUE:\r\n      case ConnectionType.OUTPUT_VALUE:\r\n        outputShape = connection.getSourceBlock().getOutputShape();\r\n        // If the block has an output shape set, use that instead.\r\n        if (outputShape !== null) {\r\n          switch (outputShape) {\r\n            case this.SHAPES.HEXAGONAL:\r\n              return this.HEXAGONAL!;\r\n            case this.SHAPES.ROUND:\r\n              return this.ROUNDED!;\r\n            case this.SHAPES.SQUARE:\r\n              return this.SQUARED!;\r\n          }\r\n        }\r\n        // Includes doesn't work in IE.\r\n        if (checks && checks.indexOf('Boolean') !== -1) {\r\n          return this.HEXAGONAL!;\r\n        }\r\n        if (checks && checks.indexOf('Number') !== -1) {\r\n          return this.ROUNDED!;\r\n        }\r\n        if (checks && checks.indexOf('String') !== -1) {\r\n          return this.ROUNDED!;\r\n        }\r\n        return this.ROUNDED!;\r\n      case ConnectionType.PREVIOUS_STATEMENT:\r\n      case ConnectionType.NEXT_STATEMENT:\r\n        return this.NOTCH!;\r\n      default:\r\n        throw Error('Unknown type');\r\n    }\r\n  }\r\n\r\n  override makeNotch() {\r\n    const width = this.NOTCH_WIDTH;\r\n    const height = this.NOTCH_HEIGHT;\r\n\r\n    const innerWidth = width / 3;\r\n    const curveWidth = innerWidth / 3;\r\n\r\n    const halfHeight = height / 2;\r\n    const quarterHeight = halfHeight / 2;\r\n\r\n    /**\r\n     * Make the main path for the notch.\r\n     *\r\n     * @param dir Direction multiplier to apply to horizontal offsets along the\r\n     *     path. Either 1 or -1.\r\n     * @returns A path fragment describing a notch.\r\n     */\r\n    function makeMainPath(dir: number): string {\r\n      return (\r\n        svgPaths.curve('c', [\r\n          svgPaths.point((dir * curveWidth) / 2, 0),\r\n          svgPaths.point((dir * curveWidth * 3) / 4, quarterHeight / 2),\r\n          svgPaths.point(dir * curveWidth, quarterHeight),\r\n        ]) +\r\n        svgPaths.line([svgPaths.point(dir * curveWidth, halfHeight)]) +\r\n        svgPaths.curve('c', [\r\n          svgPaths.point((dir * curveWidth) / 4, quarterHeight / 2),\r\n          svgPaths.point((dir * curveWidth) / 2, quarterHeight),\r\n          svgPaths.point(dir * curveWidth, quarterHeight),\r\n        ]) +\r\n        svgPaths.lineOnAxis('h', dir * innerWidth) +\r\n        svgPaths.curve('c', [\r\n          svgPaths.point((dir * curveWidth) / 2, 0),\r\n          svgPaths.point((dir * curveWidth * 3) / 4, -(quarterHeight / 2)),\r\n          svgPaths.point(dir * curveWidth, -quarterHeight),\r\n        ]) +\r\n        svgPaths.line([svgPaths.point(dir * curveWidth, -halfHeight)]) +\r\n        svgPaths.curve('c', [\r\n          svgPaths.point((dir * curveWidth) / 4, -(quarterHeight / 2)),\r\n          svgPaths.point((dir * curveWidth) / 2, -quarterHeight),\r\n          svgPaths.point(dir * curveWidth, -quarterHeight),\r\n        ])\r\n      );\r\n    }\r\n\r\n    const pathLeft = makeMainPath(1);\r\n    const pathRight = makeMainPath(-1);\r\n\r\n    return {\r\n      type: this.SHAPES.NOTCH,\r\n      width,\r\n      height,\r\n      pathLeft,\r\n      pathRight,\r\n    };\r\n  }\r\n\r\n  override makeInsideCorners() {\r\n    const radius = this.CORNER_RADIUS;\r\n\r\n    const innerTopLeftCorner = svgPaths.arc(\r\n      'a',\r\n      '0 0,0',\r\n      radius,\r\n      svgPaths.point(-radius, radius),\r\n    );\r\n\r\n    const innerTopRightCorner = svgPaths.arc(\r\n      'a',\r\n      '0 0,1',\r\n      radius,\r\n      svgPaths.point(-radius, radius),\r\n    );\r\n\r\n    const innerBottomLeftCorner = svgPaths.arc(\r\n      'a',\r\n      '0 0,0',\r\n      radius,\r\n      svgPaths.point(radius, radius),\r\n    );\r\n\r\n    const innerBottomRightCorner = svgPaths.arc(\r\n      'a',\r\n      '0 0,1',\r\n      radius,\r\n      svgPaths.point(radius, radius),\r\n    );\r\n\r\n    return {\r\n      width: radius,\r\n      height: radius,\r\n      pathTop: innerTopLeftCorner,\r\n      pathBottom: innerBottomLeftCorner,\r\n      rightWidth: radius,\r\n      rightHeight: radius,\r\n      pathTopRight: innerTopRightCorner,\r\n      pathBottomRight: innerBottomRightCorner,\r\n    };\r\n  }\r\n\r\n  override generateSecondaryColour_(colour: string) {\r\n    return utilsColour.blend('#000', colour, 0.15) || colour;\r\n  }\r\n\r\n  override generateTertiaryColour_(colour: string) {\r\n    return utilsColour.blend('#000', colour, 0.25) || colour;\r\n  }\r\n\r\n  override createDom(svg: SVGElement, tagName: string, selector: string) {\r\n    super.createDom(svg, tagName, selector);\r\n    /*\r\n        <defs>\r\n          ... filters go here ...\r\n        </defs>\r\n        */\r\n    const defs = dom.createSvgElement(Svg.DEFS, {}, svg);\r\n    // Using a dilate distorts the block shape.\r\n    // Instead use a gaussian blur, and then set all alpha to 1 with a transfer.\r\n    const selectedGlowFilter = dom.createSvgElement(\r\n      Svg.FILTER,\r\n      {\r\n        'id': 'blocklySelectedGlowFilter' + this.randomIdentifier,\r\n        'height': '160%',\r\n        'width': '180%',\r\n        'y': '-30%',\r\n        'x': '-40%',\r\n      },\r\n      defs,\r\n    );\r\n    dom.createSvgElement(\r\n      Svg.FEGAUSSIANBLUR,\r\n      {'in': 'SourceGraphic', 'stdDeviation': this.SELECTED_GLOW_SIZE},\r\n      selectedGlowFilter,\r\n    );\r\n    // Set all gaussian blur pixels to 1 opacity before applying flood\r\n    const selectedComponentTransfer = dom.createSvgElement(\r\n      Svg.FECOMPONENTTRANSFER,\r\n      {'result': 'outBlur'},\r\n      selectedGlowFilter,\r\n    );\r\n    dom.createSvgElement(\r\n      Svg.FEFUNCA,\r\n      {'type': 'table', 'tableValues': '0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1'},\r\n      selectedComponentTransfer,\r\n    );\r\n    // Color the highlight\r\n    dom.createSvgElement(\r\n      Svg.FEFLOOD,\r\n      {\r\n        'flood-color': this.SELECTED_GLOW_COLOUR,\r\n        'flood-opacity': 1,\r\n        'result': 'outColor',\r\n      },\r\n      selectedGlowFilter,\r\n    );\r\n    dom.createSvgElement(\r\n      Svg.FECOMPOSITE,\r\n      {\r\n        'in': 'outColor',\r\n        'in2': 'outBlur',\r\n        'operator': 'in',\r\n        'result': 'outGlow',\r\n      },\r\n      selectedGlowFilter,\r\n    );\r\n    this.selectedGlowFilterId = selectedGlowFilter.id;\r\n    this.selectedGlowFilter = selectedGlowFilter;\r\n\r\n    // Using a dilate distorts the block shape.\r\n    // Instead use a gaussian blur, and then set all alpha to 1 with a transfer.\r\n    const replacementGlowFilter = dom.createSvgElement(\r\n      Svg.FILTER,\r\n      {\r\n        'id': 'blocklyReplacementGlowFilter' + this.randomIdentifier,\r\n        'height': '160%',\r\n        'width': '180%',\r\n        'y': '-30%',\r\n        'x': '-40%',\r\n      },\r\n      defs,\r\n    );\r\n    dom.createSvgElement(\r\n      Svg.FEGAUSSIANBLUR,\r\n      {'in': 'SourceGraphic', 'stdDeviation': this.REPLACEMENT_GLOW_SIZE},\r\n      replacementGlowFilter,\r\n    );\r\n    // Set all gaussian blur pixels to 1 opacity before applying flood\r\n    const replacementComponentTransfer = dom.createSvgElement(\r\n      Svg.FECOMPONENTTRANSFER,\r\n      {'result': 'outBlur'},\r\n      replacementGlowFilter,\r\n    );\r\n    dom.createSvgElement(\r\n      Svg.FEFUNCA,\r\n      {'type': 'table', 'tableValues': '0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1'},\r\n      replacementComponentTransfer,\r\n    );\r\n    // Color the highlight\r\n    dom.createSvgElement(\r\n      Svg.FEFLOOD,\r\n      {\r\n        'flood-color': this.REPLACEMENT_GLOW_COLOUR,\r\n        'flood-opacity': 1,\r\n        'result': 'outColor',\r\n      },\r\n      replacementGlowFilter,\r\n    );\r\n    dom.createSvgElement(\r\n      Svg.FECOMPOSITE,\r\n      {\r\n        'in': 'outColor',\r\n        'in2': 'outBlur',\r\n        'operator': 'in',\r\n        'result': 'outGlow',\r\n      },\r\n      replacementGlowFilter,\r\n    );\r\n    dom.createSvgElement(\r\n      Svg.FECOMPOSITE,\r\n      {\r\n        'in': 'SourceGraphic',\r\n        'in2': 'outGlow',\r\n        'operator': 'over',\r\n      },\r\n      replacementGlowFilter,\r\n    );\r\n    this.replacementGlowFilterId = replacementGlowFilter.id;\r\n    this.replacementGlowFilter = replacementGlowFilter;\r\n  }\r\n\r\n  override getCSS_(selector: string) {\r\n    return [\r\n      /* eslint-disable indent */\r\n      // Text.\r\n      `${selector} .blocklyText,`,\r\n      `${selector} .blocklyFlyoutLabelText {`,\r\n      `font: ${this.FIELD_TEXT_FONTWEIGHT} ${this.FIELD_TEXT_FONTSIZE}` +\r\n        `pt ${this.FIELD_TEXT_FONTFAMILY};`,\r\n      `}`,\r\n\r\n      // Fields.\r\n      `${selector} .blocklyText {`,\r\n      `fill: #fff;`,\r\n      `}`,\r\n      `${selector} .blocklyNonEditableText>rect:not(.blocklyDropdownRect),`,\r\n      `${selector} .blocklyEditableText>rect:not(.blocklyDropdownRect) {`,\r\n      `fill: ${this.FIELD_BORDER_RECT_COLOUR};`,\r\n      `}`,\r\n      `${selector} .blocklyNonEditableText>text,`,\r\n      `${selector} .blocklyEditableText>text,`,\r\n      `${selector} .blocklyNonEditableText>g>text,`,\r\n      `${selector} .blocklyEditableText>g>text {`,\r\n      `fill: #575E75;`,\r\n      `}`,\r\n\r\n      // Flyout labels.\r\n      `${selector} .blocklyFlyoutLabelText {`,\r\n      `fill: #575E75;`,\r\n      `}`,\r\n\r\n      // Bubbles.\r\n      `${selector} .blocklyText.blocklyBubbleText {`,\r\n      `fill: #575E75;`,\r\n      `}`,\r\n\r\n      // Editable field hover.\r\n      `${selector} .blocklyDraggable:not(.blocklyDisabled)`,\r\n      ` .blocklyEditableText:not(.editing):hover>rect,`,\r\n      `${selector} .blocklyDraggable:not(.blocklyDisabled)`,\r\n      ` .blocklyEditableText:not(.editing):hover>.blocklyPath {`,\r\n      `stroke: #fff;`,\r\n      `stroke-width: 2;`,\r\n      `}`,\r\n\r\n      // Text field input.\r\n      `${selector} .blocklyHtmlInput {`,\r\n      `font-family: ${this.FIELD_TEXT_FONTFAMILY};`,\r\n      `font-weight: ${this.FIELD_TEXT_FONTWEIGHT};`,\r\n      `color: #575E75;`,\r\n      `}`,\r\n\r\n      // Dropdown field.\r\n      `${selector} .blocklyDropdownText {`,\r\n      `fill: #fff !important;`,\r\n      `}`,\r\n\r\n      // Widget and Dropdown Div\r\n      `${selector}.blocklyWidgetDiv .goog-menuitem,`,\r\n      `${selector}.blocklyDropDownDiv .goog-menuitem {`,\r\n      `font-family: ${this.FIELD_TEXT_FONTFAMILY};`,\r\n      `}`,\r\n      `${selector}.blocklyDropDownDiv .goog-menuitem-content {`,\r\n      `color: #fff;`,\r\n      `}`,\r\n\r\n      // Connection highlight.\r\n      `${selector} .blocklyHighlightedConnectionPath {`,\r\n      `stroke: ${this.SELECTED_GLOW_COLOUR};`,\r\n      `}`,\r\n\r\n      // Disabled outline paths.\r\n      `${selector} .blocklyDisabled > .blocklyOutlinePath {`,\r\n      `fill: url(#blocklyDisabledPattern${this.randomIdentifier})`,\r\n      `}`,\r\n\r\n      // Insertion marker.\r\n      `${selector} .blocklyInsertionMarker>.blocklyPath {`,\r\n      `fill-opacity: ${this.INSERTION_MARKER_OPACITY};`,\r\n      `stroke: none;`,\r\n      `}`,\r\n    ];\r\n  }\r\n}\r\n/* eslint-enable indent */\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.zelos.Drawer\r\n\r\nimport type {BlockSvg} from '../../block_svg.js';\r\nimport {ConnectionType} from '../../connection_type.js';\r\nimport * as svgPaths from '../../utils/svg_paths.js';\r\nimport type {BaseShape, DynamicShape, Notch} from '../common/constants.js';\r\nimport {Drawer as BaseDrawer} from '../common/drawer.js';\r\nimport {Connection} from '../measurables/connection.js';\r\nimport type {InlineInput} from '../measurables/inline_input.js';\r\nimport {OutputConnection} from '../measurables/output_connection.js';\r\nimport type {Row} from '../measurables/row.js';\r\nimport type {SpacerRow} from '../measurables/spacer_row.js';\r\nimport {Types} from '../measurables/types.js';\r\n\r\nimport type {InsideCorners} from './constants.js';\r\nimport type {RenderInfo} from './info.js';\r\nimport type {StatementInput} from './measurables/inputs.js';\r\nimport type {PathObject} from './path_object.js';\r\n\r\n/**\r\n * An object that draws a block based on the given rendering information.\r\n */\r\nexport class Drawer extends BaseDrawer {\r\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\r\n  override info_!: RenderInfo;\r\n\r\n  /**\r\n   * @param block The block to render.\r\n   * @param info An object containing all information needed to render this\r\n   *     block.\r\n   */\r\n  constructor(block: BlockSvg, info: RenderInfo) {\r\n    super(block, info);\r\n  }\r\n\r\n  override draw() {\r\n    const pathObject = this.block_.pathObject as PathObject;\r\n    pathObject.beginDrawing();\r\n    this.drawOutline_();\r\n    this.drawInternals_();\r\n    this.updateConnectionHighlights();\r\n\r\n    pathObject.setPath(this.outlinePath_ + '\\n' + this.inlinePath_);\r\n    if (this.info_.RTL) {\r\n      pathObject.flipRTL();\r\n    }\r\n    this.recordSizeOnBlock_();\r\n    if (this.info_.outputConnection) {\r\n      // Store the output connection shape type for parent blocks to use during\r\n      // rendering.\r\n      pathObject.outputShapeType = this.info_.outputConnection.shape.type;\r\n    }\r\n    pathObject.endDrawing();\r\n  }\r\n\r\n  override drawOutline_() {\r\n    if (\r\n      this.info_.outputConnection &&\r\n      this.info_.outputConnection.isDynamicShape &&\r\n      !this.info_.hasStatementInput &&\r\n      !this.info_.bottomRow.hasNextConnection\r\n    ) {\r\n      this.drawFlatTop_();\r\n      this.drawRightDynamicConnection_();\r\n      this.drawFlatBottom_();\r\n      this.drawLeftDynamicConnection_();\r\n    } else {\r\n      super.drawOutline_();\r\n    }\r\n  }\r\n\r\n  override drawLeft_() {\r\n    if (\r\n      this.info_.outputConnection &&\r\n      this.info_.outputConnection.isDynamicShape\r\n    ) {\r\n      this.drawLeftDynamicConnection_();\r\n    } else {\r\n      super.drawLeft_();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add steps for the right side of a row that does not have value or\r\n   * statement input connections.\r\n   *\r\n   * @param row The row to draw the side of.\r\n   */\r\n  protected override drawRightSideRow_(row: Row) {\r\n    if (row.height <= 0) {\r\n      return;\r\n    }\r\n    if (Types.isSpacer(row)) {\r\n      const spacerRow = row as SpacerRow;\r\n      const precedesStatement = spacerRow.precedesStatement;\r\n      const followsStatement = spacerRow.followsStatement;\r\n      if (precedesStatement || followsStatement) {\r\n        const insideCorners = this.constants_.INSIDE_CORNERS as InsideCorners;\r\n        const cornerHeight = insideCorners.rightHeight;\r\n        const remainingHeight =\r\n          spacerRow.height - (precedesStatement ? cornerHeight : 0);\r\n        const bottomRightPath = followsStatement\r\n          ? insideCorners.pathBottomRight\r\n          : '';\r\n        const verticalPath =\r\n          remainingHeight > 0\r\n            ? svgPaths.lineOnAxis('V', spacerRow.yPos + remainingHeight)\r\n            : '';\r\n        const topRightPath = precedesStatement\r\n          ? insideCorners.pathTopRight\r\n          : '';\r\n        // Put all of the partial paths together.\r\n        this.outlinePath_ += bottomRightPath + verticalPath + topRightPath;\r\n        return;\r\n      }\r\n    }\r\n    this.outlinePath_ += svgPaths.lineOnAxis('V', row.yPos + row.height);\r\n  }\r\n\r\n  /**\r\n   * Add steps to draw the right side of an output with a dynamic connection.\r\n   */\r\n  protected drawRightDynamicConnection_() {\r\n    if (!this.info_.outputConnection) {\r\n      throw new Error(\r\n        `Cannot draw the output connection of a block that doesn't have one`,\r\n      );\r\n    }\r\n    this.outlinePath_ += (\r\n      this.info_.outputConnection.shape as DynamicShape\r\n    ).pathRightDown(this.info_.outputConnection.height);\r\n  }\r\n\r\n  /**\r\n   * Add steps to draw the left side of an output with a dynamic connection.\r\n   */\r\n  protected drawLeftDynamicConnection_() {\r\n    if (!this.info_.outputConnection) {\r\n      throw new Error(\r\n        `Cannot draw the output connection of a block that doesn't have one`,\r\n      );\r\n    }\r\n    this.positionOutputConnection_();\r\n\r\n    this.outlinePath_ += (\r\n      this.info_.outputConnection.shape as DynamicShape\r\n    ).pathUp(this.info_.outputConnection.height);\r\n\r\n    // Close off the path.  This draws a vertical line up to the start of the\r\n    // block's path, which may be either a rounded or a sharp corner.\r\n    this.outlinePath_ += 'z';\r\n  }\r\n\r\n  /** Add steps to draw a flat top row. */\r\n  protected drawFlatTop_() {\r\n    const topRow = this.info_.topRow;\r\n    this.positionPreviousConnection_();\r\n\r\n    this.outlinePath_ += svgPaths.moveBy(topRow.xPos, this.info_.startY);\r\n    this.outlinePath_ += svgPaths.lineOnAxis('h', topRow.width);\r\n  }\r\n\r\n  /** Add steps to draw a flat bottom row. */\r\n  protected drawFlatBottom_() {\r\n    const bottomRow = this.info_.bottomRow;\r\n    this.positionNextConnection_();\r\n\r\n    this.outlinePath_ += svgPaths.lineOnAxis('V', bottomRow.baseline);\r\n    this.outlinePath_ += svgPaths.lineOnAxis('h', -bottomRow.width);\r\n  }\r\n\r\n  override drawInlineInput_(input: InlineInput) {\r\n    this.positionInlineInputConnection_(input);\r\n\r\n    const inputName = input.input.name;\r\n    if (input.connectedBlock || this.info_.isInsertionMarker) {\r\n      return;\r\n    }\r\n\r\n    const yPos = input.centerline - input.height / 2;\r\n    const connectionRight = input.xPos + input.connectionWidth;\r\n\r\n    const path =\r\n      svgPaths.moveTo(connectionRight, yPos) + this.getInlineInputPath(input);\r\n\r\n    const pathObject = this.block_.pathObject as PathObject;\r\n    pathObject.setOutlinePath(inputName, path);\r\n  }\r\n\r\n  private getInlineInputPath(input: InlineInput) {\r\n    const width = input.width - input.connectionWidth * 2;\r\n    const height = input.height;\r\n\r\n    return (\r\n      svgPaths.lineOnAxis('h', width) +\r\n      (input.shape as DynamicShape).pathRightDown(height) +\r\n      svgPaths.lineOnAxis('h', -width) +\r\n      (input.shape as DynamicShape).pathUp(height) +\r\n      'z'\r\n    );\r\n  }\r\n\r\n  override drawStatementInput_(row: Row) {\r\n    const input = row.getLastInput() as StatementInput;\r\n    // Where to start drawing the notch, which is on the right side in LTR.\r\n    const x = input.xPos + input.notchOffset + (input.shape as BaseShape).width;\r\n\r\n    const insideCorners = this.constants_.INSIDE_CORNERS;\r\n    const innerTopLeftCorner =\r\n      (input.shape as Notch).pathRight +\r\n      svgPaths.lineOnAxis('h', -(input.notchOffset - insideCorners.width)) +\r\n      insideCorners.pathTop;\r\n\r\n    const innerHeight = row.height - 2 * insideCorners.height;\r\n\r\n    const innerBottomLeftCorner =\r\n      insideCorners.pathBottom +\r\n      svgPaths.lineOnAxis('h', input.notchOffset - insideCorners.width) +\r\n      (input.connectedBottomNextConnection\r\n        ? ''\r\n        : (input.shape as Notch).pathLeft);\r\n\r\n    this.outlinePath_ +=\r\n      svgPaths.lineOnAxis('H', x) +\r\n      innerTopLeftCorner +\r\n      svgPaths.lineOnAxis('v', innerHeight) +\r\n      innerBottomLeftCorner +\r\n      svgPaths.lineOnAxis('H', row.xPos + row.width);\r\n\r\n    this.positionStatementInputConnection_(row);\r\n  }\r\n\r\n  /** Returns a path to highlight the given connection. */\r\n  drawConnectionHighlightPath(measurable: Connection) {\r\n    const conn = measurable.connectionModel;\r\n    if (\r\n      conn.type === ConnectionType.NEXT_STATEMENT ||\r\n      conn.type === ConnectionType.PREVIOUS_STATEMENT ||\r\n      (conn.type === ConnectionType.OUTPUT_VALUE && !measurable.isDynamicShape)\r\n    ) {\r\n      super.drawConnectionHighlightPath(measurable);\r\n      return;\r\n    }\r\n\r\n    let path = '';\r\n    if (conn.type === ConnectionType.INPUT_VALUE) {\r\n      const input = measurable as InlineInput;\r\n      const xPos = input.connectionWidth;\r\n      const yPos = -input.height / 2;\r\n      path = svgPaths.moveTo(xPos, yPos) + this.getInlineInputPath(input);\r\n    } else {\r\n      // Dynamic output.\r\n      const output = measurable as OutputConnection;\r\n      const xPos = output.width;\r\n      const yPos = -output.height / 2;\r\n      path =\r\n        svgPaths.moveTo(xPos, yPos) +\r\n        (output.shape as DynamicShape).pathDown(output.height);\r\n    }\r\n    const block = conn.getSourceBlock();\r\n    block.pathObject.addConnectionHighlight?.(\r\n      conn,\r\n      path,\r\n      conn.getOffsetInBlock(),\r\n      block.RTL,\r\n    );\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2012 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Image field.  Used for pictures, icons, etc.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.FieldImage\r\n\r\nimport {Field, FieldConfig} from './field.js';\r\nimport * as fieldRegistry from './field_registry.js';\r\nimport * as dom from './utils/dom.js';\r\nimport * as parsing from './utils/parsing.js';\r\nimport {Size} from './utils/size.js';\r\nimport {Svg} from './utils/svg.js';\r\n\r\n/**\r\n * Class for an image on a block.\r\n */\r\nexport class FieldImage extends Field<string> {\r\n  /**\r\n   * Vertical padding below the image, which is included in the reported height\r\n   * of the field.\r\n   */\r\n  private static readonly Y_PADDING = 1;\r\n  protected override size_: Size;\r\n  protected readonly imageHeight: number;\r\n\r\n  /** The function to be called when this field is clicked. */\r\n  private clickHandler: ((p1: FieldImage) => void) | null = null;\r\n\r\n  /** The rendered field's image element. */\r\n  protected imageElement: SVGImageElement | null = null;\r\n\r\n  /**\r\n   * Editable fields usually show some sort of UI indicating they are\r\n   * editable. This field should not.\r\n   */\r\n  override readonly EDITABLE = false;\r\n\r\n  /**\r\n   * Used to tell if the field needs to be rendered the next time the block is\r\n   * rendered. Image fields are statically sized, and only need to be\r\n   * rendered at initialization.\r\n   */\r\n  protected override isDirty_ = false;\r\n\r\n  /** Whether to flip this image in RTL. */\r\n  private flipRtl = false;\r\n\r\n  /** Alt text of this image. */\r\n  private altText = '';\r\n\r\n  /**\r\n   * @param src The URL of the image.\r\n   *     Also accepts Field.SKIP_SETUP if you wish to skip setup (only used by\r\n   * subclasses that want to handle configuration and setting the field value\r\n   * after their own constructors have run).\r\n   * @param width Width of the image.\r\n   * @param height Height of the image.\r\n   * @param alt Optional alt text for when block is collapsed.\r\n   * @param onClick Optional function to be called when the image is\r\n   *     clicked. If onClick is defined, alt must also be defined.\r\n   * @param flipRtl Whether to flip the icon in RTL.\r\n   * @param config A map of options used to configure the field.\r\n   *     See the [field creation documentation]{@link\r\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/image#creation}\r\n   * for a list of properties this parameter supports.\r\n   */\r\n  constructor(\r\n    src: string | typeof Field.SKIP_SETUP,\r\n    width: string | number,\r\n    height: string | number,\r\n    alt?: string,\r\n    onClick?: (p1: FieldImage) => void,\r\n    flipRtl?: boolean,\r\n    config?: FieldImageConfig,\r\n  ) {\r\n    super(Field.SKIP_SETUP);\r\n\r\n    const imageHeight = Number(parsing.replaceMessageReferences(height));\r\n    const imageWidth = Number(parsing.replaceMessageReferences(width));\r\n    if (isNaN(imageHeight) || isNaN(imageWidth)) {\r\n      throw Error(\r\n        'Height and width values of an image field must cast to' + ' numbers.',\r\n      );\r\n    }\r\n    if (imageHeight <= 0 || imageWidth <= 0) {\r\n      throw Error(\r\n        'Height and width values of an image field must be greater' +\r\n          ' than 0.',\r\n      );\r\n    }\r\n\r\n    /** The size of the area rendered by the field. */\r\n    this.size_ = new Size(imageWidth, imageHeight + FieldImage.Y_PADDING);\r\n\r\n    /**\r\n     * Store the image height, since it is different from the field height.\r\n     */\r\n    this.imageHeight = imageHeight;\r\n\r\n    if (typeof onClick === 'function') {\r\n      this.clickHandler = onClick;\r\n    }\r\n\r\n    if (src === Field.SKIP_SETUP) return;\r\n\r\n    if (config) {\r\n      this.configure_(config);\r\n    } else {\r\n      this.flipRtl = !!flipRtl;\r\n      this.altText = parsing.replaceMessageReferences(alt) || '';\r\n    }\r\n    this.setValue(parsing.replaceMessageReferences(src));\r\n  }\r\n\r\n  /**\r\n   * Configure the field based on the given map of options.\r\n   *\r\n   * @param config A map of options to configure the field based on.\r\n   */\r\n  protected override configure_(config: FieldImageConfig) {\r\n    super.configure_(config);\r\n    if (config.flipRtl) this.flipRtl = config.flipRtl;\r\n    if (config.alt) {\r\n      this.altText = parsing.replaceMessageReferences(config.alt);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create the block UI for this image.\r\n   */\r\n  override initView() {\r\n    this.imageElement = dom.createSvgElement(\r\n      Svg.IMAGE,\r\n      {\r\n        'height': this.imageHeight + 'px',\r\n        'width': this.size_.width + 'px',\r\n        'alt': this.altText,\r\n      },\r\n      this.fieldGroup_,\r\n    );\r\n    this.imageElement.setAttributeNS(\r\n      dom.XLINK_NS,\r\n      'xlink:href',\r\n      this.value_ as string,\r\n    );\r\n\r\n    if (this.clickHandler) {\r\n      this.imageElement.style.cursor = 'pointer';\r\n    }\r\n  }\r\n\r\n  override updateSize_() {}\r\n  // NOP\r\n\r\n  /**\r\n   * Ensure that the input value (the source URL) is a string.\r\n   *\r\n   * @param newValue The input value.\r\n   * @returns A string, or null if invalid.\r\n   */\r\n  protected override doClassValidation_(newValue?: any): string | null {\r\n    if (typeof newValue !== 'string') {\r\n      return null;\r\n    }\r\n    return newValue;\r\n  }\r\n\r\n  /**\r\n   * Update the value of this image field, and update the displayed image.\r\n   *\r\n   * @param newValue The value to be saved. The default validator guarantees\r\n   *     that this is a string.\r\n   */\r\n  protected override doValueUpdate_(newValue: string) {\r\n    this.value_ = newValue;\r\n    if (this.imageElement) {\r\n      this.imageElement.setAttributeNS(dom.XLINK_NS, 'xlink:href', this.value_);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get whether to flip this image in RTL\r\n   *\r\n   * @returns True if we should flip in RTL.\r\n   */\r\n  override getFlipRtl(): boolean {\r\n    return this.flipRtl;\r\n  }\r\n\r\n  /**\r\n   * Set the alt text of this image.\r\n   *\r\n   * @param alt New alt text.\r\n   */\r\n  setAlt(alt: string | null) {\r\n    if (alt === this.altText) {\r\n      return;\r\n    }\r\n    this.altText = alt || '';\r\n    if (this.imageElement) {\r\n      this.imageElement.setAttribute('alt', this.altText);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * If field click is called, and click handler defined,\r\n   * call the handler.\r\n   */\r\n  protected override showEditor_() {\r\n    if (this.clickHandler) {\r\n      this.clickHandler(this);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set the function that is called when this image  is clicked.\r\n   *\r\n   * @param func The function that is called when the image is clicked, or null\r\n   *     to remove.\r\n   */\r\n  setOnClickHandler(func: ((p1: FieldImage) => void) | null) {\r\n    this.clickHandler = func;\r\n  }\r\n\r\n  /**\r\n   * Use the `getText_` developer hook to override the field's text\r\n   * representation.\r\n   * Return the image alt text instead.\r\n   *\r\n   * @returns The image alt text.\r\n   */\r\n  protected override getText_(): string | null {\r\n    return this.altText;\r\n  }\r\n\r\n  /**\r\n   * Construct a FieldImage from a JSON arg object,\r\n   * dereferencing any string table references.\r\n   *\r\n   * @param options A JSON object with options (src, width, height, alt, and\r\n   *     flipRtl).\r\n   * @returns The new field instance.\r\n   * @nocollapse\r\n   * @internal\r\n   */\r\n  static fromJson(options: FieldImageFromJsonConfig): FieldImage {\r\n    if (!options.src || !options.width || !options.height) {\r\n      throw new Error(\r\n        'src, width, and height values for an image field are' +\r\n          'required. The width and height must be non-zero.',\r\n      );\r\n    }\r\n    // `this` might be a subclass of FieldImage if that class doesn't override\r\n    // the static fromJson method.\r\n    return new this(\r\n      options.src,\r\n      options.width,\r\n      options.height,\r\n      undefined,\r\n      undefined,\r\n      undefined,\r\n      options,\r\n    );\r\n  }\r\n}\r\n\r\nfieldRegistry.register('field_image', FieldImage);\r\n\r\nFieldImage.prototype.DEFAULT_VALUE = '';\r\n\r\n/**\r\n * Config options for the image field.\r\n */\r\nexport interface FieldImageConfig extends FieldConfig {\r\n  flipRtl?: boolean;\r\n  alt?: string;\r\n}\r\n\r\n/**\r\n * fromJson config options for the colour field.\r\n */\r\nexport interface FieldImageFromJsonConfig extends FieldImageConfig {\r\n  src?: string;\r\n  width?: number;\r\n  height?: number;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2012 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Text input field.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.FieldInput\r\n\r\n// Unused import preserved for side-effects. Remove if unneeded.\r\nimport './events/events_block_change.js';\r\n\r\nimport {BlockSvg} from './block_svg.js';\r\nimport * as bumpObjects from './bump_objects.js';\r\nimport * as browserEvents from './browser_events.js';\r\nimport * as dialog from './dialog.js';\r\nimport * as dom from './utils/dom.js';\r\nimport * as dropDownDiv from './dropdowndiv.js';\r\nimport * as eventUtils from './events/utils.js';\r\nimport {\r\n  Field,\r\n  FieldConfig,\r\n  FieldValidator,\r\n  UnattachedFieldError,\r\n} from './field.js';\r\nimport {Msg} from './msg.js';\r\nimport * as aria from './utils/aria.js';\r\nimport {Coordinate} from './utils/coordinate.js';\r\nimport * as userAgent from './utils/useragent.js';\r\nimport * as WidgetDiv from './widgetdiv.js';\r\nimport type {WorkspaceSvg} from './workspace_svg.js';\r\nimport {Size} from './utils/size.js';\r\n\r\n/**\r\n * Supported types for FieldInput subclasses.\r\n *\r\n * @internal\r\n */\r\ntype InputTypes = string | number;\r\n\r\n/**\r\n * Abstract class for an editable input field.\r\n *\r\n * @typeParam T - The value stored on the field.\r\n * @internal\r\n */\r\nexport abstract class FieldInput<T extends InputTypes> extends Field<\r\n  string | T\r\n> {\r\n  /**\r\n   * Pixel size of input border radius.\r\n   * Should match blocklyText's border-radius in CSS.\r\n   */\r\n  static BORDERRADIUS = 4;\r\n\r\n  /** Allow browser to spellcheck this field. */\r\n  protected spellcheck_ = true;\r\n\r\n  /** The HTML input element. */\r\n  protected htmlInput_: HTMLInputElement | null = null;\r\n\r\n  /** True if the field's value is currently being edited via the UI. */\r\n  protected isBeingEdited_ = false;\r\n\r\n  /**\r\n   * True if the value currently displayed in the field's editory UI is valid.\r\n   */\r\n  protected isTextValid_ = false;\r\n\r\n  /**\r\n   * The intial value of the field when the user opened an editor to change its\r\n   * value. When the editor is disposed, an event will be fired that uses this\r\n   * as the event's oldValue.\r\n   */\r\n  protected valueWhenEditorWasOpened_: string | T | null = null;\r\n\r\n  /** Key down event data. */\r\n  private onKeyDownWrapper_: browserEvents.Data | null = null;\r\n\r\n  /** Key input event data. */\r\n  private onKeyInputWrapper_: browserEvents.Data | null = null;\r\n\r\n  /**\r\n   * Whether the field should consider the whole parent block to be its click\r\n   * target.\r\n   */\r\n  fullBlockClickTarget_: boolean = false;\r\n\r\n  /** The workspace that this field belongs to. */\r\n  protected workspace_: WorkspaceSvg | null = null;\r\n\r\n  /**\r\n   * Serializable fields are saved by the serializer, non-serializable fields\r\n   * are not. Editable fields should also be serializable.\r\n   */\r\n  override SERIALIZABLE = true;\r\n\r\n  /** Mouse cursor style when over the hotspot that initiates the editor. */\r\n  override CURSOR = 'text';\r\n\r\n  /**\r\n   * @param value The initial value of the field. Should cast to a string.\r\n   *     Defaults to an empty string if null or undefined. Also accepts\r\n   *     Field.SKIP_SETUP if you wish to skip setup (only used by subclasses\r\n   *     that want to handle configuration and setting the field value after\r\n   *     their own constructors have run).\r\n   * @param validator A function that is called to validate changes to the\r\n   *     field's value. Takes in a string & returns a validated string, or null\r\n   *     to abort the change.\r\n   * @param config A map of options used to configure the field.\r\n   *     See the [field creation documentation]{@link\r\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/text-input#creation}\r\n   * for a list of properties this parameter supports.\r\n   */\r\n  constructor(\r\n    value?: string | typeof Field.SKIP_SETUP,\r\n    validator?: FieldInputValidator<T> | null,\r\n    config?: FieldInputConfig,\r\n  ) {\r\n    super(Field.SKIP_SETUP);\r\n\r\n    if (value === Field.SKIP_SETUP) return;\r\n    if (config) {\r\n      this.configure_(config);\r\n    }\r\n    this.setValue(value);\r\n    if (validator) {\r\n      this.setValidator(validator);\r\n    }\r\n  }\r\n\r\n  protected override configure_(config: FieldInputConfig) {\r\n    super.configure_(config);\r\n    if (config.spellcheck !== undefined) {\r\n      this.spellcheck_ = config.spellcheck;\r\n    }\r\n  }\r\n\r\n  override initView() {\r\n    const block = this.getSourceBlock();\r\n    if (!block) throw new UnattachedFieldError();\r\n    super.initView();\r\n\r\n    if (this.isFullBlockField()) {\r\n      this.clickTarget_ = (this.sourceBlock_ as BlockSvg).getSvgRoot();\r\n    }\r\n  }\r\n\r\n  protected override isFullBlockField(): boolean {\r\n    const block = this.getSourceBlock();\r\n    if (!block) throw new UnattachedFieldError();\r\n\r\n    // Side effect for backwards compatibility.\r\n    this.fullBlockClickTarget_ =\r\n      !!this.getConstants()?.FULL_BLOCK_FIELDS && block.isSimpleReporter();\r\n    return this.fullBlockClickTarget_;\r\n  }\r\n\r\n  /**\r\n   * Called by setValue if the text input is not valid. If the field is\r\n   * currently being edited it reverts value of the field to the previous\r\n   * value while allowing the display text to be handled by the htmlInput_.\r\n   *\r\n   * @param _invalidValue The input value that was determined to be invalid.\r\n   *    This is not used by the text input because its display value is stored\r\n   * on the htmlInput_.\r\n   */\r\n  protected override doValueInvalid_(_invalidValue: AnyDuringMigration) {\r\n    if (this.isBeingEdited_) {\r\n      this.isDirty_ = true;\r\n      this.isTextValid_ = false;\r\n      const oldValue = this.value_;\r\n      // Revert value when the text becomes invalid.\r\n      this.value_ = this.htmlInput_!.getAttribute('data-untyped-default-value');\r\n      if (this.sourceBlock_ && eventUtils.isEnabled()) {\r\n        eventUtils.fire(\r\n          new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\r\n            this.sourceBlock_,\r\n            'field',\r\n            this.name || null,\r\n            oldValue,\r\n            this.value_,\r\n          ),\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Called by setValue if the text input is valid. Updates the value of the\r\n   * field, and updates the text of the field if it is not currently being\r\n   * edited (i.e. handled by the htmlInput_).\r\n   *\r\n   * @param newValue The value to be saved. The default validator guarantees\r\n   *     that this is a string.\r\n   */\r\n  protected override doValueUpdate_(newValue: string | T) {\r\n    this.isDirty_ = true;\r\n    this.isTextValid_ = true;\r\n    this.value_ = newValue;\r\n  }\r\n\r\n  /**\r\n   * Updates text field to match the colour/style of the block.\r\n   */\r\n  override applyColour() {\r\n    const block = this.getSourceBlock() as BlockSvg | null;\r\n    if (!block) throw new UnattachedFieldError();\r\n\r\n    if (!this.getConstants()!.FULL_BLOCK_FIELDS) return;\r\n    if (!this.fieldGroup_) return;\r\n\r\n    if (!this.isFullBlockField() && this.borderRect_) {\r\n      this.borderRect_!.style.display = 'block';\r\n      this.borderRect_.setAttribute('stroke', block.style.colourTertiary);\r\n    } else {\r\n      this.borderRect_!.style.display = 'none';\r\n      // In general, do *not* let fields control the color of blocks. Having the\r\n      // field control the color is unexpected, and could have performance\r\n      // impacts.\r\n      block.pathObject.svgPath.setAttribute(\r\n        'fill',\r\n        this.getConstants()!.FIELD_BORDER_RECT_COLOUR,\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns the height and width of the field.\r\n   *\r\n   * This should *in general* be the only place render_ gets called from.\r\n   *\r\n   * @returns Height and width.\r\n   */\r\n  override getSize(): Size {\r\n    if (this.getConstants()?.FULL_BLOCK_FIELDS) {\r\n      // In general, do *not* let fields control the color of blocks. Having the\r\n      // field control the color is unexpected, and could have performance\r\n      // impacts.\r\n      // Full block fields have more control of the block than they should\r\n      // (i.e. updating fill colour). Whenever we get the size, the field may\r\n      // no longer be a full-block field, so we need to rerender.\r\n      this.render_();\r\n      this.isDirty_ = false;\r\n    }\r\n    return super.getSize();\r\n  }\r\n\r\n  /**\r\n   * Notifies the field that it has changed locations. Moves the widget div to\r\n   * be in the correct place if it is open.\r\n   */\r\n  onLocationChange(): void {\r\n    if (this.isBeingEdited_) this.resizeEditor_();\r\n  }\r\n\r\n  /**\r\n   * Updates the colour of the htmlInput given the current validity of the\r\n   * field's value.\r\n   *\r\n   * Also updates the colour of the block to reflect whether this is a full\r\n   * block field or not.\r\n   */\r\n  protected override render_() {\r\n    super.render_();\r\n    // This logic is done in render_ rather than doValueInvalid_ or\r\n    // doValueUpdate_ so that the code is more centralized.\r\n    if (this.isBeingEdited_) {\r\n      const htmlInput = this.htmlInput_ as HTMLElement;\r\n      if (!this.isTextValid_) {\r\n        dom.addClass(htmlInput, 'blocklyInvalidInput');\r\n        aria.setState(htmlInput, aria.State.INVALID, true);\r\n      } else {\r\n        dom.removeClass(htmlInput, 'blocklyInvalidInput');\r\n        aria.setState(htmlInput, aria.State.INVALID, false);\r\n      }\r\n    }\r\n\r\n    const block = this.getSourceBlock() as BlockSvg | null;\r\n    if (!block) throw new UnattachedFieldError();\r\n    // In general, do *not* let fields control the color of blocks. Having the\r\n    // field control the color is unexpected, and could have performance\r\n    // impacts.\r\n    // Whenever we render, the field may no longer be a full-block-field so\r\n    // we need to update the colour.\r\n    if (this.getConstants()!.FULL_BLOCK_FIELDS) block.applyColour();\r\n  }\r\n\r\n  /**\r\n   * Set whether this field is spellchecked by the browser.\r\n   *\r\n   * @param check True if checked.\r\n   */\r\n  setSpellcheck(check: boolean) {\r\n    if (check === this.spellcheck_) {\r\n      return;\r\n    }\r\n    this.spellcheck_ = check;\r\n    if (this.htmlInput_) {\r\n      // AnyDuringMigration because:  Argument of type 'boolean' is not\r\n      // assignable to parameter of type 'string'.\r\n      this.htmlInput_.setAttribute(\r\n        'spellcheck',\r\n        this.spellcheck_ as AnyDuringMigration,\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show an editor for the field.\r\n   * Shows the inline free-text editor on top of the text by default.\r\n   * Shows a prompt editor for mobile browsers if the modalInputs option is\r\n   * enabled.\r\n   *\r\n   * @param _e Optional mouse event that triggered the field to open, or\r\n   *     undefined if triggered programmatically.\r\n   * @param quietInput True if editor should be created without focus.\r\n   *     Defaults to false.\r\n   */\r\n  protected override showEditor_(_e?: Event, quietInput = false) {\r\n    this.workspace_ = (this.sourceBlock_ as BlockSvg).workspace;\r\n    if (\r\n      !quietInput &&\r\n      this.workspace_.options.modalInputs &&\r\n      (userAgent.MOBILE || userAgent.ANDROID || userAgent.IPAD)\r\n    ) {\r\n      this.showPromptEditor_();\r\n    } else {\r\n      this.showInlineEditor_(quietInput);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create and show a text input editor that is a prompt (usually a popup).\r\n   * Mobile browsers may have issues with in-line textareas (focus and\r\n   * keyboards).\r\n   */\r\n  private showPromptEditor_() {\r\n    dialog.prompt(\r\n      Msg['CHANGE_VALUE_TITLE'],\r\n      this.getText(),\r\n      (text: string | null) => {\r\n        // Text is null if user pressed cancel button.\r\n        if (text !== null) {\r\n          this.setValue(this.getValueFromEditorText_(text));\r\n        }\r\n        this.onFinishEditing_(this.value_);\r\n      },\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Create and show a text input editor that sits directly over the text input.\r\n   *\r\n   * @param quietInput True if editor should be created without focus.\r\n   */\r\n  private showInlineEditor_(quietInput: boolean) {\r\n    const block = this.getSourceBlock();\r\n    if (!block) {\r\n      throw new UnattachedFieldError();\r\n    }\r\n    WidgetDiv.show(this, block.RTL, this.widgetDispose_.bind(this));\r\n    this.htmlInput_ = this.widgetCreate_() as HTMLInputElement;\r\n    this.isBeingEdited_ = true;\r\n    this.valueWhenEditorWasOpened_ = this.value_;\r\n\r\n    if (!quietInput) {\r\n      (this.htmlInput_ as HTMLElement).focus({\r\n        preventScroll: true,\r\n      });\r\n      this.htmlInput_.select();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create the text input editor widget.\r\n   *\r\n   * @returns The newly created text input editor.\r\n   */\r\n  protected widgetCreate_(): HTMLElement {\r\n    const block = this.getSourceBlock();\r\n    if (!block) {\r\n      throw new UnattachedFieldError();\r\n    }\r\n    eventUtils.setGroup(true);\r\n    const div = WidgetDiv.getDiv();\r\n\r\n    const clickTarget = this.getClickTarget_();\r\n    if (!clickTarget) throw new Error('A click target has not been set.');\r\n    dom.addClass(clickTarget, 'editing');\r\n\r\n    const htmlInput = document.createElement('input');\r\n    htmlInput.className = 'blocklyHtmlInput';\r\n    // AnyDuringMigration because:  Argument of type 'boolean' is not assignable\r\n    // to parameter of type 'string'.\r\n    htmlInput.setAttribute(\r\n      'spellcheck',\r\n      this.spellcheck_ as AnyDuringMigration,\r\n    );\r\n    const scale = this.workspace_!.getScale();\r\n    const fontSize = this.getConstants()!.FIELD_TEXT_FONTSIZE * scale + 'pt';\r\n    div!.style.fontSize = fontSize;\r\n    htmlInput.style.fontSize = fontSize;\r\n    let borderRadius = FieldInput.BORDERRADIUS * scale + 'px';\r\n\r\n    if (this.isFullBlockField()) {\r\n      const bBox = this.getScaledBBox();\r\n\r\n      // Override border radius.\r\n      borderRadius = (bBox.bottom - bBox.top) / 2 + 'px';\r\n      // Pull stroke colour from the existing shadow block\r\n      const strokeColour = block.getParent()\r\n        ? (block.getParent() as BlockSvg).style.colourTertiary\r\n        : (this.sourceBlock_ as BlockSvg).style.colourTertiary;\r\n      htmlInput.style.border = 1 * scale + 'px solid ' + strokeColour;\r\n      div!.style.borderRadius = borderRadius;\r\n      div!.style.transition = 'box-shadow 0.25s ease 0s';\r\n      if (this.getConstants()!.FIELD_TEXTINPUT_BOX_SHADOW) {\r\n        div!.style.boxShadow =\r\n          'rgba(255, 255, 255, 0.3) 0 0 0 ' + 4 * scale + 'px';\r\n      }\r\n    }\r\n    htmlInput.style.borderRadius = borderRadius;\r\n\r\n    div!.appendChild(htmlInput);\r\n\r\n    htmlInput.value = htmlInput.defaultValue = this.getEditorText_(this.value_);\r\n    htmlInput.setAttribute('data-untyped-default-value', String(this.value_));\r\n\r\n    this.resizeEditor_();\r\n\r\n    this.bindInputEvents_(htmlInput);\r\n\r\n    return htmlInput;\r\n  }\r\n\r\n  /**\r\n   * Closes the editor, saves the results, and disposes of any events or\r\n   * DOM-references belonging to the editor.\r\n   */\r\n  protected widgetDispose_() {\r\n    // Non-disposal related things that we do when the editor closes.\r\n    this.isBeingEdited_ = false;\r\n    this.isTextValid_ = true;\r\n    // Make sure the field's node matches the field's internal value.\r\n    this.forceRerender();\r\n    this.onFinishEditing_(this.value_);\r\n\r\n    if (\r\n      this.sourceBlock_ &&\r\n      eventUtils.isEnabled() &&\r\n      this.valueWhenEditorWasOpened_ !== null &&\r\n      this.valueWhenEditorWasOpened_ !== this.value_\r\n    ) {\r\n      // When closing a field input widget, fire an event indicating that the\r\n      // user has completed a sequence of changes. The value may have changed\r\n      // multiple times while the editor was open, but this will fire an event\r\n      // containing the value when the editor was opened as well as the new one.\r\n      eventUtils.fire(\r\n        new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\r\n          this.sourceBlock_,\r\n          'field',\r\n          this.name || null,\r\n          this.valueWhenEditorWasOpened_,\r\n          this.value_,\r\n        ),\r\n      );\r\n      this.valueWhenEditorWasOpened_ = null;\r\n    }\r\n\r\n    eventUtils.setGroup(false);\r\n\r\n    // Actual disposal.\r\n    this.unbindInputEvents_();\r\n    const style = WidgetDiv.getDiv()!.style;\r\n    style.width = 'auto';\r\n    style.height = 'auto';\r\n    style.fontSize = '';\r\n    style.transition = '';\r\n    style.boxShadow = '';\r\n    this.htmlInput_ = null;\r\n\r\n    const clickTarget = this.getClickTarget_();\r\n    if (!clickTarget) throw new Error('A click target has not been set.');\r\n    dom.removeClass(clickTarget, 'editing');\r\n  }\r\n\r\n  /**\r\n   * A callback triggered when the user is done editing the field via the UI.\r\n   *\r\n   * @param _value The new value of the field.\r\n   */\r\n  onFinishEditing_(_value: AnyDuringMigration) {}\r\n\r\n  /**\r\n   * Bind handlers for user input on the text input field's editor.\r\n   *\r\n   * @param htmlInput The htmlInput to which event handlers will be bound.\r\n   */\r\n  protected bindInputEvents_(htmlInput: HTMLElement) {\r\n    // Trap Enter without IME and Esc to hide.\r\n    this.onKeyDownWrapper_ = browserEvents.conditionalBind(\r\n      htmlInput,\r\n      'keydown',\r\n      this,\r\n      this.onHtmlInputKeyDown_,\r\n    );\r\n    // Resize after every input change.\r\n    this.onKeyInputWrapper_ = browserEvents.conditionalBind(\r\n      htmlInput,\r\n      'input',\r\n      this,\r\n      this.onHtmlInputChange_,\r\n    );\r\n  }\r\n\r\n  /** Unbind handlers for user input and workspace size changes. */\r\n  protected unbindInputEvents_() {\r\n    if (this.onKeyDownWrapper_) {\r\n      browserEvents.unbind(this.onKeyDownWrapper_);\r\n      this.onKeyDownWrapper_ = null;\r\n    }\r\n    if (this.onKeyInputWrapper_) {\r\n      browserEvents.unbind(this.onKeyInputWrapper_);\r\n      this.onKeyInputWrapper_ = null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle key down to the editor.\r\n   *\r\n   * @param e Keyboard event.\r\n   */\r\n  protected onHtmlInputKeyDown_(e: KeyboardEvent) {\r\n    if (e.key === 'Enter') {\r\n      WidgetDiv.hide();\r\n      dropDownDiv.hideWithoutAnimation();\r\n    } else if (e.key === 'Escape') {\r\n      this.setValue(\r\n        this.htmlInput_!.getAttribute('data-untyped-default-value'),\r\n        false,\r\n      );\r\n      WidgetDiv.hide();\r\n      dropDownDiv.hideWithoutAnimation();\r\n    } else if (e.key === 'Tab') {\r\n      WidgetDiv.hide();\r\n      dropDownDiv.hideWithoutAnimation();\r\n      (this.sourceBlock_ as BlockSvg).tab(this, !e.shiftKey);\r\n      e.preventDefault();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle a change to the editor.\r\n   *\r\n   * @param _e Keyboard event.\r\n   */\r\n  private onHtmlInputChange_(_e: Event) {\r\n    // Intermediate value changes from user input are not confirmed until the\r\n    // user closes the editor, and may be numerous. Inhibit reporting these as\r\n    // normal block change events, and instead report them as special\r\n    // intermediate changes that do not get recorded in undo history.\r\n    const oldValue = this.value_;\r\n    // Change the field's value without firing the normal change event.\r\n    this.setValue(this.getValueFromEditorText_(this.htmlInput_!.value), false);\r\n    if (\r\n      this.sourceBlock_ &&\r\n      eventUtils.isEnabled() &&\r\n      this.value_ !== oldValue\r\n    ) {\r\n      // Fire a special event indicating that the value changed but the change\r\n      // isn't complete yet and normal field change listeners can wait.\r\n      eventUtils.fire(\r\n        new (eventUtils.get(eventUtils.BLOCK_FIELD_INTERMEDIATE_CHANGE))(\r\n          this.sourceBlock_,\r\n          this.name || null,\r\n          oldValue,\r\n          this.value_,\r\n        ),\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set the HTML input value and the field's internal value. The difference\r\n   * between this and `setValue` is that this also updates the HTML input\r\n   * value whilst editing.\r\n   *\r\n   * @param newValue New value.\r\n   * @param fireChangeEvent Whether to fire a change event. Defaults to true.\r\n   *     Should usually be true unless the change will be reported some other\r\n   *     way, e.g. an intermediate field change event.\r\n   */\r\n  protected setEditorValue_(\r\n    newValue: AnyDuringMigration,\r\n    fireChangeEvent = true,\r\n  ) {\r\n    this.isDirty_ = true;\r\n    if (this.isBeingEdited_) {\r\n      // In the case this method is passed an invalid value, we still\r\n      // pass it through the transformation method `getEditorText` to deal\r\n      // with. Otherwise, the internal field's state will be inconsistent\r\n      // with what's shown to the user.\r\n      this.htmlInput_!.value = this.getEditorText_(newValue);\r\n    }\r\n    this.setValue(newValue, fireChangeEvent);\r\n  }\r\n\r\n  /** Resize the editor to fit the text. */\r\n  protected resizeEditor_() {\r\n    const block = this.getSourceBlock();\r\n    if (!block) {\r\n      throw new UnattachedFieldError();\r\n    }\r\n    const div = WidgetDiv.getDiv();\r\n    const bBox = this.getScaledBBox();\r\n    div!.style.width = bBox.right - bBox.left + 'px';\r\n    div!.style.height = bBox.bottom - bBox.top + 'px';\r\n\r\n    // In RTL mode block fields and LTR input fields the left edge moves,\r\n    // whereas the right edge is fixed.  Reposition the editor.\r\n    const x = block.RTL ? bBox.right - div!.offsetWidth : bBox.left;\r\n    const xy = new Coordinate(x, bBox.top);\r\n\r\n    div!.style.left = xy.x + 'px';\r\n    div!.style.top = xy.y + 'px';\r\n  }\r\n\r\n  /**\r\n   * Handles repositioning the WidgetDiv used for input fields when the\r\n   * workspace is resized. Will bump the block into the viewport and update the\r\n   * position of the text input if necessary.\r\n   *\r\n   * @returns True for rendered workspaces, as we never want to hide the widget\r\n   *     div.\r\n   */\r\n  override repositionForWindowResize(): boolean {\r\n    const block = this.getSourceBlock();\r\n    // This shouldn't be possible. We should never have a WidgetDiv if not using\r\n    // rendered blocks.\r\n    if (!(block instanceof BlockSvg)) return false;\r\n\r\n    const bumped = bumpObjects.bumpIntoBounds(\r\n      this.workspace_!,\r\n      this.workspace_!.getMetricsManager().getViewMetrics(true),\r\n      block,\r\n    );\r\n\r\n    if (!bumped) this.resizeEditor_();\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Returns whether or not the field is tab navigable.\r\n   *\r\n   * @returns True if the field is tab navigable.\r\n   */\r\n  override isTabNavigable(): boolean {\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Use the `getText_` developer hook to override the field's text\r\n   * representation. When we're currently editing, return the current HTML value\r\n   * instead. Otherwise, return null which tells the field to use the default\r\n   * behaviour (which is a string cast of the field's value).\r\n   *\r\n   * @returns The HTML value if we're editing, otherwise null.\r\n   */\r\n  protected override getText_(): string | null {\r\n    if (this.isBeingEdited_ && this.htmlInput_) {\r\n      // We are currently editing, return the HTML input value instead.\r\n      return this.htmlInput_.value;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Transform the provided value into a text to show in the HTML input.\r\n   * Override this method if the field's HTML input representation is different\r\n   * than the field's value. This should be coupled with an override of\r\n   * `getValueFromEditorText_`.\r\n   *\r\n   * @param value The value stored in this field.\r\n   * @returns The text to show on the HTML input.\r\n   */\r\n  protected getEditorText_(value: AnyDuringMigration): string {\r\n    return `${value}`;\r\n  }\r\n\r\n  /**\r\n   * Transform the text received from the HTML input into a value to store\r\n   * in this field.\r\n   * Override this method if the field's HTML input representation is different\r\n   * than the field's value. This should be coupled with an override of\r\n   * `getEditorText_`.\r\n   *\r\n   * @param text Text received from the HTML input.\r\n   * @returns The value to store.\r\n   */\r\n  protected getValueFromEditorText_(text: string): AnyDuringMigration {\r\n    return text;\r\n  }\r\n}\r\n\r\n/**\r\n * Config options for the input field.\r\n *\r\n * @internal\r\n */\r\nexport interface FieldInputConfig extends FieldConfig {\r\n  spellcheck?: boolean;\r\n}\r\n\r\n/**\r\n * A function that is called to validate changes to the field's value before\r\n * they are set.\r\n *\r\n * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/fields/validators#return_values}\r\n * @param newValue The value to be validated.\r\n * @returns One of three instructions for setting the new value: `T`, `null`,\r\n * or `undefined`.\r\n *\r\n * - `T` to set this function's returned value instead of `newValue`.\r\n *\r\n * - `null` to invoke `doValueInvalid_` and not set a value.\r\n *\r\n * - `undefined` to set `newValue` as is.\r\n * @internal\r\n */\r\nexport type FieldInputValidator<T extends InputTypes> = FieldValidator<\r\n  string | T\r\n>;\r\n","/**\r\n * @license\r\n * Copyright 2012 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Text input field.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.FieldTextInput\r\n\r\n// Unused import preserved for side-effects. Remove if unneeded.\r\nimport './events/events_block_change.js';\r\n\r\nimport {Field} from './field.js';\r\nimport {\r\n  FieldInput,\r\n  FieldInputConfig,\r\n  FieldInputValidator,\r\n} from './field_input.js';\r\nimport * as fieldRegistry from './field_registry.js';\r\nimport * as parsing from './utils/parsing.js';\r\n\r\n/**\r\n * Class for an editable text field.\r\n */\r\nexport class FieldTextInput extends FieldInput<string> {\r\n  /**\r\n   * @param value The initial value of the field. Should cast to a string.\r\n   *     Defaults to an empty string if null or undefined. Also accepts\r\n   *     Field.SKIP_SETUP if you wish to skip setup (only used by subclasses\r\n   *     that want to handle configuration and setting the field value after\r\n   *     their own constructors have run).\r\n   * @param validator A function that is called to validate changes to the\r\n   *     field's value. Takes in a string & returns a validated string, or null\r\n   *     to abort the change.\r\n   * @param config A map of options used to configure the field.\r\n   *     See the [field creation documentation]{@link\r\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/text-input#creation}\r\n   * for a list of properties this parameter supports.\r\n   */\r\n  constructor(\r\n    value?: string | typeof Field.SKIP_SETUP,\r\n    validator?: FieldTextInputValidator | null,\r\n    config?: FieldTextInputConfig,\r\n  ) {\r\n    super(value, validator, config);\r\n  }\r\n\r\n  /**\r\n   * Ensure that the input value casts to a valid string.\r\n   *\r\n   * @param newValue The input value.\r\n   * @returns A valid string, or null if invalid.\r\n   */\r\n  protected override doClassValidation_(\r\n    newValue?: AnyDuringMigration,\r\n  ): string | null {\r\n    if (newValue === undefined) {\r\n      return null;\r\n    }\r\n    return `${newValue}`;\r\n  }\r\n\r\n  /**\r\n   * Construct a FieldTextInput from a JSON arg object,\r\n   * dereferencing any string table references.\r\n   *\r\n   * @param options A JSON object with options (text, and spellcheck).\r\n   * @returns The new field instance.\r\n   * @nocollapse\r\n   * @internal\r\n   */\r\n  static fromJson(options: FieldTextInputFromJsonConfig): FieldTextInput {\r\n    const text = parsing.replaceMessageReferences(options.text);\r\n    // `this` might be a subclass of FieldTextInput if that class doesn't\r\n    // override the static fromJson method.\r\n    return new this(text, undefined, options);\r\n  }\r\n}\r\n\r\nfieldRegistry.register('field_input', FieldTextInput);\r\n\r\nFieldTextInput.prototype.DEFAULT_VALUE = '';\r\n\r\n/**\r\n *  Config options for the text input field.\r\n */\r\nexport type FieldTextInputConfig = FieldInputConfig;\r\n\r\n/**\r\n * fromJson config options for the text input field.\r\n */\r\nexport interface FieldTextInputFromJsonConfig extends FieldTextInputConfig {\r\n  text?: string;\r\n}\r\n\r\n/**\r\n * A function that is called to validate changes to the field's value before\r\n * they are set.\r\n *\r\n * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/fields/validators#return_values}\r\n * @param newValue The value to be validated.\r\n * @returns One of three instructions for setting the new value: `T`, `null`,\r\n * or `undefined`.\r\n *\r\n * - `T` to set this function's returned value instead of `newValue`.\r\n *\r\n * - `null` to invoke `doValueInvalid_` and not set a value.\r\n *\r\n * - `undefined` to set `newValue` as is.\r\n */\r\nexport type FieldTextInputValidator = FieldInputValidator<string>;\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.zelos.BottomRow\r\n\r\nimport type {BlockSvg} from '../../../block_svg.js';\r\nimport type {ConstantProvider} from '../../../renderers/common/constants.js';\r\nimport {BottomRow as BaseBottomRow} from '../../../renderers/measurables/bottom_row.js';\r\n\r\n/**\r\n * An object containing information about what elements are in the bottom row of\r\n * a block as well as spacing information for the top row.\r\n * Elements in a bottom row can consist of corners, spacers and next\r\n * connections.\r\n */\r\nexport class BottomRow extends BaseBottomRow {\r\n  /**\r\n   * @param constants The rendering constants provider.\r\n   */\r\n  constructor(constants: ConstantProvider) {\r\n    super(constants);\r\n  }\r\n\r\n  override endsWithElemSpacer() {\r\n    return false;\r\n  }\r\n\r\n  /** Render a round corner unless the block has an output connection. */\r\n  override hasLeftSquareCorner(block: BlockSvg) {\r\n    return !!block.outputConnection;\r\n  }\r\n\r\n  /** Render a round corner unless the block has an output connection. */\r\n  override hasRightSquareCorner(block: BlockSvg) {\r\n    return (\r\n      !!block.outputConnection &&\r\n      !block.statementInputCount &&\r\n      !block.nextConnection\r\n    );\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.zelos.StatementInput\r\n\r\n/* eslint-disable-next-line no-unused-vars */\r\nimport type {Input} from '../../../inputs/input.js';\r\nimport type {ConstantProvider} from '../../../renderers/common/constants.js';\r\nimport {StatementInput as BaseStatementInput} from '../../../renderers/measurables/statement_input.js';\r\n\r\n/**\r\n * An object containing information about the space a statement input takes up\r\n * during rendering.\r\n */\r\nexport class StatementInput extends BaseStatementInput {\r\n  connectedBottomNextConnection = false;\r\n\r\n  /**\r\n   * @param constants The rendering constants provider.\r\n   * @param input The statement input to measure and store information for.\r\n   */\r\n  constructor(constants: ConstantProvider, input: Input) {\r\n    super(constants, input);\r\n\r\n    if (this.connectedBlock) {\r\n      // Find the bottom-most connected block in the stack.\r\n      let block = this.connectedBlock;\r\n      let nextBlock;\r\n      while ((nextBlock = block.getNextBlock())) {\r\n        block = nextBlock;\r\n      }\r\n      if (!block.nextConnection) {\r\n        this.height = this.connectedBlockHeight;\r\n        this.connectedBottomNextConnection = true;\r\n      }\r\n    }\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.zelos.RightConnectionShape\r\n\r\nimport type {ConstantProvider} from '../../../renderers/common/constants.js';\r\nimport {Measurable} from '../../../renderers/measurables/base.js';\r\nimport {Types} from '../../../renderers/measurables/types.js';\r\n\r\n/**\r\n * An object containing information about the space a right connection shape\r\n * takes up during rendering.\r\n */\r\nexport class RightConnectionShape extends Measurable {\r\n  // Size is dynamic\r\n  override height = 0;\r\n  override width = 0;\r\n\r\n  /**\r\n   * @param constants The rendering constants provider.\r\n   */\r\n  constructor(constants: ConstantProvider) {\r\n    super(constants);\r\n    this.type |= Types.getType('RIGHT_CONNECTION');\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.zelos.TopRow\r\n\r\nimport type {BlockSvg} from '../../../block_svg.js';\r\nimport type {ConstantProvider} from '../../../renderers/common/constants.js';\r\nimport {TopRow as BaseTopRow} from '../../../renderers/measurables/top_row.js';\r\n\r\n/**\r\n * An object containing information about what elements are in the top row of a\r\n * block as well as sizing information for the top row.\r\n * Elements in a top row can consist of corners, hats, spacers, and previous\r\n * connections.\r\n * After this constructor is called, the row will contain all non-spacer\r\n * elements it needs.\r\n */\r\nexport class TopRow extends BaseTopRow {\r\n  /**\r\n   * @param constants The rendering constants provider.\r\n   */\r\n  constructor(constants: ConstantProvider) {\r\n    super(constants);\r\n  }\r\n\r\n  override endsWithElemSpacer() {\r\n    return false;\r\n  }\r\n\r\n  /** Render a round corner unless the block has an output connection. */\r\n  override hasLeftSquareCorner(block: BlockSvg) {\r\n    const hasHat =\r\n      (block.hat ? block.hat === 'cap' : this.constants_.ADD_START_HATS) &&\r\n      !block.outputConnection &&\r\n      !block.previousConnection;\r\n    return !!block.outputConnection || hasHat;\r\n  }\r\n\r\n  /** Render a round corner unless the block has an output connection. */\r\n  override hasRightSquareCorner(block: BlockSvg) {\r\n    return (\r\n      !!block.outputConnection &&\r\n      !block.statementInputCount &&\r\n      !block.nextConnection\r\n    );\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.zelos.RenderInfo\r\n\r\nimport type {BlockSvg} from '../../block_svg.js';\r\nimport {DummyInput} from '../../inputs/dummy_input.js';\r\nimport {EndRowInput} from '../../inputs/end_row_input.js';\r\nimport {FieldImage} from '../../field_image.js';\r\nimport {FieldLabel} from '../../field_label.js';\r\nimport {FieldTextInput} from '../../field_textinput.js';\r\nimport {Input} from '../../inputs/input.js';\r\nimport {Align} from '../../inputs/align.js';\r\nimport {RenderInfo as BaseRenderInfo} from '../common/info.js';\r\nimport type {Measurable} from '../measurables/base.js';\r\nimport {Field} from '../measurables/field.js';\r\nimport {InRowSpacer} from '../measurables/in_row_spacer.js';\r\nimport {InputConnection} from '../measurables/input_connection.js';\r\nimport {StatementInput} from '../../inputs/statement_input.js';\r\nimport type {Row} from '../measurables/row.js';\r\nimport type {SpacerRow} from '../measurables/spacer_row.js';\r\nimport {Types} from '../measurables/types.js';\r\nimport {ValueInput} from '../../inputs/value_input.js';\r\n\r\nimport type {ConstantProvider, InsideCorners} from './constants.js';\r\nimport {BottomRow} from './measurables/bottom_row.js';\r\nimport {StatementInput as StatementInputMeasurable} from './measurables/inputs.js';\r\nimport {RightConnectionShape} from './measurables/row_elements.js';\r\nimport {TopRow} from './measurables/top_row.js';\r\nimport type {PathObject} from './path_object.js';\r\nimport type {Renderer} from './renderer.js';\r\n\r\n/**\r\n * An object containing all sizing information needed to draw this block.\r\n *\r\n * This measure pass does not propagate changes to the block (although fields\r\n * may choose to rerender when getSize() is called).  However, calling it\r\n * repeatedly may be expensive.\r\n */\r\nexport class RenderInfo extends BaseRenderInfo {\r\n  override topRow: TopRow;\r\n  override bottomRow: BottomRow;\r\n  override constants_: ConstantProvider;\r\n  override renderer_: Renderer;\r\n\r\n  override isInline = true;\r\n  isMultiRow: boolean;\r\n  hasStatementInput: boolean;\r\n  rightSide: RightConnectionShape | null;\r\n  private readonly rightAlignedDummyInputs: WeakMap<Row, Input>;\r\n\r\n  /**\r\n   * @param renderer The renderer in use.\r\n   * @param block The block to measure.\r\n   */\r\n  constructor(renderer: Renderer, block: BlockSvg) {\r\n    super(renderer, block);\r\n\r\n    this.renderer_ = renderer;\r\n\r\n    this.constants_ = this.renderer_.getConstants();\r\n\r\n    /**\r\n     * An object with rendering information about the top row of the block.\r\n     */\r\n    this.topRow = new TopRow(this.constants_);\r\n\r\n    /**\r\n     * An object with rendering information about the bottom row of the block.\r\n     */\r\n    this.bottomRow = new BottomRow(this.constants_);\r\n\r\n    /**\r\n     * Whether the block should be rendered as a multi-line block, either\r\n     * because it's not inline or because it has been collapsed.\r\n     */\r\n    this.isMultiRow = !block.getInputsInline() || block.isCollapsed();\r\n\r\n    /**\r\n     * Whether or not the block has a statement input in one of its rows.\r\n     */\r\n    this.hasStatementInput = block.statementInputCount > 0;\r\n\r\n    /**\r\n     * An object with rendering information about the right connection shape.\r\n     */\r\n    this.rightSide = this.outputConnection\r\n      ? new RightConnectionShape(this.constants_)\r\n      : null;\r\n\r\n    /**\r\n     * A map of rows to right aligned dummy inputs within those rows. Used to\r\n     * add padding between left and right aligned inputs.\r\n     */\r\n    this.rightAlignedDummyInputs = new WeakMap();\r\n  }\r\n\r\n  /**\r\n   * Get the block renderer in use.\r\n   *\r\n   * @returns The block renderer in use.\r\n   */\r\n  override getRenderer(): Renderer {\r\n    return this.renderer_ as Renderer;\r\n  }\r\n\r\n  override measure() {\r\n    // Modifying parent measure method to add `adjustXPosition_`.\r\n    this.createRows_();\r\n    this.addElemSpacing_();\r\n    this.addRowSpacing_();\r\n    this.adjustXPosition_();\r\n    this.computeBounds_();\r\n    this.alignRowElements_();\r\n    this.finalize_();\r\n  }\r\n\r\n  override shouldStartNewRow_(currInput: Input, prevInput: Input): boolean {\r\n    // If this is the first input, just add to the existing row.\r\n    // That row is either empty or has some icons in it.\r\n    if (!prevInput) {\r\n      return false;\r\n    }\r\n    // If the previous input was an end-row input, then any following input\r\n    // should always be rendered on the next row.\r\n    if (prevInput instanceof EndRowInput) {\r\n      return true;\r\n    }\r\n    // A statement input or an input following one always gets a new row.\r\n    if (\r\n      currInput instanceof StatementInput ||\r\n      prevInput instanceof StatementInput\r\n    ) {\r\n      return true;\r\n    }\r\n    // Value, dummy, and end-row inputs get new row if inputs are not inlined.\r\n    if (\r\n      currInput instanceof ValueInput ||\r\n      currInput instanceof DummyInput ||\r\n      currInput instanceof EndRowInput\r\n    ) {\r\n      return !this.isInline || this.isMultiRow;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  override getDesiredRowWidth_(row: Row): number {\r\n    if (row.hasStatement) {\r\n      const rightCornerWidth =\r\n        (this.constants_.INSIDE_CORNERS as InsideCorners).rightWidth || 0;\r\n      return this.width - this.startX - rightCornerWidth;\r\n    }\r\n    return super.getDesiredRowWidth_(row);\r\n  }\r\n\r\n  override getInRowSpacing_(\r\n    prev: Measurable | null,\r\n    next: Measurable | null,\r\n  ): number {\r\n    if (!prev || !next) {\r\n      // No need for padding at the beginning or end of the row if the\r\n      // output shape is dynamic.\r\n      if (\r\n        this.outputConnection &&\r\n        this.outputConnection.isDynamicShape &&\r\n        !this.hasStatementInput &&\r\n        !this.bottomRow.hasNextConnection\r\n      ) {\r\n        return this.constants_.NO_PADDING;\r\n      }\r\n    }\r\n    if (!prev) {\r\n      // Statement input padding.\r\n      if (next && Types.isStatementInput(next)) {\r\n        return this.constants_.STATEMENT_INPUT_PADDING_LEFT;\r\n      }\r\n    }\r\n    // Spacing between a rounded corner and a previous or next connection.\r\n    if (prev && Types.isLeftRoundedCorner(prev) && next) {\r\n      if (Types.isPreviousConnection(next) || Types.isNextConnection(next)) {\r\n        return next.notchOffset - this.constants_.CORNER_RADIUS;\r\n      }\r\n    }\r\n    // Spacing between a square corner and a hat.\r\n    if (prev && Types.isLeftSquareCorner(prev) && next && Types.isHat(next)) {\r\n      return this.constants_.NO_PADDING;\r\n    }\r\n    return this.constants_.MEDIUM_PADDING;\r\n  }\r\n\r\n  override getSpacerRowHeight_(prev: Row, next: Row): number {\r\n    // If we have an empty block add a spacer to increase the height.\r\n    if (Types.isTopRow(prev) && Types.isBottomRow(next)) {\r\n      return this.constants_.EMPTY_BLOCK_SPACER_HEIGHT;\r\n    }\r\n    const followsStatement = Types.isInputRow(prev) && prev.hasStatement;\r\n    const precedesStatement = Types.isInputRow(next) && next.hasStatement;\r\n    if (precedesStatement || followsStatement) {\r\n      const cornerHeight =\r\n        (this.constants_.INSIDE_CORNERS as InsideCorners).rightHeight || 0;\r\n      const height = Math.max(this.constants_.NOTCH_HEIGHT, cornerHeight);\r\n      return precedesStatement && followsStatement\r\n        ? Math.max(height, this.constants_.DUMMY_INPUT_MIN_HEIGHT)\r\n        : height;\r\n    }\r\n    // Top and bottom rows act as a spacer so we don't need any extra padding.\r\n    if (Types.isTopRow(prev)) {\r\n      const topRow = prev as TopRow;\r\n      if (\r\n        !topRow.hasPreviousConnection &&\r\n        (!this.outputConnection || this.hasStatementInput)\r\n      ) {\r\n        return Math.abs(\r\n          this.constants_.NOTCH_HEIGHT - this.constants_.CORNER_RADIUS,\r\n        );\r\n      }\r\n      return this.constants_.NO_PADDING;\r\n    }\r\n    if (Types.isBottomRow(next)) {\r\n      const bottomRow = next as BottomRow;\r\n      if (!this.outputConnection) {\r\n        const topHeight =\r\n          Math.max(\r\n            this.topRow.minHeight,\r\n            Math.max(\r\n              this.constants_.NOTCH_HEIGHT,\r\n              this.constants_.CORNER_RADIUS,\r\n            ),\r\n          ) - this.constants_.CORNER_RADIUS;\r\n        return topHeight;\r\n      } else if (!bottomRow.hasNextConnection && this.hasStatementInput) {\r\n        return Math.abs(\r\n          this.constants_.NOTCH_HEIGHT - this.constants_.CORNER_RADIUS,\r\n        );\r\n      }\r\n      return this.constants_.NO_PADDING;\r\n    }\r\n    return this.constants_.MEDIUM_PADDING;\r\n  }\r\n\r\n  override getSpacerRowWidth_(prev: Row, next: Row): number {\r\n    const width = this.width - this.startX;\r\n    if (\r\n      (Types.isInputRow(prev) && prev.hasStatement) ||\r\n      (Types.isInputRow(next) && next.hasStatement)\r\n    ) {\r\n      return Math.max(width, this.constants_.STATEMENT_INPUT_SPACER_MIN_WIDTH);\r\n    }\r\n    return width;\r\n  }\r\n\r\n  override getElemCenterline_(row: Row, elem: Measurable): number {\r\n    if (\r\n      row.hasStatement &&\r\n      !Types.isSpacer(elem) &&\r\n      !Types.isStatementInput(elem)\r\n    ) {\r\n      return row.yPos + this.constants_.EMPTY_STATEMENT_INPUT_HEIGHT / 2;\r\n    }\r\n    if (Types.isInlineInput(elem) && elem instanceof InputConnection) {\r\n      const connectedBlock = elem.connectedBlock;\r\n      if (\r\n        connectedBlock &&\r\n        connectedBlock.outputConnection &&\r\n        connectedBlock.nextConnection\r\n      ) {\r\n        return row.yPos + connectedBlock.height / 2;\r\n      }\r\n    }\r\n    return super.getElemCenterline_(row, elem);\r\n  }\r\n\r\n  override addInput_(input: Input, activeRow: Row) {\r\n    // If we have two dummy inputs on the same row, one aligned left and the\r\n    // other right, keep track of the right aligned dummy input so we can add\r\n    // padding later. An end-row input after a dummy input also counts.\r\n    if (\r\n      (input instanceof DummyInput || input instanceof EndRowInput) &&\r\n      activeRow.hasDummyInput &&\r\n      activeRow.align === Align.LEFT &&\r\n      input.align === Align.RIGHT\r\n    ) {\r\n      this.rightAlignedDummyInputs.set(activeRow, input);\r\n    } else if (input instanceof StatementInput) {\r\n      // Handle statements without next connections correctly.\r\n      activeRow.elements.push(\r\n        new StatementInputMeasurable(this.constants_, input),\r\n      );\r\n      activeRow.hasStatement = true;\r\n\r\n      if (activeRow.align === null) {\r\n        activeRow.align = input.align;\r\n      }\r\n      return;\r\n    }\r\n    super.addInput_(input, activeRow);\r\n  }\r\n\r\n  override addAlignmentPadding_(row: Row, missingSpace: number) {\r\n    if (this.rightAlignedDummyInputs.get(row)) {\r\n      let alignmentDivider;\r\n      for (let i = 0; i < row.elements.length; i++) {\r\n        const elem = row.elements[i];\r\n        if (Types.isSpacer(elem)) {\r\n          alignmentDivider = elem;\r\n        }\r\n        if (\r\n          Types.isField(elem) &&\r\n          elem instanceof Field &&\r\n          elem.parentInput === this.rightAlignedDummyInputs.get(row)\r\n        ) {\r\n          break;\r\n        }\r\n      }\r\n      if (alignmentDivider) {\r\n        alignmentDivider.width += missingSpace;\r\n        row.width += missingSpace;\r\n        return;\r\n      }\r\n    }\r\n    super.addAlignmentPadding_(row, missingSpace);\r\n  }\r\n\r\n  /**\r\n   * Adjust the x position of fields to bump all non-label fields in the first\r\n   * row past the notch position.  This must be called before `computeBounds`\r\n   * is called.\r\n   */\r\n  protected adjustXPosition_() {\r\n    const notchTotalWidth =\r\n      this.constants_.NOTCH_OFFSET_LEFT + this.constants_.NOTCH_WIDTH;\r\n    let minXPos = notchTotalWidth;\r\n    // Run through every input row on the block and only apply bump logic to the\r\n    // first input row (if the block has prev connection) and every input row\r\n    // that has a prev and next notch.\r\n    for (let i = 2; i < this.rows.length - 1; i += 2) {\r\n      const prevSpacer = this.rows[i - 1] as SpacerRow;\r\n      const row = this.rows[i];\r\n      const nextSpacer = this.rows[i + 1] as SpacerRow;\r\n\r\n      const hasPrevNotch =\r\n        i === 2\r\n          ? !!this.topRow.hasPreviousConnection\r\n          : !!prevSpacer.followsStatement;\r\n      const hasNextNotch =\r\n        i + 2 >= this.rows.length - 1\r\n          ? !!this.bottomRow.hasNextConnection\r\n          : !!nextSpacer.precedesStatement;\r\n\r\n      if (Types.isInputRow(row) && row.hasStatement) {\r\n        row.measure();\r\n        minXPos =\r\n          row.width - (row.getLastInput()?.width ?? 0) + notchTotalWidth;\r\n      } else if (\r\n        hasPrevNotch &&\r\n        (i === 2 || hasNextNotch) &&\r\n        Types.isInputRow(row) &&\r\n        !row.hasStatement\r\n      ) {\r\n        let xCursor = row.xPos;\r\n        let prevInRowSpacer = null;\r\n        for (let j = 0; j < row.elements.length; j++) {\r\n          const elem = row.elements[j];\r\n          if (Types.isSpacer(elem)) {\r\n            prevInRowSpacer = elem;\r\n          }\r\n          if (prevInRowSpacer && (Types.isField(elem) || Types.isInput(elem))) {\r\n            if (\r\n              xCursor < minXPos &&\r\n              !(\r\n                Types.isField(elem) &&\r\n                elem instanceof Field &&\r\n                (elem.field instanceof FieldLabel ||\r\n                  elem.field instanceof FieldImage)\r\n              )\r\n            ) {\r\n              const difference = minXPos - xCursor;\r\n              prevInRowSpacer.width += difference;\r\n            }\r\n          }\r\n          xCursor += elem.width;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Finalize the output connection info.  In particular, set the height of the\r\n   * output connection to match that of the block.  For the right side, add a\r\n   * right connection shape element and have it match the dimensions of the\r\n   * output connection.\r\n   */\r\n  protected finalizeOutputConnection_() {\r\n    // Dynamic output connections depend on the height of the block.\r\n    if (!this.outputConnection || !this.outputConnection.isDynamicShape) {\r\n      return;\r\n    }\r\n    const outputConnectionShape = this.outputConnection.shape;\r\n    if (\r\n      !('isDynamic' in outputConnectionShape && outputConnectionShape.isDynamic)\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    let yCursor = 0;\r\n    // Determine the block height.\r\n    for (let i = 0; i < this.rows.length; i++) {\r\n      const row = this.rows[i];\r\n      row.yPos = yCursor;\r\n      yCursor += row.height;\r\n    }\r\n    this.height = yCursor;\r\n\r\n    // Adjust the height of the output connection.\r\n    const blockHeight = this.bottomRow.hasNextConnection\r\n      ? this.height - this.bottomRow.descenderHeight\r\n      : this.height;\r\n    const connectionHeight = outputConnectionShape.height(blockHeight);\r\n    const connectionWidth = outputConnectionShape.width(blockHeight);\r\n\r\n    this.outputConnection.height = connectionHeight;\r\n    this.outputConnection.width = connectionWidth;\r\n    this.outputConnection.startX = connectionWidth;\r\n    this.outputConnection.connectionOffsetY =\r\n      outputConnectionShape.connectionOffsetY(connectionHeight);\r\n    this.outputConnection.connectionOffsetX =\r\n      outputConnectionShape.connectionOffsetX(connectionWidth);\r\n\r\n    // Add the right connection measurable.\r\n    // Don't add it if we have a value-to-statement or a value-to-stack block.\r\n    let rightConnectionWidth = 0;\r\n    if (!this.hasStatementInput && !this.bottomRow.hasNextConnection) {\r\n      rightConnectionWidth = connectionWidth;\r\n      this.rightSide!.height = connectionHeight;\r\n      this.rightSide!.width = rightConnectionWidth;\r\n      this.rightSide!.centerline = connectionHeight / 2;\r\n      this.rightSide!.xPos = this.width + rightConnectionWidth;\r\n    }\r\n    this.startX = connectionWidth;\r\n    this.width += connectionWidth + rightConnectionWidth;\r\n    this.widthWithChildren += connectionWidth + rightConnectionWidth;\r\n  }\r\n\r\n  /**\r\n   * Finalize horizontal alignment of elements on the block.  In particular,\r\n   * reduce the implicit spacing created by the left and right output connection\r\n   * shapes by adding setting negative spacing onto the leftmost and rightmost\r\n   * spacers.\r\n   */\r\n  protected finalizeHorizontalAlignment_() {\r\n    if (\r\n      !this.outputConnection ||\r\n      this.hasStatementInput ||\r\n      this.bottomRow.hasNextConnection\r\n    ) {\r\n      return;\r\n    }\r\n    let totalNegativeSpacing = 0;\r\n    for (let i = 0; i < this.rows.length; i++) {\r\n      const row = this.rows[i];\r\n      if (!Types.isInputRow(row)) {\r\n        continue;\r\n      }\r\n      const firstElem = row.elements[1];\r\n      const lastElem = row.elements[row.elements.length - 2];\r\n      let leftNegPadding = this.getNegativeSpacing_(firstElem);\r\n      let rightNegPadding = this.getNegativeSpacing_(lastElem);\r\n      totalNegativeSpacing = leftNegPadding + rightNegPadding;\r\n      const minBlockWidth =\r\n        this.constants_.MIN_BLOCK_WIDTH + this.outputConnection.width * 2;\r\n      if (this.width - totalNegativeSpacing < minBlockWidth) {\r\n        // Maintain a minimum block width, split negative spacing between left\r\n        // and right edge.\r\n        totalNegativeSpacing = this.width - minBlockWidth;\r\n        leftNegPadding = totalNegativeSpacing / 2;\r\n        rightNegPadding = totalNegativeSpacing / 2;\r\n      }\r\n      // Add a negative spacer on the start and end of the block.\r\n      row.elements.unshift(new InRowSpacer(this.constants_, -leftNegPadding));\r\n      row.elements.push(new InRowSpacer(this.constants_, -rightNegPadding));\r\n    }\r\n    if (totalNegativeSpacing) {\r\n      this.width -= totalNegativeSpacing;\r\n      this.widthWithChildren -= totalNegativeSpacing;\r\n      this.rightSide!.xPos -= totalNegativeSpacing;\r\n      for (let i = 0; i < this.rows.length; i++) {\r\n        const row = this.rows[i];\r\n        if (Types.isTopOrBottomRow(row)) {\r\n          row.elements[1].width -= totalNegativeSpacing;\r\n        }\r\n        row.width -= totalNegativeSpacing;\r\n        row.widthWithConnectedBlocks -= totalNegativeSpacing;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Calculate the spacing to reduce the left and right edges by based on the\r\n   * outer and inner connection shape.\r\n   *\r\n   * @param elem The first or last element on a block.\r\n   * @returns The amount of spacing to reduce the first or last spacer.\r\n   */\r\n  protected getNegativeSpacing_(elem: Measurable): number {\r\n    if (!elem || !this.outputConnection) {\r\n      return 0;\r\n    }\r\n    const connectionWidth = this.outputConnection.width;\r\n    const outerShape = this.outputConnection.shape.type;\r\n    const constants = this.constants_;\r\n    if (this.inputRows.length > 1) {\r\n      switch (outerShape) {\r\n        case constants.SHAPES.ROUND: {\r\n          // Special case for multi-row round reporter blocks.\r\n          const maxWidth = this.constants_.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH;\r\n          const width = this.height / 2 > maxWidth ? maxWidth : this.height / 2;\r\n          const topPadding = this.constants_.SMALL_PADDING;\r\n          const roundPadding =\r\n            width * (1 - Math.sin(Math.acos((width - topPadding) / width)));\r\n          return connectionWidth - roundPadding;\r\n        }\r\n        default:\r\n          return 0;\r\n      }\r\n    }\r\n    if (Types.isInlineInput(elem) && elem instanceof InputConnection) {\r\n      const connectedBlock = elem.connectedBlock;\r\n      const innerShape = connectedBlock\r\n        ? (connectedBlock.pathObject as PathObject).outputShapeType\r\n        : elem.shape.type;\r\n      if (innerShape == null) {\r\n        return 0;\r\n      }\r\n      // Special case for value to stack / value to statement blocks.\r\n      if (\r\n        connectedBlock &&\r\n        connectedBlock.outputConnection &&\r\n        (connectedBlock.statementInputCount || connectedBlock.nextConnection)\r\n      ) {\r\n        return 0;\r\n      }\r\n      // Special case for hexagonal output.\r\n      if (\r\n        outerShape === constants.SHAPES.HEXAGONAL &&\r\n        outerShape !== innerShape\r\n      ) {\r\n        return 0;\r\n      }\r\n      return (\r\n        connectionWidth -\r\n        this.constants_.SHAPE_IN_SHAPE_PADDING[outerShape][innerShape]\r\n      );\r\n    } else if (Types.isField(elem) && elem instanceof Field) {\r\n      // Special case for text inputs.\r\n      if (\r\n        outerShape === constants.SHAPES.ROUND &&\r\n        elem.field instanceof FieldTextInput\r\n      ) {\r\n        return connectionWidth - 2.75 * constants.GRID_UNIT;\r\n      }\r\n      return (\r\n        connectionWidth - this.constants_.SHAPE_IN_SHAPE_PADDING[outerShape][0]\r\n      );\r\n    } else if (Types.isIcon(elem)) {\r\n      return this.constants_.SMALL_PADDING;\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  /**\r\n   * Finalize vertical alignment of rows on a block.  In particular, reduce the\r\n   * implicit spacing when a non-shadow block is connected to any of an input\r\n   * row's inline inputs.\r\n   */\r\n  protected finalizeVerticalAlignment_() {\r\n    if (this.outputConnection) {\r\n      return;\r\n    }\r\n    // Run through every input row on the block and only apply tight nesting\r\n    // logic to input rows that have a prev and next notch.\r\n    for (let i = 2; i < this.rows.length - 1; i += 2) {\r\n      const prevSpacer = this.rows[i - 1] as SpacerRow;\r\n      const row = this.rows[i];\r\n      const nextSpacer = this.rows[i + 1] as SpacerRow;\r\n\r\n      const firstRow = i === 2;\r\n      const hasPrevNotch = firstRow\r\n        ? !!this.topRow.hasPreviousConnection\r\n        : !!prevSpacer.followsStatement;\r\n      const hasNextNotch =\r\n        i + 2 >= this.rows.length - 1\r\n          ? !!this.bottomRow.hasNextConnection\r\n          : !!nextSpacer.precedesStatement;\r\n\r\n      if (hasPrevNotch) {\r\n        const elem = row.elements[1];\r\n        const hasSingleTextOrImageField =\r\n          row.elements.length === 3 &&\r\n          elem instanceof Field &&\r\n          (elem.field instanceof FieldLabel ||\r\n            elem.field instanceof FieldImage);\r\n        if (!firstRow && hasSingleTextOrImageField) {\r\n          // Remove some padding if we have a single image or text field.\r\n          prevSpacer.height -= this.constants_.SMALL_PADDING;\r\n          nextSpacer.height -= this.constants_.SMALL_PADDING;\r\n          row.height -= this.constants_.MEDIUM_PADDING;\r\n        } else if (!firstRow && !hasNextNotch) {\r\n          // Add a small padding so the notch doesn't clash with inputs/fields.\r\n          prevSpacer.height += this.constants_.SMALL_PADDING;\r\n        } else if (hasNextNotch) {\r\n          // Determine if the input row has non-shadow connected blocks.\r\n          let hasNonShadowConnectedBlocks = false;\r\n          const minVerticalTightNestingHeight = 40;\r\n          for (let j = 0; j < row.elements.length; j++) {\r\n            const elem = row.elements[j];\r\n            if (\r\n              elem instanceof InputConnection &&\r\n              Types.isInlineInput(elem) &&\r\n              elem.connectedBlock &&\r\n              !elem.connectedBlock.isShadow() &&\r\n              elem.connectedBlock.getHeightWidth().height >=\r\n                minVerticalTightNestingHeight\r\n            ) {\r\n              hasNonShadowConnectedBlocks = true;\r\n              break;\r\n            }\r\n          }\r\n          // Apply tight-nesting if we have both a prev and next notch and the\r\n          // block has non-shadow connected blocks.\r\n          if (hasNonShadowConnectedBlocks) {\r\n            prevSpacer.height -= this.constants_.SMALL_PADDING;\r\n            nextSpacer.height -= this.constants_.SMALL_PADDING;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  override finalize_() {\r\n    this.finalizeOutputConnection_();\r\n    this.finalizeHorizontalAlignment_();\r\n    this.finalizeVerticalAlignment_();\r\n    super.finalize_();\r\n\r\n    if (this.rightSide) {\r\n      this.widthWithChildren += this.rightSide.width;\r\n    }\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.zelos.MarkerSvg\r\n\r\nimport type {BlockSvg} from '../../block_svg.js';\r\nimport type {ASTNode} from '../../keyboard_nav/ast_node.js';\r\nimport type {Marker} from '../../keyboard_nav/marker.js';\r\nimport type {RenderedConnection} from '../../rendered_connection.js';\r\nimport * as dom from '../../utils/dom.js';\r\nimport {Svg} from '../../utils/svg.js';\r\nimport type {WorkspaceSvg} from '../../workspace_svg.js';\r\nimport type {ConstantProvider as BaseConstantProvider} from '../common/constants.js';\r\nimport {MarkerSvg as BaseMarkerSvg} from '../common/marker_svg.js';\r\n\r\nimport type {ConstantProvider as ZelosConstantProvider} from './constants.js';\r\n\r\n/**\r\n * Class to draw a marker.\r\n */\r\nexport class MarkerSvg extends BaseMarkerSvg {\r\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\r\n  constants_!: ZelosConstantProvider;\r\n\r\n  private markerCircle: SVGCircleElement | null = null;\r\n\r\n  /**\r\n   * @param workspace The workspace the marker belongs to.\r\n   * @param constants The constants for the renderer.\r\n   * @param marker The marker to draw.\r\n   */\r\n  constructor(\r\n    workspace: WorkspaceSvg,\r\n    constants: BaseConstantProvider,\r\n    marker: Marker,\r\n  ) {\r\n    super(workspace, constants, marker);\r\n  }\r\n\r\n  /**\r\n   * Position and display the marker for an input or an output connection.\r\n   *\r\n   * @param curNode The node to draw the marker for.\r\n   */\r\n  private showWithInputOutput(curNode: ASTNode) {\r\n    const block = curNode.getSourceBlock() as BlockSvg;\r\n    const connection = curNode.getLocation() as RenderedConnection;\r\n    const offsetInBlock = connection.getOffsetInBlock();\r\n\r\n    this.positionCircle(offsetInBlock.x, offsetInBlock.y);\r\n    this.setParent_(block);\r\n    this.showCurrent_();\r\n  }\r\n\r\n  override showWithOutput_(curNode: ASTNode) {\r\n    this.showWithInputOutput(curNode);\r\n  }\r\n\r\n  override showWithInput_(curNode: ASTNode) {\r\n    this.showWithInputOutput(curNode);\r\n  }\r\n\r\n  /**\r\n   * Draw a rectangle around the block.\r\n   *\r\n   * @param curNode The current node of the marker.\r\n   */\r\n  override showWithBlock_(curNode: ASTNode) {\r\n    const block = curNode.getLocation() as BlockSvg;\r\n\r\n    // Gets the height and width of entire stack.\r\n    const heightWidth = block.getHeightWidth();\r\n    // Add padding so that being on a stack looks different than being on a\r\n    // block.\r\n    this.positionRect_(0, 0, heightWidth.width, heightWidth.height);\r\n    this.setParent_(block);\r\n    this.showCurrent_();\r\n  }\r\n\r\n  /**\r\n   * Position the circle we use for input and output connections.\r\n   *\r\n   * @param x The x position of the circle.\r\n   * @param y The y position of the circle.\r\n   */\r\n  private positionCircle(x: number, y: number) {\r\n    this.markerCircle?.setAttribute('cx', `${x}`);\r\n    this.markerCircle?.setAttribute('cy', `${y}`);\r\n    this.currentMarkerSvg = this.markerCircle;\r\n  }\r\n\r\n  override hide() {\r\n    super.hide();\r\n    if (this.markerCircle) {\r\n      this.markerCircle.style.display = 'none';\r\n    }\r\n  }\r\n\r\n  override createDomInternal_() {\r\n    /* clang-format off */\r\n    /* This markup will be generated and added to the .svgGroup_:\r\n        <g>\r\n          <rect width=\"100\" height=\"5\">\r\n            <animate attributeType=\"XML\" attributeName=\"fill\" dur=\"1s\"\r\n              values=\"transparent;transparent;#fff;transparent\" repeatCount=\"indefinite\" />\r\n          </rect>\r\n        </g>\r\n        */\r\n    /* clang-format on */\r\n    super.createDomInternal_();\r\n\r\n    this.markerCircle = dom.createSvgElement(\r\n      Svg.CIRCLE,\r\n      {\r\n        'r': this.constants_.CURSOR_RADIUS,\r\n        'stroke-width': this.constants_.CURSOR_STROKE_WIDTH,\r\n      },\r\n      this.markerSvg_,\r\n    );\r\n    this.hide();\r\n\r\n    // Markers and stack cursors don't blink.\r\n    if (this.isCursor()) {\r\n      const blinkProperties = this.getBlinkProperties_();\r\n      dom.createSvgElement(Svg.ANIMATE, blinkProperties, this.markerCircle!);\r\n    }\r\n\r\n    return this.markerSvg_!;\r\n  }\r\n\r\n  override applyColour_(curNode: ASTNode) {\r\n    super.applyColour_(curNode);\r\n\r\n    this.markerCircle?.setAttribute('fill', this.colour_);\r\n    this.markerCircle?.setAttribute('stroke', this.colour_);\r\n\r\n    if (this.isCursor()) {\r\n      const values = this.colour_ + ';transparent;transparent;';\r\n      this.markerCircle?.firstElementChild!.setAttribute('values', values);\r\n    }\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.zelos.PathObject\r\n\r\nimport type {BlockSvg} from '../../block_svg.js';\r\nimport type {Connection} from '../../connection.js';\r\nimport type {BlockStyle} from '../../theme.js';\r\nimport * as dom from '../../utils/dom.js';\r\nimport {Svg} from '../../utils/svg.js';\r\nimport {PathObject as BasePathObject} from '../common/path_object.js';\r\n\r\nimport type {ConstantProvider} from './constants.js';\r\n\r\n/**\r\n * An object that handles creating and setting each of the SVG elements\r\n * used by the renderer.\r\n */\r\nexport class PathObject extends BasePathObject {\r\n  /** The selected path of the block. */\r\n  private svgPathSelected: SVGElement | null = null;\r\n\r\n  /** The outline paths on the block. */\r\n  private readonly outlines = new Map<string, SVGElement>();\r\n\r\n  /**\r\n   * A set used to determine which outlines were used during a draw pass.  The\r\n   * set is initialized with a reference to all the outlines in\r\n   * `this.outlines`. Every time we use an outline during the draw pass, the\r\n   * reference is removed from this set.\r\n   */\r\n  private remainingOutlines = new Set<string>();\r\n\r\n  /**\r\n   * The type of block's output connection shape.  This is set when a block\r\n   * with an output connection is drawn.\r\n   */\r\n  outputShapeType: number | null = null;\r\n\r\n  public override constants: ConstantProvider;\r\n\r\n  /**\r\n   * @param root The root SVG element.\r\n   * @param style The style object to use for colouring.\r\n   * @param constants The renderer's constants.\r\n   */\r\n  constructor(\r\n    root: SVGElement,\r\n    style: BlockStyle,\r\n    constants: ConstantProvider,\r\n  ) {\r\n    super(root, style, constants);\r\n\r\n    this.constants = constants;\r\n  }\r\n\r\n  override setPath(pathString: string) {\r\n    super.setPath(pathString);\r\n    if (this.svgPathSelected) {\r\n      this.svgPathSelected.setAttribute('d', pathString);\r\n    }\r\n  }\r\n\r\n  override applyColour(block: BlockSvg) {\r\n    super.applyColour(block);\r\n    // Set shadow stroke colour.\r\n    const parent = block.getParent();\r\n    if (block.isShadow() && parent) {\r\n      this.svgPath.setAttribute('stroke', parent.style.colourTertiary);\r\n    }\r\n\r\n    // Apply colour to outlines.\r\n    for (const outline of this.outlines.values()) {\r\n      outline.setAttribute('fill', this.style.colourTertiary);\r\n    }\r\n  }\r\n\r\n  override flipRTL() {\r\n    super.flipRTL();\r\n    // Mirror each input outline path.\r\n    for (const outline of this.outlines.values()) {\r\n      outline.setAttribute('transform', 'scale(-1 1)');\r\n    }\r\n  }\r\n\r\n  override updateSelected(enable: boolean) {\r\n    this.setClass_('blocklySelected', enable);\r\n    if (enable) {\r\n      if (!this.svgPathSelected) {\r\n        this.svgPathSelected = this.svgPath.cloneNode(true) as SVGElement;\r\n        this.svgPathSelected.setAttribute('fill', 'none');\r\n        this.svgPathSelected.setAttribute(\r\n          'filter',\r\n          'url(#' + this.constants.selectedGlowFilterId + ')',\r\n        );\r\n        this.svgRoot.appendChild(this.svgPathSelected);\r\n      }\r\n    } else {\r\n      if (this.svgPathSelected) {\r\n        this.svgRoot.removeChild(this.svgPathSelected);\r\n        this.svgPathSelected = null;\r\n      }\r\n    }\r\n  }\r\n\r\n  override updateReplacementFade(enable: boolean) {\r\n    this.setClass_('blocklyReplaceable', enable);\r\n    if (enable) {\r\n      this.svgPath.setAttribute(\r\n        'filter',\r\n        'url(#' + this.constants.replacementGlowFilterId + ')',\r\n      );\r\n    } else {\r\n      this.svgPath.removeAttribute('filter');\r\n    }\r\n  }\r\n\r\n  override updateShapeForInputHighlight(conn: Connection, enable: boolean) {\r\n    const name = conn.getParentInput()!.name;\r\n    const outlinePath = this.getOutlinePath(name);\r\n    if (!outlinePath) {\r\n      return;\r\n    }\r\n    if (enable) {\r\n      outlinePath.setAttribute(\r\n        'filter',\r\n        'url(#' + this.constants.replacementGlowFilterId + ')',\r\n      );\r\n    } else {\r\n      outlinePath.removeAttribute('filter');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Method that's called when the drawer is about to draw the block.\r\n   */\r\n  beginDrawing() {\r\n    this.remainingOutlines.clear();\r\n    for (const key of this.outlines.keys()) {\r\n      this.remainingOutlines.add(key);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Method that's called when the drawer is done drawing.\r\n   */\r\n  endDrawing() {\r\n    // Go through all remaining outlines that were not used this draw pass, and\r\n    // remove them.\r\n    if (this.remainingOutlines.size) {\r\n      for (const key of this.remainingOutlines) {\r\n        this.removeOutlinePath(key);\r\n      }\r\n    }\r\n    this.remainingOutlines.clear();\r\n  }\r\n\r\n  /**\r\n   * Set the path generated by the renderer for an outline path on the\r\n   * respective outline path SVG element.\r\n   *\r\n   * @param name The input name.\r\n   * @param pathString The path.\r\n   */\r\n  setOutlinePath(name: string, pathString: string) {\r\n    const outline = this.getOutlinePath(name);\r\n    outline.setAttribute('d', pathString);\r\n    outline.setAttribute('fill', this.style.colourTertiary);\r\n  }\r\n\r\n  /**\r\n   * Create's an outline path for the specified input.\r\n   *\r\n   * @param name The input name.\r\n   * @returns The SVG outline path.\r\n   */\r\n  private getOutlinePath(name: string): SVGElement {\r\n    if (!this.outlines.has(name)) {\r\n      this.outlines.set(\r\n        name,\r\n        dom.createSvgElement(\r\n          Svg.PATH,\r\n          {\r\n            'class': 'blocklyOutlinePath', // IE doesn't like paths without the\r\n            // data definition, set empty\r\n            // default\r\n            'd': '',\r\n          },\r\n          this.svgRoot,\r\n        ),\r\n      );\r\n    }\r\n    this.remainingOutlines.delete(name);\r\n    return this.outlines.get(name)!;\r\n  }\r\n\r\n  /**\r\n   * Remove an outline path that is associated with the specified input.\r\n   *\r\n   * @param name The input name.\r\n   */\r\n  private removeOutlinePath(name: string) {\r\n    this.outlines.get(name)?.parentNode?.removeChild(this.outlines.get(name)!);\r\n    this.outlines.delete(name);\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.zelos.Renderer\r\n\r\nimport type {BlockSvg} from '../../block_svg.js';\r\nimport {ConnectionType} from '../../connection_type.js';\r\nimport {InsertionMarkerManager} from '../../insertion_marker_manager.js';\r\nimport type {Marker} from '../../keyboard_nav/marker.js';\r\nimport type {RenderedConnection} from '../../rendered_connection.js';\r\nimport type {BlockStyle} from '../../theme.js';\r\nimport type {WorkspaceSvg} from '../../workspace_svg.js';\r\nimport * as blockRendering from '../common/block_rendering.js';\r\nimport type {RenderInfo as BaseRenderInfo} from '../common/info.js';\r\nimport {Renderer as BaseRenderer} from '../common/renderer.js';\r\n\r\nimport {ConstantProvider} from './constants.js';\r\nimport {Drawer} from './drawer.js';\r\nimport {RenderInfo} from './info.js';\r\nimport {MarkerSvg} from './marker_svg.js';\r\nimport {PathObject} from './path_object.js';\r\nimport * as deprecation from '../../utils/deprecation.js';\r\n\r\n/**\r\n * The zelos renderer. This renderer emulates Scratch-style and MakeCode-style\r\n * rendering.\r\n *\r\n * Zelos is the ancient Greek spirit of rivalry and emulation.\r\n */\r\nexport class Renderer extends BaseRenderer {\r\n  protected override constants_!: ConstantProvider;\r\n\r\n  /**\r\n   * @param name The renderer name.\r\n   */\r\n  constructor(name: string) {\r\n    super(name);\r\n  }\r\n\r\n  /**\r\n   * Create a new instance of the renderer's constant provider.\r\n   *\r\n   * @returns The constant provider.\r\n   */\r\n  protected override makeConstants_(): ConstantProvider {\r\n    return new ConstantProvider();\r\n  }\r\n\r\n  /**\r\n   * Create a new instance of the renderer's render info object.\r\n   *\r\n   * @param block The block to measure.\r\n   * @returns The render info object.\r\n   */\r\n  protected override makeRenderInfo_(block: BlockSvg): RenderInfo {\r\n    return new RenderInfo(this, block);\r\n  }\r\n\r\n  /**\r\n   * Create a new instance of the renderer's drawer.\r\n   *\r\n   * @param block The block to render.\r\n   * @param info An object containing all information needed to render this\r\n   *     block.\r\n   * @returns The drawer.\r\n   */\r\n  protected override makeDrawer_(\r\n    block: BlockSvg,\r\n    info: BaseRenderInfo,\r\n  ): Drawer {\r\n    return new Drawer(block, info as RenderInfo);\r\n  }\r\n\r\n  /**\r\n   * Create a new instance of the renderer's cursor drawer.\r\n   *\r\n   * @param workspace The workspace the cursor belongs to.\r\n   * @param marker The marker.\r\n   * @returns The object in charge of drawing the marker.\r\n   */\r\n  override makeMarkerDrawer(\r\n    workspace: WorkspaceSvg,\r\n    marker: Marker,\r\n  ): MarkerSvg {\r\n    return new MarkerSvg(workspace, this.getConstants(), marker);\r\n  }\r\n\r\n  /**\r\n   * Create a new instance of a renderer path object.\r\n   *\r\n   * @param root The root SVG element.\r\n   * @param style The style object to use for colouring.\r\n   * @returns The renderer path object.\r\n   */\r\n  override makePathObject(root: SVGElement, style: BlockStyle): PathObject {\r\n    return new PathObject(root, style, this.getConstants() as ConstantProvider);\r\n  }\r\n\r\n  /**\r\n   * Get the current renderer's constant provider.  We assume that when this is\r\n   * called, the renderer has already been initialized.\r\n   *\r\n   * @returns The constant provider.\r\n   */\r\n  override getConstants(): ConstantProvider {\r\n    return this.constants_;\r\n  }\r\n\r\n  /**\r\n   * @deprecated v10 - This function is no longer respected. A custom\r\n   *    IConnectionPreviewer may be able to fulfill the functionality.\r\n   */\r\n  override getConnectionPreviewMethod(\r\n    closest: RenderedConnection,\r\n    local: RenderedConnection,\r\n    topBlock: BlockSvg,\r\n  ) {\r\n    deprecation.warn(\r\n      'getConnectionPreviewMethod',\r\n      'v10',\r\n      'v12',\r\n      'an IConnectionPreviewer, if it fulfills your use case.',\r\n    );\r\n    if (local.type === ConnectionType.OUTPUT_VALUE) {\r\n      if (!closest.isConnected()) {\r\n        return InsertionMarkerManager.PREVIEW_TYPE.INPUT_OUTLINE;\r\n      }\r\n      // TODO: Returning this is a total hack, because we don't want to show\r\n      //   a replacement fade, we want to show an outline affect.\r\n      //   Sadly zelos does not support showing an outline around filled\r\n      //   inputs, so we have to pretend like the connected block is getting\r\n      //   replaced.\r\n      return InsertionMarkerManager.PREVIEW_TYPE.REPLACEMENT_FADE;\r\n    }\r\n\r\n    return super.getConnectionPreviewMethod(closest, local, topBlock);\r\n  }\r\n}\r\n\r\nblockRendering.register('zelos', Renderer);\r\n","/** @file Re-exports of Blockly.zelos.* modules. */\r\n\r\n/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.zelos\r\n\r\nimport {ConstantProvider} from './constants.js';\r\nimport {Drawer} from './drawer.js';\r\nimport {RenderInfo} from './info.js';\r\nimport {MarkerSvg} from './marker_svg.js';\r\nimport {BottomRow} from './measurables/bottom_row.js';\r\nimport {StatementInput} from './measurables/inputs.js';\r\nimport {RightConnectionShape} from './measurables/row_elements.js';\r\nimport {TopRow} from './measurables/top_row.js';\r\nimport {PathObject} from './path_object.js';\r\nimport {Renderer} from './renderer.js';\r\n\r\nexport {\r\n  BottomRow,\r\n  ConstantProvider,\r\n  Drawer,\r\n  MarkerSvg,\r\n  PathObject,\r\n  Renderer,\r\n  RenderInfo,\r\n  RightConnectionShape,\r\n  StatementInput,\r\n  TopRow,\r\n};\r\n","/**\r\n * @license\r\n * Copyright 2013 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Angle input field.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.FieldAngle\r\n\r\nimport {BlockSvg} from './block_svg.js';\r\nimport * as browserEvents from './browser_events.js';\r\nimport * as Css from './css.js';\r\nimport * as dropDownDiv from './dropdowndiv.js';\r\nimport * as eventUtils from './events/utils.js';\r\nimport {Field, UnattachedFieldError} from './field.js';\r\nimport * as fieldRegistry from './field_registry.js';\r\nimport {\r\n  FieldInput,\r\n  FieldInputConfig,\r\n  FieldInputValidator,\r\n} from './field_input.js';\r\nimport * as dom from './utils/dom.js';\r\nimport * as math from './utils/math.js';\r\nimport {Svg} from './utils/svg.js';\r\nimport * as userAgent from './utils/useragent.js';\r\nimport * as WidgetDiv from './widgetdiv.js';\r\n\r\n/**\r\n * Class for an editable angle field.\r\n */\r\nexport class FieldAngle extends FieldInput<number> {\r\n  /** Half the width of protractor image. */\r\n  static readonly HALF = 100 / 2;\r\n\r\n  /**\r\n   * Radius of protractor circle.  Slightly smaller than protractor size since\r\n   * otherwise SVG crops off half the border at the edges.\r\n   */\r\n  static readonly RADIUS: number = FieldAngle.HALF - 1;\r\n\r\n  /**\r\n   * Default property describing which direction makes an angle field's value\r\n   * increase. Angle increases clockwise (true) or counterclockwise (false).\r\n   */\r\n  static readonly CLOCKWISE = false;\r\n\r\n  /**\r\n   * The default offset of 0 degrees (and all angles). Always offsets in the\r\n   * counterclockwise direction, regardless of the field's clockwise property.\r\n   * Usually either 0 (0 = right) or 90 (0 = up).\r\n   */\r\n  static readonly OFFSET = 0;\r\n\r\n  /**\r\n   * The default maximum angle to allow before wrapping.\r\n   * Usually either 360 (for 0 to 359.9) or 180 (for -179.9 to 180).\r\n   */\r\n  static readonly WRAP = 360;\r\n\r\n  /**\r\n   * The default amount to round angles to when using a mouse or keyboard nav\r\n   * input. Must be a positive integer to support keyboard navigation.\r\n   */\r\n  static readonly ROUND = 15;\r\n\r\n  /**\r\n   * Whether the angle should increase as the angle picker is moved clockwise\r\n   * (true) or counterclockwise (false).\r\n   */\r\n  private clockwise = FieldAngle.CLOCKWISE;\r\n\r\n  /**\r\n   * The offset of zero degrees (and all other angles).\r\n   */\r\n  private offset = FieldAngle.OFFSET;\r\n\r\n  /**\r\n   * The maximum angle to allow before wrapping.\r\n   */\r\n  private wrap = FieldAngle.WRAP;\r\n\r\n  /**\r\n   * The amount to round angles to when using a mouse or keyboard nav input.\r\n   */\r\n  private round = FieldAngle.ROUND;\r\n\r\n  /**\r\n   * Array holding info needed to unbind events.\r\n   * Used for disposing.\r\n   * Ex: [[node, name, func], [node, name, func]].\r\n   */\r\n  private boundEvents: browserEvents.Data[] = [];\r\n\r\n  /** Dynamic red line pointing at the value's angle. */\r\n  private line: SVGLineElement | null = null;\r\n\r\n  /** Dynamic pink area extending from 0 to the value's angle. */\r\n  private gauge: SVGPathElement | null = null;\r\n\r\n  /** The degree symbol for this field. */\r\n  protected symbol_: SVGTSpanElement | null = null;\r\n\r\n  /**\r\n   * @param value The initial value of the field. Should cast to a number.\r\n   *     Defaults to 0. Also accepts Field.SKIP_SETUP if you wish to skip setup\r\n   *     (only used by subclasses that want to handle configuration and setting\r\n   *     the field value after their own constructors have run).\r\n   * @param validator A function that is called to validate changes to the\r\n   *     field's value. Takes in a number & returns a validated number, or null\r\n   *     to abort the change.\r\n   * @param config A map of options used to configure the field.\r\n   *     See the [field creation documentation]{@link\r\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/angle#creation}\r\n   * for a list of properties this parameter supports.\r\n   */\r\n  constructor(\r\n    value?: string | number | typeof Field.SKIP_SETUP,\r\n    validator?: FieldAngleValidator,\r\n    config?: FieldAngleConfig,\r\n  ) {\r\n    super(Field.SKIP_SETUP);\r\n\r\n    if (value === Field.SKIP_SETUP) return;\r\n    if (config) {\r\n      this.configure_(config);\r\n    }\r\n    this.setValue(value);\r\n    if (validator) {\r\n      this.setValidator(validator);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Configure the field based on the given map of options.\r\n   *\r\n   * @param config A map of options to configure the field based on.\r\n   */\r\n  protected override configure_(config: FieldAngleConfig) {\r\n    super.configure_(config);\r\n\r\n    switch (config.mode) {\r\n      case Mode.COMPASS:\r\n        this.clockwise = true;\r\n        this.offset = 90;\r\n        break;\r\n      case Mode.PROTRACTOR:\r\n        // This is the default mode, so we could do nothing. But just to\r\n        // future-proof, we'll set it anyway.\r\n        this.clockwise = false;\r\n        this.offset = 0;\r\n        break;\r\n    }\r\n\r\n    // Allow individual settings to override the mode setting.\r\n    if (config.clockwise) this.clockwise = config.clockwise;\r\n    if (config.offset) this.offset = config.offset;\r\n    if (config.wrap) this.wrap = config.wrap;\r\n    if (config.round) this.round = config.round;\r\n  }\r\n\r\n  /**\r\n   * Create the block UI for this field.\r\n   */\r\n  override initView() {\r\n    super.initView();\r\n    // Add the degree symbol to the left of the number,\r\n    // even in RTL (issue #2380).\r\n    this.symbol_ = dom.createSvgElement(Svg.TSPAN, {});\r\n    this.symbol_.appendChild(document.createTextNode(''));\r\n    this.getTextElement().appendChild(this.symbol_);\r\n  }\r\n\r\n  /** Updates the angle when the field rerenders. */\r\n  protected override render_() {\r\n    super.render_();\r\n    this.updateGraph();\r\n  }\r\n\r\n  /**\r\n   * Create and show the angle field's editor.\r\n   *\r\n   * @param e Optional mouse event that triggered the field to open,\r\n   *     or undefined if triggered programmatically.\r\n   */\r\n  protected override showEditor_(e?: Event) {\r\n    // Mobile browsers have issues with in-line textareas (focus & keyboards).\r\n    const noFocus = userAgent.MOBILE || userAgent.ANDROID || userAgent.IPAD;\r\n    super.showEditor_(e, noFocus);\r\n\r\n    const editor = this.dropdownCreate();\r\n    dropDownDiv.getContentDiv().appendChild(editor);\r\n\r\n    if (this.sourceBlock_ instanceof BlockSvg) {\r\n      dropDownDiv.setColour(\r\n        this.sourceBlock_.style.colourPrimary,\r\n        this.sourceBlock_.style.colourTertiary,\r\n      );\r\n    }\r\n\r\n    dropDownDiv.showPositionedByField(this, this.dropdownDispose.bind(this));\r\n\r\n    this.updateGraph();\r\n  }\r\n\r\n  /**\r\n   * Creates the angle dropdown editor.\r\n   *\r\n   * @returns The newly created slider.\r\n   */\r\n  private dropdownCreate(): SVGSVGElement {\r\n    const svg = dom.createSvgElement(Svg.SVG, {\r\n      'xmlns': dom.SVG_NS,\r\n      'xmlns:html': dom.HTML_NS,\r\n      'xmlns:xlink': dom.XLINK_NS,\r\n      'version': '1.1',\r\n      'height': FieldAngle.HALF * 2 + 'px',\r\n      'width': FieldAngle.HALF * 2 + 'px',\r\n    });\r\n    svg.style.touchAction = 'none';\r\n    const circle = dom.createSvgElement(\r\n      Svg.CIRCLE,\r\n      {\r\n        'cx': FieldAngle.HALF,\r\n        'cy': FieldAngle.HALF,\r\n        'r': FieldAngle.RADIUS,\r\n        'class': 'blocklyAngleCircle',\r\n      },\r\n      svg,\r\n    );\r\n    this.gauge = dom.createSvgElement(\r\n      Svg.PATH,\r\n      {'class': 'blocklyAngleGauge'},\r\n      svg,\r\n    );\r\n    this.line = dom.createSvgElement(\r\n      Svg.LINE,\r\n      {\r\n        'x1': FieldAngle.HALF,\r\n        'y1': FieldAngle.HALF,\r\n        'class': 'blocklyAngleLine',\r\n      },\r\n      svg,\r\n    );\r\n    // Draw markers around the edge.\r\n    for (let angle = 0; angle < 360; angle += 15) {\r\n      dom.createSvgElement(\r\n        Svg.LINE,\r\n        {\r\n          'x1': FieldAngle.HALF + FieldAngle.RADIUS,\r\n          'y1': FieldAngle.HALF,\r\n          'x2':\r\n            FieldAngle.HALF + FieldAngle.RADIUS - (angle % 45 === 0 ? 10 : 5),\r\n          'y2': FieldAngle.HALF,\r\n          'class': 'blocklyAngleMarks',\r\n          'transform':\r\n            'rotate(' +\r\n            angle +\r\n            ',' +\r\n            FieldAngle.HALF +\r\n            ',' +\r\n            FieldAngle.HALF +\r\n            ')',\r\n        },\r\n        svg,\r\n      );\r\n    }\r\n\r\n    // The angle picker is different from other fields in that it updates on\r\n    // mousemove even if it's not in the middle of a drag.  In future we may\r\n    // change this behaviour.\r\n    this.boundEvents.push(\r\n      browserEvents.conditionalBind(svg, 'click', this, this.hide),\r\n    );\r\n    // On touch devices, the picker's value is only updated with a drag. Add\r\n    // a click handler on the drag surface to update the value if the surface\r\n    // is clicked.\r\n    this.boundEvents.push(\r\n      browserEvents.conditionalBind(\r\n        circle,\r\n        'pointerdown',\r\n        this,\r\n        this.onMouseMove_,\r\n        true,\r\n      ),\r\n    );\r\n    this.boundEvents.push(\r\n      browserEvents.conditionalBind(\r\n        circle,\r\n        'pointermove',\r\n        this,\r\n        this.onMouseMove_,\r\n        true,\r\n      ),\r\n    );\r\n    return svg;\r\n  }\r\n\r\n  /** Disposes of events and DOM-references belonging to the angle editor. */\r\n  private dropdownDispose() {\r\n    for (const event of this.boundEvents) {\r\n      browserEvents.unbind(event);\r\n    }\r\n    this.boundEvents.length = 0;\r\n    this.gauge = null;\r\n    this.line = null;\r\n  }\r\n\r\n  /** Hide the editor. */\r\n  private hide() {\r\n    dropDownDiv.hideIfOwner(this);\r\n    WidgetDiv.hide();\r\n  }\r\n\r\n  /**\r\n   * Set the angle to match the mouse's position.\r\n   *\r\n   * @param e Mouse move event.\r\n   */\r\n  protected onMouseMove_(e: PointerEvent) {\r\n    // Calculate angle.\r\n    const bBox = this.gauge!.ownerSVGElement!.getBoundingClientRect();\r\n    const dx = e.clientX - bBox.left - FieldAngle.HALF;\r\n    const dy = e.clientY - bBox.top - FieldAngle.HALF;\r\n    let angle = Math.atan(-dy / dx);\r\n    if (isNaN(angle)) {\r\n      // This shouldn't happen, but let's not let this error propagate further.\r\n      return;\r\n    }\r\n    angle = math.toDegrees(angle);\r\n    // 0: East, 90: North, 180: West, 270: South.\r\n    if (dx < 0) {\r\n      angle += 180;\r\n    } else if (dy > 0) {\r\n      angle += 360;\r\n    }\r\n\r\n    // Do offsetting.\r\n    if (this.clockwise) {\r\n      angle = this.offset + 360 - angle;\r\n    } else {\r\n      angle = 360 - (this.offset - angle);\r\n    }\r\n\r\n    this.displayMouseOrKeyboardValue(angle);\r\n  }\r\n\r\n  /**\r\n   * Handles and displays values that are input via mouse or arrow key input.\r\n   * These values need to be rounded and wrapped before being displayed so\r\n   * that the text input's value is appropriate.\r\n   *\r\n   * @param angle New angle.\r\n   */\r\n  private displayMouseOrKeyboardValue(angle: number) {\r\n    if (this.round) {\r\n      angle = Math.round(angle / this.round) * this.round;\r\n    }\r\n    angle = this.wrapValue(angle);\r\n    if (angle !== this.value_) {\r\n      // Intermediate value changes from user input are not confirmed until the\r\n      // user closes the editor, and may be numerous. Inhibit reporting these as\r\n      // normal block change events, and instead report them as special\r\n      // intermediate changes that do not get recorded in undo history.\r\n      const oldValue = this.value_;\r\n      this.setEditorValue_(angle, false);\r\n      if (\r\n        this.sourceBlock_ &&\r\n        eventUtils.isEnabled() &&\r\n        this.value_ !== oldValue\r\n      ) {\r\n        eventUtils.fire(\r\n          new (eventUtils.get(eventUtils.BLOCK_FIELD_INTERMEDIATE_CHANGE))(\r\n            this.sourceBlock_,\r\n            this.name || null,\r\n            oldValue,\r\n            this.value_,\r\n          ),\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  /** Redraw the graph with the current angle. */\r\n  private updateGraph() {\r\n    if (!this.gauge || !this.line) {\r\n      return;\r\n    }\r\n    // Always display the input (i.e. getText) even if it is invalid.\r\n    let angleDegrees = Number(this.getText()) + this.offset;\r\n    angleDegrees %= 360;\r\n    let angleRadians = math.toRadians(angleDegrees);\r\n    const path = ['M ', FieldAngle.HALF, ',', FieldAngle.HALF];\r\n    let x2 = FieldAngle.HALF;\r\n    let y2 = FieldAngle.HALF;\r\n    if (!isNaN(angleRadians)) {\r\n      const clockwiseFlag = Number(this.clockwise);\r\n      const angle1 = math.toRadians(this.offset);\r\n      const x1 = Math.cos(angle1) * FieldAngle.RADIUS;\r\n      const y1 = Math.sin(angle1) * -FieldAngle.RADIUS;\r\n      if (clockwiseFlag) {\r\n        angleRadians = 2 * angle1 - angleRadians;\r\n      }\r\n      x2 += Math.cos(angleRadians) * FieldAngle.RADIUS;\r\n      y2 -= Math.sin(angleRadians) * FieldAngle.RADIUS;\r\n      // Don't ask how the flag calculations work.  They just do.\r\n      let largeFlag = Math.abs(\r\n        Math.floor((angleRadians - angle1) / Math.PI) % 2,\r\n      );\r\n      if (clockwiseFlag) {\r\n        largeFlag = 1 - largeFlag;\r\n      }\r\n      path.push(\r\n        ' l ',\r\n        x1,\r\n        ',',\r\n        y1,\r\n        ' A ',\r\n        FieldAngle.RADIUS,\r\n        ',',\r\n        FieldAngle.RADIUS,\r\n        ' 0 ',\r\n        largeFlag,\r\n        ' ',\r\n        clockwiseFlag,\r\n        ' ',\r\n        x2,\r\n        ',',\r\n        y2,\r\n        ' z',\r\n      );\r\n    }\r\n    this.gauge.setAttribute('d', path.join(''));\r\n    this.line.setAttribute('x2', `${x2}`);\r\n    this.line.setAttribute('y2', `${y2}`);\r\n  }\r\n\r\n  /**\r\n   * Handle key down to the editor.\r\n   *\r\n   * @param e Keyboard event.\r\n   */\r\n  protected override onHtmlInputKeyDown_(e: KeyboardEvent) {\r\n    super.onHtmlInputKeyDown_(e);\r\n    const block = this.getSourceBlock();\r\n    if (!block) {\r\n      throw new UnattachedFieldError();\r\n    }\r\n\r\n    let multiplier = 0;\r\n    switch (e.key) {\r\n      case 'ArrowLeft':\r\n        // decrement (increment in RTL)\r\n        multiplier = block.RTL ? 1 : -1;\r\n        break;\r\n      case 'ArrowRight':\r\n        // increment (decrement in RTL)\r\n        multiplier = block.RTL ? -1 : 1;\r\n        break;\r\n      case 'ArrowDown':\r\n        // decrement\r\n        multiplier = -1;\r\n        break;\r\n      case 'ArrowUp':\r\n        // increment\r\n        multiplier = 1;\r\n        break;\r\n    }\r\n    if (multiplier) {\r\n      const value = this.getValue() as number;\r\n      this.displayMouseOrKeyboardValue(value + multiplier * this.round);\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Ensure that the input value is a valid angle.\r\n   *\r\n   * @param newValue The input value.\r\n   * @returns A valid angle, or null if invalid.\r\n   */\r\n  protected override doClassValidation_(newValue?: any): number | null {\r\n    const value = Number(newValue);\r\n    if (isNaN(value) || !isFinite(value)) {\r\n      return null;\r\n    }\r\n    return this.wrapValue(value);\r\n  }\r\n\r\n  /**\r\n   * Wraps the value so that it is in the range (-360 + wrap, wrap).\r\n   *\r\n   * @param value The value to wrap.\r\n   * @returns The wrapped value.\r\n   */\r\n  private wrapValue(value: number): number {\r\n    value %= 360;\r\n    if (value < 0) {\r\n      value += 360;\r\n    }\r\n    if (value > this.wrap) {\r\n      value -= 360;\r\n    }\r\n    return value;\r\n  }\r\n\r\n  /**\r\n   * Construct a FieldAngle from a JSON arg object.\r\n   *\r\n   * @param options A JSON object with options (angle).\r\n   * @returns The new field instance.\r\n   * @nocollapse\r\n   * @internal\r\n   */\r\n  static fromJson(options: FieldAngleFromJsonConfig): FieldAngle {\r\n    // `this` might be a subclass of FieldAngle if that class doesn't override\r\n    // the static fromJson method.\r\n    return new this(options.angle, undefined, options);\r\n  }\r\n}\r\n\r\nfieldRegistry.register('field_angle', FieldAngle);\r\n\r\nFieldAngle.prototype.DEFAULT_VALUE = 0;\r\n\r\n/**\r\n * CSS for angle field.\r\n */\r\nCss.register(`\r\n.blocklyAngleCircle {\r\n  stroke: #444;\r\n  stroke-width: 1;\r\n  fill: #ddd;\r\n  fill-opacity: 0.8;\r\n}\r\n\r\n.blocklyAngleMarks {\r\n  stroke: #444;\r\n  stroke-width: 1;\r\n}\r\n\r\n.blocklyAngleGauge {\r\n  fill: #f88;\r\n  fill-opacity: 0.8;\r\n  pointer-events: none;\r\n}\r\n\r\n.blocklyAngleLine {\r\n  stroke: #f00;\r\n  stroke-width: 2;\r\n  stroke-linecap: round;\r\n  pointer-events: none;\r\n}\r\n`);\r\n\r\n/**\r\n * The two main modes of the angle field.\r\n * Compass specifies:\r\n *   - clockwise: true\r\n *   - offset: 90\r\n *   - wrap: 0\r\n *   - round: 15\r\n *\r\n * Protractor specifies:\r\n *   - clockwise: false\r\n *   - offset: 0\r\n *   - wrap: 0\r\n *   - round: 15\r\n */\r\nexport enum Mode {\r\n  COMPASS = 'compass',\r\n  PROTRACTOR = 'protractor',\r\n}\r\n\r\n/**\r\n * Extra configuration options for the angle field.\r\n */\r\nexport interface FieldAngleConfig extends FieldInputConfig {\r\n  mode?: Mode;\r\n  clockwise?: boolean;\r\n  offset?: number;\r\n  wrap?: number;\r\n  round?: number;\r\n}\r\n\r\n/**\r\n * fromJson configuration options for the angle field.\r\n */\r\nexport interface FieldAngleFromJsonConfig extends FieldAngleConfig {\r\n  angle?: number;\r\n}\r\n\r\n/**\r\n * A function that is called to validate changes to the field's value before\r\n * they are set.\r\n *\r\n * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/fields/validators#return_values}\r\n * @param newValue The value to be validated.\r\n * @returns One of three instructions for setting the new value: `T`, `null`,\r\n * or `undefined`.\r\n *\r\n * - `T` to set this function's returned value instead of `newValue`.\r\n *\r\n * - `null` to invoke `doValueInvalid_` and not set a value.\r\n *\r\n * - `undefined` to set `newValue` as is.\r\n */\r\nexport type FieldAngleValidator = FieldInputValidator<number>;\r\n","/**\r\n * @license\r\n * Copyright 2012 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Checkbox field.  Checked or not checked.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.FieldCheckbox\r\n\r\n// Unused import preserved for side-effects. Remove if unneeded.\r\nimport './events/events_block_change.js';\r\n\r\nimport * as dom from './utils/dom.js';\r\nimport {Field, FieldConfig, FieldValidator} from './field.js';\r\nimport * as fieldRegistry from './field_registry.js';\r\n\r\ntype BoolString = 'TRUE' | 'FALSE';\r\ntype CheckboxBool = BoolString | boolean;\r\n\r\n/**\r\n * Class for a checkbox field.\r\n */\r\nexport class FieldCheckbox extends Field<CheckboxBool> {\r\n  /** Default character for the checkmark. */\r\n  static readonly CHECK_CHAR = '';\r\n  private checkChar: string;\r\n\r\n  /**\r\n   * Serializable fields are saved by the serializer, non-serializable fields\r\n   * are not. Editable fields should also be serializable.\r\n   */\r\n  override SERIALIZABLE = true;\r\n\r\n  /**\r\n   * Mouse cursor style when over the hotspot that initiates editability.\r\n   */\r\n  override CURSOR = 'default';\r\n\r\n  /**\r\n   * NOTE: The default value is set in `Field`, so maintain that value instead\r\n   * of overwriting it here or in the constructor.\r\n   */\r\n  override value_: boolean | null = this.value_;\r\n\r\n  /**\r\n   * @param value The initial value of the field. Should either be 'TRUE',\r\n   *     'FALSE' or a boolean. Defaults to 'FALSE'. Also accepts\r\n   *     Field.SKIP_SETUP if you wish to skip setup (only used by subclasses\r\n   *     that want to handle configuration and setting the field value after\r\n   *     their own constructors have run).\r\n   * @param validator  A function that is called to validate changes to the\r\n   *     field's value. Takes in a value ('TRUE' or 'FALSE') & returns a\r\n   *     validated value ('TRUE' or 'FALSE'), or null to abort the change.\r\n   * @param config A map of options used to configure the field.\r\n   *     See the [field creation documentation]{@link\r\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/checkbox#creation}\r\n   * for a list of properties this parameter supports.\r\n   */\r\n  constructor(\r\n    value?: CheckboxBool | typeof Field.SKIP_SETUP,\r\n    validator?: FieldCheckboxValidator,\r\n    config?: FieldCheckboxConfig,\r\n  ) {\r\n    super(Field.SKIP_SETUP);\r\n\r\n    /**\r\n     * Character for the check mark. Used to apply a different check mark\r\n     * character to individual fields.\r\n     */\r\n    this.checkChar = FieldCheckbox.CHECK_CHAR;\r\n\r\n    if (value === Field.SKIP_SETUP) return;\r\n    if (config) {\r\n      this.configure_(config);\r\n    }\r\n    this.setValue(value);\r\n    if (validator) {\r\n      this.setValidator(validator);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Configure the field based on the given map of options.\r\n   *\r\n   * @param config A map of options to configure the field based on.\r\n   */\r\n  protected override configure_(config: FieldCheckboxConfig) {\r\n    super.configure_(config);\r\n    if (config.checkCharacter) this.checkChar = config.checkCharacter;\r\n  }\r\n\r\n  /**\r\n   * Saves this field's value.\r\n   *\r\n   * @returns The boolean value held by this field.\r\n   * @internal\r\n   */\r\n  override saveState(): AnyDuringMigration {\r\n    const legacyState = this.saveLegacyState(FieldCheckbox);\r\n    if (legacyState !== null) {\r\n      return legacyState;\r\n    }\r\n    return this.getValueBoolean();\r\n  }\r\n\r\n  /**\r\n   * Create the block UI for this checkbox.\r\n   */\r\n  override initView() {\r\n    super.initView();\r\n\r\n    const textElement = this.getTextElement();\r\n    dom.addClass(textElement, 'blocklyCheckbox');\r\n    textElement.style.display = this.value_ ? 'block' : 'none';\r\n  }\r\n\r\n  override render_() {\r\n    if (this.textContent_) {\r\n      this.textContent_.nodeValue = this.getDisplayText_();\r\n    }\r\n    this.updateSize_(this.getConstants()!.FIELD_CHECKBOX_X_OFFSET);\r\n  }\r\n\r\n  override getDisplayText_() {\r\n    return this.checkChar;\r\n  }\r\n\r\n  /**\r\n   * Set the character used for the check mark.\r\n   *\r\n   * @param character The character to use for the check mark, or null to use\r\n   *     the default.\r\n   */\r\n  setCheckCharacter(character: string | null) {\r\n    this.checkChar = character || FieldCheckbox.CHECK_CHAR;\r\n    this.forceRerender();\r\n  }\r\n\r\n  /** Toggle the state of the checkbox on click. */\r\n  protected override showEditor_() {\r\n    this.setValue(!this.value_);\r\n  }\r\n\r\n  /**\r\n   * Ensure that the input value is valid ('TRUE' or 'FALSE').\r\n   *\r\n   * @param newValue The input value.\r\n   * @returns A valid value ('TRUE' or 'FALSE), or null if invalid.\r\n   */\r\n  protected override doClassValidation_(\r\n    newValue?: AnyDuringMigration,\r\n  ): BoolString | null {\r\n    if (newValue === true || newValue === 'TRUE') {\r\n      return 'TRUE';\r\n    }\r\n    if (newValue === false || newValue === 'FALSE') {\r\n      return 'FALSE';\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Update the value of the field, and update the checkElement.\r\n   *\r\n   * @param newValue The value to be saved. The default validator guarantees\r\n   *     that this is a either 'TRUE' or 'FALSE'.\r\n   */\r\n  protected override doValueUpdate_(newValue: BoolString) {\r\n    this.value_ = this.convertValueToBool_(newValue);\r\n    // Update visual.\r\n    if (this.textElement_) {\r\n      this.textElement_.style.display = this.value_ ? 'block' : 'none';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the value of this field, either 'TRUE' or 'FALSE'.\r\n   *\r\n   * @returns The value of this field.\r\n   */\r\n  override getValue(): BoolString {\r\n    return this.value_ ? 'TRUE' : 'FALSE';\r\n  }\r\n\r\n  /**\r\n   * Get the boolean value of this field.\r\n   *\r\n   * @returns The boolean value of this field.\r\n   */\r\n  getValueBoolean(): boolean | null {\r\n    return this.value_;\r\n  }\r\n\r\n  /**\r\n   * Get the text of this field. Used when the block is collapsed.\r\n   *\r\n   * @returns Text representing the value of this field ('true' or 'false').\r\n   */\r\n  override getText(): string {\r\n    return String(this.convertValueToBool_(this.value_));\r\n  }\r\n\r\n  /**\r\n   * Convert a value into a pure boolean.\r\n   *\r\n   * Converts 'TRUE' to true and 'FALSE' to false correctly, everything else\r\n   * is cast to a boolean.\r\n   *\r\n   * @param value The value to convert.\r\n   * @returns The converted value.\r\n   */\r\n  private convertValueToBool_(value: CheckboxBool | null): boolean {\r\n    if (typeof value === 'string') return value === 'TRUE';\r\n    return !!value;\r\n  }\r\n\r\n  /**\r\n   * Construct a FieldCheckbox from a JSON arg object.\r\n   *\r\n   * @param options A JSON object with options (checked).\r\n   * @returns The new field instance.\r\n   * @nocollapse\r\n   * @internal\r\n   */\r\n  static fromJson(options: FieldCheckboxFromJsonConfig): FieldCheckbox {\r\n    // `this` might be a subclass of FieldCheckbox if that class doesn't\r\n    // 'override' the static fromJson method.\r\n    return new this(options.checked, undefined, options);\r\n  }\r\n}\r\n\r\nfieldRegistry.register('field_checkbox', FieldCheckbox);\r\n\r\nFieldCheckbox.prototype.DEFAULT_VALUE = false;\r\n\r\n/**\r\n * Config options for the checkbox field.\r\n */\r\nexport interface FieldCheckboxConfig extends FieldConfig {\r\n  checkCharacter?: string;\r\n}\r\n\r\n/**\r\n * fromJson config options for the checkbox field.\r\n */\r\nexport interface FieldCheckboxFromJsonConfig extends FieldCheckboxConfig {\r\n  checked?: boolean;\r\n}\r\n\r\n/**\r\n * A function that is called to validate changes to the field's value before\r\n * they are set.\r\n *\r\n * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/fields/validators#return_values}\r\n * @param newValue The value to be validated.\r\n * @returns One of three instructions for setting the new value: `T`, `null`,\r\n * or `undefined`.\r\n *\r\n * - `T` to set this function's returned value instead of `newValue`.\r\n *\r\n * - `null` to invoke `doValueInvalid_` and not set a value.\r\n *\r\n * - `undefined` to set `newValue` as is.\r\n */\r\nexport type FieldCheckboxValidator = FieldValidator<CheckboxBool>;\r\n","/**\r\n * @license\r\n * Copyright 2012 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Colour input field.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.FieldColour\r\n\r\n// Unused import preserved for side-effects. Remove if unneeded.\r\nimport './events/events_block_change.js';\r\n\r\nimport {BlockSvg} from './block_svg.js';\r\nimport * as browserEvents from './browser_events.js';\r\nimport * as Css from './css.js';\r\nimport * as dom from './utils/dom.js';\r\nimport * as dropDownDiv from './dropdowndiv.js';\r\nimport {\r\n  Field,\r\n  FieldConfig,\r\n  FieldValidator,\r\n  UnattachedFieldError,\r\n} from './field.js';\r\nimport * as fieldRegistry from './field_registry.js';\r\nimport * as aria from './utils/aria.js';\r\nimport * as colour from './utils/colour.js';\r\nimport * as idGenerator from './utils/idgenerator.js';\r\nimport {Size} from './utils/size.js';\r\n\r\n/**\r\n * Class for a colour input field.\r\n */\r\nexport class FieldColour extends Field<string> {\r\n  /**\r\n   * An array of colour strings for the palette.\r\n   * Copied from goog.ui.ColorPicker.SIMPLE_GRID_COLORS\r\n   * All colour pickers use this unless overridden with setColours.\r\n   */\r\n  // prettier-ignore\r\n  static COLOURS: string[] = [\r\n    // grays\r\n    '#ffffff', '#cccccc', '#c0c0c0', '#999999',\r\n    '#666666', '#333333', '#000000',  // reds\r\n    '#ffcccc', '#ff6666', '#ff0000', '#cc0000',\r\n    '#990000', '#660000', '#330000',  // oranges\r\n    '#ffcc99', '#ff9966', '#ff9900', '#ff6600',\r\n    '#cc6600', '#993300', '#663300',  // yellows\r\n    '#ffff99', '#ffff66', '#ffcc66', '#ffcc33',\r\n    '#cc9933', '#996633', '#663333',  // olives\r\n    '#ffffcc', '#ffff33', '#ffff00', '#ffcc00',\r\n    '#999900', '#666600', '#333300',  // greens\r\n    '#99ff99', '#66ff99', '#33ff33', '#33cc00',\r\n    '#009900', '#006600', '#003300',  // turquoises\r\n    '#99ffff', '#33ffff', '#66cccc', '#00cccc',\r\n    '#339999', '#336666', '#003333',  // blues\r\n    '#ccffff', '#66ffff', '#33ccff', '#3366ff',\r\n    '#3333ff', '#000099', '#000066',  // purples\r\n    '#ccccff', '#9999ff', '#6666cc', '#6633ff',\r\n    '#6600cc', '#333399', '#330099',  // violets\r\n    '#ffccff', '#ff99ff', '#cc66cc', '#cc33cc',\r\n    '#993399', '#663366', '#330033',\r\n  ];\r\n\r\n  /**\r\n   * An array of tooltip strings for the palette.  If not the same length as\r\n   * COLOURS, the colour's hex code will be used for any missing titles.\r\n   * All colour pickers use this unless overridden with setColours.\r\n   */\r\n  static TITLES: string[] = [];\r\n\r\n  /**\r\n   * Number of columns in the palette.\r\n   * All colour pickers use this unless overridden with setColumns.\r\n   */\r\n  static COLUMNS = 7;\r\n\r\n  /** The field's colour picker element. */\r\n  private picker: HTMLElement | null = null;\r\n\r\n  /** Index of the currently highlighted element. */\r\n  private highlightedIndex: number | null = null;\r\n\r\n  /**\r\n   * Array holding info needed to unbind events.\r\n   * Used for disposing.\r\n   * Ex: [[node, name, func], [node, name, func]].\r\n   */\r\n  private boundEvents: browserEvents.Data[] = [];\r\n\r\n  /**\r\n   * Serializable fields are saved by the serializer, non-serializable fields\r\n   * are not. Editable fields should also be serializable.\r\n   */\r\n  override SERIALIZABLE = true;\r\n\r\n  /** Mouse cursor style when over the hotspot that initiates the editor. */\r\n  override CURSOR = 'default';\r\n\r\n  /**\r\n   * Used to tell if the field needs to be rendered the next time the block is\r\n   * rendered. Colour fields are statically sized, and only need to be\r\n   * rendered at initialization.\r\n   */\r\n  protected override isDirty_ = false;\r\n\r\n  /** Array of colours used by this field.  If null, use the global list. */\r\n  private colours: string[] | null = null;\r\n\r\n  /**\r\n   * Array of colour tooltips used by this field.  If null, use the global\r\n   * list.\r\n   */\r\n  private titles: string[] | null = null;\r\n\r\n  /**\r\n   * Number of colour columns used by this field.  If 0, use the global\r\n   * setting. By default use the global constants for columns.\r\n   */\r\n  private columns = 0;\r\n\r\n  /**\r\n   * @param value The initial value of the field. Should be in '#rrggbb'\r\n   *     format. Defaults to the first value in the default colour array. Also\r\n   *     accepts Field.SKIP_SETUP if you wish to skip setup (only used by\r\n   *     subclasses that want to handle configuration and setting the field\r\n   *     value after their own constructors have run).\r\n   * @param validator A function that is called to validate changes to the\r\n   *     field's value. Takes in a colour string & returns a validated colour\r\n   *     string ('#rrggbb' format), or null to abort the change.\r\n   * @param config A map of options used to configure the field.\r\n   *     See the [field creation documentation]{@link\r\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/colour}\r\n   * for a list of properties this parameter supports.\r\n   */\r\n  constructor(\r\n    value?: string | typeof Field.SKIP_SETUP,\r\n    validator?: FieldColourValidator,\r\n    config?: FieldColourConfig,\r\n  ) {\r\n    super(Field.SKIP_SETUP);\r\n\r\n    if (value === Field.SKIP_SETUP) return;\r\n    if (config) {\r\n      this.configure_(config);\r\n    }\r\n    this.setValue(value);\r\n    if (validator) {\r\n      this.setValidator(validator);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Configure the field based on the given map of options.\r\n   *\r\n   * @param config A map of options to configure the field based on.\r\n   */\r\n  protected override configure_(config: FieldColourConfig) {\r\n    super.configure_(config);\r\n    if (config.colourOptions) this.colours = config.colourOptions;\r\n    if (config.colourTitles) this.titles = config.colourTitles;\r\n    if (config.columns) this.columns = config.columns;\r\n  }\r\n\r\n  /**\r\n   * Create the block UI for this colour field.\r\n   */\r\n  override initView() {\r\n    this.size_ = new Size(\r\n      this.getConstants()!.FIELD_COLOUR_DEFAULT_WIDTH,\r\n      this.getConstants()!.FIELD_COLOUR_DEFAULT_HEIGHT,\r\n    );\r\n    this.createBorderRect_();\r\n    this.getBorderRect().style['fillOpacity'] = '1';\r\n    this.getBorderRect().setAttribute('stroke', '#fff');\r\n    if (this.isFullBlockField()) {\r\n      this.clickTarget_ = (this.sourceBlock_ as BlockSvg).getSvgRoot();\r\n    }\r\n  }\r\n\r\n  protected override isFullBlockField(): boolean {\r\n    const block = this.getSourceBlock();\r\n    if (!block) throw new UnattachedFieldError();\r\n\r\n    const constants = this.getConstants();\r\n    return block.isSimpleReporter() && !!constants?.FIELD_COLOUR_FULL_BLOCK;\r\n  }\r\n\r\n  /**\r\n   * Updates text field to match the colour/style of the block.\r\n   */\r\n  override applyColour() {\r\n    const block = this.getSourceBlock() as BlockSvg | null;\r\n    if (!block) throw new UnattachedFieldError();\r\n\r\n    if (!this.fieldGroup_) return;\r\n\r\n    const borderRect = this.borderRect_;\r\n    if (!borderRect) {\r\n      throw new Error('The border rect has not been initialized');\r\n    }\r\n\r\n    if (!this.isFullBlockField()) {\r\n      borderRect.style.display = 'block';\r\n      borderRect.style.fill = this.getValue() as string;\r\n    } else {\r\n      borderRect.style.display = 'none';\r\n      // In general, do *not* let fields control the color of blocks. Having the\r\n      // field control the color is unexpected, and could have performance\r\n      // impacts.\r\n      block.pathObject.svgPath.setAttribute('fill', this.getValue() as string);\r\n      block.pathObject.svgPath.setAttribute('stroke', '#fff');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns the height and width of the field.\r\n   *\r\n   * This should *in general* be the only place render_ gets called from.\r\n   *\r\n   * @returns Height and width.\r\n   */\r\n  override getSize(): Size {\r\n    if (this.getConstants()?.FIELD_COLOUR_FULL_BLOCK) {\r\n      // In general, do *not* let fields control the color of blocks. Having the\r\n      // field control the color is unexpected, and could have performance\r\n      // impacts.\r\n      // Full block fields have more control of the block than they should\r\n      // (i.e. updating fill colour). Whenever we get the size, the field may\r\n      // no longer be a full-block field, so we need to rerender.\r\n      this.render_();\r\n      this.isDirty_ = false;\r\n    }\r\n    return super.getSize();\r\n  }\r\n\r\n  /**\r\n   * Updates the colour of the block to reflect whether this is a full\r\n   * block field or not.\r\n   */\r\n  protected override render_() {\r\n    super.render_();\r\n\r\n    const block = this.getSourceBlock() as BlockSvg | null;\r\n    if (!block) throw new UnattachedFieldError();\r\n    // Calling applyColour updates the UI (full-block vs non-full-block) for the\r\n    // colour field, and the colour of the field/block.\r\n    block.applyColour();\r\n  }\r\n\r\n  /**\r\n   * Updates the size of the field based on whether it is a full block field\r\n   * or not.\r\n   *\r\n   * @param margin margin to use when positioning the field.\r\n   */\r\n  protected updateSize_(margin?: number) {\r\n    const constants = this.getConstants();\r\n    let totalWidth;\r\n    let totalHeight;\r\n    if (this.isFullBlockField()) {\r\n      const xOffset = margin ?? 0;\r\n      totalWidth = xOffset * 2;\r\n      totalHeight = constants!.FIELD_TEXT_HEIGHT;\r\n    } else {\r\n      totalWidth = constants!.FIELD_COLOUR_DEFAULT_WIDTH;\r\n      totalHeight = constants!.FIELD_COLOUR_DEFAULT_HEIGHT;\r\n    }\r\n\r\n    this.size_.height = totalHeight;\r\n    this.size_.width = totalWidth;\r\n\r\n    this.positionBorderRect_();\r\n  }\r\n\r\n  /**\r\n   * Ensure that the input value is a valid colour.\r\n   *\r\n   * @param newValue The input value.\r\n   * @returns A valid colour, or null if invalid.\r\n   */\r\n  protected override doClassValidation_(newValue?: any): string | null {\r\n    if (typeof newValue !== 'string') {\r\n      return null;\r\n    }\r\n    return colour.parse(newValue);\r\n  }\r\n\r\n  /**\r\n   * Get the text for this field.  Used when the block is collapsed.\r\n   *\r\n   * @returns Text representing the value of this field.\r\n   */\r\n  override getText(): string {\r\n    let colour = this.value_ as string;\r\n    // Try to use #rgb format if possible, rather than #rrggbb.\r\n    if (/^#(.)\\1(.)\\2(.)\\3$/.test(colour)) {\r\n      colour = '#' + colour[1] + colour[3] + colour[5];\r\n    }\r\n    return colour;\r\n  }\r\n\r\n  /**\r\n   * Set a custom colour grid for this field.\r\n   *\r\n   * @param colours Array of colours for this block, or null to use default\r\n   *     (FieldColour.COLOURS).\r\n   * @param titles Optional array of colour tooltips, or null to use default\r\n   *     (FieldColour.TITLES).\r\n   * @returns Returns itself (for method chaining).\r\n   */\r\n  setColours(colours: string[], titles?: string[]): FieldColour {\r\n    this.colours = colours;\r\n    if (titles) {\r\n      this.titles = titles;\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Set a custom grid size for this field.\r\n   *\r\n   * @param columns Number of columns for this block, or 0 to use default\r\n   *     (FieldColour.COLUMNS).\r\n   * @returns Returns itself (for method chaining).\r\n   */\r\n  setColumns(columns: number): FieldColour {\r\n    this.columns = columns;\r\n    return this;\r\n  }\r\n\r\n  /** Create and show the colour field's editor. */\r\n  protected override showEditor_() {\r\n    this.dropdownCreate();\r\n    dropDownDiv.getContentDiv().appendChild(this.picker!);\r\n\r\n    dropDownDiv.showPositionedByField(this, this.dropdownDispose.bind(this));\r\n\r\n    // Focus so we can start receiving keyboard events.\r\n    this.picker!.focus({preventScroll: true});\r\n  }\r\n\r\n  /**\r\n   * Handle a click on a colour cell.\r\n   *\r\n   * @param e Mouse event.\r\n   */\r\n  private onClick(e: PointerEvent) {\r\n    const cell = e.target as Element;\r\n    const colour = cell && cell.getAttribute('data-colour');\r\n    if (colour !== null) {\r\n      this.setValue(colour);\r\n      dropDownDiv.hideIfOwner(this);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle a key down event. Navigate around the grid with the\r\n   * arrow keys. Enter selects the highlighted colour.\r\n   *\r\n   * @param e Keyboard event.\r\n   */\r\n  private onKeyDown(e: KeyboardEvent) {\r\n    let handled = true;\r\n    let highlighted: HTMLElement | null;\r\n    switch (e.key) {\r\n      case 'ArrowUp':\r\n        this.moveHighlightBy(0, -1);\r\n        break;\r\n      case 'ArrowDown':\r\n        this.moveHighlightBy(0, 1);\r\n        break;\r\n      case 'ArrowLeft':\r\n        this.moveHighlightBy(-1, 0);\r\n        break;\r\n      case 'ArrowRight':\r\n        this.moveHighlightBy(1, 0);\r\n        break;\r\n      case 'Enter':\r\n        // Select the highlighted colour.\r\n        highlighted = this.getHighlighted();\r\n        if (highlighted) {\r\n          const colour = highlighted.getAttribute('data-colour');\r\n          if (colour !== null) {\r\n            this.setValue(colour);\r\n          }\r\n        }\r\n        dropDownDiv.hideWithoutAnimation();\r\n        break;\r\n      default:\r\n        handled = false;\r\n    }\r\n    if (handled) {\r\n      e.stopPropagation();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Move the currently highlighted position by dx and dy.\r\n   *\r\n   * @param dx Change of x.\r\n   * @param dy Change of y.\r\n   */\r\n  private moveHighlightBy(dx: number, dy: number) {\r\n    if (!this.highlightedIndex) {\r\n      return;\r\n    }\r\n\r\n    const colours = this.colours || FieldColour.COLOURS;\r\n    const columns = this.columns || FieldColour.COLUMNS;\r\n\r\n    // Get the current x and y coordinates.\r\n    let x = this.highlightedIndex % columns;\r\n    let y = Math.floor(this.highlightedIndex / columns);\r\n\r\n    // Add the offset.\r\n    x += dx;\r\n    y += dy;\r\n\r\n    if (dx < 0) {\r\n      // Move left one grid cell, even in RTL.\r\n      // Loop back to the end of the previous row if we have room.\r\n      if (x < 0 && y > 0) {\r\n        x = columns - 1;\r\n        y--;\r\n      } else if (x < 0) {\r\n        x = 0;\r\n      }\r\n    } else if (dx > 0) {\r\n      // Move right one grid cell, even in RTL.\r\n      // Loop to the start of the next row, if there's room.\r\n      if (x > columns - 1 && y < Math.floor(colours.length / columns) - 1) {\r\n        x = 0;\r\n        y++;\r\n      } else if (x > columns - 1) {\r\n        x--;\r\n      }\r\n    } else if (dy < 0) {\r\n      // Move up one grid cell, stop at the top.\r\n      if (y < 0) {\r\n        y = 0;\r\n      }\r\n    } else if (dy > 0) {\r\n      // Move down one grid cell, stop at the bottom.\r\n      if (y > Math.floor(colours.length / columns) - 1) {\r\n        y = Math.floor(colours.length / columns) - 1;\r\n      }\r\n    }\r\n\r\n    // Move the highlight to the new coordinates.\r\n    const cell = this.picker!.childNodes[y].childNodes[x] as Element;\r\n    const index = y * columns + x;\r\n    this.setHighlightedCell(cell, index);\r\n  }\r\n\r\n  /**\r\n   * Handle a mouse move event. Highlight the hovered colour.\r\n   *\r\n   * @param e Mouse event.\r\n   */\r\n  private onMouseMove(e: PointerEvent) {\r\n    const cell = e.target as Element;\r\n    const index = cell && Number(cell.getAttribute('data-index'));\r\n    if (index !== null && index !== this.highlightedIndex) {\r\n      this.setHighlightedCell(cell, index);\r\n    }\r\n  }\r\n\r\n  /** Handle a mouse enter event. Focus the picker. */\r\n  private onMouseEnter() {\r\n    this.picker?.focus({preventScroll: true});\r\n  }\r\n\r\n  /**\r\n   * Handle a mouse leave event. Blur the picker and unhighlight\r\n   * the currently highlighted colour.\r\n   */\r\n  private onMouseLeave() {\r\n    this.picker?.blur();\r\n    const highlighted = this.getHighlighted();\r\n    if (highlighted) {\r\n      dom.removeClass(highlighted, 'blocklyColourHighlighted');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns the currently highlighted item (if any).\r\n   *\r\n   * @returns Highlighted item (null if none).\r\n   */\r\n  private getHighlighted(): HTMLElement | null {\r\n    if (!this.highlightedIndex) {\r\n      return null;\r\n    }\r\n\r\n    const columns = this.columns || FieldColour.COLUMNS;\r\n    const x = this.highlightedIndex % columns;\r\n    const y = Math.floor(this.highlightedIndex / columns);\r\n    const row = this.picker!.childNodes[y];\r\n    if (!row) {\r\n      return null;\r\n    }\r\n    return row.childNodes[x] as HTMLElement;\r\n  }\r\n\r\n  /**\r\n   * Update the currently highlighted cell.\r\n   *\r\n   * @param cell The new cell to highlight.\r\n   * @param index The index of the new cell.\r\n   */\r\n  private setHighlightedCell(cell: Element, index: number) {\r\n    // Unhighlight the current item.\r\n    const highlighted = this.getHighlighted();\r\n    if (highlighted) {\r\n      dom.removeClass(highlighted, 'blocklyColourHighlighted');\r\n    }\r\n    // Highlight new item.\r\n    dom.addClass(cell, 'blocklyColourHighlighted');\r\n    // Set new highlighted index.\r\n    this.highlightedIndex = index;\r\n\r\n    // Update accessibility roles.\r\n    const cellId = cell.getAttribute('id');\r\n    if (cellId && this.picker) {\r\n      aria.setState(this.picker, aria.State.ACTIVEDESCENDANT, cellId);\r\n    }\r\n  }\r\n\r\n  /** Create a colour picker dropdown editor. */\r\n  private dropdownCreate() {\r\n    const columns = this.columns || FieldColour.COLUMNS;\r\n    const colours = this.colours || FieldColour.COLOURS;\r\n    const titles = this.titles || FieldColour.TITLES;\r\n    const selectedColour = this.getValue();\r\n    // Create the palette.\r\n    const table = document.createElement('table');\r\n    table.className = 'blocklyColourTable';\r\n    table.tabIndex = 0;\r\n    table.dir = 'ltr';\r\n    aria.setRole(table, aria.Role.GRID);\r\n    aria.setState(table, aria.State.EXPANDED, true);\r\n    aria.setState(\r\n      table,\r\n      aria.State.ROWCOUNT,\r\n      Math.floor(colours.length / columns),\r\n    );\r\n    aria.setState(table, aria.State.COLCOUNT, columns);\r\n    let row: Element;\r\n    for (let i = 0; i < colours.length; i++) {\r\n      if (i % columns === 0) {\r\n        row = document.createElement('tr');\r\n        aria.setRole(row, aria.Role.ROW);\r\n        table.appendChild(row);\r\n      }\r\n      const cell = document.createElement('td');\r\n      row!.appendChild(cell);\r\n      // This becomes the value, if clicked.\r\n      cell.setAttribute('data-colour', colours[i]);\r\n      cell.title = titles[i] || colours[i];\r\n      cell.id = idGenerator.getNextUniqueId();\r\n      cell.setAttribute('data-index', `${i}`);\r\n      aria.setRole(cell, aria.Role.GRIDCELL);\r\n      aria.setState(cell, aria.State.LABEL, colours[i]);\r\n      aria.setState(cell, aria.State.SELECTED, colours[i] === selectedColour);\r\n      cell.style.backgroundColor = colours[i];\r\n      if (colours[i] === selectedColour) {\r\n        cell.className = 'blocklyColourSelected';\r\n        this.highlightedIndex = i;\r\n      }\r\n    }\r\n\r\n    // Configure event handler on the table to listen for any event in a cell.\r\n    this.boundEvents.push(\r\n      browserEvents.conditionalBind(\r\n        table,\r\n        'pointerdown',\r\n        this,\r\n        this.onClick,\r\n        true,\r\n      ),\r\n    );\r\n    this.boundEvents.push(\r\n      browserEvents.conditionalBind(\r\n        table,\r\n        'pointermove',\r\n        this,\r\n        this.onMouseMove,\r\n        true,\r\n      ),\r\n    );\r\n    this.boundEvents.push(\r\n      browserEvents.conditionalBind(\r\n        table,\r\n        'pointerenter',\r\n        this,\r\n        this.onMouseEnter,\r\n        true,\r\n      ),\r\n    );\r\n    this.boundEvents.push(\r\n      browserEvents.conditionalBind(\r\n        table,\r\n        'pointerleave',\r\n        this,\r\n        this.onMouseLeave,\r\n        true,\r\n      ),\r\n    );\r\n    this.boundEvents.push(\r\n      browserEvents.conditionalBind(\r\n        table,\r\n        'keydown',\r\n        this,\r\n        this.onKeyDown,\r\n        false,\r\n      ),\r\n    );\r\n\r\n    this.picker = table;\r\n  }\r\n\r\n  /** Disposes of events and DOM-references belonging to the colour editor. */\r\n  private dropdownDispose() {\r\n    for (const event of this.boundEvents) {\r\n      browserEvents.unbind(event);\r\n    }\r\n    this.boundEvents.length = 0;\r\n    this.picker = null;\r\n    this.highlightedIndex = null;\r\n  }\r\n\r\n  /**\r\n   * Construct a FieldColour from a JSON arg object.\r\n   *\r\n   * @param options A JSON object with options (colour).\r\n   * @returns The new field instance.\r\n   * @nocollapse\r\n   * @internal\r\n   */\r\n  static fromJson(options: FieldColourFromJsonConfig): FieldColour {\r\n    // `this` might be a subclass of FieldColour if that class doesn't override\r\n    // the static fromJson method.\r\n    return new this(options.colour, undefined, options);\r\n  }\r\n}\r\n\r\n/** The default value for this field. */\r\nFieldColour.prototype.DEFAULT_VALUE = FieldColour.COLOURS[0];\r\n\r\nfieldRegistry.register('field_colour', FieldColour);\r\n\r\n/**\r\n * CSS for colour picker.\r\n */\r\nCss.register(`\r\n.blocklyColourTable {\r\n  border-collapse: collapse;\r\n  display: block;\r\n  outline: none;\r\n  padding: 1px;\r\n}\r\n\r\n.blocklyColourTable>tr>td {\r\n  border: 0.5px solid #888;\r\n  box-sizing: border-box;\r\n  cursor: pointer;\r\n  display: inline-block;\r\n  height: 20px;\r\n  padding: 0;\r\n  width: 20px;\r\n}\r\n\r\n.blocklyColourTable>tr>td.blocklyColourHighlighted {\r\n  border-color: #eee;\r\n  box-shadow: 2px 2px 7px 2px rgba(0, 0, 0, 0.3);\r\n  position: relative;\r\n}\r\n\r\n.blocklyColourSelected, .blocklyColourSelected:hover {\r\n  border-color: #eee !important;\r\n  outline: 1px solid #333;\r\n  position: relative;\r\n}\r\n`);\r\n\r\n/**\r\n * Config options for the colour field.\r\n */\r\nexport interface FieldColourConfig extends FieldConfig {\r\n  colourOptions?: string[];\r\n  colourTitles?: string[];\r\n  columns?: number;\r\n}\r\n\r\n/**\r\n * fromJson config options for the colour field.\r\n */\r\nexport interface FieldColourFromJsonConfig extends FieldColourConfig {\r\n  colour?: string;\r\n}\r\n\r\n/**\r\n * A function that is called to validate changes to the field's value before\r\n * they are set.\r\n *\r\n * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/fields/validators#return_values}\r\n * @param newValue The value to be validated.\r\n * @returns One of three instructions for setting the new value: `T`, `null`,\r\n * or `undefined`.\r\n *\r\n * - `T` to set this function's returned value instead of `newValue`.\r\n *\r\n * - `null` to invoke `doValueInvalid_` and not set a value.\r\n *\r\n * - `undefined` to set `newValue` as is.\r\n */\r\nexport type FieldColourValidator = FieldValidator<string>;\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Non-editable, serializable text field. Behaves like a\r\n *    normal label but is serialized to XML. It may only be\r\n *    edited programmatically.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.FieldLabelSerializable\r\n\r\nimport {\r\n  FieldLabel,\r\n  FieldLabelConfig,\r\n  FieldLabelFromJsonConfig,\r\n} from './field_label.js';\r\nimport * as fieldRegistry from './field_registry.js';\r\nimport * as parsing from './utils/parsing.js';\r\n\r\n/**\r\n * Class for a non-editable, serializable text field.\r\n */\r\nexport class FieldLabelSerializable extends FieldLabel {\r\n  /**\r\n   * Editable fields usually show some sort of UI indicating they are\r\n   * editable. This field should not.\r\n   */\r\n  override EDITABLE = false;\r\n\r\n  /**\r\n   * Serializable fields are saved by the XML renderer, non-serializable\r\n   * fields are not.  This field should be serialized, but only edited\r\n   * programmatically.\r\n   */\r\n  override SERIALIZABLE = true;\r\n\r\n  /**\r\n   * @param value The initial value of the field. Should cast to a string.\r\n   *     Defaults to an empty string if null or undefined.\r\n   * @param textClass Optional CSS class for the field's text.\r\n   * @param config A map of options used to configure the field.\r\n   *    See the [field creation documentation]{@link\r\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/label-serializable#creation}\r\n   * for a list of properties this parameter supports.\r\n   */\r\n  constructor(value?: string, textClass?: string, config?: FieldLabelConfig) {\r\n    super(String(value ?? ''), textClass, config);\r\n  }\r\n\r\n  /**\r\n   * Construct a FieldLabelSerializable from a JSON arg object,\r\n   * dereferencing any string table references.\r\n   *\r\n   * @param options A JSON object with options (text, and class).\r\n   * @returns The new field instance.\r\n   * @nocollapse\r\n   * @internal\r\n   */\r\n  static override fromJson(\r\n    options: FieldLabelFromJsonConfig,\r\n  ): FieldLabelSerializable {\r\n    const text = parsing.replaceMessageReferences(options.text);\r\n    // `this` might be a subclass of FieldLabelSerializable if that class\r\n    // doesn't override the static fromJson method.\r\n    return new this(text, undefined, options);\r\n  }\r\n}\r\n\r\nfieldRegistry.register('field_label_serializable', FieldLabelSerializable);\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Text Area field.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.FieldMultilineInput\r\n\r\nimport * as Css from './css.js';\r\nimport {Field, UnattachedFieldError} from './field.js';\r\nimport * as fieldRegistry from './field_registry.js';\r\nimport {\r\n  FieldTextInput,\r\n  FieldTextInputConfig,\r\n  FieldTextInputValidator,\r\n} from './field_textinput.js';\r\nimport * as aria from './utils/aria.js';\r\nimport * as dom from './utils/dom.js';\r\nimport * as parsing from './utils/parsing.js';\r\nimport {Svg} from './utils/svg.js';\r\nimport * as userAgent from './utils/useragent.js';\r\nimport * as WidgetDiv from './widgetdiv.js';\r\n\r\n/**\r\n * Class for an editable text area field.\r\n */\r\nexport class FieldMultilineInput extends FieldTextInput {\r\n  /**\r\n   * The SVG group element that will contain a text element for each text row\r\n   *     when initialized.\r\n   */\r\n  textGroup: SVGGElement | null = null;\r\n\r\n  /**\r\n   * Defines the maximum number of lines of field.\r\n   * If exceeded, scrolling functionality is enabled.\r\n   */\r\n  protected maxLines_ = Infinity;\r\n\r\n  /** Whether Y overflow is currently occurring. */\r\n  protected isOverflowedY_ = false;\r\n\r\n  /**\r\n   * @param value The initial content of the field. Should cast to a string.\r\n   *     Defaults to an empty string if null or undefined. Also accepts\r\n   *     Field.SKIP_SETUP if you wish to skip setup (only used by subclasses\r\n   *     that want to handle configuration and setting the field value after\r\n   *     their own constructors have run).\r\n   * @param validator An optional function that is called to validate any\r\n   *     constraints on what the user entered.  Takes the new text as an\r\n   *     argument and returns either the accepted text, a replacement text, or\r\n   *     null to abort the change.\r\n   * @param config A map of options used to configure the field.\r\n   *     See the [field creation documentation]{@link\r\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/multiline-text-input#creation}\r\n   * for a list of properties this parameter supports.\r\n   */\r\n  constructor(\r\n    value?: string | typeof Field.SKIP_SETUP,\r\n    validator?: FieldMultilineInputValidator,\r\n    config?: FieldMultilineInputConfig,\r\n  ) {\r\n    super(Field.SKIP_SETUP);\r\n\r\n    if (value === Field.SKIP_SETUP) return;\r\n    if (config) {\r\n      this.configure_(config);\r\n    }\r\n    this.setValue(value);\r\n    if (validator) {\r\n      this.setValidator(validator);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Configure the field based on the given map of options.\r\n   *\r\n   * @param config A map of options to configure the field based on.\r\n   */\r\n  protected override configure_(config: FieldMultilineInputConfig) {\r\n    super.configure_(config);\r\n    if (config.maxLines) this.setMaxLines(config.maxLines);\r\n  }\r\n\r\n  /**\r\n   * Serializes this field's value to XML. Should only be called by Blockly.Xml.\r\n   *\r\n   * @param fieldElement The element to populate with info about the field's\r\n   *     state.\r\n   * @returns The element containing info about the field's state.\r\n   * @internal\r\n   */\r\n  override toXml(fieldElement: Element): Element {\r\n    // Replace '\\n' characters with HTML-escaped equivalent '&#10'. This is\r\n    // needed so the plain-text representation of the XML produced by\r\n    // `Blockly.Xml.domToText` will appear on a single line (this is a\r\n    // limitation of the plain-text format).\r\n    fieldElement.textContent = (this.getValue() as string).replace(\r\n      /\\n/g,\r\n      '&#10;',\r\n    );\r\n    return fieldElement;\r\n  }\r\n\r\n  /**\r\n   * Sets the field's value based on the given XML element. Should only be\r\n   * called by Blockly.Xml.\r\n   *\r\n   * @param fieldElement The element containing info about the field's state.\r\n   * @internal\r\n   */\r\n  override fromXml(fieldElement: Element) {\r\n    this.setValue(fieldElement.textContent!.replace(/&#10;/g, '\\n'));\r\n  }\r\n\r\n  /**\r\n   * Saves this field's value.\r\n   * This function only exists for subclasses of FieldMultilineInput which\r\n   * predate the load/saveState API and only define to/fromXml.\r\n   *\r\n   * @returns The state of this field.\r\n   * @internal\r\n   */\r\n  override saveState(): AnyDuringMigration {\r\n    const legacyState = this.saveLegacyState(FieldMultilineInput);\r\n    if (legacyState !== null) {\r\n      return legacyState;\r\n    }\r\n    return this.getValue();\r\n  }\r\n\r\n  /**\r\n   * Sets the field's value based on the given state.\r\n   * This function only exists for subclasses of FieldMultilineInput which\r\n   * predate the load/saveState API and only define to/fromXml.\r\n   *\r\n   * @param state The state of the variable to assign to this variable field.\r\n   * @internal\r\n   */\r\n  override loadState(state: AnyDuringMigration) {\r\n    if (this.loadLegacyState(Field, state)) {\r\n      return;\r\n    }\r\n    this.setValue(state);\r\n  }\r\n\r\n  /**\r\n   * Create the block UI for this field.\r\n   */\r\n  override initView() {\r\n    this.createBorderRect_();\r\n    this.textGroup = dom.createSvgElement(\r\n      Svg.G,\r\n      {\r\n        'class': 'blocklyEditableText',\r\n      },\r\n      this.fieldGroup_,\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get the text from this field as displayed on screen.  May differ from\r\n   * getText due to ellipsis, and other formatting.\r\n   *\r\n   * @returns Currently displayed text.\r\n   */\r\n  protected override getDisplayText_(): string {\r\n    const block = this.getSourceBlock();\r\n    if (!block) {\r\n      throw new UnattachedFieldError();\r\n    }\r\n    let textLines = this.getText();\r\n    if (!textLines) {\r\n      // Prevent the field from disappearing if empty.\r\n      return Field.NBSP;\r\n    }\r\n    const lines = textLines.split('\\n');\r\n    textLines = '';\r\n    const displayLinesNumber = this.isOverflowedY_\r\n      ? this.maxLines_\r\n      : lines.length;\r\n    for (let i = 0; i < displayLinesNumber; i++) {\r\n      let text = lines[i];\r\n      if (text.length > this.maxDisplayLength) {\r\n        // Truncate displayed string and add an ellipsis ('...').\r\n        text = text.substring(0, this.maxDisplayLength - 4) + '...';\r\n      } else if (this.isOverflowedY_ && i === displayLinesNumber - 1) {\r\n        text = text.substring(0, text.length - 3) + '...';\r\n      }\r\n      // Replace whitespace with non-breaking spaces so the text doesn't\r\n      // collapse.\r\n      text = text.replace(/\\s/g, Field.NBSP);\r\n\r\n      textLines += text;\r\n      if (i !== displayLinesNumber - 1) {\r\n        textLines += '\\n';\r\n      }\r\n    }\r\n    if (block.RTL) {\r\n      // The SVG is LTR, force value to be RTL.\r\n      textLines += '\\u200F';\r\n    }\r\n    return textLines;\r\n  }\r\n\r\n  /**\r\n   * Called by setValue if the text input is valid. Updates the value of the\r\n   * field, and updates the text of the field if it is not currently being\r\n   * edited (i.e. handled by the htmlInput_). Is being redefined here to update\r\n   * overflow state of the field.\r\n   *\r\n   * @param newValue The value to be saved. The default validator guarantees\r\n   *     that this is a string.\r\n   */\r\n  protected override doValueUpdate_(newValue: string) {\r\n    super.doValueUpdate_(newValue);\r\n    if (this.value_ !== null) {\r\n      this.isOverflowedY_ = this.value_.split('\\n').length > this.maxLines_;\r\n    }\r\n  }\r\n\r\n  /** Updates the text of the textElement. */\r\n  protected override render_() {\r\n    const block = this.getSourceBlock();\r\n    if (!block) {\r\n      throw new UnattachedFieldError();\r\n    }\r\n    // Remove all text group children.\r\n    let currentChild;\r\n    const textGroup = this.textGroup;\r\n    while ((currentChild = textGroup!.firstChild)) {\r\n      textGroup!.removeChild(currentChild);\r\n    }\r\n\r\n    // Add in text elements into the group.\r\n    const lines = this.getDisplayText_().split('\\n');\r\n    let y = 0;\r\n    for (let i = 0; i < lines.length; i++) {\r\n      const lineHeight =\r\n        this.getConstants()!.FIELD_TEXT_HEIGHT +\r\n        this.getConstants()!.FIELD_BORDER_RECT_Y_PADDING;\r\n      const span = dom.createSvgElement(\r\n        Svg.TEXT,\r\n        {\r\n          'class': 'blocklyText blocklyMultilineText',\r\n          'x': this.getConstants()!.FIELD_BORDER_RECT_X_PADDING,\r\n          'y': y + this.getConstants()!.FIELD_BORDER_RECT_Y_PADDING,\r\n          'dy': this.getConstants()!.FIELD_TEXT_BASELINE,\r\n        },\r\n        textGroup,\r\n      );\r\n      span.appendChild(document.createTextNode(lines[i]));\r\n      y += lineHeight;\r\n    }\r\n\r\n    if (this.isBeingEdited_) {\r\n      const htmlInput = this.htmlInput_ as HTMLElement;\r\n      if (this.isOverflowedY_) {\r\n        dom.addClass(htmlInput, 'blocklyHtmlTextAreaInputOverflowedY');\r\n      } else {\r\n        dom.removeClass(htmlInput, 'blocklyHtmlTextAreaInputOverflowedY');\r\n      }\r\n    }\r\n\r\n    this.updateSize_();\r\n\r\n    if (this.isBeingEdited_) {\r\n      if (block.RTL) {\r\n        // in RTL, we need to let the browser reflow before resizing\r\n        // in order to get the correct bounding box of the borderRect\r\n        // avoiding issue #2777.\r\n        setTimeout(this.resizeEditor_.bind(this), 0);\r\n      } else {\r\n        this.resizeEditor_();\r\n      }\r\n      const htmlInput = this.htmlInput_ as HTMLElement;\r\n      if (!this.isTextValid_) {\r\n        dom.addClass(htmlInput, 'blocklyInvalidInput');\r\n        aria.setState(htmlInput, aria.State.INVALID, true);\r\n      } else {\r\n        dom.removeClass(htmlInput, 'blocklyInvalidInput');\r\n        aria.setState(htmlInput, aria.State.INVALID, false);\r\n      }\r\n    }\r\n  }\r\n\r\n  /** Updates the size of the field based on the text. */\r\n  protected override updateSize_() {\r\n    const nodes = (this.textGroup as SVGElement).childNodes;\r\n    const fontSize = this.getConstants()!.FIELD_TEXT_FONTSIZE;\r\n    const fontWeight = this.getConstants()!.FIELD_TEXT_FONTWEIGHT;\r\n    const fontFamily = this.getConstants()!.FIELD_TEXT_FONTFAMILY;\r\n    let totalWidth = 0;\r\n    let totalHeight = 0;\r\n    for (let i = 0; i < nodes.length; i++) {\r\n      const tspan = nodes[i] as SVGTextElement;\r\n      const textWidth = dom.getFastTextWidth(\r\n        tspan,\r\n        fontSize,\r\n        fontWeight,\r\n        fontFamily,\r\n      );\r\n      if (textWidth > totalWidth) {\r\n        totalWidth = textWidth;\r\n      }\r\n      totalHeight +=\r\n        this.getConstants()!.FIELD_TEXT_HEIGHT +\r\n        (i > 0 ? this.getConstants()!.FIELD_BORDER_RECT_Y_PADDING : 0);\r\n    }\r\n    if (this.isBeingEdited_) {\r\n      // The default width is based on the longest line in the display text,\r\n      // but when it's being edited, width should be calculated based on the\r\n      // absolute longest line, even if it would be truncated after editing.\r\n      // Otherwise we would get wrong editor width when there are more\r\n      // lines than this.maxLines_.\r\n      const actualEditorLines = String(this.value_).split('\\n');\r\n      const dummyTextElement = dom.createSvgElement(Svg.TEXT, {\r\n        'class': 'blocklyText blocklyMultilineText',\r\n      });\r\n\r\n      for (let i = 0; i < actualEditorLines.length; i++) {\r\n        if (actualEditorLines[i].length > this.maxDisplayLength) {\r\n          actualEditorLines[i] = actualEditorLines[i].substring(\r\n            0,\r\n            this.maxDisplayLength,\r\n          );\r\n        }\r\n        dummyTextElement.textContent = actualEditorLines[i];\r\n        const lineWidth = dom.getFastTextWidth(\r\n          dummyTextElement,\r\n          fontSize,\r\n          fontWeight,\r\n          fontFamily,\r\n        );\r\n        if (lineWidth > totalWidth) {\r\n          totalWidth = lineWidth;\r\n        }\r\n      }\r\n\r\n      const scrollbarWidth =\r\n        this.htmlInput_!.offsetWidth - this.htmlInput_!.clientWidth;\r\n      totalWidth += scrollbarWidth;\r\n    }\r\n    if (this.borderRect_) {\r\n      totalHeight += this.getConstants()!.FIELD_BORDER_RECT_Y_PADDING * 2;\r\n      totalWidth += this.getConstants()!.FIELD_BORDER_RECT_X_PADDING * 2;\r\n      this.borderRect_.setAttribute('width', `${totalWidth}`);\r\n      this.borderRect_.setAttribute('height', `${totalHeight}`);\r\n    }\r\n    this.size_.width = totalWidth;\r\n    this.size_.height = totalHeight;\r\n\r\n    this.positionBorderRect_();\r\n  }\r\n\r\n  /**\r\n   * Show the inline free-text editor on top of the text.\r\n   * Overrides the default behaviour to force rerender in order to\r\n   * correct block size, based on editor text.\r\n   *\r\n   * @param e Optional mouse event that triggered the field to open, or\r\n   *     undefined if triggered programmatically.\r\n   * @param quietInput True if editor should be created without focus.\r\n   *     Defaults to false.\r\n   */\r\n  override showEditor_(e?: Event, quietInput?: boolean) {\r\n    super.showEditor_(e, quietInput);\r\n    this.forceRerender();\r\n  }\r\n\r\n  /**\r\n   * Create the text input editor widget.\r\n   *\r\n   * @returns The newly created text input editor.\r\n   */\r\n  protected override widgetCreate_(): HTMLTextAreaElement {\r\n    const div = WidgetDiv.getDiv();\r\n    const scale = this.workspace_!.getScale();\r\n\r\n    const htmlInput = document.createElement('textarea');\r\n    htmlInput.className = 'blocklyHtmlInput blocklyHtmlTextAreaInput';\r\n    htmlInput.setAttribute('spellcheck', String(this.spellcheck_));\r\n    const fontSize = this.getConstants()!.FIELD_TEXT_FONTSIZE * scale + 'pt';\r\n    div!.style.fontSize = fontSize;\r\n    htmlInput.style.fontSize = fontSize;\r\n    const borderRadius = FieldTextInput.BORDERRADIUS * scale + 'px';\r\n    htmlInput.style.borderRadius = borderRadius;\r\n    const paddingX = this.getConstants()!.FIELD_BORDER_RECT_X_PADDING * scale;\r\n    const paddingY =\r\n      (this.getConstants()!.FIELD_BORDER_RECT_Y_PADDING * scale) / 2;\r\n    htmlInput.style.padding =\r\n      paddingY + 'px ' + paddingX + 'px ' + paddingY + 'px ' + paddingX + 'px';\r\n    const lineHeight =\r\n      this.getConstants()!.FIELD_TEXT_HEIGHT +\r\n      this.getConstants()!.FIELD_BORDER_RECT_Y_PADDING;\r\n    htmlInput.style.lineHeight = lineHeight * scale + 'px';\r\n\r\n    div!.appendChild(htmlInput);\r\n\r\n    htmlInput.value = htmlInput.defaultValue = this.getEditorText_(this.value_);\r\n    htmlInput.setAttribute('data-untyped-default-value', String(this.value_));\r\n    htmlInput.setAttribute('data-old-value', '');\r\n    if (userAgent.GECKO) {\r\n      // In FF, ensure the browser reflows before resizing to avoid issue #2777.\r\n      setTimeout(this.resizeEditor_.bind(this), 0);\r\n    } else {\r\n      this.resizeEditor_();\r\n    }\r\n\r\n    this.bindInputEvents_(htmlInput);\r\n\r\n    return htmlInput;\r\n  }\r\n\r\n  /**\r\n   * Sets the maxLines config for this field.\r\n   *\r\n   * @param maxLines Defines the maximum number of lines allowed, before\r\n   *     scrolling functionality is enabled.\r\n   */\r\n  setMaxLines(maxLines: number) {\r\n    if (\r\n      typeof maxLines === 'number' &&\r\n      maxLines > 0 &&\r\n      maxLines !== this.maxLines_\r\n    ) {\r\n      this.maxLines_ = maxLines;\r\n      this.forceRerender();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns the maxLines config of this field.\r\n   *\r\n   * @returns The maxLines config value.\r\n   */\r\n  getMaxLines(): number {\r\n    return this.maxLines_;\r\n  }\r\n\r\n  /**\r\n   * Handle key down to the editor. Override the text input definition of this\r\n   * so as to not close the editor when enter is typed in.\r\n   *\r\n   * @param e Keyboard event.\r\n   */\r\n  protected override onHtmlInputKeyDown_(e: KeyboardEvent) {\r\n    if (e.key !== 'Enter') {\r\n      super.onHtmlInputKeyDown_(e);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Construct a FieldMultilineInput from a JSON arg object,\r\n   * dereferencing any string table references.\r\n   *\r\n   * @param options A JSON object with options (text, and spellcheck).\r\n   * @returns The new field instance.\r\n   * @nocollapse\r\n   * @internal\r\n   */\r\n  static override fromJson(\r\n    options: FieldMultilineInputFromJsonConfig,\r\n  ): FieldMultilineInput {\r\n    const text = parsing.replaceMessageReferences(options.text);\r\n    // `this` might be a subclass of FieldMultilineInput if that class doesn't\r\n    // override the static fromJson method.\r\n    return new this(text, undefined, options);\r\n  }\r\n}\r\n\r\nfieldRegistry.register('field_multilinetext', FieldMultilineInput);\r\n\r\n/**\r\n * CSS for multiline field.\r\n */\r\nCss.register(`\r\n.blocklyHtmlTextAreaInput {\r\n  font-family: monospace;\r\n  resize: none;\r\n  overflow: hidden;\r\n  height: 100%;\r\n  text-align: left;\r\n}\r\n\r\n.blocklyHtmlTextAreaInputOverflowedY {\r\n  overflow-y: scroll;\r\n}\r\n`);\r\n\r\n/**\r\n * Config options for the multiline input field.\r\n */\r\nexport interface FieldMultilineInputConfig extends FieldTextInputConfig {\r\n  maxLines?: number;\r\n}\r\n\r\n/**\r\n * fromJson config options for the multiline input field.\r\n */\r\nexport interface FieldMultilineInputFromJsonConfig\r\n  extends FieldMultilineInputConfig {\r\n  text?: string;\r\n}\r\n\r\n/**\r\n * A function that is called to validate changes to the field's value before\r\n * they are set.\r\n *\r\n * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/fields/validators#return_values}\r\n * @param newValue The value to be validated.\r\n * @returns One of three instructions for setting the new value: `T`, `null`,\r\n * or `undefined`.\r\n *\r\n * - `T` to set this function's returned value instead of `newValue`.\r\n *\r\n * - `null` to invoke `doValueInvalid_` and not set a value.\r\n *\r\n * - `undefined` to set `newValue` as is.\r\n */\r\nexport type FieldMultilineInputValidator = FieldTextInputValidator;\r\n","/**\r\n * @license\r\n * Copyright 2016 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Number input field\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.FieldNumber\r\n\r\nimport {Field} from './field.js';\r\nimport * as fieldRegistry from './field_registry.js';\r\nimport {\r\n  FieldInput,\r\n  FieldInputConfig,\r\n  FieldInputValidator,\r\n} from './field_input.js';\r\nimport * as aria from './utils/aria.js';\r\n\r\n/**\r\n * Class for an editable number field.\r\n */\r\nexport class FieldNumber extends FieldInput<number> {\r\n  /** The minimum value this number field can contain. */\r\n  protected min_ = -Infinity;\r\n\r\n  /** The maximum value this number field can contain. */\r\n  protected max_ = Infinity;\r\n\r\n  /** The multiple to which this fields value is rounded. */\r\n  protected precision_ = 0;\r\n\r\n  /**\r\n   * The number of decimal places to allow, or null to allow any number of\r\n   * decimal digits.\r\n   */\r\n  private decimalPlaces: number | null = null;\r\n\r\n  /** Don't spellcheck numbers.  Our validator does a better job. */\r\n  protected override spellcheck_ = false;\r\n\r\n  /**\r\n   * @param value The initial value of the field. Should cast to a number.\r\n   *     Defaults to 0. Also accepts Field.SKIP_SETUP if you wish to skip setup\r\n   *     (only used by subclasses that want to handle configuration and setting\r\n   *     the field value after their own constructors have run).\r\n   * @param min Minimum value. Will only be used if config is not\r\n   *     provided.\r\n   * @param max Maximum value. Will only be used if config is not\r\n   *     provided.\r\n   * @param precision Precision for value. Will only be used if config\r\n   *     is not provided.\r\n   * @param validator A function that is called to validate changes to the\r\n   *     field's value. Takes in a number & returns a validated number, or null\r\n   *     to abort the change.\r\n   * @param config A map of options used to configure the field.\r\n   *     See the [field creation documentation]{@link\r\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/number#creation}\r\n   * for a list of properties this parameter supports.\r\n   */\r\n  constructor(\r\n    value?: string | number | typeof Field.SKIP_SETUP,\r\n    min?: string | number | null,\r\n    max?: string | number | null,\r\n    precision?: string | number | null,\r\n    validator?: FieldNumberValidator | null,\r\n    config?: FieldNumberConfig,\r\n  ) {\r\n    // Pass SENTINEL so that we can define properties before value validation.\r\n    super(Field.SKIP_SETUP);\r\n\r\n    if (value === Field.SKIP_SETUP) return;\r\n    if (config) {\r\n      this.configure_(config);\r\n    } else {\r\n      this.setConstraints(min, max, precision);\r\n    }\r\n    this.setValue(value);\r\n    if (validator) {\r\n      this.setValidator(validator);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Configure the field based on the given map of options.\r\n   *\r\n   * @param config A map of options to configure the field based on.\r\n   */\r\n  protected override configure_(config: FieldNumberConfig) {\r\n    super.configure_(config);\r\n    this.setMinInternal(config.min);\r\n    this.setMaxInternal(config.max);\r\n    this.setPrecisionInternal(config.precision);\r\n  }\r\n\r\n  /**\r\n   * Set the maximum, minimum and precision constraints on this field.\r\n   * Any of these properties may be undefined or NaN to be disabled.\r\n   * Setting precision (usually a power of 10) enforces a minimum step between\r\n   * values. That is, the user's value will rounded to the closest multiple of\r\n   * precision. The least significant digit place is inferred from the\r\n   * precision. Integers values can be enforces by choosing an integer\r\n   * precision.\r\n   *\r\n   * @param min Minimum value.\r\n   * @param max Maximum value.\r\n   * @param precision Precision for value.\r\n   */\r\n  setConstraints(\r\n    min: number | string | undefined | null,\r\n    max: number | string | undefined | null,\r\n    precision: number | string | undefined | null,\r\n  ) {\r\n    this.setMinInternal(min);\r\n    this.setMaxInternal(max);\r\n    this.setPrecisionInternal(precision);\r\n    this.setValue(this.getValue());\r\n  }\r\n\r\n  /**\r\n   * Sets the minimum value this field can contain. Updates the value to\r\n   * reflect.\r\n   *\r\n   * @param min Minimum value.\r\n   */\r\n  setMin(min: number | string | undefined | null) {\r\n    this.setMinInternal(min);\r\n    this.setValue(this.getValue());\r\n  }\r\n\r\n  /**\r\n   * Sets the minimum value this field can contain. Called internally to avoid\r\n   * value updates.\r\n   *\r\n   * @param min Minimum value.\r\n   */\r\n  private setMinInternal(min: number | string | undefined | null) {\r\n    if (min == null) {\r\n      this.min_ = -Infinity;\r\n    } else {\r\n      min = Number(min);\r\n      if (!isNaN(min)) {\r\n        this.min_ = min;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns the current minimum value this field can contain. Default is\r\n   * -Infinity.\r\n   *\r\n   * @returns The current minimum value this field can contain.\r\n   */\r\n  getMin(): number {\r\n    return this.min_;\r\n  }\r\n\r\n  /**\r\n   * Sets the maximum value this field can contain. Updates the value to\r\n   * reflect.\r\n   *\r\n   * @param max Maximum value.\r\n   */\r\n  setMax(max: number | string | undefined | null) {\r\n    this.setMaxInternal(max);\r\n    this.setValue(this.getValue());\r\n  }\r\n\r\n  /**\r\n   * Sets the maximum value this field can contain. Called internally to avoid\r\n   * value updates.\r\n   *\r\n   * @param max Maximum value.\r\n   */\r\n  private setMaxInternal(max: number | string | undefined | null) {\r\n    if (max == null) {\r\n      this.max_ = Infinity;\r\n    } else {\r\n      max = Number(max);\r\n      if (!isNaN(max)) {\r\n        this.max_ = max;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns the current maximum value this field can contain. Default is\r\n   * Infinity.\r\n   *\r\n   * @returns The current maximum value this field can contain.\r\n   */\r\n  getMax(): number {\r\n    return this.max_;\r\n  }\r\n\r\n  /**\r\n   * Sets the precision of this field's value, i.e. the number to which the\r\n   * value is rounded. Updates the field to reflect.\r\n   *\r\n   * @param precision The number to which the field's value is rounded.\r\n   */\r\n  setPrecision(precision: number | string | undefined | null) {\r\n    this.setPrecisionInternal(precision);\r\n    this.setValue(this.getValue());\r\n  }\r\n\r\n  /**\r\n   * Sets the precision of this field's value. Called internally to avoid\r\n   * value updates.\r\n   *\r\n   * @param precision The number to which the field's value is rounded.\r\n   */\r\n  private setPrecisionInternal(precision: number | string | undefined | null) {\r\n    this.precision_ = Number(precision) || 0;\r\n    let precisionString = String(this.precision_);\r\n    if (precisionString.indexOf('e') !== -1) {\r\n      // String() is fast.  But it turns .0000001 into '1e-7'.\r\n      // Use the much slower toLocaleString to access all the digits.\r\n      precisionString = this.precision_.toLocaleString('en-US', {\r\n        maximumFractionDigits: 20,\r\n      });\r\n    }\r\n    const decimalIndex = precisionString.indexOf('.');\r\n    if (decimalIndex === -1) {\r\n      // If the precision is 0 (float) allow any number of decimals,\r\n      // otherwise allow none.\r\n      this.decimalPlaces = precision ? 0 : null;\r\n    } else {\r\n      this.decimalPlaces = precisionString.length - decimalIndex - 1;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns the current precision of this field. The precision being the\r\n   * number to which the field's value is rounded. A precision of 0 means that\r\n   * the value is not rounded.\r\n   *\r\n   * @returns The number to which this field's value is rounded.\r\n   */\r\n  getPrecision(): number {\r\n    return this.precision_;\r\n  }\r\n\r\n  /**\r\n   * Ensure that the input value is a valid number (must fulfill the\r\n   * constraints placed on the field).\r\n   *\r\n   * @param newValue The input value.\r\n   * @returns A valid number, or null if invalid.\r\n   */\r\n  protected override doClassValidation_(\r\n    newValue?: AnyDuringMigration,\r\n  ): number | null {\r\n    if (newValue === null) {\r\n      return null;\r\n    }\r\n\r\n    // Clean up text.\r\n    newValue = `${newValue}`;\r\n    // TODO: Handle cases like 'ten', '1.203,14', etc.\r\n    // 'O' is sometimes mistaken for '0' by inexperienced users.\r\n    newValue = newValue.replace(/O/gi, '0');\r\n    // Strip out thousands separators.\r\n    newValue = newValue.replace(/,/g, '');\r\n    // Ignore case of 'Infinity'.\r\n    newValue = newValue.replace(/infinity/i, 'Infinity');\r\n\r\n    // Clean up number.\r\n    let n = Number(newValue || 0);\r\n    if (isNaN(n)) {\r\n      // Invalid number.\r\n      return null;\r\n    }\r\n    // Get the value in range.\r\n    n = Math.min(Math.max(n, this.min_), this.max_);\r\n    // Round to nearest multiple of precision.\r\n    if (this.precision_ && isFinite(n)) {\r\n      n = Math.round(n / this.precision_) * this.precision_;\r\n    }\r\n    // Clean up floating point errors.\r\n    if (this.decimalPlaces !== null) {\r\n      n = Number(n.toFixed(this.decimalPlaces));\r\n    }\r\n    return n;\r\n  }\r\n\r\n  /**\r\n   * Create the number input editor widget.\r\n   *\r\n   * @returns The newly created number input editor.\r\n   */\r\n  protected override widgetCreate_(): HTMLInputElement {\r\n    const htmlInput = super.widgetCreate_() as HTMLInputElement;\r\n\r\n    // Set the accessibility state\r\n    if (this.min_ > -Infinity) {\r\n      htmlInput.min = `${this.min_}`;\r\n      aria.setState(htmlInput, aria.State.VALUEMIN, this.min_);\r\n    }\r\n    if (this.max_ < Infinity) {\r\n      htmlInput.max = `${this.max_}`;\r\n      aria.setState(htmlInput, aria.State.VALUEMAX, this.max_);\r\n    }\r\n    return htmlInput;\r\n  }\r\n\r\n  /**\r\n   * Construct a FieldNumber from a JSON arg object.\r\n   *\r\n   * @param options A JSON object with options (value, min, max, and precision).\r\n   * @returns The new field instance.\r\n   * @nocollapse\r\n   * @internal\r\n   */\r\n  static fromJson(options: FieldNumberFromJsonConfig): FieldNumber {\r\n    // `this` might be a subclass of FieldNumber if that class doesn't override\r\n    // the static fromJson method.\r\n    return new this(\r\n      options.value,\r\n      undefined,\r\n      undefined,\r\n      undefined,\r\n      undefined,\r\n      options,\r\n    );\r\n  }\r\n}\r\n\r\nfieldRegistry.register('field_number', FieldNumber);\r\n\r\nFieldNumber.prototype.DEFAULT_VALUE = 0;\r\n\r\n/**\r\n * Config options for the number field.\r\n */\r\nexport interface FieldNumberConfig extends FieldInputConfig {\r\n  min?: number;\r\n  max?: number;\r\n  precision?: number;\r\n}\r\n\r\n/**\r\n * fromJson config options for the number field.\r\n */\r\nexport interface FieldNumberFromJsonConfig extends FieldNumberConfig {\r\n  value?: number;\r\n}\r\n\r\n/**\r\n * A function that is called to validate changes to the field's value before\r\n * they are set.\r\n *\r\n * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/fields/validators#return_values}\r\n * @param newValue The value to be validated.\r\n * @returns One of three instructions for setting the new value: `T`, `null`,\r\n * or `undefined`.\r\n *\r\n * - `T` to set this function's returned value instead of `newValue`.\r\n *\r\n * - `null` to invoke `doValueInvalid_` and not set a value.\r\n *\r\n * - `undefined` to set `newValue` as is.\r\n */\r\nexport type FieldNumberValidator = FieldInputValidator<number>;\r\n","/**\r\n * @license\r\n * Copyright 2012 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Variable input field.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.FieldVariable\r\n\r\n// Unused import preserved for side-effects. Remove if unneeded.\r\nimport './events/events_block_change.js';\r\n\r\nimport type {Block} from './block.js';\r\nimport {Field, FieldConfig, UnattachedFieldError} from './field.js';\r\nimport {\r\n  FieldDropdown,\r\n  FieldDropdownValidator,\r\n  MenuGenerator,\r\n  MenuOption,\r\n} from './field_dropdown.js';\r\nimport * as fieldRegistry from './field_registry.js';\r\nimport * as internalConstants from './internal_constants.js';\r\nimport type {Menu} from './menu.js';\r\nimport type {MenuItem} from './menuitem.js';\r\nimport {Msg} from './msg.js';\r\nimport * as parsing from './utils/parsing.js';\r\nimport {Size} from './utils/size.js';\r\nimport {VariableModel} from './variable_model.js';\r\nimport * as Variables from './variables.js';\r\nimport * as Xml from './xml.js';\r\n\r\n/**\r\n * Class for a variable's dropdown field.\r\n */\r\nexport class FieldVariable extends FieldDropdown {\r\n  protected override menuGenerator_: MenuGenerator | undefined;\r\n  defaultVariableName: string;\r\n\r\n  /** The type of the default variable for this field. */\r\n  private defaultType = '';\r\n\r\n  /**\r\n   * All of the types of variables that will be available in this field's\r\n   * dropdown.\r\n   */\r\n  variableTypes: string[] | null = [];\r\n  protected override size_: Size;\r\n\r\n  /** The variable model associated with this field. */\r\n  private variable: VariableModel | null = null;\r\n\r\n  /**\r\n   * Serializable fields are saved by the serializer, non-serializable fields\r\n   * are not. Editable fields should also be serializable.\r\n   */\r\n  override SERIALIZABLE = true;\r\n\r\n  /**\r\n   * @param varName The default name for the variable.\r\n   *     If null, a unique variable name will be generated.\r\n   *     Also accepts Field.SKIP_SETUP if you wish to skip setup (only used by\r\n   * subclasses that want to handle configuration and setting the field value\r\n   * after their own constructors have run).\r\n   * @param validator A function that is called to validate changes to the\r\n   *     field's value. Takes in a variable ID  & returns a validated variable\r\n   *     ID, or null to abort the change.\r\n   * @param variableTypes A list of the types of variables to include in the\r\n   *     dropdown. Will only be used if config is not provided.\r\n   * @param defaultType The type of variable to create if this field's value\r\n   *     is not explicitly set.  Defaults to ''. Will only be used if config\r\n   *     is not provided.\r\n   * @param config A map of options used to configure the field.\r\n   *    See the [field creation documentation]{@link\r\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/variable#creation}\r\n   * for a list of properties this parameter supports.\r\n   */\r\n  constructor(\r\n    varName: string | null | typeof Field.SKIP_SETUP,\r\n    validator?: FieldVariableValidator,\r\n    variableTypes?: string[],\r\n    defaultType?: string,\r\n    config?: FieldVariableConfig,\r\n  ) {\r\n    super(Field.SKIP_SETUP);\r\n\r\n    /**\r\n     * An array of options for a dropdown list,\r\n     * or a function which generates these options.\r\n     */\r\n    this.menuGenerator_ = FieldVariable.dropdownCreate as MenuGenerator;\r\n\r\n    /**\r\n     * The initial variable name passed to this field's constructor, or an\r\n     * empty string if a name wasn't provided. Used to create the initial\r\n     * variable.\r\n     */\r\n    this.defaultVariableName = typeof varName === 'string' ? varName : '';\r\n\r\n    /** The size of the area rendered by the field. */\r\n    this.size_ = new Size(0, 0);\r\n\r\n    if (varName === Field.SKIP_SETUP) return;\r\n\r\n    if (config) {\r\n      this.configure_(config);\r\n    } else {\r\n      this.setTypes(variableTypes, defaultType);\r\n    }\r\n    if (validator) {\r\n      this.setValidator(validator);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Configure the field based on the given map of options.\r\n   *\r\n   * @param config A map of options to configure the field based on.\r\n   */\r\n  protected override configure_(config: FieldVariableConfig) {\r\n    super.configure_(config);\r\n    this.setTypes(config.variableTypes, config.defaultType);\r\n  }\r\n\r\n  /**\r\n   * Initialize the model for this field if it has not already been initialized.\r\n   * If the value has not been set to a variable by the first render, we make up\r\n   * a variable rather than let the value be invalid.\r\n   */\r\n  override initModel() {\r\n    const block = this.getSourceBlock();\r\n    if (!block) {\r\n      throw new UnattachedFieldError();\r\n    }\r\n    if (this.variable) {\r\n      return; // Initialization already happened.\r\n    }\r\n    const variable = Variables.getOrCreateVariablePackage(\r\n      block.workspace,\r\n      null,\r\n      this.defaultVariableName,\r\n      this.defaultType,\r\n    );\r\n    // Don't call setValue because we don't want to cause a rerender.\r\n    this.doValueUpdate_(variable.getId());\r\n  }\r\n\r\n  override shouldAddBorderRect_() {\r\n    const block = this.getSourceBlock();\r\n    if (!block) {\r\n      throw new UnattachedFieldError();\r\n    }\r\n    return (\r\n      super.shouldAddBorderRect_() &&\r\n      (!this.getConstants()!.FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW ||\r\n        block.type !== 'variables_get')\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Initialize this field based on the given XML.\r\n   *\r\n   * @param fieldElement The element containing information about the variable\r\n   *     field's state.\r\n   */\r\n  override fromXml(fieldElement: Element) {\r\n    const block = this.getSourceBlock();\r\n    if (!block) {\r\n      throw new UnattachedFieldError();\r\n    }\r\n    const id = fieldElement.getAttribute('id');\r\n    const variableName = fieldElement.textContent;\r\n    // 'variabletype' should be lowercase, but until July 2019 it was sometimes\r\n    // recorded as 'variableType'.  Thus we need to check for both.\r\n    const variableType =\r\n      fieldElement.getAttribute('variabletype') ||\r\n      fieldElement.getAttribute('variableType') ||\r\n      '';\r\n\r\n    // AnyDuringMigration because:  Argument of type 'string | null' is not\r\n    // assignable to parameter of type 'string | undefined'.\r\n    const variable = Variables.getOrCreateVariablePackage(\r\n      block.workspace,\r\n      id,\r\n      variableName as AnyDuringMigration,\r\n      variableType,\r\n    );\r\n\r\n    // This should never happen :)\r\n    if (variableType !== null && variableType !== variable.type) {\r\n      throw Error(\r\n        \"Serialized variable type with id '\" +\r\n          variable.getId() +\r\n          \"' had type \" +\r\n          variable.type +\r\n          ', and ' +\r\n          'does not match variable field that references it: ' +\r\n          Xml.domToText(fieldElement) +\r\n          '.',\r\n      );\r\n    }\r\n\r\n    this.setValue(variable.getId());\r\n  }\r\n\r\n  /**\r\n   * Serialize this field to XML.\r\n   *\r\n   * @param fieldElement The element to populate with info about the field's\r\n   *     state.\r\n   * @returns The element containing info about the field's state.\r\n   */\r\n  override toXml(fieldElement: Element): Element {\r\n    // Make sure the variable is initialized.\r\n    this.initModel();\r\n\r\n    fieldElement.id = this.variable!.getId();\r\n    fieldElement.textContent = this.variable!.name;\r\n    if (this.variable!.type) {\r\n      fieldElement.setAttribute('variabletype', this.variable!.type);\r\n    }\r\n    return fieldElement;\r\n  }\r\n\r\n  /**\r\n   * Saves this field's value.\r\n   *\r\n   * @param doFullSerialization If true, the variable field will serialize the\r\n   *     full state of the field being referenced (ie ID, name, and type) rather\r\n   *     than just a reference to it (ie ID).\r\n   * @returns The state of the variable field.\r\n   * @internal\r\n   */\r\n  override saveState(doFullSerialization?: boolean): AnyDuringMigration {\r\n    const legacyState = this.saveLegacyState(FieldVariable);\r\n    if (legacyState !== null) {\r\n      return legacyState;\r\n    }\r\n    // Make sure the variable is initialized.\r\n    this.initModel();\r\n    const state = {'id': this.variable!.getId()};\r\n    if (doFullSerialization) {\r\n      (state as AnyDuringMigration)['name'] = this.variable!.name;\r\n      (state as AnyDuringMigration)['type'] = this.variable!.type;\r\n    }\r\n    return state;\r\n  }\r\n\r\n  /**\r\n   * Sets the field's value based on the given state.\r\n   *\r\n   * @param state The state of the variable to assign to this variable field.\r\n   * @internal\r\n   */\r\n  override loadState(state: AnyDuringMigration) {\r\n    const block = this.getSourceBlock();\r\n    if (!block) {\r\n      throw new UnattachedFieldError();\r\n    }\r\n    if (this.loadLegacyState(FieldVariable, state)) {\r\n      return;\r\n    }\r\n    // This is necessary so that blocks in the flyout can have custom var names.\r\n    const variable = Variables.getOrCreateVariablePackage(\r\n      block.workspace,\r\n      state['id'] || null,\r\n      state['name'],\r\n      state['type'] || '',\r\n    );\r\n    this.setValue(variable.getId());\r\n  }\r\n\r\n  /**\r\n   * Attach this field to a block.\r\n   *\r\n   * @param block The block containing this field.\r\n   */\r\n  override setSourceBlock(block: Block) {\r\n    if (block.isShadow()) {\r\n      throw Error('Variable fields are not allowed to exist on shadow blocks.');\r\n    }\r\n    super.setSourceBlock(block);\r\n  }\r\n\r\n  /**\r\n   * Get the variable's ID.\r\n   *\r\n   * @returns Current variable's ID.\r\n   */\r\n  override getValue(): string | null {\r\n    return this.variable ? this.variable.getId() : null;\r\n  }\r\n\r\n  /**\r\n   * Get the text from this field, which is the selected variable's name.\r\n   *\r\n   * @returns The selected variable's name, or the empty string if no variable\r\n   *     is selected.\r\n   */\r\n  override getText(): string {\r\n    return this.variable ? this.variable.name : '';\r\n  }\r\n\r\n  /**\r\n   * Get the variable model for the selected variable.\r\n   * Not guaranteed to be in the variable map on the workspace (e.g. if accessed\r\n   * after the variable has been deleted).\r\n   *\r\n   * @returns The selected variable, or null if none was selected.\r\n   * @internal\r\n   */\r\n  getVariable(): VariableModel | null {\r\n    return this.variable;\r\n  }\r\n\r\n  /**\r\n   * Gets the validation function for this field, or null if not set.\r\n   * Returns null if the variable is not set, because validators should not\r\n   * run on the initial setValue call, because the field won't be attached to\r\n   * a block and workspace at that point.\r\n   *\r\n   * @returns Validation function, or null.\r\n   */\r\n  override getValidator(): FieldVariableValidator | null {\r\n    // Validators shouldn't operate on the initial setValue call.\r\n    // Normally this is achieved by calling setValidator after setValue, but\r\n    // this is not a possibility with variable fields.\r\n    if (this.variable) {\r\n      return this.validator_;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Ensure that the ID belongs to a valid variable of an allowed type.\r\n   *\r\n   * @param newValue The ID of the new variable to set.\r\n   * @returns The validated ID, or null if invalid.\r\n   */\r\n  protected override doClassValidation_(\r\n    newValue?: AnyDuringMigration,\r\n  ): string | null {\r\n    if (newValue === null) {\r\n      return null;\r\n    }\r\n    const block = this.getSourceBlock();\r\n    if (!block) {\r\n      throw new UnattachedFieldError();\r\n    }\r\n    const newId = newValue as string;\r\n    const variable = Variables.getVariable(block.workspace, newId);\r\n    if (!variable) {\r\n      console.warn(\r\n        \"Variable id doesn't point to a real variable! \" + 'ID was ' + newId,\r\n      );\r\n      return null;\r\n    }\r\n    // Type Checks.\r\n    const type = variable.type;\r\n    if (!this.typeIsAllowed(type)) {\r\n      console.warn(\"Variable type doesn't match this field!  Type was \" + type);\r\n      return null;\r\n    }\r\n    return newId;\r\n  }\r\n\r\n  /**\r\n   * Update the value of this variable field, as well as its variable and text.\r\n   *\r\n   * The variable ID should be valid at this point, but if a variable field\r\n   * validator returns a bad ID, this could break.\r\n   *\r\n   * @param newId The value to be saved.\r\n   */\r\n  protected override doValueUpdate_(newId: string) {\r\n    const block = this.getSourceBlock();\r\n    if (!block) {\r\n      throw new UnattachedFieldError();\r\n    }\r\n    this.variable = Variables.getVariable(block.workspace, newId as string);\r\n    super.doValueUpdate_(newId);\r\n  }\r\n\r\n  /**\r\n   * Check whether the given variable type is allowed on this field.\r\n   *\r\n   * @param type The type to check.\r\n   * @returns True if the type is in the list of allowed types.\r\n   */\r\n  private typeIsAllowed(type: string): boolean {\r\n    const typeList = this.getVariableTypes();\r\n    if (!typeList) {\r\n      return true; // If it's null, all types are valid.\r\n    }\r\n    for (let i = 0; i < typeList.length; i++) {\r\n      if (type === typeList[i]) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Return a list of variable types to include in the dropdown.\r\n   *\r\n   * @returns Array of variable types.\r\n   * @throws {Error} if variableTypes is an empty array.\r\n   */\r\n  private getVariableTypes(): string[] {\r\n    let variableTypes = this.variableTypes;\r\n    if (variableTypes === null) {\r\n      // If variableTypes is null, return all variable types.\r\n      if (this.sourceBlock_ && !this.sourceBlock_.isDeadOrDying()) {\r\n        return this.sourceBlock_.workspace.getVariableTypes();\r\n      }\r\n    }\r\n    variableTypes = variableTypes || [''];\r\n    if (variableTypes.length === 0) {\r\n      // Throw an error if variableTypes is an empty list.\r\n      const name = this.getText();\r\n      throw Error(\r\n        \"'variableTypes' of field variable \" + name + ' was an empty list',\r\n      );\r\n    }\r\n    return variableTypes;\r\n  }\r\n\r\n  /**\r\n   * Parse the optional arguments representing the allowed variable types and\r\n   * the default variable type.\r\n   *\r\n   * @param variableTypes A list of the types of variables to include in the\r\n   *     dropdown.  If null or undefined, variables of all types will be\r\n   *     displayed in the dropdown.\r\n   * @param defaultType The type of the variable to create if this field's\r\n   *     value is not explicitly set.  Defaults to ''.\r\n   */\r\n  private setTypes(variableTypes: string[] | null = null, defaultType = '') {\r\n    // If you expected that the default type would be the same as the only entry\r\n    // in the variable types array, tell the Blockly team by commenting on\r\n    // #1499.\r\n    // Set the allowable variable types.  Null means all types on the workspace.\r\n    if (Array.isArray(variableTypes)) {\r\n      variableTypes = variableTypes;\r\n      // Make sure the default type is valid.\r\n      let isInArray = false;\r\n      for (let i = 0; i < variableTypes.length; i++) {\r\n        if (variableTypes[i] === defaultType) {\r\n          isInArray = true;\r\n        }\r\n      }\r\n      if (!isInArray) {\r\n        throw Error(\r\n          \"Invalid default type '\" +\r\n            defaultType +\r\n            \"' in \" +\r\n            'the definition of a FieldVariable',\r\n        );\r\n      }\r\n    } else if (variableTypes !== null) {\r\n      throw Error(\r\n        \"'variableTypes' was not an array in the definition of \" +\r\n          'a FieldVariable',\r\n      );\r\n    }\r\n    // Only update the field once all checks pass.\r\n    this.defaultType = defaultType;\r\n    this.variableTypes = variableTypes;\r\n  }\r\n\r\n  /**\r\n   * Refreshes the name of the variable by grabbing the name of the model.\r\n   * Used when a variable gets renamed, but the ID stays the same. Should only\r\n   * be called by the block.\r\n   *\r\n   * @internal\r\n   */\r\n  override refreshVariableName() {\r\n    this.forceRerender();\r\n  }\r\n\r\n  /**\r\n   * Handle the selection of an item in the variable dropdown menu.\r\n   * Special case the 'Rename variable...' and 'Delete variable...' options.\r\n   * In the rename case, prompt the user for a new name.\r\n   *\r\n   * @param menu The Menu component clicked.\r\n   * @param menuItem The MenuItem selected within menu.\r\n   */\r\n  protected override onItemSelected_(menu: Menu, menuItem: MenuItem) {\r\n    const id = menuItem.getValue();\r\n    // Handle special cases.\r\n    if (this.sourceBlock_ && !this.sourceBlock_.isDeadOrDying()) {\r\n      if (id === internalConstants.RENAME_VARIABLE_ID) {\r\n        // Rename variable.\r\n        Variables.renameVariable(\r\n          this.sourceBlock_.workspace,\r\n          this.variable as VariableModel,\r\n        );\r\n        return;\r\n      } else if (id === internalConstants.DELETE_VARIABLE_ID) {\r\n        // Delete variable.\r\n        this.sourceBlock_.workspace.deleteVariableById(this.variable!.getId());\r\n        return;\r\n      }\r\n    }\r\n    // Handle unspecial case.\r\n    this.setValue(id);\r\n  }\r\n\r\n  /**\r\n   * Overrides referencesVariables(), indicating this field refers to a\r\n   * variable.\r\n   *\r\n   * @returns True.\r\n   * @internal\r\n   */\r\n  override referencesVariables(): boolean {\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Construct a FieldVariable from a JSON arg object,\r\n   * dereferencing any string table references.\r\n   *\r\n   * @param options A JSON object with options (variable, variableTypes, and\r\n   *     defaultType).\r\n   * @returns The new field instance.\r\n   * @nocollapse\r\n   * @internal\r\n   */\r\n  static override fromJson(\r\n    options: FieldVariableFromJsonConfig,\r\n  ): FieldVariable {\r\n    const varName = parsing.replaceMessageReferences(options.variable);\r\n    // `this` might be a subclass of FieldVariable if that class doesn't\r\n    // override the static fromJson method.\r\n    return new this(varName, undefined, undefined, undefined, options);\r\n  }\r\n\r\n  /**\r\n   * Return a sorted list of variable names for variable dropdown menus.\r\n   * Include a special option at the end for creating a new variable name.\r\n   *\r\n   * @returns Array of variable names/id tuples.\r\n   */\r\n  static dropdownCreate(this: FieldVariable): MenuOption[] {\r\n    if (!this.variable) {\r\n      throw Error(\r\n        'Tried to call dropdownCreate on a variable field with no' +\r\n          ' variable selected.',\r\n      );\r\n    }\r\n    const name = this.getText();\r\n    let variableModelList: VariableModel[] = [];\r\n    if (this.sourceBlock_ && !this.sourceBlock_.isDeadOrDying()) {\r\n      const variableTypes = this.getVariableTypes();\r\n      // Get a copy of the list, so that adding rename and new variable options\r\n      // doesn't modify the workspace's list.\r\n      for (let i = 0; i < variableTypes.length; i++) {\r\n        const variableType = variableTypes[i];\r\n        const variables =\r\n          this.sourceBlock_.workspace.getVariablesOfType(variableType);\r\n        variableModelList = variableModelList.concat(variables);\r\n      }\r\n    }\r\n    variableModelList.sort(VariableModel.compareByName);\r\n\r\n    const options: [string, string][] = [];\r\n    for (let i = 0; i < variableModelList.length; i++) {\r\n      // Set the UUID as the internal representation of the variable.\r\n      options[i] = [variableModelList[i].name, variableModelList[i].getId()];\r\n    }\r\n    options.push([\r\n      Msg['RENAME_VARIABLE'],\r\n      internalConstants.RENAME_VARIABLE_ID,\r\n    ]);\r\n    if (Msg['DELETE_VARIABLE']) {\r\n      options.push([\r\n        Msg['DELETE_VARIABLE'].replace('%1', name),\r\n        internalConstants.DELETE_VARIABLE_ID,\r\n      ]);\r\n    }\r\n\r\n    return options;\r\n  }\r\n}\r\n\r\nfieldRegistry.register('field_variable', FieldVariable);\r\n\r\n/**\r\n * Config options for the variable field.\r\n */\r\nexport interface FieldVariableConfig extends FieldConfig {\r\n  variableTypes?: string[];\r\n  defaultType?: string;\r\n}\r\n\r\n/**\r\n * fromJson config options for the variable field.\r\n */\r\nexport interface FieldVariableFromJsonConfig extends FieldVariableConfig {\r\n  variable?: string;\r\n}\r\n\r\n/**\r\n * A function that is called to validate changes to the field's value before\r\n * they are set.\r\n *\r\n * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/fields/validators#return_values}\r\n * @param newValue The value to be validated.\r\n * @returns One of three instructions for setting the new value: `T`, `null`,\r\n * or `undefined`.\r\n *\r\n * - `T` to set this function's returned value instead of `newValue`.\r\n *\r\n * - `null` to invoke `doValueInvalid_` and not set a value.\r\n *\r\n * - `undefined` to set `newValue` as is.\r\n */\r\nexport type FieldVariableValidator = FieldDropdownValidator;\r\n","/**\r\n * @license\r\n * Copyright 2016 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Class for a button in the flyout.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.FlyoutButton\r\n\r\nimport * as browserEvents from './browser_events.js';\r\nimport * as Css from './css.js';\r\nimport {Coordinate} from './utils/coordinate.js';\r\nimport * as dom from './utils/dom.js';\r\nimport * as parsing from './utils/parsing.js';\r\nimport * as style from './utils/style.js';\r\nimport {Svg} from './utils/svg.js';\r\nimport type * as toolbox from './utils/toolbox.js';\r\nimport type {WorkspaceSvg} from './workspace_svg.js';\r\n\r\n/**\r\n * Class for a button or label in the flyout.\r\n */\r\nexport class FlyoutButton {\r\n  /** The horizontal margin around the text in the button. */\r\n  static TEXT_MARGIN_X = 5;\r\n\r\n  /** The vertical margin around the text in the button. */\r\n  static TEXT_MARGIN_Y = 2;\r\n\r\n  /** The radius of the flyout button's borders. */\r\n  static BORDER_RADIUS = 4;\r\n\r\n  private readonly text: string;\r\n  private readonly position: Coordinate;\r\n  private readonly callbackKey: string;\r\n  private readonly cssClass: string | null;\r\n\r\n  /** Mouse up event data. */\r\n  private onMouseUpWrapper: browserEvents.Data | null = null;\r\n  info: toolbox.ButtonOrLabelInfo;\r\n\r\n  /** The width of the button's rect. */\r\n  width = 0;\r\n\r\n  /** The height of the button's rect. */\r\n  height = 0;\r\n\r\n  /** The root SVG group for the button or label. */\r\n  private svgGroup: SVGGElement | null = null;\r\n\r\n  /** The SVG element with the text of the label or button. */\r\n  private svgText: SVGTextElement | null = null;\r\n\r\n  /**\r\n   * @param workspace The workspace in which to place this button.\r\n   * @param targetWorkspace The flyout's target workspace.\r\n   * @param json The JSON specifying the label/button.\r\n   * @param isLabel_ Whether this button should be styled as a label.\r\n   * @internal\r\n   */\r\n  constructor(\r\n    private readonly workspace: WorkspaceSvg,\r\n    private readonly targetWorkspace: WorkspaceSvg,\r\n    json: toolbox.ButtonOrLabelInfo,\r\n    private readonly isLabel_: boolean,\r\n  ) {\r\n    this.text = json['text'];\r\n\r\n    this.position = new Coordinate(0, 0);\r\n\r\n    /** The key to the function called when this button is clicked. */\r\n    this.callbackKey =\r\n      (json as AnyDuringMigration)[\r\n        'callbackKey'\r\n      ] /* Check the lower case version\r\n                                                   too to satisfy IE */ ||\r\n      (json as AnyDuringMigration)['callbackkey'];\r\n\r\n    /** If specified, a CSS class to add to this button. */\r\n    this.cssClass = (json as AnyDuringMigration)['web-class'] || null;\r\n\r\n    /** The JSON specifying the label / button. */\r\n    this.info = json;\r\n  }\r\n\r\n  /**\r\n   * Create the button elements.\r\n   *\r\n   * @returns The button's SVG group.\r\n   */\r\n  createDom(): SVGElement {\r\n    let cssClass = this.isLabel_ ? 'blocklyFlyoutLabel' : 'blocklyFlyoutButton';\r\n    if (this.cssClass) {\r\n      cssClass += ' ' + this.cssClass;\r\n    }\r\n\r\n    this.svgGroup = dom.createSvgElement(\r\n      Svg.G,\r\n      {'class': cssClass},\r\n      this.workspace.getCanvas(),\r\n    );\r\n\r\n    let shadow;\r\n    if (!this.isLabel_) {\r\n      // Shadow rectangle (light source does not mirror in RTL).\r\n      shadow = dom.createSvgElement(\r\n        Svg.RECT,\r\n        {\r\n          'class': 'blocklyFlyoutButtonShadow',\r\n          'rx': FlyoutButton.BORDER_RADIUS,\r\n          'ry': FlyoutButton.BORDER_RADIUS,\r\n          'x': 1,\r\n          'y': 1,\r\n        },\r\n        this.svgGroup!,\r\n      );\r\n    }\r\n    // Background rectangle.\r\n    const rect = dom.createSvgElement(\r\n      Svg.RECT,\r\n      {\r\n        'class': this.isLabel_\r\n          ? 'blocklyFlyoutLabelBackground'\r\n          : 'blocklyFlyoutButtonBackground',\r\n        'rx': FlyoutButton.BORDER_RADIUS,\r\n        'ry': FlyoutButton.BORDER_RADIUS,\r\n      },\r\n      this.svgGroup!,\r\n    );\r\n\r\n    const svgText = dom.createSvgElement(\r\n      Svg.TEXT,\r\n      {\r\n        'class': this.isLabel_ ? 'blocklyFlyoutLabelText' : 'blocklyText',\r\n        'x': 0,\r\n        'y': 0,\r\n        'text-anchor': 'middle',\r\n      },\r\n      this.svgGroup!,\r\n    );\r\n    let text = parsing.replaceMessageReferences(this.text);\r\n    if (this.workspace.RTL) {\r\n      // Force text to be RTL by adding an RLM.\r\n      text += '\\u200F';\r\n    }\r\n    svgText.textContent = text;\r\n    if (this.isLabel_) {\r\n      this.svgText = svgText;\r\n      this.workspace\r\n        .getThemeManager()\r\n        .subscribe(this.svgText, 'flyoutForegroundColour', 'fill');\r\n    }\r\n\r\n    const fontSize = style.getComputedStyle(svgText, 'fontSize');\r\n    const fontWeight = style.getComputedStyle(svgText, 'fontWeight');\r\n    const fontFamily = style.getComputedStyle(svgText, 'fontFamily');\r\n    this.width = dom.getFastTextWidthWithSizeString(\r\n      svgText,\r\n      fontSize,\r\n      fontWeight,\r\n      fontFamily,\r\n    );\r\n    const fontMetrics = dom.measureFontMetrics(\r\n      text,\r\n      fontSize,\r\n      fontWeight,\r\n      fontFamily,\r\n    );\r\n    this.height = fontMetrics.height;\r\n\r\n    if (!this.isLabel_) {\r\n      this.width += 2 * FlyoutButton.TEXT_MARGIN_X;\r\n      this.height += 2 * FlyoutButton.TEXT_MARGIN_Y;\r\n      shadow?.setAttribute('width', String(this.width));\r\n      shadow?.setAttribute('height', String(this.height));\r\n    }\r\n    rect.setAttribute('width', String(this.width));\r\n    rect.setAttribute('height', String(this.height));\r\n\r\n    svgText.setAttribute('x', String(this.width / 2));\r\n    svgText.setAttribute(\r\n      'y',\r\n      String(this.height / 2 - fontMetrics.height / 2 + fontMetrics.baseline),\r\n    );\r\n\r\n    this.updateTransform();\r\n\r\n    // AnyDuringMigration because:  Argument of type 'SVGGElement | null' is not\r\n    // assignable to parameter of type 'EventTarget'.\r\n    this.onMouseUpWrapper = browserEvents.conditionalBind(\r\n      this.svgGroup as AnyDuringMigration,\r\n      'pointerup',\r\n      this,\r\n      this.onMouseUp,\r\n    );\r\n    return this.svgGroup!;\r\n  }\r\n\r\n  /** Correctly position the flyout button and make it visible. */\r\n  show() {\r\n    this.updateTransform();\r\n    this.svgGroup!.setAttribute('display', 'block');\r\n  }\r\n\r\n  /** Update SVG attributes to match internal state. */\r\n  private updateTransform() {\r\n    this.svgGroup!.setAttribute(\r\n      'transform',\r\n      'translate(' + this.position.x + ',' + this.position.y + ')',\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Move the button to the given x, y coordinates.\r\n   *\r\n   * @param x The new x coordinate.\r\n   * @param y The new y coordinate.\r\n   */\r\n  moveTo(x: number, y: number) {\r\n    this.position.x = x;\r\n    this.position.y = y;\r\n    this.updateTransform();\r\n  }\r\n\r\n  /** @returns Whether or not the button is a label. */\r\n  isLabel(): boolean {\r\n    return this.isLabel_;\r\n  }\r\n\r\n  /**\r\n   * Location of the button.\r\n   *\r\n   * @returns x, y coordinates.\r\n   * @internal\r\n   */\r\n  getPosition(): Coordinate {\r\n    return this.position;\r\n  }\r\n\r\n  /** @returns Text of the button. */\r\n  getButtonText(): string {\r\n    return this.text;\r\n  }\r\n\r\n  /**\r\n   * Get the button's target workspace.\r\n   *\r\n   * @returns The target workspace of the flyout where this button resides.\r\n   */\r\n  getTargetWorkspace(): WorkspaceSvg {\r\n    return this.targetWorkspace;\r\n  }\r\n\r\n  /** Dispose of this button. */\r\n  dispose() {\r\n    if (this.onMouseUpWrapper) {\r\n      browserEvents.unbind(this.onMouseUpWrapper);\r\n    }\r\n    if (this.svgGroup) {\r\n      dom.removeNode(this.svgGroup);\r\n    }\r\n    if (this.svgText) {\r\n      this.workspace.getThemeManager().unsubscribe(this.svgText);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Do something when the button is clicked.\r\n   *\r\n   * @param e Pointer up event.\r\n   */\r\n  private onMouseUp(e: PointerEvent) {\r\n    const gesture = this.targetWorkspace.getGesture(e);\r\n    if (gesture) {\r\n      gesture.cancel();\r\n    }\r\n\r\n    if (this.isLabel_ && this.callbackKey) {\r\n      console.warn(\r\n        'Labels should not have callbacks. Label text: ' + this.text,\r\n      );\r\n    } else if (\r\n      !this.isLabel_ &&\r\n      !(\r\n        this.callbackKey &&\r\n        this.targetWorkspace.getButtonCallback(this.callbackKey)\r\n      )\r\n    ) {\r\n      console.warn('Buttons should have callbacks. Button text: ' + this.text);\r\n    } else if (!this.isLabel_) {\r\n      const callback = this.targetWorkspace.getButtonCallback(this.callbackKey);\r\n      if (callback) {\r\n        callback(this);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n/** CSS for buttons and labels. See css.js for use. */\r\nCss.register(`\r\n.blocklyFlyoutButton {\r\n  fill: #888;\r\n  cursor: default;\r\n}\r\n\r\n.blocklyFlyoutButtonShadow {\r\n  fill: #666;\r\n}\r\n\r\n.blocklyFlyoutButton:hover {\r\n  fill: #aaa;\r\n}\r\n\r\n.blocklyFlyoutLabel {\r\n  cursor: default;\r\n}\r\n\r\n.blocklyFlyoutLabelBackground {\r\n  opacity: 0;\r\n}\r\n`);\r\n","/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Calculates and reports flyout workspace metrics.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.FlyoutMetricsManager\r\n\r\nimport type {IFlyout} from './interfaces/i_flyout.js';\r\nimport {ContainerRegion, MetricsManager} from './metrics_manager.js';\r\nimport type {WorkspaceSvg} from './workspace_svg.js';\r\n\r\n/**\r\n * Calculates metrics for a flyout's workspace.\r\n * The metrics are mainly used to size scrollbars for the flyout.\r\n */\r\nexport class FlyoutMetricsManager extends MetricsManager {\r\n  /** The flyout that owns the workspace to calculate metrics for. */\r\n  protected flyout_: IFlyout;\r\n\r\n  /**\r\n   * @param workspace The flyout's workspace.\r\n   * @param flyout The flyout.\r\n   */\r\n  constructor(workspace: WorkspaceSvg, flyout: IFlyout) {\r\n    super(workspace);\r\n    this.flyout_ = flyout;\r\n  }\r\n\r\n  /**\r\n   * Gets the bounding box of the blocks on the flyout's workspace.\r\n   * This is in workspace coordinates.\r\n   *\r\n   * @returns The bounding box of the blocks on the workspace.\r\n   */\r\n  private getBoundingBox_():\r\n    | SVGRect\r\n    | {height: number; y: number; width: number; x: number} {\r\n    let blockBoundingBox;\r\n    try {\r\n      blockBoundingBox = this.workspace_.getCanvas().getBBox();\r\n    } catch (e) {\r\n      // Firefox has trouble with hidden elements (Bug 528969).\r\n      // 2021 Update: It looks like this was fixed around Firefox 77 released in\r\n      // 2020.\r\n      blockBoundingBox = {height: 0, y: 0, width: 0, x: 0};\r\n    }\r\n    return blockBoundingBox;\r\n  }\r\n\r\n  override getContentMetrics(opt_getWorkspaceCoordinates?: boolean) {\r\n    // The bounding box is in workspace coordinates.\r\n    const blockBoundingBox = this.getBoundingBox_();\r\n    const scale = opt_getWorkspaceCoordinates ? 1 : this.workspace_.scale;\r\n\r\n    return {\r\n      height: blockBoundingBox.height * scale,\r\n      width: blockBoundingBox.width * scale,\r\n      top: blockBoundingBox.y * scale,\r\n      left: blockBoundingBox.x * scale,\r\n    };\r\n  }\r\n\r\n  override getScrollMetrics(\r\n    opt_getWorkspaceCoordinates?: boolean,\r\n    opt_viewMetrics?: ContainerRegion,\r\n    opt_contentMetrics?: ContainerRegion,\r\n  ) {\r\n    const contentMetrics = opt_contentMetrics || this.getContentMetrics();\r\n    const margin = this.flyout_.MARGIN * this.workspace_.scale;\r\n    const scale = opt_getWorkspaceCoordinates ? this.workspace_.scale : 1;\r\n\r\n    // The left padding isn't just the margin. Some blocks are also offset by\r\n    // tabWidth so that value and statement blocks line up.\r\n    // The contentMetrics.left value is equivalent to the variable left padding.\r\n    const leftPadding = contentMetrics.left;\r\n\r\n    return {\r\n      height: (contentMetrics.height + 2 * margin) / scale,\r\n      width: (contentMetrics.width + leftPadding + margin) / scale,\r\n      top: 0,\r\n      left: 0,\r\n    };\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2011 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Flyout tray containing blocks which may be created.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.Flyout\r\n\r\nimport type {Abstract as AbstractEvent} from './events/events_abstract.js';\r\nimport type {Block} from './block.js';\r\nimport type {BlockSvg} from './block_svg.js';\r\nimport * as browserEvents from './browser_events.js';\r\nimport * as common from './common.js';\r\nimport {ComponentManager} from './component_manager.js';\r\nimport {DeleteArea} from './delete_area.js';\r\nimport * as eventUtils from './events/utils.js';\r\nimport {FlyoutButton} from './flyout_button.js';\r\nimport {FlyoutMetricsManager} from './flyout_metrics_manager.js';\r\nimport type {IFlyout} from './interfaces/i_flyout.js';\r\nimport type {Options} from './options.js';\r\nimport {ScrollbarPair} from './scrollbar_pair.js';\r\nimport * as blocks from './serialization/blocks.js';\r\nimport * as Tooltip from './tooltip.js';\r\nimport {Coordinate} from './utils/coordinate.js';\r\nimport * as dom from './utils/dom.js';\r\nimport * as idGenerator from './utils/idgenerator.js';\r\nimport {Svg} from './utils/svg.js';\r\nimport * as toolbox from './utils/toolbox.js';\r\nimport * as Variables from './variables.js';\r\nimport {WorkspaceSvg} from './workspace_svg.js';\r\nimport * as utilsXml from './utils/xml.js';\r\nimport * as Xml from './xml.js';\r\nimport * as renderManagement from './render_management.js';\r\nimport {IAutoHideable} from './interfaces/i_autohideable.js';\r\n\r\nenum FlyoutItemType {\r\n  BLOCK = 'block',\r\n  BUTTON = 'button',\r\n}\r\n\r\n/**\r\n * Class for a flyout.\r\n */\r\nexport abstract class Flyout\r\n  extends DeleteArea\r\n  implements IAutoHideable, IFlyout\r\n{\r\n  /**\r\n   * Position the flyout.\r\n   */\r\n  abstract position(): void;\r\n\r\n  /**\r\n   * Determine if a drag delta is toward the workspace, based on the position\r\n   * and orientation of the flyout. This is used in determineDragIntention_ to\r\n   * determine if a new block should be created or if the flyout should scroll.\r\n   *\r\n   * @param currentDragDeltaXY How far the pointer has\r\n   *     moved from the position at mouse down, in pixel units.\r\n   * @returns True if the drag is toward the workspace.\r\n   */\r\n  abstract isDragTowardWorkspace(currentDragDeltaXY: Coordinate): boolean;\r\n\r\n  /**\r\n   * Sets the translation of the flyout to match the scrollbars.\r\n   *\r\n   * @param xyRatio Contains a y property which is a float\r\n   *     between 0 and 1 specifying the degree of scrolling and a\r\n   *     similar x property.\r\n   */\r\n  protected abstract setMetrics_(xyRatio: {x?: number; y?: number}): void;\r\n\r\n  /**\r\n   * Lay out the blocks in the flyout.\r\n   *\r\n   * @param contents The blocks and buttons to lay out.\r\n   * @param gaps The visible gaps between blocks.\r\n   */\r\n  protected abstract layout_(contents: FlyoutItem[], gaps: number[]): void;\r\n\r\n  /**\r\n   * Scroll the flyout.\r\n   *\r\n   * @param e Mouse wheel scroll event.\r\n   */\r\n  protected abstract wheel_(e: WheelEvent): void;\r\n\r\n  /**\r\n   * Compute height of flyout.  Position mat under each block.\r\n   * For RTL: Lay out the blocks right-aligned.\r\n   */\r\n  protected abstract reflowInternal_(): void;\r\n\r\n  /**\r\n   * Calculates the x coordinate for the flyout position.\r\n   *\r\n   * @returns X coordinate.\r\n   */\r\n  abstract getX(): number;\r\n\r\n  /**\r\n   * Calculates the y coordinate for the flyout position.\r\n   *\r\n   * @returns Y coordinate.\r\n   */\r\n  abstract getY(): number;\r\n\r\n  /**\r\n   * Scroll the flyout to the beginning of its contents.\r\n   */\r\n  abstract scrollToStart(): void;\r\n\r\n  /**\r\n   * The type of a flyout content item.\r\n   */\r\n  static FlyoutItemType = FlyoutItemType;\r\n\r\n  protected workspace_: WorkspaceSvg;\r\n  RTL: boolean;\r\n  /**\r\n   * Whether the flyout should be laid out horizontally or not.\r\n   *\r\n   * @internal\r\n   */\r\n  horizontalLayout = false;\r\n  protected toolboxPosition_: number;\r\n\r\n  /**\r\n   * Array holding info needed to unbind events.\r\n   * Used for disposing.\r\n   * Ex: [[node, name, func], [node, name, func]].\r\n   */\r\n  private boundEvents: browserEvents.Data[] = [];\r\n\r\n  /**\r\n   * Function that will be registered as a change listener on the workspace\r\n   * to reflow when blocks in the flyout workspace change.\r\n   */\r\n  private reflowWrapper: ((e: AbstractEvent) => void) | null = null;\r\n\r\n  /**\r\n   * Function that disables blocks in the flyout based on max block counts\r\n   * allowed in the target workspace. Registered as a change listener on the\r\n   * target workspace.\r\n   */\r\n  private filterWrapper: ((e: AbstractEvent) => void) | null = null;\r\n\r\n  /**\r\n   * List of background mats that lurk behind each block to catch clicks\r\n   * landing in the blocks' lakes and bays.\r\n   */\r\n  private mats: SVGElement[] = [];\r\n\r\n  /**\r\n   * List of visible buttons.\r\n   */\r\n  protected buttons_: FlyoutButton[] = [];\r\n\r\n  /**\r\n   * List of event listeners.\r\n   */\r\n  private listeners: browserEvents.Data[] = [];\r\n\r\n  /**\r\n   * List of blocks that should always be disabled.\r\n   */\r\n  private permanentlyDisabled: Block[] = [];\r\n\r\n  protected readonly tabWidth_: number;\r\n\r\n  /**\r\n   * The target workspace.\r\n   *\r\n   * @internal\r\n   */\r\n  targetWorkspace!: WorkspaceSvg;\r\n\r\n  /**\r\n   * A list of blocks that can be reused.\r\n   */\r\n  private recycledBlocks: BlockSvg[] = [];\r\n\r\n  /**\r\n   * Does the flyout automatically close when a block is created?\r\n   */\r\n  autoClose = true;\r\n\r\n  /**\r\n   * Whether the flyout is visible.\r\n   */\r\n  private isVisible_ = false;\r\n\r\n  /**\r\n   * Whether the workspace containing this flyout is visible.\r\n   */\r\n  private containerVisible = true;\r\n  protected rectMap_: WeakMap<BlockSvg, SVGElement>;\r\n\r\n  /**\r\n   * Corner radius of the flyout background.\r\n   */\r\n  readonly CORNER_RADIUS: number = 8;\r\n  readonly MARGIN: number;\r\n  readonly GAP_X: number;\r\n  readonly GAP_Y: number;\r\n\r\n  /**\r\n   * Top/bottom padding between scrollbar and edge of flyout background.\r\n   */\r\n  readonly SCROLLBAR_MARGIN: number = 2.5;\r\n\r\n  /**\r\n   * Width of flyout.\r\n   */\r\n  protected width_ = 0;\r\n\r\n  /**\r\n   * Height of flyout.\r\n   */\r\n  protected height_ = 0;\r\n  // clang-format off\r\n  /**\r\n   * Range of a drag angle from a flyout considered \"dragging toward\r\n   * workspace\". Drags that are within the bounds of this many degrees from\r\n   * the orthogonal line to the flyout edge are considered to be \"drags toward\r\n   * the workspace\".\r\n   *\r\n   * @example\r\n   *\r\n   * ```\r\n   * Flyout                                                 Edge   Workspace\r\n   * [block] /  <-within this angle, drags \"toward workspace\" |\r\n   * [block] ---- orthogonal to flyout boundary ----          |\r\n   * [block] \\                                                |\r\n   * ```\r\n   *\r\n   * The angle is given in degrees from the orthogonal.\r\n   *\r\n   * This is used to know when to create a new block and when to scroll the\r\n   * flyout. Setting it to 360 means that all drags create a new block.\r\n   */\r\n  // clang-format on\r\n  protected dragAngleRange_ = 70;\r\n\r\n  /**\r\n   * The path around the background of the flyout, which will be filled with a\r\n   * background colour.\r\n   */\r\n  protected svgBackground_: SVGPathElement | null = null;\r\n\r\n  /**\r\n   * The root SVG group for the button or label.\r\n   */\r\n  protected svgGroup_: SVGGElement | null = null;\r\n  /**\r\n   * @param workspaceOptions Dictionary of options for the\r\n   *     workspace.\r\n   */\r\n  constructor(workspaceOptions: Options) {\r\n    super();\r\n    workspaceOptions.setMetrics = this.setMetrics_.bind(this);\r\n\r\n    this.workspace_ = new WorkspaceSvg(workspaceOptions);\r\n    this.workspace_.setMetricsManager(\r\n      new FlyoutMetricsManager(this.workspace_, this),\r\n    );\r\n\r\n    this.workspace_.internalIsFlyout = true;\r\n    // Keep the workspace visibility consistent with the flyout's visibility.\r\n    this.workspace_.setVisible(this.isVisible_);\r\n\r\n    /**\r\n     * The unique id for this component that is used to register with the\r\n     * ComponentManager.\r\n     */\r\n    this.id = idGenerator.genUid();\r\n\r\n    /**\r\n     * Is RTL vs LTR.\r\n     */\r\n    this.RTL = !!workspaceOptions.RTL;\r\n\r\n    /**\r\n     * Position of the toolbox and flyout relative to the workspace.\r\n     */\r\n    this.toolboxPosition_ = workspaceOptions.toolboxPosition;\r\n\r\n    /**\r\n     * Width of output tab.\r\n     */\r\n    this.tabWidth_ = this.workspace_.getRenderer().getConstants().TAB_WIDTH;\r\n\r\n    /**\r\n     * A map from blocks to the rects which are beneath them to act as input\r\n     * targets.\r\n     *\r\n     * @internal\r\n     */\r\n    this.rectMap_ = new WeakMap();\r\n\r\n    /**\r\n     * Margin around the edges of the blocks in the flyout.\r\n     */\r\n    this.MARGIN = this.CORNER_RADIUS;\r\n\r\n    // TODO: Move GAP_X and GAP_Y to their appropriate files.\r\n    /**\r\n     * Gap between items in horizontal flyouts. Can be overridden with the \"sep\"\r\n     * element.\r\n     */\r\n    this.GAP_X = this.MARGIN * 3;\r\n\r\n    /**\r\n     * Gap between items in vertical flyouts. Can be overridden with the \"sep\"\r\n     * element.\r\n     */\r\n    this.GAP_Y = this.MARGIN * 3;\r\n  }\r\n\r\n  /**\r\n   * Creates the flyout's DOM.  Only needs to be called once.  The flyout can\r\n   * either exist as its own SVG element or be a g element nested inside a\r\n   * separate SVG element.\r\n   *\r\n   * @param tagName The type of tag to\r\n   *     put the flyout in. This should be <svg> or <g>.\r\n   * @returns The flyout's SVG group.\r\n   */\r\n  createDom(\r\n    tagName: string | Svg<SVGSVGElement> | Svg<SVGGElement>,\r\n  ): SVGElement {\r\n    /*\r\n        <svg | g>\r\n          <path class=\"blocklyFlyoutBackground\"/>\r\n          <g class=\"blocklyFlyout\"></g>\r\n        </ svg | g>\r\n        */\r\n    // Setting style to display:none to start. The toolbox and flyout\r\n    // hide/show code will set up proper visibility and size later.\r\n    this.svgGroup_ = dom.createSvgElement(tagName, {\r\n      'class': 'blocklyFlyout',\r\n    });\r\n    this.svgGroup_.style.display = 'none';\r\n    this.svgBackground_ = dom.createSvgElement(\r\n      Svg.PATH,\r\n      {'class': 'blocklyFlyoutBackground'},\r\n      this.svgGroup_,\r\n    );\r\n    this.svgGroup_.appendChild(this.workspace_.createDom());\r\n    this.workspace_\r\n      .getThemeManager()\r\n      .subscribe(this.svgBackground_, 'flyoutBackgroundColour', 'fill');\r\n    this.workspace_\r\n      .getThemeManager()\r\n      .subscribe(this.svgBackground_, 'flyoutOpacity', 'fill-opacity');\r\n    return this.svgGroup_;\r\n  }\r\n\r\n  /**\r\n   * Initializes the flyout.\r\n   *\r\n   * @param targetWorkspace The workspace in which to\r\n   *     create new blocks.\r\n   */\r\n  init(targetWorkspace: WorkspaceSvg) {\r\n    this.targetWorkspace = targetWorkspace;\r\n    this.workspace_.targetWorkspace = targetWorkspace;\r\n\r\n    this.workspace_.scrollbar = new ScrollbarPair(\r\n      this.workspace_,\r\n      this.horizontalLayout,\r\n      !this.horizontalLayout,\r\n      'blocklyFlyoutScrollbar',\r\n      this.SCROLLBAR_MARGIN,\r\n    );\r\n\r\n    this.hide();\r\n\r\n    this.boundEvents.push(\r\n      browserEvents.conditionalBind(\r\n        this.svgGroup_ as SVGGElement,\r\n        'wheel',\r\n        this,\r\n        this.wheel_,\r\n      ),\r\n    );\r\n    this.filterWrapper = this.filterForCapacity.bind(this);\r\n    this.targetWorkspace.addChangeListener(this.filterWrapper);\r\n\r\n    // Dragging the flyout up and down.\r\n    this.boundEvents.push(\r\n      browserEvents.conditionalBind(\r\n        this.svgBackground_ as SVGPathElement,\r\n        'pointerdown',\r\n        this,\r\n        this.onMouseDown,\r\n      ),\r\n    );\r\n\r\n    // A flyout connected to a workspace doesn't have its own current gesture.\r\n    this.workspace_.getGesture = this.targetWorkspace.getGesture.bind(\r\n      this.targetWorkspace,\r\n    );\r\n\r\n    // Get variables from the main workspace rather than the target workspace.\r\n    this.workspace_.setVariableMap(this.targetWorkspace.getVariableMap());\r\n\r\n    this.workspace_.createPotentialVariableMap();\r\n\r\n    targetWorkspace.getComponentManager().addComponent({\r\n      component: this,\r\n      weight: 1,\r\n      capabilities: [\r\n        ComponentManager.Capability.AUTOHIDEABLE,\r\n        ComponentManager.Capability.DELETE_AREA,\r\n        ComponentManager.Capability.DRAG_TARGET,\r\n      ],\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Dispose of this flyout.\r\n   * Unlink from all DOM elements to prevent memory leaks.\r\n   */\r\n  dispose() {\r\n    this.hide();\r\n    this.targetWorkspace.getComponentManager().removeComponent(this.id);\r\n    for (const event of this.boundEvents) {\r\n      browserEvents.unbind(event);\r\n    }\r\n    this.boundEvents.length = 0;\r\n    if (this.filterWrapper) {\r\n      this.targetWorkspace.removeChangeListener(this.filterWrapper);\r\n    }\r\n    if (this.workspace_) {\r\n      this.workspace_.getThemeManager().unsubscribe(this.svgBackground_!);\r\n      this.workspace_.dispose();\r\n    }\r\n    if (this.svgGroup_) {\r\n      dom.removeNode(this.svgGroup_);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the width of the flyout.\r\n   *\r\n   * @returns The width of the flyout.\r\n   */\r\n  getWidth(): number {\r\n    return this.width_;\r\n  }\r\n\r\n  /**\r\n   * Get the height of the flyout.\r\n   *\r\n   * @returns The width of the flyout.\r\n   */\r\n  getHeight(): number {\r\n    return this.height_;\r\n  }\r\n\r\n  /**\r\n   * Get the scale (zoom level) of the flyout. By default,\r\n   * this matches the target workspace scale, but this can be overridden.\r\n   *\r\n   * @returns Flyout workspace scale.\r\n   */\r\n  getFlyoutScale(): number {\r\n    return this.targetWorkspace.scale;\r\n  }\r\n\r\n  /**\r\n   * Get the workspace inside the flyout.\r\n   *\r\n   * @returns The workspace inside the flyout.\r\n   */\r\n  getWorkspace(): WorkspaceSvg {\r\n    return this.workspace_;\r\n  }\r\n\r\n  /**\r\n   * Sets whether this flyout automatically closes when blocks are dragged out,\r\n   * the workspace is clicked, etc, or not.\r\n   */\r\n  setAutoClose(autoClose: boolean) {\r\n    this.autoClose = autoClose;\r\n    this.targetWorkspace.recordDragTargets();\r\n    this.targetWorkspace.resizeContents();\r\n  }\r\n\r\n  /** Automatically hides the flyout if it is an autoclosing flyout. */\r\n  autoHide(onlyClosePopups: boolean): void {\r\n    if (\r\n      !onlyClosePopups &&\r\n      this.targetWorkspace.getFlyout(true) === this &&\r\n      this.autoClose\r\n    )\r\n      this.hide();\r\n  }\r\n\r\n  /**\r\n   * Is the flyout visible?\r\n   *\r\n   * @returns True if visible.\r\n   */\r\n  isVisible(): boolean {\r\n    return this.isVisible_;\r\n  }\r\n\r\n  /**\r\n   * Set whether the flyout is visible. A value of true does not necessarily\r\n   * mean that the flyout is shown. It could be hidden because its container is\r\n   * hidden.\r\n   *\r\n   * @param visible True if visible.\r\n   */\r\n  setVisible(visible: boolean) {\r\n    const visibilityChanged = visible !== this.isVisible();\r\n\r\n    this.isVisible_ = visible;\r\n    if (visibilityChanged) {\r\n      if (!this.autoClose) {\r\n        // Auto-close flyouts are ignored as drag targets, so only non\r\n        // auto-close flyouts need to have their drag target updated.\r\n        this.targetWorkspace.recordDragTargets();\r\n      }\r\n      this.updateDisplay();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set whether this flyout's container is visible.\r\n   *\r\n   * @param visible Whether the container is visible.\r\n   */\r\n  setContainerVisible(visible: boolean) {\r\n    const visibilityChanged = visible !== this.containerVisible;\r\n    this.containerVisible = visible;\r\n    if (visibilityChanged) {\r\n      this.updateDisplay();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update the display property of the flyout based whether it thinks it should\r\n   * be visible and whether its containing workspace is visible.\r\n   */\r\n  private updateDisplay() {\r\n    let show = true;\r\n    if (!this.containerVisible) {\r\n      show = false;\r\n    } else {\r\n      show = this.isVisible();\r\n    }\r\n    if (this.svgGroup_) {\r\n      this.svgGroup_.style.display = show ? 'block' : 'none';\r\n    }\r\n    // Update the scrollbar's visibility too since it should mimic the\r\n    // flyout's visibility.\r\n    this.workspace_.scrollbar?.setContainerVisible(show);\r\n  }\r\n\r\n  /**\r\n   * Update the view based on coordinates calculated in position().\r\n   *\r\n   * @param width The computed width of the flyout's SVG group\r\n   * @param height The computed height of the flyout's SVG group.\r\n   * @param x The computed x origin of the flyout's SVG group.\r\n   * @param y The computed y origin of the flyout's SVG group.\r\n   */\r\n  protected positionAt_(width: number, height: number, x: number, y: number) {\r\n    this.svgGroup_?.setAttribute('width', `${width}`);\r\n    this.svgGroup_?.setAttribute('height', `${height}`);\r\n    this.workspace_.setCachedParentSvgSize(width, height);\r\n\r\n    if (this.svgGroup_) {\r\n      const transform = 'translate(' + x + 'px,' + y + 'px)';\r\n      dom.setCssTransform(this.svgGroup_, transform);\r\n    }\r\n\r\n    // Update the scrollbar (if one exists).\r\n    const scrollbar = this.workspace_.scrollbar;\r\n    if (scrollbar) {\r\n      // Set the scrollbars origin to be the top left of the flyout.\r\n      scrollbar.setOrigin(x, y);\r\n      scrollbar.resize();\r\n      // If origin changed and metrics haven't changed enough to trigger\r\n      // reposition in resize, we need to call setPosition. See issue #4692.\r\n      if (scrollbar.hScroll) {\r\n        scrollbar.hScroll.setPosition(\r\n          scrollbar.hScroll.position.x,\r\n          scrollbar.hScroll.position.y,\r\n        );\r\n      }\r\n      if (scrollbar.vScroll) {\r\n        scrollbar.vScroll.setPosition(\r\n          scrollbar.vScroll.position.x,\r\n          scrollbar.vScroll.position.y,\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Hide and empty the flyout.\r\n   */\r\n  hide() {\r\n    if (!this.isVisible()) {\r\n      return;\r\n    }\r\n    this.setVisible(false);\r\n    // Delete all the event listeners.\r\n    for (const listen of this.listeners) {\r\n      browserEvents.unbind(listen);\r\n    }\r\n    this.listeners.length = 0;\r\n    if (this.reflowWrapper) {\r\n      this.workspace_.removeChangeListener(this.reflowWrapper);\r\n      this.reflowWrapper = null;\r\n    }\r\n    // Do NOT delete the blocks here.  Wait until Flyout.show.\r\n    // https://neil.fraser.name/news/2014/08/09/\r\n  }\r\n\r\n  /**\r\n   * Show and populate the flyout.\r\n   *\r\n   * @param flyoutDef Contents to display\r\n   *     in the flyout. This is either an array of Nodes, a NodeList, a\r\n   *     toolbox definition, or a string with the name of the dynamic category.\r\n   */\r\n  show(flyoutDef: toolbox.FlyoutDefinition | string) {\r\n    this.workspace_.setResizesEnabled(false);\r\n    this.hide();\r\n    this.clearOldBlocks();\r\n\r\n    // Handle dynamic categories, represented by a name instead of a list.\r\n    if (typeof flyoutDef === 'string') {\r\n      flyoutDef = this.getDynamicCategoryContents(flyoutDef);\r\n    }\r\n    this.setVisible(true);\r\n\r\n    // Parse the Array, Node or NodeList into a a list of flyout items.\r\n    const parsedContent = toolbox.convertFlyoutDefToJsonArray(flyoutDef);\r\n    const flyoutInfo = this.createFlyoutInfo(parsedContent);\r\n\r\n    renderManagement.triggerQueuedRenders(this.workspace_);\r\n\r\n    this.layout_(flyoutInfo.contents, flyoutInfo.gaps);\r\n\r\n    if (this.horizontalLayout) {\r\n      this.height_ = 0;\r\n    } else {\r\n      this.width_ = 0;\r\n    }\r\n    this.workspace_.setResizesEnabled(true);\r\n    this.reflow();\r\n\r\n    this.filterForCapacity();\r\n\r\n    // Correctly position the flyout's scrollbar when it opens.\r\n    this.position();\r\n\r\n    this.reflowWrapper = this.reflow.bind(this);\r\n    this.workspace_.addChangeListener(this.reflowWrapper);\r\n    this.emptyRecycledBlocks();\r\n  }\r\n\r\n  /**\r\n   * Create the contents array and gaps array necessary to create the layout for\r\n   * the flyout.\r\n   *\r\n   * @param parsedContent The array\r\n   *     of objects to show in the flyout.\r\n   * @returns The list of contents and gaps needed to lay out the flyout.\r\n   */\r\n  private createFlyoutInfo(parsedContent: toolbox.FlyoutItemInfoArray): {\r\n    contents: FlyoutItem[];\r\n    gaps: number[];\r\n  } {\r\n    const contents: FlyoutItem[] = [];\r\n    const gaps: number[] = [];\r\n    this.permanentlyDisabled.length = 0;\r\n    const defaultGap = this.horizontalLayout ? this.GAP_X : this.GAP_Y;\r\n    for (const info of parsedContent) {\r\n      if ('custom' in info) {\r\n        const customInfo = info as toolbox.DynamicCategoryInfo;\r\n        const categoryName = customInfo['custom'];\r\n        const flyoutDef = this.getDynamicCategoryContents(categoryName);\r\n        const parsedDynamicContent =\r\n          toolbox.convertFlyoutDefToJsonArray(flyoutDef);\r\n        const {contents: dynamicContents, gaps: dynamicGaps} =\r\n          this.createFlyoutInfo(parsedDynamicContent);\r\n        contents.push(...dynamicContents);\r\n        gaps.push(...dynamicGaps);\r\n      }\r\n\r\n      switch (info['kind'].toUpperCase()) {\r\n        case 'BLOCK': {\r\n          const blockInfo = info as toolbox.BlockInfo;\r\n          const block = this.createFlyoutBlock(blockInfo);\r\n          contents.push({type: FlyoutItemType.BLOCK, block: block});\r\n          this.addBlockGap(blockInfo, gaps, defaultGap);\r\n          break;\r\n        }\r\n        case 'SEP': {\r\n          const sepInfo = info as toolbox.SeparatorInfo;\r\n          this.addSeparatorGap(sepInfo, gaps, defaultGap);\r\n          break;\r\n        }\r\n        case 'LABEL': {\r\n          const labelInfo = info as toolbox.LabelInfo;\r\n          // A label is a button with different styling.\r\n          const label = this.createButton(labelInfo, /** isLabel */ true);\r\n          contents.push({type: FlyoutItemType.BUTTON, button: label});\r\n          gaps.push(defaultGap);\r\n          break;\r\n        }\r\n        case 'BUTTON': {\r\n          const buttonInfo = info as toolbox.ButtonInfo;\r\n          const button = this.createButton(buttonInfo, /** isLabel */ false);\r\n          contents.push({type: FlyoutItemType.BUTTON, button: button});\r\n          gaps.push(defaultGap);\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    return {contents: contents, gaps: gaps};\r\n  }\r\n\r\n  /**\r\n   * Gets the flyout definition for the dynamic category.\r\n   *\r\n   * @param categoryName The name of the dynamic category.\r\n   * @returns The definition of the\r\n   *     flyout in one of its many forms.\r\n   */\r\n  private getDynamicCategoryContents(\r\n    categoryName: string,\r\n  ): toolbox.FlyoutDefinition {\r\n    // Look up the correct category generation function and call that to get a\r\n    // valid XML list.\r\n    const fnToApply =\r\n      this.workspace_.targetWorkspace!.getToolboxCategoryCallback(categoryName);\r\n    if (typeof fnToApply !== 'function') {\r\n      throw TypeError(\r\n        \"Couldn't find a callback function when opening\" +\r\n          ' a toolbox category.',\r\n      );\r\n    }\r\n    return fnToApply(this.workspace_.targetWorkspace!);\r\n  }\r\n\r\n  /**\r\n   * Creates a flyout button or a flyout label.\r\n   *\r\n   * @param btnInfo The object holding information about a button or a label.\r\n   * @param isLabel True if the button is a label, false otherwise.\r\n   * @returns The object used to display the button in the\r\n   *    flyout.\r\n   */\r\n  private createButton(\r\n    btnInfo: toolbox.ButtonOrLabelInfo,\r\n    isLabel: boolean,\r\n  ): FlyoutButton {\r\n    const curButton = new FlyoutButton(\r\n      this.workspace_,\r\n      this.targetWorkspace as WorkspaceSvg,\r\n      btnInfo,\r\n      isLabel,\r\n    );\r\n    return curButton;\r\n  }\r\n\r\n  /**\r\n   * Create a block from the xml and permanently disable any blocks that were\r\n   * defined as disabled.\r\n   *\r\n   * @param blockInfo The info of the block.\r\n   * @returns The block created from the blockInfo.\r\n   */\r\n  private createFlyoutBlock(blockInfo: toolbox.BlockInfo): BlockSvg {\r\n    let block;\r\n    if (blockInfo['blockxml']) {\r\n      const xml = (\r\n        typeof blockInfo['blockxml'] === 'string'\r\n          ? utilsXml.textToDom(blockInfo['blockxml'])\r\n          : blockInfo['blockxml']\r\n      ) as Element;\r\n      block = this.getRecycledBlock(xml.getAttribute('type')!);\r\n      if (!block) {\r\n        block = Xml.domToBlockInternal(xml, this.workspace_);\r\n      }\r\n    } else {\r\n      block = this.getRecycledBlock(blockInfo['type']!);\r\n      if (!block) {\r\n        if (blockInfo['enabled'] === undefined) {\r\n          blockInfo['enabled'] =\r\n            blockInfo['disabled'] !== 'true' && blockInfo['disabled'] !== true;\r\n        }\r\n        block = blocks.appendInternal(\r\n          blockInfo as blocks.State,\r\n          this.workspace_,\r\n        );\r\n      }\r\n    }\r\n\r\n    if (!block.isEnabled()) {\r\n      // Record blocks that were initially disabled.\r\n      // Do not enable these blocks as a result of capacity filtering.\r\n      this.permanentlyDisabled.push(block);\r\n    }\r\n    return block as BlockSvg;\r\n  }\r\n\r\n  /**\r\n   * Returns a block from the array of recycled blocks with the given type, or\r\n   * undefined if one cannot be found.\r\n   *\r\n   * @param blockType The type of the block to try to recycle.\r\n   * @returns The recycled block, or undefined if\r\n   *     one could not be recycled.\r\n   */\r\n  private getRecycledBlock(blockType: string): BlockSvg | undefined {\r\n    let index = -1;\r\n    for (let i = 0; i < this.recycledBlocks.length; i++) {\r\n      if (this.recycledBlocks[i].type === blockType) {\r\n        index = i;\r\n        break;\r\n      }\r\n    }\r\n    return index === -1 ? undefined : this.recycledBlocks.splice(index, 1)[0];\r\n  }\r\n\r\n  /**\r\n   * Adds a gap in the flyout based on block info.\r\n   *\r\n   * @param blockInfo Information about a block.\r\n   * @param gaps The list of gaps between items in the flyout.\r\n   * @param defaultGap The default gap between one element and the\r\n   *     next.\r\n   */\r\n  private addBlockGap(\r\n    blockInfo: toolbox.BlockInfo,\r\n    gaps: number[],\r\n    defaultGap: number,\r\n  ) {\r\n    let gap;\r\n    if (blockInfo['gap']) {\r\n      gap = parseInt(String(blockInfo['gap']));\r\n    } else if (blockInfo['blockxml']) {\r\n      const xml = (\r\n        typeof blockInfo['blockxml'] === 'string'\r\n          ? utilsXml.textToDom(blockInfo['blockxml'])\r\n          : blockInfo['blockxml']\r\n      ) as Element;\r\n      gap = parseInt(xml.getAttribute('gap')!);\r\n    }\r\n    gaps.push(!gap || isNaN(gap) ? defaultGap : gap);\r\n  }\r\n\r\n  /**\r\n   * Add the necessary gap in the flyout for a separator.\r\n   *\r\n   * @param sepInfo The object holding\r\n   *    information about a separator.\r\n   * @param gaps The list gaps between items in the flyout.\r\n   * @param defaultGap The default gap between the button and next\r\n   *     element.\r\n   */\r\n  private addSeparatorGap(\r\n    sepInfo: toolbox.SeparatorInfo,\r\n    gaps: number[],\r\n    defaultGap: number,\r\n  ) {\r\n    // Change the gap between two toolbox elements.\r\n    // <sep gap=\"36\"></sep>\r\n    // The default gap is 24, can be set larger or smaller.\r\n    // This overwrites the gap attribute on the previous element.\r\n    const newGap = parseInt(String(sepInfo['gap']));\r\n    // Ignore gaps before the first block.\r\n    if (!isNaN(newGap) && gaps.length > 0) {\r\n      gaps[gaps.length - 1] = newGap;\r\n    } else {\r\n      gaps.push(defaultGap);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Delete blocks, mats and buttons from a previous showing of the flyout.\r\n   */\r\n  private clearOldBlocks() {\r\n    // Delete any blocks from a previous showing.\r\n    const oldBlocks = this.workspace_.getTopBlocks(false);\r\n    for (let i = 0, block; (block = oldBlocks[i]); i++) {\r\n      if (this.blockIsRecyclable_(block)) {\r\n        this.recycleBlock(block);\r\n      } else {\r\n        block.dispose(false, false);\r\n      }\r\n    }\r\n    // Delete any mats from a previous showing.\r\n    for (let j = 0; j < this.mats.length; j++) {\r\n      const rect = this.mats[j];\r\n      if (rect) {\r\n        Tooltip.unbindMouseEvents(rect);\r\n        dom.removeNode(rect);\r\n      }\r\n    }\r\n    this.mats.length = 0;\r\n    // Delete any buttons from a previous showing.\r\n    for (let i = 0, button; (button = this.buttons_[i]); i++) {\r\n      button.dispose();\r\n    }\r\n    this.buttons_.length = 0;\r\n\r\n    // Clear potential variables from the previous showing.\r\n    this.workspace_.getPotentialVariableMap()?.clear();\r\n  }\r\n\r\n  /**\r\n   * Empties all of the recycled blocks, properly disposing of them.\r\n   */\r\n  private emptyRecycledBlocks() {\r\n    for (let i = 0; i < this.recycledBlocks.length; i++) {\r\n      this.recycledBlocks[i].dispose();\r\n    }\r\n    this.recycledBlocks = [];\r\n  }\r\n\r\n  /**\r\n   * Returns whether the given block can be recycled or not.\r\n   *\r\n   * @param _block The block to check for recyclability.\r\n   * @returns True if the block can be recycled. False otherwise.\r\n   */\r\n  protected blockIsRecyclable_(_block: BlockSvg): boolean {\r\n    // By default, recycling is disabled.\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Puts a previously created block into the recycle bin and moves it to the\r\n   * top of the workspace. Used during large workspace swaps to limit the number\r\n   * of new DOM elements we need to create.\r\n   *\r\n   * @param block The block to recycle.\r\n   */\r\n  private recycleBlock(block: BlockSvg) {\r\n    const xy = block.getRelativeToSurfaceXY();\r\n    block.moveBy(-xy.x, -xy.y);\r\n    this.recycledBlocks.push(block);\r\n  }\r\n\r\n  /**\r\n   * Add listeners to a block that has been added to the flyout.\r\n   *\r\n   * @param root The root node of the SVG group the block is in.\r\n   * @param block The block to add listeners for.\r\n   * @param rect The invisible rectangle under the block that acts\r\n   *     as a mat for that block.\r\n   */\r\n  protected addBlockListeners_(\r\n    root: SVGElement,\r\n    block: BlockSvg,\r\n    rect: SVGElement,\r\n  ) {\r\n    this.listeners.push(\r\n      browserEvents.conditionalBind(\r\n        root,\r\n        'pointerdown',\r\n        null,\r\n        this.blockMouseDown(block),\r\n      ),\r\n    );\r\n    this.listeners.push(\r\n      browserEvents.conditionalBind(\r\n        rect,\r\n        'pointerdown',\r\n        null,\r\n        this.blockMouseDown(block),\r\n      ),\r\n    );\r\n    this.listeners.push(\r\n      browserEvents.bind(root, 'pointerenter', block, () => {\r\n        if (!this.targetWorkspace.isDragging()) {\r\n          block.addSelect();\r\n        }\r\n      }),\r\n    );\r\n    this.listeners.push(\r\n      browserEvents.bind(root, 'pointerleave', block, () => {\r\n        if (!this.targetWorkspace.isDragging()) {\r\n          block.removeSelect();\r\n        }\r\n      }),\r\n    );\r\n    this.listeners.push(\r\n      browserEvents.bind(rect, 'pointerenter', block, () => {\r\n        if (!this.targetWorkspace.isDragging()) {\r\n          block.addSelect();\r\n        }\r\n      }),\r\n    );\r\n    this.listeners.push(\r\n      browserEvents.bind(rect, 'pointerleave', block, () => {\r\n        if (!this.targetWorkspace.isDragging()) {\r\n          block.removeSelect();\r\n        }\r\n      }),\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Handle a pointerdown on an SVG block in a non-closing flyout.\r\n   *\r\n   * @param block The flyout block to copy.\r\n   * @returns Function to call when block is clicked.\r\n   */\r\n  private blockMouseDown(block: BlockSvg): Function {\r\n    return (e: PointerEvent) => {\r\n      const gesture = this.targetWorkspace.getGesture(e);\r\n      if (gesture) {\r\n        gesture.setStartBlock(block);\r\n        gesture.handleFlyoutStart(e, this);\r\n      }\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Pointer down on the flyout background.  Start a vertical scroll drag.\r\n   *\r\n   * @param e Pointer down event.\r\n   */\r\n  private onMouseDown(e: PointerEvent) {\r\n    const gesture = this.targetWorkspace.getGesture(e);\r\n    if (gesture) {\r\n      gesture.handleFlyoutStart(e, this);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Does this flyout allow you to create a new instance of the given block?\r\n   * Used for deciding if a block can be \"dragged out of\" the flyout.\r\n   *\r\n   * @param block The block to copy from the flyout.\r\n   * @returns True if you can create a new instance of the block, false\r\n   *    otherwise.\r\n   * @internal\r\n   */\r\n  isBlockCreatable(block: BlockSvg): boolean {\r\n    return block.isEnabled();\r\n  }\r\n\r\n  /**\r\n   * Create a copy of this block on the workspace.\r\n   *\r\n   * @param originalBlock The block to copy from the flyout.\r\n   * @returns The newly created block.\r\n   * @throws {Error} if something went wrong with deserialization.\r\n   * @internal\r\n   */\r\n  createBlock(originalBlock: BlockSvg): BlockSvg {\r\n    let newBlock = null;\r\n    eventUtils.disable();\r\n    const variablesBeforeCreation = this.targetWorkspace.getAllVariables();\r\n    this.targetWorkspace.setResizesEnabled(false);\r\n    try {\r\n      newBlock = this.placeNewBlock(originalBlock);\r\n    } finally {\r\n      eventUtils.enable();\r\n    }\r\n\r\n    // Close the flyout.\r\n    this.targetWorkspace.hideChaff();\r\n\r\n    const newVariables = Variables.getAddedVariables(\r\n      this.targetWorkspace,\r\n      variablesBeforeCreation,\r\n    );\r\n\r\n    if (eventUtils.isEnabled()) {\r\n      eventUtils.setGroup(true);\r\n      // Fire a VarCreate event for each (if any) new variable created.\r\n      for (let i = 0; i < newVariables.length; i++) {\r\n        const thisVariable = newVariables[i];\r\n        eventUtils.fire(\r\n          new (eventUtils.get(eventUtils.VAR_CREATE))(thisVariable),\r\n        );\r\n      }\r\n\r\n      // Block events come after var events, in case they refer to newly created\r\n      // variables.\r\n      eventUtils.fire(new (eventUtils.get(eventUtils.BLOCK_CREATE))(newBlock));\r\n    }\r\n    if (this.autoClose) {\r\n      this.hide();\r\n    } else {\r\n      this.filterForCapacity();\r\n    }\r\n    return newBlock;\r\n  }\r\n\r\n  /**\r\n   * Initialize the given button: move it to the correct location,\r\n   * add listeners, etc.\r\n   *\r\n   * @param button The button to initialize and place.\r\n   * @param x The x position of the cursor during this layout pass.\r\n   * @param y The y position of the cursor during this layout pass.\r\n   */\r\n  protected initFlyoutButton_(button: FlyoutButton, x: number, y: number) {\r\n    const buttonSvg = button.createDom();\r\n    button.moveTo(x, y);\r\n    button.show();\r\n    // Clicking on a flyout button or label is a lot like clicking on the\r\n    // flyout background.\r\n    this.listeners.push(\r\n      browserEvents.conditionalBind(\r\n        buttonSvg,\r\n        'pointerdown',\r\n        this,\r\n        this.onMouseDown,\r\n      ),\r\n    );\r\n\r\n    this.buttons_.push(button);\r\n  }\r\n\r\n  /**\r\n   * Create and place a rectangle corresponding to the given block.\r\n   *\r\n   * @param block The block to associate the rect to.\r\n   * @param x The x position of the cursor during this layout pass.\r\n   * @param y The y position of the cursor during this layout pass.\r\n   * @param blockHW The height and width of\r\n   *     the block.\r\n   * @param index The index into the mats list where this rect should\r\n   *     be placed.\r\n   * @returns Newly created SVG element for the rectangle behind\r\n   *     the block.\r\n   */\r\n  protected createRect_(\r\n    block: BlockSvg,\r\n    x: number,\r\n    y: number,\r\n    blockHW: {height: number; width: number},\r\n    index: number,\r\n  ): SVGElement {\r\n    // Create an invisible rectangle under the block to act as a button.  Just\r\n    // using the block as a button is poor, since blocks have holes in them.\r\n    const rect = dom.createSvgElement(Svg.RECT, {\r\n      'fill-opacity': 0,\r\n      'x': x,\r\n      'y': y,\r\n      'height': blockHW.height,\r\n      'width': blockHW.width,\r\n    });\r\n    (rect as AnyDuringMigration).tooltip = block;\r\n    Tooltip.bindMouseEvents(rect);\r\n    // Add the rectangles under the blocks, so that the blocks' tooltips work.\r\n    this.workspace_.getCanvas().insertBefore(rect, block.getSvgRoot());\r\n\r\n    this.rectMap_.set(block, rect);\r\n    this.mats[index] = rect;\r\n    return rect;\r\n  }\r\n\r\n  /**\r\n   * Move a rectangle to sit exactly behind a block, taking into account tabs,\r\n   * hats, and any other protrusions we invent.\r\n   *\r\n   * @param rect The rectangle to move directly behind the block.\r\n   * @param block The block the rectangle should be behind.\r\n   */\r\n  protected moveRectToBlock_(rect: SVGElement, block: BlockSvg) {\r\n    const blockHW = block.getHeightWidth();\r\n    rect.setAttribute('width', String(blockHW.width));\r\n    rect.setAttribute('height', String(blockHW.height));\r\n\r\n    const blockXY = block.getRelativeToSurfaceXY();\r\n    rect.setAttribute('y', String(blockXY.y));\r\n    rect.setAttribute(\r\n      'x',\r\n      String(this.RTL ? blockXY.x - blockHW.width : blockXY.x),\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Filter the blocks on the flyout to disable the ones that are above the\r\n   * capacity limit.  For instance, if the user may only place two more blocks\r\n   * on the workspace, an \"a + b\" block that has two shadow blocks would be\r\n   * disabled.\r\n   */\r\n  private filterForCapacity() {\r\n    const blocks = this.workspace_.getTopBlocks(false);\r\n    for (let i = 0, block; (block = blocks[i]); i++) {\r\n      if (this.permanentlyDisabled.indexOf(block) === -1) {\r\n        const enable = this.targetWorkspace.isCapacityAvailable(\r\n          common.getBlockTypeCounts(block),\r\n        );\r\n        while (block) {\r\n          block.setEnabled(enable);\r\n          block = block.getNextBlock();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Reflow blocks and their mats.\r\n   */\r\n  reflow() {\r\n    if (this.reflowWrapper) {\r\n      this.workspace_.removeChangeListener(this.reflowWrapper);\r\n    }\r\n    this.reflowInternal_();\r\n    if (this.reflowWrapper) {\r\n      this.workspace_.addChangeListener(this.reflowWrapper);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @returns True if this flyout may be scrolled with a scrollbar or\r\n   *     by dragging.\r\n   * @internal\r\n   */\r\n  isScrollable(): boolean {\r\n    return this.workspace_.scrollbar\r\n      ? this.workspace_.scrollbar.isVisible()\r\n      : false;\r\n  }\r\n\r\n  /**\r\n   * Copy a block from the flyout to the workspace and position it correctly.\r\n   *\r\n   * @param oldBlock The flyout block to copy.\r\n   * @returns The new block in the main workspace.\r\n   */\r\n  private placeNewBlock(oldBlock: BlockSvg): BlockSvg {\r\n    const targetWorkspace = this.targetWorkspace;\r\n    const svgRootOld = oldBlock.getSvgRoot();\r\n    if (!svgRootOld) {\r\n      throw Error('oldBlock is not rendered');\r\n    }\r\n\r\n    // Clone the block.\r\n    const json = blocks.save(oldBlock) as blocks.State;\r\n    // Normallly this resizes leading to weird jumps. Save it for terminateDrag.\r\n    targetWorkspace.setResizesEnabled(false);\r\n    const block = blocks.append(json, targetWorkspace) as BlockSvg;\r\n\r\n    this.positionNewBlock(oldBlock, block);\r\n\r\n    return block;\r\n  }\r\n\r\n  /**\r\n   * Positions a block on the target workspace.\r\n   *\r\n   * @param oldBlock The flyout block being copied.\r\n   * @param block The block to posiiton.\r\n   */\r\n  private positionNewBlock(oldBlock: BlockSvg, block: BlockSvg) {\r\n    const targetWorkspace = this.targetWorkspace;\r\n\r\n    // The offset in pixels between the main workspace's origin and the upper\r\n    // left corner of the injection div.\r\n    const mainOffsetPixels = targetWorkspace.getOriginOffsetInPixels();\r\n\r\n    // The offset in pixels between the flyout workspace's origin and the upper\r\n    // left corner of the injection div.\r\n    const flyoutOffsetPixels = this.workspace_.getOriginOffsetInPixels();\r\n\r\n    // The position of the old block in flyout workspace coordinates.\r\n    const oldBlockPos = oldBlock.getRelativeToSurfaceXY();\r\n    // The position of the old block in pixels relative to the flyout\r\n    // workspace's origin.\r\n    oldBlockPos.scale(this.workspace_.scale);\r\n\r\n    // The position of the old block in pixels relative to the upper left corner\r\n    // of the injection div.\r\n    const oldBlockOffsetPixels = Coordinate.sum(\r\n      flyoutOffsetPixels,\r\n      oldBlockPos,\r\n    );\r\n\r\n    // The position of the old block in pixels relative to the origin of the\r\n    // main workspace.\r\n    const finalOffset = Coordinate.difference(\r\n      oldBlockOffsetPixels,\r\n      mainOffsetPixels,\r\n    );\r\n    // The position of the old block in main workspace coordinates.\r\n    finalOffset.scale(1 / targetWorkspace.scale);\r\n\r\n    // No 'reason' provided since events are disabled.\r\n    block.moveTo(new Coordinate(finalOffset.x, finalOffset.y));\r\n  }\r\n}\r\n\r\n/**\r\n * A flyout content item.\r\n */\r\nexport interface FlyoutItem {\r\n  type: FlyoutItemType;\r\n  button?: FlyoutButton | undefined;\r\n  block?: BlockSvg | undefined;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Horizontal flyout tray containing blocks which may be created.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.HorizontalFlyout\r\n\r\nimport * as browserEvents from './browser_events.js';\r\nimport * as dropDownDiv from './dropdowndiv.js';\r\nimport {Flyout, FlyoutItem} from './flyout_base.js';\r\nimport type {FlyoutButton} from './flyout_button.js';\r\nimport type {Options} from './options.js';\r\nimport * as registry from './registry.js';\r\nimport {Scrollbar} from './scrollbar.js';\r\nimport type {Coordinate} from './utils/coordinate.js';\r\nimport {Rect} from './utils/rect.js';\r\nimport * as toolbox from './utils/toolbox.js';\r\nimport * as WidgetDiv from './widgetdiv.js';\r\n\r\n/**\r\n * Class for a flyout.\r\n */\r\nexport class HorizontalFlyout extends Flyout {\r\n  override horizontalLayout = true;\r\n\r\n  /** @param workspaceOptions Dictionary of options for the workspace. */\r\n  constructor(workspaceOptions: Options) {\r\n    super(workspaceOptions);\r\n  }\r\n\r\n  /**\r\n   * Sets the translation of the flyout to match the scrollbars.\r\n   *\r\n   * @param xyRatio Contains a y property which is a float between 0 and 1\r\n   *     specifying the degree of scrolling and a similar x property.\r\n   */\r\n  protected override setMetrics_(xyRatio: {x: number; y: number}) {\r\n    if (!this.isVisible()) {\r\n      return;\r\n    }\r\n\r\n    const metricsManager = this.workspace_.getMetricsManager();\r\n    const scrollMetrics = metricsManager.getScrollMetrics();\r\n    const viewMetrics = metricsManager.getViewMetrics();\r\n    const absoluteMetrics = metricsManager.getAbsoluteMetrics();\r\n\r\n    if (typeof xyRatio.x === 'number') {\r\n      this.workspace_.scrollX = -(\r\n        scrollMetrics.left +\r\n        (scrollMetrics.width - viewMetrics.width) * xyRatio.x\r\n      );\r\n    }\r\n\r\n    this.workspace_.translate(\r\n      this.workspace_.scrollX + absoluteMetrics.left,\r\n      this.workspace_.scrollY + absoluteMetrics.top,\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Calculates the x coordinate for the flyout position.\r\n   *\r\n   * @returns X coordinate.\r\n   */\r\n  override getX(): number {\r\n    // X is always 0 since this is a horizontal flyout.\r\n    return 0;\r\n  }\r\n\r\n  /**\r\n   * Calculates the y coordinate for the flyout position.\r\n   *\r\n   * @returns Y coordinate.\r\n   */\r\n  override getY(): number {\r\n    if (!this.isVisible()) {\r\n      return 0;\r\n    }\r\n    const metricsManager = this.targetWorkspace!.getMetricsManager();\r\n    const absoluteMetrics = metricsManager.getAbsoluteMetrics();\r\n    const viewMetrics = metricsManager.getViewMetrics();\r\n    const toolboxMetrics = metricsManager.getToolboxMetrics();\r\n\r\n    let y = 0;\r\n    const atTop = this.toolboxPosition_ === toolbox.Position.TOP;\r\n    // If this flyout is not the trashcan flyout (e.g. toolbox or mutator).\r\n    // Trashcan flyout is opposite the main flyout.\r\n    if (this.targetWorkspace!.toolboxPosition === this.toolboxPosition_) {\r\n      // If there is a category toolbox.\r\n      // Simple (flyout-only) toolbox.\r\n      if (this.targetWorkspace!.getToolbox()) {\r\n        if (atTop) {\r\n          y = toolboxMetrics.height;\r\n        } else {\r\n          y = viewMetrics.height - this.height_;\r\n        }\r\n      } else {\r\n        if (atTop) {\r\n          y = 0;\r\n        } else {\r\n          // The simple flyout does not cover the workspace.\r\n          y = viewMetrics.height;\r\n        }\r\n      }\r\n    } else {\r\n      if (atTop) {\r\n        y = 0;\r\n      } else {\r\n        // Because the anchor point of the flyout is on the top, but we want\r\n        // to align the bottom edge of the flyout with the bottom edge of the\r\n        // blocklyDiv, we calculate the full height of the div minus the height\r\n        // of the flyout.\r\n        y = viewMetrics.height + absoluteMetrics.top - this.height_;\r\n      }\r\n    }\r\n\r\n    return y;\r\n  }\r\n\r\n  /** Move the flyout to the edge of the workspace. */\r\n  override position() {\r\n    if (!this.isVisible() || !this.targetWorkspace!.isVisible()) {\r\n      return;\r\n    }\r\n    const metricsManager = this.targetWorkspace!.getMetricsManager();\r\n    const targetWorkspaceViewMetrics = metricsManager.getViewMetrics();\r\n    this.width_ = targetWorkspaceViewMetrics.width;\r\n\r\n    const edgeWidth = targetWorkspaceViewMetrics.width - 2 * this.CORNER_RADIUS;\r\n    const edgeHeight = this.height_ - this.CORNER_RADIUS;\r\n    this.setBackgroundPath(edgeWidth, edgeHeight);\r\n\r\n    const x = this.getX();\r\n    const y = this.getY();\r\n\r\n    this.positionAt_(this.width_, this.height_, x, y);\r\n  }\r\n\r\n  /**\r\n   * Create and set the path for the visible boundaries of the flyout.\r\n   *\r\n   * @param width The width of the flyout, not including the rounded corners.\r\n   * @param height The height of the flyout, not including rounded corners.\r\n   */\r\n  private setBackgroundPath(width: number, height: number) {\r\n    const atTop = this.toolboxPosition_ === toolbox.Position.TOP;\r\n    // Start at top left.\r\n    const path: (string | number)[] = [\r\n      'M 0,' + (atTop ? 0 : this.CORNER_RADIUS),\r\n    ];\r\n\r\n    if (atTop) {\r\n      // Top.\r\n      path.push('h', width + 2 * this.CORNER_RADIUS);\r\n      // Right.\r\n      path.push('v', height);\r\n      // Bottom.\r\n      path.push(\r\n        'a',\r\n        this.CORNER_RADIUS,\r\n        this.CORNER_RADIUS,\r\n        0,\r\n        0,\r\n        1,\r\n        -this.CORNER_RADIUS,\r\n        this.CORNER_RADIUS,\r\n      );\r\n      path.push('h', -width);\r\n      // Left.\r\n      path.push(\r\n        'a',\r\n        this.CORNER_RADIUS,\r\n        this.CORNER_RADIUS,\r\n        0,\r\n        0,\r\n        1,\r\n        -this.CORNER_RADIUS,\r\n        -this.CORNER_RADIUS,\r\n      );\r\n      path.push('z');\r\n    } else {\r\n      // Top.\r\n      path.push(\r\n        'a',\r\n        this.CORNER_RADIUS,\r\n        this.CORNER_RADIUS,\r\n        0,\r\n        0,\r\n        1,\r\n        this.CORNER_RADIUS,\r\n        -this.CORNER_RADIUS,\r\n      );\r\n      path.push('h', width);\r\n      // Right.\r\n      path.push(\r\n        'a',\r\n        this.CORNER_RADIUS,\r\n        this.CORNER_RADIUS,\r\n        0,\r\n        0,\r\n        1,\r\n        this.CORNER_RADIUS,\r\n        this.CORNER_RADIUS,\r\n      );\r\n      path.push('v', height);\r\n      // Bottom.\r\n      path.push('h', -width - 2 * this.CORNER_RADIUS);\r\n      // Left.\r\n      path.push('z');\r\n    }\r\n    this.svgBackground_!.setAttribute('d', path.join(' '));\r\n  }\r\n\r\n  /** Scroll the flyout to the top. */\r\n  override scrollToStart() {\r\n    this.workspace_.scrollbar?.setX(this.RTL ? Infinity : 0);\r\n  }\r\n\r\n  /**\r\n   * Scroll the flyout.\r\n   *\r\n   * @param e Mouse wheel scroll event.\r\n   */\r\n  protected override wheel_(e: WheelEvent) {\r\n    const scrollDelta = browserEvents.getScrollDeltaPixels(e);\r\n    const delta = scrollDelta.x || scrollDelta.y;\r\n\r\n    if (delta) {\r\n      const metricsManager = this.workspace_.getMetricsManager();\r\n      const scrollMetrics = metricsManager.getScrollMetrics();\r\n      const viewMetrics = metricsManager.getViewMetrics();\r\n\r\n      const pos = viewMetrics.left - scrollMetrics.left + delta;\r\n      this.workspace_.scrollbar?.setX(pos);\r\n      // When the flyout moves from a wheel event, hide WidgetDiv and\r\n      // dropDownDiv.\r\n      WidgetDiv.hide();\r\n      dropDownDiv.hideWithoutAnimation();\r\n    }\r\n    // Don't scroll the page.\r\n    e.preventDefault();\r\n    // Don't propagate mousewheel event (zooming).\r\n    e.stopPropagation();\r\n  }\r\n\r\n  /**\r\n   * Lay out the blocks in the flyout.\r\n   *\r\n   * @param contents The blocks and buttons to lay out.\r\n   * @param gaps The visible gaps between blocks.\r\n   */\r\n  protected override layout_(contents: FlyoutItem[], gaps: number[]) {\r\n    this.workspace_.scale = this.targetWorkspace!.scale;\r\n    const margin = this.MARGIN;\r\n    let cursorX = margin + this.tabWidth_;\r\n    const cursorY = margin;\r\n    if (this.RTL) {\r\n      contents = contents.reverse();\r\n    }\r\n\r\n    for (let i = 0, item; (item = contents[i]); i++) {\r\n      if (item.type === 'block') {\r\n        const block = item.block;\r\n        const allBlocks = block!.getDescendants(false);\r\n        for (let j = 0, child; (child = allBlocks[j]); j++) {\r\n          // Mark blocks as being inside a flyout.  This is used to detect and\r\n          // prevent the closure of the flyout if the user right-clicks on such\r\n          // a block.\r\n          child.isInFlyout = true;\r\n        }\r\n        const root = block!.getSvgRoot();\r\n        const blockHW = block!.getHeightWidth();\r\n        // Figure out where to place the block.\r\n        const tab = block!.outputConnection ? this.tabWidth_ : 0;\r\n        let moveX;\r\n        if (this.RTL) {\r\n          moveX = cursorX + blockHW.width;\r\n        } else {\r\n          moveX = cursorX - tab;\r\n        }\r\n        block!.moveBy(moveX, cursorY);\r\n\r\n        const rect = this.createRect_(block!, moveX, cursorY, blockHW, i);\r\n        cursorX += blockHW.width + gaps[i];\r\n\r\n        this.addBlockListeners_(root, block!, rect);\r\n      } else if (item.type === 'button') {\r\n        const button = item.button as FlyoutButton;\r\n        this.initFlyoutButton_(button, cursorX, cursorY);\r\n        cursorX += button.width + gaps[i];\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Determine if a drag delta is toward the workspace, based on the position\r\n   * and orientation of the flyout. This is used in determineDragIntention_ to\r\n   * determine if a new block should be created or if the flyout should scroll.\r\n   *\r\n   * @param currentDragDeltaXY How far the pointer has moved from the position\r\n   *     at mouse down, in pixel units.\r\n   * @returns True if the drag is toward the workspace.\r\n   * @internal\r\n   */\r\n  override isDragTowardWorkspace(currentDragDeltaXY: Coordinate): boolean {\r\n    const dx = currentDragDeltaXY.x;\r\n    const dy = currentDragDeltaXY.y;\r\n    // Direction goes from -180 to 180, with 0 toward the right and 90 on top.\r\n    const dragDirection = (Math.atan2(dy, dx) / Math.PI) * 180;\r\n\r\n    const range = this.dragAngleRange_;\r\n    // Check for up or down dragging.\r\n    if (\r\n      (dragDirection < 90 + range && dragDirection > 90 - range) ||\r\n      (dragDirection > -90 - range && dragDirection < -90 + range)\r\n    ) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Returns the bounding rectangle of the drag target area in pixel units\r\n   * relative to viewport.\r\n   *\r\n   * @returns The component's bounding box. Null if drag target area should be\r\n   *     ignored.\r\n   */\r\n  override getClientRect(): Rect | null {\r\n    if (!this.svgGroup_ || this.autoClose || !this.isVisible()) {\r\n      // The bounding rectangle won't compute correctly if the flyout is closed\r\n      // and auto-close flyouts aren't valid drag targets (or delete areas).\r\n      return null;\r\n    }\r\n\r\n    const flyoutRect = this.svgGroup_.getBoundingClientRect();\r\n    // BIG_NUM is offscreen padding so that blocks dragged beyond the shown\r\n    // flyout area are still deleted.  Must be larger than the largest screen\r\n    // size, but be smaller than half Number.MAX_SAFE_INTEGER (not available on\r\n    // IE).\r\n    const BIG_NUM = 1000000000;\r\n    const top = flyoutRect.top;\r\n\r\n    if (this.toolboxPosition_ === toolbox.Position.TOP) {\r\n      const height = flyoutRect.height;\r\n      return new Rect(-BIG_NUM, top + height, -BIG_NUM, BIG_NUM);\r\n    } else {\r\n      // Bottom.\r\n      return new Rect(top, BIG_NUM, -BIG_NUM, BIG_NUM);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Compute height of flyout.  toolbox.Position mat under each block.\r\n   * For RTL: Lay out the blocks right-aligned.\r\n   */\r\n  protected override reflowInternal_() {\r\n    this.workspace_.scale = this.getFlyoutScale();\r\n    let flyoutHeight = 0;\r\n    const blocks = this.workspace_.getTopBlocks(false);\r\n    for (let i = 0, block; (block = blocks[i]); i++) {\r\n      flyoutHeight = Math.max(flyoutHeight, block.getHeightWidth().height);\r\n    }\r\n    const buttons = this.buttons_;\r\n    for (let i = 0, button; (button = buttons[i]); i++) {\r\n      flyoutHeight = Math.max(flyoutHeight, button.height);\r\n    }\r\n    flyoutHeight += this.MARGIN * 1.5;\r\n    flyoutHeight *= this.workspace_.scale;\r\n    flyoutHeight += Scrollbar.scrollbarThickness;\r\n\r\n    if (this.height_ !== flyoutHeight) {\r\n      for (let i = 0, block; (block = blocks[i]); i++) {\r\n        if (this.rectMap_.has(block)) {\r\n          this.moveRectToBlock_(this.rectMap_.get(block)!, block);\r\n        }\r\n      }\r\n\r\n      // TODO(#7689): Remove this.\r\n      // Workspace with no scrollbars where this is permanently open on the top.\r\n      // If scrollbars exist they properly update the metrics.\r\n      if (\r\n        !this.targetWorkspace.scrollbar &&\r\n        !this.autoClose &&\r\n        this.targetWorkspace.getFlyout() === this &&\r\n        this.toolboxPosition_ === toolbox.Position.TOP\r\n      ) {\r\n        this.targetWorkspace.translate(\r\n          this.targetWorkspace.scrollX,\r\n          this.targetWorkspace.scrollY + flyoutHeight,\r\n        );\r\n      }\r\n\r\n      this.height_ = flyoutHeight;\r\n      this.position();\r\n      this.targetWorkspace.resizeContents();\r\n      this.targetWorkspace.recordDragTargets();\r\n    }\r\n  }\r\n}\r\n\r\nregistry.register(\r\n  registry.Type.FLYOUTS_HORIZONTAL_TOOLBOX,\r\n  registry.DEFAULT,\r\n  HorizontalFlyout,\r\n);\r\n","/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Layout code for a vertical variant of the flyout.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.VerticalFlyout\r\n\r\nimport * as browserEvents from './browser_events.js';\r\nimport * as dropDownDiv from './dropdowndiv.js';\r\nimport {Flyout, FlyoutItem} from './flyout_base.js';\r\nimport type {FlyoutButton} from './flyout_button.js';\r\nimport type {Options} from './options.js';\r\nimport * as registry from './registry.js';\r\nimport {Scrollbar} from './scrollbar.js';\r\nimport type {Coordinate} from './utils/coordinate.js';\r\nimport {Rect} from './utils/rect.js';\r\nimport * as toolbox from './utils/toolbox.js';\r\nimport * as WidgetDiv from './widgetdiv.js';\r\n\r\n/**\r\n * Class for a flyout.\r\n */\r\nexport class VerticalFlyout extends Flyout {\r\n  /** The name of the vertical flyout in the registry. */\r\n  static registryName = 'verticalFlyout';\r\n\r\n  /** @param workspaceOptions Dictionary of options for the workspace. */\r\n  constructor(workspaceOptions: Options) {\r\n    super(workspaceOptions);\r\n  }\r\n\r\n  /**\r\n   * Sets the translation of the flyout to match the scrollbars.\r\n   *\r\n   * @param xyRatio Contains a y property which is a float between 0 and 1\r\n   *     specifying the degree of scrolling and a similar x property.\r\n   */\r\n  protected override setMetrics_(xyRatio: {x: number; y: number}) {\r\n    if (!this.isVisible()) {\r\n      return;\r\n    }\r\n    const metricsManager = this.workspace_.getMetricsManager();\r\n    const scrollMetrics = metricsManager.getScrollMetrics();\r\n    const viewMetrics = metricsManager.getViewMetrics();\r\n    const absoluteMetrics = metricsManager.getAbsoluteMetrics();\r\n\r\n    if (typeof xyRatio.y === 'number') {\r\n      this.workspace_.scrollY = -(\r\n        scrollMetrics.top +\r\n        (scrollMetrics.height - viewMetrics.height) * xyRatio.y\r\n      );\r\n    }\r\n    this.workspace_.translate(\r\n      this.workspace_.scrollX + absoluteMetrics.left,\r\n      this.workspace_.scrollY + absoluteMetrics.top,\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Calculates the x coordinate for the flyout position.\r\n   *\r\n   * @returns X coordinate.\r\n   */\r\n  override getX(): number {\r\n    if (!this.isVisible()) {\r\n      return 0;\r\n    }\r\n    const metricsManager = this.targetWorkspace!.getMetricsManager();\r\n    const absoluteMetrics = metricsManager.getAbsoluteMetrics();\r\n    const viewMetrics = metricsManager.getViewMetrics();\r\n    const toolboxMetrics = metricsManager.getToolboxMetrics();\r\n    let x = 0;\r\n\r\n    // If this flyout is not the trashcan flyout (e.g. toolbox or mutator).\r\n    // Trashcan flyout is opposite the main flyout.\r\n    if (this.targetWorkspace!.toolboxPosition === this.toolboxPosition_) {\r\n      // If there is a category toolbox.\r\n      // Simple (flyout-only) toolbox.\r\n      if (this.targetWorkspace!.getToolbox()) {\r\n        if (this.toolboxPosition_ === toolbox.Position.LEFT) {\r\n          x = toolboxMetrics.width;\r\n        } else {\r\n          x = viewMetrics.width - this.width_;\r\n        }\r\n      } else {\r\n        if (this.toolboxPosition_ === toolbox.Position.LEFT) {\r\n          x = 0;\r\n        } else {\r\n          // The simple flyout does not cover the workspace.\r\n          x = viewMetrics.width;\r\n        }\r\n      }\r\n    } else {\r\n      if (this.toolboxPosition_ === toolbox.Position.LEFT) {\r\n        x = 0;\r\n      } else {\r\n        // Because the anchor point of the flyout is on the left, but we want\r\n        // to align the right edge of the flyout with the right edge of the\r\n        // blocklyDiv, we calculate the full width of the div minus the width\r\n        // of the flyout.\r\n        x = viewMetrics.width + absoluteMetrics.left - this.width_;\r\n      }\r\n    }\r\n\r\n    return x;\r\n  }\r\n\r\n  /**\r\n   * Calculates the y coordinate for the flyout position.\r\n   *\r\n   * @returns Y coordinate.\r\n   */\r\n  override getY(): number {\r\n    // Y is always 0 since this is a vertical flyout.\r\n    return 0;\r\n  }\r\n\r\n  /** Move the flyout to the edge of the workspace. */\r\n  override position() {\r\n    if (!this.isVisible() || !this.targetWorkspace!.isVisible()) {\r\n      return;\r\n    }\r\n    const metricsManager = this.targetWorkspace!.getMetricsManager();\r\n    const targetWorkspaceViewMetrics = metricsManager.getViewMetrics();\r\n    this.height_ = targetWorkspaceViewMetrics.height;\r\n\r\n    const edgeWidth = this.width_ - this.CORNER_RADIUS;\r\n    const edgeHeight =\r\n      targetWorkspaceViewMetrics.height - 2 * this.CORNER_RADIUS;\r\n    this.setBackgroundPath(edgeWidth, edgeHeight);\r\n\r\n    const x = this.getX();\r\n    const y = this.getY();\r\n\r\n    this.positionAt_(this.width_, this.height_, x, y);\r\n  }\r\n\r\n  /**\r\n   * Create and set the path for the visible boundaries of the flyout.\r\n   *\r\n   * @param width The width of the flyout, not including the rounded corners.\r\n   * @param height The height of the flyout, not including rounded corners.\r\n   */\r\n  private setBackgroundPath(width: number, height: number) {\r\n    const atRight = this.toolboxPosition_ === toolbox.Position.RIGHT;\r\n    const totalWidth = width + this.CORNER_RADIUS;\r\n\r\n    // Decide whether to start on the left or right.\r\n    const path: Array<string | number> = [\r\n      'M ' + (atRight ? totalWidth : 0) + ',0',\r\n    ];\r\n    // Top.\r\n    path.push('h', atRight ? -width : width);\r\n    // Rounded corner.\r\n    path.push(\r\n      'a',\r\n      this.CORNER_RADIUS,\r\n      this.CORNER_RADIUS,\r\n      0,\r\n      0,\r\n      atRight ? 0 : 1,\r\n      atRight ? -this.CORNER_RADIUS : this.CORNER_RADIUS,\r\n      this.CORNER_RADIUS,\r\n    );\r\n    // Side closest to workspace.\r\n    path.push('v', Math.max(0, height));\r\n    // Rounded corner.\r\n    path.push(\r\n      'a',\r\n      this.CORNER_RADIUS,\r\n      this.CORNER_RADIUS,\r\n      0,\r\n      0,\r\n      atRight ? 0 : 1,\r\n      atRight ? this.CORNER_RADIUS : -this.CORNER_RADIUS,\r\n      this.CORNER_RADIUS,\r\n    );\r\n    // Bottom.\r\n    path.push('h', atRight ? width : -width);\r\n    path.push('z');\r\n    this.svgBackground_!.setAttribute('d', path.join(' '));\r\n  }\r\n\r\n  /** Scroll the flyout to the top. */\r\n  override scrollToStart() {\r\n    this.workspace_.scrollbar?.setY(0);\r\n  }\r\n\r\n  /**\r\n   * Scroll the flyout.\r\n   *\r\n   * @param e Mouse wheel scroll event.\r\n   */\r\n  protected override wheel_(e: WheelEvent) {\r\n    const scrollDelta = browserEvents.getScrollDeltaPixels(e);\r\n\r\n    if (scrollDelta.y) {\r\n      const metricsManager = this.workspace_.getMetricsManager();\r\n      const scrollMetrics = metricsManager.getScrollMetrics();\r\n      const viewMetrics = metricsManager.getViewMetrics();\r\n      const pos = viewMetrics.top - scrollMetrics.top + scrollDelta.y;\r\n\r\n      this.workspace_.scrollbar?.setY(pos);\r\n      // When the flyout moves from a wheel event, hide WidgetDiv and\r\n      // dropDownDiv.\r\n      WidgetDiv.hide();\r\n      dropDownDiv.hideWithoutAnimation();\r\n    }\r\n    // Don't scroll the page.\r\n    e.preventDefault();\r\n    // Don't propagate mousewheel event (zooming).\r\n    e.stopPropagation();\r\n  }\r\n\r\n  /**\r\n   * Lay out the blocks in the flyout.\r\n   *\r\n   * @param contents The blocks and buttons to lay out.\r\n   * @param gaps The visible gaps between blocks.\r\n   */\r\n  protected override layout_(contents: FlyoutItem[], gaps: number[]) {\r\n    this.workspace_.scale = this.targetWorkspace!.scale;\r\n    const margin = this.MARGIN;\r\n    const cursorX = this.RTL ? margin : margin + this.tabWidth_;\r\n    let cursorY = margin;\r\n\r\n    for (let i = 0, item; (item = contents[i]); i++) {\r\n      if (item.type === 'block') {\r\n        const block = item.block;\r\n        const allBlocks = block!.getDescendants(false);\r\n        for (let j = 0, child; (child = allBlocks[j]); j++) {\r\n          // Mark blocks as being inside a flyout.  This is used to detect and\r\n          // prevent the closure of the flyout if the user right-clicks on such\r\n          // a block.\r\n          child.isInFlyout = true;\r\n        }\r\n        const root = block!.getSvgRoot();\r\n        const blockHW = block!.getHeightWidth();\r\n        const moveX = block!.outputConnection\r\n          ? cursorX - this.tabWidth_\r\n          : cursorX;\r\n        block!.moveBy(moveX, cursorY);\r\n\r\n        const rect = this.createRect_(\r\n          block!,\r\n          this.RTL ? moveX - blockHW.width : moveX,\r\n          cursorY,\r\n          blockHW,\r\n          i,\r\n        );\r\n\r\n        this.addBlockListeners_(root, block!, rect);\r\n\r\n        cursorY += blockHW.height + gaps[i];\r\n      } else if (item.type === 'button') {\r\n        const button = item.button as FlyoutButton;\r\n        this.initFlyoutButton_(button, cursorX, cursorY);\r\n        cursorY += button.height + gaps[i];\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Determine if a drag delta is toward the workspace, based on the position\r\n   * and orientation of the flyout. This is used in determineDragIntention_ to\r\n   * determine if a new block should be created or if the flyout should scroll.\r\n   *\r\n   * @param currentDragDeltaXY How far the pointer has moved from the position\r\n   *     at mouse down, in pixel units.\r\n   * @returns True if the drag is toward the workspace.\r\n   * @internal\r\n   */\r\n  override isDragTowardWorkspace(currentDragDeltaXY: Coordinate): boolean {\r\n    const dx = currentDragDeltaXY.x;\r\n    const dy = currentDragDeltaXY.y;\r\n    // Direction goes from -180 to 180, with 0 toward the right and 90 on top.\r\n    const dragDirection = (Math.atan2(dy, dx) / Math.PI) * 180;\r\n\r\n    const range = this.dragAngleRange_;\r\n    // Check for left or right dragging.\r\n    if (\r\n      (dragDirection < range && dragDirection > -range) ||\r\n      dragDirection < -180 + range ||\r\n      dragDirection > 180 - range\r\n    ) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Returns the bounding rectangle of the drag target area in pixel units\r\n   * relative to viewport.\r\n   *\r\n   * @returns The component's bounding box. Null if drag target area should be\r\n   *     ignored.\r\n   */\r\n  override getClientRect(): Rect | null {\r\n    if (!this.svgGroup_ || this.autoClose || !this.isVisible()) {\r\n      // The bounding rectangle won't compute correctly if the flyout is closed\r\n      // and auto-close flyouts aren't valid drag targets (or delete areas).\r\n      return null;\r\n    }\r\n\r\n    const flyoutRect = this.svgGroup_.getBoundingClientRect();\r\n    // BIG_NUM is offscreen padding so that blocks dragged beyond the shown\r\n    // flyout area are still deleted.  Must be larger than the largest screen\r\n    // size, but be smaller than half Number.MAX_SAFE_INTEGER (not available on\r\n    // IE).\r\n    const BIG_NUM = 1000000000;\r\n    const left = flyoutRect.left;\r\n\r\n    if (this.toolboxPosition_ === toolbox.Position.LEFT) {\r\n      const width = flyoutRect.width;\r\n      return new Rect(-BIG_NUM, BIG_NUM, -BIG_NUM, left + width);\r\n    } else {\r\n      // Right\r\n      return new Rect(-BIG_NUM, BIG_NUM, left, BIG_NUM);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Compute width of flyout.  toolbox.Position mat under each block.\r\n   * For RTL: Lay out the blocks and buttons to be right-aligned.\r\n   */\r\n  protected override reflowInternal_() {\r\n    this.workspace_.scale = this.getFlyoutScale();\r\n    let flyoutWidth = 0;\r\n    const blocks = this.workspace_.getTopBlocks(false);\r\n    for (let i = 0, block; (block = blocks[i]); i++) {\r\n      let width = block.getHeightWidth().width;\r\n      if (block.outputConnection) {\r\n        width -= this.tabWidth_;\r\n      }\r\n      flyoutWidth = Math.max(flyoutWidth, width);\r\n    }\r\n    for (let i = 0, button; (button = this.buttons_[i]); i++) {\r\n      flyoutWidth = Math.max(flyoutWidth, button.width);\r\n    }\r\n    flyoutWidth += this.MARGIN * 1.5 + this.tabWidth_;\r\n    flyoutWidth *= this.workspace_.scale;\r\n    flyoutWidth += Scrollbar.scrollbarThickness;\r\n\r\n    if (this.width_ !== flyoutWidth) {\r\n      for (let i = 0, block; (block = blocks[i]); i++) {\r\n        if (this.RTL) {\r\n          // With the flyoutWidth known, right-align the blocks.\r\n          const oldX = block.getRelativeToSurfaceXY().x;\r\n          let newX = flyoutWidth / this.workspace_.scale - this.MARGIN;\r\n          if (!block.outputConnection) {\r\n            newX -= this.tabWidth_;\r\n          }\r\n          block.moveBy(newX - oldX, 0);\r\n        }\r\n        if (this.rectMap_.has(block)) {\r\n          this.moveRectToBlock_(this.rectMap_.get(block)!, block);\r\n        }\r\n      }\r\n      if (this.RTL) {\r\n        // With the flyoutWidth known, right-align the buttons.\r\n        for (let i = 0, button; (button = this.buttons_[i]); i++) {\r\n          const y = button.getPosition().y;\r\n          const x =\r\n            flyoutWidth / this.workspace_.scale -\r\n            button.width -\r\n            this.MARGIN -\r\n            this.tabWidth_;\r\n          button.moveTo(x, y);\r\n        }\r\n      }\r\n\r\n      // TODO(#7689): Remove this.\r\n      // Workspace with no scrollbars where this is permanently\r\n      // open on the left.\r\n      // If scrollbars exist they properly update the metrics.\r\n      if (\r\n        !this.targetWorkspace.scrollbar &&\r\n        !this.autoClose &&\r\n        this.targetWorkspace.getFlyout() === this &&\r\n        this.toolboxPosition_ === toolbox.Position.LEFT\r\n      ) {\r\n        this.targetWorkspace.translate(\r\n          this.targetWorkspace.scrollX + flyoutWidth,\r\n          this.targetWorkspace.scrollY,\r\n        );\r\n      }\r\n\r\n      this.width_ = flyoutWidth;\r\n      this.position();\r\n      this.targetWorkspace.resizeContents();\r\n      this.targetWorkspace.recordDragTargets();\r\n    }\r\n  }\r\n}\r\n\r\nregistry.register(\r\n  registry.Type.FLYOUTS_VERTICAL_TOOLBOX,\r\n  registry.DEFAULT,\r\n  VerticalFlyout,\r\n);\r\n","/**\r\n * @license\r\n * Copyright 2012 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Utility functions for generating executable code from\r\n * Blockly code.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.CodeGenerator\r\n\r\nimport type {Block} from './block.js';\r\nimport * as common from './common.js';\r\nimport {Names, NameType} from './names.js';\r\nimport type {Workspace} from './workspace.js';\r\nimport {warn} from './utils/deprecation.js';\r\n\r\n/**\r\n * Deprecated, no-longer used type declaration for per-block-type generator\r\n * functions.\r\n *\r\n * @deprecated\r\n * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/generating-code}\r\n * @param block The Block instance to generate code for.\r\n * @param genearator The CodeGenerator calling the function.\r\n * @returns A string containing the generated code (for statement blocks),\r\n *     or a [code, precedence] tuple (for value/expression blocks), or\r\n *     null if no code should be emitted for block.\r\n */\r\nexport type BlockGenerator = (\r\n  block: Block,\r\n  generator: CodeGenerator,\r\n) => [string, number] | string | null;\r\n\r\n/**\r\n * Class for a code generator that translates the blocks into a language.\r\n */\r\nexport class CodeGenerator {\r\n  name_: string;\r\n\r\n  /**\r\n   * A dictionary of block generator functions, keyed by block type.\r\n   * Each block generator function takes two parameters:\r\n   *\r\n   * - the Block to generate code for, and\r\n   * - the calling CodeGenerator (or subclass) instance, so the\r\n   *   function can call methods defined below (e.g. blockToCode) or\r\n   *   on the relevant subclass (e.g. JavascripGenerator),\r\n   *\r\n   * and returns:\r\n   *\r\n   * - a [code, precedence] tuple (for value/expression blocks), or\r\n   * - a string containing the generated code (for statement blocks), or\r\n   * - null if no code should be emitted for block.\r\n   */\r\n  forBlock: Record<\r\n    string,\r\n    (block: Block, generator: this) => [string, number] | string | null\r\n  > = Object.create(null);\r\n\r\n  /**\r\n   * This is used as a placeholder in functions defined using\r\n   * CodeGenerator.provideFunction_.  It must not be legal code that could\r\n   * legitimately appear in a function definition (or comment), and it must\r\n   * not confuse the regular expression parser.\r\n   */\r\n  FUNCTION_NAME_PLACEHOLDER_ = '{leCUI8hutHZI4480Dc}';\r\n  FUNCTION_NAME_PLACEHOLDER_REGEXP_: RegExp;\r\n\r\n  /**\r\n   * Arbitrary code to inject into locations that risk causing infinite loops.\r\n   * Any instances of '%1' will be replaced by the block ID that failed.\r\n   * E.g. `  checkTimeout(%1);\\n`\r\n   */\r\n  INFINITE_LOOP_TRAP: string | null = null;\r\n\r\n  /**\r\n   * Arbitrary code to inject before every statement.\r\n   * Any instances of '%1' will be replaced by the block ID of the statement.\r\n   * E.g. `highlight(%1);\\n`\r\n   */\r\n  STATEMENT_PREFIX: string | null = null;\r\n\r\n  /**\r\n   * Arbitrary code to inject after every statement.\r\n   * Any instances of '%1' will be replaced by the block ID of the statement.\r\n   * E.g. `highlight(%1);\\n`\r\n   */\r\n  STATEMENT_SUFFIX: string | null = null;\r\n\r\n  /**\r\n   * The method of indenting.  Defaults to two spaces, but language generators\r\n   * may override this to increase indent or change to tabs.\r\n   */\r\n  INDENT = '  ';\r\n\r\n  /**\r\n   * Maximum length for a comment before wrapping.  Does not account for\r\n   * indenting level.\r\n   */\r\n  COMMENT_WRAP = 60;\r\n\r\n  /** List of outer-inner pairings that do NOT require parentheses. */\r\n  ORDER_OVERRIDES: number[][] = [];\r\n\r\n  /**\r\n   * Whether the init method has been called.\r\n   * Generators that set this flag to false after creation and true in init\r\n   * will cause blockToCode to emit a warning if the generator has not been\r\n   * initialized. If this flag is untouched, it will have no effect.\r\n   */\r\n  isInitialized: boolean | null = null;\r\n\r\n  /** Comma-separated list of reserved words. */\r\n  protected RESERVED_WORDS_ = '';\r\n\r\n  /** A dictionary of definitions to be printed before the code. */\r\n  protected definitions_: {[key: string]: string} = Object.create(null);\r\n\r\n  /**\r\n   * A dictionary mapping desired function names in definitions_ to actual\r\n   * function names (to avoid collisions with user functions).\r\n   */\r\n  protected functionNames_: {[key: string]: string} = Object.create(null);\r\n\r\n  /** A database of variable and procedure names. */\r\n  nameDB_?: Names = undefined;\r\n\r\n  /** @param name Language name of this generator. */\r\n  constructor(name: string) {\r\n    this.name_ = name;\r\n\r\n    this.FUNCTION_NAME_PLACEHOLDER_REGEXP_ = new RegExp(\r\n      this.FUNCTION_NAME_PLACEHOLDER_,\r\n      'g',\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Generate code for all blocks in the workspace to the specified language.\r\n   *\r\n   * @param workspace Workspace to generate code from.\r\n   * @returns Generated code.\r\n   */\r\n  workspaceToCode(workspace?: Workspace): string {\r\n    if (!workspace) {\r\n      // Backwards compatibility from before there could be multiple workspaces.\r\n      console.warn(\r\n        'No workspace specified in workspaceToCode call.  Guessing.',\r\n      );\r\n      workspace = common.getMainWorkspace();\r\n    }\r\n    const code = [];\r\n    this.init(workspace);\r\n    const blocks = workspace.getTopBlocks(true);\r\n    for (let i = 0, block; (block = blocks[i]); i++) {\r\n      let line = this.blockToCode(block);\r\n      if (Array.isArray(line)) {\r\n        // Value blocks return tuples of code and operator order.\r\n        // Top-level blocks don't care about operator order.\r\n        line = line[0];\r\n      }\r\n      if (line) {\r\n        if (block.outputConnection) {\r\n          // This block is a naked value.  Ask the language's code generator if\r\n          // it wants to append a semicolon, or something.\r\n          line = this.scrubNakedValue(line);\r\n          if (this.STATEMENT_PREFIX && !block.suppressPrefixSuffix) {\r\n            line = this.injectId(this.STATEMENT_PREFIX, block) + line;\r\n          }\r\n          if (this.STATEMENT_SUFFIX && !block.suppressPrefixSuffix) {\r\n            line = line + this.injectId(this.STATEMENT_SUFFIX, block);\r\n          }\r\n        }\r\n        code.push(line);\r\n      }\r\n    }\r\n    // Blank line between each section.\r\n    let codeString = code.join('\\n');\r\n    codeString = this.finish(codeString);\r\n    // Final scrubbing of whitespace.\r\n    codeString = codeString.replace(/^\\s+\\n/, '');\r\n    codeString = codeString.replace(/\\n\\s+$/, '\\n');\r\n    codeString = codeString.replace(/[ \\t]+\\n/g, '\\n');\r\n    return codeString;\r\n  }\r\n\r\n  /**\r\n   * Prepend a common prefix onto each line of code.\r\n   * Intended for indenting code or adding comment markers.\r\n   *\r\n   * @param text The lines of code.\r\n   * @param prefix The common prefix.\r\n   * @returns The prefixed lines of code.\r\n   */\r\n  prefixLines(text: string, prefix: string): string {\r\n    return prefix + text.replace(/(?!\\n$)\\n/g, '\\n' + prefix);\r\n  }\r\n\r\n  /**\r\n   * Recursively spider a tree of blocks, returning all their comments.\r\n   *\r\n   * @param block The block from which to start spidering.\r\n   * @returns Concatenated list of comments.\r\n   */\r\n  allNestedComments(block: Block): string {\r\n    const comments = [];\r\n    const blocks = block.getDescendants(true);\r\n    for (let i = 0; i < blocks.length; i++) {\r\n      const comment = blocks[i].getCommentText();\r\n      if (comment) {\r\n        comments.push(comment);\r\n      }\r\n    }\r\n    // Append an empty string to create a trailing line break when joined.\r\n    if (comments.length) {\r\n      comments.push('');\r\n    }\r\n    return comments.join('\\n');\r\n  }\r\n\r\n  /**\r\n   * Generate code for the specified block (and attached blocks).\r\n   * The generator must be initialized before calling this function.\r\n   *\r\n   * @param block The block to generate code for.\r\n   * @param opt_thisOnly True to generate code for only this statement.\r\n   * @returns For statement blocks, the generated code.\r\n   *     For value blocks, an array containing the generated code and an\r\n   * operator order value.  Returns '' if block is null.\r\n   */\r\n  blockToCode(\r\n    block: Block | null,\r\n    opt_thisOnly?: boolean,\r\n  ): string | [string, number] {\r\n    if (this.isInitialized === false) {\r\n      console.warn(\r\n        'CodeGenerator init was not called before blockToCode was called.',\r\n      );\r\n    }\r\n    if (!block) {\r\n      return '';\r\n    }\r\n    if (!block.isEnabled()) {\r\n      // Skip past this block if it is disabled.\r\n      return opt_thisOnly ? '' : this.blockToCode(block.getNextBlock());\r\n    }\r\n    if (block.isInsertionMarker()) {\r\n      // Skip past insertion markers.\r\n      return opt_thisOnly ? '' : this.blockToCode(block.getChildren(false)[0]);\r\n    }\r\n\r\n    // Look up block generator function in dictionary - but fall back\r\n    // to looking up on this if not found, for backwards compatibility.\r\n    let func = this.forBlock[block.type];\r\n    if (!func && (this as any)[block.type]) {\r\n      warn(\r\n        'block generator functions on CodeGenerator objects',\r\n        '10.0',\r\n        '11.0',\r\n        'the .forBlock[blockType] dictionary',\r\n      );\r\n      func = (this as any)[block.type];\r\n    }\r\n    if (typeof func !== 'function') {\r\n      throw Error(\r\n        `${this.name_} generator does not know how to generate code ` +\r\n          `for block type \"${block.type}\".`,\r\n      );\r\n    }\r\n    // First argument to func.call is the value of 'this' in the generator.\r\n    // Prior to 24 September 2013 'this' was the only way to access the block.\r\n    // The current preferred method of accessing the block is through the second\r\n    // argument to func.call, which becomes the first parameter to the\r\n    // generator.\r\n    let code = func.call(block, block, this);\r\n    if (Array.isArray(code)) {\r\n      // Value blocks return tuples of code and operator order.\r\n      if (!block.outputConnection) {\r\n        throw TypeError('Expecting string from statement block: ' + block.type);\r\n      }\r\n      return [this.scrub_(block, code[0], opt_thisOnly), code[1]];\r\n    } else if (typeof code === 'string') {\r\n      if (this.STATEMENT_PREFIX && !block.suppressPrefixSuffix) {\r\n        code = this.injectId(this.STATEMENT_PREFIX, block) + code;\r\n      }\r\n      if (this.STATEMENT_SUFFIX && !block.suppressPrefixSuffix) {\r\n        code = code + this.injectId(this.STATEMENT_SUFFIX, block);\r\n      }\r\n      return this.scrub_(block, code, opt_thisOnly);\r\n    } else if (code === null) {\r\n      // Block has handled code generation itself.\r\n      return '';\r\n    }\r\n    throw SyntaxError('Invalid code generated: ' + code);\r\n  }\r\n\r\n  /**\r\n   * Generate code representing the specified value input.\r\n   *\r\n   * @param block The block containing the input.\r\n   * @param name The name of the input.\r\n   * @param outerOrder The maximum binding strength (minimum order value) of any\r\n   *     operators adjacent to \"block\".\r\n   * @returns Generated code or '' if no blocks are connected or the specified\r\n   *     input does not exist.\r\n   */\r\n  valueToCode(block: Block, name: string, outerOrder: number): string {\r\n    if (isNaN(outerOrder)) {\r\n      throw TypeError('Expecting valid order from block: ' + block.type);\r\n    }\r\n    const targetBlock = block.getInputTargetBlock(name);\r\n    if (!targetBlock) {\r\n      return '';\r\n    }\r\n    const tuple = this.blockToCode(targetBlock);\r\n    if (tuple === '') {\r\n      // Disabled block.\r\n      return '';\r\n    }\r\n    // Value blocks must return code and order of operations info.\r\n    // Statement blocks must only return code.\r\n    if (!Array.isArray(tuple)) {\r\n      throw TypeError(\r\n        `Expecting tuple from value block: ${targetBlock.type} See ` +\r\n          `developers.google.com/blockly/guides/create-custom-blocks/generating-code ` +\r\n          `for more information`,\r\n      );\r\n    }\r\n    let code = tuple[0];\r\n    const innerOrder = tuple[1];\r\n    if (isNaN(innerOrder)) {\r\n      throw TypeError(\r\n        'Expecting valid order from value block: ' + targetBlock.type,\r\n      );\r\n    }\r\n    if (!code) {\r\n      return '';\r\n    }\r\n\r\n    // Add parentheses if needed.\r\n    let parensNeeded = false;\r\n    const outerOrderClass = Math.floor(outerOrder);\r\n    const innerOrderClass = Math.floor(innerOrder);\r\n    if (outerOrderClass <= innerOrderClass) {\r\n      if (\r\n        outerOrderClass === innerOrderClass &&\r\n        (outerOrderClass === 0 || outerOrderClass === 99)\r\n      ) {\r\n        // Don't generate parens around NONE-NONE and ATOMIC-ATOMIC pairs.\r\n        // 0 is the atomic order, 99 is the none order.  No parentheses needed.\r\n        // In all known languages multiple such code blocks are not order\r\n        // sensitive.  In fact in Python ('a' 'b') 'c' would fail.\r\n      } else {\r\n        // The operators outside this code are stronger than the operators\r\n        // inside this code.  To prevent the code from being pulled apart,\r\n        // wrap the code in parentheses.\r\n        parensNeeded = true;\r\n        // Check for special exceptions.\r\n        for (let i = 0; i < this.ORDER_OVERRIDES.length; i++) {\r\n          if (\r\n            this.ORDER_OVERRIDES[i][0] === outerOrder &&\r\n            this.ORDER_OVERRIDES[i][1] === innerOrder\r\n          ) {\r\n            parensNeeded = false;\r\n            break;\r\n          }\r\n        }\r\n      }\r\n    }\r\n    if (parensNeeded) {\r\n      // Technically, this should be handled on a language-by-language basis.\r\n      // However all known (sane) languages use parentheses for grouping.\r\n      code = '(' + code + ')';\r\n    }\r\n    return code;\r\n  }\r\n\r\n  /**\r\n   * Generate a code string representing the blocks attached to the named\r\n   * statement input. Indent the code.\r\n   * This is mainly used in generators. When trying to generate code to evaluate\r\n   * look at using workspaceToCode or blockToCode.\r\n   *\r\n   * @param block The block containing the input.\r\n   * @param name The name of the input.\r\n   * @returns Generated code or '' if no blocks are connected.\r\n   */\r\n  statementToCode(block: Block, name: string): string {\r\n    const targetBlock = block.getInputTargetBlock(name);\r\n    let code = this.blockToCode(targetBlock);\r\n    // Value blocks must return code and order of operations info.\r\n    // Statement blocks must only return code.\r\n    if (typeof code !== 'string') {\r\n      throw TypeError(\r\n        'Expecting code from statement block: ' +\r\n          (targetBlock && targetBlock.type),\r\n      );\r\n    }\r\n    if (code) {\r\n      code = this.prefixLines(code, this.INDENT);\r\n    }\r\n    return code;\r\n  }\r\n\r\n  /**\r\n   * Add an infinite loop trap to the contents of a loop.\r\n   * Add statement suffix at the start of the loop block (right after the loop\r\n   * statement executes), and a statement prefix to the end of the loop block\r\n   * (right before the loop statement executes).\r\n   *\r\n   * @param branch Code for loop contents.\r\n   * @param block Enclosing block.\r\n   * @returns Loop contents, with infinite loop trap added.\r\n   */\r\n  addLoopTrap(branch: string, block: Block): string {\r\n    if (this.INFINITE_LOOP_TRAP) {\r\n      branch =\r\n        this.prefixLines(\r\n          this.injectId(this.INFINITE_LOOP_TRAP, block),\r\n          this.INDENT,\r\n        ) + branch;\r\n    }\r\n    if (this.STATEMENT_SUFFIX && !block.suppressPrefixSuffix) {\r\n      branch =\r\n        this.prefixLines(\r\n          this.injectId(this.STATEMENT_SUFFIX, block),\r\n          this.INDENT,\r\n        ) + branch;\r\n    }\r\n    if (this.STATEMENT_PREFIX && !block.suppressPrefixSuffix) {\r\n      branch =\r\n        branch +\r\n        this.prefixLines(\r\n          this.injectId(this.STATEMENT_PREFIX, block),\r\n          this.INDENT,\r\n        );\r\n    }\r\n    return branch;\r\n  }\r\n\r\n  /**\r\n   * Inject a block ID into a message to replace '%1'.\r\n   * Used for STATEMENT_PREFIX, STATEMENT_SUFFIX, and INFINITE_LOOP_TRAP.\r\n   *\r\n   * @param msg Code snippet with '%1'.\r\n   * @param block Block which has an ID.\r\n   * @returns Code snippet with ID.\r\n   */\r\n  injectId(msg: string, block: Block): string {\r\n    const id = block.id.replace(/\\$/g, '$$$$'); // Issue 251.\r\n    return msg.replace(/%1/g, \"'\" + id + \"'\");\r\n  }\r\n\r\n  /**\r\n   * Add one or more words to the list of reserved words for this language.\r\n   *\r\n   * @param words Comma-separated list of words to add to the list.\r\n   *     No spaces.  Duplicates are ok.\r\n   */\r\n  addReservedWords(words: string) {\r\n    this.RESERVED_WORDS_ += words + ',';\r\n  }\r\n\r\n  /**\r\n   * Define a developer-defined function (not a user-defined procedure) to be\r\n   * included in the generated code.  Used for creating private helper\r\n   * functions. The first time this is called with a given desiredName, the code\r\n   * is saved and an actual name is generated.  Subsequent calls with the same\r\n   * desiredName have no effect but have the same return value.\r\n   *\r\n   * It is up to the caller to make sure the same desiredName is not\r\n   * used for different helper functions (e.g. use \"colourRandom\" and\r\n   * \"listRandom\", not \"random\").  There is no danger of colliding with reserved\r\n   * words, or user-defined variable or procedure names.\r\n   *\r\n   * The code gets output when CodeGenerator.finish() is called.\r\n   *\r\n   * @param desiredName The desired name of the function (e.g. mathIsPrime).\r\n   * @param code A list of statements or one multi-line code string.  Use '  '\r\n   *     for indents (they will be replaced).\r\n   * @returns The actual name of the new function.  This may differ from\r\n   *     desiredName if the former has already been taken by the user.\r\n   */\r\n  provideFunction_(desiredName: string, code: string[] | string): string {\r\n    if (!this.definitions_[desiredName]) {\r\n      const functionName = this.nameDB_!.getDistinctName(\r\n        desiredName,\r\n        NameType.PROCEDURE,\r\n      );\r\n      this.functionNames_[desiredName] = functionName;\r\n      if (Array.isArray(code)) {\r\n        code = code.join('\\n');\r\n      }\r\n      let codeText = code\r\n        .trim()\r\n        .replace(this.FUNCTION_NAME_PLACEHOLDER_REGEXP_, functionName);\r\n      // Change all '  ' indents into the desired indent.\r\n      // To avoid an infinite loop of replacements, change all indents to '\\0'\r\n      // character first, then replace them all with the indent.\r\n      // We are assuming that no provided functions contain a literal null char.\r\n      let oldCodeText;\r\n      while (oldCodeText !== codeText) {\r\n        oldCodeText = codeText;\r\n        codeText = codeText.replace(/^(( {2})*) {2}/gm, '$1\\0');\r\n      }\r\n      codeText = codeText.replace(/\\0/g, this.INDENT);\r\n      this.definitions_[desiredName] = codeText;\r\n    }\r\n    return this.functionNames_[desiredName];\r\n  }\r\n\r\n  /**\r\n   * Gets a unique, legal name for a user-defined variable.\r\n   * Before calling this method, the `nameDB_` property of the class\r\n   * must have been initialized already. This is typically done in\r\n   * the `init` function of the code generator class.\r\n   *\r\n   * @param nameOrId The ID of the variable to get a name for,\r\n   *    or the proposed name for a variable not associated with an id.\r\n   * @returns A unique, legal name for the variable.\r\n   */\r\n  getVariableName(nameOrId: string): string {\r\n    return this.getName(nameOrId, NameType.VARIABLE);\r\n  }\r\n\r\n  /**\r\n   * Gets a unique, legal name for a user-defined procedure.\r\n   * Before calling this method, the `nameDB_` property of the class\r\n   * must have been initialized already. This is typically done in\r\n   * the `init` function of the code generator class.\r\n   *\r\n   * @param name The proposed name for a procedure.\r\n   * @returns A unique, legal name for the procedure.\r\n   */\r\n  getProcedureName(name: string): string {\r\n    return this.getName(name, NameType.PROCEDURE);\r\n  }\r\n\r\n  private getName(nameOrId: string, type: NameType): string {\r\n    if (!this.nameDB_) {\r\n      throw new Error(\r\n        'Name database is not defined. You must initialize `nameDB_` in your generator class and call `init` first.',\r\n      );\r\n    }\r\n    return this.nameDB_.getName(nameOrId, type);\r\n  }\r\n\r\n  /**\r\n   * Hook for code to run before code generation starts.\r\n   * Subclasses may override this, e.g. to initialise the database of variable\r\n   * names.\r\n   *\r\n   * @param _workspace Workspace to generate code from.\r\n   */\r\n  init(_workspace: Workspace) {\r\n    // Optionally override\r\n    // Create a dictionary of definitions to be printed before the code.\r\n    this.definitions_ = Object.create(null);\r\n    // Create a dictionary mapping desired developer-defined function names in\r\n    // definitions_ to actual function names (to avoid collisions with\r\n    // user-defined procedures).\r\n    this.functionNames_ = Object.create(null);\r\n  }\r\n\r\n  /**\r\n   * Common tasks for generating code from blocks.  This is called from\r\n   * blockToCode and is called on every block, not just top level blocks.\r\n   * Subclasses may override this, e.g. to generate code for statements\r\n   * following the block, or to handle comments for the specified block and any\r\n   * connected value blocks.\r\n   *\r\n   * @param _block The current block.\r\n   * @param code The code created for this block.\r\n   * @param _opt_thisOnly True to generate code for only this statement.\r\n   * @returns Code with comments and subsequent blocks added.\r\n   */\r\n  protected scrub_(\r\n    _block: Block,\r\n    code: string,\r\n    _opt_thisOnly?: boolean,\r\n  ): string {\r\n    // Optionally override\r\n    return code;\r\n  }\r\n\r\n  /**\r\n   * Hook for code to run at end of code generation.\r\n   * Subclasses may override this, e.g. to prepend the generated code with\r\n   * import statements or variable definitions.\r\n   *\r\n   * @param code Generated code.\r\n   * @returns Completed code.\r\n   */\r\n  finish(code: string): string {\r\n    // Optionally override\r\n    // Clean up temporary data.\r\n    this.definitions_ = Object.create(null);\r\n    this.functionNames_ = Object.create(null);\r\n    return code;\r\n  }\r\n\r\n  /**\r\n   * Naked values are top-level blocks with outputs that aren't plugged into\r\n   * anything.\r\n   * Subclasses may override this, e.g. if their language does not allow\r\n   * naked values.\r\n   *\r\n   * @param line Line of generated code.\r\n   * @returns Legal line of code.\r\n   */\r\n  scrubNakedValue(line: string): string {\r\n    // Optionally override\r\n    return line;\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2023 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport {Align} from './inputs/align.js';\r\nimport {Input} from './inputs/input.js';\r\nimport {DummyInput} from './inputs/dummy_input.js';\r\nimport {EndRowInput} from './inputs/end_row_input.js';\r\nimport {StatementInput} from './inputs/statement_input.js';\r\nimport {ValueInput} from './inputs/value_input.js';\r\nimport {inputTypes} from './inputs/input_types.js';\r\n\r\nexport {\r\n  Align,\r\n  Input,\r\n  DummyInput,\r\n  EndRowInput,\r\n  StatementInput,\r\n  ValueInput,\r\n  inputTypes,\r\n};\r\n","/**\r\n * @license\r\n * Copyright 2024 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport {BlockSvg} from '../block_svg.js';\r\nimport {IConnectionPreviewer} from '../interfaces/i_connection_previewer.js';\r\nimport {RenderedConnection} from '../rendered_connection.js';\r\nimport {WorkspaceSvg} from '../workspace_svg.js';\r\nimport * as eventUtils from '../events/utils.js';\r\nimport * as constants from '../constants.js';\r\nimport * as renderManagement from '../render_management.js';\r\nimport * as registry from '../registry.js';\r\n\r\n/**\r\n * An error message to throw if the block created by createMarkerBlock_ is\r\n * missing any components.\r\n */\r\nconst DUPLICATE_BLOCK_ERROR =\r\n  'The insertion marker previewer tried to create a marker but the result ' +\r\n  'is missing %1. If you are using a mutator, make sure your domToMutation ' +\r\n  'method is properly defined.';\r\n\r\nexport class InsertionMarkerPreviewer implements IConnectionPreviewer {\r\n  private readonly workspace: WorkspaceSvg;\r\n\r\n  private fadedBlock: BlockSvg | null = null;\r\n\r\n  private markerConn: RenderedConnection | null = null;\r\n\r\n  private draggedConn: RenderedConnection | null = null;\r\n\r\n  private staticConn: RenderedConnection | null = null;\r\n\r\n  constructor(draggedBlock: BlockSvg) {\r\n    this.workspace = draggedBlock.workspace;\r\n  }\r\n\r\n  /**\r\n   * Display a connection preview where the draggedCon connects to the\r\n   * staticCon, replacing the replacedBlock (currently connected to the\r\n   * staticCon).\r\n   *\r\n   * @param draggedConn The connection on the block stack being dragged.\r\n   * @param staticConn The connection not being dragged that we are\r\n   *     connecting to.\r\n   * @param replacedBlock The block currently connected to the staticCon that\r\n   *     is being replaced.\r\n   */\r\n  previewReplacement(\r\n    draggedConn: RenderedConnection,\r\n    staticConn: RenderedConnection,\r\n    replacedBlock: BlockSvg,\r\n  ) {\r\n    eventUtils.disable();\r\n    try {\r\n      this.hidePreview();\r\n      this.fadedBlock = replacedBlock;\r\n      replacedBlock.fadeForReplacement(true);\r\n      if (this.workspace.getRenderer().shouldHighlightConnection(staticConn)) {\r\n        staticConn.highlight();\r\n        this.staticConn = staticConn;\r\n      }\r\n    } finally {\r\n      eventUtils.enable();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Display a connection preview where the draggedCon connects to the\r\n   * staticCon, and no block is being relaced.\r\n   *\r\n   * @param draggedConn The connection on the block stack being dragged.\r\n   * @param staticConn The connection not being dragged that we are\r\n   *     connecting to.\r\n   */\r\n  previewConnection(\r\n    draggedConn: RenderedConnection,\r\n    staticConn: RenderedConnection,\r\n  ) {\r\n    if (draggedConn === this.draggedConn && staticConn === this.staticConn) {\r\n      return;\r\n    }\r\n\r\n    eventUtils.disable();\r\n    try {\r\n      this.hidePreview();\r\n      const dragged = draggedConn.getSourceBlock();\r\n      const marker = this.createInsertionMarker(dragged);\r\n      const markerConn = this.getMatchingConnection(\r\n        dragged,\r\n        marker,\r\n        draggedConn,\r\n      );\r\n      if (!markerConn) {\r\n        throw Error('Could not create insertion marker to preview connection');\r\n      }\r\n\r\n      // Render disconnected from everything else so that we have a valid\r\n      // connection location.\r\n      marker.queueRender();\r\n      renderManagement.triggerQueuedRenders();\r\n\r\n      // Connect() also renders the insertion marker.\r\n      markerConn.connect(staticConn);\r\n\r\n      const originalOffsetToTarget = {\r\n        x: staticConn.x - markerConn.x,\r\n        y: staticConn.y - markerConn.y,\r\n      };\r\n      const originalOffsetInBlock = markerConn.getOffsetInBlock().clone();\r\n      renderManagement.finishQueuedRenders().then(() => {\r\n        // Position so that the existing block doesn't move.\r\n        marker?.positionNearConnection(\r\n          markerConn,\r\n          originalOffsetToTarget,\r\n          originalOffsetInBlock,\r\n        );\r\n        marker?.getSvgRoot().setAttribute('visibility', 'visible');\r\n      });\r\n\r\n      if (this.workspace.getRenderer().shouldHighlightConnection(staticConn)) {\r\n        staticConn.highlight();\r\n      }\r\n\r\n      this.markerConn = markerConn;\r\n      this.draggedConn = draggedConn;\r\n      this.staticConn = staticConn;\r\n    } finally {\r\n      eventUtils.enable();\r\n    }\r\n  }\r\n\r\n  private createInsertionMarker(origBlock: BlockSvg) {\r\n    const result = this.workspace.newBlock(origBlock.type);\r\n    result.setInsertionMarker(true);\r\n    if (origBlock.saveExtraState) {\r\n      const state = origBlock.saveExtraState(true);\r\n      if (state && result.loadExtraState) {\r\n        result.loadExtraState(state);\r\n      }\r\n    } else if (origBlock.mutationToDom) {\r\n      const oldMutationDom = origBlock.mutationToDom();\r\n      if (oldMutationDom && result.domToMutation) {\r\n        result.domToMutation(oldMutationDom);\r\n      }\r\n    }\r\n    // Copy field values from the other block.  These values may impact the\r\n    // rendered size of the insertion marker.  Note that we do not care about\r\n    // child blocks here.\r\n    for (let i = 0; i < origBlock.inputList.length; i++) {\r\n      const sourceInput = origBlock.inputList[i];\r\n      if (sourceInput.name === constants.COLLAPSED_INPUT_NAME) {\r\n        continue; // Ignore the collapsed input.\r\n      }\r\n      const resultInput = result.inputList[i];\r\n      if (!resultInput) {\r\n        throw new Error(DUPLICATE_BLOCK_ERROR.replace('%1', 'an input'));\r\n      }\r\n      for (let j = 0; j < sourceInput.fieldRow.length; j++) {\r\n        const sourceField = sourceInput.fieldRow[j];\r\n        const resultField = resultInput.fieldRow[j];\r\n        if (!resultField) {\r\n          throw new Error(DUPLICATE_BLOCK_ERROR.replace('%1', 'a field'));\r\n        }\r\n        resultField.setValue(sourceField.getValue());\r\n      }\r\n    }\r\n\r\n    for (const block of result.getDescendants(false)) {\r\n      block.setInsertionMarker(true);\r\n    }\r\n\r\n    result.setCollapsed(origBlock.isCollapsed());\r\n    result.setInputsInline(origBlock.getInputsInline());\r\n\r\n    result.initSvg();\r\n    result.getSvgRoot().setAttribute('visibility', 'hidden');\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Gets the connection on the marker block that matches the original\r\n   * connection on the original block.\r\n   *\r\n   * @param orig The original block.\r\n   * @param marker The marker block (where we want to find the matching\r\n   *     connection).\r\n   * @param origConn The original connection.\r\n   */\r\n  private getMatchingConnection(\r\n    orig: BlockSvg,\r\n    marker: BlockSvg,\r\n    origConn: RenderedConnection,\r\n  ) {\r\n    const origConns = orig.getConnections_(true);\r\n    const markerConns = marker.getConnections_(true);\r\n    if (origConns.length !== markerConns.length) return null;\r\n    for (let i = 0; i < origConns.length; i++) {\r\n      if (origConns[i] === origConn) {\r\n        return markerConns[i];\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /** Hide any previews that are currently displayed. */\r\n  hidePreview() {\r\n    eventUtils.disable();\r\n    try {\r\n      if (this.staticConn) {\r\n        this.staticConn.unhighlight();\r\n        this.staticConn = null;\r\n      }\r\n      if (this.fadedBlock) {\r\n        this.fadedBlock.fadeForReplacement(false);\r\n        this.fadedBlock = null;\r\n      }\r\n      if (this.markerConn) {\r\n        this.hideInsertionMarker(this.markerConn);\r\n        this.markerConn = null;\r\n        this.draggedConn = null;\r\n      }\r\n    } finally {\r\n      eventUtils.enable();\r\n    }\r\n  }\r\n\r\n  private hideInsertionMarker(markerConn: RenderedConnection) {\r\n    const marker = markerConn.getSourceBlock();\r\n    const markerPrev = marker.previousConnection;\r\n    const markerOutput = marker.outputConnection;\r\n\r\n    if (!markerPrev?.targetConnection && !markerOutput?.targetConnection) {\r\n      // If we are the top block, unplugging doesn't do anything.\r\n      // The marker connection may not have a target block if we are hiding\r\n      // as part of applying connections.\r\n      markerConn.targetBlock()?.unplug(false);\r\n    } else {\r\n      marker.unplug(true);\r\n    }\r\n\r\n    marker.dispose();\r\n  }\r\n\r\n  /** Dispose of any references held by this connection previewer. */\r\n  dispose() {\r\n    this.hidePreview();\r\n  }\r\n}\r\n\r\nregistry.register(\r\n  registry.Type.CONNECTION_PREVIEWER,\r\n  registry.DEFAULT,\r\n  InsertionMarkerPreviewer,\r\n);\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.geras.ConstantProvider\r\n\r\nimport {ConstantProvider as BaseConstantProvider} from '../common/constants.js';\r\n\r\n/**\r\n * An object that provides constants for rendering blocks in Geras mode.\r\n */\r\nexport class ConstantProvider extends BaseConstantProvider {\r\n  override FIELD_TEXT_BASELINE_CENTER = false;\r\n\r\n  // The dark/shadow path in classic rendering is the same as the normal block\r\n  // path, but translated down one and right one.\r\n  DARK_PATH_OFFSET = 1;\r\n\r\n  /**\r\n   * The maximum width of a bottom row that follows a statement input and has\r\n   * inputs inline.\r\n   */\r\n  MAX_BOTTOM_WIDTH = 30;\r\n  override STATEMENT_BOTTOM_SPACER = -this.NOTCH_HEIGHT / 2;\r\n\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  override getCSS_(selector: string) {\r\n    return super.getCSS_(selector).concat([\r\n      /* eslint-disable indent */\r\n      /* clang-format off */\r\n      // Insertion marker.\r\n      `${selector} .blocklyInsertionMarker>.blocklyPathLight,`,\r\n      `${selector} .blocklyInsertionMarker>.blocklyPathDark {`,\r\n      `fill-opacity: ${this.INSERTION_MARKER_OPACITY};`,\r\n      `stroke: none;`,\r\n      '}',\r\n      /* clang-format on */\r\n      /* eslint-enable indent */\r\n    ]);\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.geras.Highlighter\r\n\r\nimport * as svgPaths from '../../utils/svg_paths.js';\r\nimport type {ConstantProvider} from '../common/constants.js';\r\nimport type {BottomRow} from '../measurables/bottom_row.js';\r\nimport type {Row} from '../measurables/row.js';\r\nimport {SpacerRow} from '../measurables/spacer_row.js';\r\nimport type {TopRow} from '../measurables/top_row.js';\r\nimport {Types} from '../measurables/types.js';\r\n\r\nimport type {\r\n  HighlightConstantProvider,\r\n  InsideCorner,\r\n  JaggedTeeth,\r\n  Notch,\r\n  OutsideCorner,\r\n  PuzzleTab,\r\n  StartHat,\r\n} from './highlight_constants.js';\r\nimport type {RenderInfo} from './info.js';\r\nimport type {InlineInput} from './measurables/inline_input.js';\r\n\r\n/**\r\n * An object that adds highlights to a block based on the given rendering\r\n * information.\r\n *\r\n * Highlighting is interesting because the highlights do not fully enclose the\r\n * block.  Instead, they are positioned based on a light source in the top left.\r\n * This means that rendering highlights requires exact information about the\r\n * position of each part of the block.  The resulting paths are not continuous\r\n * or closed paths.  The highlights for tabs and notches are loosely based on\r\n * tab and notch shapes, but are not exactly the same.\r\n */\r\nexport class Highlighter {\r\n  info_: RenderInfo;\r\n  steps_ = '';\r\n  inlineSteps_ = '';\r\n  RTL_: boolean;\r\n  constants_: ConstantProvider;\r\n  highlightConstants_: HighlightConstantProvider;\r\n  private readonly highlightOffset: number;\r\n  outsideCornerPaths_: OutsideCorner;\r\n  insideCornerPaths_: InsideCorner;\r\n  puzzleTabPaths_: PuzzleTab;\r\n  notchPaths_: Notch;\r\n  startPaths_: StartHat;\r\n  jaggedTeethPaths_: JaggedTeeth;\r\n\r\n  /**\r\n   * @param info An object containing all information needed to render this\r\n   *     block.\r\n   */\r\n  constructor(info: RenderInfo) {\r\n    this.info_ = info;\r\n\r\n    this.RTL_ = this.info_.RTL;\r\n\r\n    const renderer = info.getRenderer();\r\n\r\n    /** The renderer's constant provider. */\r\n    this.constants_ = renderer.getConstants();\r\n\r\n    this.highlightConstants_ = renderer.getHighlightConstants();\r\n    /** The offset between the block's main path and highlight path. */\r\n    this.highlightOffset = this.highlightConstants_.OFFSET;\r\n\r\n    this.outsideCornerPaths_ = this.highlightConstants_.OUTSIDE_CORNER;\r\n    this.insideCornerPaths_ = this.highlightConstants_.INSIDE_CORNER;\r\n    this.puzzleTabPaths_ = this.highlightConstants_.PUZZLE_TAB;\r\n    this.notchPaths_ = this.highlightConstants_.NOTCH;\r\n    this.startPaths_ = this.highlightConstants_.START_HAT;\r\n    this.jaggedTeethPaths_ = this.highlightConstants_.JAGGED_TEETH;\r\n  }\r\n\r\n  /**\r\n   * Get the steps for the highlight path.\r\n   *\r\n   * @returns The steps for the highlight path.\r\n   */\r\n  getPath(): string {\r\n    return this.steps_ + '\\n' + this.inlineSteps_;\r\n  }\r\n\r\n  /**\r\n   * Add a highlight to the top corner of a block.\r\n   *\r\n   * @param row The top row of the block.\r\n   */\r\n  drawTopCorner(row: TopRow) {\r\n    this.steps_ += svgPaths.moveBy(row.xPos, this.info_.startY);\r\n    for (let i = 0, elem; (elem = row.elements[i]); i++) {\r\n      if (Types.isLeftSquareCorner(elem)) {\r\n        this.steps_ += this.highlightConstants_.START_POINT;\r\n      } else if (Types.isLeftRoundedCorner(elem)) {\r\n        this.steps_ += this.outsideCornerPaths_.topLeft(this.RTL_);\r\n      } else if (Types.isPreviousConnection(elem)) {\r\n        this.steps_ += this.notchPaths_.pathLeft;\r\n      } else if (Types.isHat(elem)) {\r\n        this.steps_ += this.startPaths_.path(this.RTL_);\r\n      } else if (Types.isSpacer(elem) && elem.width !== 0) {\r\n        // The end point of the spacer needs to be offset by the highlight\r\n        // amount. So instead of using the spacer's width for a relative\r\n        // horizontal, use its width and position for an absolute horizontal\r\n        // move.\r\n        this.steps_ += svgPaths.lineOnAxis(\r\n          'H',\r\n          elem.xPos + elem.width - this.highlightOffset,\r\n        );\r\n      }\r\n    }\r\n\r\n    const right = row.xPos + row.width - this.highlightOffset;\r\n    this.steps_ += svgPaths.lineOnAxis('H', right);\r\n  }\r\n\r\n  /**\r\n   * Add a highlight on a jagged edge for a collapsed block.\r\n   *\r\n   * @param row  The row to highlight.\r\n   */\r\n  drawJaggedEdge_(row: Row) {\r\n    if (this.info_.RTL) {\r\n      const remainder =\r\n        row.height - this.jaggedTeethPaths_.height - this.highlightOffset;\r\n      this.steps_ +=\r\n        this.jaggedTeethPaths_.pathLeft + svgPaths.lineOnAxis('v', remainder);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add a highlight on a value input.\r\n   *\r\n   * @param row The row the input belongs to.\r\n   */\r\n  drawValueInput(row: Row) {\r\n    const input = row.getLastInput() as InlineInput;\r\n    if (this.RTL_) {\r\n      const belowTabHeight = row.height - input.connectionHeight;\r\n\r\n      this.steps_ +=\r\n        svgPaths.moveTo(\r\n          input.xPos + input.width - this.highlightOffset,\r\n          row.yPos,\r\n        ) +\r\n        this.puzzleTabPaths_.pathDown(this.RTL_) +\r\n        svgPaths.lineOnAxis('v', belowTabHeight);\r\n    } else {\r\n      this.steps_ +=\r\n        svgPaths.moveTo(input.xPos + input.width, row.yPos) +\r\n        this.puzzleTabPaths_.pathDown(this.RTL_);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add a highlight on a statement input.\r\n   *\r\n   * @param row The row to highlight.\r\n   */\r\n  drawStatementInput(row: Row) {\r\n    const input = row.getLastInput();\r\n    if (!input) return;\r\n    if (this.RTL_) {\r\n      const innerHeight = row.height - 2 * this.insideCornerPaths_.height;\r\n      this.steps_ +=\r\n        svgPaths.moveTo(input.xPos, row.yPos) +\r\n        this.insideCornerPaths_.pathTop(this.RTL_) +\r\n        svgPaths.lineOnAxis('v', innerHeight) +\r\n        this.insideCornerPaths_.pathBottom(this.RTL_) +\r\n        svgPaths.lineTo(\r\n          row.width - input.xPos - this.insideCornerPaths_.width,\r\n          0,\r\n        );\r\n    } else {\r\n      this.steps_ +=\r\n        svgPaths.moveTo(input.xPos, row.yPos + row.height) +\r\n        this.insideCornerPaths_.pathBottom(this.RTL_) +\r\n        svgPaths.lineTo(\r\n          row.width - input.xPos - this.insideCornerPaths_.width,\r\n          0,\r\n        );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add a highlight on the right side of a row.\r\n   *\r\n   * @param row The row to highlight.\r\n   */\r\n  drawRightSideRow(row: Row) {\r\n    const rightEdge = row.xPos + row.width - this.highlightOffset;\r\n    if (row instanceof SpacerRow && row.followsStatement) {\r\n      this.steps_ += svgPaths.lineOnAxis('H', rightEdge);\r\n    }\r\n    if (this.RTL_) {\r\n      this.steps_ += svgPaths.lineOnAxis('H', rightEdge);\r\n      if (row.height > this.highlightOffset) {\r\n        this.steps_ += svgPaths.lineOnAxis(\r\n          'V',\r\n          row.yPos + row.height - this.highlightOffset,\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add a highlight to the bottom row.\r\n   *\r\n   * @param row The row to highlight.\r\n   */\r\n  drawBottomRow(row: BottomRow) {\r\n    // Highlight the vertical edge of the bottom row on the input side.\r\n    // Highlighting is always from the top left, both in LTR and RTL.\r\n    if (this.RTL_) {\r\n      this.steps_ += svgPaths.lineOnAxis(\r\n        'V',\r\n        row.baseline - this.highlightOffset,\r\n      );\r\n    } else {\r\n      const cornerElem = this.info_.bottomRow.elements[0];\r\n      if (Types.isLeftSquareCorner(cornerElem)) {\r\n        this.steps_ += svgPaths.moveTo(\r\n          row.xPos + this.highlightOffset,\r\n          row.baseline - this.highlightOffset,\r\n        );\r\n      } else if (Types.isLeftRoundedCorner(cornerElem)) {\r\n        this.steps_ += svgPaths.moveTo(row.xPos, row.baseline);\r\n        this.steps_ += this.outsideCornerPaths_.bottomLeft();\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Draw the highlight on the left side of the block.\r\n   */\r\n  drawLeft() {\r\n    const outputConnection = this.info_.outputConnection;\r\n    if (outputConnection) {\r\n      const tabBottom =\r\n        outputConnection.connectionOffsetY + outputConnection.height;\r\n      // Draw a line up to the bottom of the tab.\r\n      if (this.RTL_) {\r\n        this.steps_ += svgPaths.moveTo(this.info_.startX, tabBottom);\r\n      } else {\r\n        const left = this.info_.startX + this.highlightOffset;\r\n        const bottom = this.info_.bottomRow.baseline - this.highlightOffset;\r\n        this.steps_ += svgPaths.moveTo(left, bottom);\r\n        this.steps_ += svgPaths.lineOnAxis('V', tabBottom);\r\n      }\r\n      this.steps_ += this.puzzleTabPaths_.pathUp(this.RTL_);\r\n    }\r\n\r\n    if (!this.RTL_) {\r\n      const topRow = this.info_.topRow;\r\n      if (Types.isLeftRoundedCorner(topRow.elements[0])) {\r\n        this.steps_ += svgPaths.lineOnAxis(\r\n          'V',\r\n          this.outsideCornerPaths_.height,\r\n        );\r\n      } else {\r\n        this.steps_ += svgPaths.lineOnAxis(\r\n          'V',\r\n          topRow.capline + this.highlightOffset,\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add a highlight to an inline input.\r\n   *\r\n   * @param input The input to highlight.\r\n   */\r\n  drawInlineInput(input: InlineInput) {\r\n    const offset = this.highlightOffset;\r\n\r\n    // Relative to the block's left.\r\n    const connectionRight = input.xPos + input.connectionWidth;\r\n    const yPos = input.centerline - input.height / 2;\r\n    const bottomHighlightWidth = input.width - input.connectionWidth;\r\n    const startY = yPos + offset;\r\n\r\n    if (this.RTL_) {\r\n      const aboveTabHeight = input.connectionOffsetY - offset;\r\n      const belowTabHeight =\r\n        input.height -\r\n        (input.connectionOffsetY + input.connectionHeight) +\r\n        offset;\r\n\r\n      const startX = connectionRight - offset;\r\n\r\n      this.inlineSteps_ +=\r\n        svgPaths.moveTo(startX, startY) + // Right edge above tab.\r\n        svgPaths.lineOnAxis('v', aboveTabHeight) + // Back of tab.\r\n        this.puzzleTabPaths_.pathDown(this.RTL_) + // Right edge below tab.\r\n        svgPaths.lineOnAxis('v', belowTabHeight) + // Bottom.\r\n        svgPaths.lineOnAxis('h', bottomHighlightWidth);\r\n    } else {\r\n      this.inlineSteps_ += // Go to top right corner.\r\n        svgPaths.moveTo(input.xPos + input.width + offset, startY) + // Highlight right edge, bottom.\r\n        svgPaths.lineOnAxis('v', input.height) +\r\n        svgPaths.lineOnAxis('h', -bottomHighlightWidth) + // Go to top of tab.\r\n        svgPaths.moveTo(connectionRight, yPos + input.connectionOffsetY) + // Short highlight glint at\r\n        // bottom of tab.\r\n        this.puzzleTabPaths_.pathDown(this.RTL_);\r\n    }\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.geras.Drawer\r\n\r\nimport type {BlockSvg} from '../../block_svg.js';\r\nimport * as svgPaths from '../../utils/svg_paths.js';\r\nimport {Drawer as BaseDrawer} from '../common/drawer.js';\r\nimport type {Row} from '../measurables/row.js';\r\n\r\nimport type {ConstantProvider} from './constants.js';\r\nimport {Highlighter} from './highlighter.js';\r\nimport type {RenderInfo} from './info.js';\r\nimport type {InlineInput} from './measurables/inline_input.js';\r\nimport type {PathObject} from './path_object.js';\r\n\r\n/**\r\n * An object that draws a block based on the given rendering information,\r\n * customized for the geras renderer.\r\n */\r\nexport class Drawer extends BaseDrawer {\r\n  highlighter_: Highlighter;\r\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\r\n  override constants_!: ConstantProvider;\r\n\r\n  /**\r\n   * @param block The block to render.\r\n   * @param info An object containing all information needed to render this\r\n   *     block.\r\n   */\r\n  constructor(block: BlockSvg, info: RenderInfo) {\r\n    super(block, info);\r\n    // Unlike Thrasos, Geras has highlights and drop shadows.\r\n    this.highlighter_ = new Highlighter(info);\r\n  }\r\n\r\n  override draw() {\r\n    this.drawOutline_();\r\n    this.drawInternals_();\r\n    this.updateConnectionHighlights();\r\n\r\n    const pathObject = this.block_.pathObject as PathObject;\r\n    pathObject.setPath(this.outlinePath_ + '\\n' + this.inlinePath_);\r\n    pathObject.setHighlightPath(this.highlighter_.getPath());\r\n    if (this.info_.RTL) {\r\n      pathObject.flipRTL();\r\n    }\r\n    this.recordSizeOnBlock_();\r\n  }\r\n\r\n  override drawTop_() {\r\n    this.highlighter_.drawTopCorner(this.info_.topRow);\r\n    this.highlighter_.drawRightSideRow(this.info_.topRow);\r\n\r\n    super.drawTop_();\r\n  }\r\n\r\n  override drawJaggedEdge_(row: Row) {\r\n    this.highlighter_.drawJaggedEdge_(row);\r\n\r\n    super.drawJaggedEdge_(row);\r\n  }\r\n\r\n  override drawValueInput_(row: Row) {\r\n    this.highlighter_.drawValueInput(row);\r\n\r\n    super.drawValueInput_(row);\r\n  }\r\n\r\n  override drawStatementInput_(row: Row) {\r\n    this.highlighter_.drawStatementInput(row);\r\n\r\n    super.drawStatementInput_(row);\r\n  }\r\n\r\n  override drawRightSideRow_(row: Row) {\r\n    this.highlighter_.drawRightSideRow(row);\r\n\r\n    this.outlinePath_ +=\r\n      svgPaths.lineOnAxis('H', row.xPos + row.width) +\r\n      svgPaths.lineOnAxis('V', row.yPos + row.height);\r\n  }\r\n\r\n  override drawBottom_() {\r\n    this.highlighter_.drawBottomRow(this.info_.bottomRow);\r\n\r\n    super.drawBottom_();\r\n  }\r\n\r\n  /**\r\n   * Add steps for the left side of the block, which may include an output\r\n   * connection\r\n   */\r\n  protected override drawLeft_() {\r\n    this.highlighter_.drawLeft();\r\n\r\n    super.drawLeft_();\r\n  }\r\n\r\n  override drawInlineInput_(input: InlineInput) {\r\n    this.highlighter_.drawInlineInput(input as InlineInput);\r\n\r\n    super.drawInlineInput_(input);\r\n  }\r\n\r\n  override positionInlineInputConnection_(input: InlineInput) {\r\n    const yPos = input.centerline - input.height / 2;\r\n    // Move the connection.\r\n    if (input.connectionModel) {\r\n      // xPos already contains info about startX\r\n      let connX =\r\n        input.xPos + input.connectionWidth + this.constants_.DARK_PATH_OFFSET;\r\n      if (this.info_.RTL) {\r\n        connX *= -1;\r\n      }\r\n      input.connectionModel.setOffsetInBlock(\r\n        connX,\r\n        yPos + input.connectionOffsetY + this.constants_.DARK_PATH_OFFSET,\r\n      );\r\n    }\r\n  }\r\n\r\n  override positionStatementInputConnection_(row: Row) {\r\n    const input = row.getLastInput();\r\n    if (input?.connectionModel) {\r\n      let connX = row.xPos + row.statementEdge + input.notchOffset;\r\n      if (this.info_.RTL) {\r\n        connX *= -1;\r\n      } else {\r\n        connX += this.constants_.DARK_PATH_OFFSET;\r\n      }\r\n      input.connectionModel.setOffsetInBlock(\r\n        connX,\r\n        row.yPos + this.constants_.DARK_PATH_OFFSET,\r\n      );\r\n    }\r\n  }\r\n\r\n  override positionExternalValueConnection_(row: Row) {\r\n    const input = row.getLastInput();\r\n    if (input && input.connectionModel) {\r\n      let connX = row.xPos + row.width + this.constants_.DARK_PATH_OFFSET;\r\n      if (this.info_.RTL) {\r\n        connX *= -1;\r\n      }\r\n      input.connectionModel.setOffsetInBlock(connX, row.yPos);\r\n    }\r\n  }\r\n\r\n  override positionNextConnection_() {\r\n    const bottomRow = this.info_.bottomRow;\r\n\r\n    if (bottomRow.connection) {\r\n      const connInfo = bottomRow.connection;\r\n      const x = connInfo.xPos; // Already contains info about startX.\r\n      const connX =\r\n        (this.info_.RTL ? -x : x) + this.constants_.DARK_PATH_OFFSET / 2;\r\n      connInfo.connectionModel.setOffsetInBlock(\r\n        connX,\r\n        bottomRow.baseline + this.constants_.DARK_PATH_OFFSET,\r\n      );\r\n    }\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.geras.HighlightConstantProvider\r\n\r\nimport * as svgPaths from '../../utils/svg_paths.js';\r\nimport type {ConstantProvider} from '../common/constants.js';\r\n\r\n/** An object containing sizing and path information about an outside corner. */\r\nexport interface OutsideCorner {\r\n  height: number;\r\n  topLeft: (p1: boolean) => string;\r\n  bottomLeft: () => string;\r\n}\r\n\r\n/** An object containing sizing and path information about an inside corner. */\r\nexport interface InsideCorner {\r\n  width: number;\r\n  height: number;\r\n  pathTop: (p1: boolean) => string;\r\n  pathBottom: (p1: boolean) => string;\r\n}\r\n\r\n/** An object containing sizing and path information about a start hat. */\r\nexport interface StartHat {\r\n  path: (p1: boolean) => string;\r\n}\r\n\r\n/** An object containing sizing and path information about a notch. */\r\nexport interface Notch {\r\n  pathLeft: string;\r\n}\r\n\r\n/** An object containing sizing and path information about a puzzle tab. */\r\nexport interface PuzzleTab {\r\n  width: number;\r\n  height: number;\r\n  pathDown: (p1: boolean) => string;\r\n  pathUp: (p1: boolean) => string;\r\n}\r\n\r\n/**\r\n * An object containing sizing and path information about collapsed block\r\n * indicators.\r\n */\r\nexport interface JaggedTeeth {\r\n  height: number;\r\n  width: number;\r\n  pathLeft: string;\r\n}\r\n\r\n/**\r\n * An object that provides constants for rendering highlights on blocks.\r\n * Some highlights are simple offsets of the parent paths and can be generated\r\n * programmatically.  Others, especially on curves, are just made out of piles\r\n * of constants and are hard to tweak.\r\n */\r\nexport class HighlightConstantProvider {\r\n  constantProvider: ConstantProvider;\r\n\r\n  /** The offset between the block's main path and highlight path. */\r\n  OFFSET = 0.5;\r\n  START_POINT: string;\r\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\r\n  INSIDE_CORNER!: InsideCorner;\r\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\r\n  OUTSIDE_CORNER!: OutsideCorner;\r\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\r\n  PUZZLE_TAB!: PuzzleTab;\r\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\r\n  NOTCH!: Notch;\r\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\r\n  JAGGED_TEETH!: JaggedTeeth;\r\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\r\n  START_HAT!: StartHat;\r\n\r\n  /**\r\n   * @param constants The rendering constants provider.\r\n   */\r\n  constructor(constants: ConstantProvider) {\r\n    /** The renderer's constant provider. */\r\n    this.constantProvider = constants;\r\n\r\n    /**\r\n     * The start point, which is offset in both X and Y, as an SVG path chunk.\r\n     */\r\n    this.START_POINT = svgPaths.moveBy(this.OFFSET, this.OFFSET);\r\n  }\r\n\r\n  /**\r\n   * Initialize shape objects based on the constants set in the constructor.\r\n   */\r\n  init() {\r\n    /**\r\n     * An object containing sizing and path information about inside corner\r\n     * highlights.\r\n     */\r\n    this.INSIDE_CORNER = this.makeInsideCorner();\r\n\r\n    /**\r\n     * An object containing sizing and path information about outside corner\r\n     * highlights.\r\n     */\r\n    this.OUTSIDE_CORNER = this.makeOutsideCorner();\r\n\r\n    /**\r\n     * An object containing sizing and path information about puzzle tab\r\n     * highlights.\r\n     */\r\n    this.PUZZLE_TAB = this.makePuzzleTab();\r\n\r\n    /**\r\n     * An object containing sizing and path information about notch highlights.\r\n     */\r\n    this.NOTCH = this.makeNotch();\r\n\r\n    /**\r\n     * An object containing sizing and path information about highlights for\r\n     * collapsed block indicators.\r\n     */\r\n    this.JAGGED_TEETH = this.makeJaggedTeeth();\r\n\r\n    /**\r\n     * An object containing sizing and path information about start hat\r\n     * highlights.\r\n     */\r\n    this.START_HAT = this.makeStartHat();\r\n  }\r\n\r\n  /**\r\n   * @returns An object containing sizing and path information about inside\r\n   *     corner highlights.\r\n   */\r\n  protected makeInsideCorner(): InsideCorner {\r\n    const radius = this.constantProvider.CORNER_RADIUS;\r\n    const offset = this.OFFSET;\r\n\r\n    /**\r\n     * Distance from shape edge to intersect with a curved corner at 45 degrees.\r\n     * Applies to highlighting on around the outside of a curve.\r\n     */\r\n    const distance45outside = (1 - Math.SQRT1_2) * (radius + offset) - offset;\r\n\r\n    const pathTopRtl =\r\n      svgPaths.moveBy(distance45outside, distance45outside) +\r\n      svgPaths.arc(\r\n        'a',\r\n        '0 0,0',\r\n        radius,\r\n        svgPaths.point(-distance45outside - offset, radius - distance45outside),\r\n      );\r\n\r\n    const pathBottomRtl = svgPaths.arc(\r\n      'a',\r\n      '0 0,0',\r\n      radius + offset,\r\n      svgPaths.point(radius + offset, radius + offset),\r\n    );\r\n\r\n    const pathBottomLtr =\r\n      svgPaths.moveBy(distance45outside, -distance45outside) +\r\n      svgPaths.arc(\r\n        'a',\r\n        '0 0,0',\r\n        radius + offset,\r\n        svgPaths.point(radius - distance45outside, distance45outside + offset),\r\n      );\r\n\r\n    return {\r\n      width: radius + offset,\r\n      height: radius,\r\n      pathTop(rtl) {\r\n        return rtl ? pathTopRtl : '';\r\n      },\r\n      pathBottom(rtl) {\r\n        return rtl ? pathBottomRtl : pathBottomLtr;\r\n      },\r\n    };\r\n  }\r\n\r\n  /**\r\n   * @returns An object containing sizing and path information about outside\r\n   *     corner highlights.\r\n   */\r\n  protected makeOutsideCorner(): OutsideCorner {\r\n    const radius = this.constantProvider.CORNER_RADIUS;\r\n    const offset = this.OFFSET;\r\n\r\n    /**\r\n     * Distance from shape edge to intersect with a curved corner at 45 degrees.\r\n     * Applies to highlighting on around the inside of a curve.\r\n     */\r\n    const distance45inside = (1 - Math.SQRT1_2) * (radius - offset) + offset;\r\n\r\n    const topLeftStartX = distance45inside;\r\n    const topLeftStartY = distance45inside;\r\n    const topLeftCornerHighlightRtl =\r\n      svgPaths.moveBy(topLeftStartX, topLeftStartY) +\r\n      svgPaths.arc(\r\n        'a',\r\n        '0 0,1',\r\n        radius - offset,\r\n        svgPaths.point(radius - topLeftStartX, -topLeftStartY + offset),\r\n      );\r\n    /**\r\n     * SVG path for drawing the highlight on the rounded top-left corner.\r\n     */\r\n    const topLeftCornerHighlightLtr =\r\n      svgPaths.moveBy(offset, radius) +\r\n      svgPaths.arc(\r\n        'a',\r\n        '0 0,1',\r\n        radius - offset,\r\n        svgPaths.point(radius, -radius + offset),\r\n      );\r\n\r\n    const bottomLeftStartX = distance45inside;\r\n    const bottomLeftStartY = -distance45inside;\r\n    const bottomLeftPath =\r\n      svgPaths.moveBy(bottomLeftStartX, bottomLeftStartY) +\r\n      svgPaths.arc(\r\n        'a',\r\n        '0 0,1',\r\n        radius - offset,\r\n        svgPaths.point(-bottomLeftStartX + offset, -bottomLeftStartY - radius),\r\n      );\r\n\r\n    return {\r\n      height: radius,\r\n      topLeft(rtl) {\r\n        return rtl ? topLeftCornerHighlightRtl : topLeftCornerHighlightLtr;\r\n      },\r\n      bottomLeft() {\r\n        return bottomLeftPath;\r\n      },\r\n    };\r\n  }\r\n\r\n  /**\r\n   * @returns An object containing sizing and path information about puzzle tab\r\n   *     highlights.\r\n   */\r\n  protected makePuzzleTab(): PuzzleTab {\r\n    const width = this.constantProvider.TAB_WIDTH;\r\n    const height = this.constantProvider.TAB_HEIGHT;\r\n\r\n    // This is how much of the vertical block edge is actually drawn by the\r\n    // puzzle tab.\r\n    const verticalOverlap = 2.5;\r\n\r\n    const highlightRtlUp =\r\n      svgPaths.moveBy(-2, -height + verticalOverlap + 0.9) +\r\n      svgPaths.lineTo(width * -0.45, -2.1);\r\n\r\n    const highlightRtlDown =\r\n      svgPaths.lineOnAxis('v', verticalOverlap) +\r\n      svgPaths.moveBy(-width * 0.97, 2.5) +\r\n      svgPaths.curve('q', [\r\n        svgPaths.point(-width * 0.05, 10),\r\n        svgPaths.point(width * 0.3, 9.5),\r\n      ]) +\r\n      svgPaths.moveBy(width * 0.67, -1.9) +\r\n      svgPaths.lineOnAxis('v', verticalOverlap);\r\n\r\n    const highlightLtrUp =\r\n      svgPaths.lineOnAxis('v', -1.5) +\r\n      svgPaths.moveBy(width * -0.92, -0.5) +\r\n      svgPaths.curve('q', [\r\n        svgPaths.point(width * -0.19, -5.5),\r\n        svgPaths.point(0, -11),\r\n      ]) +\r\n      svgPaths.moveBy(width * 0.92, 1);\r\n\r\n    const highlightLtrDown =\r\n      svgPaths.moveBy(-5, height - 0.7) + svgPaths.lineTo(width * 0.46, -2.1);\r\n\r\n    return {\r\n      width,\r\n      height,\r\n      pathUp(rtl) {\r\n        return rtl ? highlightRtlUp : highlightLtrUp;\r\n      },\r\n      pathDown(rtl) {\r\n        return rtl ? highlightRtlDown : highlightLtrDown;\r\n      },\r\n    };\r\n  }\r\n\r\n  /**\r\n   * @returns An object containing sizing and path information about notch\r\n   *     highlights.\r\n   */\r\n  protected makeNotch(): Notch {\r\n    // This is only for the previous connection.\r\n    const pathLeft =\r\n      svgPaths.lineOnAxis('h', this.OFFSET) +\r\n      this.constantProvider.NOTCH.pathLeft;\r\n    return {pathLeft};\r\n  }\r\n\r\n  /**\r\n   * @returns An object containing sizing and path information about collapsed\r\n   *     block edge highlights.\r\n   */\r\n  protected makeJaggedTeeth(): JaggedTeeth {\r\n    const pathLeft =\r\n      svgPaths.lineTo(5.1, 2.6) +\r\n      svgPaths.moveBy(-10.2, 6.8) +\r\n      svgPaths.lineTo(5.1, 2.6);\r\n    return {pathLeft, height: 12, width: 10.2};\r\n  }\r\n\r\n  /**\r\n   * @returns An object containing sizing and path information about start\r\n   *     highlights.\r\n   */\r\n  protected makeStartHat(): StartHat {\r\n    const hatHeight = this.constantProvider.START_HAT.height;\r\n    const pathRtl =\r\n      svgPaths.moveBy(25, -8.7) +\r\n      svgPaths.curve('c', [\r\n        svgPaths.point(29.7, -6.2),\r\n        svgPaths.point(57.2, -0.5),\r\n        svgPaths.point(75, 8.7),\r\n      ]);\r\n\r\n    const pathLtr =\r\n      svgPaths.curve('c', [\r\n        svgPaths.point(17.8, -9.2),\r\n        svgPaths.point(45.3, -14.9),\r\n        svgPaths.point(75, -8.7),\r\n      ]) + svgPaths.moveTo(100.5, hatHeight + 0.5);\r\n    return {\r\n      path(rtl) {\r\n        return rtl ? pathRtl : pathLtr;\r\n      },\r\n    };\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.geras.InlineInput\r\n\r\n/* eslint-disable-next-line no-unused-vars */\r\nimport type {Input} from '../../../inputs/input.js';\r\nimport type {ConstantProvider as BaseConstantProvider} from '../../../renderers/common/constants.js';\r\nimport {InlineInput as BaseInlineInput} from '../../../renderers/measurables/inline_input.js';\r\nimport type {ConstantProvider as GerasConstantProvider} from '../constants.js';\r\n\r\n/**\r\n * An object containing information about the space an inline input takes up\r\n * during rendering.\r\n */\r\nexport class InlineInput extends BaseInlineInput {\r\n  override constants_: GerasConstantProvider;\r\n\r\n  /**\r\n   * @param constants The rendering constants provider.\r\n   * @param input The inline input to measure and store information for.\r\n   */\r\n  constructor(constants: BaseConstantProvider, input: Input) {\r\n    super(constants, input);\r\n    this.constants_ = constants as GerasConstantProvider;\r\n\r\n    if (this.connectedBlock) {\r\n      // We allow the dark path to show on the parent block so that the child\r\n      // block looks embossed.  This takes up an extra pixel in both x and y.\r\n      this.width += this.constants_.DARK_PATH_OFFSET;\r\n      this.height += this.constants_.DARK_PATH_OFFSET;\r\n    }\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.geras.StatementInput\r\n\r\n/* eslint-disable-next-line no-unused-vars */\r\nimport type {Input} from '../../../inputs/input.js';\r\nimport type {ConstantProvider as BaseConstantProvider} from '../../../renderers/common/constants.js';\r\nimport {StatementInput as BaseStatementInput} from '../../../renderers/measurables/statement_input.js';\r\nimport type {ConstantProvider as GerasConstantProvider} from '../constants.js';\r\n\r\n/**\r\n * An object containing information about the space a statement input takes up\r\n * during rendering.\r\n */\r\nexport class StatementInput extends BaseStatementInput {\r\n  override constants_: GerasConstantProvider;\r\n\r\n  /**\r\n   * @param constants The rendering constants provider.\r\n   * @param input The statement input to measure and store information for.\r\n   */\r\n  constructor(constants: BaseConstantProvider, input: Input) {\r\n    super(constants, input);\r\n    this.constants_ = constants as GerasConstantProvider;\r\n\r\n    if (this.connectedBlock) {\r\n      // We allow the dark path to show on the parent block so that the child\r\n      // block looks embossed.  This takes up an extra pixel in both x and y.\r\n      this.height += this.constants_.DARK_PATH_OFFSET;\r\n    }\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.geras.RenderInfo\r\n\r\nimport type {BlockSvg} from '../../block_svg.js';\r\nimport type {Input} from '../../inputs/input.js';\r\nimport {RenderInfo as BaseRenderInfo} from '../common/info.js';\r\nimport type {Measurable} from '../measurables/base.js';\r\nimport type {BottomRow} from '../measurables/bottom_row.js';\r\nimport {DummyInput} from '../../inputs/dummy_input.js';\r\nimport {EndRowInput} from '../../inputs/end_row_input.js';\r\nimport {ExternalValueInput} from '../measurables/external_value_input.js';\r\nimport type {Field} from '../measurables/field.js';\r\nimport {InRowSpacer} from '../measurables/in_row_spacer.js';\r\nimport type {InputRow} from '../measurables/input_row.js';\r\nimport type {Row} from '../measurables/row.js';\r\nimport {StatementInput} from '../../inputs/statement_input.js';\r\nimport type {TopRow} from '../measurables/top_row.js';\r\nimport {Types} from '../measurables/types.js';\r\nimport {ValueInput} from '../../inputs/value_input.js';\r\n\r\nimport type {ConstantProvider} from './constants.js';\r\nimport {InlineInput} from './measurables/inline_input.js';\r\nimport {StatementInput as StatementInputMeasurable} from './measurables/statement_input.js';\r\nimport type {Renderer} from './renderer.js';\r\n\r\n/**\r\n * An object containing all sizing information needed to draw this block,\r\n * customized for the geras renderer.\r\n *\r\n * This measure pass does not propagate changes to the block (although fields\r\n * may choose to rerender when getSize() is called).  However, calling it\r\n * repeatedly may be expensive.\r\n */\r\nexport class RenderInfo extends BaseRenderInfo {\r\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\r\n  override constants_!: ConstantProvider;\r\n\r\n  protected override readonly renderer_: Renderer;\r\n\r\n  /**\r\n   * @param renderer The renderer in use.\r\n   * @param block The block to measure.\r\n   */\r\n  constructor(renderer: Renderer, block: BlockSvg) {\r\n    super(renderer, block);\r\n    this.renderer_ = renderer;\r\n  }\r\n\r\n  /**\r\n   * Get the block renderer in use.\r\n   *\r\n   * @returns The block renderer in use.\r\n   */\r\n  override getRenderer(): Renderer {\r\n    return this.renderer_;\r\n  }\r\n\r\n  override populateBottomRow_() {\r\n    super.populateBottomRow_();\r\n\r\n    const followsStatement =\r\n      this.block_.inputList.length &&\r\n      this.block_.inputList[this.block_.inputList.length - 1] instanceof\r\n        StatementInput;\r\n    // The minimum height of the bottom row is smaller in Geras than in other\r\n    // renderers, because the dark path adds a pixel.\r\n    // If one of the row's elements has a greater height this will be\r\n    // overwritten in the compute pass.\r\n    if (!followsStatement) {\r\n      this.bottomRow.minHeight =\r\n        this.constants_.MEDIUM_PADDING - this.constants_.DARK_PATH_OFFSET;\r\n    }\r\n  }\r\n\r\n  override addInput_(input: Input, activeRow: Row) {\r\n    // Non-dummy inputs have visual representations onscreen.\r\n    if (this.isInline && input instanceof ValueInput) {\r\n      activeRow.elements.push(new InlineInput(this.constants_, input));\r\n      activeRow.hasInlineInput = true;\r\n    } else if (input instanceof StatementInput) {\r\n      activeRow.elements.push(\r\n        new StatementInputMeasurable(this.constants_, input),\r\n      );\r\n      activeRow.hasStatement = true;\r\n    } else if (input instanceof ValueInput) {\r\n      activeRow.elements.push(new ExternalValueInput(this.constants_, input));\r\n      activeRow.hasExternalInput = true;\r\n    } else if (input instanceof DummyInput || input instanceof EndRowInput) {\r\n      // Dummy and end-row inputs have no visual representation, but the\r\n      // information is still important.\r\n      activeRow.minHeight = Math.max(\r\n        activeRow.minHeight,\r\n        this.constants_.DUMMY_INPUT_MIN_HEIGHT,\r\n      );\r\n      activeRow.hasDummyInput = true;\r\n    }\r\n    // Ignore row alignment if inline.\r\n    if (!this.isInline && activeRow.align === null) {\r\n      activeRow.align = input.align;\r\n    }\r\n  }\r\n\r\n  override addElemSpacing_() {\r\n    let hasExternalInputs = false;\r\n    for (let i = 0, row; (row = this.rows[i]); i++) {\r\n      if (row.hasExternalInput) {\r\n        hasExternalInputs = true;\r\n      }\r\n    }\r\n    for (let i = 0, row; (row = this.rows[i]); i++) {\r\n      const oldElems = row.elements;\r\n      row.elements = [];\r\n      // No spacing needed before the corner on the top row or the bottom row.\r\n      if (row.startsWithElemSpacer()) {\r\n        // There's a spacer before the first element in the row.\r\n        row.elements.push(\r\n          new InRowSpacer(\r\n            this.constants_,\r\n            this.getInRowSpacing_(null, oldElems[0]),\r\n          ),\r\n        );\r\n      }\r\n      if (!oldElems.length) {\r\n        continue;\r\n      }\r\n      for (let e = 0; e < oldElems.length - 1; e++) {\r\n        row.elements.push(oldElems[e]);\r\n        const spacing = this.getInRowSpacing_(oldElems[e], oldElems[e + 1]);\r\n        row.elements.push(new InRowSpacer(this.constants_, spacing));\r\n      }\r\n      row.elements.push(oldElems[oldElems.length - 1]);\r\n      if (row.endsWithElemSpacer()) {\r\n        let spacing = this.getInRowSpacing_(\r\n          oldElems[oldElems.length - 1],\r\n          null,\r\n        );\r\n        if (hasExternalInputs && row.hasDummyInput) {\r\n          spacing += this.constants_.TAB_WIDTH;\r\n        }\r\n        // There's a spacer after the last element in the row.\r\n        row.elements.push(new InRowSpacer(this.constants_, spacing));\r\n      }\r\n    }\r\n  }\r\n\r\n  override getInRowSpacing_(prev: Measurable | null, next: Measurable | null) {\r\n    if (!prev) {\r\n      // Between an editable field and the beginning of the row.\r\n      if (next && Types.isField(next) && (next as Field).isEditable) {\r\n        return this.constants_.MEDIUM_PADDING;\r\n      }\r\n      // Inline input at the beginning of the row.\r\n      if (next && Types.isInlineInput(next)) {\r\n        return this.constants_.MEDIUM_LARGE_PADDING;\r\n      }\r\n      if (next && Types.isStatementInput(next)) {\r\n        return this.constants_.STATEMENT_INPUT_PADDING_LEFT;\r\n      }\r\n      // Anything else at the beginning of the row.\r\n      return this.constants_.LARGE_PADDING;\r\n    }\r\n\r\n    // Spacing between a non-input and the end of the row or a statement input.\r\n    if (!Types.isInput(prev) && (!next || Types.isStatementInput(next))) {\r\n      // Between an editable field and the end of the row.\r\n      if (Types.isField(prev) && (prev as Field).isEditable) {\r\n        return this.constants_.MEDIUM_PADDING;\r\n      }\r\n      // Padding at the end of an icon-only row to make the block shape clearer.\r\n      if (Types.isIcon(prev)) {\r\n        return this.constants_.LARGE_PADDING * 2 + 1;\r\n      }\r\n      if (Types.isHat(prev)) {\r\n        return this.constants_.NO_PADDING;\r\n      }\r\n      // Establish a minimum width for a block with a previous or next\r\n      // connection.\r\n      if (Types.isPreviousOrNextConnection(prev)) {\r\n        return this.constants_.LARGE_PADDING;\r\n      }\r\n      // Between rounded corner and the end of the row.\r\n      if (Types.isLeftRoundedCorner(prev)) {\r\n        return this.constants_.MIN_BLOCK_WIDTH;\r\n      }\r\n      // Between a jagged edge and the end of the row.\r\n      if (Types.isJaggedEdge(prev)) {\r\n        return this.constants_.NO_PADDING;\r\n      }\r\n      // Between noneditable fields and icons and the end of the row.\r\n      return this.constants_.LARGE_PADDING;\r\n    }\r\n\r\n    // Between inputs and the end of the row.\r\n    if (Types.isInput(prev) && !next) {\r\n      if (Types.isExternalInput(prev)) {\r\n        return this.constants_.NO_PADDING;\r\n      } else if (Types.isInlineInput(prev)) {\r\n        return this.constants_.LARGE_PADDING;\r\n      } else if (Types.isStatementInput(prev)) {\r\n        return this.constants_.NO_PADDING;\r\n      }\r\n    }\r\n\r\n    // Spacing between a non-input and an input.\r\n    if (!Types.isInput(prev) && next && Types.isInput(next)) {\r\n      // Between an editable field and an input.\r\n      if (Types.isField(prev) && (prev as Field).isEditable) {\r\n        if (Types.isInlineInput(next)) {\r\n          return this.constants_.SMALL_PADDING;\r\n        } else if (Types.isExternalInput(next)) {\r\n          return this.constants_.SMALL_PADDING;\r\n        }\r\n      } else {\r\n        if (Types.isInlineInput(next)) {\r\n          return this.constants_.MEDIUM_LARGE_PADDING;\r\n        } else if (Types.isExternalInput(next)) {\r\n          return this.constants_.MEDIUM_LARGE_PADDING;\r\n        } else if (Types.isStatementInput(next)) {\r\n          return this.constants_.LARGE_PADDING;\r\n        }\r\n      }\r\n      return this.constants_.LARGE_PADDING - 1;\r\n    }\r\n\r\n    // Spacing between an icon and an icon or field.\r\n    if (Types.isIcon(prev) && next && !Types.isInput(next)) {\r\n      return this.constants_.LARGE_PADDING;\r\n    }\r\n    // Spacing between an inline input and a field.\r\n    if (Types.isInlineInput(prev) && next && Types.isField(next)) {\r\n      // Editable field after inline input.\r\n      if ((next as Field).isEditable) {\r\n        return this.constants_.MEDIUM_PADDING;\r\n      } else {\r\n        // Noneditable field after inline input.\r\n        return this.constants_.LARGE_PADDING;\r\n      }\r\n    }\r\n\r\n    if (Types.isLeftSquareCorner(prev) && next) {\r\n      // Spacing between a hat and a corner\r\n      if (Types.isHat(next)) {\r\n        return this.constants_.NO_PADDING;\r\n      }\r\n      // Spacing between a square corner and a previous or next connection\r\n      if (Types.isPreviousConnection(next)) {\r\n        return next.notchOffset;\r\n      } else if (Types.isNextConnection(next)) {\r\n        // Next connections are shifted slightly to the left (in both LTR and\r\n        // RTL) to make the dark path under the previous connection show\r\n        // through.\r\n        const offset =\r\n          ((this.RTL ? 1 : -1) * this.constants_.DARK_PATH_OFFSET) / 2;\r\n        return next.notchOffset + offset;\r\n      }\r\n    }\r\n\r\n    // Spacing between a rounded corner and a previous or next connection.\r\n    if (Types.isLeftRoundedCorner(prev) && next) {\r\n      if (Types.isPreviousConnection(next)) {\r\n        return next.notchOffset - this.constants_.CORNER_RADIUS;\r\n      } else if (Types.isNextConnection(next)) {\r\n        // Next connections are shifted slightly to the left (in both LTR and\r\n        // RTL) to make the dark path under the previous connection show\r\n        // through.\r\n        const offset =\r\n          ((this.RTL ? 1 : -1) * this.constants_.DARK_PATH_OFFSET) / 2;\r\n        return next.notchOffset - this.constants_.CORNER_RADIUS + offset;\r\n      }\r\n    }\r\n\r\n    // Spacing between two fields of the same editability.\r\n    if (\r\n      Types.isField(prev) &&\r\n      next &&\r\n      Types.isField(next) &&\r\n      (prev as Field).isEditable === (next as Field).isEditable\r\n    ) {\r\n      return this.constants_.LARGE_PADDING;\r\n    }\r\n\r\n    // Spacing between anything and a jagged edge.\r\n    if (next && Types.isJaggedEdge(next)) {\r\n      return this.constants_.LARGE_PADDING;\r\n    }\r\n\r\n    return this.constants_.MEDIUM_PADDING;\r\n  }\r\n\r\n  override getSpacerRowHeight_(prev: Row, next: Row) {\r\n    // If we have an empty block add a spacer to increase the height.\r\n    if (Types.isTopRow(prev) && Types.isBottomRow(next)) {\r\n      return this.constants_.EMPTY_BLOCK_SPACER_HEIGHT;\r\n    }\r\n    // Top and bottom rows act as a spacer so we don't need any extra padding.\r\n    if (Types.isTopRow(prev) || Types.isBottomRow(next)) {\r\n      return this.constants_.NO_PADDING;\r\n    }\r\n    if (prev.hasExternalInput && next.hasExternalInput) {\r\n      return this.constants_.LARGE_PADDING;\r\n    }\r\n    if (!prev.hasStatement && next.hasStatement) {\r\n      return this.constants_.BETWEEN_STATEMENT_PADDING_Y;\r\n    }\r\n    if (prev.hasStatement && next.hasStatement) {\r\n      return this.constants_.LARGE_PADDING;\r\n    }\r\n    if (!prev.hasStatement && next.hasDummyInput) {\r\n      return this.constants_.LARGE_PADDING;\r\n    }\r\n    if (prev.hasDummyInput) {\r\n      return this.constants_.LARGE_PADDING;\r\n    }\r\n    return this.constants_.MEDIUM_PADDING;\r\n  }\r\n\r\n  override getElemCenterline_(row: Row, elem: Measurable) {\r\n    if (Types.isSpacer(elem)) {\r\n      return row.yPos + elem.height / 2;\r\n    }\r\n    if (Types.isBottomRow(row)) {\r\n      const bottomRow = row as BottomRow;\r\n      const baseline =\r\n        bottomRow.yPos + bottomRow.height - bottomRow.descenderHeight;\r\n      if (Types.isNextConnection(elem)) {\r\n        return baseline + elem.height / 2;\r\n      }\r\n      return baseline - elem.height / 2;\r\n    }\r\n    if (Types.isTopRow(row)) {\r\n      const topRow = row as TopRow;\r\n      if (Types.isHat(elem)) {\r\n        return topRow.capline - elem.height / 2;\r\n      }\r\n      return topRow.capline + elem.height / 2;\r\n    }\r\n\r\n    let result = row.yPos;\r\n    if (Types.isField(elem) || Types.isIcon(elem)) {\r\n      result += elem.height / 2;\r\n      if (\r\n        (row.hasInlineInput || row.hasStatement) &&\r\n        elem.height + this.constants_.TALL_INPUT_FIELD_OFFSET_Y <= row.height\r\n      ) {\r\n        result += this.constants_.TALL_INPUT_FIELD_OFFSET_Y;\r\n      }\r\n    } else if (Types.isInlineInput(elem)) {\r\n      result += elem.height / 2;\r\n    } else {\r\n      result += row.height / 2;\r\n    }\r\n    return result;\r\n  }\r\n\r\n  override alignRowElements_() {\r\n    if (!this.isInline) {\r\n      super.alignRowElements_();\r\n      return;\r\n    }\r\n    // Walk backgrounds through rows on the block, keeping track of the right\r\n    // input edge.\r\n    let nextRightEdge = 0;\r\n    const rowNextRightEdges = new WeakMap();\r\n    let prevInput = null;\r\n    for (let i = this.rows.length - 1, row; (row = this.rows[i]); i--) {\r\n      rowNextRightEdges.set(row, nextRightEdge);\r\n      if (Types.isInputRow(row)) {\r\n        if (row.hasStatement) {\r\n          this.alignStatementRow_(row as InputRow);\r\n        }\r\n        if (\r\n          prevInput &&\r\n          prevInput.hasStatement &&\r\n          row.width < prevInput.width\r\n        ) {\r\n          rowNextRightEdges.set(row, prevInput.width);\r\n        } else if (row.hasStatement) {\r\n          nextRightEdge = row.width;\r\n        } else {\r\n          // To keep right edges of consecutive non-statement rows aligned, use\r\n          // the maximum width.\r\n          nextRightEdge = Math.max(nextRightEdge, row.width);\r\n        }\r\n        prevInput = row;\r\n      }\r\n    }\r\n    // Walk down each row from the top, comparing the prev and next right input\r\n    // edges and setting the desired width to the max of the two.\r\n    let prevRightEdge = 0;\r\n    for (let i = 0, row; (row = this.rows[i]); i++) {\r\n      if (row.hasStatement) {\r\n        prevRightEdge = this.getDesiredRowWidth_(row);\r\n      } else if (Types.isSpacer(row)) {\r\n        // Set the spacer row to the max of the prev or next input width.\r\n        row.width = Math.max(prevRightEdge, rowNextRightEdges.get(row));\r\n      } else {\r\n        const currentWidth = row.width;\r\n        const desiredWidth = Math.max(\r\n          prevRightEdge,\r\n          rowNextRightEdges.get(row),\r\n        );\r\n        const missingSpace = desiredWidth - currentWidth;\r\n        if (missingSpace > 0) {\r\n          this.addAlignmentPadding_(row, missingSpace);\r\n        }\r\n        prevRightEdge = row.width;\r\n      }\r\n    }\r\n  }\r\n\r\n  override getDesiredRowWidth_(row: Row) {\r\n    // Limit the width of a statement row when a block is inline.\r\n    if (this.isInline && row.hasStatement) {\r\n      return (\r\n        this.statementEdge + this.constants_.MAX_BOTTOM_WIDTH + this.startX\r\n      );\r\n    }\r\n    return super.getDesiredRowWidth_(row);\r\n  }\r\n\r\n  override finalize_() {\r\n    // Performance note: this could be combined with the draw pass, if the time\r\n    // that this takes is excessive.  But it shouldn't be, because it only\r\n    // accesses and sets properties that already exist on the objects.\r\n    let widestRowWithConnectedBlocks = 0;\r\n    let yCursor = 0;\r\n    for (let i = 0, row; (row = this.rows[i]); i++) {\r\n      row.yPos = yCursor;\r\n      row.xPos = this.startX;\r\n      yCursor += row.height;\r\n\r\n      widestRowWithConnectedBlocks = Math.max(\r\n        widestRowWithConnectedBlocks,\r\n        row.widthWithConnectedBlocks,\r\n      );\r\n      // Add padding to the bottom row if block height is less than minimum\r\n      const heightWithoutHat = yCursor - this.topRow.ascenderHeight;\r\n      if (\r\n        row === this.bottomRow &&\r\n        heightWithoutHat < this.constants_.MIN_BLOCK_HEIGHT\r\n      ) {\r\n        // But the hat height shouldn't be part of this.\r\n        const diff = this.constants_.MIN_BLOCK_HEIGHT - heightWithoutHat;\r\n        this.bottomRow.height += diff;\r\n        yCursor += diff;\r\n      }\r\n      this.recordElemPositions_(row);\r\n    }\r\n    if (\r\n      this.outputConnection &&\r\n      this.block_.nextConnection &&\r\n      this.block_.nextConnection.isConnected()\r\n    ) {\r\n      const target = this.block_.nextConnection.targetBlock();\r\n      if (target) {\r\n        // Include width of connected block in value to stack width measurement.\r\n        widestRowWithConnectedBlocks = Math.max(\r\n          widestRowWithConnectedBlocks,\r\n          target.getHeightWidth().width - this.constants_.DARK_PATH_OFFSET,\r\n        );\r\n      }\r\n    }\r\n\r\n    this.bottomRow.baseline = yCursor - this.bottomRow.descenderHeight;\r\n    this.widthWithChildren =\r\n      widestRowWithConnectedBlocks +\r\n      this.startX +\r\n      this.constants_.DARK_PATH_OFFSET;\r\n    this.width += this.constants_.DARK_PATH_OFFSET;\r\n    this.height = yCursor + this.constants_.DARK_PATH_OFFSET;\r\n    this.startY = this.topRow.capline;\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.geras.PathObject\r\n\r\nimport type {BlockSvg} from '../../block_svg.js';\r\nimport type {BlockStyle} from '../../theme.js';\r\nimport * as colour from '../../utils/colour.js';\r\nimport * as dom from '../../utils/dom.js';\r\nimport {Svg} from '../../utils/svg.js';\r\nimport {PathObject as BasePathObject} from '../common/path_object.js';\r\n\r\nimport type {ConstantProvider} from './constants.js';\r\n\r\n/**\r\n * An object that handles creating and setting each of the SVG elements\r\n * used by the renderer.\r\n */\r\nexport class PathObject extends BasePathObject {\r\n  svgPathDark: SVGElement;\r\n  svgPathLight: SVGElement;\r\n\r\n  /**\r\n   * The colour of the dark path on the block in '#RRGGBB' format.\r\n   */\r\n  colourDark = '#000000';\r\n\r\n  /**\r\n   * @param root The root SVG element.\r\n   * @param style The style object to use for colouring.\r\n   * @param constants The renderer's constants.\r\n   */\r\n  constructor(\r\n    root: SVGElement,\r\n    style: BlockStyle,\r\n    public override constants: ConstantProvider,\r\n  ) {\r\n    super(root, style, constants);\r\n\r\n    /** The dark path of the block. */\r\n    this.svgPathDark = dom.createSvgElement(Svg.PATH, {\r\n      'class': 'blocklyPathDark',\r\n      'transform': 'translate(1,1)',\r\n    });\r\n    // SVG draw order is based on the order of elements (top most = back most)\r\n    // So we need to insert the dark path before the base path to make sure it\r\n    // gets drawn first.\r\n    this.svgRoot.insertBefore(this.svgPathDark, this.svgPath);\r\n\r\n    /** The light path of the block. */\r\n    this.svgPathLight = dom.createSvgElement(\r\n      Svg.PATH,\r\n      {'class': 'blocklyPathLight'},\r\n      this.svgRoot,\r\n    );\r\n  }\r\n\r\n  override setPath(mainPath: string) {\r\n    this.svgPath.setAttribute('d', mainPath);\r\n    this.svgPathDark.setAttribute('d', mainPath);\r\n  }\r\n\r\n  /**\r\n   * Set the highlight path generated by the renderer onto the SVG element.\r\n   *\r\n   * @param highlightPath The highlight path.\r\n   */\r\n  setHighlightPath(highlightPath: string) {\r\n    this.svgPathLight.setAttribute('d', highlightPath);\r\n  }\r\n\r\n  override flipRTL() {\r\n    // Mirror the block's path.\r\n    this.svgPath.setAttribute('transform', 'scale(-1 1)');\r\n    this.svgPathLight.setAttribute('transform', 'scale(-1 1)');\r\n    this.svgPathDark.setAttribute('transform', 'translate(1,1) scale(-1 1)');\r\n  }\r\n\r\n  override applyColour(block: BlockSvg) {\r\n    this.svgPathLight.style.display = '';\r\n    this.svgPathDark.style.display = '';\r\n    if (!this.style.colourTertiary) {\r\n      throw new Error(\r\n        'The renderer did not properly initialize the tertiary colour of ' +\r\n          'the block style',\r\n      );\r\n    }\r\n    this.svgPathLight.setAttribute('stroke', this.style.colourTertiary);\r\n    this.svgPathDark.setAttribute('fill', this.colourDark);\r\n\r\n    super.applyColour(block);\r\n\r\n    this.svgPath.setAttribute('stroke', 'none');\r\n  }\r\n\r\n  override setStyle(blockStyle: BlockStyle) {\r\n    this.style = blockStyle;\r\n    this.colourDark =\r\n      colour.blend('#000', this.style.colourPrimary, 0.2) || this.colourDark;\r\n  }\r\n\r\n  override updateHighlighted(highlighted: boolean) {\r\n    if (highlighted) {\r\n      this.svgPath.setAttribute(\r\n        'filter',\r\n        'url(#' + this.constants.embossFilterId + ')',\r\n      );\r\n      this.svgPathLight.style.display = 'none';\r\n    } else {\r\n      this.svgPath.setAttribute('filter', 'none');\r\n      this.svgPathLight.style.display = 'inline';\r\n    }\r\n  }\r\n\r\n  override updateShadow_(shadow: boolean) {\r\n    if (shadow) {\r\n      this.svgPathLight.style.display = 'none';\r\n      if (!this.style.colourSecondary) {\r\n        throw new Error(\r\n          'The renderer did not properly initialize the secondary colour ' +\r\n            'of the block style block style',\r\n        );\r\n      }\r\n      this.svgPathDark.setAttribute('fill', this.style.colourSecondary);\r\n      this.svgPath.setAttribute('stroke', 'none');\r\n      this.svgPath.setAttribute('fill', this.style.colourSecondary);\r\n    }\r\n  }\r\n\r\n  override updateDisabled_(disabled: boolean) {\r\n    super.updateDisabled_(disabled);\r\n    if (disabled) {\r\n      this.svgPath.setAttribute('stroke', 'none');\r\n    }\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.geras.Renderer\r\n\r\nimport type {BlockSvg} from '../../block_svg.js';\r\nimport type {BlockStyle, Theme} from '../../theme.js';\r\nimport * as blockRendering from '../common/block_rendering.js';\r\nimport type {RenderInfo as BaseRenderInfo} from '../common/info.js';\r\nimport {Renderer as BaseRenderer} from '../common/renderer.js';\r\n\r\nimport {ConstantProvider} from './constants.js';\r\nimport {Drawer} from './drawer.js';\r\nimport {HighlightConstantProvider} from './highlight_constants.js';\r\nimport {RenderInfo} from './info.js';\r\nimport {PathObject} from './path_object.js';\r\n\r\n/**\r\n * The geras renderer. This renderer was designed to be backwards compatible\r\n * with pre-2019 Blockly. Newer projects that are not constrained by backwards\r\n * compatibility should use thrasos, which is a more modern take on this\r\n * renderer.\r\n *\r\n * Geras is the ancient Greek spirit of old age.\r\n */\r\nexport class Renderer extends BaseRenderer {\r\n  /** The renderer's highlight constant provider. */\r\n  private highlightConstants: HighlightConstantProvider | null = null;\r\n\r\n  /**\r\n   * @param name The renderer name.\r\n   */\r\n  constructor(name: string) {\r\n    super(name);\r\n  }\r\n\r\n  /**\r\n   * Initialize the renderer.  Geras has a highlight provider in addition to\r\n   * the normal constant provider.\r\n   */\r\n  override init(\r\n    theme: Theme,\r\n    opt_rendererOverrides?: {[rendererConstant: string]: any},\r\n  ) {\r\n    super.init(theme, opt_rendererOverrides);\r\n    this.highlightConstants = this.makeHighlightConstants_();\r\n    this.highlightConstants.init();\r\n  }\r\n\r\n  override refreshDom(svg: SVGElement, theme: Theme) {\r\n    super.refreshDom(svg, theme);\r\n    this.getHighlightConstants().init();\r\n  }\r\n\r\n  override makeConstants_() {\r\n    return new ConstantProvider();\r\n  }\r\n\r\n  /**\r\n   * Create a new instance of the renderer's render info object.\r\n   *\r\n   * @param block The block to measure.\r\n   * @returns The render info object.\r\n   */\r\n  protected override makeRenderInfo_(block: BlockSvg): RenderInfo {\r\n    return new RenderInfo(this, block);\r\n  }\r\n\r\n  /**\r\n   * Create a new instance of the renderer's drawer.\r\n   *\r\n   * @param block The block to render.\r\n   * @param info An object containing all information needed to render this\r\n   *     block.\r\n   * @returns The drawer.\r\n   */\r\n  protected override makeDrawer_(\r\n    block: BlockSvg,\r\n    info: BaseRenderInfo,\r\n  ): Drawer {\r\n    return new Drawer(block, info as RenderInfo);\r\n  }\r\n\r\n  /**\r\n   * Create a new instance of a renderer path object.\r\n   *\r\n   * @param root The root SVG element.\r\n   * @param style The style object to use for colouring.\r\n   * @returns The renderer path object.\r\n   */\r\n  override makePathObject(root: SVGElement, style: BlockStyle): PathObject {\r\n    return new PathObject(root, style, this.getConstants() as ConstantProvider);\r\n  }\r\n\r\n  /**\r\n   * Create a new instance of the renderer's highlight constant provider.\r\n   *\r\n   * @returns The highlight constant provider.\r\n   */\r\n  protected makeHighlightConstants_(): HighlightConstantProvider {\r\n    return new HighlightConstantProvider(this.getConstants());\r\n  }\r\n\r\n  /**\r\n   * Get the renderer's highlight constant provider.  We assume that when this\r\n   * is called, the renderer has already been initialized.\r\n   *\r\n   * @returns The highlight constant provider.\r\n   */\r\n  getHighlightConstants(): HighlightConstantProvider {\r\n    if (!this.highlightConstants) {\r\n      throw new Error(\r\n        'Cannot access the highlight constants because init has not ' +\r\n          'been called',\r\n      );\r\n    }\r\n    return this.highlightConstants;\r\n  }\r\n}\r\n\r\nblockRendering.register('geras', Renderer);\r\n","/** @file Re-exports of Blockly.geras.* modules. */\r\n\r\n/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.geras\r\n\r\nimport {ConstantProvider} from './constants.js';\r\nimport {Drawer} from './drawer.js';\r\nimport {HighlightConstantProvider} from './highlight_constants.js';\r\nimport {Highlighter} from './highlighter.js';\r\nimport {RenderInfo} from './info.js';\r\nimport {InlineInput} from './measurables/inline_input.js';\r\nimport {StatementInput} from './measurables/statement_input.js';\r\nimport {PathObject} from './path_object.js';\r\nimport {Renderer} from './renderer.js';\r\n\r\nexport {\r\n  ConstantProvider,\r\n  Drawer,\r\n  HighlightConstantProvider,\r\n  Highlighter,\r\n  InlineInput,\r\n  PathObject,\r\n  Renderer,\r\n  RenderInfo,\r\n  StatementInput,\r\n};\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.minimalist.ConstantProvider\r\n\r\nimport {ConstantProvider as BaseConstantProvider} from '../common/constants.js';\r\nimport * as deprecation from '../../utils/deprecation.js';\r\n\r\n/**\r\n * An object that provides constants for rendering blocks in the minimalist\r\n * renderer.\r\n *\r\n * @deprecated Use Blockly.blockRendering.ConstantProvider instead.\r\n *     To be removed in v11.\r\n */\r\nexport class ConstantProvider extends BaseConstantProvider {\r\n  /**\r\n   * @deprecated Use Blockly.blockRendering.ConstantProvider instead.\r\n   *     To be removed in v11.\r\n   */\r\n  constructor() {\r\n    super();\r\n    deprecation.warn(\r\n      'Blockly.minimalist.ConstantProvider',\r\n      'v10',\r\n      'v11',\r\n      'Blockly.blockRendering.ConstantProvider',\r\n    );\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.minimalist.Drawer\r\n\r\nimport type {BlockSvg} from '../../block_svg.js';\r\nimport {Drawer as BaseDrawer} from '../common/drawer.js';\r\nimport * as deprecation from '../../utils/deprecation.js';\r\n\r\nimport type {RenderInfo} from './info.js';\r\n\r\n/**\r\n * An object that draws a block based on the given rendering information.\r\n *\r\n * @deprecated Use Blockly.blockRendering.Drawer instead.\r\n *     To be removed in v11.\r\n */\r\nexport class Drawer extends BaseDrawer {\r\n  /**\r\n   * @param block The block to render.\r\n   * @param info An object containing all information needed to render this\r\n   *     block.\r\n   *\r\n   * @deprecated Use Blockly.blockRendering.Drawer instead.\r\n   *     To be removed in v11.\r\n   */\r\n  constructor(block: BlockSvg, info: RenderInfo) {\r\n    super(block, info);\r\n    deprecation.warn(\r\n      'Blockly.minimalist.Drawer',\r\n      'v10',\r\n      'v11',\r\n      'Blockly.blockRendering.Drawer',\r\n    );\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.minimalist.RenderInfo\r\n\r\nimport type {BlockSvg} from '../../block_svg.js';\r\nimport {RenderInfo as BaseRenderInfo} from '../common/info.js';\r\nimport * as deprecation from '../../utils/deprecation.js';\r\n\r\nimport type {Renderer} from './renderer.js';\r\n\r\n/**\r\n * An object containing all sizing information needed to draw this block.\r\n *\r\n * This measure pass does not propagate changes to the block (although fields\r\n * may choose to rerender when getSize() is called).  However, calling it\r\n * repeatedly may be expensive.\r\n *\r\n * @deprecated Use Blockly.blockRendering.RenderInfo instead. To be removed\r\n *     in v11.\r\n */\r\nexport class RenderInfo extends BaseRenderInfo {\r\n  // Exclamation is fine b/c this is assigned by the super constructor.\r\n  protected override renderer_!: Renderer;\r\n\r\n  /**\r\n   * @param renderer The renderer in use.\r\n   * @param block The block to measure.\r\n   * @deprecated Use Blockly.blockRendering.RenderInfo instead. To be removed\r\n   *     in v11.\r\n   */\r\n  constructor(renderer: Renderer, block: BlockSvg) {\r\n    super(renderer, block);\r\n    deprecation.warn(\r\n      'Blockly.minimalist.RenderInfo',\r\n      'v10',\r\n      'v11',\r\n      'Blockly.blockRendering.RenderInfo',\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get the block renderer in use.\r\n   *\r\n   * @returns The block renderer in use.\r\n   */\r\n  override getRenderer(): Renderer {\r\n    return this.renderer_;\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.minimalist.Renderer\r\n\r\nimport type {BlockSvg} from '../../block_svg.js';\r\nimport * as blockRendering from '../common/block_rendering.js';\r\nimport type {RenderInfo as BaseRenderInfo} from '../common/info.js';\r\nimport {Renderer as BaseRenderer} from '../common/renderer.js';\r\nimport * as deprecation from '../../utils/deprecation.js';\r\n\r\nimport {ConstantProvider} from './constants.js';\r\nimport {Drawer} from './drawer.js';\r\nimport {RenderInfo} from './info.js';\r\n\r\n/**\r\n * The minimalist renderer.\r\n *\r\n * @deprecated Use Blockly.blockRendering.Renderer instead. To be removed\r\n *     in v11.\r\n */\r\nexport class Renderer extends BaseRenderer {\r\n  /**\r\n   * @param name The renderer name.\r\n   * @deprecated Use Blockly.blockRendering.Renderer instead. To be removed\r\n   *     in v11.\r\n   */\r\n  constructor(name: string) {\r\n    super(name);\r\n    deprecation.warn(\r\n      'Blockly.minimalist.Renderer',\r\n      'v10',\r\n      'v11',\r\n      'Blockly.blockRendering.Renderer',\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Create a new instance of the renderer's constant provider.\r\n   *\r\n   * @returns The constant provider.\r\n   */\r\n  protected override makeConstants_(): ConstantProvider {\r\n    return new ConstantProvider();\r\n  }\r\n\r\n  /**\r\n   * Create a new instance of the renderer's render info object.\r\n   *\r\n   * @param block The block to measure.\r\n   * @returns The render info object.\r\n   */\r\n  protected override makeRenderInfo_(block: BlockSvg): RenderInfo {\r\n    return new RenderInfo(this, block);\r\n  }\r\n\r\n  /**\r\n   * Create a new instance of the renderer's drawer.\r\n   *\r\n   * @param block The block to render.\r\n   * @param info An object containing all information needed to render this\r\n   *     block.\r\n   * @returns The drawer.\r\n   */\r\n  protected override makeDrawer_(\r\n    block: BlockSvg,\r\n    info: BaseRenderInfo,\r\n  ): Drawer {\r\n    return new Drawer(block, info as RenderInfo);\r\n  }\r\n}\r\n\r\nblockRendering.register('minimalist', Renderer);\r\n","/** @file Re-exports of Blockly.minimalist.* modules. */\r\n\r\n/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.minimalist\r\n\r\nimport {ConstantProvider} from './constants.js';\r\nimport {Drawer} from './drawer.js';\r\nimport {RenderInfo} from './info.js';\r\nimport {Renderer} from './renderer.js';\r\n\r\nexport {ConstantProvider, Drawer, Renderer, RenderInfo};\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.thrasos.RenderInfo\r\n\r\nimport type {BlockSvg} from '../../block_svg.js';\r\nimport {RenderInfo as BaseRenderInfo} from '../common/info.js';\r\nimport type {Measurable} from '../measurables/base.js';\r\nimport type {BottomRow} from '../measurables/bottom_row.js';\r\nimport type {Field} from '../measurables/field.js';\r\nimport {InRowSpacer} from '../measurables/in_row_spacer.js';\r\nimport type {Row} from '../measurables/row.js';\r\nimport type {TopRow} from '../measurables/top_row.js';\r\nimport {Types} from '../measurables/types.js';\r\n\r\nimport type {Renderer} from './renderer.js';\r\n\r\n/**\r\n * An object containing all sizing information needed to draw this block.\r\n *\r\n * This measure pass does not propagate changes to the block (although fields\r\n * may choose to rerender when getSize() is called).  However, calling it\r\n * repeatedly may be expensive.\r\n */\r\nexport class RenderInfo extends BaseRenderInfo {\r\n  // Exclamation is fine b/c this is assigned by the super constructor.\r\n  protected override renderer_!: Renderer;\r\n\r\n  /**\r\n   * @param renderer The renderer in use.\r\n   * @param block The block to measure.\r\n   */\r\n  constructor(renderer: Renderer, block: BlockSvg) {\r\n    super(renderer, block);\r\n  }\r\n\r\n  /**\r\n   * Get the block renderer in use.\r\n   *\r\n   * @returns The block renderer in use.\r\n   */\r\n  override getRenderer(): Renderer {\r\n    return this.renderer_;\r\n  }\r\n\r\n  override addElemSpacing_() {\r\n    let hasExternalInputs = false;\r\n    for (let i = 0; i < this.rows.length; i++) {\r\n      const row = this.rows[i];\r\n      if (row.hasExternalInput) {\r\n        hasExternalInputs = true;\r\n        break;\r\n      }\r\n    }\r\n    for (let i = 0; i < this.rows.length; i++) {\r\n      const row = this.rows[i];\r\n      const oldElems = row.elements;\r\n      row.elements = [];\r\n      // No spacing needed before the corner on the top row or the bottom row.\r\n      if (row.startsWithElemSpacer()) {\r\n        // There's a spacer before the first element in the row.\r\n        row.elements.push(\r\n          new InRowSpacer(\r\n            this.constants_,\r\n            this.getInRowSpacing_(null, oldElems[0]),\r\n          ),\r\n        );\r\n      }\r\n      if (!oldElems.length) {\r\n        continue;\r\n      }\r\n      for (let e = 0; e < oldElems.length - 1; e++) {\r\n        row.elements.push(oldElems[e]);\r\n        const spacing = this.getInRowSpacing_(oldElems[e], oldElems[e + 1]);\r\n        row.elements.push(new InRowSpacer(this.constants_, spacing));\r\n      }\r\n      row.elements.push(oldElems[oldElems.length - 1]);\r\n      if (row.endsWithElemSpacer()) {\r\n        let spacing = this.getInRowSpacing_(\r\n          oldElems[oldElems.length - 1],\r\n          null,\r\n        );\r\n        if (hasExternalInputs && row.hasDummyInput) {\r\n          spacing += this.constants_.TAB_WIDTH;\r\n        }\r\n        // There's a spacer after the last element in the row.\r\n        row.elements.push(new InRowSpacer(this.constants_, spacing));\r\n      }\r\n    }\r\n  }\r\n\r\n  override getInRowSpacing_(prev: Measurable | null, next: Measurable | null) {\r\n    if (!prev) {\r\n      // Between an editable field and the beginning of the row.\r\n      if (next && Types.isField(next) && (next as Field).isEditable) {\r\n        return this.constants_.MEDIUM_PADDING;\r\n      }\r\n      // Inline input at the beginning of the row.\r\n      if (next && Types.isInlineInput(next)) {\r\n        return this.constants_.MEDIUM_LARGE_PADDING;\r\n      }\r\n      if (next && Types.isStatementInput(next)) {\r\n        return this.constants_.STATEMENT_INPUT_PADDING_LEFT;\r\n      }\r\n      // Anything else at the beginning of the row.\r\n      return this.constants_.LARGE_PADDING;\r\n    }\r\n\r\n    // Spacing between a non-input and the end of the row.\r\n    if (!Types.isInput(prev) && !next) {\r\n      // Between an editable field and the end of the row.\r\n      if (Types.isField(prev) && (prev as Field).isEditable) {\r\n        return this.constants_.MEDIUM_PADDING;\r\n      }\r\n      // Padding at the end of an icon-only row to make the block shape clearer.\r\n      if (Types.isIcon(prev)) {\r\n        return this.constants_.LARGE_PADDING * 2 + 1;\r\n      }\r\n      if (Types.isHat(prev)) {\r\n        return this.constants_.NO_PADDING;\r\n      }\r\n      // Establish a minimum width for a block with a previous or next\r\n      // connection.\r\n      if (Types.isPreviousOrNextConnection(prev)) {\r\n        return this.constants_.LARGE_PADDING;\r\n      }\r\n      // Between rounded corner and the end of the row.\r\n      if (Types.isLeftRoundedCorner(prev)) {\r\n        return this.constants_.MIN_BLOCK_WIDTH;\r\n      }\r\n      // Between a jagged edge and the end of the row.\r\n      if (Types.isJaggedEdge(prev)) {\r\n        return this.constants_.NO_PADDING;\r\n      }\r\n      // Between noneditable fields and icons and the end of the row.\r\n      return this.constants_.LARGE_PADDING;\r\n    }\r\n    // Between inputs and the end of the row.\r\n    if (Types.isInput(prev) && !next) {\r\n      if (Types.isExternalInput(prev)) {\r\n        return this.constants_.NO_PADDING;\r\n      } else if (Types.isInlineInput(prev)) {\r\n        return this.constants_.LARGE_PADDING;\r\n      } else if (Types.isStatementInput(prev)) {\r\n        return this.constants_.NO_PADDING;\r\n      }\r\n    }\r\n\r\n    // Spacing between a non-input and an input.\r\n    if (!Types.isInput(prev) && next && Types.isInput(next)) {\r\n      // Between an editable field and an input.\r\n      if (Types.isField(prev) && (prev as Field).isEditable) {\r\n        if (Types.isInlineInput(next)) {\r\n          return this.constants_.SMALL_PADDING;\r\n        } else if (Types.isExternalInput(next)) {\r\n          return this.constants_.SMALL_PADDING;\r\n        }\r\n      } else {\r\n        if (Types.isInlineInput(next)) {\r\n          return this.constants_.MEDIUM_LARGE_PADDING;\r\n        } else if (Types.isExternalInput(next)) {\r\n          return this.constants_.MEDIUM_LARGE_PADDING;\r\n        } else if (Types.isStatementInput(next)) {\r\n          return this.constants_.LARGE_PADDING;\r\n        }\r\n      }\r\n      return this.constants_.LARGE_PADDING - 1;\r\n    }\r\n\r\n    // Spacing between an icon and an icon or field.\r\n    if (Types.isIcon(prev) && next && !Types.isInput(next)) {\r\n      return this.constants_.LARGE_PADDING;\r\n    }\r\n\r\n    // Spacing between an inline input and a field.\r\n    if (Types.isInlineInput(prev) && next && Types.isField(next)) {\r\n      // Editable field after inline input.\r\n      if ((next as Field).isEditable) {\r\n        return this.constants_.MEDIUM_PADDING;\r\n      } else {\r\n        // Noneditable field after inline input.\r\n        return this.constants_.LARGE_PADDING;\r\n      }\r\n    }\r\n\r\n    if (Types.isLeftSquareCorner(prev) && next) {\r\n      // Spacing between a hat and a corner\r\n      if (Types.isHat(next)) {\r\n        return this.constants_.NO_PADDING;\r\n      }\r\n      // Spacing between a square corner and a previous or next connection\r\n      if (Types.isPreviousConnection(next) || Types.isNextConnection(next)) {\r\n        return next.notchOffset;\r\n      }\r\n    }\r\n    // Spacing between a rounded corner and a previous or next connection.\r\n    if (Types.isLeftRoundedCorner(prev) && next) {\r\n      return next.notchOffset - this.constants_.CORNER_RADIUS;\r\n    }\r\n\r\n    // Spacing between two fields of the same editability.\r\n    if (\r\n      Types.isField(prev) &&\r\n      next &&\r\n      Types.isField(next) &&\r\n      (prev as Field).isEditable === (next as Field).isEditable\r\n    ) {\r\n      return this.constants_.LARGE_PADDING;\r\n    }\r\n\r\n    // Spacing between anything and a jagged edge.\r\n    if (next && Types.isJaggedEdge(next)) {\r\n      return this.constants_.LARGE_PADDING;\r\n    }\r\n\r\n    return this.constants_.MEDIUM_PADDING;\r\n  }\r\n\r\n  override getSpacerRowHeight_(prev: Row, next: Row) {\r\n    // If we have an empty block add a spacer to increase the height.\r\n    if (Types.isTopRow(prev) && Types.isBottomRow(next)) {\r\n      return this.constants_.EMPTY_BLOCK_SPACER_HEIGHT;\r\n    }\r\n    // Top and bottom rows act as a spacer so we don't need any extra padding.\r\n    if (Types.isTopRow(prev) || Types.isBottomRow(next)) {\r\n      return this.constants_.NO_PADDING;\r\n    }\r\n    if (prev.hasExternalInput && next.hasExternalInput) {\r\n      return this.constants_.LARGE_PADDING;\r\n    }\r\n    if (!prev.hasStatement && next.hasStatement) {\r\n      return this.constants_.BETWEEN_STATEMENT_PADDING_Y;\r\n    }\r\n    if (prev.hasStatement && next.hasStatement) {\r\n      return this.constants_.LARGE_PADDING;\r\n    }\r\n    if (prev.hasDummyInput || next.hasDummyInput) {\r\n      return this.constants_.LARGE_PADDING;\r\n    }\r\n    return this.constants_.MEDIUM_PADDING;\r\n  }\r\n\r\n  override getElemCenterline_(row: Row, elem: Measurable) {\r\n    if (Types.isSpacer(elem)) {\r\n      return row.yPos + elem.height / 2;\r\n    }\r\n    if (Types.isBottomRow(row)) {\r\n      const bottomRow = row as BottomRow;\r\n      const baseline =\r\n        bottomRow.yPos + bottomRow.height - bottomRow.descenderHeight;\r\n      if (Types.isNextConnection(elem)) {\r\n        return baseline + elem.height / 2;\r\n      }\r\n      return baseline - elem.height / 2;\r\n    }\r\n    if (Types.isTopRow(row)) {\r\n      const topRow = row as TopRow;\r\n      if (Types.isHat(elem)) {\r\n        return topRow.capline - elem.height / 2;\r\n      }\r\n      return topRow.capline + elem.height / 2;\r\n    }\r\n\r\n    let result = row.yPos;\r\n    if (Types.isField(elem) && row.hasStatement) {\r\n      const offset =\r\n        this.constants_.TALL_INPUT_FIELD_OFFSET_Y + elem.height / 2;\r\n      result += offset;\r\n    } else {\r\n      result += row.height / 2;\r\n    }\r\n    return result;\r\n  }\r\n\r\n  override finalize_() {\r\n    // Performance note: this could be combined with the draw pass, if the time\r\n    // that this takes is excessive.  But it shouldn't be, because it only\r\n    // accesses and sets properties that already exist on the objects.\r\n    let widestRowWithConnectedBlocks = 0;\r\n    let yCursor = 0;\r\n    for (let i = 0; i < this.rows.length; i++) {\r\n      const row = this.rows[i];\r\n      row.yPos = yCursor;\r\n      row.xPos = this.startX;\r\n      yCursor += row.height;\r\n\r\n      widestRowWithConnectedBlocks = Math.max(\r\n        widestRowWithConnectedBlocks,\r\n        row.widthWithConnectedBlocks,\r\n      );\r\n      // Add padding to the bottom row if block height is less than minimum\r\n      const heightWithoutHat = yCursor - this.topRow.ascenderHeight;\r\n      if (\r\n        row === this.bottomRow &&\r\n        heightWithoutHat < this.constants_.MIN_BLOCK_HEIGHT\r\n      ) {\r\n        // But the hat height shouldn't be part of this.\r\n        const diff = this.constants_.MIN_BLOCK_HEIGHT - heightWithoutHat;\r\n        this.bottomRow.height += diff;\r\n        yCursor += diff;\r\n      }\r\n      this.recordElemPositions_(row);\r\n    }\r\n    if (\r\n      this.outputConnection &&\r\n      this.block_.nextConnection &&\r\n      this.block_.nextConnection.isConnected()\r\n    ) {\r\n      const target = this.block_.nextConnection.targetBlock();\r\n      if (target) {\r\n        // Include width of connected block in value to stack width measurement.\r\n        widestRowWithConnectedBlocks = Math.max(\r\n          widestRowWithConnectedBlocks,\r\n          target.getHeightWidth().width,\r\n        );\r\n      }\r\n    }\r\n\r\n    this.bottomRow.baseline = yCursor - this.bottomRow.descenderHeight;\r\n    this.widthWithChildren = widestRowWithConnectedBlocks + this.startX;\r\n\r\n    this.height = yCursor;\r\n    this.startY = this.topRow.capline;\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.thrasos.Renderer\r\n\r\nimport type {BlockSvg} from '../../block_svg.js';\r\nimport * as blockRendering from '../common/block_rendering.js';\r\nimport {Renderer as BaseRenderer} from '../common/renderer.js';\r\n\r\nimport {RenderInfo} from './info.js';\r\n\r\n/**\r\n * The thrasos renderer. This is a more modern take on the legacy geras\r\n * renderer.\r\n *\r\n * Thrasos is the ancient Greek spirit of boldness.\r\n */\r\nexport class Renderer extends BaseRenderer {\r\n  /**\r\n   * @param name The renderer name.\r\n   */\r\n  constructor(name: string) {\r\n    super(name);\r\n  }\r\n\r\n  /**\r\n   * Create a new instance of the renderer's render info object.\r\n   *\r\n   * @param block The block to measure.\r\n   * @returns The render info object.\r\n   */\r\n  protected override makeRenderInfo_(block: BlockSvg): RenderInfo {\r\n    return new RenderInfo(this, block);\r\n  }\r\n}\r\n\r\nblockRendering.register('thrasos', Renderer);\r\n","/** @file Re-exports of Blockly.thrasos.* modules. */\r\n\r\n/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.thrasos\r\n\r\nimport {RenderInfo} from './info.js';\r\nimport {Renderer} from './renderer.js';\r\n\r\nexport {Renderer, RenderInfo};\r\n","/**\r\n * @license\r\n * Copyright 2018 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.Themes.Zelos\r\n\r\nimport {Theme} from '../theme.js';\r\n\r\nconst defaultBlockStyles = {\r\n  'colour_blocks': {\r\n    'colourPrimary': '#CF63CF',\r\n    'colourSecondary': '#C94FC9',\r\n    'colourTertiary': '#BD42BD',\r\n  },\r\n  'list_blocks': {\r\n    'colourPrimary': '#9966FF',\r\n    'colourSecondary': '#855CD6',\r\n    'colourTertiary': '#774DCB',\r\n  },\r\n  'logic_blocks': {\r\n    'colourPrimary': '#4C97FF',\r\n    'colourSecondary': '#4280D7',\r\n    'colourTertiary': '#3373CC',\r\n  },\r\n  'loop_blocks': {\r\n    'colourPrimary': '#0fBD8C',\r\n    'colourSecondary': '#0DA57A',\r\n    'colourTertiary': '#0B8E69',\r\n  },\r\n  'math_blocks': {\r\n    'colourPrimary': '#59C059',\r\n    'colourSecondary': '#46B946',\r\n    'colourTertiary': '#389438',\r\n  },\r\n  'procedure_blocks': {\r\n    'colourPrimary': '#FF6680',\r\n    'colourSecondary': '#FF4D6A',\r\n    'colourTertiary': '#FF3355',\r\n  },\r\n  'text_blocks': {\r\n    'colourPrimary': '#FFBF00',\r\n    'colourSecondary': '#E6AC00',\r\n    'colourTertiary': '#CC9900',\r\n  },\r\n  'variable_blocks': {\r\n    'colourPrimary': '#FF8C1A',\r\n    'colourSecondary': '#FF8000',\r\n    'colourTertiary': '#DB6E00',\r\n  },\r\n  'variable_dynamic_blocks': {\r\n    'colourPrimary': '#FF8C1A',\r\n    'colourSecondary': '#FF8000',\r\n    'colourTertiary': '#DB6E00',\r\n  },\r\n  'hat_blocks': {\r\n    'colourPrimary': '#4C97FF',\r\n    'colourSecondary': '#4280D7',\r\n    'colourTertiary': '#3373CC',\r\n    'hat': 'cap',\r\n  },\r\n};\r\n\r\nconst categoryStyles = {\r\n  'colour_category': {'colour': '#CF63CF'},\r\n  'list_category': {'colour': '#9966FF'},\r\n  'logic_category': {'colour': '#4C97FF'},\r\n  'loop_category': {'colour': '#0fBD8C'},\r\n  'math_category': {'colour': '#59C059'},\r\n  'procedure_category': {'colour': '#FF6680'},\r\n  'text_category': {'colour': '#FFBF00'},\r\n  'variable_category': {'colour': '#FF8C1A'},\r\n  'variable_dynamic_category': {'colour': '#FF8C1A'},\r\n};\r\n\r\n/**\r\n * Zelos theme.\r\n */\r\nexport const Zelos = new Theme('zelos', defaultBlockStyles, categoryStyles);\r\n","/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.Themes\r\n\r\nimport {Classic} from './classic.js';\r\nimport {Zelos} from './zelos.js';\r\n\r\nexport {Classic, Zelos};\r\n","/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * An item in the toolbox.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.ToolboxItem\r\n\r\nimport type {ICollapsibleToolboxItem} from '../interfaces/i_collapsible_toolbox_item.js';\r\nimport type {IToolbox} from '../interfaces/i_toolbox.js';\r\nimport type {IToolboxItem} from '../interfaces/i_toolbox_item.js';\r\nimport * as idGenerator from '../utils/idgenerator.js';\r\nimport type * as toolbox from '../utils/toolbox.js';\r\nimport type {WorkspaceSvg} from '../workspace_svg.js';\r\n\r\n/**\r\n * Class for an item in the toolbox.\r\n */\r\nexport class ToolboxItem implements IToolboxItem {\r\n  protected id_: string;\r\n  protected parent_: ICollapsibleToolboxItem | null;\r\n  protected level_: number;\r\n  protected toolboxItemDef_: toolbox.ToolboxItemInfo | null;\r\n  protected workspace_: WorkspaceSvg;\r\n  /** The toolbox this category belongs to. */\r\n  protected readonly parentToolbox_: IToolbox;\r\n\r\n  /**\r\n   * @param toolboxItemDef The JSON defining the toolbox item.\r\n   * @param parentToolbox The toolbox that holds the toolbox item.\r\n   * @param opt_parent The parent toolbox item or null if the category does not\r\n   *     have a parent.\r\n   */\r\n  constructor(\r\n    toolboxItemDef: toolbox.ToolboxItemInfo,\r\n    parentToolbox: IToolbox,\r\n    opt_parent?: ICollapsibleToolboxItem,\r\n  ) {\r\n    /** The ID for the category. */\r\n    this.id_ =\r\n      (toolboxItemDef as AnyDuringMigration)['toolboxitemid'] ||\r\n      idGenerator.getNextUniqueId();\r\n\r\n    /** The parent of the category. */\r\n    this.parent_ = opt_parent || null;\r\n\r\n    /** The level that the category is nested at. */\r\n    this.level_ = this.parent_ ? this.parent_.getLevel() + 1 : 0;\r\n\r\n    /** The JSON definition of the toolbox item. */\r\n    this.toolboxItemDef_ = toolboxItemDef;\r\n\r\n    this.parentToolbox_ = parentToolbox;\r\n\r\n    /** The workspace of the parent toolbox. */\r\n    this.workspace_ = this.parentToolbox_.getWorkspace();\r\n  }\r\n\r\n  /**\r\n   * Initializes the toolbox item.\r\n   * This includes creating the DOM and updating the state of any items based\r\n   * on the info object.\r\n   */\r\n  init() {}\r\n  // No-op by default.\r\n\r\n  /**\r\n   * Gets the div for the toolbox item.\r\n   *\r\n   * @returns The div for the toolbox item.\r\n   */\r\n  getDiv(): Element | null {\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Gets the HTML element that is clickable.\r\n   * The parent toolbox element receives clicks. The parent toolbox will add an\r\n   * ID to this element so it can pass the onClick event to the correct\r\n   * toolboxItem.\r\n   *\r\n   * @returns The HTML element that receives clicks, or null if this item should\r\n   *     not receive clicks.\r\n   */\r\n  getClickTarget(): Element | null {\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Gets a unique identifier for this toolbox item.\r\n   *\r\n   * @returns The ID for the toolbox item.\r\n   */\r\n  getId(): string {\r\n    return this.id_;\r\n  }\r\n\r\n  /**\r\n   * Gets the parent if the toolbox item is nested.\r\n   *\r\n   * @returns The parent toolbox item, or null if this toolbox item is not\r\n   *     nested.\r\n   */\r\n  getParent(): ICollapsibleToolboxItem | null {\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Gets the nested level of the category.\r\n   *\r\n   * @returns The nested level of the category.\r\n   * @internal\r\n   */\r\n  getLevel(): number {\r\n    return this.level_;\r\n  }\r\n\r\n  /**\r\n   * Whether the toolbox item is selectable.\r\n   *\r\n   * @returns True if the toolbox item can be selected.\r\n   */\r\n  isSelectable(): boolean {\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Whether the toolbox item is collapsible.\r\n   *\r\n   * @returns True if the toolbox item is collapsible.\r\n   */\r\n  isCollapsible(): boolean {\r\n    return false;\r\n  }\r\n\r\n  /** Dispose of this toolbox item. No-op by default. */\r\n  dispose() {}\r\n\r\n  /**\r\n   * Sets whether the category is visible or not.\r\n   * For a category to be visible its parent category must also be expanded.\r\n   *\r\n   * @param _isVisible True if category should be visible.\r\n   */\r\n  setVisible_(_isVisible: boolean) {}\r\n}\r\n// nop by default\r\n","/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * A toolbox category used to organize blocks in the toolbox.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.ToolboxCategory\r\n\r\nimport * as Css from '../css.js';\r\nimport type {ICollapsibleToolboxItem} from '../interfaces/i_collapsible_toolbox_item.js';\r\nimport type {ISelectableToolboxItem} from '../interfaces/i_selectable_toolbox_item.js';\r\nimport type {IToolbox} from '../interfaces/i_toolbox.js';\r\nimport type {IToolboxItem} from '../interfaces/i_toolbox_item.js';\r\nimport type {\r\n  CategoryInfo,\r\n  DynamicCategoryInfo,\r\n  FlyoutDefinition,\r\n  FlyoutItemInfo,\r\n  FlyoutItemInfoArray,\r\n  StaticCategoryInfo,\r\n} from '../utils/toolbox.js';\r\nimport * as registry from '../registry.js';\r\nimport * as aria from '../utils/aria.js';\r\nimport * as colourUtils from '../utils/colour.js';\r\nimport * as dom from '../utils/dom.js';\r\nimport * as parsing from '../utils/parsing.js';\r\nimport * as toolbox from '../utils/toolbox.js';\r\n\r\nimport {ToolboxItem} from './toolbox_item.js';\r\n\r\n/**\r\n * Class for a category in a toolbox.\r\n */\r\nexport class ToolboxCategory\r\n  extends ToolboxItem\r\n  implements ISelectableToolboxItem\r\n{\r\n  /** Name used for registering a toolbox category. */\r\n  static registrationName = 'category';\r\n\r\n  /** The number of pixels to move the category over at each nested level. */\r\n  static nestedPadding = 19;\r\n\r\n  /** The width in pixels of the strip of colour next to each category. */\r\n  static borderWidth = 8;\r\n\r\n  /**\r\n   * The default colour of the category. This is used as the background colour\r\n   * of the category when it is selected.\r\n   */\r\n  static defaultBackgroundColour = '#57e';\r\n\r\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\r\n  override toolboxItemDef_!: CategoryInfo;\r\n\r\n  /** The name that will be displayed on the category. */\r\n  protected name_ = '';\r\n\r\n  /** The colour of the category. */\r\n  protected colour_ = '';\r\n\r\n  /** The HTML container for the category. */\r\n  protected htmlDiv_: HTMLDivElement | null = null;\r\n\r\n  /** The HTML element for the category row. */\r\n  protected rowDiv_: HTMLDivElement | null = null;\r\n\r\n  /** The HTML element that holds children elements of the category row. */\r\n  protected rowContents_: HTMLDivElement | null = null;\r\n\r\n  /** The HTML element for the toolbox icon. */\r\n  protected iconDom_: Element | null = null;\r\n\r\n  /** The HTML element for the toolbox label. */\r\n  protected labelDom_: Element | null = null;\r\n  protected cssConfig_: CssConfig;\r\n\r\n  /** True if the category is meant to be hidden, false otherwise. */\r\n  protected isHidden_ = false;\r\n\r\n  /** True if this category is disabled, false otherwise. */\r\n  protected isDisabled_ = false;\r\n\r\n  /** The flyout items for this category. */\r\n  protected flyoutItems_: string | FlyoutItemInfoArray = [];\r\n\r\n  /**\r\n   * @param categoryDef The information needed to create a category in the\r\n   *     toolbox.\r\n   * @param parentToolbox The parent toolbox for the category.\r\n   * @param opt_parent The parent category or null if the category does not have\r\n   *     a parent.\r\n   */\r\n  constructor(\r\n    categoryDef: CategoryInfo,\r\n    parentToolbox: IToolbox,\r\n    opt_parent?: ICollapsibleToolboxItem,\r\n  ) {\r\n    super(categoryDef, parentToolbox, opt_parent);\r\n\r\n    /** All the css class names that are used to create a category. */\r\n    this.cssConfig_ = this.makeDefaultCssConfig_();\r\n  }\r\n\r\n  /**\r\n   * Initializes the toolbox item.\r\n   * This includes creating the DOM and updating the state of any items based\r\n   * on the info object.\r\n   * Init should be called immediately after the construction of the toolbox\r\n   * item, to ensure that the category contents are properly parsed.\r\n   */\r\n  override init() {\r\n    this.parseCategoryDef_(this.toolboxItemDef_);\r\n    this.parseContents_(this.toolboxItemDef_);\r\n    this.createDom_();\r\n    if (this.toolboxItemDef_['hidden'] === 'true') {\r\n      this.hide();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Creates an object holding the default classes for a category.\r\n   *\r\n   * @returns The configuration object holding all the CSS classes for a\r\n   *     category.\r\n   */\r\n  protected makeDefaultCssConfig_(): CssConfig {\r\n    return {\r\n      'container': 'blocklyToolboxCategory',\r\n      'row': 'blocklyTreeRow',\r\n      'rowcontentcontainer': 'blocklyTreeRowContentContainer',\r\n      'icon': 'blocklyTreeIcon',\r\n      'label': 'blocklyTreeLabel',\r\n      'contents': 'blocklyToolboxContents',\r\n      'selected': 'blocklyTreeSelected',\r\n      'openicon': 'blocklyTreeIconOpen',\r\n      'closedicon': 'blocklyTreeIconClosed',\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Parses the contents array depending on if the category is a dynamic\r\n   * category, or if its contents are meant to be shown in the flyout.\r\n   *\r\n   * @param categoryDef The information needed to create a category.\r\n   */\r\n  protected parseContents_(categoryDef: CategoryInfo) {\r\n    if ('custom' in categoryDef) {\r\n      this.flyoutItems_ = categoryDef['custom'];\r\n    } else {\r\n      const contents = categoryDef['contents'];\r\n      if (!contents) return;\r\n\r\n      for (let i = 0; i < contents.length; i++) {\r\n        const itemDef = contents[i];\r\n        const flyoutItem = itemDef as FlyoutItemInfo;\r\n        if (Array.isArray(this.flyoutItems_)) {\r\n          this.flyoutItems_.push(flyoutItem);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Parses the non-contents parts of the category def.\r\n   *\r\n   * @param categoryDef The information needed to create a category.\r\n   */\r\n  protected parseCategoryDef_(categoryDef: CategoryInfo) {\r\n    this.name_ =\r\n      'name' in categoryDef\r\n        ? parsing.replaceMessageReferences(categoryDef['name'])\r\n        : '';\r\n    this.colour_ = this.getColour_(categoryDef);\r\n    Object.assign(\r\n      this.cssConfig_,\r\n      categoryDef['cssconfig'] || (categoryDef as any)['cssConfig'],\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Creates the DOM for the category.\r\n   *\r\n   * @returns The parent element for the category.\r\n   */\r\n  protected createDom_(): HTMLDivElement {\r\n    this.htmlDiv_ = this.createContainer_();\r\n    aria.setRole(this.htmlDiv_, aria.Role.TREEITEM);\r\n    aria.setState(this.htmlDiv_, aria.State.SELECTED, false);\r\n    aria.setState(this.htmlDiv_, aria.State.LEVEL, this.level_ + 1);\r\n\r\n    this.rowDiv_ = this.createRowContainer_();\r\n    this.rowDiv_.style.pointerEvents = 'auto';\r\n    this.htmlDiv_.appendChild(this.rowDiv_);\r\n\r\n    this.rowContents_ = this.createRowContentsContainer_();\r\n    this.rowContents_.style.pointerEvents = 'none';\r\n    this.rowDiv_.appendChild(this.rowContents_);\r\n\r\n    this.iconDom_ = this.createIconDom_();\r\n    aria.setRole(this.iconDom_, aria.Role.PRESENTATION);\r\n    this.rowContents_.appendChild(this.iconDom_);\r\n\r\n    this.labelDom_ = this.createLabelDom_(this.name_);\r\n    this.rowContents_.appendChild(this.labelDom_);\r\n\r\n    const id = this.labelDom_.getAttribute('id');\r\n    if (id) {\r\n      aria.setState(this.htmlDiv_, aria.State.LABELLEDBY, id);\r\n    }\r\n\r\n    this.addColourBorder_(this.colour_);\r\n\r\n    return this.htmlDiv_;\r\n  }\r\n\r\n  /**\r\n   * Creates the container that holds the row and any subcategories.\r\n   *\r\n   * @returns The div that holds the icon and the label.\r\n   */\r\n  protected createContainer_(): HTMLDivElement {\r\n    const container = document.createElement('div');\r\n    const className = this.cssConfig_['container'];\r\n    if (className) {\r\n      dom.addClass(container, className);\r\n    }\r\n    return container;\r\n  }\r\n\r\n  /**\r\n   * Creates the parent of the contents container. All clicks will happen on\r\n   * this div.\r\n   *\r\n   * @returns The div that holds the contents container.\r\n   */\r\n  protected createRowContainer_(): HTMLDivElement {\r\n    const rowDiv = document.createElement('div');\r\n    const className = this.cssConfig_['row'];\r\n    if (className) {\r\n      dom.addClass(rowDiv, className);\r\n    }\r\n    const nestedPadding = `${\r\n      ToolboxCategory.nestedPadding * this.getLevel()\r\n    }px`;\r\n    this.workspace_.RTL\r\n      ? (rowDiv.style.paddingRight = nestedPadding)\r\n      : (rowDiv.style.paddingLeft = nestedPadding);\r\n    return rowDiv;\r\n  }\r\n\r\n  /**\r\n   * Creates the container for the label and icon.\r\n   * This is necessary so we can set all subcategory pointer events to none.\r\n   *\r\n   * @returns The div that holds the icon and the label.\r\n   */\r\n  protected createRowContentsContainer_(): HTMLDivElement {\r\n    const contentsContainer = document.createElement('div');\r\n    const className = this.cssConfig_['rowcontentcontainer'];\r\n    if (className) {\r\n      dom.addClass(contentsContainer, className);\r\n    }\r\n    return contentsContainer;\r\n  }\r\n\r\n  /**\r\n   * Creates the span that holds the category icon.\r\n   *\r\n   * @returns The span that holds the category icon.\r\n   */\r\n  protected createIconDom_(): Element {\r\n    const toolboxIcon = document.createElement('span');\r\n    if (!this.parentToolbox_.isHorizontal()) {\r\n      const className = this.cssConfig_['icon'];\r\n      if (className) {\r\n        dom.addClass(toolboxIcon, className);\r\n      }\r\n    }\r\n\r\n    toolboxIcon.style.display = 'inline-block';\r\n    return toolboxIcon;\r\n  }\r\n\r\n  /**\r\n   * Creates the span that holds the category label.\r\n   * This should have an ID for accessibility purposes.\r\n   *\r\n   * @param name The name of the category.\r\n   * @returns The span that holds the category label.\r\n   */\r\n  protected createLabelDom_(name: string): Element {\r\n    const toolboxLabel = document.createElement('span');\r\n    toolboxLabel.setAttribute('id', this.getId() + '.label');\r\n    toolboxLabel.textContent = name;\r\n    const className = this.cssConfig_['label'];\r\n    if (className) {\r\n      dom.addClass(toolboxLabel, className);\r\n    }\r\n    return toolboxLabel;\r\n  }\r\n\r\n  /** Updates the colour for this category. */\r\n  refreshTheme() {\r\n    this.colour_ = this.getColour_(this.toolboxItemDef_);\r\n    this.addColourBorder_(this.colour_);\r\n  }\r\n\r\n  /**\r\n   * Add the strip of colour to the toolbox category.\r\n   *\r\n   * @param colour The category colour.\r\n   */\r\n  protected addColourBorder_(colour: string) {\r\n    if (colour) {\r\n      const border =\r\n        ToolboxCategory.borderWidth + 'px solid ' + (colour || '#ddd');\r\n      if (this.workspace_.RTL) {\r\n        this.rowDiv_!.style.borderRight = border;\r\n      } else {\r\n        this.rowDiv_!.style.borderLeft = border;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets either the colour or the style for a category.\r\n   *\r\n   * @param categoryDef The object holding information on the category.\r\n   * @returns The hex colour for the category.\r\n   */\r\n  protected getColour_(categoryDef: CategoryInfo): string {\r\n    const styleName =\r\n      categoryDef['categorystyle'] || (categoryDef as any)['categoryStyle'];\r\n    const colour = categoryDef['colour'];\r\n\r\n    if (colour && styleName) {\r\n      console.warn(\r\n        'Toolbox category \"' +\r\n          this.name_ +\r\n          '\" must not have both a style and a colour',\r\n      );\r\n    } else if (styleName) {\r\n      return this.getColourfromStyle_(styleName);\r\n    } else if (colour) {\r\n      return this.parseColour_(colour);\r\n    }\r\n    return '';\r\n  }\r\n\r\n  /**\r\n   * Sets the colour for the category using the style name and returns the new\r\n   * colour as a hex string.\r\n   *\r\n   * @param styleName Name of the style.\r\n   * @returns The hex colour for the category.\r\n   */\r\n  private getColourfromStyle_(styleName: string): string {\r\n    const theme = this.workspace_.getTheme();\r\n    if (styleName && theme) {\r\n      const style = theme.categoryStyles[styleName];\r\n      if (style && style.colour) {\r\n        return this.parseColour_(style.colour);\r\n      } else {\r\n        console.warn(\r\n          'Style \"' + styleName + '\" must exist and contain a colour value',\r\n        );\r\n      }\r\n    }\r\n    return '';\r\n  }\r\n\r\n  /**\r\n   * Gets the HTML element that is clickable.\r\n   * The parent toolbox element receives clicks. The parent toolbox will add an\r\n   * ID to this element so it can pass the onClick event to the correct\r\n   * toolboxItem.\r\n   *\r\n   * @returns The HTML element that receives clicks.\r\n   */\r\n  override getClickTarget(): Element {\r\n    return this.rowDiv_ as Element;\r\n  }\r\n\r\n  /**\r\n   * Parses the colour on the category.\r\n   *\r\n   * @param colourValue HSV hue value (0 to 360), #RRGGBB string, or a message\r\n   *     reference string pointing to one of those two values.\r\n   * @returns The hex colour for the category.\r\n   */\r\n  private parseColour_(colourValue: number | string): string {\r\n    // Decode the colour for any potential message references\r\n    // (eg. `%{BKY_MATH_HUE}`).\r\n    const colour = parsing.replaceMessageReferences(colourValue);\r\n    if (colour == null || colour === '') {\r\n      // No attribute. No colour.\r\n      return '';\r\n    } else {\r\n      const hue = Number(colour);\r\n      if (!isNaN(hue)) {\r\n        return colourUtils.hueToHex(hue);\r\n      } else {\r\n        const hex = colourUtils.parse(colour);\r\n        if (hex) {\r\n          return hex;\r\n        } else {\r\n          console.warn(\r\n            'Toolbox category \"' +\r\n              this.name_ +\r\n              '\" has unrecognized colour attribute: ' +\r\n              colour,\r\n          );\r\n          return '';\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds appropriate classes to display an open icon.\r\n   *\r\n   * @param iconDiv The div that holds the icon.\r\n   */\r\n  protected openIcon_(iconDiv: Element | null) {\r\n    if (!iconDiv) {\r\n      return;\r\n    }\r\n    const closedIconClass = this.cssConfig_['closedicon'];\r\n    if (closedIconClass) {\r\n      dom.removeClasses(iconDiv, closedIconClass);\r\n    }\r\n    const className = this.cssConfig_['openicon'];\r\n    if (className) {\r\n      dom.addClass(iconDiv, className);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds appropriate classes to display a closed icon.\r\n   *\r\n   * @param iconDiv The div that holds the icon.\r\n   */\r\n  protected closeIcon_(iconDiv: Element | null) {\r\n    if (!iconDiv) {\r\n      return;\r\n    }\r\n    const openIconClass = this.cssConfig_['openicon'];\r\n    if (openIconClass) {\r\n      dom.removeClasses(iconDiv, openIconClass);\r\n    }\r\n    const className = this.cssConfig_['closedicon'];\r\n    if (className) {\r\n      dom.addClass(iconDiv, className);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Sets whether the category is visible or not.\r\n   * For a category to be visible its parent category must also be expanded.\r\n   *\r\n   * @param isVisible True if category should be visible.\r\n   */\r\n  override setVisible_(isVisible: boolean) {\r\n    this.htmlDiv_!.style.display = isVisible ? 'block' : 'none';\r\n    this.isHidden_ = !isVisible;\r\n\r\n    if (this.parentToolbox_.getSelectedItem() === this) {\r\n      this.parentToolbox_.clearSelection();\r\n    }\r\n  }\r\n\r\n  /** Hide the category. */\r\n  hide() {\r\n    this.setVisible_(false);\r\n  }\r\n\r\n  /**\r\n   * Show the category. Category will only appear if its parent category is also\r\n   * expanded.\r\n   */\r\n  show() {\r\n    this.setVisible_(true);\r\n  }\r\n\r\n  /**\r\n   * Whether the category is visible.\r\n   * A category is only visible if all of its ancestors are expanded and\r\n   * isHidden_ is false.\r\n   *\r\n   * @returns True if the category is visible, false otherwise.\r\n   */\r\n  isVisible(): boolean {\r\n    return !this.isHidden_ && this.allAncestorsExpanded_();\r\n  }\r\n\r\n  /**\r\n   * Whether all ancestors of a category (parent and parent's parent, etc.) are\r\n   * expanded.\r\n   *\r\n   * @returns True only if every ancestor is expanded\r\n   */\r\n  protected allAncestorsExpanded_(): boolean {\r\n    /* eslint-disable-next-line @typescript-eslint/no-this-alias */\r\n    let category: IToolboxItem = this;\r\n    while (category.getParent()) {\r\n      category = category.getParent()!;\r\n      if (!(category as ICollapsibleToolboxItem).isExpanded()) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  override isSelectable() {\r\n    return this.isVisible() && !this.isDisabled_;\r\n  }\r\n\r\n  /**\r\n   * Handles when the toolbox item is clicked.\r\n   *\r\n   * @param _e Click event to handle.\r\n   */\r\n  onClick(_e: Event) {}\r\n  // No-op\r\n\r\n  /**\r\n   * Sets the current category as selected.\r\n   *\r\n   * @param isSelected True if this category is selected, false otherwise.\r\n   */\r\n  setSelected(isSelected: boolean) {\r\n    if (!this.rowDiv_) {\r\n      return;\r\n    }\r\n    const className = this.cssConfig_['selected'];\r\n    if (isSelected) {\r\n      const defaultColour = this.parseColour_(\r\n        ToolboxCategory.defaultBackgroundColour,\r\n      );\r\n      this.rowDiv_.style.backgroundColor = this.colour_ || defaultColour;\r\n      if (className) {\r\n        dom.addClass(this.rowDiv_, className);\r\n      }\r\n    } else {\r\n      this.rowDiv_.style.backgroundColor = '';\r\n      if (className) {\r\n        dom.removeClass(this.rowDiv_, className);\r\n      }\r\n    }\r\n    aria.setState(this.htmlDiv_ as Element, aria.State.SELECTED, isSelected);\r\n  }\r\n\r\n  /**\r\n   * Sets whether the category is disabled.\r\n   *\r\n   * @param isDisabled True to disable the category, false otherwise.\r\n   */\r\n  setDisabled(isDisabled: boolean) {\r\n    this.isDisabled_ = isDisabled;\r\n    this.getDiv()!.setAttribute('disabled', `${isDisabled}`);\r\n    isDisabled\r\n      ? this.getDiv()!.setAttribute('disabled', 'true')\r\n      : this.getDiv()!.removeAttribute('disabled');\r\n  }\r\n\r\n  /**\r\n   * Gets the name of the category. Used for emitting events.\r\n   *\r\n   * @returns The name of the toolbox item.\r\n   */\r\n  getName(): string {\r\n    return this.name_;\r\n  }\r\n\r\n  override getParent() {\r\n    return this.parent_;\r\n  }\r\n\r\n  override getDiv() {\r\n    return this.htmlDiv_;\r\n  }\r\n\r\n  /**\r\n   * Gets the contents of the category. These are items that are meant to be\r\n   * displayed in the flyout.\r\n   *\r\n   * @returns The definition of items to be displayed in the flyout.\r\n   */\r\n  getContents(): FlyoutItemInfoArray | string {\r\n    return this.flyoutItems_;\r\n  }\r\n\r\n  /**\r\n   * Updates the contents to be displayed in the flyout.\r\n   * If the flyout is open when the contents are updated, refreshSelection on\r\n   * the toolbox must also be called.\r\n   *\r\n   * @param contents The contents to be displayed in the flyout. A string can be\r\n   *     supplied to create a dynamic category.\r\n   */\r\n  updateFlyoutContents(contents: FlyoutDefinition | string) {\r\n    this.flyoutItems_ = [];\r\n\r\n    if (typeof contents === 'string') {\r\n      const newDefinition: DynamicCategoryInfo = {\r\n        kind: this.toolboxItemDef_.kind,\r\n        custom: contents,\r\n        id: this.toolboxItemDef_.id,\r\n        categorystyle: this.toolboxItemDef_.categorystyle,\r\n        colour: this.toolboxItemDef_.colour,\r\n        cssconfig: this.toolboxItemDef_.cssconfig,\r\n        hidden: this.toolboxItemDef_.hidden,\r\n      };\r\n      this.toolboxItemDef_ = newDefinition;\r\n    } else {\r\n      const newDefinition: StaticCategoryInfo = {\r\n        kind: this.toolboxItemDef_.kind,\r\n        name:\r\n          'name' in this.toolboxItemDef_ ? this.toolboxItemDef_['name'] : '',\r\n        contents: toolbox.convertFlyoutDefToJsonArray(contents),\r\n        id: this.toolboxItemDef_.id,\r\n        categorystyle: this.toolboxItemDef_.categorystyle,\r\n        colour: this.toolboxItemDef_.colour,\r\n        cssconfig: this.toolboxItemDef_.cssconfig,\r\n        hidden: this.toolboxItemDef_.hidden,\r\n      };\r\n      this.toolboxItemDef_ = newDefinition;\r\n    }\r\n    this.parseContents_(this.toolboxItemDef_);\r\n  }\r\n\r\n  override dispose() {\r\n    dom.removeNode(this.htmlDiv_);\r\n  }\r\n}\r\n\r\nexport namespace ToolboxCategory {\r\n  /** All the CSS class names that are used to create a category. */\r\n  export interface CssConfig {\r\n    container?: string;\r\n    row?: string;\r\n    rowcontentcontainer?: string;\r\n    icon?: string;\r\n    label?: string;\r\n    contents?: string;\r\n    selected?: string;\r\n    openicon?: string;\r\n    closedicon?: string;\r\n  }\r\n}\r\n\r\nexport type CssConfig = ToolboxCategory.CssConfig;\r\n\r\n/** CSS for Toolbox.  See css.js for use. */\r\nCss.register(`\r\n.blocklyTreeRow:not(.blocklyTreeSelected):hover {\r\n  background-color: rgba(255, 255, 255, .2);\r\n}\r\n\r\n.blocklyToolboxDiv[layout=\"h\"] .blocklyToolboxCategory {\r\n  margin: 1px 5px 1px 0;\r\n}\r\n\r\n.blocklyToolboxDiv[dir=\"RTL\"][layout=\"h\"] .blocklyToolboxCategory {\r\n  margin: 1px 0 1px 5px;\r\n}\r\n\r\n.blocklyTreeRow {\r\n  height: 22px;\r\n  line-height: 22px;\r\n  margin-bottom: 3px;\r\n  padding-right: 8px;\r\n  white-space: nowrap;\r\n}\r\n\r\n.blocklyToolboxDiv[dir=\"RTL\"] .blocklyTreeRow {\r\n  margin-left: 8px;\r\n  padding-right: 0;\r\n}\r\n\r\n.blocklyTreeIcon {\r\n  background-image: url(<<<PATH>>>/sprites.png);\r\n  height: 16px;\r\n  vertical-align: middle;\r\n  visibility: hidden;\r\n  width: 16px;\r\n}\r\n\r\n.blocklyTreeIconClosed {\r\n  background-position: -32px -1px;\r\n}\r\n\r\n.blocklyToolboxDiv[dir=\"RTL\"] .blocklyTreeIconClosed {\r\n  background-position: 0 -1px;\r\n}\r\n\r\n.blocklyTreeSelected>.blocklyTreeIconClosed {\r\n  background-position: -32px -17px;\r\n}\r\n\r\n.blocklyToolboxDiv[dir=\"RTL\"] .blocklyTreeSelected>.blocklyTreeIconClosed {\r\n  background-position: 0 -17px;\r\n}\r\n\r\n.blocklyTreeIconOpen {\r\n  background-position: -16px -1px;\r\n}\r\n\r\n.blocklyTreeSelected>.blocklyTreeIconOpen {\r\n  background-position: -16px -17px;\r\n}\r\n\r\n.blocklyTreeLabel {\r\n  cursor: default;\r\n  font: 16px sans-serif;\r\n  padding: 0 3px;\r\n  vertical-align: middle;\r\n}\r\n\r\n.blocklyToolboxDelete .blocklyTreeLabel {\r\n  cursor: url(\"<<<PATH>>>/handdelete.cur\"), auto;\r\n}\r\n\r\n.blocklyTreeSelected .blocklyTreeLabel {\r\n  color: #fff;\r\n}\r\n`);\r\n\r\nregistry.register(\r\n  registry.Type.TOOLBOX_ITEM,\r\n  ToolboxCategory.registrationName,\r\n  ToolboxCategory,\r\n);\r\n","/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * A separator used for separating toolbox categories.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.ToolboxSeparator\r\n\r\nimport * as Css from '../css.js';\r\nimport type {IToolbox} from '../interfaces/i_toolbox.js';\r\nimport * as registry from '../registry.js';\r\nimport * as dom from '../utils/dom.js';\r\nimport type * as toolbox from '../utils/toolbox.js';\r\n\r\nimport {ToolboxItem} from './toolbox_item.js';\r\n\r\n/**\r\n * Class for a toolbox separator. This is the thin visual line that appears on\r\n * the toolbox. This item is not interactable.\r\n */\r\nexport class ToolboxSeparator extends ToolboxItem {\r\n  /** Name used for registering a toolbox separator. */\r\n  static registrationName = 'sep';\r\n\r\n  /** All the CSS class names that are used to create a separator. */\r\n  protected cssConfig_: CssConfig = {'container': 'blocklyTreeSeparator'};\r\n\r\n  private htmlDiv_: HTMLDivElement | null = null;\r\n\r\n  /**\r\n   * @param separatorDef The information needed to create a separator.\r\n   * @param toolbox The parent toolbox for the separator.\r\n   */\r\n  constructor(separatorDef: toolbox.SeparatorInfo, toolbox: IToolbox) {\r\n    super(separatorDef, toolbox);\r\n\r\n    const cssConfig =\r\n      separatorDef['cssconfig'] || (separatorDef as any)['cssConfig'];\r\n    Object.assign(this.cssConfig_, cssConfig);\r\n  }\r\n\r\n  override init() {\r\n    this.createDom_();\r\n  }\r\n\r\n  /**\r\n   * Creates the DOM for a separator.\r\n   *\r\n   * @returns The parent element for the separator.\r\n   */\r\n  protected createDom_(): HTMLDivElement {\r\n    const container = document.createElement('div');\r\n    const className = this.cssConfig_['container'];\r\n    if (className) {\r\n      dom.addClass(container, className);\r\n    }\r\n    this.htmlDiv_ = container;\r\n    return container;\r\n  }\r\n\r\n  override getDiv() {\r\n    return this.htmlDiv_ as HTMLDivElement;\r\n  }\r\n\r\n  override dispose() {\r\n    dom.removeNode(this.htmlDiv_ as HTMLDivElement);\r\n  }\r\n}\r\n\r\nexport namespace ToolboxSeparator {\r\n  export interface CssConfig {\r\n    container: string | undefined;\r\n  }\r\n}\r\n\r\nexport type CssConfig = ToolboxSeparator.CssConfig;\r\n\r\n/** CSS for Toolbox.  See css.js for use. */\r\nCss.register(`\r\n.blocklyTreeSeparator {\r\n  border-bottom: solid #e5e5e5 1px;\r\n  height: 0;\r\n  margin: 5px 0;\r\n}\r\n\r\n.blocklyToolboxDiv[layout=\"h\"] .blocklyTreeSeparator {\r\n  border-right: solid #e5e5e5 1px;\r\n  border-bottom: none;\r\n  height: auto;\r\n  margin: 0 5px 0 5px;\r\n  padding: 5px 0;\r\n  width: 0;\r\n}\r\n`);\r\n\r\nregistry.register(\r\n  registry.Type.TOOLBOX_ITEM,\r\n  ToolboxSeparator.registrationName,\r\n  ToolboxSeparator,\r\n);\r\n","/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * A toolbox category used to organize blocks in the toolbox.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.CollapsibleToolboxCategory\r\n\r\nimport type {ICollapsibleToolboxItem} from '../interfaces/i_collapsible_toolbox_item.js';\r\nimport type {IToolbox} from '../interfaces/i_toolbox.js';\r\nimport type {IToolboxItem} from '../interfaces/i_toolbox_item.js';\r\nimport * as registry from '../registry.js';\r\nimport * as aria from '../utils/aria.js';\r\nimport * as dom from '../utils/dom.js';\r\nimport * as toolbox from '../utils/toolbox.js';\r\n\r\nimport {ToolboxCategory} from './category.js';\r\nimport {ToolboxSeparator} from './separator.js';\r\n\r\n/**\r\n * Class for a category in a toolbox that can be collapsed.\r\n */\r\nexport class CollapsibleToolboxCategory\r\n  extends ToolboxCategory\r\n  implements ICollapsibleToolboxItem\r\n{\r\n  /** Name used for registering a collapsible toolbox category. */\r\n  static override registrationName = 'collapsibleCategory';\r\n\r\n  /** Container for any child categories. */\r\n  protected subcategoriesDiv_: HTMLDivElement | null = null;\r\n\r\n  /** Whether or not the category should display its subcategories. */\r\n  protected expanded_ = false;\r\n\r\n  /** The child toolbox items for this category. */\r\n  protected toolboxItems_: IToolboxItem[] = [];\r\n\r\n  /**\r\n   * @param categoryDef The information needed to create a category in the\r\n   *     toolbox.\r\n   * @param toolbox The parent toolbox for the category.\r\n   * @param opt_parent The parent category or null if the category does not have\r\n   *     a parent.\r\n   */\r\n  constructor(\r\n    categoryDef: toolbox.CategoryInfo,\r\n    toolbox: IToolbox,\r\n    opt_parent?: ICollapsibleToolboxItem,\r\n  ) {\r\n    super(categoryDef, toolbox, opt_parent);\r\n  }\r\n\r\n  override makeDefaultCssConfig_() {\r\n    const cssConfig = super.makeDefaultCssConfig_();\r\n    cssConfig['contents'] = 'blocklyToolboxContents';\r\n    return cssConfig;\r\n  }\r\n\r\n  override parseContents_(categoryDef: toolbox.CategoryInfo) {\r\n    if ('custom' in categoryDef) {\r\n      this.flyoutItems_ = categoryDef['custom'];\r\n    } else {\r\n      const contents = categoryDef['contents'];\r\n      if (!contents) return;\r\n      this.flyoutItems_ = [];\r\n      let prevIsFlyoutItem = true;\r\n      for (let i = 0; i < contents.length; i++) {\r\n        const itemDef = contents[i];\r\n        // Separators can exist as either a flyout item or a toolbox item so\r\n        // decide where it goes based on the type of the previous item.\r\n        if (\r\n          !registry.hasItem(registry.Type.TOOLBOX_ITEM, itemDef['kind']) ||\r\n          (itemDef['kind'].toLowerCase() ===\r\n            ToolboxSeparator.registrationName &&\r\n            prevIsFlyoutItem)\r\n        ) {\r\n          const flyoutItem = itemDef as toolbox.FlyoutItemInfo;\r\n          this.flyoutItems_.push(flyoutItem);\r\n          prevIsFlyoutItem = true;\r\n        } else {\r\n          this.createToolboxItem_(itemDef);\r\n          prevIsFlyoutItem = false;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Creates a toolbox item and adds it to the list of toolbox items.\r\n   *\r\n   * @param itemDef The information needed to create a toolbox item.\r\n   */\r\n  private createToolboxItem_(itemDef: toolbox.ToolboxItemInfo) {\r\n    let registryName = itemDef['kind'];\r\n    const categoryDef = itemDef as toolbox.CategoryInfo;\r\n    // Categories that are collapsible are created using a class registered\r\n    // under a different name.\r\n    if (\r\n      registryName.toUpperCase() === 'CATEGORY' &&\r\n      toolbox.isCategoryCollapsible(categoryDef)\r\n    ) {\r\n      registryName = CollapsibleToolboxCategory.registrationName;\r\n    }\r\n    const ToolboxItemClass = registry.getClass(\r\n      registry.Type.TOOLBOX_ITEM,\r\n      registryName,\r\n    );\r\n    const toolboxItem = new ToolboxItemClass!(\r\n      itemDef,\r\n      this.parentToolbox_,\r\n      this,\r\n    );\r\n    this.toolboxItems_.push(toolboxItem);\r\n  }\r\n\r\n  override init() {\r\n    super.init();\r\n\r\n    this.setExpanded(\r\n      this.toolboxItemDef_['expanded'] === 'true' ||\r\n        this.toolboxItemDef_['expanded'] === true,\r\n    );\r\n  }\r\n\r\n  override createDom_() {\r\n    super.createDom_();\r\n\r\n    const subCategories = this.getChildToolboxItems();\r\n    this.subcategoriesDiv_ = this.createSubCategoriesDom_(subCategories);\r\n    aria.setRole(this.subcategoriesDiv_, aria.Role.GROUP);\r\n    this.htmlDiv_!.appendChild(this.subcategoriesDiv_);\r\n    this.closeIcon_(this.iconDom_);\r\n    aria.setState(this.htmlDiv_ as HTMLDivElement, aria.State.EXPANDED, false);\r\n\r\n    return this.htmlDiv_!;\r\n  }\r\n\r\n  override createIconDom_() {\r\n    const toolboxIcon = document.createElement('span');\r\n    if (!this.parentToolbox_.isHorizontal()) {\r\n      const className = this.cssConfig_['icon'];\r\n      if (className) {\r\n        dom.addClass(toolboxIcon, className);\r\n      }\r\n      toolboxIcon.style.visibility = 'visible';\r\n    }\r\n\r\n    toolboxIcon.style.display = 'inline-block';\r\n    return toolboxIcon;\r\n  }\r\n\r\n  /**\r\n   * Create the DOM for all subcategories.\r\n   *\r\n   * @param subcategories The subcategories.\r\n   * @returns The div holding all the subcategories.\r\n   */\r\n  protected createSubCategoriesDom_(\r\n    subcategories: IToolboxItem[],\r\n  ): HTMLDivElement {\r\n    const contentsContainer = document.createElement('div');\r\n    contentsContainer.style.display = 'none';\r\n    const className = this.cssConfig_['contents'];\r\n    if (className) {\r\n      dom.addClass(contentsContainer, className);\r\n    }\r\n\r\n    for (let i = 0; i < subcategories.length; i++) {\r\n      const newCategory = subcategories[i];\r\n      newCategory.init();\r\n      const newCategoryDiv = newCategory.getDiv();\r\n      contentsContainer.appendChild(newCategoryDiv!);\r\n      if (newCategory.getClickTarget) {\r\n        newCategory.getClickTarget()?.setAttribute('id', newCategory.getId());\r\n      }\r\n    }\r\n    return contentsContainer;\r\n  }\r\n\r\n  /**\r\n   * Opens or closes the current category and the associated flyout.\r\n   *\r\n   * @param isExpanded True to expand the category, false to close.\r\n   */\r\n  setExpanded(isExpanded: boolean) {\r\n    if (this.expanded_ === isExpanded) return;\r\n\r\n    this.expanded_ = isExpanded;\r\n    if (isExpanded) {\r\n      this.subcategoriesDiv_!.style.display = 'block';\r\n      this.openIcon_(this.iconDom_);\r\n    } else {\r\n      this.parentToolbox_.getFlyout()?.setVisible(false);\r\n      this.subcategoriesDiv_!.style.display = 'none';\r\n      this.closeIcon_(this.iconDom_);\r\n    }\r\n    aria.setState(\r\n      this.htmlDiv_ as HTMLDivElement,\r\n      aria.State.EXPANDED,\r\n      isExpanded,\r\n    );\r\n\r\n    this.parentToolbox_.handleToolboxItemResize();\r\n  }\r\n\r\n  override setVisible_(isVisible: boolean) {\r\n    this.htmlDiv_!.style.display = isVisible ? 'block' : 'none';\r\n    const childToolboxItems = this.getChildToolboxItems();\r\n    for (let i = 0; i < childToolboxItems.length; i++) {\r\n      const child = childToolboxItems[i];\r\n      child.setVisible_(isVisible);\r\n    }\r\n    this.isHidden_ = !isVisible;\r\n\r\n    if (this.parentToolbox_.getSelectedItem() === this) {\r\n      this.parentToolbox_.clearSelection();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Whether the category is expanded to show its child subcategories.\r\n   *\r\n   * @returns True if the toolbox item shows its children, false if it is\r\n   *     collapsed.\r\n   */\r\n  isExpanded(): boolean {\r\n    return this.expanded_;\r\n  }\r\n\r\n  override isCollapsible() {\r\n    return true;\r\n  }\r\n\r\n  override onClick(_e: Event) {\r\n    this.toggleExpanded();\r\n  }\r\n\r\n  /** Toggles whether or not the category is expanded. */\r\n  toggleExpanded() {\r\n    this.setExpanded(!this.expanded_);\r\n  }\r\n\r\n  override getDiv() {\r\n    return this.htmlDiv_;\r\n  }\r\n\r\n  /**\r\n   * Gets any children toolbox items. (ex. Gets the subcategories)\r\n   *\r\n   * @returns The child toolbox items.\r\n   */\r\n  getChildToolboxItems(): IToolboxItem[] {\r\n    return this.toolboxItems_;\r\n  }\r\n}\r\n\r\nexport namespace CollapsibleToolboxCategory {\r\n  /**\r\n   * All the CSS class names that are used to create a collapsible\r\n   * category. This is all the properties from the regular category plus\r\n   * contents.\r\n   */\r\n  export interface CssConfig {\r\n    container: string | null;\r\n    row: string | null;\r\n    rowcontentcontainer: string | null;\r\n    icon: string | null;\r\n    label: string | null;\r\n    selected: string | null;\r\n    openicon: string | null;\r\n    closedicon: string | null;\r\n    contents: string | null;\r\n  }\r\n}\r\n\r\nexport type CssConfig = CollapsibleToolboxCategory.CssConfig;\r\n\r\nregistry.register(\r\n  registry.Type.TOOLBOX_ITEM,\r\n  CollapsibleToolboxCategory.registrationName,\r\n  CollapsibleToolboxCategory,\r\n);\r\n","/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Toolbox from whence to create blocks.\r\n *\r\n * @class\r\n */\r\n// Former goog.module ID: Blockly.Toolbox\r\n\r\n// Unused import preserved for side-effects. Remove if unneeded.\r\nimport '../events/events_toolbox_item_select.js';\r\n\r\nimport {BlockSvg} from '../block_svg.js';\r\nimport type {BlocklyOptions} from '../blockly_options.js';\r\nimport * as browserEvents from '../browser_events.js';\r\nimport * as common from '../common.js';\r\nimport {ComponentManager} from '../component_manager.js';\r\nimport * as Css from '../css.js';\r\nimport {DeleteArea} from '../delete_area.js';\r\nimport * as eventUtils from '../events/utils.js';\r\nimport type {IAutoHideable} from '../interfaces/i_autohideable.js';\r\nimport type {ICollapsibleToolboxItem} from '../interfaces/i_collapsible_toolbox_item.js';\r\nimport type {IDraggable} from '../interfaces/i_draggable.js';\r\nimport type {IFlyout} from '../interfaces/i_flyout.js';\r\nimport type {IKeyboardAccessible} from '../interfaces/i_keyboard_accessible.js';\r\nimport type {ISelectableToolboxItem} from '../interfaces/i_selectable_toolbox_item.js';\r\nimport {isSelectableToolboxItem} from '../interfaces/i_selectable_toolbox_item.js';\r\nimport type {IStyleable} from '../interfaces/i_styleable.js';\r\nimport type {IToolbox} from '../interfaces/i_toolbox.js';\r\nimport type {IToolboxItem} from '../interfaces/i_toolbox_item.js';\r\nimport {Options} from '../options.js';\r\nimport * as registry from '../registry.js';\r\nimport type {KeyboardShortcut} from '../shortcut_registry.js';\r\nimport * as Touch from '../touch.js';\r\nimport * as aria from '../utils/aria.js';\r\nimport * as dom from '../utils/dom.js';\r\nimport {Rect} from '../utils/rect.js';\r\nimport * as toolbox from '../utils/toolbox.js';\r\nimport type {WorkspaceSvg} from '../workspace_svg.js';\r\n\r\nimport type {ToolboxCategory} from './category.js';\r\nimport {CollapsibleToolboxCategory} from './collapsible_category.js';\r\n\r\n/**\r\n * Class for a Toolbox.\r\n * Creates the toolbox's DOM.\r\n */\r\nexport class Toolbox\r\n  extends DeleteArea\r\n  implements IAutoHideable, IKeyboardAccessible, IStyleable, IToolbox\r\n{\r\n  /**\r\n   * The unique ID for this component that is used to register with the\r\n   * ComponentManager.\r\n   */\r\n  override id = 'toolbox';\r\n  protected toolboxDef_: toolbox.ToolboxInfo;\r\n  private readonly horizontalLayout_: boolean;\r\n\r\n  /** The HTML container for the toolbox. */\r\n  HtmlDiv: HTMLDivElement | null = null;\r\n\r\n  /** The HTML container for the contents of a toolbox. */\r\n  protected contentsDiv_: HTMLDivElement | null = null;\r\n\r\n  /** Whether the Toolbox is visible. */\r\n  protected isVisible_ = false;\r\n\r\n  /** The list of items in the toolbox. */\r\n  protected contents_: IToolboxItem[] = [];\r\n\r\n  /** The width of the toolbox. */\r\n  protected width_ = 0;\r\n\r\n  /** The height of the toolbox. */\r\n  protected height_ = 0;\r\n  RTL: boolean;\r\n\r\n  /** The flyout for the toolbox. */\r\n  private flyout_: IFlyout | null = null;\r\n  protected contentMap_: {[key: string]: IToolboxItem};\r\n  toolboxPosition: toolbox.Position;\r\n\r\n  /** The currently selected item. */\r\n  protected selectedItem_: ISelectableToolboxItem | null = null;\r\n\r\n  /** The previously selected item. */\r\n  protected previouslySelectedItem_: ISelectableToolboxItem | null = null;\r\n\r\n  /**\r\n   * Array holding info needed to unbind event handlers.\r\n   * Used for disposing.\r\n   * Ex: [[node, name, func], [node, name, func]].\r\n   */\r\n  protected boundEvents_: browserEvents.Data[] = [];\r\n\r\n  /** The workspace this toolbox is on. */\r\n  protected readonly workspace_: WorkspaceSvg;\r\n\r\n  /** @param workspace The workspace in which to create new blocks. */\r\n  constructor(workspace: WorkspaceSvg) {\r\n    super();\r\n\r\n    this.workspace_ = workspace;\r\n\r\n    /** The JSON describing the contents of this toolbox. */\r\n    this.toolboxDef_ = workspace.options.languageTree || {\r\n      contents: new Array<toolbox.ToolboxItemInfo>(),\r\n    };\r\n\r\n    /** Whether the toolbox should be laid out horizontally. */\r\n    this.horizontalLayout_ = workspace.options.horizontalLayout;\r\n\r\n    /** Is RTL vs LTR. */\r\n    this.RTL = workspace.options.RTL;\r\n\r\n    /** A map from toolbox item IDs to toolbox items. */\r\n    this.contentMap_ = Object.create(null);\r\n\r\n    /** Position of the toolbox and flyout relative to the workspace. */\r\n    this.toolboxPosition = workspace.options.toolboxPosition;\r\n  }\r\n\r\n  /**\r\n   * Handles the given keyboard shortcut.\r\n   *\r\n   * @param _shortcut The shortcut to be handled.\r\n   * @returns True if the shortcut has been handled, false otherwise.\r\n   */\r\n  onShortcut(_shortcut: KeyboardShortcut): boolean {\r\n    return false;\r\n  }\r\n\r\n  /** Initializes the toolbox */\r\n  init() {\r\n    const workspace = this.workspace_;\r\n    const svg = workspace.getParentSvg();\r\n\r\n    this.flyout_ = this.createFlyout_();\r\n\r\n    this.HtmlDiv = this.createDom_(this.workspace_);\r\n    dom.insertAfter(this.flyout_.createDom('svg'), svg);\r\n    this.setVisible(true);\r\n    this.flyout_.init(workspace);\r\n\r\n    this.render(this.toolboxDef_);\r\n    const themeManager = workspace.getThemeManager();\r\n    themeManager.subscribe(\r\n      this.HtmlDiv,\r\n      'toolboxBackgroundColour',\r\n      'background-color',\r\n    );\r\n    themeManager.subscribe(this.HtmlDiv, 'toolboxForegroundColour', 'color');\r\n    this.workspace_.getComponentManager().addComponent({\r\n      component: this,\r\n      weight: 1,\r\n      capabilities: [\r\n        ComponentManager.Capability.AUTOHIDEABLE,\r\n        ComponentManager.Capability.DELETE_AREA,\r\n        ComponentManager.Capability.DRAG_TARGET,\r\n      ],\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Creates the DOM for the toolbox.\r\n   *\r\n   * @param workspace The workspace this toolbox is on.\r\n   * @returns The HTML container for the toolbox.\r\n   */\r\n  protected createDom_(workspace: WorkspaceSvg): HTMLDivElement {\r\n    const svg = workspace.getParentSvg();\r\n\r\n    const container = this.createContainer_();\r\n\r\n    this.contentsDiv_ = this.createContentsContainer_();\r\n    this.contentsDiv_.tabIndex = 0;\r\n    aria.setRole(this.contentsDiv_, aria.Role.TREE);\r\n    container.appendChild(this.contentsDiv_);\r\n\r\n    svg.parentNode!.insertBefore(container, svg);\r\n\r\n    this.attachEvents_(container, this.contentsDiv_);\r\n    return container;\r\n  }\r\n\r\n  /**\r\n   * Creates the container div for the toolbox.\r\n   *\r\n   * @returns The HTML container for the toolbox.\r\n   */\r\n  protected createContainer_(): HTMLDivElement {\r\n    const toolboxContainer = document.createElement('div');\r\n    toolboxContainer.setAttribute('layout', this.isHorizontal() ? 'h' : 'v');\r\n    dom.addClass(toolboxContainer, 'blocklyToolboxDiv');\r\n    dom.addClass(toolboxContainer, 'blocklyNonSelectable');\r\n    toolboxContainer.setAttribute('dir', this.RTL ? 'RTL' : 'LTR');\r\n    return toolboxContainer;\r\n  }\r\n\r\n  /**\r\n   * Creates the container for all the contents in the toolbox.\r\n   *\r\n   * @returns The HTML container for the toolbox contents.\r\n   */\r\n  protected createContentsContainer_(): HTMLDivElement {\r\n    const contentsContainer = document.createElement('div');\r\n    dom.addClass(contentsContainer, 'blocklyToolboxContents');\r\n    if (this.isHorizontal()) {\r\n      contentsContainer.style.flexDirection = 'row';\r\n    }\r\n    return contentsContainer;\r\n  }\r\n\r\n  /**\r\n   * Adds event listeners to the toolbox container div.\r\n   *\r\n   * @param container The HTML container for the toolbox.\r\n   * @param contentsContainer The HTML container for the contents of the\r\n   *     toolbox.\r\n   */\r\n  protected attachEvents_(\r\n    container: HTMLDivElement,\r\n    contentsContainer: HTMLDivElement,\r\n  ) {\r\n    // Clicking on toolbox closes popups.\r\n    const clickEvent = browserEvents.conditionalBind(\r\n      container,\r\n      'pointerdown',\r\n      this,\r\n      this.onClick_,\r\n      /* opt_noCaptureIdentifier */ false,\r\n    );\r\n    this.boundEvents_.push(clickEvent);\r\n\r\n    const keyDownEvent = browserEvents.conditionalBind(\r\n      contentsContainer,\r\n      'keydown',\r\n      this,\r\n      this.onKeyDown_,\r\n      /* opt_noCaptureIdentifier */ false,\r\n    );\r\n    this.boundEvents_.push(keyDownEvent);\r\n  }\r\n\r\n  /**\r\n   * Handles on click events for when the toolbox or toolbox items are clicked.\r\n   *\r\n   * @param e Click event to handle.\r\n   */\r\n  protected onClick_(e: PointerEvent) {\r\n    if (browserEvents.isRightButton(e) || e.target === this.HtmlDiv) {\r\n      // Close flyout.\r\n      (common.getMainWorkspace() as WorkspaceSvg).hideChaff(false);\r\n    } else {\r\n      const targetElement = e.target;\r\n      const itemId = (targetElement as Element).getAttribute('id');\r\n      if (itemId) {\r\n        const item = this.getToolboxItemById(itemId);\r\n        if (item!.isSelectable()) {\r\n          this.setSelectedItem(item);\r\n          (item as ISelectableToolboxItem).onClick(e);\r\n        }\r\n      }\r\n      // Just close popups.\r\n      (common.getMainWorkspace() as WorkspaceSvg).hideChaff(true);\r\n    }\r\n    Touch.clearTouchIdentifier();\r\n  }\r\n\r\n  /**\r\n   * Handles key down events for the toolbox.\r\n   *\r\n   * @param e The key down event.\r\n   */\r\n  protected onKeyDown_(e: KeyboardEvent) {\r\n    let handled = false;\r\n    switch (e.key) {\r\n      case 'ArrowDown':\r\n        handled = this.selectNext_();\r\n        break;\r\n      case 'ArrowUp':\r\n        handled = this.selectPrevious_();\r\n        break;\r\n      case 'ArrowLeft':\r\n        handled = this.selectParent_();\r\n        break;\r\n      case 'ArrowRight':\r\n        handled = this.selectChild_();\r\n        break;\r\n      case 'Enter':\r\n      case ' ':\r\n        if (this.selectedItem_ && this.selectedItem_.isCollapsible()) {\r\n          const collapsibleItem = this.selectedItem_ as ICollapsibleToolboxItem;\r\n          collapsibleItem.toggleExpanded();\r\n          handled = true;\r\n        }\r\n        break;\r\n      default:\r\n        handled = false;\r\n        break;\r\n    }\r\n    if (!handled && this.selectedItem_) {\r\n      // TODO(#6097): Figure out who implements onKeyDown and which interface it\r\n      // should be part of.\r\n      if ((this.selectedItem_ as any).onKeyDown) {\r\n        handled = (this.selectedItem_ as any).onKeyDown(e);\r\n      }\r\n    }\r\n\r\n    if (handled) {\r\n      e.preventDefault();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Creates the flyout based on the toolbox layout.\r\n   *\r\n   * @returns The flyout for the toolbox.\r\n   * @throws {Error} If missing a require for `Blockly.HorizontalFlyout`,\r\n   *     `Blockly.VerticalFlyout`, and no flyout plugin is specified.\r\n   */\r\n  protected createFlyout_(): IFlyout {\r\n    const workspace = this.workspace_;\r\n    // TODO (#4247): Look into adding a makeFlyout method to Blockly Options.\r\n    const workspaceOptions = new Options({\r\n      'parentWorkspace': workspace,\r\n      'rtl': workspace.RTL,\r\n      'oneBasedIndex': workspace.options.oneBasedIndex,\r\n      'horizontalLayout': workspace.horizontalLayout,\r\n      'renderer': workspace.options.renderer,\r\n      'rendererOverrides': workspace.options.rendererOverrides,\r\n      'move': {\r\n        'scrollbars': true,\r\n      },\r\n    } as BlocklyOptions);\r\n    // Options takes in either 'end' or 'start'. This has already been parsed to\r\n    // be either 0 or 1, so set it after.\r\n    workspaceOptions.toolboxPosition = workspace.options.toolboxPosition;\r\n    let FlyoutClass = null;\r\n    if (workspace.horizontalLayout) {\r\n      FlyoutClass = registry.getClassFromOptions(\r\n        registry.Type.FLYOUTS_HORIZONTAL_TOOLBOX,\r\n        workspace.options,\r\n        true,\r\n      );\r\n    } else {\r\n      FlyoutClass = registry.getClassFromOptions(\r\n        registry.Type.FLYOUTS_VERTICAL_TOOLBOX,\r\n        workspace.options,\r\n        true,\r\n      );\r\n    }\r\n    return new FlyoutClass!(workspaceOptions);\r\n  }\r\n\r\n  /**\r\n   * Fills the toolbox with new toolbox items and removes any old contents.\r\n   *\r\n   * @param toolboxDef Object holding information for creating a toolbox.\r\n   * @internal\r\n   */\r\n  render(toolboxDef: toolbox.ToolboxInfo) {\r\n    this.toolboxDef_ = toolboxDef;\r\n    for (let i = 0; i < this.contents_.length; i++) {\r\n      const toolboxItem = this.contents_[i];\r\n      if (toolboxItem) {\r\n        toolboxItem.dispose();\r\n      }\r\n    }\r\n    this.contents_ = [];\r\n    this.contentMap_ = Object.create(null);\r\n    this.renderContents_(toolboxDef['contents']);\r\n    this.position();\r\n    this.handleToolboxItemResize();\r\n  }\r\n\r\n  /**\r\n   * Adds all the toolbox items to the toolbox.\r\n   *\r\n   * @param toolboxDef Array holding objects containing information on the\r\n   *     contents of the toolbox.\r\n   */\r\n  protected renderContents_(toolboxDef: toolbox.ToolboxItemInfo[]) {\r\n    // This is for performance reasons. By using document fragment we only have\r\n    // to add to the DOM once.\r\n    const fragment = document.createDocumentFragment();\r\n    for (let i = 0; i < toolboxDef.length; i++) {\r\n      const toolboxItemDef = toolboxDef[i];\r\n      this.createToolboxItem_(toolboxItemDef, fragment);\r\n    }\r\n    this.contentsDiv_!.appendChild(fragment);\r\n  }\r\n\r\n  /**\r\n   * Creates and renders the toolbox item.\r\n   *\r\n   * @param toolboxItemDef Any information that can be used to create an item in\r\n   *     the toolbox.\r\n   * @param fragment The document fragment to add the child toolbox elements to.\r\n   */\r\n  private createToolboxItem_(\r\n    toolboxItemDef: toolbox.ToolboxItemInfo,\r\n    fragment: DocumentFragment,\r\n  ) {\r\n    let registryName = toolboxItemDef['kind'];\r\n\r\n    // Categories that are collapsible are created using a class registered\r\n    // under a different name.\r\n    if (\r\n      registryName.toUpperCase() === 'CATEGORY' &&\r\n      toolbox.isCategoryCollapsible(toolboxItemDef as toolbox.CategoryInfo)\r\n    ) {\r\n      registryName = CollapsibleToolboxCategory.registrationName;\r\n    }\r\n\r\n    const ToolboxItemClass = registry.getClass(\r\n      registry.Type.TOOLBOX_ITEM,\r\n      registryName.toLowerCase(),\r\n    );\r\n    if (ToolboxItemClass) {\r\n      const toolboxItem = new ToolboxItemClass(toolboxItemDef, this);\r\n      toolboxItem.init();\r\n      this.addToolboxItem_(toolboxItem);\r\n      const toolboxItemDom = toolboxItem.getDiv();\r\n      if (toolboxItemDom) {\r\n        fragment.appendChild(toolboxItemDom);\r\n      }\r\n      // Adds the ID to the HTML element that can receive a click.\r\n      // This is used in onClick_ to find the toolboxItem that was clicked.\r\n      if (toolboxItem.getClickTarget()) {\r\n        toolboxItem.getClickTarget()!.setAttribute('id', toolboxItem.getId());\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds an item to the toolbox.\r\n   *\r\n   * @param toolboxItem The item in the toolbox.\r\n   */\r\n  protected addToolboxItem_(toolboxItem: IToolboxItem) {\r\n    this.contents_.push(toolboxItem);\r\n    this.contentMap_[toolboxItem.getId()] = toolboxItem;\r\n    if (toolboxItem.isCollapsible()) {\r\n      const collapsibleItem = toolboxItem as ICollapsibleToolboxItem;\r\n      const childToolboxItems = collapsibleItem.getChildToolboxItems();\r\n      for (let i = 0; i < childToolboxItems.length; i++) {\r\n        const child = childToolboxItems[i];\r\n        this.addToolboxItem_(child);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets the items in the toolbox.\r\n   *\r\n   * @returns The list of items in the toolbox.\r\n   */\r\n  getToolboxItems(): IToolboxItem[] {\r\n    return this.contents_;\r\n  }\r\n\r\n  /**\r\n   * Adds a style on the toolbox. Usually used to change the cursor.\r\n   *\r\n   * @param style The name of the class to add.\r\n   * @internal\r\n   */\r\n  addStyle(style: string) {\r\n    if (style && this.HtmlDiv) {\r\n      dom.addClass(this.HtmlDiv, style);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes a style from the toolbox. Usually used to change the cursor.\r\n   *\r\n   * @param style The name of the class to remove.\r\n   * @internal\r\n   */\r\n  removeStyle(style: string) {\r\n    if (style && this.HtmlDiv) {\r\n      dom.removeClass(this.HtmlDiv, style);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns the bounding rectangle of the drag target area in pixel units\r\n   * relative to viewport.\r\n   *\r\n   * @returns The component's bounding box. Null if drag target area should be\r\n   *     ignored.\r\n   */\r\n  override getClientRect(): Rect | null {\r\n    if (!this.HtmlDiv || !this.isVisible_) {\r\n      return null;\r\n    }\r\n    // BIG_NUM is offscreen padding so that blocks dragged beyond the toolbox\r\n    // area are still deleted.  Must be smaller than Infinity, but larger than\r\n    // the largest screen size.\r\n    const BIG_NUM = 10000000;\r\n    const toolboxRect = this.HtmlDiv.getBoundingClientRect();\r\n\r\n    const top = toolboxRect.top;\r\n    const bottom = top + toolboxRect.height;\r\n    const left = toolboxRect.left;\r\n    const right = left + toolboxRect.width;\r\n\r\n    // Assumes that the toolbox is on the SVG edge.  If this changes\r\n    // (e.g. toolboxes in mutators) then this code will need to be more complex.\r\n    if (this.toolboxPosition === toolbox.Position.TOP) {\r\n      return new Rect(-BIG_NUM, bottom, -BIG_NUM, BIG_NUM);\r\n    } else if (this.toolboxPosition === toolbox.Position.BOTTOM) {\r\n      return new Rect(top, BIG_NUM, -BIG_NUM, BIG_NUM);\r\n    } else if (this.toolboxPosition === toolbox.Position.LEFT) {\r\n      return new Rect(-BIG_NUM, BIG_NUM, -BIG_NUM, right);\r\n    } else {\r\n      // Right\r\n      return new Rect(-BIG_NUM, BIG_NUM, left, BIG_NUM);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns whether the provided block or bubble would be deleted if dropped on\r\n   * this area.\r\n   * This method should check if the element is deletable and is always called\r\n   * before onDragEnter/onDragOver/onDragExit.\r\n   *\r\n   * @param element The block or bubble currently being dragged.\r\n   * @param _couldConnect Whether the element could could connect to another.\r\n   * @returns Whether the element provided would be deleted if dropped on this\r\n   *     area.\r\n   */\r\n  override wouldDelete(element: IDraggable, _couldConnect: boolean): boolean {\r\n    if (element instanceof BlockSvg) {\r\n      const block = element;\r\n      // Prefer dragging to the toolbox over connecting to other blocks.\r\n      this.updateWouldDelete_(!block.getParent() && block.isDeletable());\r\n    } else {\r\n      this.updateWouldDelete_(element.isDeletable());\r\n    }\r\n    return this.wouldDelete_;\r\n  }\r\n\r\n  /**\r\n   * Handles when a cursor with a block or bubble enters this drag target.\r\n   *\r\n   * @param _dragElement The block or bubble currently being dragged.\r\n   */\r\n  override onDragEnter(_dragElement: IDraggable) {\r\n    this.updateCursorDeleteStyle_(true);\r\n  }\r\n\r\n  /**\r\n   * Handles when a cursor with a block or bubble exits this drag target.\r\n   *\r\n   * @param _dragElement The block or bubble currently being dragged.\r\n   */\r\n  override onDragExit(_dragElement: IDraggable) {\r\n    this.updateCursorDeleteStyle_(false);\r\n  }\r\n\r\n  /**\r\n   * Handles when a block or bubble is dropped on this component.\r\n   * Should not handle delete here.\r\n   *\r\n   * @param _dragElement The block or bubble currently being dragged.\r\n   */\r\n  override onDrop(_dragElement: IDraggable) {\r\n    this.updateCursorDeleteStyle_(false);\r\n  }\r\n\r\n  /**\r\n   * Updates the internal wouldDelete_ state.\r\n   *\r\n   * @param wouldDelete The new value for the wouldDelete state.\r\n   */\r\n  protected override updateWouldDelete_(wouldDelete: boolean) {\r\n    if (wouldDelete === this.wouldDelete_) {\r\n      return;\r\n    }\r\n    // This logic handles updating the deleteStyle properly if the delete state\r\n    // changes while the block is over the Toolbox. This could happen if the\r\n    // implementation of wouldDeleteBlock depends on the couldConnect parameter\r\n    // or if the isDeletable property of the block currently being dragged\r\n    // changes during the drag.\r\n    this.updateCursorDeleteStyle_(false);\r\n    this.wouldDelete_ = wouldDelete;\r\n    this.updateCursorDeleteStyle_(true);\r\n  }\r\n\r\n  /**\r\n   * Adds or removes the CSS style of the cursor over the toolbox based whether\r\n   * the block or bubble over it is expected to be deleted if dropped (using the\r\n   * internal this.wouldDelete_ property).\r\n   *\r\n   * @param addStyle Whether the style should be added or removed.\r\n   */\r\n  protected updateCursorDeleteStyle_(addStyle: boolean) {\r\n    const style = this.wouldDelete_\r\n      ? 'blocklyToolboxDelete'\r\n      : 'blocklyToolboxGrab';\r\n    if (addStyle) {\r\n      this.addStyle(style);\r\n    } else {\r\n      this.removeStyle(style);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets the toolbox item with the given ID.\r\n   *\r\n   * @param id The ID of the toolbox item.\r\n   * @returns The toolbox item with the given ID, or null if no item exists.\r\n   */\r\n  getToolboxItemById(id: string): IToolboxItem | null {\r\n    return this.contentMap_[id] || null;\r\n  }\r\n\r\n  /**\r\n   * Gets the width of the toolbox.\r\n   *\r\n   * @returns The width of the toolbox.\r\n   */\r\n  getWidth(): number {\r\n    return this.width_;\r\n  }\r\n\r\n  /**\r\n   * Gets the height of the toolbox.\r\n   *\r\n   * @returns The width of the toolbox.\r\n   */\r\n  getHeight(): number {\r\n    return this.height_;\r\n  }\r\n\r\n  /**\r\n   * Gets the toolbox flyout.\r\n   *\r\n   * @returns The toolbox flyout.\r\n   */\r\n  getFlyout(): IFlyout | null {\r\n    return this.flyout_;\r\n  }\r\n\r\n  /**\r\n   * Gets the workspace for the toolbox.\r\n   *\r\n   * @returns The parent workspace for the toolbox.\r\n   */\r\n  getWorkspace(): WorkspaceSvg {\r\n    return this.workspace_;\r\n  }\r\n\r\n  /**\r\n   * Gets the selected item.\r\n   *\r\n   * @returns The selected item, or null if no item is currently selected.\r\n   */\r\n  getSelectedItem(): ISelectableToolboxItem | null {\r\n    return this.selectedItem_;\r\n  }\r\n\r\n  /**\r\n   * Gets the previously selected item.\r\n   *\r\n   * @returns The previously selected item, or null if no item was previously\r\n   *     selected.\r\n   */\r\n  getPreviouslySelectedItem(): ISelectableToolboxItem | null {\r\n    return this.previouslySelectedItem_;\r\n  }\r\n\r\n  /**\r\n   * Gets whether or not the toolbox is horizontal.\r\n   *\r\n   * @returns True if the toolbox is horizontal, false if the toolbox is\r\n   *     vertical.\r\n   */\r\n  isHorizontal(): boolean {\r\n    return this.horizontalLayout_;\r\n  }\r\n\r\n  /**\r\n   * Positions the toolbox based on whether it is a horizontal toolbox and\r\n   * whether the workspace is in rtl.\r\n   */\r\n  position() {\r\n    const workspaceMetrics = this.workspace_.getMetrics();\r\n    const toolboxDiv = this.HtmlDiv;\r\n    if (!toolboxDiv) {\r\n      // Not initialized yet.\r\n      return;\r\n    }\r\n\r\n    if (this.horizontalLayout_) {\r\n      toolboxDiv.style.left = '0';\r\n      toolboxDiv.style.height = 'auto';\r\n      toolboxDiv.style.width = '100%';\r\n      this.height_ = toolboxDiv.offsetHeight;\r\n      this.width_ = workspaceMetrics.viewWidth;\r\n      if (this.toolboxPosition === toolbox.Position.TOP) {\r\n        toolboxDiv.style.top = '0';\r\n      } else {\r\n        // Bottom\r\n        toolboxDiv.style.bottom = '0';\r\n      }\r\n    } else {\r\n      if (this.toolboxPosition === toolbox.Position.RIGHT) {\r\n        toolboxDiv.style.right = '0';\r\n      } else {\r\n        // Left\r\n        toolboxDiv.style.left = '0';\r\n      }\r\n      toolboxDiv.style.height = '100%';\r\n      this.width_ = toolboxDiv.offsetWidth;\r\n      this.height_ = workspaceMetrics.viewHeight;\r\n    }\r\n    this.flyout_!.position();\r\n  }\r\n\r\n  /**\r\n   * Handles resizing the toolbox when a toolbox item resizes.\r\n   *\r\n   * @internal\r\n   */\r\n  handleToolboxItemResize() {\r\n    // Reposition the workspace so that (0,0) is in the correct position\r\n    // relative to the new absolute edge (ie toolbox edge).\r\n    const workspace = this.workspace_;\r\n    const rect = this.HtmlDiv!.getBoundingClientRect();\r\n    const newX =\r\n      this.toolboxPosition === toolbox.Position.LEFT\r\n        ? workspace.scrollX + rect.width\r\n        : workspace.scrollX;\r\n    const newY =\r\n      this.toolboxPosition === toolbox.Position.TOP\r\n        ? workspace.scrollY + rect.height\r\n        : workspace.scrollY;\r\n    workspace.translate(newX, newY);\r\n\r\n    // Even though the div hasn't changed size, the visible workspace\r\n    // surface of the workspace has, so we may need to reposition everything.\r\n    common.svgResize(workspace);\r\n  }\r\n\r\n  /** Unhighlights any previously selected item. */\r\n  clearSelection() {\r\n    this.setSelectedItem(null);\r\n  }\r\n\r\n  /**\r\n   * Updates the category colours and background colour of selected categories.\r\n   *\r\n   * @internal\r\n   */\r\n  refreshTheme() {\r\n    for (let i = 0; i < this.contents_.length; i++) {\r\n      const child = this.contents_[i];\r\n      // TODO(#6097): Fix types or add refreshTheme to IToolboxItem.\r\n      const childAsCategory = child as ToolboxCategory;\r\n      if (childAsCategory.refreshTheme) {\r\n        childAsCategory.refreshTheme();\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Updates the flyout's content without closing it.  Should be used in\r\n   * response to a change in one of the dynamic categories, such as variables or\r\n   * procedures.\r\n   */\r\n  refreshSelection() {\r\n    if (\r\n      this.selectedItem_ &&\r\n      this.selectedItem_.isSelectable() &&\r\n      this.selectedItem_.getContents().length\r\n    ) {\r\n      this.flyout_!.show(this.selectedItem_.getContents());\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Shows or hides the toolbox.\r\n   *\r\n   * @param isVisible True if toolbox should be visible.\r\n   */\r\n  setVisible(isVisible: boolean) {\r\n    if (this.isVisible_ === isVisible) {\r\n      return;\r\n    }\r\n\r\n    this.HtmlDiv!.style.display = isVisible ? 'block' : 'none';\r\n    this.isVisible_ = isVisible;\r\n    // Invisible toolbox is ignored as drag targets and must have the drag\r\n    // target updated.\r\n    this.workspace_.recordDragTargets();\r\n  }\r\n\r\n  /**\r\n   * Hides the component. Called in WorkspaceSvg.hideChaff.\r\n   *\r\n   * @param onlyClosePopups Whether only popups should be closed.\r\n   *     Flyouts should not be closed if this is true.\r\n   */\r\n  autoHide(onlyClosePopups: boolean) {\r\n    if (!onlyClosePopups && this.flyout_ && this.flyout_.autoClose) {\r\n      this.clearSelection();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Sets the given item as selected.\r\n   * No-op if the item is not selectable.\r\n   *\r\n   * @param newItem The toolbox item to select.\r\n   */\r\n  setSelectedItem(newItem: IToolboxItem | null) {\r\n    const oldItem = this.selectedItem_;\r\n\r\n    if (\r\n      (!newItem && !oldItem) ||\r\n      (newItem && !isSelectableToolboxItem(newItem))\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    if (this.shouldDeselectItem_(oldItem, newItem) && oldItem !== null) {\r\n      this.deselectItem_(oldItem);\r\n    }\r\n\r\n    if (this.shouldSelectItem_(oldItem, newItem) && newItem !== null) {\r\n      this.selectItem_(oldItem, newItem);\r\n    }\r\n\r\n    this.updateFlyout_(oldItem, newItem);\r\n    this.fireSelectEvent_(oldItem, newItem);\r\n  }\r\n\r\n  /**\r\n   * Decides whether the old item should be deselected.\r\n   *\r\n   * @param oldItem The previously selected toolbox item.\r\n   * @param newItem The newly selected toolbox item.\r\n   * @returns True if the old item should be deselected, false otherwise.\r\n   */\r\n  protected shouldDeselectItem_(\r\n    oldItem: ISelectableToolboxItem | null,\r\n    newItem: ISelectableToolboxItem | null,\r\n  ): boolean {\r\n    // Deselect the old item unless the old item is collapsible and has been\r\n    // previously clicked on.\r\n    return (\r\n      oldItem !== null && (!oldItem.isCollapsible() || oldItem !== newItem)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Decides whether the new item should be selected.\r\n   *\r\n   * @param oldItem The previously selected toolbox item.\r\n   * @param newItem The newly selected toolbox item.\r\n   * @returns True if the new item should be selected, false otherwise.\r\n   */\r\n  protected shouldSelectItem_(\r\n    oldItem: ISelectableToolboxItem | null,\r\n    newItem: ISelectableToolboxItem | null,\r\n  ): boolean {\r\n    // Select the new item unless the old item equals the new item.\r\n    return newItem !== null && newItem !== oldItem;\r\n  }\r\n\r\n  /**\r\n   * Deselects the given item, marks it as unselected, and updates aria state.\r\n   *\r\n   * @param item The previously selected toolbox item which should be\r\n   *     deselected.\r\n   */\r\n  protected deselectItem_(item: ISelectableToolboxItem) {\r\n    this.selectedItem_ = null;\r\n    this.previouslySelectedItem_ = item;\r\n    item.setSelected(false);\r\n    aria.setState(\r\n      this.contentsDiv_ as Element,\r\n      aria.State.ACTIVEDESCENDANT,\r\n      '',\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Selects the given item, marks it selected, and updates aria state.\r\n   *\r\n   * @param oldItem The previously selected toolbox item.\r\n   * @param newItem The newly selected toolbox item.\r\n   */\r\n  protected selectItem_(\r\n    oldItem: ISelectableToolboxItem | null,\r\n    newItem: ISelectableToolboxItem,\r\n  ) {\r\n    this.selectedItem_ = newItem;\r\n    this.previouslySelectedItem_ = oldItem;\r\n    newItem.setSelected(true);\r\n    aria.setState(\r\n      this.contentsDiv_ as Element,\r\n      aria.State.ACTIVEDESCENDANT,\r\n      newItem.getId(),\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Selects the toolbox item by its position in the list of toolbox items.\r\n   *\r\n   * @param position The position of the item to select.\r\n   */\r\n  selectItemByPosition(position: number) {\r\n    if (position > -1 && position < this.contents_.length) {\r\n      const item = this.contents_[position];\r\n      if (item.isSelectable()) {\r\n        this.setSelectedItem(item);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Decides whether to hide or show the flyout depending on the selected item.\r\n   *\r\n   * @param oldItem The previously selected toolbox item.\r\n   * @param newItem The newly selected toolbox item.\r\n   */\r\n  protected updateFlyout_(\r\n    oldItem: ISelectableToolboxItem | null,\r\n    newItem: ISelectableToolboxItem | null,\r\n  ) {\r\n    if (\r\n      !newItem ||\r\n      (oldItem === newItem && !newItem.isCollapsible()) ||\r\n      !newItem.getContents().length\r\n    ) {\r\n      this.flyout_!.hide();\r\n    } else {\r\n      this.flyout_!.show(newItem.getContents());\r\n      this.flyout_!.scrollToStart();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Emits an event when a new toolbox item is selected.\r\n   *\r\n   * @param oldItem The previously selected toolbox item.\r\n   * @param newItem The newly selected toolbox item.\r\n   */\r\n  private fireSelectEvent_(\r\n    oldItem: ISelectableToolboxItem | null,\r\n    newItem: ISelectableToolboxItem | null,\r\n  ) {\r\n    const oldElement = oldItem && oldItem.getName();\r\n    let newElement = newItem && newItem.getName();\r\n    // In this case the toolbox closes, so the newElement should be null.\r\n    if (oldItem === newItem) {\r\n      newElement = null;\r\n    }\r\n    const event = new (eventUtils.get(eventUtils.TOOLBOX_ITEM_SELECT))(\r\n      oldElement,\r\n      newElement,\r\n      this.workspace_.id,\r\n    );\r\n    eventUtils.fire(event);\r\n  }\r\n\r\n  /**\r\n   * Closes the current item if it is expanded, or selects the parent.\r\n   *\r\n   * @returns True if a parent category was selected, false otherwise.\r\n   */\r\n  private selectParent_(): boolean {\r\n    if (!this.selectedItem_) {\r\n      return false;\r\n    }\r\n\r\n    if (\r\n      this.selectedItem_.isCollapsible() &&\r\n      (this.selectedItem_ as ICollapsibleToolboxItem).isExpanded()\r\n    ) {\r\n      const collapsibleItem = this.selectedItem_ as ICollapsibleToolboxItem;\r\n      collapsibleItem.toggleExpanded();\r\n      return true;\r\n    } else if (\r\n      this.selectedItem_.getParent() &&\r\n      this.selectedItem_.getParent()!.isSelectable()\r\n    ) {\r\n      this.setSelectedItem(this.selectedItem_.getParent());\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Selects the first child of the currently selected item, or nothing if the\r\n   * toolbox item has no children.\r\n   *\r\n   * @returns True if a child category was selected, false otherwise.\r\n   */\r\n  private selectChild_(): boolean {\r\n    if (!this.selectedItem_ || !this.selectedItem_.isCollapsible()) {\r\n      return false;\r\n    }\r\n    const collapsibleItem = this.selectedItem_ as ICollapsibleToolboxItem;\r\n    if (!collapsibleItem.isExpanded()) {\r\n      collapsibleItem.toggleExpanded();\r\n      return true;\r\n    } else {\r\n      this.selectNext_();\r\n      return true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Selects the next visible toolbox item.\r\n   *\r\n   * @returns True if a next category was selected, false otherwise.\r\n   */\r\n  private selectNext_(): boolean {\r\n    if (!this.selectedItem_) {\r\n      return false;\r\n    }\r\n\r\n    let nextItemIdx = this.contents_.indexOf(this.selectedItem_) + 1;\r\n    if (nextItemIdx > -1 && nextItemIdx < this.contents_.length) {\r\n      let nextItem = this.contents_[nextItemIdx];\r\n      while (nextItem && !nextItem.isSelectable()) {\r\n        nextItem = this.contents_[++nextItemIdx];\r\n      }\r\n      if (nextItem && nextItem.isSelectable()) {\r\n        this.setSelectedItem(nextItem);\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Selects the previous visible toolbox item.\r\n   *\r\n   * @returns True if a previous category was selected, false otherwise.\r\n   */\r\n  private selectPrevious_(): boolean {\r\n    if (!this.selectedItem_) {\r\n      return false;\r\n    }\r\n\r\n    let prevItemIdx = this.contents_.indexOf(this.selectedItem_) - 1;\r\n    if (prevItemIdx > -1 && prevItemIdx < this.contents_.length) {\r\n      let prevItem = this.contents_[prevItemIdx];\r\n      while (prevItem && !prevItem.isSelectable()) {\r\n        prevItem = this.contents_[--prevItemIdx];\r\n      }\r\n      if (prevItem && prevItem.isSelectable()) {\r\n        this.setSelectedItem(prevItem);\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /** Disposes of this toolbox. */\r\n  dispose() {\r\n    this.workspace_.getComponentManager().removeComponent('toolbox');\r\n    this.flyout_!.dispose();\r\n    for (let i = 0; i < this.contents_.length; i++) {\r\n      const toolboxItem = this.contents_[i];\r\n      toolboxItem.dispose();\r\n    }\r\n\r\n    for (let j = 0; j < this.boundEvents_.length; j++) {\r\n      browserEvents.unbind(this.boundEvents_[j]);\r\n    }\r\n    this.boundEvents_ = [];\r\n    this.contents_ = [];\r\n\r\n    if (this.HtmlDiv) {\r\n      this.workspace_.getThemeManager().unsubscribe(this.HtmlDiv);\r\n      dom.removeNode(this.HtmlDiv);\r\n    }\r\n  }\r\n}\r\n\r\n/** CSS for Toolbox.  See css.js for use. */\r\nCss.register(`\r\n.blocklyToolboxDelete {\r\n  cursor: url(\"<<<PATH>>>/handdelete.cur\"), auto;\r\n}\r\n\r\n.blocklyToolboxGrab {\r\n  cursor: url(\"<<<PATH>>>/handclosed.cur\"), auto;\r\n  cursor: grabbing;\r\n  cursor: -webkit-grabbing;\r\n}\r\n\r\n/* Category tree in Toolbox. */\r\n.blocklyToolboxDiv {\r\n  background-color: #ddd;\r\n  overflow-x: visible;\r\n  overflow-y: auto;\r\n  padding: 4px 0 4px 0;\r\n  position: absolute;\r\n  z-index: 70;  /* so blocks go under toolbox when dragging */\r\n  -webkit-tap-highlight-color: transparent;  /* issue #1345 */\r\n}\r\n\r\n.blocklyToolboxContents {\r\n  display: flex;\r\n  flex-wrap: wrap;\r\n  flex-direction: column;\r\n}\r\n\r\n.blocklyToolboxContents:focus {\r\n  outline: none;\r\n}\r\n`);\r\n\r\nregistry.register(registry.Type.TOOLBOX, registry.DEFAULT, Toolbox);\r\n","/**\r\n * @license\r\n * Copyright 2022 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * @file The entrypoint for blockly_compressed.js.  Provides various\r\n * backwards-compatibility hacks.  Not used when loading in\r\n * uncompressed mode.\r\n */\r\n\r\n// Former goog.module ID: Blockly.main\r\n\r\nimport * as Blockly from './blockly.js';\r\nimport * as Msg from './msg.js';\r\nimport * as colour from './utils/colour.js';\r\nimport * as deprecation from './utils/deprecation.js';\r\n\r\n/*\r\n * Aliased functions and properties that used to be on the Blockly namespace.\r\n * Everything in this section is deprecated. Both external and internal code\r\n * should avoid using these functions and use the designated replacements.\r\n * Everything in this section will be removed in a future version of Blockly.\r\n */\r\n\r\n// Add accessors for properties on Blockly that have now been deprecated.\r\n// This will not work in uncompressed mode; it depends on Blockly being\r\n// transpiled from a ES Module object to a plain object by Closure Compiler.\r\nObject.defineProperties(Blockly, {\r\n  /**\r\n   * The richness of block colours, regardless of the hue.\r\n   * Must be in the range of 0 (inclusive) to 1 (exclusive).\r\n   *\r\n   * @name Blockly.HSV_SATURATION\r\n   * @type {number}\r\n   * @deprecated Use Blockly.utils.colour.getHsvSaturation() /\r\n   *     .setHsvSaturation() instead.  (July 2023)\r\n   * @suppress {checkTypes}\r\n   */\r\n  HSV_SATURATION: {\r\n    get: function () {\r\n      deprecation.warn(\r\n        'Blockly.HSV_SATURATION',\r\n        'version 10',\r\n        'version 11',\r\n        'Blockly.utils.colour.getHsvSaturation()',\r\n      );\r\n      return colour.getHsvSaturation();\r\n    },\r\n    set: function (newValue) {\r\n      deprecation.warn(\r\n        'Blockly.HSV_SATURATION',\r\n        'version 10',\r\n        'version 11',\r\n        'Blockly.utils.colour.setHsvSaturation()',\r\n      );\r\n      colour.setHsvSaturation(newValue);\r\n    },\r\n  },\r\n  /**\r\n   * The intensity of block colours, regardless of the hue.\r\n   * Must be in the range of 0 (inclusive) to 1 (exclusive).\r\n   *\r\n   * @name Blockly.HSV_VALUE\r\n   * @type {number}\r\n   * @deprecated Use Blockly.utils.colour.getHsvValue() / .setHsvValue instead.\r\n   *     (July 2023)\r\n   * @suppress {checkTypes}\r\n   */\r\n  HSV_VALUE: {\r\n    get: function () {\r\n      deprecation.warn(\r\n        'Blockly.HSV_VALUE',\r\n        'version 10',\r\n        'version 11',\r\n        'Blockly.utils.colour.getHsvValue()',\r\n      );\r\n      return colour.getHsvValue();\r\n    },\r\n    set: function (newValue) {\r\n      deprecation.warn(\r\n        'Blockly.HSV_VALUE',\r\n        'version 10',\r\n        'version 11',\r\n        'Blockly.utils.colour.setHsvValue()',\r\n      );\r\n      colour.setHsvValue(newValue);\r\n    },\r\n  },\r\n});\r\n\r\n// If Blockly is compiled with ADVANCED_COMPILATION and/or loaded as a\r\n// CJS or ES module there will not be a Blockly global variable\r\n// created.  This can cause problems because a very common way of\r\n// loading translations is to use a <script> tag to load one of\r\n// the generated msg/*.js files, which consists of lines like:\r\n//\r\n// Blockly.Msg[\"ADD_COMMENT\"] = \"Add Comment\";\r\n// Blockly.Msg[\"CLEAN_UP\"] = \"Clean up Blocks\";\r\n//\r\n// This obviously only works if Blockly.Msg is the Msg export from the\r\n// Blockly.Msg module - so make sure it is, but only if there is not\r\n// yet a Blockly global variable.\r\nif (!('Blockly' in globalThis)) {\r\n  (globalThis as any)['Blockly'] = {'Msg': Msg};\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2016 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.BlocklyOptions\r\n\r\nimport type {Theme, ITheme} from './theme.js';\r\nimport type {WorkspaceSvg} from './workspace_svg.js';\r\nimport type {ToolboxDefinition} from './utils/toolbox.js';\r\n\r\n/**\r\n * Blockly options.\r\n */\r\nexport interface BlocklyOptions {\r\n  collapse?: boolean;\r\n  comments?: boolean;\r\n  css?: boolean;\r\n  disable?: boolean;\r\n  grid?: GridOptions;\r\n  horizontalLayout?: boolean;\r\n  maxBlocks?: number;\r\n  maxInstances?: {[blockType: string]: number};\r\n  media?: string;\r\n  modalInputs?: boolean;\r\n  move?: MoveOptions;\r\n  oneBasedIndex?: boolean;\r\n  readOnly?: boolean;\r\n  renderer?: string;\r\n  rendererOverrides?: {[rendererConstant: string]: any};\r\n  rtl?: boolean;\r\n  scrollbars?: ScrollbarOptions | boolean;\r\n  sounds?: boolean;\r\n  theme?: Theme | string | ITheme;\r\n  toolbox?: string | ToolboxDefinition | Element;\r\n  toolboxPosition?: string;\r\n  trashcan?: boolean;\r\n  maxTrashcanContents?: number;\r\n  plugins?: {[key: string]: (new (...p1: any[]) => any) | string};\r\n  zoom?: ZoomOptions;\r\n  parentWorkspace?: WorkspaceSvg;\r\n}\r\n\r\nexport interface GridOptions {\r\n  colour?: string;\r\n  length?: number;\r\n  snap?: boolean;\r\n  spacing?: number;\r\n}\r\n\r\nexport interface MoveOptions {\r\n  drag?: boolean;\r\n  scrollbars?: boolean | ScrollbarOptions;\r\n  wheel?: boolean;\r\n}\r\n\r\nexport interface ScrollbarOptions {\r\n  horizontal?: boolean;\r\n  vertical?: boolean;\r\n}\r\n\r\nexport interface ZoomOptions {\r\n  controls?: boolean;\r\n  maxScale?: number;\r\n  minScale?: number;\r\n  pinch?: boolean;\r\n  scaleSpeed?: number;\r\n  startScale?: number;\r\n  wheel?: boolean;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.utils.Metrics\r\n\r\nexport interface Metrics {\r\n  /** Height of the visible portion of the workspace. */\r\n  viewHeight: number;\r\n\r\n  /** Width of the visible portion of the workspace. */\r\n  viewWidth: number;\r\n\r\n  /** Height of the content. */\r\n  contentHeight: number;\r\n\r\n  /** Width of the content. */\r\n  contentWidth: number;\r\n\r\n  /** Height of the scroll area. */\r\n  scrollHeight: number;\r\n\r\n  /** Width of the scroll area. */\r\n  scrollWidth: number;\r\n\r\n  /**\r\n   * Top-edge of the visible portion of the workspace, relative to the workspace\r\n   * origin.\r\n   */\r\n  viewTop: number;\r\n\r\n  /**\r\n   * Left-edge of the visible portion of the workspace, relative to the\r\n   * workspace origin.\r\n   */\r\n  viewLeft: number;\r\n\r\n  /** Top-edge of the content, relative to the workspace origin. */\r\n  contentTop: number;\r\n\r\n  /** Left-edge of the content relative to the workspace origin. */\r\n  contentLeft: number;\r\n\r\n  /** Top-edge of the scroll area, relative to the workspace origin. */\r\n  scrollTop: number;\r\n\r\n  /** Left-edge of the scroll area relative to the workspace origin. */\r\n  scrollLeft: number;\r\n\r\n  /**\r\n   * Top-edge of the visible portion of the workspace, relative to the\r\n   * blocklyDiv.\r\n   */\r\n  absoluteTop: number;\r\n\r\n  /**\r\n   * Left-edge of the visible portion of the workspace, relative to the\r\n   * blocklyDiv.\r\n   */\r\n  absoluteLeft: number;\r\n\r\n  /**\r\n   * Height of the Blockly div (the view + the toolbox, simple of otherwise).\r\n   */\r\n  svgHeight: number;\r\n\r\n  /** Width of the Blockly div (the view + the toolbox, simple or otherwise). */\r\n  svgWidth: number;\r\n\r\n  /** Width of the toolbox, if it exists.  Otherwise zero. */\r\n  toolboxWidth: number;\r\n\r\n  /** Height of the toolbox, if it exists.  Otherwise zero. */\r\n  toolboxHeight: number;\r\n\r\n  /** Top, bottom, left or right. Use TOOLBOX_AT constants to compare. */\r\n  toolboxPosition: number;\r\n\r\n  /** Width of the flyout if it is always open.  Otherwise zero. */\r\n  flyoutWidth: number;\r\n\r\n  /** Height of the flyout if it is always open.  Otherwise zero. */\r\n  flyoutHeight: number;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.blockRendering.IPathObject\r\n\r\nimport type {BlockStyle} from '../../theme.js';\r\nimport type {BlockSvg} from '../../block_svg.js';\r\nimport type {ConstantProvider} from './constants.js';\r\nimport type {RenderedConnection} from '../../rendered_connection.js';\r\nimport type {Coordinate} from '../../utils/coordinate.js';\r\n\r\n/**\r\n * An interface for a block's path object.\r\n *\r\n * @param _root The root SVG element.\r\n * @param _constants The renderer's constants.\r\n */\r\nexport interface IPathObject {\r\n  /**\r\n   * The primary path of the block.\r\n   */\r\n  svgPath: SVGElement;\r\n\r\n  /** The renderer's constant provider. */\r\n  constants: ConstantProvider;\r\n\r\n  /** The primary path of the block. */\r\n  style: BlockStyle;\r\n\r\n  /**\r\n   * Holds the cursors SVG element when the cursor is attached to the block.\r\n   * This is null if there is no cursor on the block.\r\n   */\r\n  cursorSvg: SVGElement | null;\r\n\r\n  /**\r\n   * Holds the markers SVG element when the marker is attached to the block.\r\n   * This is null if there is no marker on the block.\r\n   */\r\n  markerSvg: SVGElement | null;\r\n\r\n  /**\r\n   * Set the path generated by the renderer onto the respective SVG element.\r\n   *\r\n   * @param pathString The path.\r\n   */\r\n  setPath(pathString: string): void;\r\n\r\n  /**\r\n   * Apply the stored colours to the block's path, taking into account whether\r\n   * the paths belong to a shadow block.\r\n   *\r\n   * @param block The source block.\r\n   */\r\n  applyColour(block: BlockSvg): void;\r\n\r\n  /**\r\n   * Update the style.\r\n   *\r\n   * @param blockStyle The block style to use.\r\n   */\r\n  setStyle(blockStyle: BlockStyle): void;\r\n\r\n  /**\r\n   * Flip the SVG paths in RTL.\r\n   */\r\n  flipRTL(): void;\r\n\r\n  /**\r\n   * Add the cursor SVG to this block's SVG group.\r\n   *\r\n   * @param cursorSvg The SVG root of the cursor to be added to the block SVG\r\n   *     group.\r\n   */\r\n  setCursorSvg(cursorSvg: SVGElement): void;\r\n\r\n  /**\r\n   * Add the marker SVG to this block's SVG group.\r\n   *\r\n   * @param markerSvg The SVG root of the marker to be added to the block SVG\r\n   *     group.\r\n   */\r\n  setMarkerSvg(markerSvg: SVGElement): void;\r\n\r\n  /**\r\n   * Set whether the block shows a highlight or not.  Block highlighting is\r\n   * often used to visually mark blocks currently being executed.\r\n   *\r\n   * @param highlighted True if highlighted.\r\n   */\r\n  updateHighlighted(highlighted: boolean): void;\r\n\r\n  /**\r\n   * Add or remove styling showing that a block is selected.\r\n   *\r\n   * @param enable True if selection is enabled, false otherwise.\r\n   */\r\n  updateSelected(enabled: boolean): void;\r\n\r\n  /**\r\n   * Add or remove styling showing that a block is dragged over a delete area.\r\n   *\r\n   * @param enable True if the block is being dragged over a delete area, false\r\n   *     otherwise.\r\n   */\r\n  updateDraggingDelete(enabled: boolean): void;\r\n\r\n  /**\r\n   * Add or remove styling showing that a block is an insertion marker.\r\n   *\r\n   * @param enable True if the block is an insertion marker, false otherwise.\r\n   */\r\n  updateInsertionMarker(enabled: boolean): void;\r\n\r\n  /**\r\n   * Add or remove styling showing that a block is movable.\r\n   *\r\n   * @param enable True if the block is movable, false otherwise.\r\n   */\r\n  updateMovable(enabled: boolean): void;\r\n\r\n  /** Adds the given path as a connection highlight for the given connection. */\r\n  addConnectionHighlight?(\r\n    connection: RenderedConnection,\r\n    connectionPath: string,\r\n    offset: Coordinate,\r\n    rtl: boolean,\r\n  ): void;\r\n\r\n  /**\r\n   * Removes any highlight associated with the given connection, if it exists.\r\n   */\r\n  removeConnectionHighlight?(connection: RenderedConnection): void;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.IToolboxItem\r\n\r\n/**\r\n * Interface for an item in the toolbox.\r\n */\r\nexport interface IToolboxItem {\r\n  /**\r\n   * Initializes the toolbox item.\r\n   * This includes creating the DOM and updating the state of any items based\r\n   * on the info object.\r\n   */\r\n  init(): void;\r\n\r\n  /**\r\n   * Gets the div for the toolbox item.\r\n   *\r\n   * @returns The div for the toolbox item.\r\n   */\r\n  getDiv(): Element | null;\r\n\r\n  /**\r\n   * Gets a unique identifier for this toolbox item.\r\n   *\r\n   * @returns The ID for the toolbox item.\r\n   */\r\n  getId(): string;\r\n\r\n  /**\r\n   * Gets the parent if the toolbox item is nested.\r\n   *\r\n   * @returns The parent toolbox item, or null if this toolbox item is not\r\n   *     nested.\r\n   */\r\n  getParent(): IToolboxItem | null;\r\n\r\n  /**\r\n   * Gets the nested level of the category.\r\n   *\r\n   * @returns The nested level of the category.\r\n   * @internal\r\n   */\r\n  getLevel(): number;\r\n\r\n  /**\r\n   * Whether the toolbox item is selectable.\r\n   *\r\n   * @returns True if the toolbox item can be selected.\r\n   */\r\n  isSelectable(): boolean;\r\n\r\n  /**\r\n   * Whether the toolbox item is collapsible.\r\n   *\r\n   * @returns True if the toolbox item is collapsible.\r\n   */\r\n  isCollapsible(): boolean;\r\n\r\n  /** Dispose of this toolbox item. No-op by default. */\r\n  dispose(): void;\r\n\r\n  /**\r\n   * Gets the HTML element that is clickable.\r\n   *\r\n   * @returns The HTML element that receives clicks.\r\n   */\r\n  getClickTarget(): Element | null;\r\n\r\n  /**\r\n   * Sets whether the category is visible or not.\r\n   * For a category to be visible its parent category must also be expanded.\r\n   *\r\n   * @param isVisible True if category should be visible.\r\n   */\r\n  setVisible_(isVisible: boolean): void;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.IToolbox\r\n\r\nimport type {IRegistrable} from './i_registrable.js';\r\nimport type {IToolboxItem} from './i_toolbox_item.js';\r\nimport type {ToolboxInfo} from '../utils/toolbox.js';\r\nimport type {IFlyout} from './i_flyout.js';\r\nimport type {WorkspaceSvg} from '../workspace_svg.js';\r\n\r\n/**\r\n * Interface for a toolbox.\r\n */\r\nexport interface IToolbox extends IRegistrable {\r\n  /** Initializes the toolbox. */\r\n  init(): void;\r\n\r\n  /**\r\n   * Fills the toolbox with new toolbox items and removes any old contents.\r\n   *\r\n   * @param toolboxDef Object holding information for creating a toolbox.\r\n   */\r\n  render(toolboxDef: ToolboxInfo): void;\r\n\r\n  /**\r\n   * Gets the width of the toolbox.\r\n   *\r\n   * @returns The width of the toolbox.\r\n   */\r\n  getWidth(): number;\r\n\r\n  /**\r\n   * Gets the height of the toolbox.\r\n   *\r\n   * @returns The height of the toolbox.\r\n   */\r\n  getHeight(): number;\r\n\r\n  /**\r\n   * Gets the toolbox flyout.\r\n   *\r\n   * @returns The toolbox flyout.\r\n   */\r\n  getFlyout(): IFlyout | null;\r\n\r\n  /**\r\n   * Gets the workspace for the toolbox.\r\n   *\r\n   * @returns The parent workspace for the toolbox.\r\n   */\r\n  getWorkspace(): WorkspaceSvg;\r\n\r\n  /**\r\n   * Gets whether or not the toolbox is horizontal.\r\n   *\r\n   * @returns True if the toolbox is horizontal, false if the toolbox is\r\n   *     vertical.\r\n   */\r\n  isHorizontal(): boolean;\r\n\r\n  /**\r\n   * Positions the toolbox based on whether it is a horizontal toolbox and\r\n   * whether the workspace is in rtl.\r\n   */\r\n  position(): void;\r\n\r\n  /** Handles resizing the toolbox when a toolbox item resizes. */\r\n  handleToolboxItemResize(): void;\r\n\r\n  /** Unhighlights any previously selected item. */\r\n  clearSelection(): void;\r\n\r\n  /**\r\n   * Updates the category colours and background colour of selected categories.\r\n   */\r\n  refreshTheme(): void;\r\n\r\n  /**\r\n   * Updates the flyout's content without closing it.  Should be used in\r\n   * response to a change in one of the dynamic categories, such as variables or\r\n   * procedures.\r\n   */\r\n  refreshSelection(): void;\r\n\r\n  /**\r\n   * Sets the visibility of the toolbox.\r\n   *\r\n   * @param isVisible True if toolbox should be visible.\r\n   */\r\n  setVisible(isVisible: boolean): void;\r\n\r\n  /**\r\n   * Selects the toolbox item by it's position in the list of toolbox items.\r\n   *\r\n   * @param position The position of the item to select.\r\n   */\r\n  selectItemByPosition(position: number): void;\r\n\r\n  /**\r\n   * Gets the selected item.\r\n   *\r\n   * @returns The selected item, or null if no item is currently selected.\r\n   */\r\n  getSelectedItem(): IToolboxItem | null;\r\n\r\n  /** Disposes of this toolbox. */\r\n  dispose(): void;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.IStyleable\r\n\r\n/**\r\n * Interface for an object that a style can be added to.\r\n */\r\nexport interface IStyleable {\r\n  /**\r\n   * Adds a style on the toolbox. Usually used to change the cursor.\r\n   *\r\n   * @param style The name of the class to add.\r\n   */\r\n  addStyle(style: string): void;\r\n\r\n  /**\r\n   * Removes a style from the toolbox. Usually used to change the cursor.\r\n   *\r\n   * @param style The name of the class to remove.\r\n   */\r\n  removeStyle(style: string): void;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.serialization.ISerializer\r\n\r\nimport type {Workspace} from '../workspace.js';\r\n\r\n/**\r\n * Serializes and deserializes a plugin or system.\r\n */\r\nexport interface ISerializer {\r\n  /**\r\n   * A priority value used to determine the order of deserializing state.\r\n   * More positive priorities are deserialized before less positive\r\n   * priorities. Eg if you have priorities (0, -10, 10, 100) the order of\r\n   * deserialiation will be (100, 10, 0, -10).\r\n   * If two serializers have the same priority, they are deserialized in an\r\n   * arbitrary order relative to each other.\r\n   */\r\n  priority: number;\r\n\r\n  /* eslint-disable no-unused-vars, valid-jsdoc */\r\n\r\n  /**\r\n   * Saves the state of the plugin or system.\r\n   *\r\n   * @param workspace The workspace the system to serialize is associated with.\r\n   * @returns A JS object containing the system's state, or null if there is no\r\n   *     state to record.\r\n   */\r\n  save(workspace: Workspace): Object | null;\r\n  /* eslint-enable valid-jsdoc */\r\n\r\n  /**\r\n   * Loads the state of the plugin or system.\r\n   *\r\n   * @param state The state of the system to deserialize. This will always be\r\n   *     non-null.\r\n   * @param workspace The workspace the system to deserialize is associated\r\n   *     with.\r\n   */\r\n  load(state: Object, workspace: Workspace): void;\r\n\r\n  /**\r\n   * Clears the state of the plugin or system.\r\n   *\r\n   * @param workspace The workspace the system to clear the state of is\r\n   *     associated with.\r\n   */\r\n  clear(workspace: Workspace): void;\r\n}\r\n/* eslint-enable no-unused-vars */\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.ISelectable\r\n\r\nimport type {IDeletable} from './i_deletable.js';\r\nimport type {IMovable} from './i_movable.js';\r\n\r\n/**\r\n * The interface for an object that is selectable.\r\n */\r\nexport interface ISelectable extends IDeletable, IMovable {\r\n  id: string;\r\n\r\n  /** Select this.  Highlight it visually. */\r\n  select(): void;\r\n\r\n  /** Unselect this.  Unhighlight it visually. */\r\n  unselect(): void;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.IRegistrable\r\n\r\n/**\r\n * The interface for a Blockly component that can be registered.\r\n */\r\nexport interface IRegistrable {}\r\n","/**\r\n * @license\r\n * Copyright 2022 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport {IParameterModel} from './i_parameter_model.js';\r\n\r\n/**\r\n * A data model for a procedure.\r\n */\r\nexport interface IProcedureModel {\r\n  /** Sets the human-readable name of the procedure. */\r\n  setName(name: string): this;\r\n\r\n  /**\r\n   * Inserts a parameter into the list of parameters.\r\n   *\r\n   * To move a parameter, first delete it, and then re-insert.\r\n   */\r\n  insertParameter(parameterModel: IParameterModel, index: number): this;\r\n\r\n  /** Removes the parameter at the given index from the parameter list. */\r\n  deleteParameter(index: number): this;\r\n\r\n  /**\r\n   * Sets the return type(s) of the procedure.\r\n   *\r\n   * Pass null to represent a procedure that does not return.\r\n   */\r\n  setReturnTypes(types: string[] | null): this;\r\n\r\n  /**\r\n   * Sets whether this procedure is enabled/disabled. If a procedure is disabled\r\n   * all procedure caller blocks should be disabled as well.\r\n   */\r\n  setEnabled(enabled: boolean): this;\r\n\r\n  /** Returns the unique language-neutral ID for the procedure. */\r\n  getId(): string;\r\n\r\n  /** Returns the human-readable name of the procedure. */\r\n  getName(): string;\r\n\r\n  /** Returns the parameter at the given index in the parameter list. */\r\n  getParameter(index: number): IParameterModel;\r\n\r\n  /** Returns an array of all of the parameters in the parameter list. */\r\n  getParameters(): IParameterModel[];\r\n\r\n  /**\r\n   * Returns the return type(s) of the procedure.\r\n   *\r\n   * Null represents a procedure that does not return a value.\r\n   */\r\n  getReturnTypes(): string[] | null;\r\n\r\n  /**\r\n   * Returns whether the procedure is enabled/disabled. If a procedure is\r\n   * disabled, all procedure caller blocks should be disabled as well.\r\n   */\r\n  getEnabled(): boolean;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2022 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport {IProcedureModel} from './i_procedure_model.js';\r\n\r\nexport interface IProcedureMap extends Map<string, IProcedureModel> {\r\n  /**\r\n   * Adds the given ProcedureModel to the map of procedure models, so that\r\n   * blocks can find it.\r\n   */\r\n  add(proc: IProcedureModel): this;\r\n\r\n  /** Returns all of the procedures stored in this map. */\r\n  getProcedures(): IProcedureModel[];\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport type {Rect} from '../utils/rect.js';\r\nimport type {UiMetrics} from '../metrics_manager.js';\r\n// Former goog.module ID: Blockly.IPositionable\r\n\r\nimport type {IComponent} from './i_component.js';\r\n\r\n/**\r\n * Interface for a component that is positioned on top of the workspace.\r\n */\r\nexport interface IPositionable extends IComponent {\r\n  /**\r\n   * Positions the element. Called when the window is resized.\r\n   *\r\n   * @param metrics The workspace metrics.\r\n   * @param savedPositions List of rectangles that are already on the workspace.\r\n   */\r\n  position(metrics: UiMetrics, savedPositions: Rect[]): void;\r\n\r\n  /**\r\n   * Returns the bounding rectangle of the UI element in pixel units relative to\r\n   * the Blockly injection div.\r\n   *\r\n   * @returns The UI elements's bounding box. Null if bounding box should be\r\n   *     ignored by other UI elements.\r\n   */\r\n  getBoundingRectangle(): Rect | null;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2022 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport {IProcedureModel} from './i_procedure_model';\r\n\r\n/**\r\n * A data model for a procedure.\r\n */\r\nexport interface IParameterModel {\r\n  /**\r\n   * Sets the name of this parameter to the given name.\r\n   */\r\n  setName(name: string): this;\r\n\r\n  /**\r\n   * Sets the types of this parameter to the given type.\r\n   */\r\n  setTypes(types: string[]): this;\r\n\r\n  /**\r\n   * Returns the name of this parameter.\r\n   */\r\n  getName(): string;\r\n\r\n  /**\r\n   * Return the types of this parameter.\r\n   */\r\n  getTypes(): string[];\r\n\r\n  /**\r\n   * Returns the unique language-neutral ID for the parameter.\r\n   *\r\n   * This represents the identify of the variable model which does not change\r\n   * over time.\r\n   */\r\n  getId(): string;\r\n\r\n  /** Sets the procedure model this parameter is associated with. */\r\n  setProcedureModel(model: IProcedureModel): this;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.IMovable\r\n\r\n/**\r\n * The interface for an object that is movable.\r\n */\r\nexport interface IMovable {\r\n  /**\r\n   * Get whether this is movable or not.\r\n   *\r\n   * @returns True if movable.\r\n   */\r\n  isMovable(): boolean;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport type {\r\n  ContainerRegion,\r\n  ToolboxMetrics,\r\n  AbsoluteMetrics,\r\n  UiMetrics,\r\n} from '../metrics_manager.js';\r\nimport type {Size} from '../utils/size.js';\r\nimport type {Metrics} from '../utils/metrics.js';\r\n// Former goog.module ID: Blockly.IMetricsManager\r\n\r\n/**\r\n * Interface for a metrics manager.\r\n */\r\nexport interface IMetricsManager {\r\n  /**\r\n   * Returns whether the scroll area has fixed edges.\r\n   *\r\n   * @returns Whether the scroll area has fixed edges.\r\n   * @internal\r\n   */\r\n  hasFixedEdges(): boolean;\r\n\r\n  /**\r\n   * Returns the metrics for the scroll area of the workspace.\r\n   *\r\n   * @param opt_getWorkspaceCoordinates True to get the scroll metrics in\r\n   *     workspace coordinates, false to get them in pixel coordinates.\r\n   * @param opt_viewMetrics The view metrics if they have been previously\r\n   *     computed. Passing in null may cause the view metrics to be computed\r\n   *     again, if it is needed.\r\n   * @param opt_contentMetrics The content metrics if they have been previously\r\n   *     computed. Passing in null may cause the content metrics to be computed\r\n   *     again, if it is needed.\r\n   * @returns The metrics for the scroll container\r\n   */\r\n  getScrollMetrics(\r\n    opt_getWorkspaceCoordinates?: boolean,\r\n    opt_viewMetrics?: ContainerRegion,\r\n    opt_contentMetrics?: ContainerRegion,\r\n  ): ContainerRegion;\r\n\r\n  /**\r\n   * Gets the width and the height of the flyout in pixel\r\n   * coordinates. By default, will get metrics for either a simple flyout (owned\r\n   * directly by the workspace) or for the flyout owned by the toolbox. If you\r\n   * pass `opt_own` as `true` then only metrics for the simple flyout will be\r\n   * returned, and it will return 0 for the width and height if the workspace\r\n   * has a category toolbox instead of a simple toolbox.\r\n   *\r\n   * @param opt_own Whether to only return the workspace's own flyout metrics.\r\n   * @returns The width and height of the flyout.\r\n   */\r\n  getFlyoutMetrics(opt_own?: boolean): ToolboxMetrics;\r\n\r\n  /**\r\n   * Gets the width, height and position of the toolbox on the workspace in\r\n   * pixel coordinates. Returns 0 for the width and height if the workspace has\r\n   * a simple toolbox instead of a category toolbox. To get the width and height\r\n   * of a simple toolbox, see {@link IMetricsManager#getFlyoutMetrics}.\r\n   *\r\n   * @returns The object with the width, height and position of the toolbox.\r\n   */\r\n  getToolboxMetrics(): ToolboxMetrics;\r\n\r\n  /**\r\n   * Gets the width and height of the workspace's parent SVG element in pixel\r\n   * coordinates. This area includes the toolbox and the visible workspace area.\r\n   *\r\n   * @returns The width and height of the workspace's parent SVG element.\r\n   */\r\n  getSvgMetrics(): Size;\r\n\r\n  /**\r\n   * Gets the absolute left and absolute top in pixel coordinates.\r\n   * This is where the visible workspace starts in relation to the SVG\r\n   * container.\r\n   *\r\n   * @returns The absolute metrics for the workspace.\r\n   */\r\n  getAbsoluteMetrics(): AbsoluteMetrics;\r\n\r\n  /**\r\n   * Gets the metrics for the visible workspace in either pixel or workspace\r\n   * coordinates. The visible workspace does not include the toolbox or flyout.\r\n   *\r\n   * @param opt_getWorkspaceCoordinates True to get the view metrics in\r\n   *     workspace coordinates, false to get them in pixel coordinates.\r\n   * @returns The width, height, top and left of the viewport in either\r\n   *     workspace coordinates or pixel coordinates.\r\n   */\r\n  getViewMetrics(opt_getWorkspaceCoordinates?: boolean): ContainerRegion;\r\n\r\n  /**\r\n   * Gets content metrics in either pixel or workspace coordinates.\r\n   * The content area is a rectangle around all the top bounded elements on the\r\n   * workspace (workspace comments and blocks).\r\n   *\r\n   * @param opt_getWorkspaceCoordinates True to get the content metrics in\r\n   *     workspace coordinates, false to get them in pixel coordinates.\r\n   * @returns The metrics for the content container.\r\n   */\r\n  getContentMetrics(opt_getWorkspaceCoordinates?: boolean): ContainerRegion;\r\n\r\n  /**\r\n   * Returns an object with all the metrics required to size scrollbars for a\r\n   * top level workspace.  The following properties are computed:\r\n   * Coordinate system: pixel coordinates, -left, -up, +right, +down\r\n   * .viewHeight: Height of the visible portion of the workspace.\r\n   * .viewWidth: Width of the visible portion of the workspace.\r\n   * .contentHeight: Height of the content.\r\n   * .contentWidth: Width of the content.\r\n   * .svgHeight: Height of the Blockly div (the view + the toolbox,\r\n   *    simple or otherwise),\r\n   * .svgWidth: Width of the Blockly div (the view + the toolbox,\r\n   *    simple or otherwise),\r\n   * .viewTop: Top-edge of the visible portion of the workspace, relative to\r\n   *     the workspace origin.\r\n   * .viewLeft: Left-edge of the visible portion of the workspace, relative to\r\n   *     the workspace origin.\r\n   * .contentTop: Top-edge of the content, relative to the workspace origin.\r\n   * .contentLeft: Left-edge of the content relative to the workspace origin.\r\n   * .absoluteTop: Top-edge of the visible portion of the workspace, relative\r\n   *     to the blocklyDiv.\r\n   * .absoluteLeft: Left-edge of the visible portion of the workspace, relative\r\n   *     to the blocklyDiv.\r\n   * .toolboxWidth: Width of the toolbox, if it exists.  Otherwise zero.\r\n   * .toolboxHeight: Height of the toolbox, if it exists.  Otherwise zero.\r\n   * .flyoutWidth: Width of the flyout if it is always open.  Otherwise zero.\r\n   * .flyoutHeight: Height of the flyout if it is always open.  Otherwise zero.\r\n   * .toolboxPosition: Top, bottom, left or right. Use TOOLBOX_AT constants to\r\n   *     compare.\r\n   *\r\n   * @returns Contains size and position metrics of a top level workspace.\r\n   */\r\n  getMetrics(): Metrics;\r\n\r\n  /**\r\n   * Returns common metrics used by UI elements.\r\n   *\r\n   * @returns The UI metrics.\r\n   */\r\n  getUiMetrics(): UiMetrics;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport {KeyboardShortcut} from '../shortcut_registry.js';\r\n// Former goog.module ID: Blockly.IKeyboardAccessible\r\n\r\n/**\r\n * An interface for an object that handles keyboard shortcuts.\r\n */\r\nexport interface IKeyboardAccessible {\r\n  /**\r\n   * Handles the given keyboard shortcut.\r\n   *\r\n   * @param shortcut The shortcut to be handled.\r\n   * @returns True if the shortcut has been handled, false otherwise.\r\n   */\r\n  onShortcut(shortcut: KeyboardShortcut): boolean;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.IFlyout\r\n\r\nimport type {WorkspaceSvg} from '../workspace_svg.js';\r\nimport type {BlockSvg} from '../block_svg.js';\r\nimport type {Coordinate} from '../utils/coordinate.js';\r\nimport type {FlyoutDefinition} from '../utils/toolbox.js';\r\nimport type {Svg} from '../utils/svg.js';\r\nimport type {IRegistrable} from './i_registrable.js';\r\n\r\n/**\r\n * Interface for a flyout.\r\n */\r\nexport interface IFlyout extends IRegistrable {\r\n  /** Whether the flyout is laid out horizontally or not. */\r\n  horizontalLayout: boolean;\r\n\r\n  /** Is RTL vs LTR. */\r\n  RTL: boolean;\r\n\r\n  /** The target workspace */\r\n  targetWorkspace: WorkspaceSvg | null;\r\n\r\n  /** Margin around the edges of the blocks in the flyout. */\r\n  readonly MARGIN: number;\r\n\r\n  /** Does the flyout automatically close when a block is created? */\r\n  autoClose: boolean;\r\n\r\n  /** Corner radius of the flyout background. */\r\n  readonly CORNER_RADIUS: number;\r\n\r\n  /**\r\n   * Creates the flyout's DOM.  Only needs to be called once.  The flyout can\r\n   * either exist as its own svg element or be a g element nested inside a\r\n   * separate svg element.\r\n   *\r\n   * @param tagName The type of tag to put the flyout in. This should be <svg>\r\n   *     or <g>.\r\n   * @returns The flyout's SVG group.\r\n   */\r\n  createDom(\r\n    tagName: string | Svg<SVGSVGElement> | Svg<SVGGElement>,\r\n  ): SVGElement;\r\n\r\n  /**\r\n   * Initializes the flyout.\r\n   *\r\n   * @param targetWorkspace The workspace in which to create new blocks.\r\n   */\r\n  init(targetWorkspace: WorkspaceSvg): void;\r\n\r\n  /**\r\n   * Dispose of this flyout.\r\n   * Unlink from all DOM elements to prevent memory leaks.\r\n   */\r\n  dispose(): void;\r\n\r\n  /**\r\n   * Get the width of the flyout.\r\n   *\r\n   * @returns The width of the flyout.\r\n   */\r\n  getWidth(): number;\r\n\r\n  /**\r\n   * Get the height of the flyout.\r\n   *\r\n   * @returns The height of the flyout.\r\n   */\r\n  getHeight(): number;\r\n\r\n  /**\r\n   * Get the workspace inside the flyout.\r\n   *\r\n   * @returns The workspace inside the flyout.\r\n   */\r\n  getWorkspace(): WorkspaceSvg;\r\n\r\n  /**\r\n   * Is the flyout visible?\r\n   *\r\n   * @returns True if visible.\r\n   */\r\n  isVisible(): boolean;\r\n\r\n  /**\r\n   * Set whether the flyout is visible. A value of true does not necessarily\r\n   * mean that the flyout is shown. It could be hidden because its container is\r\n   * hidden.\r\n   *\r\n   * @param visible True if visible.\r\n   */\r\n  setVisible(visible: boolean): void;\r\n\r\n  /**\r\n   * Set whether this flyout's container is visible.\r\n   *\r\n   * @param visible Whether the container is visible.\r\n   */\r\n  setContainerVisible(visible: boolean): void;\r\n\r\n  /** Hide and empty the flyout. */\r\n  hide(): void;\r\n\r\n  /**\r\n   * Show and populate the flyout.\r\n   *\r\n   * @param flyoutDef Contents to display in the flyout. This is either an array\r\n   *     of Nodes, a NodeList, a toolbox definition, or a string with the name\r\n   *     of the dynamic category.\r\n   */\r\n  show(flyoutDef: FlyoutDefinition | string): void;\r\n\r\n  /**\r\n   * Create a copy of this block on the workspace.\r\n   *\r\n   * @param originalBlock The block to copy from the flyout.\r\n   * @returns The newly created block.\r\n   * @throws {Error} if something went wrong with deserialization.\r\n   */\r\n  createBlock(originalBlock: BlockSvg): BlockSvg;\r\n\r\n  /** Reflow blocks and their mats. */\r\n  reflow(): void;\r\n\r\n  /**\r\n   * @returns True if this flyout may be scrolled with a scrollbar or by\r\n   *     dragging.\r\n   */\r\n  isScrollable(): boolean;\r\n\r\n  /**\r\n   * Calculates the x coordinate for the flyout position.\r\n   *\r\n   * @returns X coordinate.\r\n   */\r\n  getX(): number;\r\n\r\n  /**\r\n   * Calculates the y coordinate for the flyout position.\r\n   *\r\n   * @returns Y coordinate.\r\n   */\r\n  getY(): number;\r\n\r\n  /** Position the flyout. */\r\n  position(): void;\r\n\r\n  /**\r\n   * Determine if a drag delta is toward the workspace, based on the position\r\n   * and orientation of the flyout. This is used in determineDragIntention_ to\r\n   * determine if a new block should be created or if the flyout should scroll.\r\n   *\r\n   * @param currentDragDeltaXY How far the pointer has moved from the position\r\n   *     at mouse down, in pixel units.\r\n   * @returns True if the drag is toward the workspace.\r\n   */\r\n  isDragTowardWorkspace(currentDragDeltaXY: Coordinate): boolean;\r\n\r\n  /**\r\n   * Does this flyout allow you to create a new instance of the given block?\r\n   * Used for deciding if a block can be \"dragged out of\" the flyout.\r\n   *\r\n   * @param block The block to copy from the flyout.\r\n   * @returns True if you can create a new instance of the block, false\r\n   *     otherwise.\r\n   */\r\n  isBlockCreatable(block: BlockSvg): boolean;\r\n\r\n  /** Scroll the flyout to the beginning of its contents. */\r\n  scrollToStart(): void;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport {Rect} from '../utils/rect.js';\r\n\r\nimport {IDraggable} from './i_draggable.js';\r\n\r\n// Former goog.module ID: Blockly.IDragTarget\r\n\r\nimport type {IComponent} from './i_component.js';\r\n\r\n/**\r\n * Interface for a component with custom behaviour when a block or bubble is\r\n * dragged over or dropped on top of it.\r\n */\r\nexport interface IDragTarget extends IComponent {\r\n  /**\r\n   * Returns the bounding rectangle of the drag target area in pixel units\r\n   * relative to viewport.\r\n   *\r\n   * @returns The component's bounding box. Null if drag target area should be\r\n   *     ignored.\r\n   */\r\n  getClientRect(): Rect | null;\r\n\r\n  /**\r\n   * Handles when a cursor with a block or bubble enters this drag target.\r\n   *\r\n   * @param dragElement The block or bubble currently being dragged.\r\n   */\r\n  onDragEnter(dragElement: IDraggable): void;\r\n\r\n  /**\r\n   * Handles when a cursor with a block or bubble is dragged over this drag\r\n   * target.\r\n   *\r\n   * @param dragElement The block or bubble currently being dragged.\r\n   */\r\n  onDragOver(dragElement: IDraggable): void;\r\n\r\n  /**\r\n   * Handles when a cursor with a block or bubble exits this drag target.\r\n   *\r\n   * @param dragElement The block or bubble currently being dragged.\r\n   */\r\n  onDragExit(dragElement: IDraggable): void;\r\n\r\n  /**\r\n   * Handles when a block or bubble is dropped on this component.\r\n   * Should not handle delete here.\r\n   *\r\n   * @param dragElement The block or bubble currently being dragged.\r\n   */\r\n  onDrop(dragElement: IDraggable): void;\r\n\r\n  /**\r\n   * Returns whether the provided block or bubble should not be moved after\r\n   * being dropped on this component. If true, the element will return to where\r\n   * it was when the drag started.\r\n   *\r\n   * @param dragElement The block or bubble currently being dragged.\r\n   * @returns Whether the block or bubble provided should be returned to drag\r\n   *     start.\r\n   */\r\n  shouldPreventMove(dragElement: IDraggable): boolean;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.IDraggable\r\n\r\nimport type {IDeletable} from './i_deletable.js';\r\n\r\n/**\r\n * The interface for an object that can be dragged.\r\n */\r\nexport interface IDraggable extends IDeletable {}\r\n","/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.IDeleteArea\r\n\r\nimport type {IDragTarget} from './i_drag_target.js';\r\nimport type {IDraggable} from './i_draggable.js';\r\n\r\n/**\r\n * Interface for a component that can delete a block or bubble that is dropped\r\n * on top of it.\r\n */\r\nexport interface IDeleteArea extends IDragTarget {\r\n  /**\r\n   * Returns whether the provided block or bubble would be deleted if dropped on\r\n   * this area.\r\n   * This method should check if the element is deletable and is always called\r\n   * before onDragEnter/onDragOver/onDragExit.\r\n   *\r\n   * @param element The block or bubble currently being dragged.\r\n   * @param couldConnect Whether the element could could connect to another.\r\n   * @returns Whether the element provided would be deleted if dropped on this\r\n   *     area.\r\n   */\r\n  wouldDelete(element: IDraggable, couldConnect: boolean): boolean;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.IDeletable\r\n\r\n/**\r\n * The interface for an object that can be deleted.\r\n */\r\nexport interface IDeletable {\r\n  /**\r\n   * Get whether this object is deletable or not.\r\n   *\r\n   * @returns True if deletable.\r\n   */\r\n  isDeletable(): boolean;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.IContextMenu\r\n\r\nexport interface IContextMenu {\r\n  /**\r\n   * Show the context menu for this object.\r\n   *\r\n   * @param e Mouse event.\r\n   */\r\n  showContextMenu(e: Event): void;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2023 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport type {BlockSvg} from '../block_svg';\r\nimport type {RenderedConnection} from '../rendered_connection';\r\n\r\n/**\r\n * Displays visual \"previews\" of where a block will be connected if it is\r\n * dropped.\r\n */\r\nexport interface IConnectionPreviewer {\r\n  /**\r\n   * Display a connection preview where the draggedCon connects to the\r\n   * staticCon, replacing the replacedBlock (currently connected to the\r\n   * staticCon).\r\n   *\r\n   * @param draggedCon The connection on the block stack being dragged.\r\n   * @param staticCon The connection not being dragged that we are\r\n   *     connecting to.\r\n   * @param replacedBlock The block currently connected to the staticCon that\r\n   *     is being replaced.\r\n   */\r\n  previewReplacement(\r\n    draggedConn: RenderedConnection,\r\n    staticConn: RenderedConnection,\r\n    replacedBlock: BlockSvg,\r\n  ): void;\r\n\r\n  /**\r\n   * Display a connection preview where the draggedCon connects to the\r\n   * staticCon, and no block is being relaced.\r\n   *\r\n   * @param draggedCon The connection on the block stack being dragged.\r\n   * @param staticCon The connection not being dragged that we are\r\n   *     connecting to.\r\n   */\r\n  previewConnection(\r\n    draggedConn: RenderedConnection,\r\n    staticConn: RenderedConnection,\r\n  ): void;\r\n\r\n  /** Hide any previews that are currently displayed. */\r\n  hidePreview(): void;\r\n\r\n  /** Dispose of any references held by this connection previewer. */\r\n  dispose(): void;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport type {Connection} from '../connection.js';\r\nimport type {RenderedConnection} from '../rendered_connection.js';\r\n// Former goog.module ID: Blockly.IConnectionChecker\r\n\r\n/**\r\n * Class for connection type checking logic.\r\n */\r\nexport interface IConnectionChecker {\r\n  /**\r\n   * Check whether the current connection can connect with the target\r\n   * connection.\r\n   *\r\n   * @param a Connection to check compatibility with.\r\n   * @param b Connection to check compatibility with.\r\n   * @param isDragging True if the connection is being made by dragging a block.\r\n   * @param opt_distance The max allowable distance between the connections for\r\n   *     drag checks.\r\n   * @returns Whether the connection is legal.\r\n   */\r\n  canConnect(\r\n    a: Connection | null,\r\n    b: Connection | null,\r\n    isDragging: boolean,\r\n    opt_distance?: number,\r\n  ): boolean;\r\n\r\n  /**\r\n   * Checks whether the current connection can connect with the target\r\n   * connection, and return an error code if there are problems.\r\n   *\r\n   * @param a Connection to check compatibility with.\r\n   * @param b Connection to check compatibility with.\r\n   * @param isDragging True if the connection is being made by dragging a block.\r\n   * @param opt_distance The max allowable distance between the connections for\r\n   *     drag checks.\r\n   * @returns Connection.CAN_CONNECT if the connection is legal, an error code\r\n   *     otherwise.\r\n   */\r\n  canConnectWithReason(\r\n    a: Connection | null,\r\n    b: Connection | null,\r\n    isDragging: boolean,\r\n    opt_distance?: number,\r\n  ): number;\r\n\r\n  /**\r\n   * Helper method that translates a connection error code into a string.\r\n   *\r\n   * @param errorCode The error code.\r\n   * @param a One of the two connections being checked.\r\n   * @param b The second of the two connections being checked.\r\n   * @returns A developer-readable error string.\r\n   */\r\n  getErrorMessage(\r\n    errorCode: number,\r\n    a: Connection | null,\r\n    b: Connection | null,\r\n  ): string;\r\n\r\n  /**\r\n   * Check that connecting the given connections is safe, meaning that it would\r\n   * not break any of Blockly's basic assumptions (e.g. no self connections).\r\n   *\r\n   * @param a The first of the connections to check.\r\n   * @param b The second of the connections to check.\r\n   * @returns An enum with the reason this connection is safe or unsafe.\r\n   */\r\n  doSafetyChecks(a: Connection | null, b: Connection | null): number;\r\n\r\n  /**\r\n   * Check whether this connection is compatible with another connection with\r\n   * respect to the value type system.  E.g. square_root(\"Hello\") is not\r\n   * compatible.\r\n   *\r\n   * @param a Connection to compare.\r\n   * @param b Connection to compare against.\r\n   * @returns True if the connections share a type.\r\n   */\r\n  doTypeChecks(a: Connection, b: Connection): boolean;\r\n\r\n  /**\r\n   * Check whether this connection can be made by dragging.\r\n   *\r\n   * @param a Connection to compare.\r\n   * @param b Connection to compare against.\r\n   * @param distance The maximum allowable distance between connections.\r\n   * @returns True if the connection is allowed during a drag.\r\n   */\r\n  doDragChecks(\r\n    a: RenderedConnection,\r\n    b: RenderedConnection,\r\n    distance: number,\r\n  ): boolean;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.IComponent\r\n\r\n/**\r\n * The interface for a workspace component that can be registered with the\r\n * ComponentManager.\r\n */\r\nexport interface IComponent {\r\n  /**\r\n   * The unique ID for this component that is used to register with the\r\n   * ComponentManager.\r\n   */\r\n  id: string;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.ICollapsibleToolboxItem\r\n\r\nimport type {ISelectableToolboxItem} from './i_selectable_toolbox_item.js';\r\nimport type {IToolboxItem} from './i_toolbox_item.js';\r\n\r\n/**\r\n * Interface for an item in the toolbox that can be collapsed.\r\n */\r\nexport interface ICollapsibleToolboxItem extends ISelectableToolboxItem {\r\n  /**\r\n   * Gets any children toolbox items. (ex. Gets the subcategories)\r\n   *\r\n   * @returns The child toolbox items.\r\n   */\r\n  getChildToolboxItems(): IToolboxItem[];\r\n\r\n  /**\r\n   * Whether the toolbox item is expanded to show its child subcategories.\r\n   *\r\n   * @returns True if the toolbox item shows its children, false if it is\r\n   *     collapsed.\r\n   */\r\n  isExpanded(): boolean;\r\n\r\n  /** Toggles whether or not the toolbox item is expanded. */\r\n  toggleExpanded(): void;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport type {Coordinate} from '../utils/coordinate.js';\r\n// Former goog.module ID: Blockly.IBubble\r\n\r\nimport type {IContextMenu} from './i_contextmenu.js';\r\nimport type {IDraggable} from './i_draggable.js';\r\n\r\n/**\r\n * A bubble interface.\r\n */\r\nexport interface IBubble extends IDraggable, IContextMenu {\r\n  /**\r\n   * Return the coordinates of the top-left corner of this bubble's body\r\n   * relative to the drawing surface's origin (0,0), in workspace units.\r\n   *\r\n   * @returns Object with .x and .y properties.\r\n   */\r\n  getRelativeToSurfaceXY(): Coordinate;\r\n\r\n  /**\r\n   * Return the root node of the bubble's SVG group.\r\n   *\r\n   * @returns The root SVG node of the bubble's group.\r\n   */\r\n  getSvgRoot(): SVGElement;\r\n\r\n  /**\r\n   * Sets whether or not this bubble is being dragged.\r\n   *\r\n   * @param adding True if dragging, false otherwise.\r\n   */\r\n  setDragging(dragging: boolean): void;\r\n\r\n  /**\r\n   * Move this bubble during a drag.\r\n   *\r\n   * @param newLoc The location to translate to, in workspace coordinates.\r\n   */\r\n  moveDuringDrag(newLoc: Coordinate): void;\r\n\r\n  /**\r\n   * Move the bubble to the specified location in workspace coordinates.\r\n   *\r\n   * @param x The x position to move to.\r\n   * @param y The y position to move to.\r\n   */\r\n  moveTo(x: number, y: number): void;\r\n\r\n  /**\r\n   * Update the style of this bubble when it is dragged over a delete area.\r\n   *\r\n   * @param enable True if the bubble is about to be deleted, false otherwise.\r\n   */\r\n  setDeleteStyle(enable: boolean): void;\r\n\r\n  /** Dispose of this bubble. */\r\n  dispose(): void;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport type {Rect} from '../utils/rect.js';\r\n// Former goog.module ID: Blockly.IBoundedElement\r\n\r\n/**\r\n * A bounded element interface.\r\n */\r\nexport interface IBoundedElement {\r\n  /**\r\n   * Returns the coordinates of a bounded element describing the dimensions of\r\n   * the element. Coordinate system: workspace coordinates.\r\n   *\r\n   * @returns Object with coordinates of the bounded element.\r\n   */\r\n  getBoundingRectangle(): Rect;\r\n\r\n  /**\r\n   * Move the element by a relative offset.\r\n   *\r\n   * @param dx Horizontal offset in workspace units.\r\n   * @param dy Vertical offset in workspace units.\r\n   * @param reason Why is this move happening?  'user', 'bump', 'snap'...\r\n   */\r\n  moveBy(dx: number, dy: number, reason?: string[]): void;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport type {Coordinate} from '../utils/coordinate.js';\r\nimport type {BlockSvg} from '../block_svg.js';\r\n// Former goog.module ID: Blockly.IBlockDragger\r\n\r\n/**\r\n * A block dragger interface.\r\n */\r\nexport interface IBlockDragger {\r\n  /**\r\n   * Start dragging a block.\r\n   *\r\n   * @param currentDragDeltaXY How far the pointer has moved from the position\r\n   *     at mouse down, in pixel units.\r\n   * @param healStack Whether or not to heal the stack after disconnecting.\r\n   */\r\n  startDrag(currentDragDeltaXY: Coordinate, healStack: boolean): void;\r\n\r\n  /**\r\n   * Execute a step of block dragging, based on the given event.  Update the\r\n   * display accordingly.\r\n   *\r\n   * @param e The most recent move event.\r\n   * @param currentDragDeltaXY How far the pointer has moved from the position\r\n   *     at the start of the drag, in pixel units.\r\n   */\r\n  drag(e: Event, currentDragDeltaXY: Coordinate): void;\r\n\r\n  /**\r\n   * Finish a block drag and put the block back on the workspace.\r\n   *\r\n   * @param e The mouseup/touchend event.\r\n   * @param currentDragDeltaXY How far the pointer has moved from the position\r\n   *     at the start of the drag, in pixel units.\r\n   */\r\n  endDrag(e: Event, currentDragDeltaXY: Coordinate): void;\r\n\r\n  /**\r\n   * Get a list of the insertion markers that currently exist.  Drags have 0, 1,\r\n   * or 2 insertion markers.\r\n   *\r\n   * @returns A possibly empty list of insertion marker blocks.\r\n   */\r\n  getInsertionMarkers(): BlockSvg[];\r\n\r\n  /** Sever all links from this object and do any necessary cleanup. */\r\n  dispose(): void;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.IAutoHideable\r\n\r\nimport type {IComponent} from './i_component.js';\r\n\r\n/**\r\n * Interface for a component that can be automatically hidden.\r\n */\r\nexport interface IAutoHideable extends IComponent {\r\n  /**\r\n   * Hides the component. Called in WorkspaceSvg.hideChaff.\r\n   *\r\n   * @param onlyClosePopups Whether only popups should be closed.\r\n   *   Flyouts should not be closed if this is true.\r\n   */\r\n  autoHide(onlyClosePopups: boolean): void;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.IASTNodeLocationWithBlock\r\n\r\nimport type {IASTNodeLocation} from './i_ast_node_location.js';\r\nimport type {Block} from '../block.js';\r\n\r\n/**\r\n * An AST node location that has an associated block.\r\n */\r\nexport interface IASTNodeLocationWithBlock extends IASTNodeLocation {\r\n  /**\r\n   * Get the source block associated with this node.\r\n   *\r\n   * @returns The source block.\r\n   */\r\n  getSourceBlock(): Block | null;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.IASTNodeLocationSvg\r\n\r\nimport type {IASTNodeLocation} from './i_ast_node_location.js';\r\n\r\n/**\r\n * An AST node location SVG interface.\r\n */\r\nexport interface IASTNodeLocationSvg extends IASTNodeLocation {\r\n  /**\r\n   * Add the marker SVG to this node's SVG group.\r\n   *\r\n   * @param markerSvg The SVG root of the marker to be added to the SVG group.\r\n   */\r\n  setMarkerSvg(markerSvg: SVGElement | null): void;\r\n\r\n  /**\r\n   * Add the cursor SVG to this node's SVG group.\r\n   *\r\n   * @param cursorSvg The SVG root of the cursor to be added to the SVG group.\r\n   */\r\n  setCursorSvg(cursorSvg: SVGElement | null): void;\r\n}\r\n","/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n// Former goog.module ID: Blockly.IASTNodeLocation\r\n\r\n/**\r\n * An AST node location interface.\r\n */\r\nexport interface IASTNodeLocation {}\r\n"]}